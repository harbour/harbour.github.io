From druzus at priv.onet.pl  Sat Sep  1 07:47:50 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sat Sep  1 07:47:58 2007
Subject: [Harbour] Extended field types in RDDs
Message-ID: <20070901114750.GB9374@localhost.localdomain>

Hi All,

I've found a while to write some text about necessary modifications
for common to all RDDs extended field support. It's an old problem
still open and I think that it's time to resolve it.


I'll begin with small presentation for already supported types and
some other which exist in different DBF implementations supported
partially or not supported yet by us.


Legends:
   BIN - binary
   LE - little endian
   DP - decimal point

Clipper supports the following DBF filed types:
--------------+-------+-----+----
LOW LEVEL ID  | PRGID | LEN | DEC
--------------+-------+-----+----
HB_IT_LOGICAL | "L"   | 1   | 0    //ASCII T/F Y/N value
HB_IT_DATE    | "D"   | 8   | 8    //ASCII DTOS() value
HB_IT_LONG    | "N"   | <n> | <m>  //ASCII <n> bytes number, <m> DP
HB_IT_STRING  | "C"   | <n> | <m>  //len = <n> + 256 * <m>
HB_IT_MEMO    | "M"   | 10  | 0    //ASCII MEMO block number
--------------+-------+-----+----
Now Harbour recognizes and suppots also:
--------------+-------+-----+----
HB_IT_INTEGER | "I"   | <n> | <m>  //BIN LE in <n>bytes, <m>:DP (<n>:1,2,3,4,8)
HB_IT_DATE    | "D"   | 3   | 0    //BIN LE Julian's day
HB_IT_DATE    | "D"   | 4   | 0    //BIN LE Julian's day
HB_IT_MEMO    | "M"   | 4   | 0    //BIN LE MEMO block number
HB_IT_MEMO    | "M"   | 10  | 0    //SMT MEMO SIG (BIN LE:block,size,type)
HB_FT_DOUBLE  | "B"   | 8   | <m>  //IEEE754 LE double number, <m> DP
HB_IT_ANY     | "V"   | 2   | 0    //SIX3 BIN16 LE (16 bit signed integer)
HB_IT_ANY     | "V"   | 3   | 0    //SIX3 packed date - Sx_DToP()
HB_IT_ANY     | "V"   | 4   | 0    //SIX3 BIN32 LE (32 bit signed integer)
HB_IT_ANY     | "V"   | <n> | <m>  //SIX3 variable (weekly-typed) field <n>>=6
--------------+-------+-----+----
and as synonyms (for compatibility with other xbase languages):
   "2"        =>  "I", 2, 0  (FlagShip)
   "4"        =>  "I", 4, 0  (FlagShip)
   "8", 8,<m> =>  "B", 8,<m> (FlagShip)
   "Y"        =>  "I", 8, 4  (Currency, VFP)
   "F",<n>,<m>=>  "N",<n>,<m>(DBASE)

there are also two types which are not suppoted by Harbour VM and mapped
to numeric values:
   "@", 8, 0  => "I", 8, 0 => DAYTIME, 2 * BIN32 LE, julian's day and millisec
   "T", 4, 0  => "I", 4, 0 => TIMESTAMP, BIN32 LE, millisec
xHarbour's VM supports DAYTIME type but Harbour doesn't yet but it's
less problem now - when DAYTIME will be supported by HVM then adding
valid mapping will not take more then few minutes.

Harbour recognize and can open tables with VFP system column: "_NullFlags"
with NULL and VARLENGTH bits but it does not support them later and not
update this column. Adding support for NULL flag may be a little bit
problematic because our HVM/Clipper does not support such idea. We can
make some tricks with mapping to NIL or only add functions to check NULL
flag directly in table without NULL variables. We can also introduce real
NULL flag to HVM.
Here is my first QUESTION:
   (1) Should we add real NULL flag support to HVM?

The VFP VARLENGTH fields can store strings from 0 to 255 bytes.
It works like normal character field ("C") but size of string is
stored too and later strings read from such fields keep original
size in supported range (0:255). _NullFlags column keeps bit with
information about using whole field area (in such case byte with
string length is not stored in filed)
In DBF header field is marked as "V" like VARIABLE SIX3 fields but
because DBFs have different signature (0x30/0x31) then we can recognize
them on open. But we will have to add representation for this field
in DBCREATE(). Of course we can keep "V" and depending on
   rddInfo( RDDI_TABLETYPE ) -> DB_DBF_STD or DB_DBF_VFP
recognize it as SIX3 "V" or VFP "V" but IMHO it will confuse users
and we should make it in different way.

VFP and some other xbase languages supports also AUTOINCREMENT field:
   "+", 4, 0  => BIN32 LE
and this type can be easy added too. It was even done by Vicente Guerra
in xHarbour as "A" type but because implementation begins to use
DBFIELDINFO.uiTypeExtended then I asked him to revert this modification
until we agree common for all RDDs DBCREATE() structure and low level
representation. It was over one and half year ago - sorry Vic that you
have been waiting for such long time - my fault.

The columns in DBF can have also additional attributes like:
system/hidden, nullable, binary, compressed, encrypted, varlength.
We will have to define how to support these attributes in DBCREATE()
array and then represent them in low level C code.
Now in ADS RDDs additional field types are descirbed using character
long names as field type, these are:

   "RAW"        => "C" + BINARY flag
   "VARCHAR"    => SIX3 "V"
   "BINARY"     => "M" + BINARY flag
   "IMAGE"      => "M" + BINARY flag (IMAGE flag?)
   "SHORTDATE"  => SIX3: "D", 3, 0 or BIN32 LE: "D", 4, 0
   "INTEGER"    => "I", 4, 0
   "SHORTINT"   => "I", 2, 0
   "DOUBLE"     => "B", 8, n
   "TIME"       => "T", 4, 0
   "TIMESTAMP"  => "@", 8, 0
   "AUTOINC"    => "+", 4, 0
   "CURDOUBLE"  => "Y", 8, 4

Depending on type of table (DBF/ADT) internal ADS/ACE logic can
make some translations for above types but it's out of our control.
So now ADS users are passing to dbCreate() structure array which
can look like:
   { { "F1", "C",         10, 0 },;
     { "F2", "DOUBLE",     8, 2 },;
     { "F3", "INTEGER",    4, 0 },;
     { "F4", "SHORTDATE",  8, 2 },;
     { "F5", "AUTOINC",    4, 0 },;
     { "F6", "L",          1, 0 } }

For low level representation ADS RDDs use uiTypeExtended member of
DBFIELDINFO structure putting inside ADS_* integer number which
describes field type (this was the source of potential conflicts
between ADS and VIC DBF autoinc implementation)
It's a working solution used by ADS users for many years (so it
will be hard to change it - even if we define new format for
table structure than ADS will have to support above) but not
perfect: it's not compatible with other RDDs and it does not
resolve problem with field flags.
If we will try to used field type like in ADS also for flags
then we will have really long description, hard to parse and
use, f.e.:
   "MEMVAR_COMPRESSED_ENCRYPTED_BINARY"
so IMHO it's not real solution.
In new FlagShip versions the first letter of field type is table
field type and next ones are flags, f.e. for above we will have:
   "MCEB"
This seems to be much better solution for me and probably is less
intrusive for existing code.

We can also add additional columns to dbStructur() array.
In such way works CLIP (www.itk.ru) where 5-th column has logical
value with BINARY flag and 6-th  logical value with NULLABLE flag.
The bad thing with above is that when we will want to add other
flags the structure array will grow up and finally it will be
too huge to easy manage it.

We can also make sth between FlagShip and CLIP. We can extend
structure array but add only one 5-th character column with
flags described like in FlagShip. Alternatively it can be numeric
column with bit field for different flags.
This also seems to be reasonable solution.

If you have any other propositions then I'd like to hear about them.

Please think about it. We have to chose sth and we cannot leave
it as is because each RDD developer will have to chse sth himself
creating incompatible solution strongly oriented to databse
supported by RDD (f.e. current ADS RDDs). So it's real problem.

My second QUESTION:
   (2) What structure should we chose for dbCreate()/dbStruct() array?


Finally I'd like to talk about low level representation for field
structure. Now we are using this structure:

typedef struct
{
   BYTE *   atomName;         /* FIELD (symbol) name */
   HB_TYPE  uiType;           /* FIELD type */
   USHORT   uiTypeExtended;   /* FIELD type extended */
   USHORT   uiLen;            /* Overall FIELD length */
   USHORT   uiDec;            /* Decimal places of numeric FIELD */
} DBFIELDINFO;

atomName, uiLen, uiDec do not need any additional comments.
uiTypeExtended is not use by core code, it's for RDD internals.
uiType is field type which stores HB_IT_* value - the same as
used for item type. 
This is in practice the same structure and description as in Clipper.

We have two problems.
1. Where we should keep field flags?
   With some small number of flags we can define new types but if
   we want to create universal, common for all RDDs structure then
   we cannot define field types with all possible flag combinations.
2. Using HB_IT_* values as field type causes problems because some
   databases can support some types which are not supported by our
   HVM though they can be mapped to other types and used with some
   online translation. It's also possible that our HVM types will
   conflict with the database ones. F.e. in xHarbour HB_IT_DATE is
   used for DATE, DAYTIME and TIMESTAMP when in most databases these
   are separated types. It causes that Miguel added to xHarbour
   HB_IT_DATETIME, HB_IT_TIMESTAMP which are not HVM item types but
   they are used only in DBF RDD as marker for field types. He also
   added HB_IT_OLE and HB_IT_PICTURE for "G" and "P" VFP DBF fields
   but OLE and PICTURE are normal binary memo fields so they are rather
   MEMO field attributes which informs about preferable field contents
   then separate field type. To avoid such strange "extensions" which
   sooner or later will be in conflict with HVM I'd like to replace
   HB_IT_* values in uiType by HB_FT_* ones which will be only for
   RDD use.

In summary I'd like two sets with HB_FT_* (Field Type) and HB_FF_*
(Field Flag) definitions. Store HB_FT_* in uiType and find a place
for HB_FF_*. We can use uiTypeExtended as holder or we can add new
member to DBFIELDINFO, f.e.: USHORT uiFlags.
Personally I vote for new field for two reasons:
1. it will not increase DBFIELDINFO structure because current
   architecture uses 4 or more bytes alignment
2. uiTypeExtended was defined as private RDD field and it can be used
   by 3-rd party RDDs. If we change it then it's possible that we will
   force some serious modifications in their code.

At this moment I think we will need the following field types and flags:
(on the ride side proposed letters)

   HB_FT_STRING      "C"
   HB_FT_LOGICAL     "L"
   HB_FT_DATE        "D"
   HB_FT_LONG        "N"
   HB_FT_INTEGER     "I"
   HB_FT_DOUBLE      "B"
   HB_FT_MEMO        "M"
   HB_FT_ANY         "V"
   HB_FT_TIME        "T"
   HB_FT_DAYTIME     "@"

   HB_FF_HIDDEN      "H"
   HB_FF_NULLABLE    "N"
   HB_FF_BINARY      "B"
   HB_FF_COMPRESSED  "C"
   HB_FF_ENCRYPTED   "E"

Four additional can be flag for existing types or separated types, we can
also add the to both sets, f.e.:

   HB_FT_VARLENGTH   "S"
   HB_FT_AUTOINC     "+"
   HB_FT_IMAGE       "P"
   HB_FT_OLE         "G"

   HB_FF_VARLENGTH   "V"
   HB_FF_AUTOINC     "+"
   HB_FF_IMAGE       "P"
   HB_FF_OLE         "G"

We can define HB_FT_* as continuous numbers and the add sth like:
   #define HB_FT_USER     1024
to reserve first 1024 types for our own use so user defined types
should starts from HB_FT_USER.


My third QUESTION is:
   (3) What structures/types should we use for internal RDD field
       representation?

Please think about it. It's 3-rd time as I'm sending similar letter
to [x]Harbour devel list. This time I'd like to receive answers and
chose sth for the future so please present your opinions.

I'm also very interested in 3-rd party developers opinions. I hope
that authors of two most popular ones; Jacek Potempa (MEDIATOR) and
Marcelo Lombardo (SQLRDD) will send them here. These RDDs are not DBF
oriented so your suggestions can be very important for us. If will not
take a part in this discussion then you will have to accept sth what
we will chose ourself and what can cause problems for you or will not
address some issues you want to resolve.

best regards,
Przemek

PS. There is still open question about defining common for RDD
    open/connection string which can be used in dbUseArea()
From philb at philb.us  Sat Sep  1 10:19:17 2007
From: philb at philb.us (Phil Barnett)
Date: Sat Sep  1 10:19:32 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070901114750.GB9374@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
Message-ID: <200709011019.17282.philb@philb.us>

On Saturday 01 September 2007, Przemyslaw Czerpak wrote:
> If you have any other propositions then I'd like to hear about them.
>
> Please think about it. We have to chose sth and we cannot leave
> it as is because each RDD developer will have to chse sth himself
> creating incompatible solution strongly oriented to databse
> supported by RDD (f.e. current ADS RDDs). So it's real problem.

It's difficult to retain the existing header structure and realize all of 
these things. We could extend the header to have two sections for each field 
instead of one, but we'd have to teach the code how to understand it.

Are you proposing we always follow the existing header structure?

It would be trivial to modify the header structure to accomodate these 
changes, but that would lead to new and non backward compatible RDD's.. I'm 
not sure that is a problem, though.

-- 
Phil Barnett
AI4OF
SKCC #600
From druzus at priv.onet.pl  Sat Sep  1 10:48:19 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sat Sep  1 10:48:26 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <200709011019.17282.philb@philb.us>
References: <20070901114750.GB9374@localhost.localdomain>
	<200709011019.17282.philb@philb.us>
Message-ID: <20070901144819.GA11408@localhost.localdomain>

On Sat, 01 Sep 2007, Phil Barnett wrote:
> It's difficult to retain the existing header structure and realize all of 
> these things. We could extend the header to have two sections for each field 
> instead of one, but we'd have to teach the code how to understand it.
> Are you proposing we always follow the existing header structure?

Seems that I was not clear enough.
I was not talking about low level DBF structures. In fact all field
types I described are supported by different DBF driver implementations
and it's not necessary to define new structures for them - it's enough
to use exiting and documented ones. Most of these fields are already
supported by Harbour now. Only few don't because to add support for
them I will have to change the format of array used by dbCreate()/dbStruct()
and/or change some low level representation of field in Harbour RDD core
code (DBFIELDINFO is internal Clipper/Harbour structure not DBF structure).
And now I want to chose format which can be accepted by different RDDs:
DBF oriented (DBFNTX, DBFCDX,...), ADS based (ADSCDX, ADT, ...), SQL based
(MEDIATOR, SQLRDD, ...) and other if any to cover as most as possible
variants and not touch this code in the future. I'm, talking _ONLY_ about
Harbour internal code not about structures in files used by other systems.

> It would be trivial to modify the header structure to accomodate these 
> changes, but that would lead to new and non backward compatible RDD's.. I'm 
> not sure that is a problem, though.

It's not technical problem to do sth. I can make and commit all
necessary modifications even today adding also support for new
fields like AUTOINCREMENT to DBF* RDDs. It's really trivial job.
But this modification will force updating 3-rd party RDD code.
So I want to discuss it here and chose variant acceptable for all
RDD developers and easy to extend by simple adding new types so we
will not return to this problem in the future. I also want to keep
RDD as real REPLACEABLE DD - it means that all RDDs should use
common convention for dbCreate()/dbStruct() arrays or each of us
will have to encode in our programs different versions for different
RDDs. Just like now for ADS and DBF. Nearly all extended ADS types
are supported by our native DBF drivers but for ADS people have to
use different array to describe table structure so it's not possible
to easy replace RDD in places where we should not have any problems.

best regards,
Przemek
From philb at philb.us  Sat Sep  1 11:00:10 2007
From: philb at philb.us (Phil Barnett)
Date: Sat Sep  1 11:00:27 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070901144819.GA11408@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
	<200709011019.17282.philb@philb.us>
	<20070901144819.GA11408@localhost.localdomain>
Message-ID: <200709011100.10776.philb@philb.us>

On Saturday 01 September 2007, Przemyslaw Czerpak wrote:
> Seems that I was not clear enough.

Or I'm too dense. I was just thinking of the headers.

Thanks for the clarification.

-- 
Phil Barnett
AI4OF
SKCC #600
From ptucker at sympatico.ca  Sat Sep  1 12:56:57 2007
From: ptucker at sympatico.ca (Paul Tucker)
Date: Sat Sep  1 12:57:31 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
References: <20070901114750.GB9374@localhost.localdomain>
	<Pine.LNX.4.58.0709010839260.8888@casa.guerra.com.mx>
Message-ID: <010e01c7ecb9$20c53b10$6a00a8c0@PAUL>

Vicente,

??>> Here is my first QUESTION:
 ??>>    (1) Should we add real NULL flag support to HVM?

 VG>     How different is NIL type from NULL type?

I hope I remember this correctly - as was described by Nantucket developers 
many moons ago:
(but in simpler terms)
The character type is defined as the range of values between "a-z"
the numeric type is defined as the range of values between 0-9
the NIL type is defined as the sole value NIL

Some argument can be made for having a NULL<->NIL translation when dealing 
with a table, but I don't think you would want to extend that into the 
language any further than that.

It's possible to have NULL values or NULL pointers, but in a dbf that is 
hard to represent, since in a fixed length record, you either have an empty 
representation of the inherent field type, or you have an actual value.  In 
SQL and other formats, a distinction can be made between these values.  (or 
more precisely, this value and this non-value)

I could see there being a representation of an empty date in a table, or a 
NULL value as a representaion of certain states of date types: fe: ' 
' is a null date '0000000000' is an empty one. (not how it really works, 
just a simulation).  One indicates perhaps that no date was entered, the 
other that 'no date' was chosen from a drop down (<none>).

NULL is not a value at all.

In prg code you can ask 'if myvalue == NIL'?, but for SQL, that's not a 
valid statement.  it's 'if IsNull(myvalue)'

HTH

Paul

From druzus at acn.waw.pl  Sun Sep  2 09:29:27 2007
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Sep  2 09:29:35 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <010e01c7ecb9$20c53b10$6a00a8c0@PAUL>
References: <20070901114750.GB9374@localhost.localdomain>
	<Pine.LNX.4.58.0709010839260.8888@casa.guerra.com.mx>
	<010e01c7ecb9$20c53b10$6a00a8c0@PAUL>
Message-ID: <20070902132927.GB15943@localhost.localdomain>

On Sat, 01 Sep 2007, Paul Tucker wrote:
> ??>> Here is my first QUESTION:
>  ??>>    (1) Should we add real NULL flag support to HVM?
>  VG>     How different is NIL type from NULL type?
> I hope I remember this correctly - as was described by Nantucket developers 
> many moons ago:
> (but in simpler terms)
> The character type is defined as the range of values between "a-z"
> the numeric type is defined as the range of values between 0-9
> the NIL type is defined as the sole value NIL
> 
> Some argument can be made for having a NULL<->NIL translation when dealing 
> with a table, but I don't think you would want to extend that into the 
> language any further than that.
> 
> It's possible to have NULL values or NULL pointers, but in a dbf that is 
> hard to represent, since in a fixed length record, you either have an empty 
> representation of the inherent field type, or you have an actual value.  In 
> SQL and other formats, a distinction can be made between these values.  (or 
> more precisely, this value and this non-value)
> 
> I could see there being a representation of an empty date in a table, or a 
> NULL value as a representaion of certain states of date types: fe: ' 
> ' is a null date '0000000000' is an empty one. (not how it really works, 
> just a simulation).  One indicates perhaps that no date was entered, the 
> other that 'no date' was chosen from a drop down (<none>).
> 
> NULL is not a value at all.
> 
> In prg code you can ask 'if myvalue == NIL'?, but for SQL, that's not a 
> valid statement.  it's 'if IsNull(myvalue)'
> HTH

Many thanks for these informations. Just now some clarification.
NULL is variable attribute not a value. F.e. NULL string is
still normal string which can be used in any string operation
as any other string. NULL flag informs only that the string
was initialized with some default value. You can check it using
some special function usually called ISNULL(), f.e. ISNUL( cVal )
In fact such value does not have to be empty (usually is). Some
DBMS allows to set default value for column and when new record
is added this default value has NULL attribute. So sometimes you
may think about it like DEFAULT.
Now we have similar flag used with string items. It's MEMO flag
and informs that character value was read from memo field.
NULL flag can be used with any type of value and informs that
it's default field value so the field from which the value was
read was never assigned by user.
If we add NULL support to HVM then it will be implemented in
similar to MEMO flag way. If we do not add it to HVM then
we can still support it by adding function like:
   FIELDISNULL( <cFieldName> )
we can also add PP rule or even add hack to compiler and macrocompile so:
   ISNUL( fName )
will be translated to:
   FIELDISNULL( "fName" )
In such case without NULL support in HVM people can use ISNUL() like
in other languages.


The representation of NULL in different tables is less important
and it doesn't metter it will be DBF format or any other f.e. BTREEs
used by most of DBMS (SQL is not database format but languge to
operate on databases, the low level database format is unimportant - it
could be also DBF).

If we you are interested then I know at least two methods of
representing NULL values in DBF.
1. chose some value to represent NULL
   this is quite efficient method buy has two side effects:
   1. it reduces range of supported values in character and binary integer
      fields because one of possible values has to be chosen to represent
      NULL. Usually as character NULL value string with CHR(0) is chosen
      (in field access operation is dynamically replaced to string with
      spaces) to keep default value and as binary numeric value INT_MIN,
      f.e. for {"I",1,0} it's INT8_MIN => -128 (on access is replaced by 0)
   2. It needs fixed default value for column (this is usually less important
      but some DBMS allows to change default value for newly added column
2. keep information about NULL flag in additional hidden column. We need
   only 1 bit for such flag so in one byte we can keep flags for 8 columns
   Sth like that makes VFP adding system hidden column called: "_NullFlags"
   [x]Harbour DBF* RDDs recognize this column and can open tables with it
   (the column is not visible for .prg users) but we do not support any
   operation on it yet. This method does not have above limitation but
   increase a little bit record size.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Sep  2 09:49:42 2007
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Sep  2 09:50:38 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs --
	NULL
In-Reply-To: <014f01c7ecec$ad4b51e0$0301a8c0@bh>
References: <20070901114750.GB9374@localhost.localdomain>
	<014f01c7ecec$ad4b51e0$0301a8c0@bh>
Message-ID: <20070902134942.GC15943@localhost.localdomain>

On Sat, 01 Sep 2007, bhays wrote:
> FYI, the ADS folks are putting energy back into the xBase
> approach to things. For a while they were pushing SQL, and are
> still furthering their SQL support, but they're also recognizing
> their market position relative the Sybase SQLAnywhere product,
> so they're doing more xBase development again.
> In particular, they are aiming for more complete VFP compatibility.
> Bottom line: If there are any particular issues you'd like
> their input on, I can forward it to their developers.

Thank you very much.
I think that we can ask them about features which can be set in table
structure array for ADS. So far we are talking only about field types
and attributes. But there are also some other things like trigger
functions, validate functions, default values, etc. Maybe they already
created some structure to describe all of them.

> >>   (1) Should we add real NULL flag support to HVM?
> The rest of this msg just clarifies ADS null issues followed
> by my comments.  I'll respond to the other field type issues separately.
> The Advantage implementation of NULL field "values" (I liked
> Paul's description as a "non-value") has several behaviors
> that go beyond our NIL concept.  Of course, they only support it
> in ADT tables, not DBF.
> ADT tables provide standard SQL NULL support.
> Note:
> "Any field data type may contain a NULL except for an ADS_AUTOINC field."
> And "be aware of with indexes and NULL values. When an index is built on a
> field, the records that contain NULL values will be sorted first."
> Since any value added to NULL is NULL, any compound index keys
> (lastname+firstname) for records where the first field has a valid value but
> the second field is NULL therefore resolve to NULL completely and jump to
> the top (IOW lastname is ignored if firstname is NULL). To avoid this
> behavior they have the ";" operator instead of "+" for compound index
> expressions.

We do not have to replicate such behavior. NULL value can be used as
value attribute without any other side effects (just like I described
in message to Paul). Of course if we decide to add full support for NULL
to HVM then we can change some operation on NULL values but I do not think
it's good idea because the above ADS behavior is causes only troubles for
users.

> I've found it's important with ADT tables to ALWAYS use ";" in
> indexes to avoid unexpected behaviors.

OT: I plan to add optional support for ";" as concatenating
    operator in index expression so it will be possible to ues it
    also in DBF* RDDs.

> When NULL fields are READ, the empty value for that type is returned -- NOT
> NULL.
> So similar to Paul's point on isnull():
> "AdsIsEmpty can be called to determine if the field contains a NULL value
> rather than the value returned. When using an SQL query, the IFNULL or
> ISNULL scalar function can be called to determine if the field contains a
> NULL value."
> So my first thought is that any implementation of NULL should purposely
> AVOID any connection or mapping to NIL.
> The probability of confusion is so high, it should be documented throughout
> that they are separate animals, and there should be no attempt to have hvm
> "nil" become or be related to NULL values.
> For my part, VFP-compatible implementation in dbfs makes the most sense to
> me.
> As for the HVM, if your feeling is that that is the only correct way to do
> it, and the alternatives are something of a hack, then I'd vote for doing it
> right.
> HOWEVER if go with the idea that "NULL is not a value at all", and if we go
> with ADS's usage where READing a null value field still returns an empty
> value of the real type -- and NULL is determined by a function call -- then
> an HVM item with type NULL may not be needed.

I hope that in my replay to Paul's message I explain more precisely what
we can do. It's not important for me to have real NULL support in HVM.
But if you will want to emulate ADS like behavior, f.e.:
    NULL_STRING + STRING => NULL_STRING
then it will be possible only with full NULL support in HVM.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Sep  2 10:30:17 2007
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Sep  2 10:31:57 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <015001c7ecf2$0fabb320$0301a8c0@bh>
References: <20070901114750.GB9374@localhost.localdomain>
	<015001c7ecf2$0fabb320$0301a8c0@bh>
Message-ID: <20070902143017.GD15943@localhost.localdomain>

On Sat, 01 Sep 2007, bhays wrote:
> > So now ADS users are passing to dbCreate() structure array which can look
> > like:...
> Just a reminder that with v.8.1 ADS added the "Numeric" type directly,
> whereas in the past "N" got mapped to a different integer or double type.  I
> never implemented a backward-compatible "fix" to this as it seemed it would
> cause as many problems as it would solve. I think that just remains as a
> tech support issue for anyone creating ADT files using "N" in old code
> instead of one of the more specific types.

I remember about it. I think that we should change our ADT RDD code to work
in the same way with different ADS versions. Now depending on ADS server
version different tables are created and IMHO it's wrong and can be source
of problems.

> > For low level representation ADS RDDs use uiTypeExtended member of
> DBFIELDINFO structure putting inside ADS_* integer number which describes
> field type (this was the source of potential conflicts between ADS and VIC
> DBF autoinc implementation)
> I can help do whatever workarounds we may need to support old code plus the
> new system.  I think an RDD all-inclusive compatible top layer of all field
> types (to get mapped to each specific rdd field as needed) is important.
> 
> >    "MEMVAR_COMPRESSED_ENCRYPTED_BINARY"
> > so IMHO it's not real solution.
> I agree.
> 
> > In new FlagShip versions the first letter of field type is table field
> > type and next ones are flags, f.e. for above we will have:   "MCEB" This
> > seems to be much better solution for me and probably is less intrusive for
> > existing code.
> OK.
> 
> > We can also make sth between FlagShip and CLIP. We can extend structure
> > array but add only one 5-th character column with flags described like in
> > FlagShip. Alternatively it can be numeric column with bit field for
> > different flags.
> > This also seems to be reasonable solution.
> 
> This sounds better to me.
> MEMVAR+COMPRESSED+ENCRYPTED+BINARY

With 5-th column we can implement both: character and numeric attributes -
dbcreate() will translate them to numeric values so RDD code will not have
to know about it.

> > If you have any other propositions then I'd like to hear about them.
> One way or another, it seems we need a list of flags.  Are they always just
> logical flags or are there any properties that require some value?  If it
> really is just flags, the bit fields seems appropriate. We could have
> constants for the most common combinations, and people could do the
> addition/bitAnd operations for more complex types.

So far I'm talking about logical attributes.
There are also some other things like default field value, range description,
validate functions, trigger functions, etc. 

> >   (2) What structure should we chose for dbCreate()/dbStruct() array?
> I'm not sure if I missed something. It seems to me to have become just an
> added 5th column storing a number/bitfield?
> 
> > Finally I'd like to talk about low level representation for field
> > structure. Now we are using this structure:
> > We have two problems.
> > 1. Where we should keep field flags?
> Types should be only the largest, most "integral" types -- not combinations.
> As we found with "Numeric", any string starting with "N" pretty much works
> in clipper, so going beyond one char is problematic.
> And of course with just one char we're running out of values soon.

OK.

> >.... To avoid such strange "extensions" which
> >   sooner or later will be in conflict with HVM I'd like to replace
> >   HB_IT_* values in uiType by HB_FT_* ones which will be only for
> >   RDD use.
> Sounds good to me.
> 
> > In summary I'd like two sets with HB_FT_* (Field Type) and HB_FF_* (Field
> > Flag) definitions. Store HB_FT_* in uiType and find a place for HB_FF_*. We
> > can use uiTypeExtended as holder or we can add new member to DBFIELDINFO,
> > f.e.: USHORT uiFlags. Personally I vote for new field for two reasons:
> Sounds good to me.  As for the list of types, should we consider the special
> needs of "Currency" ?

There are two methods of representing currency: as double and as i64.
"Y" in DBF means currency as it's i64 value. In ADS it's "Money"
I do not know what is the difference between CurDouble and Double
fields in ADS and why they have two separated types for them.

> Here's the current list of ADT field types. Newer special ones are
> CICharacter (case insensitive), CurDouble,

Does ADS make any conversions (upper/lower) on values assinged to CICharacter
fields?
Is this attribute used in index expression or automatic conversion
(upper/lower) causes that is not necessary to respect it?

things like IGNORE CASE, UPPER, LOWER can be field attributes.

> ModTime - automatically updated with current date/time when a record is
> updated;
> and Rowversion - automatically incremented when a record is updated for
> purpose of "isChanged" flag.

Nice features - I like them so in some spare time I'll add them to DBF*
RDDs.

> Character
> CICharacter
> Date
> Logical
> Memo
> Double
> Integer
> Numeric
> Image
> Binary
> ShortInteger
> Time
> TimeStamp
> AutoIncrement
> Raw
> CurDouble
> Money
> ModTime
> RowVersion
> 
> I attached a little spreadsheet from their HLP file in case it helps to
> check their details.

Thank you.

best regards,
Przemek
From ptucker at sympatico.ca  Sun Sep  2 11:25:21 2007
From: ptucker at sympatico.ca (Paul Tucker)
Date: Sun Sep  2 11:25:45 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
References: <20070901114750.GB9374@localhost.localdomain><Pine.LNX.4.58.0709010839260.8888@casa.guerra.com.mx><010e01c7ecb9$20c53b10$6a00a8c0@PAUL>
	<20070902132927.GB15943@localhost.localdomain>
Message-ID: <040a01c7ed75$7a62a470$6a00a8c0@PAUL>

Przemek,

 PC> If we you are interested then I know at least two methods of
 PC> representing NULL values in DBF.
 PC> 1. chose some value to represent NULL
 PC>    this is quite efficient method buy has two side effects:
 PC>    1. it reduces range of supported values in character and binary
 PC> integer fields because one of possible values has to be chosen to
 PC> represent NULL. Usually as character NULL value string with CHR(0) is
 PC> chosen (in field access operation is dynamically replaced to string 
with
 PC> spaces) to keep default value and as binary numeric value INT_MIN,
 PC>       f.e. for {"I",1,0} it's INT8_MIN => -128 (on access is replaced
 PC> by 0)
 PC>    2. It needs fixed default value for column (this is usually less
 PC> important but some DBMS allows to change default value for newly added
 PC> column 2. keep information about NULL flag in additional hidden column.
 PC> We need only 1 bit for such flag so in one byte we can keep flags for 8
 PC> columns
 PC>  Sth like that makes VFP adding system hidden column called:
 PC> "_NullFlags"    [x]Harbour DBF* RDDs recognize this column and can open
 PC> tables with it
 PC>    (the column is not visible for .prg users) but we do not support any
 PC>    operation on it yet. This method does not have above limitation but
 PC>    increase a little bit record size.

If we treat NULL as an attribute, then there is no problem with choosing a 
value to represent it.  The field is NULL and any operation that involves it 
results in NULL.  A field can have an attribute of 'Default' as well, and if 
you want to use the same flag for this indication, then that can work, but 
don't try to mix the 2 (IMO).  What I mean is, income can't be $100 and NULL 
as well.

If a field does not have the 'NULL'able flag, and you add a record without 
supplying this data, the add is not allowed - unless it also has the 
'default' flag.

Something like NULL_STRING is supported in VO, but this is partly due to its 
strong typing.  A NULL_STRING assigned to a usual is NIL.  (I suppose we 
could still make the distinction in the ITEM.)

Using an Oracle table - any reference to a column that contains NULL values 
in the selection  results in those records to be excluded.

'Select * from customer where address (> "", or < ""  f.e.)' results in all 
non-null address records to be included. while 'Select * from customer where 
address is NULL' gives the others.  and finally, 'select * from customer' 
gives all records.

This all may be obvious.

Paul

From ptucker at sympatico.ca  Sun Sep  2 18:40:12 2007
From: ptucker at sympatico.ca (Paul Tucker)
Date: Sun Sep  2 18:40:37 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
References: <20070901114750.GB9374@localhost.localdomain><Pine.LNX.4.58.0709010839260.8888@casa.guerra.com.mx><010e01c7ecb9$20c53b10$6a00a8c0@PAUL><20070902132927.GB15943@localhost.localdomain>
	<040a01c7ed75$7a62a470$6a00a8c0@PAUL>
Message-ID: <052b01c7edb2$3975ede0$6a00a8c0@PAUL>

minor correction:

 PT> 'Select * from customer where address (> "", or < ""  f.e.)' results in
 PT> all non-null address records to be included.

What I meant is:

'Select * from customer where address (> "", or < ""  f.e.)' results in

From ptucker at sympatico.ca  Sun Sep  2 18:43:46 2007
From: ptucker at sympatico.ca (Paul Tucker)
Date: Sun Sep  2 18:44:10 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
References: <20070901114750.GB9374@localhost.localdomain><Pine.LNX.4.58.0709010839260.8888@casa.guerra.com.mx><010e01c7ecb9$20c53b10$6a00a8c0@PAUL><20070902132927.GB15943@localhost.localdomain>
	<040a01c7ed75$7a62a470$6a00a8c0@PAUL>
Message-ID: <053201c7edb2$b93a8450$6a00a8c0@PAUL>

(once more)

'Select * from customer where address < "" ' gives you no records (nulls 
excluded)

'Select * from customer where address > "" ' gives what you would expect 
(also nulls excluded)

The problem with allowing 'defaults' is you then need to store the actual 
default somewhere!

Paul 

From bhays at abacuslaw.com  Sun Sep  2 22:18:39 2007
From: bhays at abacuslaw.com (bhays)
Date: Sun Sep  2 22:19:57 2007
Subject: [Harbour] RE: [xHarbour-developers] Extended field types in RDDs --
	NULL
In-Reply-To: <20070902134942.GC15943@localhost.localdomain>
Message-ID: <002601c7edd0$bda2ebe0$0301a8c0@bh>

Przemek:

>>I hope that in my replay to Paul's message I explain more precisely what
   we can do. It's not important for me to have real NULL support in HVM.
   But if you will want to emulate ADS like behavior, f.e.:
       NULL_STRING + STRING => NULL_STRING
   then it will be possible only with full NULL support in HVM.

I don't feel that behavior is important for us; I just wanted it on the
table
as one thing one of our RDDs has to contend with.

I think it would be good to support null as a field property, not a variable
property.
(I might have read too much into your reference to an hvm change--if you
meant only
that such a change might be necessary just to support field references but
still
keep it scoped to just fields, then ignore this paragraph).
The tradition of NIL in the xBase languages is clear; adding the possibility
or
need to test for isnull seems like a problem.
So if the null *field* processing can happen without the hvm change,
that sounds good.


--
  Brian Hays



From bhays at abacuslaw.com  Sun Sep  2 22:30:53 2007
From: bhays at abacuslaw.com (bhays)
Date: Sun Sep  2 22:32:13 2007
Subject: [Harbour] RE: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070902143017.GD15943@localhost.localdomain>
Message-ID: <002701c7edd2$73843df0$0301a8c0@bh>

Przemek:
Regarding ADTs and Numeric types:

>>> ...using "N" in old code instead of one of the more specific types.
PC>I remember about it. I think that we should change our ADT RDD code to
work in the same way with different ADS versions. Now depending on ADS
server version different tables are created and IMHO it's wrong and can be
source of problems.

I'm happy to do a change, but I couldn't come up with a viable logic for it.
Unless we just go to a compiler switch or global setting which dictates
"old way or new way", which didn't sound good either.

My first thought -- to interpret just "N" as the old way (because that's
what
most old code *probably* used) and require "Numeric" for the new
true Numeric type -- isn't good enough.
If we accept this statement:
	For someone starting new and using ads 8.1,
	"N" should go straight to the Numeric type.
which makes sense to me, then "old code" will indeed have
to have the new behavior too unless there's some other
indicator to be v8.0 and earlier compatible.
So we're back to yet another switch.
BTW, the existing ads version directive isn't viable for
controlling this behavior for a lot of reasons.

--
  Brian Hays


> > For low level representation ADS RDDs use uiTypeExtended member of
> DBFIELDINFO structure putting inside ADS_* integer number which
> describes field type (this was the source of potential conflicts
> between ADS and VIC DBF autoinc implementation) I can help do whatever
> workarounds we may need to support old code plus the new system.  I
> think an RDD all-inclusive compatible top layer of all field types (to
> get mapped to each specific rdd field as needed) is important.
>
> >    "MEMVAR_COMPRESSED_ENCRYPTED_BINARY"
> > so IMHO it's not real solution.
> I agree.
>
> > In new FlagShip versions the first letter of field type is table field
> > type and next ones are flags, f.e. for above we will have:   "MCEB" This
> > seems to be much better solution for me and probably is less
> > intrusive for existing code.
> OK.
>
> > We can also make sth between FlagShip and CLIP. We can extend
> > structure array but add only one 5-th character column with flags
> > described like in FlagShip. Alternatively it can be numeric column
> > with bit field for different flags.
> > This also seems to be reasonable solution.
>
> This sounds better to me.
> MEMVAR+COMPRESSED+ENCRYPTED+BINARY

With 5-th column we can implement both: character and numeric attributes -
dbcreate() will translate them to numeric values so RDD code will not have
to know about it.

> > If you have any other propositions then I'd like to hear about them.
> One way or another, it seems we need a list of flags.  Are they always
> just logical flags or are there any properties that require some
> value?  If it really is just flags, the bit fields seems appropriate.
> We could have constants for the most common combinations, and people
> could do the addition/bitAnd operations for more complex types.

So far I'm talking about logical attributes.
There are also some other things like default field value, range
description, validate functions, trigger functions, etc.

> >   (2) What structure should we chose for dbCreate()/dbStruct() array?
> I'm not sure if I missed something. It seems to me to have become just
> an added 5th column storing a number/bitfield?
>
> > Finally I'd like to talk about low level representation for field
> > structure. Now we are using this structure:
> > We have two problems.
> > 1. Where we should keep field flags?
> Types should be only the largest, most "integral" types -- not
combinations.
> As we found with "Numeric", any string starting with "N" pretty much
> works in clipper, so going beyond one char is problematic.
> And of course with just one char we're running out of values soon.

OK.

> >.... To avoid such strange "extensions" which
> >   sooner or later will be in conflict with HVM I'd like to replace
> >   HB_IT_* values in uiType by HB_FT_* ones which will be only for
> >   RDD use.
> Sounds good to me.
>
> > In summary I'd like two sets with HB_FT_* (Field Type) and HB_FF_*
> > (Field
> > Flag) definitions. Store HB_FT_* in uiType and find a place for
> > HB_FF_*. We can use uiTypeExtended as holder or we can add new
> > member to DBFIELDINFO,
> > f.e.: USHORT uiFlags. Personally I vote for new field for two reasons:
> Sounds good to me.  As for the list of types, should we consider the
> special needs of "Currency" ?

There are two methods of representing currency: as double and as i64.
"Y" in DBF means currency as it's i64 value. In ADS it's "Money"
I do not know what is the difference between CurDouble and Double fields in
ADS and why they have two separated types for them.

> Here's the current list of ADT field types. Newer special ones are
> CICharacter (case insensitive), CurDouble,

Does ADS make any conversions (upper/lower) on values assinged to
CICharacter fields?
Is this attribute used in index expression or automatic conversion
(upper/lower) causes that is not necessary to respect it?

things like IGNORE CASE, UPPER, LOWER can be field attributes.

> ModTime - automatically updated with current date/time when a record
> is updated; and Rowversion - automatically incremented when a record
> is updated for purpose of "isChanged" flag.

Nice features - I like them so in some spare time I'll add them to DBF*
RDDs.

> Character
> CICharacter
> Date
> Logical
> Memo
> Double
> Integer
> Numeric
> Image
> Binary
> ShortInteger
> Time
> TimeStamp
> AutoIncrement
> Raw
> CurDouble
> Money
> ModTime
> RowVersion
>
> I attached a little spreadsheet from their HLP file in case it helps
> to check their details.

Thank you.

best regards,
Przemek


From bhays at abacuslaw.com  Sun Sep  2 22:47:41 2007
From: bhays at abacuslaw.com (bhays)
Date: Sun Sep  2 22:49:00 2007
Subject: [Harbour] RE: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070902143017.GD15943@localhost.localdomain>
Message-ID: <002801c7edd4$cbfeedc0$0301a8c0@bh>

Przemek:

> >So far I'm talking about logical attributes.
> >There are also some other things like default field value, range
description, validate functions, trigger functions, etc.

And FWIW ADS uses the external over-seeing Data Dictionary to handle all
these.

> >There are two methods of representing currency: as double and as i64.
> >"Y" in DBF means currency as it's i64 value. In ADS it's "Money"
> >I do not know what is the difference between CurDouble and Double
> >fields in ADS and why they have two separated types for them.

I'm guessing a bit hear, but I think CurDouble came first, as an attempt to
add the "currency" property to the Double value just by virtue of its type
name.
This may have been exploited by the data dictionary.

> >Does ADS make any conversions (upper/lower) on values assinged to
CICharacter fields?
No. It's a property of how the data is handled in expressions; any value can
still go into the data.:
"The case insensitive field type can be used when you do not want the case
of character data to affect filter expressions, SQL WHERE clauses, index
seeks, scalar functions, xbase expression engine functions, etc."

> >Is this attribute used in index expression
Yes, but it's controlled by settings for coercion types.
I pasted the HLP page below.


--
  Brian Hays


The case insensitive field type can be used when you do not want the case of
character data to affect filter expressions, SQL WHERE clauses, index seeks,
scalar functions, xbase expression engine functions, etc.
The case insensitive field type is called CICHAR when used via SQL, and
cicharacter when used with ARC or from ACE calls such as AdsCreateTable.
Consider the following example. If you have a table with the following
structure:

csfield	character	30
cifield	cicharacter	30
and the following data:

csfield	cifield
hello	hello
Hello	Hello
HELLO	HELLO
A filter of "csfield = 'hello'" and the SQL statement "SELECT * FROM table
WHERE csfield = 'hello'" would both return the following result set:

hello	hello
However, if you use the case insensitive column and a filter of "cifield =
'hello'" or the SQL statement "SELECT * FROM table WHERE cifield = 'hello'"
you would get the following result set:

hello	hello
Hello	Hello
HELLO	HELLO
Case insensitive fields also affect the behavior of scalar functions and
expression engine functions that operate on string values. For example, if
using the example dataset from above
   SELECT POSITION( 'lo' in cifield ) FROM table
will return a different result set than
   SELECT POSITION( 'lo' in csfield ) FROM table

Comparison Operators and Coercion

Comparison operators (such as =, <, >, etc) are also affected by the case
sensitivity of a field (as we saw in the first example).
Comparison operators use a field's collation language and its coercion type
to determine if the comparison is legal. A quick definition of each of these
terms will be necessary before discussing what comparisons are legal and
what comparisons are not legal.
Advantage currently supports two column-level collation languages (Note: we
are discussing column-level collation languages, Advantage supports many
different collation languages at the server level).

ads_default_cs		column-level collation language assigned to case
sensitive fields
ads_default_ci		column-level collation language assigned to case
insensitive fields
At first glance, this would mean in the following comparison
   cifield = csfield
the comparison operator (=) would not know how to compare the values. Should
it do a case insensitive comparison or a case sensitive comparison?
This is where coercion types enter the picture. Advantage uses 4 different
coercion types.

COERCION_EXPLICIT	Assigned when a value is explicitly coerced using
the COLLATE function or COLLATE clause (in SQL)
COERCION_IMPLICIT	Assigned to column references
COERCION_COMPATIBLE	Assigned to string literals
COERCION_NECESSARY	Assigned to a value that is the result of a function
that did not take any string input parameters but returned a string
Coercion types have precedence: COERCION_EXPLICIT takes precedence over
COERCION_IMPLICIT that takes precedence over COERCION_COMPATIBLE.
When comparing two operands they must have the same collation language. If
they don't, one operand must have a higher coercion type than the other. The
collation language of the operand with the highest precedence coercion type
will be used to perform the comparison operation.
In the example above (cifield = csfield) both operands have a coercion type
of COERCION_IMPLICIT, but have different collation languages. This
comparison is illegal. To correct the expression, one side must be
explicitly coerced.

Filter Expression:
cifield = collate( csfield, 'ads_default_ci' )

SQL Expression:
cifield = csfield COLLATE ads_default_ci


The examples above modify the right side operand to have a coercion type of
COERCION_EXPLICIT, forcing a case insensitive comparison of the two
operands.
Explicit coercions can be helpful if you have one case insensitive field
that you often compare with other case sensitive fields, but you do not want
to convert the other fields to be case insensitive as well.
Explicit coercions can also be used to change the case sensitivity of an
operator even when case insensitive fields are not being used. It is often
necessary to filter a dataset using a case insensitive search. The following
two SQL expressions are equivalent:

UPPER( csfield ) = 'SEARCHSTRING'
csfield = 'SEARCHSTRING' COLLATE ads_default_ci

Note  Comparisons performed by the Advantage expression engine and the
Advantage query engine will be case insensitive comparisons. Comparisons
performed in any client development environment will not, unless you use a
case insensitive comparison function in that environment.


From mhsabado at gmail.com  Mon Sep  3 02:35:28 2007
From: mhsabado at gmail.com (Mario H. Sabado)
Date: Mon Sep  3 02:35:50 2007
Subject: [Harbour] DbEval() Function Very Slow With Active Controlling Index?
In-Reply-To: <46dade21.2786460a.2122.1e82SMTPIN_ADDED@mx.google.com>
References: <46dade21.2786460a.2122.1e82SMTPIN_ADDED@mx.google.com>
Message-ID: <46DBAB30.5000405@gmail.com>


Hi,

As subject, please find below test code.

Thanks,
Mario


Function Test
   local x, cDTRFile, cFile := "logtest.txt"
   local aDtrStruct := { {"BIO_ID","C",5,0},;
                         {"LOG_DATE","C",10,0},;
                         {"LOG_TIME","C",5,0},;
                         {"LOG_TYPE","C",1,0},;
                         {"STATUS","C",1,0} }

      DBCreate("dtrtmp",aDtrStruct, ,.T.,"dtrtmp")
      index on 
dtrtmp->bio_id+dtos(ctod(dtrtmp->log_date))+dtrtmp->log_time to dtrtmp

//      FErase( cFile )

//      FOR x = 1 to 5000
//         StrFile( alltrim(str(x)) + " "+dtoc(date())+" 
"+substr(time(),1,5)+" 1 1" + HB_OsNewLine(),cFile, .T. )
//      NEXT

      append from (cFile) DELIMITED WITH BLANK

//      set order to 0  // uncommenting this line will make DbEval() 
speed normal

      DbEval({||dtrtmp->BIO_ID := padl(alltrim(dtrtmp->BIO_ID),5,"0" ) } 
)   // VERY slow here

return nil
From budyanto at centrin.net.id  Mon Sep  3 03:07:16 2007
From: budyanto at centrin.net.id (Budyanto Dj.)
Date: Mon Sep  3 03:07:33 2007
Subject: [Harbour] DbEval() Function Very Slow With Active Controlling
	Index?
In-Reply-To: <46DBAB30.5000405@gmail.com>
References: <46dade21.2786460a.2122.1e82SMTPIN_ADDED@mx.google.com>
Message-ID: <46DC1514.11044.E92C257@localhost>

Hi Mario,

While waiting for the answer from the experts, could you change the dbeval's block to the following:

i := 1
DbEval({||tracelog(i++, recno()), dtrtmp->BIO_ID := padl(alltrim(dtrtmp->BIO_ID),5,"0" ) } 

to see if recno() "jumps around" in your indexed case?
(That's what I expect from the parallel normal loop "do while !eof()...dbskip()...enddo")

Regards,
Budyanto


On 3 Sep 2007 at 14:35, Mario H. Sabado wrote:
	<mailto:harbour-request@harbour-project.org?subject=unsubscribe>
	<mailto:harbour-request@harbour-project.org?subject=subscribe>

> 
> Hi,
> 
> As subject, please find below test code.
> 
> Thanks,
> Mario
> 
> 
> Function Test
>    local x, cDTRFile, cFile := "logtest.txt"
>    local aDtrStruct := { {"BIO_ID","C",5,0},;
>                          {"LOG_DATE","C",10,0},;
>                          {"LOG_TIME","C",5,0},;
>                          {"LOG_TYPE","C",1,0},;
>                          {"STATUS","C",1,0} }
> 
>       DBCreate("dtrtmp",aDtrStruct, ,.T.,"dtrtmp")
>       index on 
> dtrtmp->bio_id+dtos(ctod(dtrtmp->log_date))+dtrtmp->log_time to dtrtmp
> 
> //      FErase( cFile )
> 
> //      FOR x = 1 to 5000
> //         StrFile( alltrim(str(x)) + " "+dtoc(date())+" 
> "+substr(time(),1,5)+" 1 1" + HB_OsNewLine(),cFile, .T. )
> //      NEXT
> 
>       append from (cFile) DELIMITED WITH BLANK
> 
> //      set order to 0  // uncommenting this line will make DbEval() 
> speed normal
> 
>       DbEval({||dtrtmp->BIO_ID := padl(alltrim(dtrtmp->BIO_ID),5,"0" ) } 
> )   // VERY slow here
> 
> return nil
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour



From mhsabado at gmail.com  Mon Sep  3 04:15:27 2007
From: mhsabado at gmail.com (Mario H. Sabado)
Date: Mon Sep  3 04:15:48 2007
Subject: [Harbour] DbEval() Function Very Slow With Active With Controlling
	Index?
In-Reply-To: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
Message-ID: <46DBC29F.4040600@gmail.com>

Hi Budyanto,

I tried your suggestion and the trace.log file had reached to almost 1GB size with the 5,000 rows of logfile I'm testing.  I could hardly open the trace log file from an editor either.  Although, I ran the test code with hbrun.exe and xbscript.exe.

Regards,
Mario


Date: Mon, 03 Sep 2007 14:07:16 +0700
From: "Budyanto Dj." <budyanto@centrin.net.id>
Subject: Re: [Harbour] DbEval() Function Very Slow With Active
	Controlling	Index?
To: "Harbour Project Main Developer List."
	<harbour@harbour-project.org>
Message-ID: <46DC1514.11044.E92C257@localhost>
Content-Type: text/plain; charset=US-ASCII

Hi Mario,

While waiting for the answer from the experts, could you change the dbeval's block to the following:

i := 1
DbEval({||tracelog(i++, recno()), dtrtmp->BIO_ID := padl(alltrim(dtrtmp->BIO_ID),5,"0" ) } 

to see if recno() "jumps around" in your indexed case?
(That's what I expect from the parallel normal loop "do while !eof()...dbskip()...enddo")

Regards,
Budyanto

From miguelangel at marchuet.net  Mon Sep  3 04:38:04 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Mon Sep  3 04:43:15 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070901114750.GB9374@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
Message-ID: <46DBC7EC.2000602@marchuet.net>

I'm working to implement flags over dbf not only NIL. But my time
is very limitted.

I've implemented autoincrement flag but not uploaded yet. in some formats it's a
flag as VFP in other dbf formats it's fieldtype.

xHarbour too reconices the next field types

--------------+-------+-----+----
LOW LEVEL ID  | PRGID | LEN | DEC
--------------+-------+-----+----
HB_IT_OLE     | "G"   | 10  | 0
HB_IT_PICTURE | "P"   | 10  | 0

this are not flags in VPF.

Is needed to implement import and export ole linked to a WINAPI. But by the moment
the types are recogniced.

example of use:

APPEND GENERAL GeneralFieldName [FROM FileName]
    [DATA cExpression] [LINK] [CLASS OLEClassName]

I think autoincrement is beeter wotk as flag in all numeric without decimals as in VFP.
and support + fieldtype too.

At dbcreate i'm working as i propouse in a previous message.

CREATE TABLE | DBF TableName1 [NAME LongTableName] [FREE]
     [CODEPAGE = nCodePage]
     ( FieldName1 FieldType [( nFieldWidth [, nPrecision] )] [NULL | NOT NULL]
     [AUTOINC [NEXTVALUE NextValue [STEP StepValue]]]

or

DbCreate( cTableName, {{FieldName1, FieldType1, nFieldWidth1, nPrecision1 [, lNull1][, NextValue1, StepValue1] },...},;
           [cDriver], [lNewArea], [cAlias], [nCodePage] )

CREATE TABLE MyGenTbl (mygenfield G)
APPEND BLANK  && Add a blank record
APPEND GENERAL mygenfield FROM C:\EXCEL\BOOK1.XLS CLASS EXCELCHART




we need the following field types and flags:
     HB_FT_STRING      "C"
     HB_FT_LOGICAL     "L"
     HB_FT_DATE        "D"
     HB_FT_LONG        "N"
     HB_FT_INTEGER     "I"
     HB_FT_DOUBLE      "B"
     HB_FT_MEMO        "M"
     HB_FT_ANY         "V"
     HB_FT_TIME        "T"
     HB_FT_DAYTIME     "@"
     HB_IT_OLE         "G"
     HB_IT_PICTURE     "P"
     HB_IT_BLOB        "W"
     HB_IT_CURRENCY    "Y"
     HB_IT_FLOAT       "F"
     HB_IT_VARBINARY   "Q"

     HB_FF_HIDDEN      0x01 // 0x01   System Column (not visible to user)
     HB_FF_NULLABLE    0x02 // 0x02   Column can store null values
     HB_FF_BINARY      0x04 // 0x04   Binary column (for CHAR and MEMO only)
                            // 0x06   (0x02+0x04) When a field is NULL and binary (Integer, Currency, and Character/Memo fields)
     HB_FF_AUTOINC     0x0C // 0x0C   Column is autoincrementing
     HB_FF_COMPRESSED  ?
     HB_FF_ENCRYPTED   ?


What about:

typedef struct
{
    BYTE *   atomName;         /* FIELD (symbol) name */
    HB_TYPE  uiType;           /* FIELD type */
    USHORT   uiTypeExtended;   /* FIELD type extended */
    USHORT   uiLen;            /* Overall FIELD length */
    USHORT   uiDec;            /* Decimal places of numeric FIELD */
    USHORT   uiFlags;          /* System, Null, binary and autoincrease flag */
} DBFIELDINFO;


Best regards
Miguel Angel Marchuet Frutos


Przemyslaw Czerpak escribi?:
> Hi All,
> 
> I've found a while to write some text about necessary modifications
> for common to all RDDs extended field support. It's an old problem
> still open and I think that it's time to resolve it.
> 
> 
> I'll begin with small presentation for already supported types and
> some other which exist in different DBF implementations supported
> partially or not supported yet by us.
> 
> 
> Legends:
>    BIN - binary
>    LE - little endian
>    DP - decimal point
> 
> Clipper supports the following DBF filed types:
> --------------+-------+-----+----
> LOW LEVEL ID  | PRGID | LEN | DEC
> --------------+-------+-----+----
> HB_IT_LOGICAL | "L"   | 1   | 0    //ASCII T/F Y/N value
> HB_IT_DATE    | "D"   | 8   | 8    //ASCII DTOS() value
> HB_IT_LONG    | "N"   | <n> | <m>  //ASCII <n> bytes number, <m> DP
> HB_IT_STRING  | "C"   | <n> | <m>  //len = <n> + 256 * <m>
> HB_IT_MEMO    | "M"   | 10  | 0    //ASCII MEMO block number
> --------------+-------+-----+----
> Now Harbour recognizes and suppots also:
> --------------+-------+-----+----
> HB_IT_INTEGER | "I"   | <n> | <m>  //BIN LE in <n>bytes, <m>:DP (<n>:1,2,3,4,8)
> HB_IT_DATE    | "D"   | 3   | 0    //BIN LE Julian's day
> HB_IT_DATE    | "D"   | 4   | 0    //BIN LE Julian's day
> HB_IT_MEMO    | "M"   | 4   | 0    //BIN LE MEMO block number
> HB_IT_MEMO    | "M"   | 10  | 0    //SMT MEMO SIG (BIN LE:block,size,type)
> HB_FT_DOUBLE  | "B"   | 8   | <m>  //IEEE754 LE double number, <m> DP
> HB_IT_ANY     | "V"   | 2   | 0    //SIX3 BIN16 LE (16 bit signed integer)
> HB_IT_ANY     | "V"   | 3   | 0    //SIX3 packed date - Sx_DToP()
> HB_IT_ANY     | "V"   | 4   | 0    //SIX3 BIN32 LE (32 bit signed integer)
> HB_IT_ANY     | "V"   | <n> | <m>  //SIX3 variable (weekly-typed) field <n>>=6
> --------------+-------+-----+----
> and as synonyms (for compatibility with other xbase languages):
>    "2"        =>  "I", 2, 0  (FlagShip)
>    "4"        =>  "I", 4, 0  (FlagShip)
>    "8", 8,<m> =>  "B", 8,<m> (FlagShip)
>    "Y"        =>  "I", 8, 4  (Currency, VFP)
>    "F",<n>,<m>=>  "N",<n>,<m>(DBASE)
> 
> there are also two types which are not suppoted by Harbour VM and mapped
> to numeric values:
>    "@", 8, 0  => "I", 8, 0 => DAYTIME, 2 * BIN32 LE, julian's day and millisec
>    "T", 4, 0  => "I", 4, 0 => TIMESTAMP, BIN32 LE, millisec
> xHarbour's VM supports DAYTIME type but Harbour doesn't yet but it's
> less problem now - when DAYTIME will be supported by HVM then adding
> valid mapping will not take more then few minutes.
> 
> Harbour recognize and can open tables with VFP system column: "_NullFlags"
> with NULL and VARLENGTH bits but it does not support them later and not
> update this column. Adding support for NULL flag may be a little bit
> problematic because our HVM/Clipper does not support such idea. We can
> make some tricks with mapping to NIL or only add functions to check NULL
> flag directly in table without NULL variables. We can also introduce real
> NULL flag to HVM.
> Here is my first QUESTION:
>    (1) Should we add real NULL flag support to HVM?
> 
> The VFP VARLENGTH fields can store strings from 0 to 255 bytes.
> It works like normal character field ("C") but size of string is
> stored too and later strings read from such fields keep original
> size in supported range (0:255). _NullFlags column keeps bit with
> information about using whole field area (in such case byte with
> string length is not stored in filed)
> In DBF header field is marked as "V" like VARIABLE SIX3 fields but
> because DBFs have different signature (0x30/0x31) then we can recognize
> them on open. But we will have to add representation for this field
> in DBCREATE(). Of course we can keep "V" and depending on
>    rddInfo( RDDI_TABLETYPE ) -> DB_DBF_STD or DB_DBF_VFP
> recognize it as SIX3 "V" or VFP "V" but IMHO it will confuse users
> and we should make it in different way.
> 
> VFP and some other xbase languages supports also AUTOINCREMENT field:
>    "+", 4, 0  => BIN32 LE
> and this type can be easy added too. It was even done by Vicente Guerra
> in xHarbour as "A" type but because implementation begins to use
> DBFIELDINFO.uiTypeExtended then I asked him to revert this modification
> until we agree common for all RDDs DBCREATE() structure and low level
> representation. It was over one and half year ago - sorry Vic that you
> have been waiting for such long time - my fault.
> 
> The columns in DBF can have also additional attributes like:
> system/hidden, nullable, binary, compressed, encrypted, varlength.
> We will have to define how to support these attributes in DBCREATE()
> array and then represent them in low level C code.
> Now in ADS RDDs additional field types are descirbed using character
> long names as field type, these are:
> 
>    "RAW"        => "C" + BINARY flag
>    "VARCHAR"    => SIX3 "V"
>    "BINARY"     => "M" + BINARY flag
>    "IMAGE"      => "M" + BINARY flag (IMAGE flag?)
>    "SHORTDATE"  => SIX3: "D", 3, 0 or BIN32 LE: "D", 4, 0
>    "INTEGER"    => "I", 4, 0
>    "SHORTINT"   => "I", 2, 0
>    "DOUBLE"     => "B", 8, n
>    "TIME"       => "T", 4, 0
>    "TIMESTAMP"  => "@", 8, 0
>    "AUTOINC"    => "+", 4, 0
>    "CURDOUBLE"  => "Y", 8, 4
> 
> Depending on type of table (DBF/ADT) internal ADS/ACE logic can
> make some translations for above types but it's out of our control.
> So now ADS users are passing to dbCreate() structure array which
> can look like:
>    { { "F1", "C",         10, 0 },;
>      { "F2", "DOUBLE",     8, 2 },;
>      { "F3", "INTEGER",    4, 0 },;
>      { "F4", "SHORTDATE",  8, 2 },;
>      { "F5", "AUTOINC",    4, 0 },;
>      { "F6", "L",          1, 0 } }
> 
> For low level representation ADS RDDs use uiTypeExtended member of
> DBFIELDINFO structure putting inside ADS_* integer number which
> describes field type (this was the source of potential conflicts
> between ADS and VIC DBF autoinc implementation)
> It's a working solution used by ADS users for many years (so it
> will be hard to change it - even if we define new format for
> table structure than ADS will have to support above) but not
> perfect: it's not compatible with other RDDs and it does not
> resolve problem with field flags.
> If we will try to used field type like in ADS also for flags
> then we will have really long description, hard to parse and
> use, f.e.:
>    "MEMVAR_COMPRESSED_ENCRYPTED_BINARY"
> so IMHO it's not real solution.
> In new FlagShip versions the first letter of field type is table
> field type and next ones are flags, f.e. for above we will have:
>    "MCEB"
> This seems to be much better solution for me and probably is less
> intrusive for existing code.
> 
> We can also add additional columns to dbStructur() array.
> In such way works CLIP (www.itk.ru) where 5-th column has logical
> value with BINARY flag and 6-th  logical value with NULLABLE flag.
> The bad thing with above is that when we will want to add other
> flags the structure array will grow up and finally it will be
> too huge to easy manage it.
> 
> We can also make sth between FlagShip and CLIP. We can extend
> structure array but add only one 5-th character column with
> flags described like in FlagShip. Alternatively it can be numeric
> column with bit field for different flags.
> This also seems to be reasonable solution.
> 
> If you have any other propositions then I'd like to hear about them.
> 
> Please think about it. We have to chose sth and we cannot leave
> it as is because each RDD developer will have to chse sth himself
> creating incompatible solution strongly oriented to databse
> supported by RDD (f.e. current ADS RDDs). So it's real problem.
> 
> My second QUESTION:
>    (2) What structure should we chose for dbCreate()/dbStruct() array?
> 
> 
> Finally I'd like to talk about low level representation for field
> structure. Now we are using this structure:
> 
> typedef struct
> {
>    BYTE *   atomName;         /* FIELD (symbol) name */
>    HB_TYPE  uiType;           /* FIELD type */
>    USHORT   uiTypeExtended;   /* FIELD type extended */
>    USHORT   uiLen;            /* Overall FIELD length */
>    USHORT   uiDec;            /* Decimal places of numeric FIELD */
> } DBFIELDINFO;
> 
> atomName, uiLen, uiDec do not need any additional comments.
> uiTypeExtended is not use by core code, it's for RDD internals.
> uiType is field type which stores HB_IT_* value - the same as
> used for item type. 
> This is in practice the same structure and description as in Clipper.
> 
> We have two problems.
> 1. Where we should keep field flags?
>    With some small number of flags we can define new types but if
>    we want to create universal, common for all RDDs structure then
>    we cannot define field types with all possible flag combinations.
> 2. Using HB_IT_* values as field type causes problems because some
>    databases can support some types which are not supported by our
>    HVM though they can be mapped to other types and used with some
>    online translation. It's also possible that our HVM types will
>    conflict with the database ones. F.e. in xHarbour HB_IT_DATE is
>    used for DATE, DAYTIME and TIMESTAMP when in most databases these
>    are separated types. It causes that Miguel added to xHarbour
>    HB_IT_DATETIME, HB_IT_TIMESTAMP which are not HVM item types but
>    they are used only in DBF RDD as marker for field types. He also
>    added HB_IT_OLE and HB_IT_PICTURE for "G" and "P" VFP DBF fields
>    but OLE and PICTURE are normal binary memo fields so they are rather
>    MEMO field attributes which informs about preferable field contents
>    then separate field type. To avoid such strange "extensions" which
>    sooner or later will be in conflict with HVM I'd like to replace
>    HB_IT_* values in uiType by HB_FT_* ones which will be only for
>    RDD use.
> 
> In summary I'd like two sets with HB_FT_* (Field Type) and HB_FF_*
> (Field Flag) definitions. Store HB_FT_* in uiType and find a place
> for HB_FF_*. We can use uiTypeExtended as holder or we can add new
> member to DBFIELDINFO, f.e.: USHORT uiFlags.
> Personally I vote for new field for two reasons:
> 1. it will not increase DBFIELDINFO structure because current
>    architecture uses 4 or more bytes alignment
> 2. uiTypeExtended was defined as private RDD field and it can be used
>    by 3-rd party RDDs. If we change it then it's possible that we will
>    force some serious modifications in their code.
> 
> At this moment I think we will need the following field types and flags:
> (on the ride side proposed letters)
> 
>    HB_FT_STRING      "C"
>    HB_FT_LOGICAL     "L"
>    HB_FT_DATE        "D"
>    HB_FT_LONG        "N"
>    HB_FT_INTEGER     "I"
>    HB_FT_DOUBLE      "B"
>    HB_FT_MEMO        "M"
>    HB_FT_ANY         "V"
>    HB_FT_TIME        "T"
>    HB_FT_DAYTIME     "@"
> 
>    HB_FF_HIDDEN      "H"
>    HB_FF_NULLABLE    "N"
>    HB_FF_BINARY      "B"
>    HB_FF_COMPRESSED  "C"
>    HB_FF_ENCRYPTED   "E"
> 
> Four additional can be flag for existing types or separated types, we can
> also add the to both sets, f.e.:
> 
>    HB_FT_VARLENGTH   "S"
>    HB_FT_AUTOINC     "+"
>    HB_FT_IMAGE       "P"
>    HB_FT_OLE         "G"
> 
>    HB_FF_VARLENGTH   "V"
>    HB_FF_AUTOINC     "+"
>    HB_FF_IMAGE       "P"
>    HB_FF_OLE         "G"
> 
> We can define HB_FT_* as continuous numbers and the add sth like:
>    #define HB_FT_USER     1024
> to reserve first 1024 types for our own use so user defined types
> should starts from HB_FT_USER.
> 
> 
> My third QUESTION is:
>    (3) What structures/types should we use for internal RDD field
>        representation?
> 
> Please think about it. It's 3-rd time as I'm sending similar letter
> to [x]Harbour devel list. This time I'd like to receive answers and
> chose sth for the future so please present your opinions.
> 
> I'm also very interested in 3-rd party developers opinions. I hope
> that authors of two most popular ones; Jacek Potempa (MEDIATOR) and
> Marcelo Lombardo (SQLRDD) will send them here. These RDDs are not DBF
> oriented so your suggestions can be very important for us. If will not
> take a part in this discussion then you will have to accept sth what
> we will chose ourself and what can cause problems for you or will not
> address some issues you want to resolve.
> 
> best regards,
> Przemek
> 
> PS. There is still open question about defining common for RDD
>     open/connection string which can be used in dbUseArea()
> 
> -------------------------------------------------------------------------
> This SF.net email is sponsored by: Splunk Inc.
> Still grepping through log files to find problems?  Stop.
> Now Search log events and configuration files using AJAX and a browser.
> Download your FREE copy of Splunk now >>  http://get.splunk.com/
> _______________________________________________
> xHarbour-developers mailing list
> xHarbour-developers@lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/xharbour-developers
> 

From budyanto at centrin.net.id  Mon Sep  3 05:08:12 2007
From: budyanto at centrin.net.id (Budyanto Dj.)
Date: Mon Sep  3 05:08:20 2007
Subject: [Harbour] DbEval() Function Very Slow With Active With
	Controlling	Index?
In-Reply-To: <46DBC29F.4040600@gmail.com>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
Message-ID: <46DC316C.16740.F01798A@localhost>

Mario,

Sorry to cause you trouble. I didn't expect 5000 records can produce 1GB of trace.log... :-(.

If you reduce the number from 5000 to 10 you'll see this output:
(i,recno()) pairs:

(1,1)
(2,10)
(3,2)
(4,10)
(5,3)
(6,10)
...
(17,9)
(18,10)

Dbeval()'s block is not executed 10 times, but 18 times because you are replacing index key. 

Regards,
Budyanto

On 3 Sep 2007 at 16:15, Mario H. Sabado wrote:
> Hi Budyanto,
> 
> I tried your suggestion and the trace.log file had reached to almost 1GB size
> with the 5,000 rows of logfile I'm testing.  I could hardly open the trace log
> file from an editor either.  Although, I ran the test code with hbrun.exe and
> xbscript.exe.
> 
> Regards,
> Mario

From makis1970 at gmail.com  Mon Sep  3 06:19:02 2007
From: makis1970 at gmail.com (Mike Evans (Gmail))
Date: Mon Sep  3 06:24:15 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070901114750.GB9374@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
Message-ID: <003101c7ee13$db306640$919132c0$@com>

Przemek.
Excellent work. 
As addition Clip53b DBFCDX support undocumented "F" data type (the same as
"N"). Also as proposal I think that we can add in a new dbinfo struct for
conversions native or with cb. As example think the following we create a
file with a non existent datatype "foo". Also we add a cb about how to
convert this type {|customfield| foo(customefield) }. Inside this dbinfo
struct we can have all the native supported datatypes and conversions.

Regards
Mike Evans

PS As for null could be supported with the above solution or even better
with a flag that is stored in dbheader.


-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Przemyslaw Czerpak
Sent: Saturday, September 01, 2007 2:48 PM
To: Harbour Project Main Developer List.
Cc: Xharbour-Developers List
Subject: [Harbour] Extended field types in RDDs

Hi All,

I've found a while to write some text about necessary modifications
for common to all RDDs extended field support. It's an old problem
still open and I think that it's time to resolve it.


I'll begin with small presentation for already supported types and
some other which exist in different DBF implementations supported
partially or not supported yet by us.


Legends:
   BIN - binary
   LE - little endian
   DP - decimal point

Clipper supports the following DBF filed types:
--------------+-------+-----+----
LOW LEVEL ID  | PRGID | LEN | DEC
--------------+-------+-----+----
HB_IT_LOGICAL | "L"   | 1   | 0    //ASCII T/F Y/N value
HB_IT_DATE    | "D"   | 8   | 8    //ASCII DTOS() value
HB_IT_LONG    | "N"   | <n> | <m>  //ASCII <n> bytes number, <m> DP
HB_IT_STRING  | "C"   | <n> | <m>  //len = <n> + 256 * <m>
HB_IT_MEMO    | "M"   | 10  | 0    //ASCII MEMO block number
--------------+-------+-----+----
Now Harbour recognizes and suppots also:
--------------+-------+-----+----
HB_IT_INTEGER | "I"   | <n> | <m>  //BIN LE in <n>bytes, <m>:DP
(<n>:1,2,3,4,8)
HB_IT_DATE    | "D"   | 3   | 0    //BIN LE Julian's day
HB_IT_DATE    | "D"   | 4   | 0    //BIN LE Julian's day
HB_IT_MEMO    | "M"   | 4   | 0    //BIN LE MEMO block number
HB_IT_MEMO    | "M"   | 10  | 0    //SMT MEMO SIG (BIN LE:block,size,type)
HB_FT_DOUBLE  | "B"   | 8   | <m>  //IEEE754 LE double number, <m> DP
HB_IT_ANY     | "V"   | 2   | 0    //SIX3 BIN16 LE (16 bit signed integer)
HB_IT_ANY     | "V"   | 3   | 0    //SIX3 packed date - Sx_DToP()
HB_IT_ANY     | "V"   | 4   | 0    //SIX3 BIN32 LE (32 bit signed integer)
HB_IT_ANY     | "V"   | <n> | <m>  //SIX3 variable (weekly-typed) field
<n>>=6
--------------+-------+-----+----
and as synonyms (for compatibility with other xbase languages):
   "2"        =>  "I", 2, 0  (FlagShip)
   "4"        =>  "I", 4, 0  (FlagShip)
   "8", 8,<m> =>  "B", 8,<m> (FlagShip)
   "Y"        =>  "I", 8, 4  (Currency, VFP)
   "F",<n>,<m>=>  "N",<n>,<m>(DBASE)

there are also two types which are not suppoted by Harbour VM and mapped
to numeric values:
   "@", 8, 0  => "I", 8, 0 => DAYTIME, 2 * BIN32 LE, julian's day and
millisec
   "T", 4, 0  => "I", 4, 0 => TIMESTAMP, BIN32 LE, millisec
xHarbour's VM supports DAYTIME type but Harbour doesn't yet but it's
less problem now - when DAYTIME will be supported by HVM then adding
valid mapping will not take more then few minutes.

Harbour recognize and can open tables with VFP system column: "_NullFlags"
with NULL and VARLENGTH bits but it does not support them later and not
update this column. Adding support for NULL flag may be a little bit
problematic because our HVM/Clipper does not support such idea. We can
make some tricks with mapping to NIL or only add functions to check NULL
flag directly in table without NULL variables. We can also introduce real
NULL flag to HVM.
Here is my first QUESTION:
   (1) Should we add real NULL flag support to HVM?

The VFP VARLENGTH fields can store strings from 0 to 255 bytes.
It works like normal character field ("C") but size of string is
stored too and later strings read from such fields keep original
size in supported range (0:255). _NullFlags column keeps bit with
information about using whole field area (in such case byte with
string length is not stored in filed)
In DBF header field is marked as "V" like VARIABLE SIX3 fields but
because DBFs have different signature (0x30/0x31) then we can recognize
them on open. But we will have to add representation for this field
in DBCREATE(). Of course we can keep "V" and depending on
   rddInfo( RDDI_TABLETYPE ) -> DB_DBF_STD or DB_DBF_VFP
recognize it as SIX3 "V" or VFP "V" but IMHO it will confuse users
and we should make it in different way.

VFP and some other xbase languages supports also AUTOINCREMENT field:
   "+", 4, 0  => BIN32 LE
and this type can be easy added too. It was even done by Vicente Guerra
in xHarbour as "A" type but because implementation begins to use
DBFIELDINFO.uiTypeExtended then I asked him to revert this modification
until we agree common for all RDDs DBCREATE() structure and low level
representation. It was over one and half year ago - sorry Vic that you
have been waiting for such long time - my fault.

The columns in DBF can have also additional attributes like:
system/hidden, nullable, binary, compressed, encrypted, varlength.
We will have to define how to support these attributes in DBCREATE()
array and then represent them in low level C code.
Now in ADS RDDs additional field types are descirbed using character
long names as field type, these are:

   "RAW"        => "C" + BINARY flag
   "VARCHAR"    => SIX3 "V"
   "BINARY"     => "M" + BINARY flag
   "IMAGE"      => "M" + BINARY flag (IMAGE flag?)
   "SHORTDATE"  => SIX3: "D", 3, 0 or BIN32 LE: "D", 4, 0
   "INTEGER"    => "I", 4, 0
   "SHORTINT"   => "I", 2, 0
   "DOUBLE"     => "B", 8, n
   "TIME"       => "T", 4, 0
   "TIMESTAMP"  => "@", 8, 0
   "AUTOINC"    => "+", 4, 0
   "CURDOUBLE"  => "Y", 8, 4

Depending on type of table (DBF/ADT) internal ADS/ACE logic can
make some translations for above types but it's out of our control.
So now ADS users are passing to dbCreate() structure array which
can look like:
   { { "F1", "C",         10, 0 },;
     { "F2", "DOUBLE",     8, 2 },;
     { "F3", "INTEGER",    4, 0 },;
     { "F4", "SHORTDATE",  8, 2 },;
     { "F5", "AUTOINC",    4, 0 },;
     { "F6", "L",          1, 0 } }

For low level representation ADS RDDs use uiTypeExtended member of
DBFIELDINFO structure putting inside ADS_* integer number which
describes field type (this was the source of potential conflicts
between ADS and VIC DBF autoinc implementation)
It's a working solution used by ADS users for many years (so it
will be hard to change it - even if we define new format for
table structure than ADS will have to support above) but not
perfect: it's not compatible with other RDDs and it does not
resolve problem with field flags.
If we will try to used field type like in ADS also for flags
then we will have really long description, hard to parse and
use, f.e.:
   "MEMVAR_COMPRESSED_ENCRYPTED_BINARY"
so IMHO it's not real solution.
In new FlagShip versions the first letter of field type is table
field type and next ones are flags, f.e. for above we will have:
   "MCEB"
This seems to be much better solution for me and probably is less
intrusive for existing code.

We can also add additional columns to dbStructur() array.
In such way works CLIP (www.itk.ru) where 5-th column has logical
value with BINARY flag and 6-th  logical value with NULLABLE flag.
The bad thing with above is that when we will want to add other
flags the structure array will grow up and finally it will be
too huge to easy manage it.

We can also make sth between FlagShip and CLIP. We can extend
structure array but add only one 5-th character column with
flags described like in FlagShip. Alternatively it can be numeric
column with bit field for different flags.
This also seems to be reasonable solution.

If you have any other propositions then I'd like to hear about them.

Please think about it. We have to chose sth and we cannot leave
it as is because each RDD developer will have to chse sth himself
creating incompatible solution strongly oriented to databse
supported by RDD (f.e. current ADS RDDs). So it's real problem.

My second QUESTION:
   (2) What structure should we chose for dbCreate()/dbStruct() array?


Finally I'd like to talk about low level representation for field
structure. Now we are using this structure:

typedef struct
{
   BYTE *   atomName;         /* FIELD (symbol) name */
   HB_TYPE  uiType;           /* FIELD type */
   USHORT   uiTypeExtended;   /* FIELD type extended */
   USHORT   uiLen;            /* Overall FIELD length */
   USHORT   uiDec;            /* Decimal places of numeric FIELD */
} DBFIELDINFO;

atomName, uiLen, uiDec do not need any additional comments.
uiTypeExtended is not use by core code, it's for RDD internals.
uiType is field type which stores HB_IT_* value - the same as
used for item type. 
This is in practice the same structure and description as in Clipper.

We have two problems.
1. Where we should keep field flags?
   With some small number of flags we can define new types but if
   we want to create universal, common for all RDDs structure then
   we cannot define field types with all possible flag combinations.
2. Using HB_IT_* values as field type causes problems because some
   databases can support some types which are not supported by our
   HVM though they can be mapped to other types and used with some
   online translation. It's also possible that our HVM types will
   conflict with the database ones. F.e. in xHarbour HB_IT_DATE is
   used for DATE, DAYTIME and TIMESTAMP when in most databases these
   are separated types. It causes that Miguel added to xHarbour
   HB_IT_DATETIME, HB_IT_TIMESTAMP which are not HVM item types but
   they are used only in DBF RDD as marker for field types. He also
   added HB_IT_OLE and HB_IT_PICTURE for "G" and "P" VFP DBF fields
   but OLE and PICTURE are normal binary memo fields so they are rather
   MEMO field attributes which informs about preferable field contents
   then separate field type. To avoid such strange "extensions" which
   sooner or later will be in conflict with HVM I'd like to replace
   HB_IT_* values in uiType by HB_FT_* ones which will be only for
   RDD use.

In summary I'd like two sets with HB_FT_* (Field Type) and HB_FF_*
(Field Flag) definitions. Store HB_FT_* in uiType and find a place
for HB_FF_*. We can use uiTypeExtended as holder or we can add new
member to DBFIELDINFO, f.e.: USHORT uiFlags.
Personally I vote for new field for two reasons:
1. it will not increase DBFIELDINFO structure because current
   architecture uses 4 or more bytes alignment
2. uiTypeExtended was defined as private RDD field and it can be used
   by 3-rd party RDDs. If we change it then it's possible that we will
   force some serious modifications in their code.

At this moment I think we will need the following field types and flags:
(on the ride side proposed letters)

   HB_FT_STRING      "C"
   HB_FT_LOGICAL     "L"
   HB_FT_DATE        "D"
   HB_FT_LONG        "N"
   HB_FT_INTEGER     "I"
   HB_FT_DOUBLE      "B"
   HB_FT_MEMO        "M"
   HB_FT_ANY         "V"
   HB_FT_TIME        "T"
   HB_FT_DAYTIME     "@"

   HB_FF_HIDDEN      "H"
   HB_FF_NULLABLE    "N"
   HB_FF_BINARY      "B"
   HB_FF_COMPRESSED  "C"
   HB_FF_ENCRYPTED   "E"

Four additional can be flag for existing types or separated types, we can
also add the to both sets, f.e.:

   HB_FT_VARLENGTH   "S"
   HB_FT_AUTOINC     "+"
   HB_FT_IMAGE       "P"
   HB_FT_OLE         "G"

   HB_FF_VARLENGTH   "V"
   HB_FF_AUTOINC     "+"
   HB_FF_IMAGE       "P"
   HB_FF_OLE         "G"

We can define HB_FT_* as continuous numbers and the add sth like:
   #define HB_FT_USER     1024
to reserve first 1024 types for our own use so user defined types
should starts from HB_FT_USER.


My third QUESTION is:
   (3) What structures/types should we use for internal RDD field
       representation?

Please think about it. It's 3-rd time as I'm sending similar letter
to [x]Harbour devel list. This time I'd like to receive answers and
chose sth for the future so please present your opinions.

I'm also very interested in 3-rd party developers opinions. I hope
that authors of two most popular ones; Jacek Potempa (MEDIATOR) and
Marcelo Lombardo (SQLRDD) will send them here. These RDDs are not DBF
oriented so your suggestions can be very important for us. If will not
take a part in this discussion then you will have to accept sth what
we will chose ourself and what can cause problems for you or will not
address some issues you want to resolve.

best regards,
Przemek

PS. There is still open question about defining common for RDD
    open/connection string which can be used in dbUseArea()
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour

From mhsabado at gmail.com  Mon Sep  3 06:27:46 2007
From: mhsabado at gmail.com (Mario H. Sabado)
Date: Mon Sep  3 06:28:11 2007
Subject: [Harbour] DbEval() Function Very Slow With Active Controlling Index?
In-Reply-To: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
Message-ID: <46DBE1A2.5070309@gmail.com>

Hi Budyanto,
> ------------------------------
>
> Message: 7
> Date: Mon, 03 Sep 2007 14:07:16 +0700
> From: "Budyanto Dj." <budyanto@centrin.net.id>
> Subject: Re: [Harbour] DbEval() Function Very Slow With Active
> 	Controlling	Index?
> To: "Harbour Project Main Developer List."
> 	<harbour@harbour-project.org>
> Message-ID: <46DC1514.11044.E92C257@localhost>
> Content-Type: text/plain; charset=US-ASCII
>
> Hi Mario,
>
> While waiting for the answer from the experts, could you change the dbeval's block to the following:
>
> i := 1
> DbEval({||tracelog(i++, recno()), dtrtmp->BIO_ID := padl(alltrim(dtrtmp->BIO_ID),5,"0" ) } 
>
> to see if recno() "jumps around" in your indexed case?
> (That's what I expect from the parallel normal loop "do while !eof()...dbskip()...enddo")
>
> Regards,
> Budyanto
>
>   
Yes, as I tested with lower data, it is indeed "jumping around" despite 
the fact that the index key (BIO_ID) was generated in sequence.

Thanks,
Mario
From i at kevincarmody.com  Mon Sep  3 07:10:41 2007
From: i at kevincarmody.com (Kevin Carmody)
Date: Mon Sep  3 07:10:21 2007
Subject: [Harbour] DbEval() Function Very Slow With Active Controlling
	Index?
In-Reply-To: <46DBE1A2.5070309@gmail.com>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
	<46DBE1A2.5070309@gmail.com>
Message-ID: <46DBEBB1.5010208@kevincarmody.com>


Mario H. Sabado wrote:
> Hi Budyanto,
>> ------------------------------
>>
>> Message: 7
>> Date: Mon, 03 Sep 2007 14:07:16 +0700
>> From: "Budyanto Dj." <budyanto@centrin.net.id>
>> Subject: Re: [Harbour] DbEval() Function Very Slow With Active
>>     Controlling    Index?
>> To: "Harbour Project Main Developer List."
>>     <harbour@harbour-project.org>
>> Message-ID: <46DC1514.11044.E92C257@localhost>
>> Content-Type: text/plain; charset=US-ASCII
>>
>> Hi Mario,
>>
>> While waiting for the answer from the experts, could you change the 
>> dbeval's block to the following:
>>
>> i := 1
>> DbEval({||tracelog(i++, recno()), dtrtmp->BIO_ID := 
>> padl(alltrim(dtrtmp->BIO_ID),5,"0" ) }
>> to see if recno() "jumps around" in your indexed case?
>> (That's what I expect from the parallel normal loop "do while 
>> !eof()...dbskip()...enddo")
>>
>> Regards,
>> Budyanto
>>
>>   
> Yes, as I tested with lower data, it is indeed "jumping around" 
> despite the fact that the index key (BIO_ID) was generated in sequence.

Yes, and it is *maintained* in sequence as you traverse the database.  
That's why it jumps around.  In extreme cases it may jump around 
forever.  This is standard database behavior.  For this reason, it is 
generally bad design to update an index key while that index key is 
active.  A better design is to use record number order to update an 
index key.  That way the index is not used to move from one record to 
the next, and the operation goes at maximum speed.

Kevin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20070903/280b00a7/attachment.html
From budyanto at centrin.net.id  Mon Sep  3 07:22:15 2007
From: budyanto at centrin.net.id (Budyanto Dj.)
Date: Mon Sep  3 07:22:44 2007
Subject: [Harbour] DbEval() Function Very Slow With Active Controlling
	Index?
In-Reply-To: <46DBE1A2.5070309@gmail.com>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
Message-ID: <46DC50D7.22368.646B85@localhost>

On 3 Sep 2007 at 18:27, Mario H. Sabado wrote:
> Yes, as I tested with lower data, it is indeed "jumping around" despite 
> the fact that the index key (BIO_ID) was generated in sequence.

IMO the behaviour is expected. (It behaves the same in Clipper.)

Here is what you have initially:
"1    "
"2    "
"3    "
"4    "
"5    "
"6    "
"7    "
"8    "
"9    "
"10   "

Here is what you have in indexed sequence:
(Note that "10   " is the second logical record)
"1    "
"10   "
"2    "
"3    "
"4    "
"5    "
"6    "
"7    "
"8    "
"9    "

After replaceing the first logical record:
"    1"
"10   " <-- pointer
"2    "
"3    "
"4    "
"5    "
"6    "
"7    "
"8    "
"9    "

After replaceing the second logical record:
"    1"
"   10"
"2    " <-- pointer
"3    "
"4    "
"5    "
"6    "
"7    "
"8    "
"9    "

After replaceing the third logical record:
"    1"
"    2"
"   10" <-- pointer, back to 10!!!
"3    "
"4    "
"5    "
"6    "
"7    "
"8    "
"9    "

You see that you arrive at record "   10" again!
And so on, after you replace record "3    " you are back to record "   10" again.

In total you do the replacement to record "   10" eight times (instead of one).

Doing it with 5000 records you have multiple "jump-back" like that thousands (or maybe millions?) of 
times... That explains the slowness.

Regards,
Budyanto

From druzus at priv.onet.pl  Mon Sep  3 10:29:31 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep  3 10:29:39 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <040a01c7ed75$7a62a470$6a00a8c0@PAUL>
References: <20070902132927.GB15943@localhost.localdomain>
	<040a01c7ed75$7a62a470$6a00a8c0@PAUL>
Message-ID: <20070903142931.GA19537@localhost.localdomain>

On Sun, 02 Sep 2007, Paul Tucker wrote:
> If we treat NULL as an attribute, then there is no problem with choosing a 
> value to represent it.  The field is NULL and any operation that involves it 
> results in NULL.  A field can have an attribute of 'Default' as well, and if 
> you want to use the same flag for this indication, then that can work, but 
> don't try to mix the 2 (IMO).  What I mean is, income can't be $100 and NULL 
> as well.

You said that DEFAULT cannot be set on columns with NULLABLE flag because
they are mutual exclusive. We can add such condition but IMHO it should be
in low level RDD code not in our core code because some DBMS may allow it.

> If a field does not have the 'NULL'able flag, and you add a record without 
> supplying this data, the add is not allowed - unless it also has the 
> 'default' flag.

At beginning you wrote that NULLABLE flags cannot be set to user defined
DEFAULT value. It's a precise condition which eliminates having column with
nullable flag and default value because the default value will remove null
flag. In such case exception is not necessary.

> Something like NULL_STRING is supported in VO, but this is partly due to its 
> strong typing.  A NULL_STRING assigned to a usual is NIL.  (I suppose we 
> could still make the distinction in the ITEM.)
> 
> Using an Oracle table - any reference to a column that contains NULL values 
> in the selection  results in those records to be excluded.
> 'Select * from customer where address (> "", or < ""  f.e.)' results in all 
> non-null address records to be included. while 'Select * from customer where 
> address is NULL' gives the others.  and finally, 'select * from customer' 
> gives all records.

The above defines that we need support for NULL flag inside HVM
because it will effect operators like <, <=, >, >=, =, ==, $, +,
-, *, /, %, ...
RDD does not know anything about evaluating expressions so when you
make
    SET FILTER TO VALUE1 >= 100
then this expresion is evaluated by HVM. PCODE generate for: VALUE1 >= 100
put two values on HVM stack and then execute hb_vmGreaterEqual() and
inside this function it will be necessary to add condition for NULL value.
In general if we define that NULL value should effect any of operators then
we force modifing HVM. How it will effect different operators is unimportant
because we can implement ant behavior, f.e. both:
    VALUE1 <= 100 
and
    VALUE1 > 100
may return false if VALUE1 has NULL attribute.
But I do not like it because it will block us to add some compile time
optimizations like replacing:
    IF ! VALUE1 <= 100
with:
    IF VALUE1 > 100

because in first case result will be TRUE and in the second one: FALSE.
In the future I plan to add to compiler optimization switch (not enabled
be default) which will force much more aggressive expression reduction
using standard math rules. If we add define some special behavior for
NULL values then it will not be possible to make it. Also different DBMS
may have different conditions for operations on NULL values so it will
not be possible use replicate compatible with all of them behavior.
Please also note that some operations on NULL values cannot generate RT
errors and have to be accepted by RTL functions or you will not be able
to execute even simple BROWSE().

If we do not want to touch operators so evaluated expressions will not
be effected by NULL flag then we can add only function to check if given
field is NULL, f.e. FIELDISNULL( <cFieldName>|<nFieldPos> )

And this is the core of problem. Should we have REAL NULL flag support
which will effect operators in some way (it cannot be implemented without
introducing information about NULL flag to HVM) or FIELDISNULL() and maybe
some small [macro]compiler hack with internal translating
    ISNULL(<cFieldName>)
to:
    FIELDISNULL( "cFieldName" )

to simulate ISNULL() function from other languages will be enough.
I need answer for this question. The rest is a little bit OT though
maybe helps to understand the problems for other users.

best regards,
Przemek
From dbtopas at dbtopas.lt  Mon Sep  3 10:58:12 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Sep  3 10:59:54 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070901114750.GB9374@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
Message-ID: <46DC2104.2030201@dbtopas.lt>

Przemyslaw Czerpak wrote:
> Adding support for NULL flag may be a little bit
> problematic because our HVM/Clipper does not support such idea. We can
> make some tricks with mapping to NIL or only add functions to check NULL
> flag directly in table without NULL variables. We can also introduce real
> NULL flag to HVM.
> Here is my first QUESTION:
>    (1) Should we add real NULL flag support to HVM?

I use SQL not very often and familiar with MySQL NULL value, and I do 
not understand the difference between NIL and NULL! :/ Is NULL in other 
SQL languages different from MySQL??

>> In prg code you can ask 'if myvalue == NIL'?, but for SQL, that's not a 
>> > valid statement.  it's 'if IsNull(myvalue)'

OK, SQL expressions have different syntax. The value can not be compared 
to NIL, in Harbour it can be.
What is a difference between a NUMERIC database field having NULL value 
and NUMERIC database field having NIL? Why do we need NULL?

> Many thanks for these informations. Just now some clarification.
> NULL is variable attribute not a value. F.e. NULL string is
> still normal string which can be used in any string operation
> as any other string. NULL flag informs only that the string
> was initialized with some default value. You can check it using
> some special function usually called ISNULL(), f.e. ISNUL( cVal )
> In fact such value does not have to be empty (usually is).

OK, if NULL is a flag and not the value. And NULL field can have 
different values, we need a separate (different from NIL) NULL 
implementation.

> ....
> 1. chose some value to represent NULL

Hmm....? If NULL is a flag, this means we can have string "ABC" with 
NULL flag and string "DEF" with NULL flag? So, we can not use some value 
to represent NULL, because any value can have a NULL flag.

> I hope that in my replay to Paul's message I explain more precisely what
> we can do. It's not important for me to have real NULL support in HVM.
> But if you will want to emulate ADS like behavior, f.e.:
>     NULL_STRING + STRING => NULL_STRING
> then it will be possible only with full NULL support in HVM.

Again. Are we talking about flag NULL or value NULL?
If we are talking about flag, so we must define:
   NULL_STRING("ABC") + STRING("DEF") => NULL_STRING("ABCDEF")
or something like that.
If we are talking about value NULL, then
   NULL_STRING + STRING("any_string") => NULL_STRING
but here I see nothing more than NIL with operators result incompatible 
with Harbour. In Harbour the result of NIL+STRING is runtime error, in 
SQL the result is NIL (NULL). Do we need a separate NULL, to avoid 
runtime error in NULL+STRING?


I use MySQL only (maybe Oracle NULL is different...), but I understand 
MySQL's NULL value as "not defined" or "keep in mind it's default". Just 
like NIL in Harbour(!), if the need to pass a default value to the 
function, we pass NIL:
   FUNC some_func(some_param)
      IF some_param == NIL;  some_param := default_value
      ENDIF
      ....
I've also implemented RDD to access MySQL and I use Harbour NIL value to 
represent MySQL's NULL value without problem. The implementation could 
be a little different, for example FIELDGET() can return empty string or 
SPACE(field_len), or numeric 0.0 value, but additional ISNULL(field_no) 
could be used to test if it is NULL value. This approach helps to avoid 
index value generation problem. If we want to index database on to 
fields, we use index key expression:
     FIELD1+FIELD2
For fields having a NIL (NULL) values we must write:
     IF(FIELD1 == NIL, SPACE(f1_len),FIELD1) + IF(FIELD2 == NIL, 
SPACE(f2_len),FIELD2)
to avoid run time error. So, an easy solution for this is to return 
empty string, and implement a function ISNULL(field_no) for testing NULL 
value.

I do not see a reason for Harbour NULL in HVM, unless we want full SQL 
syntax support, i.e.
    NULL + "abc" => NULL
to be precise:
    concat(NULL, "abc") => NULL
But in this case NULL is not a flag is just another value similar to 
NIL, because NULL does not have it's type or value (at least in MySQL).


> My second QUESTION:
>    (2) What structure should we chose for dbCreate()/dbStruct() array?

I think, 5-th array element with flag bits/characters will be a good 
solution.


> We have two problems.
> 1. Where we should keep field flags?
> Personally I vote for new field for two reasons:
> 1. it will not increase DBFIELDINFO structure because current
>    architecture uses 4 or more bytes alignment

An extra field in DBFIELDINFO is OK. Why do we care about same 
DBFIELDINFO size? Is it possible to make these changes and keep binary 
for current RDD drivers? If we do not keep binary compability, 
DBFIELDINFO size is not a problem at all.


> My third QUESTION is:
>    (3) What structures/types should we use for internal RDD field
>        representation?

What structures are we talking about? Current dbf implementation keeps 
record buffer and gets value directly from it in area GetValue method. 
Where do we need to store field value?


Best regards,
Mindaugas

P.S. I can include my RDD code into contrib, if anyone find it usefull. 
But it's different solution from SQLRDD: it's not DBF emulation over 
SQL, it's RDD to access (and index) SQL query result via RDD interface.
From druzus at priv.onet.pl  Mon Sep  3 11:20:49 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep  3 11:21:00 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <46DBC7EC.2000602@marchuet.net>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
Message-ID: <20070903152049.GB19537@localhost.localdomain>

On Mon, 03 Sep 2007, Miguel Angel Marchuet wrote:
> I'm working to implement flags over dbf not only NIL. But my time
> is very limitted.
> I've implemented autoincrement flag but not uploaded yet. in some formats 
> it's a
> flag as VFP in other dbf formats it's fieldtype.

Yes,

> xHarbour too reconices the next field types
> --------------+-------+-----+----
> LOW LEVEL ID  | PRGID | LEN | DEC
> --------------+-------+-----+----
> HB_IT_OLE     | "G"   | 10  | 0
> HB_IT_PICTURE | "P"   | 10  | 0
> this are not flags in VPF.

I was writing about it and it's also good example why we have to do sth
with current lowlevel code. It intorduces HB_IT_* types not existing in
HVM and because it's bitfield then we will have problems with space for
new types.

> Is needed to implement import and export ole linked to a WINAPI. But by the 
> moment the types are recogniced.

Please remember that this are windows only unportable extensions so they
should not be defined as standard Harbour features.

> I think autoincrement is beeter wotk as flag in all numeric without 
> decimals as in VFP.
> and support + fieldtype too.

Yes. The incrementation flag is more flexible.

> At dbcreate i'm working as i propouse in a previous message.
> CREATE TABLE | DBF TableName1 [NAME LongTableName] [FREE]
>     [CODEPAGE = nCodePage]
>     ( FieldName1 FieldType [( nFieldWidth [, nPrecision] )] [NULL | NOT 
>     NULL]
>     [AUTOINC [NEXTVALUE NextValue [STEP StepValue]]]
> or
> DbCreate( cTableName, {{FieldName1, FieldType1, nFieldWidth1, nPrecision1 
> [, lNull1][, NextValue1, StepValue1] },...},;
>           [cDriver], [lNewArea], [cAlias], [nCodePage] )
> CREATE TABLE MyGenTbl (mygenfield G)
> APPEND BLANK  && Add a blank record
> APPEND GENERAL mygenfield FROM C:\EXCEL\BOOK1.XLS CLASS EXCELCHART

We can define any upper level preprocessor rules. Now more important for
me is .prg representation of dbCreate()/dbStruct() array and low level
DBFIELDINFO structure, and field type/flag markers.
In your example we have:
    5-th column for NULLABLE flag,
    6-th column for AUTOINC initial value
    7-th column for AUTOINC step value

the 5 column can be replaced by numeric or character flag columns.
the 6 and 7 are not binary flags and need separate columns but
I'm not sure if adding next column for each of non binary attribute
to dbCreate() array is good idea. We will have soon 15 or more columns.
I thought about adding some new functions which will operate on such
bigger array to use with some PP rules like above VFP commands.

> we need the following field types and flags:
>     HB_FT_STRING      "C"
>     HB_FT_LOGICAL     "L"
>     HB_FT_DATE        "D"
>     HB_FT_LONG        "N"
>     HB_FT_INTEGER     "I"
>     HB_FT_DOUBLE      "B"
>     HB_FT_MEMO        "M"
>     HB_FT_ANY         "V"
>     HB_FT_TIME        "T"
>     HB_FT_DAYTIME     "@"
>     HB_IT_OLE         "G"
>     HB_IT_PICTURE     "P"
>     HB_IT_BLOB        "W"
>     HB_IT_CURRENCY    "Y"
>     HB_IT_FLOAT       "F"
>     HB_IT_VARBINARY   "Q"
> 
>     HB_FF_HIDDEN      0x01 // 0x01   System Column (not visible to user)
>     HB_FF_NULLABLE    0x02 // 0x02   Column can store null values
>     HB_FF_BINARY      0x04 // 0x04   Binary column (for CHAR and MEMO only)
>                            // 0x06   (0x02+0x04) When a field is NULL and 
>                            binary (Integer, Currency, and Character/Memo 
>                            fields)
>     HB_FF_AUTOINC     0x0C // 0x0C   Column is autoincrementing
>     HB_FF_COMPRESSED  ?
>     HB_FF_ENCRYPTED   ?

Probably much more but when we replace HB_IT_* bit fields (I guess that
HB_IT_* above is a typo) then it will be possible to add any new HB_FT_*
types as continuous indexes without any problems.

> What about:
> typedef struct
> {
>    BYTE *   atomName;         /* FIELD (symbol) name */
>    HB_TYPE  uiType;           /* FIELD type */
>    USHORT   uiTypeExtended;   /* FIELD type extended */
>    USHORT   uiLen;            /* Overall FIELD length */
>    USHORT   uiDec;            /* Decimal places of numeric FIELD */
>    USHORT   uiFlags;          /* System, Null, binary and autoincrease flag */
> } DBFIELDINFO;

It's exactly what I want to do. Keep uiTypeExtended and add uiFlags.

best regards,
Przemek
From druzus at priv.onet.pl  Mon Sep  3 11:47:30 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep  3 11:47:38 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <053201c7edb2$b93a8450$6a00a8c0@PAUL>
References: <040a01c7ed75$7a62a470$6a00a8c0@PAUL>
	<053201c7edb2$b93a8450$6a00a8c0@PAUL>
Message-ID: <20070903154730.GC19537@localhost.localdomain>

On Sun, 02 Sep 2007, Paul Tucker wrote:
> The problem with allowing 'defaults' is you then need to store the actual 
> default somewhere!

If you think about storing default value in standard DBFs then for
some values it will be problem and we will have to extend the DBF
structure but I want to repeat that we are not talking about DBFs
here but our core RDD structures to used to keep description of
many different type of tables. Probably many of extensions we are
talking about will never be implemented in DBF structures so please
forget about DBF format because it's not a subject of this discussion.
For us it's important only how to pass default value (and other non
binary column attributes) to table structure array and maybe in
some low level code if we decide to add some basic core support for
default value but we can also leave it to low level RDD code only.

BTW Some RDDs may not store default value in any tables but it will
be simple attribute which can be set after opening table, f.e.:
    dbFieldInfo( DBS_DEFAULT, <nCol>, <xValue> )
or to avoid confusions we can add also dbColumnInfo()

best regards,
Przemek
From dbtopas at dbtopas.lt  Mon Sep  3 12:28:49 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Sep  3 08:30:30 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070903142931.GA19537@localhost.localdomain>
References: <20070902132927.GB15943@localhost.localdomain>	<040a01c7ed75$7a62a470$6a00a8c0@PAUL>
	<20070903142931.GA19537@localhost.localdomain>
Message-ID: <46DC3641.6000705@dbtopas.lt>

> In general if we define that NULL value should effect any of operators then
> we force modifing HVM. How it will effect different operators is unimportant
> because we can implement ant behavior, f.e. both:
>     VALUE1 <= 100 
> and
>     VALUE1 > 100
> may return false if VALUE1 has NULL attribute.
> But I do not like it because it will block us to add some compile time
> optimizations like replacing:
>     IF ! VALUE1 <= 100
> with:
>     IF VALUE1 > 100
> 
> because in first case result will be TRUE and in the second one: FALSE.

Perhaps the correct solution in this case is returning NULL value is any 
operand is NULL, i.e.
    NULL <= 100 returns NULL,
    NULL > 100 returns NULL,
    ! NULL returns NULL,
    ! (NULL <= 100) also returns NULL,
and IF NULL is treated as IF .F.


> In the future I plan to add to compiler optimization switch (not enabled
> be default) which will force much more aggressive expression reduction
> using standard math rules. 

What kind of optimization is it?! :)


> Please also note that some operations on NULL values cannot generate RT
> errors and have to be accepted by RTL functions or you will not be able
> to execute even simple BROWSE().

We can block NULL values from speading over the application. If any 
argument of function call is NULL, then function will return NULL. The 
exception is function ISNULL(). All this could be hacked inside 
hb_vmDo(). It will solve the problem of
     SET FILTER TO some_rtl_func(some_null_field) > 0
But this solutions seams to be too hacky and perhaps have many side effects.


Best regards,
Mindaugas
From druzus at priv.onet.pl  Mon Sep  3 16:05:49 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep  3 16:05:58 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <46DC3641.6000705@dbtopas.lt>
References: <20070902132927.GB15943@localhost.localdomain>
	<040a01c7ed75$7a62a470$6a00a8c0@PAUL>
	<20070903142931.GA19537@localhost.localdomain>
	<46DC3641.6000705@dbtopas.lt>
Message-ID: <20070903200549.GB20735@localhost.localdomain>

On Mon, 03 Sep 2007, Mindaugas Kavaliauskas wrote:
> >In general if we define that NULL value should effect any of operators then
> >we force modifing HVM. How it will effect different operators is 
> >unimportant
> >because we can implement ant behavior, f.e. both:
> >    VALUE1 <= 100 
> >and
> >    VALUE1 > 100
> >may return false if VALUE1 has NULL attribute.
> >But I do not like it because it will block us to add some compile time
> >optimizations like replacing:
> >    IF ! VALUE1 <= 100
> >with:
> >    IF VALUE1 > 100
> >because in first case result will be TRUE and in the second one: FALSE.
> Perhaps the correct solution in this case is returning NULL value is any 
> operand is NULL, i.e.
>    NULL <= 100 returns NULL,
>    NULL > 100 returns NULL,
>    ! NULL returns NULL,
>    ! (NULL <= 100) also returns NULL,
> and IF NULL is treated as IF .F.

It's an acceptable for me solution though in such case we will have
to allow executing code like:
    IF VALUE1
which will work until VALUE1 is NULL but after field assigning it will
stop to work if VALUE1 does not come from logical column. I do not think
it's very big problem so for me it's the best proposition presented so far.
Thank you.

> >In the future I plan to add to compiler optimization switch (not enabled
> >be default) which will force much more aggressive expression reduction
> >using standard math rules. 
> What kind of optimization is it?! :)

Some expressions can be reduced using math or logical rules.
F.e.:
    1 + x + 2 + x + 5 + x + 7 + x
can be reduced to:
    x * 4 + 15

But because Clipper does not make such optimizations and some code
may need the same RT errors as in Clipper when x is not numeric
value then I haven't added them so far (with some few minor exceptions
like reducing double negations, f.e.: !!x to x).
In previous message I presented expression like:
    ! x <= y
it can be reduced to:
    x > y
what eliminates one HVM operation (HB_P_NOT) but will change RT error
when x cannot be compared with y. So I plan to add such optimization
covered by one of -k? switches. They will not be enabled by default
and user can enable them if he does not have code which needs exact Clipper
RT errors. Such optimizations can be introduced only if our HVM will
keep basic logical and math rules and it's the reason why I do not like
anything what can break them. The idea of defining logical operation on
NULL values resolves the problem so if we decide to add them to HVM then
I will want to implement it.

> >Please also note that some operations on NULL values cannot generate RT
> >errors and have to be accepted by RTL functions or you will not be able
> >to execute even simple BROWSE().
> 
> We can block NULL values from speading over the application. If any 
> argument of function call is NULL, then function will return NULL. The 
> exception is function ISNULL(). All this could be hacked inside 
> hb_vmDo(). It will solve the problem of
>     SET FILTER TO some_rtl_func(some_null_field) > 0
> But this solutions seams to be too hacky and perhaps have many side effects.

If we will make sth like that then it will not be possible to execute
even simple BROWSE() because we will not be able to format data to
display it on the screen if it will come from NULLABLE columns. Some
default value is very helpful in such case. Having them we will not
have to update many of RTL functions and also users will not have to
update their code, f.e.

    while ! eof()
       ? "|", field1, "|", field2, "|", field3, "|", field4, "|"
       dbskip()
    enddo

will still work giving well formated output if default NULL value for
above fields after converting to strings will have the same size as not
NULL fields.

best regards,
Przemek
From dbtopas at dbtopas.lt  Mon Sep  3 18:42:15 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Sep  3 18:43:55 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070903200549.GB20735@localhost.localdomain>
References: <20070902132927.GB15943@localhost.localdomain>	<040a01c7ed75$7a62a470$6a00a8c0@PAUL>	<20070903142931.GA19537@localhost.localdomain>	<46DC3641.6000705@dbtopas.lt>
	<20070903200549.GB20735@localhost.localdomain>
Message-ID: <46DC8DC7.7090201@dbtopas.lt>

>>> In general if we define that NULL value should effect any of operators then
>>> we force modifing HVM. How it will effect different operators is 
>>> unimportant
>>> because we can implement ant behavior, f.e. both:
>>>    VALUE1 <= 100 
>>> and
>>>    VALUE1 > 100
>>> may return false if VALUE1 has NULL attribute.
>>> But I do not like it because it will block us to add some compile time
>>> optimizations like replacing:
>>>    IF ! VALUE1 <= 100
>>> with:
>>>    IF VALUE1 > 100
>>> because in first case result will be TRUE and in the second one: FALSE.
>> Perhaps the correct solution in this case is returning NULL value is any 
>> operand is NULL, i.e.
>>    NULL <= 100 returns NULL,
>>    NULL > 100 returns NULL,
>>    ! NULL returns NULL,
>>    ! (NULL <= 100) also returns NULL,
>> and IF NULL is treated as IF .F.
> 
> It's an acceptable for me solution though in such case we will have
> to allow executing code like:
>     IF VALUE1
> which will work until VALUE1 is NULL but after field assigning it will
> stop to work if VALUE1 does not come from logical column. I do not think
> it's very big problem so for me it's the best proposition presented so far.
> Thank you.

After I've tried to think in PCODE level, I'm not sure if this will work 
anymore. :/ Consider "nI++" is just "do something" and nI value is 
always NULL. In this case ELSE branch should always be selected for 
execution. But JUMP, JUMPTRUE, JUMPFALSE, NOT optimization hides THEN 
and ELSE branches.

PROC main()
LOCAL nI
    IF nI
      nI++
    ENDIF

    IF ! nI
      nI++
    ENDIF

    IF nI
    ELSE
      nI++
    ENDIF

    IF ! nI
    ELSE
      nI++
    ENDIF
RETURN

The PCODE is:
	HB_P_PUSHLOCALNEAR, 1,	/* NI */
	HB_P_JUMPFALSENEAR, 8,	/* 8 (abs: 00016) */
/* 00010 */ HB_P_LINE, 4, 0,	/* 4 */
	HB_P_LOCALINC, 1, 0,	/* NI */
/* 00016 */ HB_P_LINE, 7, 0,	/* 7 */
	HB_P_PUSHLOCALNEAR, 1,	/* NI */
	HB_P_JUMPTRUENEAR, 8,	/* 8 (abs: 00029) */
/* 00023 */ HB_P_LINE, 8, 0,	/* 8 */
	HB_P_LOCALINC, 1, 0,	/* NI */
/* 00029 */ HB_P_LINE, 11, 0,	/* 11 */
	HB_P_PUSHLOCALNEAR, 1,	/* NI */
	HB_P_JUMPTRUENEAR, 8,	/* 8 (abs: 00042) */
/* 00036 */ HB_P_LINE, 13, 0,	/* 13 */
	HB_P_LOCALINC, 1, 0,	/* NI */
/* 00042 */ HB_P_LINE, 16, 0,	/* 16 */
	HB_P_PUSHLOCALNEAR, 1,	/* NI */
	HB_P_JUMPFALSENEAR, 8,	/* 8 (abs: 00055) */
/* 00049 */ HB_P_LINE, 18, 0,	/* 18 */
	HB_P_LOCALINC, 1, 0,	/* NI */
/* 00055 */ HB_P_LINE, 20, 0,	/* 20 */


Such NULL behaviour does not fit into fundamental property, that
   IF value
     ...
   ENDIF
is the same as:
   IF ! value
   ELSE
     ...
   ENDIF

We need something to separate expression from IF statement. Maybe some 
"unoptimization compiler macro/pragma":
   IF ATOMIC_EXPRESSION(! VALUE)
     ...
         => PUSH VALUE
            NOT
            JUMPFALSE
            ...
or just function call:
   IF ! EMPTY(! VALUE)
NULL is EMPTY. A function call can help to avoid IF NULL.



> So I plan to add such optimization
> covered by one of -k? switches. They will not be enabled by default
> and user can enable them if he does not have code which needs exact Clipper
> RT errors.

Oh, yes. I've been once about committing some new optimizations to CVS, 
and I've found it will change RT error.



Good night,
Mindaugas
From dbtopas at dbtopas.lt  Mon Sep  3 19:00:29 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Sep  3 19:02:08 2007
Subject: [Harbour] Offtopic: mailing list filter
Message-ID: <46DC920D.9000203@dbtopas.lt>

BTW, I can't send no messages to the xharbour developers mailing list. I 
think here is more developers which writes to both lists. Do you have a 
similar problems?

 >    550-5.0 INVALID_DATE           Invalid Date: header (not RFC 2822)
Does anyone have problem with RFC date formatting of Thunderbird 2.0?

 >    550-1.0 FORGED_RCVD_HELO       Received: contains a forged HELO
I've tried tcpdump. EHLO command seems OK, though rDNS resolves to 
different name (some dynamic-like IP name of my internet provider).

 >    550 0.2 UPPERCASE_25_50        message body is 25-50% uppercase
This is because of a lot of PCODE :)

Best regards,
Mindaugas

=========================================

   xharbour-developers@lists.sourceforge.net
     SMTP error from remote mailer after end of data:
     host mail.sourceforge.net [66.35.250.206]: 550-SPAM:
     This message appears to be spam (6.2 points).
     550--
     550-If you believe this message was classified as spam in error,
     550-please open a Support Request at the URL below.
     550-(Please include this message in any Support Request).
     550--
     550--
     550-Spam Filtering performed by sourceforge.net.
     550-See http://spamassassin.org/tag/ for more details.
     550-Report problems to 
http://sf.net/tracker/?func=add&group_id=1&atid=200001
     550-5.0 INVALID_DATE           Invalid Date: header (not RFC 2822)
     550-1.0 FORGED_RCVD_HELO       Received: contains a forged HELO
     550 0.2 UPPERCASE_25_50        message body is 25-50% uppercase

------ This is a copy of the message, including all the headers. ------

Return-path: <dbtopas@dbtopas.lt>
Received: from [192.168.1.4] (helo=[192.168.1.4])
	by linux.dbtopas.lt with esmtp (Exim 4.44)
	id 1ISKe7-0004pH-0G; Tue, 04 Sep 2007 01:43:51 +0300
Message-ID: <46DC8DC7.7090201@dbtopas.lt>
Date: Tue, 04 Sep 2007 01:42:15 +0300
From: Mindaugas Kavaliauskas <dbtopas@dbtopas.lt>
User-Agent: Thunderbird 2.0.0.6 (Windows/20070728)
MIME-Version: 1.0
To: "Harbour Project Main Developer List." <harbour@harbour-project.org>
CC: Xharbour-Developers List <xharbour-developers@lists.sourceforge.net>
Subject: Re: [Harbour] Re: [xHarbour-developers] Extended field types in 
RDDs
Date: Tue, 04 Sep 2007 01:43:51 +0300

...

From philb at philb.us  Mon Sep  3 21:19:08 2007
From: philb at philb.us (Phil Barnett)
Date: Mon Sep  3 21:36:29 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <46DC2104.2030201@dbtopas.lt>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DC2104.2030201@dbtopas.lt>
Message-ID: <200709032119.08126.philb@philb.us>

On Monday 03 September 2007, Mindaugas Kavaliauskas wrote:
> I use SQL not very often and familiar with MySQL NULL value, and I do
> not understand the difference between NIL and NULL! :/ Is NULL in other
> SQL languages different from MySQL??

Null in SQL indicates that a value has not been assigned or is unknown.

It can make a normally logical field into a tri state field, for example:

Logic field can contain True or False

Logic field with Null can contain True False and Unknown or Not Set.

-- 
Phil Barnett
AI4OF
SKCC #600
From mhsabado at gmail.com  Mon Sep  3 21:54:09 2007
From: mhsabado at gmail.com (Mario H. Sabado)
Date: Mon Sep  3 21:54:42 2007
Subject: [Harbour] DbEval() Function Very Slow With Active With Controlling
	Index?
In-Reply-To: <46dc267d.0886460a.5b2a.ffffe021SMTPIN_ADDED@mx.google.com>
References: <46dc267d.0886460a.5b2a.ffffe021SMTPIN_ADDED@mx.google.com>
Message-ID: <46DCBAC1.4040904@gmail.com>

Budyanto & Kevin,

Thank you very much for enlightening me on this issue.  I now somehow 
understand.  The best approach for now I guess is to use" 
DbSetOrder(0)/SET ORDER TO 0" to keep the index table from being updated 
and avoid  "Jumping Off" situation.

Best regards,
Mario
From philb at philb.us  Mon Sep  3 22:33:34 2007
From: philb at philb.us (Phil Barnett)
Date: Mon Sep  3 22:34:44 2007
Subject: [Harbour] DbEval() Function Very Slow With Active With
	=?iso-8859-1?q?Controlling=09Index=3F?=
In-Reply-To: <46DC316C.16740.F01798A@localhost>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
	<46DC316C.16740.F01798A@localhost>
Message-ID: <200709032233.34811.philb@philb.us>

On Monday 03 September 2007, Budyanto Dj. wrote:

> Dbeval()'s block is not executed 10 times, but 18 times because you are
> replacing index key.

Should we perform a set order to 0 inside our RDD layer while building an 
index and then return the correct order when we are done?

This would eliminate this behavior without changing source code. I can't 
imagine any time when an order should be set while building an index...

-- 
Phil Barnett
AI4OF
SKCC #600
From druzus at priv.onet.pl  Mon Sep  3 23:08:58 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep  3 23:09:04 2007
Subject: [Harbour] DbEval() Function Very Slow With Active With
	Controlling	Index?
In-Reply-To: <200709032233.34811.philb@philb.us>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
	<46DC316C.16740.F01798A@localhost>
	<200709032233.34811.philb@philb.us>
Message-ID: <20070904030858.GA30230@localhost.localdomain>

On Mon, 03 Sep 2007, Phil Barnett wrote:
> > Dbeval()'s block is not executed 10 times, but 18 times because you are
> > replacing index key.
> Should we perform a set order to 0 inside our RDD layer while building an 
> index and then return the correct order when we are done?

The problem was in function Dbeval() which was changing the index key
not inside index creation code.
In this case It was bug in user code and we cannot make anything with it.
It's even possible that for some reasons user may want to create infinite
loop which will update table in such way so we mustn't try to change it.
If users creates code like in the example and we are doing exactly what
he wrote but he only expect sth different then it's not our problem.

> This would eliminate this behavior without changing source code. I can't 
> imagine any time when an order should be set while building an index...

WHILE, REST, NEXT, USECURRENT clauses in INDEX ON command forces to use
current order. In all other cases DBFNTX and DBFCDX switch internally
to order 0 so now we are doing what you asked but in this case it was
not building index problem so it's not bound with reported problem.

best regards,
Przemek
From sscc at mweb.co.za  Tue Sep  4 03:38:15 2007
From: sscc at mweb.co.za (Alex Strickland)
Date: Tue Sep  4 03:38:33 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <46DC2104.2030201@dbtopas.lt>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DC2104.2030201@dbtopas.lt>
Message-ID: <46DD0B67.6080905@mweb.co.za>

Mindaugas Kavaliauskas wrote:
> Przemyslaw Czerpak wrote:
>> Adding support for NULL flag may be a little bit
>> problematic because our HVM/Clipper does not support such idea. We can
>> make some tricks with mapping to NIL or only add functions to check NULL
>> flag directly in table without NULL variables. We can also introduce real
>> NULL flag to HVM.
>> Here is my first QUESTION:
>>    (1) Should we add real NULL flag support to HVM?
> 
> I use SQL not very often and familiar with MySQL NULL value, and I do 
> not understand the difference between NIL and NULL!

A while ago I asked Przemyslaw:

 >>It is somtimes very useful to have NIL values. Can you tell me why 
 >>having strong typing excludes the possibility?

He said:

 >Strong typing should force types declared by programmer.
 >We can break it but in such case why we should have strong typing?
 >To make .prg code longer ;-)
 >The second thing is compile time optimization if you want to have
 >sth more then compile time warning generator.
 >Compiler having information about strict variable type can generate
 >different code, optimized for such type but it's necessary to be
 >sure that variable has such exact type not sth different like NIL

I did not agree, but frankly didn't feel I have the technical authority 
to voice that. However, bringing NULL support to the HVM sounds a lot 
like what I was originally thinking about, whether or not strong typing 
is introduced.

I see no conflict (for example) in declaring a variable to be of type 
NUMERIC and yet allowing it to be NIL (NULL), that is, not set. Clipper 
has a long history of being database "friendly", and I think this is a 
reasonable continuation of that policy.

Regards
Alex
From info at fsgiudice.com  Tue Sep  4 03:39:16 2007
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Tue Sep  4 03:40:04 2007
Subject: [Harbour] Extended field types in RDDs
References: <20070901114750.GB9374@localhost.localdomain><46DC2104.2030201@dbtopas.lt>
	<200709032119.08126.philb@philb.us>
Message-ID: <001a01c7eec6$b40aa400$b400a8c0@ASUSFSG>

----- Original Message ----- 
From: "Phil Barnett" <philb@philb.us>
To: <harbour@harbour-project.org>
Sent: Tuesday, September 04, 2007 3:19 AM
Subject: Re: [Harbour] Extended field types in RDDs


> On Monday 03 September 2007, Mindaugas Kavaliauskas wrote:
>> I use SQL not very often and familiar with MySQL NULL value, and I do
>> not understand the difference between NIL and NULL! :/ Is NULL in other
>> SQL languages different from MySQL??
>
> Null in SQL indicates that a value has not been assigned or is unknown.
>
> It can make a normally logical field into a tri state field, for example:
>
> Logic field can contain True or False
>
> Logic field with Null can contain True False and Unknown or Not Set.
>

Sorry for jump in without have read all mail of this thread with attention, 
but I need to understand above sentence:

> Logic field can contain True or False

but as memvar variable it can has also NIL value that means: Unknown or Not 
Set.
Exactly what it means NULL.

so what is missing is to have NIL value also at field level that, unless we 
need to have a NULLABLE field type to recognize where a NULL value (NIL) can 
be stored, but could be the same having a "NILLABLE" field ?

Sorry again if this was already explained.

Best Regards
Francesco
From miguelangel at marchuet.net  Tue Sep  4 04:04:21 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Tue Sep  4 04:09:32 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070903152049.GB19537@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
	<20070903152049.GB19537@localhost.localdomain>
Message-ID: <46DD1185.7020107@marchuet.net>

	
VFP uses the following Array and is possible that sooner or later we also need it.

For that reason I believe that we must to preveer these necessities.


   Field info  				Data type
1 Field name  				Character
2 Field type:

C = Character

Y = Currency

D = Date

T = DateTime

B = Double

F = Float

G = General

I = Integer

L = Logical

M = Memo

N = Numeric

Q = Varbinary

V = Varchar and Varchar (Binary)

W = Blob
					Character

3 Field width 				Numeric
4 Decimal places			Numeric
5 Null values allowed 			Logical
6 Code page translation not allowed	Logical
7 Field validation expression 		Character
8 Field validation text 		Character
9 Field default value 			Character
10 Table validation expression 		Character
11 Table validation text		Character
12 Long table name 			Character
13 Insert trigger expression            Character
14 Update trigger expression 		Character
15 Delete trigger expression		Character
16 Table comment 			Character
17 NextValue for autoincrementing 	Numeric
18 Step for autoincrementing 		Numeric


For example i'm thinking about to implement trigers as in SixRDD or similar.


   Sx_DefTrigger():

   Syntax:   Sx_DefTrigger( <nEvent>, <nArea>, <nFieldPos>, <xTrigVal> )

         nEvent = A numeric value indicating the type of event that is
                  activating the trigger.  These values are defined as
                  manifest constants in the SIXCDX.CH file, and are as
                  follows:

                  EVENT_PREUSE       = A DBF file is about to be opened
                * EVENT_POSTUSE      = A DBF file has just been opened
                * EVENT_UPDATE       = An index is being updated
                  EVENT_APPEND       = A new record is being appended
                  EVENT_DELETE       = A record is being deleted
                  EVENT_RECALL       = A deleted record is being recalled
                  EVENT_PACK         = The DBF file is being packed
                  EVENT_ZAP          = The DBF file is being zapped
                  EVENT_PUT          = A value is being stored in the DBF
                  EVENT_GET          = A value is being retrieved from the DBF
                  EVENT_PRECLOSE     = The DBF file is about to be closed
                * EVENT_POSTCLOSE    = The DBF file has just been closed
                  EVENT_PREMEMOPACK  = A MEMOPACK is just about to occur
                  EVENT_POSTMEMOPACK = A MEMOPACK has just been completed

                  NOTE:  Although these constants preprocess into numeric
                         values, you should not use the numeric values in
                         your source code.  Instead, you should use the
                         constants, as defined above.  This will insure
                         compatibility with all future releases of the
                         SIx Driver.

                (*) - The events marked with an asterisk (*) will continue
                      even if the return value for that event is set to false
                      (.F.).  This is to insure data integrity.

          nArea = The currently active workarea number.

      nFieldPos = The field position for the PUT or GET, if applicable.

       xTrigVal = This parameter contains the value, if any, associated with
                  the event being processed.  If no value of significance is
                  associated with the event, a zero (0) is passed down.

   Returns:   Logical.  TRUE (.T.) if the current event should be allowed to
              successfully complete, FALSE (.F.) if not.

   Description:  By default, this function is automatically called whenever
                 any of the events listed above occurs.  It contains the
                 default triggers (none) to be attached to each event.

                 The parameters are passed to it automatically by the SIx
                 Driver.  This is similar to the way parameters are
                 automatically passed to a UDF used in Clipper's MemoEdit()
                 or AChoice() functions.

                 To cause the SIx Driver to use a different set of triggers,
                 you would USE the file with the TRIGGER keyword, specifying
                 the name of the desired trigger function in quotes.  For
                 example, to use a modified Sx_DefTrigger() function called
                 DemoTrigger(), you would do this:

                     USE test VIA "SIXCDX" TRIGGER "DemoTrigger"

                 This would cause all triggerable events for this workarea to
                 be handled through DemoTrigger(), rather than the SIx
                 Driver's default Sx_DefTrigger() function.

                 The Clipper source code for Sx_DefTrigger() is contained in
                 SIXTRIG.PRG, and can be modified as desired.  Just insure
                 that the new SIXTRIG.OBJ module is linked into your
                 application ahead of the SIXCDX.LIB file.  The complete
                 source for Sx_DefTrigger() is also listed below in the
                 Example section.

                 In its present condition, Sx_DefTrigger() maintains the
                 exact same behavior as in previous SIx Driver releases.
                 The call to Sx_SetTrigger( TRIGGER_REMOVE ) under the
                 EVENT_PREUSE case effectively removes the trigger controls
                 just prior to a database being opened.  To allow support
                 for event trigger handling, just comment out this call to
                 Sx_SetTrigger().

                 Also, if you want the SIx Driver to automatically look for
                 an associated .INI file when a .DBF is USEd, you need to
                 uncomment the _sx_INIinit( nArea ) call.  See the section
                 on ".INI Files" for more details on these.  The _sx_INIinit()
                 function can ONLY be used in this manner.  If it is called
                 anywhere else in your application, unpredictable results can
                 occur.


     NOTE:  See the TRIGDEMO.PRG file for an example of using event triggers.


   Example:

     #include "SIXCDX.CH"

     FUNC Sx_DefTrigger( nEvent, nArea, nFieldPos, xTrigVal )

       DO CASE

         CASE nEvent == EVENT_PREUSE
     //    _sx_INIinit( nArea )
           Sx_SetTrigger( TRIGGER_REMOVE )

         CASE nEvent == EVENT_POSTUSE

         CASE nEvent == EVENT_UPDATE

         CASE nEvent == EVENT_APPEND

         CASE nEvent == EVENT_DELETE

         CASE nEvent == EVENT_RECALL

         CASE nEvent == EVENT_PACK

         CASE nEvent == EVENT_ZAP

         CASE nEvent == EVENT_PUT

         CASE nEvent == EVENT_GET

         CASE nEvent == EVENT_PRECLOSE

         CASE nEvent == EVENT_POSTCLOSE

         CASE nEvent == EVENT_PREMEMOPACK

         CASE nEvent == EVENT_POSTMEMOPACK

       ENDCASE

     Return( .T. )


Best regards,
Miguel Angel Marchuet
From devlist.harbour at gmail.com  Tue Sep  4 04:17:05 2007
From: devlist.harbour at gmail.com (Patrick Mast, xHarbour.com)
Date: Tue Sep  4 04:17:16 2007
Subject: [Harbour] HB_aTokens() bug?
In-Reply-To: <20070904030858.GA30230@localhost.localdomain>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
	<46DC316C.16740.F01798A@localhost>
	<200709032233.34811.philb@philb.us>
	<20070904030858.GA30230@localhost.localdomain>
Message-ID: <5741C247-C176-4E66-BCAC-39835F19371C@GMail.com>

Hi,

Paul Tucker just synced HB_aTokens form Harbour with xHarbour.
Now I noticed:

? Len( HB_aTokens( "", " ") )
returns 1
Should it not be 0 ?

And:

? Len( HB_aTokens( "a", "b") )
returns 1
Should it also not be 0 ?

Thanks

Patrick

From druzus at priv.onet.pl  Tue Sep  4 04:47:10 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep  4 04:47:16 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <46DD0B67.6080905@mweb.co.za>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DC2104.2030201@dbtopas.lt> <46DD0B67.6080905@mweb.co.za>
Message-ID: <20070904084710.GA31614@localhost.localdomain>

On Tue, 04 Sep 2007, Alex Strickland wrote:
> >>It is somtimes very useful to have NIL values. Can you tell me why 
> >>having strong typing excludes the possibility?
> He said:
> >Strong typing should force types declared by programmer.
> >We can break it but in such case why we should have strong typing?
> >To make .prg code longer ;-)
> >The second thing is compile time optimization if you want to have
> >sth more then compile time warning generator.
> >Compiler having information about strict variable type can generate
> >different code, optimized for such type but it's necessary to be
> >sure that variable has such exact type not sth different like NIL

It was about keeping NIL value in strong typed items and it's not
bound with NULL.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep  4 04:47:59 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep  4 04:48:05 2007
Subject: [Harbour] HB_aTokens() bug?
In-Reply-To: <5741C247-C176-4E66-BCAC-39835F19371C@GMail.com>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
	<46DC316C.16740.F01798A@localhost>
	<200709032233.34811.philb@philb.us>
	<20070904030858.GA30230@localhost.localdomain>
	<5741C247-C176-4E66-BCAC-39835F19371C@GMail.com>
Message-ID: <20070904084759.GB31614@localhost.localdomain>

On Tue, 04 Sep 2007, Patrick Mast, xHarbour.com wrote:
> Paul Tucker just synced HB_aTokens form Harbour with xHarbour.
> Now I noticed:
> ? Len( HB_aTokens( "", " ") )
> returns 1
> Should it not be 0 ?

yes.

> And:
> ? Len( HB_aTokens( "a", "b") )
> returns 1
> Should it also not be 0 ?

No. it should be 1

best regards,
Przemek
From devlist.harbour at gmail.com  Tue Sep  4 04:56:03 2007
From: devlist.harbour at gmail.com (Patrick Mast, xHarbour.com)
Date: Tue Sep  4 04:56:15 2007
Subject: [Harbour] HB_aTokens() bug?
In-Reply-To: <20070904084759.GB31614@localhost.localdomain>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
	<46DC316C.16740.F01798A@localhost>
	<200709032233.34811.philb@philb.us>
	<20070904030858.GA30230@localhost.localdomain>
	<5741C247-C176-4E66-BCAC-39835F19371C@GMail.com>
	<20070904084759.GB31614@localhost.localdomain>
Message-ID: <15B5A92F-5A82-40F9-8E03-C4B33937E7CD@GMail.com>

Hello Przemek,

>> Paul Tucker just synced HB_aTokens form Harbour with xHarbour.
>> Now I noticed:
>> ? Len( HB_aTokens( "", " ") )
>> returns 1
>> Should it not be 0 ?
> yes.

Ok.

>> And:
>> ? Len( HB_aTokens( "a", "b") )
>> returns 1
>> Should it also not be 0 ?
> No. it should be 1

But there there is no delimiter 'b' found in string in 'a'. So, I can  
not divide string 'a' in parts delimited by 'b'. Resulting in no  
array to be returned.

No?

Patrick
From druzus at priv.onet.pl  Tue Sep  4 05:06:14 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep  4 05:06:21 2007
Subject: [Harbour] HB_aTokens() bug?
In-Reply-To: <15B5A92F-5A82-40F9-8E03-C4B33937E7CD@GMail.com>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
	<46DC316C.16740.F01798A@localhost>
	<200709032233.34811.philb@philb.us>
	<20070904030858.GA30230@localhost.localdomain>
	<5741C247-C176-4E66-BCAC-39835F19371C@GMail.com>
	<20070904084759.GB31614@localhost.localdomain>
	<15B5A92F-5A82-40F9-8E03-C4B33937E7CD@GMail.com>
Message-ID: <20070904090614.GA31888@localhost.localdomain>

On Tue, 04 Sep 2007, Patrick Mast, xHarbour.com wrote:
> >>? Len( HB_aTokens( "a", "b") )
> >>returns 1
> >>Should it also not be 0 ?
> >No. it should be 1
> But there there is no delimiter 'b' found in string in 'a'. So, I can  
> not divide string 'a' in parts delimited by 'b'. Resulting in no  
> array to be returned.

Why???
If no delimiters found then given text cannot be divided so we have only
one token equal to original text.
Just think about text line without EOL character, f.e.:

    aText := HB_aTokens( memoread( "msg.txt", hb_osNewLine() ) )

will not work as expected if msg.txt will have only one line without EOL.

best regards,
Przemek
From sscc at mweb.co.za  Tue Sep  4 05:06:34 2007
From: sscc at mweb.co.za (Alex Strickland)
Date: Tue Sep  4 05:06:49 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070904084710.GA31614@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>	<46DC2104.2030201@dbtopas.lt>
	<46DD0B67.6080905@mweb.co.za>
	<20070904084710.GA31614@localhost.localdomain>
Message-ID: <46DD201A.5080201@mweb.co.za>

Przemyslaw Czerpak wrote:

> It was about keeping NIL value in strong typed items and it's not
> bound with NULL.

Yes, but firstly, as Mindaugus asks, can you tell me the difference 
between NIL and NULL? They both mean "not set" to me. It is true at the 
moment that :
	? 1 + NIL
generates an error, but part of this discussion is what we want :
	? 1 + NULL
to mean, if it is introduced. It could have the same meaning as NIL. Why 
do we need it to be different, what do we lose by making it the same?

Secondly, I cannot see why strong typing makes allowing NIL values 
pointless?  You say "to make .prg code longer", I don't see why.

I do take your point about optimisation, but I don't think that should 
be the focus of this language (or even be regarded as important), it is 
very deliberately not C.

Regards
Alex
From druzus at priv.onet.pl  Tue Sep  4 06:03:07 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep  4 06:03:14 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <46DD201A.5080201@mweb.co.za>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DC2104.2030201@dbtopas.lt> <46DD0B67.6080905@mweb.co.za>
	<20070904084710.GA31614@localhost.localdomain>
	<46DD201A.5080201@mweb.co.za>
Message-ID: <20070904100307.GA764@localhost.localdomain>

On Tue, 04 Sep 2007, Alex Strickland wrote:
> >It was about keeping NIL value in strong typed items and it's not
> >bound with NULL.
> Yes, but firstly, as Mindaugus asks, can you tell me the difference 
> between NIL and NULL? They both mean "not set" to me. It is true at the 
> moment that :
> 	? 1 + NIL
> generates an error, but part of this discussion is what we want :
> 	? 1 + NULL
> to mean, if it is introduced. It could have the same meaning as NIL. Why 
> do we need it to be different, what do we lose by making it the same?

Without some default value and information about basic formating BROWSE
and any code which tries to format field will crash or will give wrong
results.

> Secondly, I cannot see why strong typing makes allowing NIL values 
> pointless?  You say "to make .prg code longer", I don't see why.

Why NIL value is different then f.e. logical.
If I declare item as DATE then I expect that I can assign only DATE
to this item not NIL or logical or any other value.
Strong typing should help me in early detecting bugs. If by mistake
I'll assign NIL to NUMERIC item then I should have RT error immediately
not hundreds line later when I'll try to make some math operation on
this item because it's not the real place of bug.

I know that in xHarbour type declarations in classy code does
not work at all and many people have problem with Harbour which
restricts types by default by if you do not like it then simply
disable any AS <type> code in hbclass.ch and you will have the
same results as in xHarbour - not working type checking at all.
BTW current Harbour behavior is Class(y) compatible so it's not only
my opinion that it should work in such way.
Maybe in some spare time I'll introduce mixed types like
    AS DATE OR NIL
or sth like that and if you will want to mix types then it will be
possible. If you declare that some object item has given type(s) then
Harbour respects it. This is "strong typing".

> I do take your point about optimisation, but I don't think that should 
> be the focus of this language (or even be regarded as important), it is 
> very deliberately not C.

This time I haven't wrote anything about optimization.

best regards,
Przemek
From sscc at mweb.co.za  Tue Sep  4 06:34:49 2007
From: sscc at mweb.co.za (Alex Strickland)
Date: Tue Sep  4 06:35:04 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070904100307.GA764@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>	<46DC2104.2030201@dbtopas.lt>
	<46DD0B67.6080905@mweb.co.za>	<20070904084710.GA31614@localhost.localdomain>	<46DD201A.5080201@mweb.co.za>
	<20070904100307.GA764@localhost.localdomain>
Message-ID: <46DD34C9.5040603@mweb.co.za>

Przemyslaw Czerpak wrote:

> Without some default value and information about basic formating BROWSE
> and any code which tries to format field will crash or will give wrong
> results.

I see that, but I am not sure it is an answer about the difference 
between NIL and NULL. We could never store NIL before, now we are saying 
we could have NULL which *would* mean change, but I do not see a strong 
semantic difference between NIL and NULL. Do you?

> Why NIL value is different then f.e. logical.

I can see that NIL could be seen as a type (as you say below), but, I 
rather think of it as extending the range of possible values for the 
types. I think that is what NULL does in SQL.

> If I declare item as DATE then I expect that I can assign only DATE
> to this item not NIL or logical or any other value.
> Strong typing should help me in early detecting bugs. If by mistake
> I'll assign NIL to NUMERIC item then I should have RT error immediately
> not hundreds line later when I'll try to make some math operation on
> this item because it's not the real place of bug.

Well my argument would be that the date certainly can't be assigned a 
numeric or logical, but it could be assigned NIL. I also think that the 
main advantage of strong typing is not run time error detection, but 
compile time error detection. It is what we consider as an error that is 
up for debate.

> BTW current Harbour behavior is Class(y) compatible so it's not only
> my opinion that it should work in such way.

Sure, that is a good point, I can easily live with it. But if you 
introduce NULL to the HVM then Anton van Straten (?) may have had a 
different view.

> Maybe in some spare time I'll introduce mixed types like
>     AS DATE OR NIL
> or sth like that and if you will want to mix types then it will be
> possible. If you declare that some object item has given type(s) then
> Harbour respects it. This is "strong typing".

That is certainly a very clear way to introduce strong typing with 
allowable NILs (or NULLs).

> This time I haven't wrote anything about optimization.

No.

Regards
Alex

From philb at philb.us  Tue Sep  4 06:43:44 2007
From: philb at philb.us (Phil Barnett)
Date: Tue Sep  4 06:45:11 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070904100307.GA764@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DD201A.5080201@mweb.co.za>
	<20070904100307.GA764@localhost.localdomain>
Message-ID: <200709040643.44910.philb@philb.us>

On Tuesday 04 September 2007, Przemyslaw Czerpak wrote:
> If I declare item as DATE then I expect that I can assign only DATE
> to this item not NIL or logical or any other value.

This is certainly the way most other strongly typed languages are working, for 
example, .net.

-- 
Phil Barnett
AI4OF
SKCC #600
From philb at philb.us  Tue Sep  4 06:46:44 2007
From: philb at philb.us (Phil Barnett)
Date: Tue Sep  4 06:47:59 2007
Subject: [Harbour] HB_aTokens() bug?
In-Reply-To: <15B5A92F-5A82-40F9-8E03-C4B33937E7CD@GMail.com>
References: <46dbb2dc.2787460a.2a71.ffffd543SMTPIN_ADDED@mx.google.com>
	<20070904084759.GB31614@localhost.localdomain>
	<15B5A92F-5A82-40F9-8E03-C4B33937E7CD@GMail.com>
Message-ID: <200709040646.44932.philb@philb.us>

On Tuesday 04 September 2007, Patrick Mast, xHarbour.com wrote:
> Hello Przemek,
>
> >> Paul Tucker just synced HB_aTokens form Harbour with xHarbour.
> >> Now I noticed:
> >> ? Len( HB_aTokens( "", " ") )
> >> returns 1
> >> Should it not be 0 ?
> >
> > yes.
>
> Ok.
>
> >> And:
> >> ? Len( HB_aTokens( "a", "b") )
> >> returns 1
> >> Should it also not be 0 ?
> >
> > No. it should be 1
>
> But there there is no delimiter 'b' found in string in 'a'. So, I can
> not divide string 'a' in parts delimited by 'b'. Resulting in no
> array to be returned.
>
> No?

No, it should be 1.

If it was "aba" and "b", it would be two, so "a" and "b" would be one.

-- 
Phil Barnett
AI4OF
SKCC #600
From rglab at przesiew.imid.med.pl  Tue Sep  4 07:26:24 2007
From: rglab at przesiew.imid.med.pl (Ryszard Glab)
Date: Tue Sep  4 07:15:54 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070901114750.GB9374@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
Message-ID: <46DD5D00.8684.675629@rglab.przesiew.imid.med.pl>

On 1 Sep 2007 at 13:47, Przemyslaw Czerpak wrote:

> Here is my first QUESTION:
>    (1) Should we add real NULL flag support to HVM?

  I belive that NULL should be a separate item type to support future 
implementations of SQLRDD. Please notice that in SQL the NULL value 
can be used for any field, especially when two or more tables are 
joined. 
  This will be helpful also when harbour will support strong typing. 
F.e. the value of type HB_IT_NUMERIC should generate the runtime 
error if NIL value will be assigned however the NULL value should be 
allowed because this value can be returned from the underlying 
database.

> My second QUESTION:
>    (2) What structure should we chose for dbCreate()/dbStruct() array?

  IMHO, we should add the 5-th parameter - however this 5-th 
parameter should be an array of two values:
[1] - will be additional bit flags
[2] - will be NIL or any value required by the RDD, for example 
definition of trigger, default value, picture format etc.

> My third QUESTION is:
>    (3) What structures/types should we use for internal RDD field
>        representation?

  I belive that we need two additional fields in DBFIELDINFO
uiFieldType,
uiFieldFlags,

I will leave uiType as is, which means that it should hold HB_IT_* 
type that is used inside the HVM. uiFieldType should store the real 
filed type stored in the table. This allows for automatic mapping of 
database type into HVM type. For example in MySQL there is a type
DATETIME which have format 'YYYY-MM-DD hh:mm:ss'
and
TIMESTAMP (modify time) which also have format 'YYYY-MM-DD hh:mm:ss'
so both types can be mapped to future HB_IT_DATETIME however 
TIMESTAMP should be readonly field updated only by the low level 
code.

Regards, Ryszard
From makis1970 at gmail.com  Tue Sep  4 07:52:34 2007
From: makis1970 at gmail.com (Mike Evans (Gmail))
Date: Tue Sep  4 07:57:51 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <200709040643.44910.philb@philb.us>
References: <20070901114750.GB9374@localhost.localdomain>	<46DD201A.5080201@mweb.co.za>	<20070904100307.GA764@localhost.localdomain>
	<200709040643.44910.philb@philb.us>
Message-ID: <002401c7eeea$1ab0c9a0$50125ce0$@com>

Phil,
It's not exactly true. From .Net 2.0 and later they have support for
nullables types. So maybe a better solution will be something like Local
lala as Int nullable if we want to support null in datatypes. The default
must be what we have now.

Regards
Mike Evans

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Phil Barnett
Sent: Tuesday, September 04, 2007 1:44 PM
To: harbour@harbour-project.org
Subject: Re: [Harbour] Extended field types in RDDs

On Tuesday 04 September 2007, Przemyslaw Czerpak wrote:
> If I declare item as DATE then I expect that I can assign only DATE
> to this item not NIL or logical or any other value.

This is certainly the way most other strongly typed languages are working,
for 
example, .net.

-- 
Phil Barnett
AI4OF
SKCC #600
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Tue Sep  4 17:32:43 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep  4 17:32:50 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <46DC8DC7.7090201@dbtopas.lt>
References: <20070902132927.GB15943@localhost.localdomain>
	<040a01c7ed75$7a62a470$6a00a8c0@PAUL>
	<20070903142931.GA19537@localhost.localdomain>
	<46DC3641.6000705@dbtopas.lt>
	<20070903200549.GB20735@localhost.localdomain>
	<46DC8DC7.7090201@dbtopas.lt>
Message-ID: <20070904213243.GA22871@localhost.localdomain>

On Tue, 04 Sep 2007, Mindaugas Kavaliauskas wrote:
> After I've tried to think in PCODE level, I'm not sure if this will work 
> anymore. :/ Consider "nI++" is just "do something" and nI value is 
> always NULL. In this case ELSE branch should always be selected for 
> execution. But JUMP, JUMPTRUE, JUMPFALSE, NOT optimization hides THEN 
> and ELSE branches.

We can define that JUMPTRUE and JUMPFALSE when top most stack value
is NULL will be executed. It's as good condition as any other.

> Such NULL behaviour does not fit into fundamental property, that
>   IF value
>     ...
>   ENDIF
> is the same as:
>   IF ! value
>   ELSE
>     ...
>   ENDIF

We will have funny result. When optimization is enabled for both
statements we have the same PCODE so with above condition '...' will
not be executed.
When optimization is disabled (-kJ) then we have different PCODE and
when 'value' is NULL first '...' is skipped but next one executed.

> We need something to separate expression from IF statement. Maybe some 
> "unoptimization compiler macro/pragma":
>   IF ATOMIC_EXPRESSION(! VALUE)
>     ...
>         => PUSH VALUE
>            NOT
>            JUMPFALSE
>            ...
> or just function call:
>   IF ! EMPTY(! VALUE)
> NULL is EMPTY. A function call can help to avoid IF NULL.

Some functions which will convert NULL to other defined ones
resolves the problem.
Executing conditional jumps resolves the problem for simple
IF statements but inside LOOPs when backward jumps appears
it will not be enough. F.e. if you compile these two loops:

    while .t.
       ++nI
       if value
          exit
       endif
    enddo

    while .t.
       ++nI
       if !value
          loop
       endif
       exit
    enddo

with -l switch (I should look for enabling some jump optimizations
also when line numbers are generated) then our PCODE optimizer will
be good enough to generate exactly the same PCODE (optimal) for both
of them what clearly shows that later in HVM we cannot take good
decision in one of the above cases.
Please note that without LOOPs when only forward conditional jumps are
generated we can accept that both JUMPTRUE and JUMPFALSE are executed
for NULL value and we will always have some acceptable results. With
good expression optimization it will be what we need in most cases.
It's enough for all macro/codeblock expressions and for most of
IF/ELSE statements but WHILE and FOR can cause serious troubles.
So DBMS which operates only on simple expressions (just like our
macro expressions) do not have such problem.
VFP has support for NULL. I'm really interested how it defines some
operations on this value.

> >So I plan to add such optimization
> >covered by one of -k? switches. They will not be enabled by default
> >and user can enable them if he does not have code which needs exact Clipper
> >RT errors.
> Oh, yes. I've been once about committing some new optimizations to CVS, 
> and I've found it will change RT error.

I'll add ASAP compiler switch (f.e. -kO) so it will be possible to add
such optimizations without breaking compatibility in default compiler
mode.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep  4 19:10:48 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep  4 19:10:54 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <46DD5D00.8684.675629@rglab.przesiew.imid.med.pl>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DD5D00.8684.675629@rglab.przesiew.imid.med.pl>
Message-ID: <20070904231048.GB22871@localhost.localdomain>

On Tue, 04 Sep 2007, Ryszard Glab wrote:
> > Here is my first QUESTION:
> >    (1) Should we add real NULL flag support to HVM?
>   I belive that NULL should be a separate item type to support future 
> implementations of SQLRDD. Please notice that in SQL the NULL value 
> can be used for any field, especially when two or more tables are 
> joined. 
>   This will be helpful also when harbour will support strong typing. 
> F.e. the value of type HB_IT_NUMERIC should generate the runtime 
> error if NIL value will be assigned however the NULL value should be 
> allowed because this value can be returned from the underlying 
> database.

OK - it's easy to do. Much more complicated is using NULL values in
conditional expressions which control some statements, f.e. loops.
I do not see any easy way to reproduce most commonly used DBMS logic
without introducing undefined states. Seems that we will have to
generate RT errors for conditional jumps executed for NULL value.
It will still interact with -z optimization but seems to be much
better then undefined results.

> > My second QUESTION:
> >    (2) What structure should we chose for dbCreate()/dbStruct() array?
>   IMHO, we should add the 5-th parameter - however this 5-th 
> parameter should be an array of two values:
> [1] - will be additional bit flags
> [2] - will be NIL or any value required by the RDD, for example 
> definition of trigger, default value, picture format etc.

Interesting but IMHO it will more complicated then necessary.
We will still have many different columns but in more dimensions.
I'm interesting if we can define all possible non binary column
attributes used in different DBMS to see how complicated will
be addressing most of them.
We have VFP structure array. I do not know why some of attributes
are defined in columns but when I'll find some VFP description then
probably I could sat sth more.

> > My third QUESTION is:
> >    (3) What structures/types should we use for internal RDD field
> >        representation?
>   I belive that we need two additional fields in DBFIELDINFO
> uiFieldType,
> uiFieldFlags,
> 
> I will leave uiType as is, which means that it should hold HB_IT_* 
> type that is used inside the HVM.

So far we do not use uiType values in non RDD code. Even more:
HB_IT_* values used in field uiType do not have the same meaning
then HB_ITEM types in HVM (just like in Clipper). So I do not
see big reason to keep it. HB_IT_* where used to mark some field
types with exact correlations to HVM types. IMHO it only confuse
developers. Anyhow I can understand that some information about
field translation to HVM types will be usefull. But in such case
we should keep also other HB_ITEM attributes in DBFIELD structure,
f.e. uiLen used in HVM may be different then the one used in database.
So if we decide to keep information about translation to HVM types
then I will vote to also add other HB_ITEM attributes to DBFIELD
structure.

> uiFieldType should store the real 
> filed type stored in the table. This allows for automatic mapping of 
> database type into HVM type. For example in MySQL there is a type
> DATETIME which have format 'YYYY-MM-DD hh:mm:ss'
> and
> TIMESTAMP (modify time) which also have format 'YYYY-MM-DD hh:mm:ss'
> so both types can be mapped to future HB_IT_DATETIME however 
> TIMESTAMP should be readonly field updated only by the low level 
> code.

For tests I implemented HB_FF_* flags and added DATETIME and MODTIME
types to DBF RDD. They are now mapped to 'YYYY/MM/DD hh:mm:ss.mmm'
and work without any HB_IT_*. Just like for current code we have to
define some translations from HB_IT_* used in DBFIELD->uiType to HVM
HB_ITEM types I defined such translations for HB_FF_* types so it's
not a problem. It's even less complicated because we have simpler
code (less conditions to check). I added support for these fields
also to DELIM and SDF RDDs so you can export them from DBF.
This is very important feature - if we define translations for
different HB_FF_* types then without any additional modifications
new RDDs will nicely works with other RDDs in export/import operations.
If you think that defining by us translation rules for HB_FF_* types
is not good idea then we can add also HB_IT_* types but IMHO without
other HB_ITEM attributes it does not make big sense because we
will still need some translation rules for HB_FF_* types, f.e. to
calculate default column size in browse.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep  4 19:16:36 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep  4 19:16:50 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070901114750.GB9374@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
Message-ID: <043F29A6-D7A6-4BFA-9345-F2E55372CF10@syenar.hu>

Hi Przemek,

> Here is my first QUESTION:
>    (1) Should we add real NULL flag support to HVM?

IMO the practical usage of NIL in Clipper is pretty similar
to the usage of NULL in SQL.

So for the sake of simplicity and ease-of-use (which are
elementary properties of Clipper) I'd definitely consider
_not_ adding a separate NULL to language, but rather map
Clipper's NIL to similar functionality.

NULL in SQL used to be a PITA and a ground for lots of
mistakes as far I see it, so if there just a remote chance
to avoid duplicating the whole SQL NULL mess in Clipper,
I think we should try to.

Adding NULL to Clipper would create a bunch of language
level complexities regarding the several different possible
combination of values in expressions, with all the related
support and learning curve problems.

> If we will try to used field type like in ADS also for flags
> then we will have really long description, hard to parse and
> use, f.e.:
>    "MEMVAR_COMPRESSED_ENCRYPTED_BINARY"

In a somewhat more freetext form, but I that was what
came to my mind too.

> so IMHO it's not real solution.
> In new FlagShip versions the first letter of field type is table
> field type and next ones are flags, f.e. for above we will have:
>    "MCEB"
> This seems to be much better solution for me and probably is less
> intrusive for existing code.

The number of flags is limited this way, plus not very
self-explanatory (well, just like for "PICTURE" chars).

Maybe we can have them both supported:
"M,C,E,B" = "MEMVAR,COMPRESSED,ENCRYPTED"

This is basically a tag list with some rules regarding the
possible values and separators. In a more generic way, this
is pretty similar to parsing a command line for switches
and options with values.

> We can also add additional columns to dbStructur() array.
> In such way works CLIP (www.itk.ru) where 5-th column has logical
> value with BINARY flag and 6-th  logical value with NULLABLE flag.
> The bad thing with above is that when we will want to add other
> flags the structure array will grow up and finally it will be
> too huge to easy manage it.
>
> We can also make sth between FlagShip and CLIP. We can extend
> structure array but add only one 5-th character column with
> flags described like in FlagShip. Alternatively it can be numeric
> column with bit field for different flags.
> This also seems to be reasonable solution.

We definitely need a bitfield (for nullable, binary, etc), but
we might need other fields like: field description, default
value. Question: is there a "finite" number of those and can
we define them, and/or should we make it extendable? I think
we need to do both if possible and add those which are static
enough to deserve a dedicated field and one a generic one to
cover future and extra needs.

> My second QUESTION:
>    (2) What structure should we chose for dbCreate()/dbStruct() array?

See above and below.

>    (3) What structures/types should we use for internal RDD field
>        representation?

I'd suggest adding something fully generic, like a linked list
to store custom value - data pairs (something like a hash-table).
This is also good to store flags, but it's possible to support
any future field data this way. Low-level RDD implementations
can translate these values to their dedicated field for quick
access, other RDDs can simply ignore (or warn for) fields which
they cannot recognize.

We should create dedicated fields only for those data that are
pretty stable and constant for database tables.

Brgds,
Viktor

From druzus at acn.waw.pl  Wed Sep  5 02:04:32 2007
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Sep  5 02:04:39 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <46DD1185.7020107@marchuet.net>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
	<20070903152049.GB19537@localhost.localdomain>
	<46DD1185.7020107@marchuet.net>
Message-ID: <20070905060432.GA5680@localhost.localdomain>

On Tue, 04 Sep 2007, Miguel Angel Marchuet wrote:
> VFP uses the following Array and is possible that sooner or later we also
> need it.
> For that reason I believe that we must to preveer these necessities.
> 
>    Field info                                 Data type
> 1 Field name                                  Character
> 2 Field type                                  Character
>       C = Character
>       Y = Currency
>       D = Date
>       T = DateTime
>       B = Double
>       F = Float
>       G = General
>       I = Integer
>       L = Logical
>       M = Memo
>       N = Numeric
>       Q = Varbinary
>       V = Varchar and Varchar (Binary)
>       W = Blob

Can you also send basic size, attributes and usage for these fields?

> 3 Field width                         Numeric
> 4 Decimal places                      Numeric
> 5 Null values allowed                 Logical
> 6 Code page translation not allowed   Logical

Is it the same as BINARY flag?

> 7 Field validation expression         Character
> 8 Field validation text               Character
> 9 Field default value                 Character

> 10 Table validation expression        Character
> 11 Table validation text              Character
> 12 Long table name                    Character
> 13 Insert trigger expression          Character
> 14 Update trigger expression          Character
> 15 Delete trigger expression          Character
> 16 Table comment                      Character

> 17 NextValue for autoincrementing     Numeric
> 18 Step for autoincrementing          Numeric

I do not know why 10, 11, 12, 13, 14, 15 and 16 are in column description.
IMHO these are table attributes not columns' ones so they should not be
here. Do you know any reasons why VFP added it here?

> For example i'm thinking about to implement trigers as in SixRDD or similar.

I Implemented SIX3 triggers few years ago for my own use - I can commit
them but like points I'm asking above these are table not columns attributes
so we do not need them in these array but we should create other data holder
for them.

best regards,
Przemek
From druzus at acn.waw.pl  Wed Sep  5 02:50:10 2007
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Sep  5 02:50:17 2007
Subject: [Harbour] Re: RE: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <00cd01c7ee83$b2d5c8f0$0337d30a@maddog>
References: <20070901114750.GB9374@localhost.localdomain>
	<00cd01c7ee83$b2d5c8f0$0337d30a@maddog>
Message-ID: <20070905065010.GB5680@localhost.localdomain>

On Mon, 03 Sep 2007, Marcelo Lombardo wrote:
> > Here is my first QUESTION:
> >    (1) Should we add real NULL flag support to HVM?
> 
> NULL and NIL are similar but not exactly equal. Both means absence of any
> value, but in other languages you can operate with NULL doing things like
> "NULL + 10" that usually induces to error since result will be NULL and not
> 10. It makes a big mess in aggregate functions like sum() and GROUP BY in
> SQL statements if you forget about it.
> So IMO we should not add NULL flag support to HVM, and I think NULL values
> stored in table fields seems a big paradigm break in xBase programming.

If we replicate such logic then yes. If we accept some default value
for math and relation operation then we will not have such problem
and also all aggregate functions will work. This is implementation
dependent behavior. If you traced messages I exchanged with Mindaugas
then you can find that in some cases only RT errors or default values
I suggested at beginning can resolve some problems. Looks that without
default values there is no sense to introduce NULL flags or we will
have to accept some anomalies, f.e. the behavior of code like:
    IF NULL
will be undefined.

> Maybe more than users can deal with. Is it really useful in any way ? Can it
> save any disk space in DBF ? If yes, does the saved space worth actually ?

It can resolve some problems. As simple field value attribute and with
default value for math and relation operations it seems to be valuable
extension without any side effects. Without it it can be source of some
problems but we also have to accept that NULL is commonly used so we will
not be able to ignore it for long time if we want to make from Harbour
language which can be used with different DBMS, f.e. HVM and compiler
library integrated with postrgres SQL seems to be very interested for me.

> > If you have any other propositions then I'd like to hear about them.
> I prefer the clip solution, but I don't know if this is a realistic solution
> to [x]Harbour RDD API, as you can read in next paragraph. We have many other
> issues that cannot be easily managed by the extended field type (type +
> attributes) idea. As an example, in SQLRDD we have an attribute (actually a
> position in dbCreate() array) that tells the column order in table primary
> key, since you can have multiple columns in primary keys.

IMHO things like primary key are table not columns' attribute. Of course
we can keep in column information about the position in primary key
but for me it looks ugly and also introduce limitations because the
same column can be used in complex primary key more then once as attribute
of some functions and such situation cannot be described as single number
with position in PK. Can we try to collect all column attributes we may
want to use to see if we can chose some common to different DBMS set and
add some very basic support for it to core RDD code?
We can also try to collect table and database attributes (relations
between tables) so we can add support for them too.

> > My second QUESTION:
> >    (2) What structure should we chose for dbCreate()/dbStruct() array?
> In SQLRDD we have following structure in dbCreate() array:
> #define FIELD_NAME                      1
> #define FIELD_TYPE                      2
> #define FIELD_LEN                       3
> #define FIELD_DEC                       4
> #define FIELD_NULLABLE                  5  /* .F. -> NOT NULL */
> #define FIELD_DOMAIN                    6  /* Domain name or supertype or
> user data type */
> #define FIELD_MULTILANG                 7  / .T. -> Multilang field */
> #define FIELD_SQL_RESERVED1             8  /* Not used by dbCreate */
> #define FIELD_SQL_RESERVED2             9  /* Not used by dbCreate */
> #define FIELD_PRIMARY_KEY              10  /* Column order in primary key
> (1, 2, 3...) */
> #define FIELD_UNIQUE                   11  /* .T. -> Unique Key */

Thank you.

> Multilang are fields that can store the same string in many different
> languages. I use it in may everyday applications. If you want to learn more
> about multilang fields, please review samples/sqlrdd/mlang.prg in xHarbour
> Builder.

In the past I saw the description when you announced this extension.

> At this time, I think all 3rd party RDD developers has extended DBFIELDINFO
> to fit their own needs, as well as dbCreate() array. Maybe changing it at
> this time will make current apps stop working. From this point of view, the
> extended field type (type + attributes) is far better than changing
> dbCreate() array structure. 

I'd like to reduce this problem and it was the reason I started the
discussion. Anyhow we already have problem. F.e. RDDs like DELIM and
SDF probably cannot translate many of SQLRDD fields because they do
not know anything about them so COPY TO / APPEND FROM will not work
as expected between different RDDs. If we do not agree common extensions
for field type description with at least some logical attributes effecting
field type then I will have to encode sth local to DBF and other core RDDs
and use it so even core RDDs will not use basic engine due to its
limitations and 3-rd party RDDs will not be compatible in import/export
data.

> > PS. There is still open question about defining common for RDD
> >     open/connection string which can be used in dbUseArea()
> This is other important point. Please remember we can add as many
> connections as we want, and open tables in different connections. We also
> need to execute some internal operations over connections (like sending SQL
> statements). So this is not as simple as connect/disconnect.

I know. I added to dbUseArea()/dbCreate()/rddInfo() support for connection
handler number but I do not know if it's used by SQLRDD or MEDIATOR.
Now I'm interesting if we can create common for different RDDs connection
string (with server address, user name, password, database name, table
name, ...) so we can add to core RDD code some basic functions to decode
such string.

> I managed to have an external connection class that is handled as an
> attribute in SQLRDD's workarea.
> Hope it helps in any way.

It did. Thank you very much.

best regards,
Przemek
From miguelangel at marchuet.net  Wed Sep  5 04:34:13 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Wed Sep  5 04:39:29 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070905060432.GA5680@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
	<20070903152049.GB19537@localhost.localdomain>
	<46DD1185.7020107@marchuet.net>
	<20070905060432.GA5680@localhost.localdomain>
Message-ID: <46DE6A05.8040805@marchuet.net>

Przemyslaw Czerpak escribi?:


>>       Y = Currency
		as implemented yet
>>       T = DateTime
		as implemented yet in xharbour
>>       G = General
		as Memo but can hols his information with functions
		OleLoadFromStream( ... ) and
                 OleSaveToStream( ... )

  > Can you also send basic size, attributes and usage for these fields?

I've this information:
Applies for / supported by:

    FS = FlagShip       D3 = dBaseIII+
    Fb = FoxBase        D4 = dBaseIV
    Fp = FoxPro         D5 = dBaseV
    CL = Clipper

   Size Type      Description/Storage            Applies for (supported by)
------+---------+------------------------------+-----------------------------
C 1..n Char      ASCII (OEM code page chars)    all
                  rest= space, not \0 term.
                  n = 1..64kb (using deci count) FS
                  n = 1..32kb (using deci count) Fp, CL
                  n = 1..254                     all
D 8    Date      8 Ascii digits (0..9) in the   all
                  YYYYMMDD format
F 1..n Numeric   Ascii digits (-.0123456789)    FS, D4, D5, Fp
                  variable pos. of float.point
                  n = 1..20
N 1..n Numeric   Ascii digits (-.0123456789)    all
                  fix posit/no float.point
                  n = 1..20                      FS, Fp, CL
                  n = 1..18                      D3, D4, D5, Fb
L 1    Logical   Ascii chars (YyNnTtFf space)   FS, D3, Fb, Fp, CL
                  Ascii chars (YyNnTtFf ?)       D4, D5  (FS)
M 10   Memo      10 digits repres. the start    all
                  block posit. in .dbt file, or
                  10spaces if no entry in memo
V 10   Variable  Variable, bin/asc data in .dbv FS
                  4bytes bin= start pos in memo
                  4bytes bin= block size
                  1byte     = subtype
                  1byte     = reserved (0x1a)
                  10spaces if no entry in .dbv
P 10   Picture   binary data in .ftp            Fp
                  structure like M
B 10   Binary    binary data in .dbt            D5
                  structure like M
G 10   General   OLE objects                    D5, Fp
                  structure like M
2 2    short int binary int max +/- 32767       FS
4 4    long int  binary int max +/- 2147483647  FS
8 8    double    binary signed double IEEE      FS

and

ymbol  	Data Type  	Description
B 	Binary, a string 	10 digits representing a .DBT block number. The number is stored as a string, right justified and padded 
with blanks.
C 	Character 	All OEM code page characters - padded with blanks to the width of the field.
D 	Date 	8 bytes - date stored as a string in the format YYYYMMDD.
N 	Numeric 	Number stored as a string, right justified, and padded with blanks to the width of the field.
L 	Logical 	1 byte - initialized to 0x20 (space) otherwise T or F.
M 	Memo, a string 	10 digits (bytes) representing a .DBT block number. The number is stored as a string, right justified and 
padded with blanks.
@ 	Timestamp 	8 bytes - two longs, first for date, second for time.  The date is the number of days since  01/01/4713 BC. Time 
is hours * 3600000L + minutes * 60000L + Seconds * 1000L
I 	Long 	4 bytes. Leftmost bit used to indicate sign, 0 negative.
+ 	Autoincrement 	Same as a Long
F 	Float 	Number stored as a string, right justified, and padded with blanks to the width of the field.
O 	Double 	8 bytes - no conversions, stored as a double.
G 	OLE 	10 digits (bytes) representing a .DBT block number. The number is stored as a string, right justified and padded with 
blanks.
> 
>> 3 Field width                         Numeric
>> 4 Decimal places                      Numeric
>> 5 Null values allowed                 Logical
>> 6 Code page translation not allowed   Logical
> 
> Is it the same as BINARY flag?

Yes but i don't have information about his value at.

      HB_FF_HIDDEN      0x01 // 0x01   System Column (not visible to user)
      HB_FF_NULLABLE    0x02 // 0x02   Column can store null values
      HB_FF_BINARY      0x04 // 0x04   Binary column (for CHAR and MEMO only)
                             // 0x06   (0x02+0x04) When a field is NULL and binary (Integer, Currency, and Character/Memo fields)
      HB_FF_AUTOINC     0x0C // 0x0C   Column is autoincrementing

>> 7 Field validation expression         Character
>> 8 Field validation text               Character
>> 9 Field default value                 Character
> 
>> 10 Table validation expression        Character
>> 11 Table validation text              Character
>> 12 Long table name                    Character
>> 13 Insert trigger expression          Character
>> 14 Update trigger expression          Character
>> 15 Delete trigger expression          Character
>> 16 Table comment                      Character
> 
>> 17 NextValue for autoincrementing     Numeric
>> 18 Step for autoincrementing          Numeric
> 
> I do not know why 10, 11, 12, 13, 14, 15 and 16 are in column description.
> IMHO these are table attributes not columns' ones so they should not be
> here. Do you know any reasons why VFP added it here?

I'm agree with you, but in my opinion they are a part of array for other formats.
VFP works with DBF and SQL Server. I suposse that this columuns are for other formats.
For this reason I think that DbCreate needs this information to hold tables in a Sql Server and Dbase 7.
But another idea is to create a DbCreateExt( ... ) as winapi to extend prior functionalitie.

>> For example i'm thinking about to implement trigers as in SixRDD or similar.
> 
> I Implemented SIX3 triggers few years ago for my own use - I can commit
> them but like points I'm asking above these are table not columns attributes
> so we do not need them in these array but we should create other data holder
> for them.

Please upload it. I want to implement in the same library some other functions as :

	Sx_MakeSem( [nOrder | cName ] )
	Sx_KillSem( [nOrder | cName ] )
	Sx_IsSem( [nOrder | cName ] )

	Sx_RollBack( [nArea] )

                   This function allows you to force [x]Harbour to re-read a
                   record from disk prior to a write, thereby allowing you
                   to edit directly into a field without concern for the
                   automatic write that is performed at the conclusion of a
                   READ.

                   If you specify the workarea (nArea) as 0, then the current
                   record and all child-related records (that are currently
                   being pointed to) will also be refreshed from the data on
                   disk.  Note that this does not imply that all child
                   records that may have been changed will be rolled back, but
                   only the ones that the record pointers for each child
                   workarea are currently on.

   	Sx_Freeze([[nTagNo | cTagName,] nOrder | cIndexName])
   	Sx_Warm([[nTagNo | cTagName,] nOrder | cIndexName])


Best regards,
Miguel Angel Marchuet

From miguelangel at marchuet.net  Wed Sep  5 06:20:39 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Wed Sep  5 06:25:53 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070905060432.GA5680@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
	<20070903152049.GB19537@localhost.localdomain>
	<46DD1185.7020107@marchuet.net>
	<20070905060432.GA5680@localhost.localdomain>
Message-ID: <46DE82F7.4080601@marchuet.net>

> 
>> 3 Field width                         Numeric
>> 4 Decimal places                      Numeric
>> 5 Null values allowed                 Logical
>> 6 Code page translation not allowed   Logical
> 
> Is it the same as BINARY flag?

Field-level flags:
	Bit 1: is this a "system" (hidden) field
	Bit 2: is this field nullable
	Bit 3: is this field NOCPTRANS

Best regards,
Miguel Angel Marchuet

From miguelangel at marchuet.net  Wed Sep  5 06:30:10 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Wed Sep  5 06:35:21 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <20070905060432.GA5680@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
	<20070903152049.GB19537@localhost.localdomain>
	<46DD1185.7020107@marchuet.net>
	<20070905060432.GA5680@localhost.localdomain>
Message-ID: <46DE8532.10701@marchuet.net>

Przemyslaw Czerpak escribi?:
> On Tue, 04 Sep 2007, Miguel Angel Marchuet wrote:
>> VFP uses the following Array and is possible that sooner or later we also
>> need it.
>> For that reason I believe that we must to preveer these necessities.
>>
>>    Field info                                 Data type
>> 1 Field name                                  Character
>> 2 Field type                                  Character
>>       C = Character
>>       Y = Currency
>>       D = Date
>>       T = DateTime
>>       B = Double
>>       F = Float
>>       G = General
>>       I = Integer
>>       L = Logical
>>       M = Memo
>>       N = Numeric
>>       Q = Varbinary
>>       V = Varchar and Varchar (Binary)
>>       W = Blob

Float

Seems to be same as numeric. Float exists to allow compatibility with other database products that treated numeric and float 
fields differently. Visual FoxPro treats them no differently internally.

Double

Always seems to store as length 8, but allows you to change decimal places from zero to 18. A fixed format used primarily for 
client-server compatibility, it's manipulated internally the same as any other numeric by FoxPro, but stored differently.

Integer

Integer is probably one of the most useful new data types introduced in Visual FoxPro 3.0. Stored in only four bytes on disk, 
the field has a range from ?2147483647 to plus 2147483647. If you need to track whole numbers only, this can be a compact and 
efficient way to do it. We find these fields to be ideal as primary keys, since they're small and form smaller indexes, and also 
are easy to manipulate and increment. They?re also the fastest way to join tables in a SQL SELECT.

Currency

A currency field is a fixed numeric field, always stored as eight bytes, with four decimal places. These fields are marked by 
default as NOCPTRANS, since the data is packed. Currency is a funny field type. Just as datetime stores a time without a time 
zone, currency stores a value without a unit. Also like datetime, this field type was introduced primarily for compatibility 
with client-server databases. But is this currency in dollars, Euros, or yen? An international application needs to know if it's 
running in Zurich or New Delhi.
Like datetime, currency introduces some new functions and delimiters into the language. NTOM() and MTON() convert numerics to 
currency and vice versa. The dollar-sign delimiter preceding a numeric literal forces the type to currency.
Math involving currency and other numerics introduces a new kink. What's the result of multiplying two currency values?a numeric 
or a currency value? What about trigonometry on these values? We could engage in quite a diatribe on the meaning of unitless and 
"unit-ed" variables being processed together, but it doesn't really matter?Microsoft has a method to its madness, and while it 
might be different from what we would've come out with, it works under most circumstances: basic four-function math (addition, 
subtraction, multiplication and division) involving currency gives results in currency. Exponentiation and trigonometry yield 
numerics.


General Fields: Object Linking and Embedding

General fields are Visual FoxPro's implementation of the technology formerly known as "Object Linking and Embedding," then 
"OLE," and then "Active" something or other. While the marketeers don't seem to be happy with any name they've thought of so 
far, the idea of this portion of the implementation remains the same: provide a portal between FoxPro and some other application 
(the "OLE Server") and store the information about that link and the data shared here.
OLE, er, Active, er, this stuff is no cakewalk. For many of the gory details, see the section "Active Something" as well as the 
individual reference sections for APPEND GENERAL, MODIFY GENERAL, OLEControl and OLEBoundControl.
A couple of cautions here. General fields contain several pieces of information: all contain "display data," and have either a 
path to data (for linked data) or the embedded data itself. The "display" or "presentation" data is a raw BMP that Visual FoxPro 
uses to show that the field is occupied. In Word 2.0, this was the big blue W logo. Word 6.0 allows you to store a 
representation of the first page of a document. MS Graph shows?surprise!?the graph. But some OLE severs can be a problem. 
Graphics servers, which store pictures, are usually forced to provide Visual FoxPro with a BMP for presentation data, even if 
their graphic is in another format (like the far more compact JPG format). This BMP can be HUGE?a large image rendered in 
24-bitplanes (roughly a bazillion colors) can take megabytes of space. This space is used even if the data is only linked to the 
field! Anticipate a large amount of storage space if you choose to link very large or very high-resolution documents. Consider 
other techniques (such as just storing the path and filenames in a character field, and using a cursor to hold one image at a 
time) if disk space is a concern.
One last note about general fields. A general field is nothing more than a special form of the memo field that contains binary 
data, including a "wrapper" around the data that tells FoxPro who to call to manipulate this data?the OLE server. When data is 
called up and changed and saved back to the memo field, new blocks of the memo field are allocated for the new data, and the old 
blocks are internally marked as not used. These old blocks are never reused. What happens over a period of time is that the memo 
file will grow and grow and grow. To alleviate this problem, you can consider using the PACK MEMO command to shrink the file 
(but only after reading the cautions in "Commands Never to Use") or use the equivalent COPY/SELECT, RENAME, DELETE routine to 
refresh the file.
File storage within Visual FoxPro is similar to earlier versions of FoxPro, but with some powerful enhancements provided by the 
Database Container. New fields and field capabilities have been added. Some compatibility has been lost, but we feel the 
benefits of the new features far outweigh the limitations, and that workarounds are available for most of the incompatibilities.


Best regards,
Miguel Angel Marchuet
From druzus at acn.waw.pl  Wed Sep  5 07:23:56 2007
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Sep  5 07:24:03 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <46DE6A05.8040805@marchuet.net>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
	<20070903152049.GB19537@localhost.localdomain>
	<46DD1185.7020107@marchuet.net>
	<20070905060432.GA5680@localhost.localdomain>
	<46DE6A05.8040805@marchuet.net>
Message-ID: <20070905112356.GB15136@localhost.localdomain>

On Wed, 05 Sep 2007, Miguel Angel Marchuet wrote:
>     FS = FlagShip       D3 = dBaseIII+
>     Fb = FoxBase        D4 = dBaseIV
>     Fp = FoxPro         D5 = dBaseV
>     CL = Clipper
[...]

I know this description - unfortunately it's not precise enough
to give us necessary informations.

> >> 3 Field width                         Numeric
> >> 4 Decimal places                      Numeric
> >> 5 Null values allowed                 Logical
> >> 6 Code page translation not allowed   Logical
> > Is it the same as BINARY flag?
> Yes but i don't have information about his value at.
[...] HB_FF_*

I think that small test with "C" and "M" fields should show that 0x04
is set for such columns.
I'm interesting in tests which can show which field types can be controlled
by this column in VFP but only for later DBF compatibility.

> >> 10 Table validation expression        Character
> >> 11 Table validation text              Character
> >> 12 Long table name                    Character
> >> 13 Insert trigger expression          Character
> >> 14 Update trigger expression          Character
> >> 15 Delete trigger expression          Character
> >> 16 Table comment                      Character
> > I do not know why 10, 11, 12, 13, 14, 15 and 16 are in column description.
> > IMHO these are table attributes not columns' ones so they should not be
> > here. Do you know any reasons why VFP added it here?
> I'm agree with you, but in my opinion they are a part of array for other formats.
> VFP works with DBF and SQL Server. I suposse that this columuns are for other formats.
> For this reason I think that DbCreate needs this information to hold tables in a Sql Server and Dbase 7.
> But another idea is to create a DbCreateExt( ... ) as winapi to extend prior functionalitie.

As far as I understand the above description in each DBMS they will be table
attributes not column ones. It's not important which DBMS support them. IMHO
we should not mix column, table and database attributes. We can add to
dbCreate() or as you suggest dbCreateExt() or new parameter with table
attributes and create new function for database attributes.

> >> For example i'm thinking about to implement trigers as in SixRDD or similar.
> > I Implemented SIX3 triggers few years ago for my own use - I can commit
> > them but like points I'm asking above these are table not columns attributes
> > so we do not need them in these array but we should create other data holder
> > for them.
> Please upload it. I want to implement in the same library some other functions as :

OK

> 	Sx_MakeSem( [nOrder | cName ] )
> 	Sx_KillSem( [nOrder | cName ] )
> 	Sx_IsSem( [nOrder | cName ] )

   #include "fileio.ch"
   static function Sx_SemName( xSem )
   local cPath, cName, cExt, cDrive
   if valtype( xSem ) == "C"
      cName := xSem
   else
      cName := ordName( xSem )
   endif
   if !empty( cName )
      hb_FNameSplit( cName, @cPath, @cName, @cExt, @cDrive )
      if empty( cExt )
         cExt := ".sem"
      endif
      return hb_FNameMerge( cPath, cName, cExt, cDrive )
   endif
   return nil

   static function Sx_SemOpen( cName, lNew )
   local hFile, cBuf := space( 2 ), i
   for i:=1 to 1000
      if file( cName )
         hFile := fopen( cName, FO_READWRITE + FO_EXCLUSIVE )
         lNew := .f.
      elseif pcount() > 1
         hFile := fcreate( cName )
         lNew := .t.
      endif
      if hFile != -1
         exit
      endif
   next
   return hFile

   function Sx_MakeSem( xSem )
   local nUsrs := -1, cName, hFile, cBuf := space( 2 ), lNew := .f.
   if !empty( cName := Sx_SemName( xSem ) )
      if ( hFile := Sx_SemOpen( cName, @lNew ) ) != -1
         if lNew
            fwrite( hFile, i2bin( nUsrs := 1 ), 2 )
         elseif fread( hFile, @cBuf, 2 ) == 2
            nUsrs := bin2i( cBuf ) + 1
            fseek( hFile, 0, FS_SET )
            fwrite( hFile, i2bin( nUsrs ), 2 )
         endif
         fclose( hFile )
      endif
   endif
   return nUsrs

   function Sx_KillSem( xSem )
   local nUsrs := -1, cName, hFile, cBuf := space( 2 )
   if !empty( cName := Sx_SemName( xSem ) )
      if ( hFile := Sx_SemOpen( cName ) ) != -1
         if fread( hFile, @cBuf, 2 ) == 2
            nUsrs := bin2i( cBuf ) - 1
            fseek( hFile, 0, FS_SET )
            fwrite( hFile, i2bin( nUsrs ), 2 )
         endif
         fclose( hFile )
         if nUsrs == 0
            ferase( cName )
         endif
      endif
   endif
   return nUsrs

   function Sx_IsSem( xSem )
   local cName
   if !empty( cName := Sx_SemName( xSem ) )
      return file( cName )
   endif
   return .f.

The above implementation has exactly the same race condition in
sx_MakeSem() as in the original SIX3 function. It also replicates
some other side effect like negative semaphore values and reaction
for empty semaphore files. After rewriting Sx_SemOpen() in C to
use hb_fsExtOpen() with FXO_UNIQUE flag it begins to be safe in
POSIX systems if you do not use NFS mounted volumes (there is race
condition when FO_EXCL open flag is used on NFS volumes and it's
necessary to make trick with link() to eliminate it)

> 	Sx_RollBack( [nArea] )

   #xtranslate Sx_RollBack([<xArea>]) => [(<xArea>)->](dbInfo( DBI_ROLLBACK ))

will work with all DBF* RDDs.

>    	Sx_Freeze([[nTagNo | cTagName,] nOrder | cIndexName])
>    	Sx_Warm([[nTagNo | cTagName,] nOrder | cIndexName])

   #xtranslate Sx_Freeze([<xTag>][,<nBag>]) => ;
                     dbOrderInfo( DBOI_CUSTOM, <xTag>, <nBag>, .T. )

   #xtranslate Sx_Warm([<xTag>][,<nBag>]) => ;
                     dbOrderInfo( DBOI_CUSTOM, <xTag>, <nBag>, .F. )

above works in both CDX and NTX based RDDs but this:

   #xtranslate Sx_Chill([<xTag>][,<nBag>]) => ;
                     dbOrderInfo( DBOI_CHGONLY, <xTag>, <nBag>, .T. )

like other order temperature flags (f.e.: DBOI_TEMPLATE, DBOI_MULTIKEY,
DBOI_PARTIAL) works only in DBFNTX though they can be added to DBFCDX
in few minutes. I haven't made it so far because I want to make some
deeper cleanup in DBFCDX code. In fact now DBFNTX supports most of
features and DBFCDX should be updated to DBFNTX level.

best regards,
Przemek
From druzus at priv.onet.pl  Wed Sep  5 11:51:33 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep  5 11:51:43 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <46DE8532.10701@marchuet.net>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
	<20070903152049.GB19537@localhost.localdomain>
	<46DD1185.7020107@marchuet.net>
	<20070905060432.GA5680@localhost.localdomain>
	<46DE8532.10701@marchuet.net>
Message-ID: <20070905155133.GA8126@localhost.localdomain>

On Wed, 05 Sep 2007, Miguel Angel Marchuet wrote:
> Float
> Seems to be same as numeric. Float exists to allow compatibility with other 
> database products that treated numeric and float fields differently. Visual 
> FoxPro treats them no differently internally.

We are supporting it in DBFs as synonym of "N" fields. Also CL53 can
use "F" fields in the same way as "N" but such field type do not work
in earlier Cl*pper versions and standard RDDs.

> Double
> Always seems to store as length 8, but allows you to change decimal places 
> from zero to 18. A fixed format used primarily for client-server 
> compatibility, it's manipulated internally the same as any other numeric by 
> FoxPro, but stored differently.

We are supporting it in DBFs as "B" in the same way as FVP though I haven't
implemented any condition to reduce number of decimal places. It's stored
as IEEE754 double value with possible range bigger then 255. For platforms
which do not use IEEE754 double values for binary compatibility I implemented
conversion functions so this type like CDX indexes (they uses modified
IEEE754 double value for numeric and date keys) can be used also with
non x86 based CPUs.

> Integer
> Integer is probably one of the most useful new data types introduced in 
> Visual FoxPro 3.0. Stored in only four bytes on disk, the field has a range 
> from ???2147483647 to plus 2147483647. If you need to track whole numbers 
> only, this can be a compact and efficient way to do it. We find these 
> fields to be ideal as primary keys, since they're small and form smaller 
> indexes, and also are easy to manipulate and increment. They???re also the 
> fastest way to join tables in a SQL SELECT.

It's a small subset of Harbour functionality. We are supporting such field
type in two ways: as {"I",4,0} and also SIX3 compatible {"V",4,0}.
In Harbour it's also possible to use different size in "I" type: 1,2,3,4,8
and set decimal places.

> Currency
> A currency field is a fixed numeric field, always stored as eight bytes, 
> with four decimal places. These fields are marked by default as NOCPTRANS, 
> since the data is packed. Currency is a funny field type. Just as datetime 
> stores a time without a time zone, currency stores a value without a unit. 
> Also like datetime, this field type was introduced primarily for 
> compatibility with client-server databases. But is this currency in 
> dollars, Euros, or yen? An international application needs to know if it's 
> running in Zurich or New Delhi.

Currency ("Y") VFP type is supported by Harbour as synonym of {"I",8,4}
which has the same representation in DBF format. It's 64bit signed
binary number with four decimal places.

> Like datetime, currency introduces some new functions and delimiters into 
> the language. NTOM() and MTON() convert numerics to currency and vice 
> versa. The dollar-sign delimiter preceding a numeric literal forces the 
> type to currency.
> Math involving currency and other numerics introduces a new kink. What's 
> the result of multiplying two currency values???a numeric or a currency 
> value? What about trigonometry on these values? We could engage in quite a 
> diatribe on the meaning of unitless and "unit-ed" variables being processed 
> together, but it doesn't really matter???Microsoft has a method to its 
> madness, and while it might be different from what we would've come out 
> with, it works under most circumstances: basic four-function math 
> (addition, subtraction, multiplication and division) involving currency 
> gives results in currency. Exponentiation and trigonometry yield numerics.

We are converting currency value to double and we do not use any
special HVM support for it later.

> General Fields: Object Linking and Embedding
> General fields are Visual FoxPro's implementation of the technology 
> formerly known as "Object Linking and Embedding," then "OLE," and then 
> "Active" something or other. While the marketeers don't seem to be happy 
> with any name they've thought of so far, the idea of this portion of the 
> implementation remains the same: provide a portal between FoxPro and some 
> other application (the "OLE Server") and store the information about that 
> link and the data shared here.
> OLE, er, Active, er, this stuff is no cakewalk. For many of the gory 
> details, see the section "Active Something" as well as the individual 
> reference sections for APPEND GENERAL, MODIFY GENERAL, OLEControl and 
> OLEBoundControl.
> A couple of cautions here. General fields contain several pieces of 
> information: all contain "display data," and have either a path to data 
> (for linked data) or the embedded data itself. The "display" or 
> "presentation" data is a raw BMP that Visual FoxPro uses to show that the 
> field is occupied. In Word 2.0, this was the big blue W logo. Word 6.0 
> allows you to store a representation of the first page of a document. MS 
> Graph shows???surprise!???the graph. But some OLE severs can be a problem. 
> Graphics servers, which store pictures, are usually forced to provide 
> Visual FoxPro with a BMP for presentation data, even if their graphic is in 
> another format (like the far more compact JPG format). This BMP can be 
> HUGE???a large image rendered in 24-bitplanes (roughly a bazillion colors) 
> can take megabytes of space. This space is used even if the data is only 
> linked to the field! Anticipate a large amount of storage space if you 
> choose to link very large or very high-resolution documents. Consider other 
> techniques (such as just storing the path and filenames in a character 
> field, and using a cursor to hold one image at a time) if disk space is a 
> concern.
> One last note about general fields. A general field is nothing more than a 
> special form of the memo field that contains binary data, including a 
> "wrapper" around the data that tells FoxPro who to call to manipulate this 
> data???the OLE server. When data is called up and changed and saved back to 
> the memo field, new blocks of the memo field are allocated for the new 
> data, and the old blocks are internally marked as not used. These old 
> blocks are never reused. What happens over a period of time is that the 
> memo file will grow and grow and grow. To alleviate this problem, you can 
> consider using the PACK MEMO command to shrink the file (but only after 
> reading the cautions in "Commands Never to Use") or use the equivalent 
> COPY/SELECT, RENAME, DELETE routine to refresh the file.
> File storage within Visual FoxPro is similar to earlier versions of FoxPro, 
> but with some powerful enhancements provided by the Database Container. New 
> fields and field capabilities have been added. Some compatibility has been 
> lost, but we feel the benefits of the new features far outweigh the 
> limitations, and that workarounds are available for most of the 
> incompatibilities.

This is Windows only field. We can add type for it but we can also
support it only in DBF RDD as memo field variant. Does xbase++ support
it?
BTW How is defined difference between MEMO and BLOB field in VFP?

Many thanks informations.

best regards,
Przemek
From dbtopas at dbtopas.lt  Wed Sep  5 12:26:54 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Sep  5 12:28:31 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <46DE8532.10701@marchuet.net>
References: <20070901114750.GB9374@localhost.localdomain>	<46DBC7EC.2000602@marchuet.net>	<20070903152049.GB19537@localhost.localdomain>	<46DD1185.7020107@marchuet.net>	<20070905060432.GA5680@localhost.localdomain>
	<46DE8532.10701@marchuet.net>
Message-ID: <46DED8CE.9010904@dbtopas.lt>

Miguel Angel Marchuet wrote:
> Integer
> ...
> We find 
> these fields to be ideal as primary keys, since they're small and form 
> smaller indexes, and also are easy to manipulate and increment.

Hi,


what do you mean saying "smaller indexes"? AFAIK, index key for all 
numeric type indexes is double float, i.e. 8 bytes.
This is valid for all numeric fields: "N",16,2, "N",8,0 and even 
"N",1,0. So, I expect index to be the same size for "I",4,0 also.


Best regards,
Mindaugas
From druzus at priv.onet.pl  Wed Sep  5 12:49:24 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep  5 12:49:32 2007
Subject: [Harbour] Re: [xHarbour-developers] Extended field types in RDDs
In-Reply-To: <46DED8CE.9010904@dbtopas.lt>
References: <20070901114750.GB9374@localhost.localdomain>
	<46DBC7EC.2000602@marchuet.net>
	<20070903152049.GB19537@localhost.localdomain>
	<46DD1185.7020107@marchuet.net>
	<20070905060432.GA5680@localhost.localdomain>
	<46DE8532.10701@marchuet.net> <46DED8CE.9010904@dbtopas.lt>
Message-ID: <20070905164924.GA8992@localhost.localdomain>

On Wed, 05 Sep 2007, Mindaugas Kavaliauskas wrote:
> Miguel Angel Marchuet wrote:
> >Integer
> >...
> >We find 
> >these fields to be ideal as primary keys, since they're small and form 
> >smaller indexes, and also are easy to manipulate and increment.
> Hi,
> what do you mean saying "smaller indexes"? AFAIK, index key for all 
> numeric type indexes is double float, i.e. 8 bytes.
> This is valid for all numeric fields: "N",16,2, "N",8,0 and even 
> "N",1,0. So, I expect index to be the same size for "I",4,0 also.

In CDX format (like in NSX) all numeric and date values are stored as
modified IEEE754 double value (small conversion which allow to compare
keys as 8-bytes binary data with memcmp() function, HB_DBL2ORD() macro
in hbdefs.h and hb_put_ord_ieee754() function in source/common/hbarch.c
make such conversion) so the type and size of numeric DBF fields do not
have any relation to CDX or NSX index size.
In NTX format numbers are stored in ASCII strings and in such case
the size of field will be important. For {"I",4,0} is necessary to
allocate 11 bytes for the longest formated number.

best regards,
Przemek
From teo at windtelsoft.com  Wed Sep  5 17:58:16 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Wed Sep  5 17:58:22 2007
Subject: [Harbour] [Przemek] SIGSEGV on SVN revision 7705
Message-ID: <200709051658.16150.teo@windtelsoft.com>

Hello,

I just found the above error, here is the bt:

<backtrace>
Program received signal SIGSEGV, Segmentation fault.
0x0032df75 in malloc_consolidate () from /lib/libc.so.6
(gdb) bt
#0  0x0032df75 in malloc_consolidate () from /lib/libc.so.6
#1  0x0032fced in _int_malloc () from /lib/libc.so.6
#2  0x003312de in malloc () from /lib/libc.so.6
#3  0x0807fe89 in hb_xgrab ()
#4  0x080afb55 in hb_fsFindFirst ()
#5  0x080c9dfb in hb_fsFile ()
#6  0x080c3af1 in hb_spFile ()
#7  0x080ac7b8 in HB_FUN_FILE ()
#8  0x08096405 in hb_vmDo ()
#9  0x08091ac4 in hb_vmExecute ()
#10 0x0804bb9b in HB_FUN_VALFILENAME () at ../../cxxprg/gcc/areldbms.c:10669
#11 0x08096405 in hb_vmDo ()
#12 0x08091ac4 in hb_vmExecute ()
#13 0x0806321b in HB_FUN_TINI_NEW () at ../../cxxprg/gcc/tini.c:623
#14 0x08095e93 in hb_vmSend ()
#15 0x08093c1f in hb_vmExecute ()
#16 0x0804c5db in HB_FUN__APPMAIN () at ../../cxxprg/gcc/arel.c:1400
#17 0x08096405 in hb_vmDo ()
#18 0x0809fd8e in main ()
</backtrace>

Seems related to the new hb_fsNameConv() function.

Sorry for not be of more help here :(


best regards

Teo Fonrouge
From druzus at priv.onet.pl  Wed Sep  5 18:42:20 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep  5 18:42:26 2007
Subject: [Harbour] [Przemek] SIGSEGV on SVN revision 7705
In-Reply-To: <200709051658.16150.teo@windtelsoft.com>
References: <200709051658.16150.teo@windtelsoft.com>
Message-ID: <20070905224220.GA23315@localhost.localdomain>

On Wed, 05 Sep 2007, Teo Fonrouge wrote:
> Hello,
> I just found the above error, here is the bt:
[...]
> Seems related to the new hb_fsNameConv() function.
> Sorry for not be of more help here :(

It's enough - thanks for info, it was problem with my today modifications,
fixed.

best regards,
Przemek
From rglab at przesiew.imid.med.pl  Thu Sep  6 09:10:02 2007
From: rglab at przesiew.imid.med.pl (Ryszard Glab)
Date: Thu Sep  6 08:58:30 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <20070904231048.GB22871@localhost.localdomain>
References: <20070901114750.GB9374@localhost.localdomain>,
	<46DD5D00.8684.675629@rglab.przesiew.imid.med.pl>,
	<20070904231048.GB22871@localhost.localdomain>
Message-ID: <46E0184A.26414.C3E450@rglab.przesiew.imid.med.pl>

On 5 Sep 2007 at 1:10, Przemyslaw Czerpak wrote:

> OK - it's easy to do. Much more complicated is using NULL values in
> conditional expressions which control some statements, f.e. loops.
> I do not see any easy way to reproduce most commonly used DBMS logic
> without introducing undefined states. Seems that we will have to
> generate RT errors for conditional jumps executed for NULL value.
> It will still interact with -z optimization but seems to be much
> better then undefined results.

This is from MySQL documentation:
"In SQL, the NULL value is never true in comparison to any other 
value, even NULL. An expression that contains NULL always produces a 
NULL value unless otherwise indicated in the documentation for the 
operators and functions involved in the expression."

This meens that using NULL in comparison should be the same as 
logical FALSE:
Additionally:
IF( NULL, 1, 2) gives 2

> Interesting but IMHO it will more complicated then necessary.
> We will still have many different columns but in more dimensions.
> I'm interesting if we can define all possible non binary column
> attributes used in different DBMS to see how complicated will
> be addressing most of them.

  In SQL there are also ENUM and SET data types - I don't mean that 
we should support them in DBF tables but our RDD internals (and 
future SQLRDD) should be able to handle them. Thus DBCREATE structure 
should have some slot for such definitions - this is why I proposed 
an array.

Regards,
Ryszard
From druzus at priv.onet.pl  Thu Sep  6 11:21:04 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep  6 11:21:14 2007
Subject: [Harbour] Extended field types in RDDs
In-Reply-To: <46E0184A.26414.C3E450@rglab.przesiew.imid.med.pl>
References: <20070904231048.GB22871@localhost.localdomain>
	<46E0184A.26414.C3E450@rglab.przesiew.imid.med.pl>
Message-ID: <20070906152104.GA2815@localhost.localdomain>

On Thu, 06 Sep 2007, Ryszard Glab wrote:
> > OK - it's easy to do. Much more complicated is using NULL values in
> > conditional expressions which control some statements, f.e. loops.
> > I do not see any easy way to reproduce most commonly used DBMS logic
> > without introducing undefined states. Seems that we will have to
> > generate RT errors for conditional jumps executed for NULL value.
> > It will still interact with -z optimization but seems to be much
> > better then undefined results.
> This is from MySQL documentation:
> "In SQL, the NULL value is never true in comparison to any other 
> value, even NULL. An expression that contains NULL always produces a 
> NULL value unless otherwise indicated in the documentation for the 
> operators and functions involved in the expression."
> This meens that using NULL in comparison should be the same as 
> logical FALSE:
> Additionally:
> IF( NULL, 1, 2) gives 2

And it will. This is simple situation. See my message to Mindaugas.
In practice for all expressions we will not have problem if we only
define that conditional jumps are always executed for NULL value.
The problem appears only for statements with backward jumps (WHILE
and FOR loops) because our PCODE optimizer can in somtimes reduce
generated PCODE to optimal form so for this
loop:
    /* local nI, value */

    while .t.
       ++nI
       if value
          exit
       endif
    enddo

we have:
	HB_P_LOCALINC, 1, 0,	/* NI */
	HB_P_PUSHLOCALNEAR, 2,	/* VALUE */
	HB_P_JUMPFALSENEAR, 251,	/* -5 */

and for this loop:

    while .t.
       ++nI
       if !value
          loop
       endif
       exit
    enddo

we have _exactly_ the same PCODE:
	HB_P_LOCALINC, 1, 0,	/* NI */
	HB_P_PUSHLOCALNEAR, 2,	/* VALUE */
	HB_P_JUMPFALSENEAR, 251,	/* -5 */

Just try to compile this example with -l switch.
In both cases we have optimal PCODE but in first code when 'value'
is NIL we should have infinite loop and in the second example the
loop should be interrupted. Unfortunately HVM will not be able
to detect it because for both example it will execute the same
PCODE what clearly shows that with compile time optimizations
such definition of NULL value behavior cannot be implemented
for code with loops (backward jumps).

> > Interesting but IMHO it will more complicated then necessary.
> > We will still have many different columns but in more dimensions.
> > I'm interesting if we can define all possible non binary column
> > attributes used in different DBMS to see how complicated will
> > be addressing most of them.
>   In SQL there are also ENUM and SET data types - I don't mean that 
> we should support them in DBF tables but our RDD internals (and 
> future SQLRDD) should be able to handle them. Thus DBCREATE structure 
> should have some slot for such definitions - this is why I proposed 
> an array.

Enum and set data types can be implanted with validation function too,
but of course we can also reserve column for the set of acceptable values.
Such set can be in array or hash item and of course we can reserve some
slot for it. This is yet another non logical column attribute which we
should add to common set of supported column attributes.

best regards,
Przemek
From harbour.01 at syenar.hu  Thu Sep  6 22:00:13 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep  6 22:00:16 2007
Subject: [Harbour] CHANGELOG: 2007-09-07 03:38 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f0f2$Blat.v2.6.1$d4339290$c446965beae@127.0.0.1>

2007-09-07 03:38 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * tests/Makefile
   * tests/rto_get.prg
   + tests/rto_tb.prg
   * include/button.ch
   * include/hbextern.ch
   * common.mak
   * source/rtl/Makefile
   - source/rtl/mssgline.prg
   + source/rtl/gui.prg
   + source/rtl/menusys.prg
   + source/rtl/tmenusys.prg
   * source/rtl/checkbox.prg
   * source/rtl/einstvar.prg
   * source/rtl/getlist.prg
   * source/rtl/getsys.prg
   * source/rtl/listbox.prg
   * source/rtl/memoedit.prg
   * source/rtl/pushbtn.prg
   * source/rtl/radiobtn.prg
   * source/rtl/radiogrp.prg
   * source/rtl/scrollbr.prg
   * source/rtl/tbcolumn.prg
   * source/rtl/tbrowse.prg
   * source/rtl/teditor.prg
   * source/rtl/tget.prg
   * source/rtl/tgetlist.prg
   * source/rtl/tlabel.prg
   * source/rtl/tmenuitm.prg
   * source/rtl/tpopup.prg
   * source/rtl/treport.prg
   * source/rtl/ttopbar.prg
     ; These changes mainly targeted the .prg 
       level UI classes of Harbour.
     + Code standardization, cleanup, formatting.
       (formatting is not fully complete yet)
     ! Lots of compatibility fixes.
     ! Lots of bugfixes (crashes, wrongly passed 
       parameters, etc).
     ! Minor fix in one of the methods of HBReportForm()
     - Non-Clipper classes removed (the MENUSYS/msgline 
       related ones).
     ! Some fixes adapted from xHarbour's TBrowse()
     + Class VARs properly scoped.
     + TBColumn() is now fully compatible.
     * The mess in the TTopBar and related classes was 
       cleaned up, some small non-Clipper compatible 
       classes were removed and a new TMenuSys class 
       was created of the related parts.
     % Optimizations.
     + TBrowse/TBColumn regression test suite 
       added (far from complete at this point).
     ; NOTE: No C5.3 GUI support is implemented in Harbour.
     ; NOTE: Harbour uses Disp*() functions in UI functions 
             to update screen. C5.x uses a mixture of Dev*(), 
             Q?Out() and Disp*().
     ; NOTE: TBrowse() fixing is still a work in progress.
     ; Please test.

From teo at windtelsoft.com  Fri Sep  7 01:12:10 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Fri Sep  7 01:12:17 2007
Subject: [Harbour] CHANGELOG: 2007-09-07 03:38 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <01c7f0f2$Blat.v2.6.1$d4339290$c446965beae@127.0.0.1>
References: <01c7f0f2$Blat.v2.6.1$d4339290$c446965beae@127.0.0.1>
Message-ID: <200709070012.10262.teo@windtelsoft.com>

On Thursday 06 September 2007 09:00:13 pm Szak?ts Viktor wrote:
> 2007-09-07 03:38 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>    * tests/Makefile
>    * tests/rto_get.prg
>    + tests/rto_tb.prg
>    * include/button.ch
>    * include/hbextern.ch
>    * common.mak
>    * source/rtl/Makefile
>    - source/rtl/mssgline.prg
>    + source/rtl/gui.prg
>    + source/rtl/menusys.prg
>    + source/rtl/tmenusys.prg
>    * source/rtl/checkbox.prg
>    * source/rtl/einstvar.prg
>    * source/rtl/getlist.prg
>    * source/rtl/getsys.prg
>    * source/rtl/listbox.prg
>    * source/rtl/memoedit.prg
>    * source/rtl/pushbtn.prg
>    * source/rtl/radiobtn.prg
>    * source/rtl/radiogrp.prg
>    * source/rtl/scrollbr.prg
>    * source/rtl/tbcolumn.prg
>    * source/rtl/tbrowse.prg
>    * source/rtl/teditor.prg
>    * source/rtl/tget.prg
>    * source/rtl/tgetlist.prg
>    * source/rtl/tlabel.prg
>    * source/rtl/tmenuitm.prg
>    * source/rtl/tpopup.prg
>    * source/rtl/treport.prg
>    * source/rtl/ttopbar.prg
>      ; These changes mainly targeted the .prg
>        level UI classes of Harbour.
>      + Code standardization, cleanup, formatting.
>        (formatting is not fully complete yet)
>      ! Lots of compatibility fixes.
>      ! Lots of bugfixes (crashes, wrongly passed
>        parameters, etc).
>      ! Minor fix in one of the methods of HBReportForm()
>      - Non-Clipper classes removed (the MENUSYS/msgline
>        related ones).
>      ! Some fixes adapted from xHarbour's TBrowse()
>      + Class VARs properly scoped.
>      + TBColumn() is now fully compatible.
>      * The mess in the TTopBar and related classes was
>        cleaned up, some small non-Clipper compatible
>        classes were removed and a new TMenuSys class
>        was created of the related parts.
>      % Optimizations.
>      + TBrowse/TBColumn regression test suite
>        added (far from complete at this point).
>      ; NOTE: No C5.3 GUI support is implemented in Harbour.
>      ; NOTE: Harbour uses Disp*() functions in UI functions
>              to update screen. C5.x uses a mixture of Dev*(),
>              Q?Out() and Disp*().
>      ; NOTE: TBrowse() fixing is still a work in progress.
>      ; Please test.

Viktor,

hbrun.o:(.data+0x2f28): undefined reference to `HB_FUN_GUIGETPOSTVALIDATE'
hbdot.o:(.data+0x30c8): undefined reference to `HB_FUN_GUIGETPOSTVALIDATE'


best regards

Teo Fonrouge
From harbour.01 at syenar.hu  Fri Sep  7 06:34:21 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep  7 06:34:32 2007
Subject: [Harbour] CHANGELOG: 2007-09-07 03:38 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <200709070012.10262.teo@windtelsoft.com>
References: <01c7f0f2$Blat.v2.6.1$d4339290$c446965beae@127.0.0.1>
	<200709070012.10262.teo@windtelsoft.com>
Message-ID: <2EE502EC-3FD2-465E-986C-ECDB095726A6@syenar.hu>

> Viktor,
>
> hbrun.o:(.data+0x2f28): undefined reference to  
> `HB_FUN_GUIGETPOSTVALIDATE'
> hbdot.o:(.data+0x30c8): undefined reference to  
> `HB_FUN_GUIGETPOSTVALIDATE'

Thanks Teo, I'll fix it in a minute. These are
wrongly named functions, which were now corrected.

Brgds,
Viktor

From harbour.01 at syenar.hu  Fri Sep  7 06:56:06 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep  7 06:56:09 2007
Subject: [Harbour] CHANGELOG: 2007-09-07 12:55 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f13d$Blat.v2.6.1$b0ca2d8c$12287cf9492e@127.0.0.1>

2007-09-07 12:55 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * include/hbextern.ch
     ! Fix of some corrected public function names.

From druzus at priv.onet.pl  Sat Sep  8 09:45:07 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sat Sep  8 09:45:15 2007
Subject: [Harbour] ChangeLog(s)
Message-ID: <20070908134507.GA30804@localhost.localdomain>

2007-09-08 15:15 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/dbinfo.ch
    * updated comment

  * harbour/contrib/rdd_ads/ads1.c
    * replaced hb_itemGetPtr(hb_param(n,HB_IT_POINTER)) with hb_parptr(1)

  * harbour/contrib/hbzlib/hbcomprs.c
    * changed variable name: PHB_FNAME fDirSpec to PHB_FNAME pDirSpec

  * harbour/source/rdd/dbcmd.c
    ! fixed parameter checking in OrdNumber() to generate Clipper compatible
      RT error
    * code cleanup

  * harbour/source/rdd/dbfntx/dbfntx1.c
  * harbour/source/rdd/dbfcdx/dbfcdx1.c
    * do not evaluate KEY expresion in custom indexes in KEYDEL operation.
      It may interact with MULTIKEY/TEMPLATE indexes.
    * updated default order in DBOI_BAGNUMBER and DBOI_BAGORDER

2007-09-06 13:40 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rtl/set.c
    ! fixed typo in SET name

2007-09-06 00:45 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rtl/gttrm/gttrm.c
    * use for teraterm Linux controle codes

  * harbour/source/rtl/filesys.c
  * harbour/source/rtl/file.c
    ! fixed GPF trap which appeared after my last modifications

2007-09-05 16:50 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/hbgtmk.sh
    * replaced CVS checkout commands by SVN checkout
        # This script checks you have all tools to build Harbour binaries
        # installed then takes current Harbour sources from SourceForge SVN
        # repository and build binary RPMs at your local host

      If possible I think it will be good to put this script on
      Harbour home page so Linux users using RPM based distributions
      can simply download it and execute. It should greatly help them
      and it will reduce some repeated questions.

  * harbour/include/hbapifs.h
  * harbour/source/rtl/filesys.c
    + added hb_fsNameConv() function, hb_fileNameConv() kept only for
      backward compatibility - it should not be used
    * use hb_fsNameConv() instead of hb_fileNameConv()
    * updated conversion code to use hb_fsFNameSplit()/hb_fsFNameMerge()
      and respect some other DOS like conditions

  * harbour/include/hbdate.h
  * harbour/source/common/hbdate.c
  * harbour/source/rtl/seconds.c
    * use MT safe localtime_r() instead of localtime() in Linux
    + hb_dateTimeStamp(), hb_timeStampStr(), hb_timeStampDecode(),
      hb_dateTimeStampStr(), hb_dateTimeStampStrGet()

  * harbour/contrib/libct/files.c
  * harbour/contrib/libct/disk.c
  * harbour/contrib/hbzlib/hbcomprs.c
  * harbour/source/rtl/diskspac.c
  * harbour/source/rtl/fstemp.c
  * harbour/source/rtl/disksphb.c
  * harbour/source/rtl/file.c
    * use hb_fsNameConv() instead of hb_fileNameConv()

  * harbour/source/debug/dbgentry.c
    + added modifications by Phil Krylow borowed from xHarbour for
      supporting :: in command line expressions

  * harbour/source/rdd/dbfntx/dbfntx1.c
  * harbour/source/rdd/dbfdbt/dbfdbt1.c
  * harbour/source/rdd/dbfcdx/dbfcdx1.c
  * harbour/source/rdd/delim1.c
  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/dbffpt/dbffpt1.c
  * harbour/source/rdd/sdf1.c
    * minor clenup:
      use hb_parptr(n) instead of hb_itemGetPtr(hb_param(n,HB_IT_POINTER))

2007-09-03 01:23 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  - harbour/contrib/apollo/makefile
  + harbour/contrib/apollo/Makefile
    * renamed

  * harbour/contrib/apollo/test/apollo.ch
  * harbour/contrib/pgsql/postgres.c
  * harbour/contrib/htmllib/errorsys.prg
  * harbour/contrib/adordd/adordd.ch
    * converted TABs to SPACEs

2007-09-02 17:27 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/hbgtmk.sh
  * harbour/tests/codebl.prg
  * harbour/tests/testprof.prg
  * harbour/tests/keywords.prg
  * harbour/tests/testpp.prg
  * harbour/make_rpm.sh
  * harbour/makefile.gc
  * harbour/bin/hb-mkslib.sh
  * harbour/include/hbexpra.c
  * harbour/include/hbmath.ch
  * harbour/include/hbrddntx.h
  * harbour/include/hbexprb.c
  * harbour/harbour.spec
  * harbour/contrib/dot/pp.prg
  * harbour/contrib/libct/ctwin.c
  * harbour/contrib/ole2/w32ole.c
  * harbour/contrib/hgf/win32/win32.c
  * harbour/contrib/mysql/mysql.ch
  * harbour/contrib/odbc/todbc.prg
  * harbour/contrib/odbc/sql.ch
  * harbour/contrib/hb_struc/hbstruc.ch
  * harbour/contrib/bmdbfcdx/bmdbfcdx1.c
  * harbour/contrib/msql/msql.ch
  * harbour/contrib/msql/readme.txt
  * harbour/source/pp/ppcore.c
  * harbour/source/rtl/gtdos/gtdos.c
  * harbour/source/rtl/gtxwc/gtxwc.h
  * harbour/source/rtl/hbgtcore.c
  * harbour/source/rtl/gtcrs/gtcrs.h
  * harbour/source/rtl/gtalleg/gtalleg.c
  * harbour/source/rtl/gtalleg/ssf.h
  * harbour/source/rtl/gtalleg/fixedth.sfc
  * harbour/source/rtl/gtchrmap.c
  * harbour/source/rtl/itemseri.c
  * harbour/source/rtl/gtstd/gtstd.c
  * harbour/source/rtl/gtsln/gtsln.h
  * harbour/source/rtl/gttrm/gttrm.c
  * harbour/source/rtl/gtpca/gtpca.c
  * harbour/source/rtl/hbhex.c
  * harbour/source/rtl/tget.prg
  * harbour/source/rtl/gtcgi/gtcgi.c
  * harbour/source/rtl/hbinet.c
  * harbour/source/vm/hvm.c
  * harbour/source/debug/dbgtobj.prg
  * harbour/source/debug/dbgwa.prg
  * harbour/source/common/expropt2.c
  * harbour/source/rdd/dbfcdx/dbfcdx1.c
  * harbour/source/rdd/dbffpt/dbffpt1.c
  * harbour/utils/hbpp/hbppcore.c
  * harbour/utils/hbpptest/pp_test.prg
  * harbour/utils/hbpptest/pretest.prg
  * harbour/make_tgz.sh
    * converted TABs to SPACEs

2007-09-01 16:23 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbcompat.ch
    + added some new translation rules
  * harbour/source/vm/proc.c
    * fixed buffer size to protect against possible overflow

2007-09-01 14:38 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rtl/hbhex.c
    * replaced TAB by spaces

From philb at philb.us  Sat Sep  8 13:15:28 2007
From: philb at philb.us (Phil Barnett)
Date: Sat Sep  8 13:16:50 2007
Subject: [Harbour] ChangeLog(s)
In-Reply-To: <20070908134507.GA30804@localhost.localdomain>
References: <20070908134507.GA30804@localhost.localdomain>
Message-ID: <200709081315.28848.philb@philb.us>

On Saturday 08 September 2007, Przemyslaw Czerpak wrote:
> If possible I think it will be good to put this script on
> ? ? ? Harbour home page so Linux users using RPM based distributions
> ? ? ? can simply download it and execute. It should greatly help them
> ? ? ? and it will reduce some repeated questions.

Why doesn't the rpm put it in /usr/sbin?

-- 
Phil Barnett
AI4OF
SKCC #600
From druzus at priv.onet.pl  Sat Sep  8 14:11:10 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sat Sep  8 14:11:18 2007
Subject: [Harbour] ChangeLog(s)
In-Reply-To: <200709081315.28848.philb@philb.us>
References: <20070908134507.GA30804@localhost.localdomain>
	<200709081315.28848.philb@philb.us>
Message-ID: <20070908181110.GA2269@localhost.localdomain>

On Sat, 08 Sep 2007, Phil Barnett wrote:
> > If possible I think it will be good to put this script on
> > ? ? ? Harbour home page so Linux users using RPM based distributions
> > ? ? ? can simply download it and execute. It should greatly help them
> > ? ? ? and it will reduce some repeated questions.
> Why doesn't the rpm put it in /usr/sbin?

Because this script can be used when you do not have RPM or any
other Harbour binaries and source code.
It's for new users which can take this scripts and execute it.
This scripts will check if they have installed tools necessary
to build Harbour (if not they will display missing packages) and
then will take Harbour source code from SF SVN repository and will
compile it creating RPMs on local disk. Final binary RPMs will be
placed in $HOME/RPM/RPMS/<arch> directory.
All this operations can (and should) be executed from non root
account and only the last phase: installing RPMs should be done
with root privileges.

So this script is the easiest way to start working with Harbour
on new Linux box if it's RPM based distribution. I think that
having such scripts on Harbour home page will help users.

best regards,
Przemek
From gvarona at ec-red.com  Sat Sep  8 14:54:47 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Sat Sep  8 14:54:52 2007
Subject: [Harbour] Error con el Mouse en Clase tBrowe / Error with the Mouse
 in Class tBrowe 
Message-ID: <46E2EFF7.2080807@ec-red.com>

Hola Viktor, he probado los ultimos cambios realizados en las clase menu 
y browse.
He compilado una aplicaci?n peque?a, generando el ejecutable sin problemas.
Cuando ejecuto el programa y utilizo el mouse, obtengo el siguiente error:

<freetranslation.com>
Hello Viktor, I have tested the last changes carried out in the class 
menu and browse. 
I have compiled a small application, generating the EXE one without 
problems. 
When I execute the program and I utilize the mouse, I obtain the 
following error: 

Error BASE/42  Scope violation (protected): TBROWSE:NROWPOS
Called from TBROWSE:NROWPOS
Called from TBMOUSE(1982)
Called from (b)SETKEY(1875)
Called from TBROWSE:TAPPLYKEY(1915)
Called from TBROWSE:APPLYKEY(1850)
Called from MIDBMENX(519)
Called from PRESUPUE(143)
Called from (b)CREA_MENU(82)
Called from EXECUTE(432)
Called from MENUMODAL(208)
Called from MAIN(256)

Best Regards.
GVS

From gvarona at ec-red.com  Sat Sep  8 17:45:22 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Sat Sep  8 17:45:23 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
Message-ID: <46E317F2.2050501@ec-red.com>

Hi / Hola:

SP: Este Ejemplo funciona correctamente en Clipper 5.3b:
EN: This Example functions correctly in Clipper 5.3b:

Uso: WinXP + MinGW

#include "INKEY.CH"
PROCEDURE main
LOCAL nValor1 := nValor2 := nSuma := 0
setmode(25,80)
CLS

SET(_SET_EVENTMASK, INKEY_ALL)
MSETCURSOR(.T.)

DO WHILE .T.
    @ 10,1 SAY "                Valor 1:" GET nValor1 MESS 'Digite el
Primer sumando'
    @ 11,1 SAY "                Valor 2:" GET nValor2 MESS 'Digite el
Segundo sumando'
    @ 12,1 SAY "Aqui falla con el Mouse:" GET nSuma WHEN (nSuma :=
ROUND(nValor1*nValor2,2))<0;
        MESS "Este es el Producto"
    READ MSG AT 15,1,78 MSG COLOR 'w+/b'
    wait
    IF LASTKEY()=K_ESC
       EXIT
    ENDIF
ENDDO
RETURN

**************************

En Harbour / In harbour:

IN SPANISH
1.- En el tercer GET, No debe permitir su edicion cuando es menor que 0,
sin embargo si lo permite y luego se cuelga
2.- No muestra los mensajes que se indican en la clausula MESS

IN ENGLISH
1.- In the third one GET, should Not permit its edicion when is smaller
that 0, nevertheless if permits it and then hang
2.- Does not it show the messages that are indicated in the clause MESS

Best Regards
GVS



From gvarona at ec-red.com  Sat Sep  8 17:51:53 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Sat Sep  8 17:51:54 2007
Subject: [Harbour] Error con el Mouse en Clase tBrowe / Error with the
	Mouse in Class tBrowe
In-Reply-To: <46E2EFF7.2080807@ec-red.com>
References: <46E2EFF7.2080807@ec-red.com>
Message-ID: <46E31979.5070005@ec-red.com>

SPANISH:
Otra cosa:
Parece que no se esta tomando el valor por defecto para la variable 
colorSpec (SETCOLOR()), de la clase tBrowse, ya que la misma aplicaci?n 
en Clipper 5.3b me muestra resultados diferentes.

ENGLISH:
Another thing: 
It seems that itself not this taking the value by defect for the 
variable one colorSpec (SETCOLOR()), of the class tBrowse, since the 
same application in Clipper 5.3b shows me different results. 

Best Regards
GVS


Guillermo Varona Silup? escribi?:
> Hola Viktor, he probado los ultimos cambios realizados en las clase 
> menu y browse.
> He compilado una aplicaci?n peque?a, generando el ejecutable sin 
> problemas.
> Cuando ejecuto el programa y utilizo el mouse, obtengo el siguiente 
> error:
>
> <freetranslation.com>
> Hello Viktor, I have tested the last changes carried out in the class 
> menu and browse. I have compiled a small application, generating the 
> EXE one without problems. When I execute the program and I utilize the 
> mouse, I obtain the following error:
> Error BASE/42  Scope violation (protected): TBROWSE:NROWPOS
> Called from TBROWSE:NROWPOS
> Called from TBMOUSE(1982)
> Called from (b)SETKEY(1875)
> Called from TBROWSE:TAPPLYKEY(1915)
> Called from TBROWSE:APPLYKEY(1850)
> Called from MIDBMENX(519)
> Called from PRESUPUE(143)
> Called from (b)CREA_MENU(82)
> Called from EXECUTE(432)
> Called from MENUMODAL(208)
> Called from MAIN(256)
>
> Best Regards.
> GVS
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>

From harbour.01 at syenar.hu  Sat Sep  8 19:23:27 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep  8 19:23:35 2007
Subject: [Harbour] Error con el Mouse en Clase tBrowe / Error with the
	Mouse in Class tBrowe 
In-Reply-To: <46E2EFF7.2080807@ec-red.com>
References: <46E2EFF7.2080807@ec-red.com>
Message-ID: <B51A264E-93EE-40E1-991A-7CB7EAB1E56D@syenar.hu>

Hi Guillermo,

Many thanks for your tests, I'll commit a fix for this tomorrow.

Brgds,
Viktor

On 2007.09.08., at 20:54, Guillermo Varona Silup? wrote:

> Hola Viktor, he probado los ultimos cambios realizados en las clase  
> menu y browse.
> He compilado una aplicaci?n peque?a, generando el ejecutable sin  
> problemas.
> Cuando ejecuto el programa y utilizo el mouse, obtengo el siguiente  
> error:
>
> <freetranslation.com>
> Hello Viktor, I have tested the last changes carried out in the  
> class menu and browse. I have compiled a small application,  
> generating the EXE one without problems. When I execute the program  
> and I utilize the mouse, I obtain the following error:
> Error BASE/42  Scope violation (protected): TBROWSE:NROWPOS
> Called from TBROWSE:NROWPOS
> Called from TBMOUSE(1982)
> Called from (b)SETKEY(1875)
> Called from TBROWSE:TAPPLYKEY(1915)
> Called from TBROWSE:APPLYKEY(1850)
> Called from MIDBMENX(519)
> Called from PRESUPUE(143)
> Called from (b)CREA_MENU(82)
> Called from EXECUTE(432)
> Called from MENUMODAL(208)
> Called from MAIN(256)
>
> Best Regards.
> GVS
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sat Sep  8 19:25:14 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep  8 19:25:21 2007
Subject: [Harbour] Error con el Mouse en Clase tBrowe / Error with the
	Mouse in Class tBrowe
In-Reply-To: <46E31979.5070005@ec-red.com>
References: <46E2EFF7.2080807@ec-red.com> <46E31979.5070005@ec-red.com>
Message-ID: <699967DD-3F7C-4930-9E31-B93DBF94E0CA@syenar.hu>

Hi,

Could you pls provide an small example which
demonstrates the problem?

Brgds,
Viktor

On 2007.09.08., at 23:51, Guillermo Varona Silup? wrote:

> SPANISH:
> Otra cosa:
> Parece que no se esta tomando el valor por defecto para la variable  
> colorSpec (SETCOLOR()), de la clase tBrowse, ya que la misma  
> aplicaci?n en Clipper 5.3b me muestra resultados diferentes.
>
> ENGLISH:
> Another thing: It seems that itself not this taking the value by  
> defect for the variable one colorSpec (SETCOLOR()), of the class  
> tBrowse, since the same application in Clipper 5.3b shows me  
> different results.
> Best Regards
> GVS
>
>
> Guillermo Varona Silup? escribi?:
>> Hola Viktor, he probado los ultimos cambios realizados en las  
>> clase menu y browse.
>> He compilado una aplicaci?n peque?a, generando el ejecutable sin  
>> problemas.
>> Cuando ejecuto el programa y utilizo el mouse, obtengo el  
>> siguiente error:
>>
>> <freetranslation.com>
>> Hello Viktor, I have tested the last changes carried out in the  
>> class menu and browse. I have compiled a small application,  
>> generating the EXE one without problems. When I execute the  
>> program and I utilize the mouse, I obtain the following error:
>> Error BASE/42  Scope violation (protected): TBROWSE:NROWPOS
>> Called from TBROWSE:NROWPOS
>> Called from TBMOUSE(1982)
>> Called from (b)SETKEY(1875)
>> Called from TBROWSE:TAPPLYKEY(1915)
>> Called from TBROWSE:APPLYKEY(1850)
>> Called from MIDBMENX(519)
>> Called from PRESUPUE(143)
>> Called from (b)CREA_MENU(82)
>> Called from EXECUTE(432)
>> Called from MENUMODAL(208)
>> Called from MAIN(256)
>>
>> Best Regards.
>> GVS
>>
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sat Sep  8 19:29:42 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep  8 19:29:50 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <46E317F2.2050501@ec-red.com>
References: <46E317F2.2050501@ec-red.com>
Message-ID: <7B4D33DF-61B0-400E-9EAB-CE2C74448766@syenar.hu>

1) I'll check into the WHEN problem.

2) it seems that Harbour's (and xhb's) TGETLIST doesn't have
    support for any C5.3 features, like MESSAGE. I'll look into
    it too.

Notice however that MESSAGE support is kind of a mess in C5.3
(at least what I've seen from it) and actual implementation
differs from documented behaviour in the NG.

Brgds,
Viktor

On 2007.09.08., at 23:45, Guillermo Varona Silup? wrote:

> Hi / Hola:
>
> SP: Este Ejemplo funciona correctamente en Clipper 5.3b:
> EN: This Example functions correctly in Clipper 5.3b:
>
> Uso: WinXP + MinGW
>
> #include "INKEY.CH"
> PROCEDURE main
> LOCAL nValor1 := nValor2 := nSuma := 0
> setmode(25,80)
> CLS
>
> SET(_SET_EVENTMASK, INKEY_ALL)
> MSETCURSOR(.T.)
>
> DO WHILE .T.
>    @ 10,1 SAY "                Valor 1:" GET nValor1 MESS 'Digite el
> Primer sumando'
>    @ 11,1 SAY "                Valor 2:" GET nValor2 MESS 'Digite el
> Segundo sumando'
>    @ 12,1 SAY "Aqui falla con el Mouse:" GET nSuma WHEN (nSuma :=
> ROUND(nValor1*nValor2,2))<0;
>        MESS "Este es el Producto"
>    READ MSG AT 15,1,78 MSG COLOR 'w+/b'
>    wait
>    IF LASTKEY()=K_ESC
>       EXIT
>    ENDIF
> ENDDO
> RETURN
>
> **************************
>
> En Harbour / In harbour:
>
> IN SPANISH
> 1.- En el tercer GET, No debe permitir su edicion cuando es menor  
> que 0,
> sin embargo si lo permite y luego se cuelga
> 2.- No muestra los mensajes que se indican en la clausula MESS
>
> IN ENGLISH
> 1.- In the third one GET, should Not permit its edicion when is  
> smaller
> that 0, nevertheless if permits it and then hang
> 2.- Does not it show the messages that are indicated in the clause  
> MESS
>
> Best Regards
> GVS
>
>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From philb at philb.us  Sat Sep  8 19:43:01 2007
From: philb at philb.us (Phil Barnett)
Date: Sat Sep  8 19:44:36 2007
Subject: [Harbour] ChangeLog(s)
In-Reply-To: <20070908181110.GA2269@localhost.localdomain>
References: <20070908134507.GA30804@localhost.localdomain>
	<200709081315.28848.philb@philb.us>
	<20070908181110.GA2269@localhost.localdomain>
Message-ID: <200709081943.01099.philb@philb.us>

On Saturday 08 September 2007, Przemyslaw Czerpak wrote:
> On Sat, 08 Sep 2007, Phil Barnett wrote:
> > > If possible I think it will be good to put this script on
> > > ? ? ? Harbour home page so Linux users using RPM based distributions
> > > ? ? ? can simply download it and execute. It should greatly help them
> > > ? ? ? and it will reduce some repeated questions.
> >
> > Why doesn't the rpm put it in /usr/sbin?
>
> Because this script can be used when you do not have RPM or any
> other Harbour binaries and source code.
> It's for new users which can take this scripts and execute it.
> This scripts will check if they have installed tools necessary
> to build Harbour (if not they will display missing packages) and
> then will take Harbour source code from SF SVN repository and will
> compile it creating RPMs on local disk. Final binary RPMs will be
> placed in $HOME/RPM/RPMS/<arch> directory.
> All this operations can (and should) be executed from non root
> account and only the last phase: installing RPMs should be done
> with root privileges.
>
> So this script is the easiest way to start working with Harbour
> on new Linux box if it's RPM based distribution. I think that
> having such scripts on Harbour home page will help users.

Yes, I see. That makes perfect sense. Of course, the best thing would be for 
Harbour to be in the distributions RPM repository for everyone to pull 
instead of having to build it, but this is a nice second place.

-- 
Phil Barnett
AI4OF
SKCC #600
From gvarona at ec-red.com  Sat Sep  8 22:35:21 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Sat Sep  8 22:35:23 2007
Subject: [Harbour] Error con el Mouse en Clase tBrowe / Error with the
	Mouse in Class tBrowe
In-Reply-To: <699967DD-3F7C-4930-9E31-B93DBF94E0CA@syenar.hu>
References: <46E2EFF7.2080807@ec-red.com> <46E31979.5070005@ec-red.com>
	<699967DD-3F7C-4930-9E31-B93DBF94E0CA@syenar.hu>
Message-ID: <46E35BE9.7070604@ec-red.com>

Szak?ts Viktor escribi?:
> Hi,
Hi Viktor, thank for your answer
> Could you pls provide an small example which
> demonstrates the problem?
He intentado aislar el problema, pero no he podido, el problema lo veo 
en la aplicacion completa que estoy probando, en Clipper funciona bien, 
pero en harbour cambia los colores.
Seguire intentando aislar el problema.

ENGLISH:
I have tried to isolate the problem, but I have not been able, the 
problem I see it in the aplicacion complete that I am testing, in 
Clipper functions well, but in harbour changes the colors. 
I continued trying to isolate the problem. 

Best Regards
GVS
From gvarona at ec-red.com  Sat Sep  8 22:41:19 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Sat Sep  8 22:41:20 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <7B4D33DF-61B0-400E-9EAB-CE2C74448766@syenar.hu>
References: <46E317F2.2050501@ec-red.com>
	<7B4D33DF-61B0-400E-9EAB-CE2C74448766@syenar.hu>
Message-ID: <46E35D4F.4030300@ec-red.com>

Szak?ts Viktor escribi?:
> 1) I'll check into the WHEN problem.
Thank again.
> 2) it seems that Harbour's (and xhb's) TGETLIST doesn't have
>    support for any C5.3 features, like MESSAGE. I'll look into
>    it too.
The Example functions correctly in Clipper 5.3b: and xHarbour + BCC + 
WinXP Sp2

Best Regards
GVS


> Notice however that MESSAGE support is kind of a mess in C5.3
> (at least what I've seen from it) and actual implementation
> differs from documented behaviour in the NG.
>
> Brgds,
> Viktor
>
> On 2007.09.08., at 23:45, Guillermo Varona Silup? wrote:
>
>> Hi / Hola:
>>
>> SP: Este Ejemplo funciona correctamente en Clipper 5.3b:
>> EN: This Example functions correctly in Clipper 5.3b:
>>
>> Uso: WinXP + MinGW
>>
>> #include "INKEY.CH"
>> PROCEDURE main
>> LOCAL nValor1 := nValor2 := nSuma := 0
>> setmode(25,80)
>> CLS
>>
>> SET(_SET_EVENTMASK, INKEY_ALL)
>> MSETCURSOR(.T.)
>>
>> DO WHILE .T.
>>    @ 10,1 SAY "                Valor 1:" GET nValor1 MESS 'Digite el
>> Primer sumando'
>>    @ 11,1 SAY "                Valor 2:" GET nValor2 MESS 'Digite el
>> Segundo sumando'
>>    @ 12,1 SAY "Aqui falla con el Mouse:" GET nSuma WHEN (nSuma :=
>> ROUND(nValor1*nValor2,2))<0;
>>        MESS "Este es el Producto"
>>    READ MSG AT 15,1,78 MSG COLOR 'w+/b'
>>    wait
>>    IF LASTKEY()=K_ESC
>>       EXIT
>>    ENDIF
>> ENDDO
>> RETURN
>>
>> **************************
>>
>> En Harbour / In harbour:
>>
>> IN SPANISH
>> 1.- En el tercer GET, No debe permitir su edicion cuando es menor que 0,
>> sin embargo si lo permite y luego se cuelga
>> 2.- No muestra los mensajes que se indican en la clausula MESS
>>
>> IN ENGLISH
>> 1.- In the third one GET, should Not permit its edicion when is smaller
>> that 0, nevertheless if permits it and then hang
>> 2.- Does not it show the messages that are indicated in the clause MESS
>>
>> Best Regards
>> GVS
>>
>>
>>
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>

From gvarona at ec-red.com  Sat Sep  8 22:46:06 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Sat Sep  8 22:46:06 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <46E35D4F.4030300@ec-red.com>
References: <46E317F2.2050501@ec-red.com>	<7B4D33DF-61B0-400E-9EAB-CE2C74448766@syenar.hu>
	<46E35D4F.4030300@ec-red.com>
Message-ID: <46E35E6E.4080104@ec-red.com>

Me temo que no he entendido bien la respuesta de Viktor, puede algun 
alma caritativa traducir este mensaje al espa?ol.
Gracias de Antemano.

Salu2,
GVS


Guillermo Varona Silup? escribi?:
> Szak?ts Viktor escribi?:
>> 1) I'll check into the WHEN problem.
> Thank again.
>> 2) it seems that Harbour's (and xhb's) TGETLIST doesn't have
>>    support for any C5.3 features, like MESSAGE. I'll look into
>>    it too.
> The Example functions correctly in Clipper 5.3b: and xHarbour + BCC + 
> WinXP Sp2
>
> Best Regards
> GVS
>
>
>> Notice however that MESSAGE support is kind of a mess in C5.3
>> (at least what I've seen from it) and actual implementation
>> differs from documented behaviour in the NG.
>>
>> Brgds,
>> Viktor
>>
>> On 2007.09.08., at 23:45, Guillermo Varona Silup? wrote:
>>
>>> Hi / Hola:
>>>
>>> SP: Este Ejemplo funciona correctamente en Clipper 5.3b:
>>> EN: This Example functions correctly in Clipper 5.3b:
>>>
>>> Uso: WinXP + MinGW
>>>
>>> #include "INKEY.CH"
>>> PROCEDURE main
>>> LOCAL nValor1 := nValor2 := nSuma := 0
>>> setmode(25,80)
>>> CLS
>>>
>>> SET(_SET_EVENTMASK, INKEY_ALL)
>>> MSETCURSOR(.T.)
>>>
>>> DO WHILE .T.
>>>    @ 10,1 SAY "                Valor 1:" GET nValor1 MESS 'Digite el
>>> Primer sumando'
>>>    @ 11,1 SAY "                Valor 2:" GET nValor2 MESS 'Digite el
>>> Segundo sumando'
>>>    @ 12,1 SAY "Aqui falla con el Mouse:" GET nSuma WHEN (nSuma :=
>>> ROUND(nValor1*nValor2,2))<0;
>>>        MESS "Este es el Producto"
>>>    READ MSG AT 15,1,78 MSG COLOR 'w+/b'
>>>    wait
>>>    IF LASTKEY()=K_ESC
>>>       EXIT
>>>    ENDIF
>>> ENDDO
>>> RETURN
>>>
>>> **************************
>>>
>>> En Harbour / In harbour:
>>>
>>> IN SPANISH
>>> 1.- En el tercer GET, No debe permitir su edicion cuando es menor 
>>> que 0,
>>> sin embargo si lo permite y luego se cuelga
>>> 2.- No muestra los mensajes que se indican en la clausula MESS
>>>
>>> IN ENGLISH
>>> 1.- In the third one GET, should Not permit its edicion when is smaller
>>> that 0, nevertheless if permits it and then hang
>>> 2.- Does not it show the messages that are indicated in the clause MESS
>>>
>>> Best Regards
>>> GVS
>>>
>>>
>>>
>>> _______________________________________________
>>> Harbour mailing list
>>> Harbour@harbour-project.org
>>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>

From teo at windtelsoft.com  Sat Sep  8 23:29:48 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sat Sep  8 23:29:57 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <46E35E6E.4080104@ec-red.com>
References: <46E317F2.2050501@ec-red.com> <46E35D4F.4030300@ec-red.com>
	<46E35E6E.4080104@ec-red.com>
Message-ID: <200709082229.48767.teo@windtelsoft.com>

On Saturday 08 September 2007 09:46:06 pm Guillermo Varona Silup? wrote:
> Me temo que no he entendido bien la respuesta de Viktor, puede algun
> alma caritativa traducir este mensaje al espa?ol.
> Gracias de Antemano.

Guillermo,

Ahi te va la traduccion.

[pasted from a previous message]
1) I'll check into the WHEN problem.

2) it seems that Harbour's (and xhb's) TGETLIST doesn't have
? ? support for any C5.3 features, like MESSAGE. I'll look into
? ? it too.

Notice however that MESSAGE support is kind of a mess in C5.3
(at least what I've seen from it) and actual implementation
differs from documented behaviour in the NG.
[end pasted message]

1) Voy a checar el problema con WHEN.

2) Parece ser que TGETLIST en Harbour (y xHB) no soporta ninguna de
   las prestaciones de C5.3, como MESSAGE. Voy a checar esto tambien.

Advierte que, de cualquier forma el soporte para MESSAGE es un
lio en C5.3 (al menos lo que he visto de esto) y la actual implementacion es 
diferente de lo que esta documentado en el NG.


Saludos

Teo Fonrouge
From gvarona at ec-red.com  Sun Sep  9 02:24:58 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Sun Sep  9 02:24:58 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <200709082229.48767.teo@windtelsoft.com>
References: <46E317F2.2050501@ec-red.com>
	<46E35D4F.4030300@ec-red.com>	<46E35E6E.4080104@ec-red.com>
	<200709082229.48767.teo@windtelsoft.com>
Message-ID: <46E391BA.1020607@ec-red.com>

Muchas Gracias Teo, creo que no estaba tan lejos de lo que habia entendido.

Salu2,
GVS



Teo Fonrouge escribi?:
> On Saturday 08 September 2007 09:46:06 pm Guillermo Varona Silup? wrote:
>   
>> Me temo que no he entendido bien la respuesta de Viktor, puede algun
>> alma caritativa traducir este mensaje al espa?ol.
>> Gracias de Antemano.
>>     
>
> Guillermo,
>
> Ahi te va la traduccion.
>
> [pasted from a previous message]
> 1) I'll check into the WHEN problem.
>
> 2) it seems that Harbour's (and xhb's) TGETLIST doesn't have
>     support for any C5.3 features, like MESSAGE. I'll look into
>     it too.
>
> Notice however that MESSAGE support is kind of a mess in C5.3
> (at least what I've seen from it) and actual implementation
> differs from documented behaviour in the NG.
> [end pasted message]
>
> 1) Voy a checar el problema con WHEN.
>
> 2) Parece ser que TGETLIST en Harbour (y xHB) no soporta ninguna de
>    las prestaciones de C5.3, como MESSAGE. Voy a checar esto tambien.
>
> Advierte que, de cualquier forma el soporte para MESSAGE es un
> lio en C5.3 (al menos lo que he visto de esto) y la actual implementacion es 
> diferente de lo que esta documentado en el NG.
>
>
> Saludos
>
> Teo Fonrouge
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>
>   

From teo at windtelsoft.com  Sun Sep  9 06:24:58 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sun Sep  9 06:25:04 2007
Subject: [Harbour] [Viktor] HBEditor: Scope of some vars
Message-ID: <200709090524.58531.teo@windtelsoft.com>

Hello,

I think that we need to change the PROTECTED scope from some vars in the 
HBEditor class to EXPORTED.

For example, the HBEditor:nRow is now PROTECTED, but it is causing a 'Scope 
violation (protected)' error in the TDebugger:ToCursor() method:

2705: LOCAL cName := strip_path( ::cPrgName ), nLine := ::oBrwText:nRow

which is a correct error message due to the PROTECTED scope of the nRow var.

Some other vars that have the same problem are:

  aText
  lWordWrap
  nCol
  nFirstCol
  nFirstRow
  nRow
  nWordWrapCol



best regards

Teo

From harbour.01 at syenar.hu  Sun Sep  9 08:04:13 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 08:04:22 2007
Subject: [Harbour] [Viktor] HBEditor: Scope of some vars
In-Reply-To: <200709090524.58531.teo@windtelsoft.com>
References: <200709090524.58531.teo@windtelsoft.com>
Message-ID: <69DEA21C-962F-43E1-BC8D-C110F41910F7@syenar.hu>

Hi Teo,

Thanks. I've added :RowPos(), :ColPos(), :IsWordWrap(),
:WordWrapCol() to HBEditor() and :End() to TBrwText.
aText is very much internal and can be changed in the
future, so developers should use :GetLine() or :GetText()
to access the text (or subclass HBEditor and make it
available via a method).

I've noticed some namespace violations in the debugger
code, so I'll fix those too (with some additions to
hbcompat.ch).

Brgds,
Viktor

On 2007.09.09., at 12:24, Teo Fonrouge wrote:

> Hello,
>
> I think that we need to change the PROTECTED scope from some vars  
> in the
> HBEditor class to EXPORTED.
>
> For example, the HBEditor:nRow is now PROTECTED, but it is causing  
> a 'Scope
> violation (protected)' error in the TDebugger:ToCursor() method:
>
> 2705: LOCAL cName := strip_path( ::cPrgName ),  
> nLine := ::oBrwText:nRow
>
> which is a correct error message due to the PROTECTED scope of the  
> nRow var.
>
> Some other vars that have the same problem are:
>
>   aText
>   lWordWrap
>   nCol
>   nFirstCol
>   nFirstRow
>   nRow
>   nWordWrapCol
>
>
>
> best regards
>
> Teo
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Sep  9 13:43:03 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 13:43:04 2007
Subject: [Harbour] CHANGELOG: 2007-09-09 19:38 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f308$Blat.v2.6.1$df6e59ac$e7470850628@127.0.0.1>

2007-09-09 19:38 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * include/setcurs.ch
   * include/hbapigt.h
     * SC_UNDEF moved to .prg level.
     ! SC_* defs not duplicated on C level.

   * include/hbcompat.ch
     + Added debugger class compatibility translations.

   * source/rtl/tmenusys.prg
   * source/rtl/menusys.prg
     * Formatting.

   * source/rtl/teditor.prg
   * source/debug/debugger.prg
     + Added :RowPow(), :ColPos(), :IsWordWrap(), :WordWrapCol()
     ! Changed debugger to use the above methods instead of direct 
       instance var access.

   * source/rtl/tbcolumn.prg
   * source/rtl/tget.prg
   * source/rtl/tbrowse.prg
     ! Public class initializator names hidden when in strict 
       (and non-XPP) mode.

   * source/rtl/tbrowse.prg
     + Some work in progress towards better C5.x compatibility
       (borrowed from xhb)

   * source/rtl/getsys.prg
   * source/rtl/tgetlist.prg
     + (Better) C5.3 message line support, several 5.3 fixes, 
       some of them borrowed from xhb.

   * include/hbcompat.ch
   * source/debug/dbgtobj.prg
   * source/debug/dbgbrwsr.prg
   * source/debug/dbgtwin.prg
   * source/debug/dbgmenu.prg
   * source/debug/dbgthsh.prg
   * source/debug/tbrwtext.prg
   * source/debug/dbgwa.prg
   * source/debug/debugger.prg
   * source/debug/dbghelp.prg
   * source/debug/dbgtarr.prg
   * source/debug/dbgtmenu.prg
   * source/debug/dbgtmitm.prg
     ! Class names named to be in the Harbour namespace.
       xhb compatibility translations added to hbcompat.ch
     ! Unneeded BEGINDUMP and .h inclusions removed.
     ! Added :End() to HBBrwText to avoid using some 
       internals vars of the class.
     ! Fixed problem with HBDebugger:SaveAppScreen() 
       where it crashed due to wrong initialization 
       of TBrowse() screen coordinates. Bug appeared 
       due to the now more compatible TBrowse() behaviour.
     % Optimizations and cleanups.
     % Unused vars/functions removed.
     * Formatting (except large parts of debugger.prg and 
       those files which were okey).
     ; Majority of formatting, optimization and code cleanup 
       work is still left to do.

     Please test as much as you can.

From harbour.01 at syenar.hu  Sun Sep  9 13:45:29 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 13:45:37 2007
Subject: [Harbour] [Viktor] HBEditor: Scope of some vars
In-Reply-To: <200709090524.58531.teo@windtelsoft.com>
References: <200709090524.58531.teo@windtelsoft.com>
Message-ID: <1B4C20DE-E035-4AF7-8AA6-0917B530BAC8@syenar.hu>

Hi Teo,

Changes committed, please test the END key behaviour
in the debugger (source code window probably), if it's
working alright.

Brgds,
Viktor

On 2007.09.09., at 12:24, Teo Fonrouge wrote:

> Hello,
>
> I think that we need to change the PROTECTED scope from some vars  
> in the
> HBEditor class to EXPORTED.
>
> For example, the HBEditor:nRow is now PROTECTED, but it is causing  
> a 'Scope
> violation (protected)' error in the TDebugger:ToCursor() method:
>
> 2705: LOCAL cName := strip_path( ::cPrgName ),  
> nLine := ::oBrwText:nRow
>
> which is a correct error message due to the PROTECTED scope of the  
> nRow var.
>
> Some other vars that have the same problem are:
>
>   aText
>   lWordWrap
>   nCol
>   nFirstCol
>   nFirstRow
>   nRow
>   nWordWrapCol
>
>
>
> best regards
>
> Teo
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Sep  9 13:48:19 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 13:48:29 2007
Subject: [Harbour] Error con el Mouse en Clase tBrowe / Error with the
	Mouse in Class tBrowe 
In-Reply-To: <46E2EFF7.2080807@ec-red.com>
References: <46E2EFF7.2080807@ec-red.com>
Message-ID: <58FE784F-3C4E-4B13-9016-F7051E730411@syenar.hu>

This should be now fixed.

Brgds,
Viktor

On 2007.09.08., at 20:54, Guillermo Varona Silup? wrote:

> Hola Viktor, he probado los ultimos cambios realizados en las clase  
> menu y browse.
> He compilado una aplicaci?n peque?a, generando el ejecutable sin  
> problemas.
> Cuando ejecuto el programa y utilizo el mouse, obtengo el siguiente  
> error:
>
> <freetranslation.com>
> Hello Viktor, I have tested the last changes carried out in the  
> class menu and browse. I have compiled a small application,  
> generating the EXE one without problems. When I execute the program  
> and I utilize the mouse, I obtain the following error:
> Error BASE/42  Scope violation (protected): TBROWSE:NROWPOS
> Called from TBROWSE:NROWPOS
> Called from TBMOUSE(1982)
> Called from (b)SETKEY(1875)
> Called from TBROWSE:TAPPLYKEY(1915)
> Called from TBROWSE:APPLYKEY(1850)
> Called from MIDBMENX(519)
> Called from PRESUPUE(143)
> Called from (b)CREA_MENU(82)
> Called from EXECUTE(432)
> Called from MENUMODAL(208)
> Called from MAIN(256)
>
> Best Regards.
> GVS
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Sep  9 13:48:40 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 13:48:46 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <46E317F2.2050501@ec-red.com>
References: <46E317F2.2050501@ec-red.com>
Message-ID: <DF6F14CE-D35B-4AFF-849B-DF3763DB7853@syenar.hu>

Both should be fixed now.

Brgds,
Viktor

On 2007.09.08., at 23:45, Guillermo Varona Silup? wrote:

> Hi / Hola:
>
> SP: Este Ejemplo funciona correctamente en Clipper 5.3b:
> EN: This Example functions correctly in Clipper 5.3b:
>
> Uso: WinXP + MinGW
>
> #include "INKEY.CH"
> PROCEDURE main
> LOCAL nValor1 := nValor2 := nSuma := 0
> setmode(25,80)
> CLS
>
> SET(_SET_EVENTMASK, INKEY_ALL)
> MSETCURSOR(.T.)
>
> DO WHILE .T.
>    @ 10,1 SAY "                Valor 1:" GET nValor1 MESS 'Digite el
> Primer sumando'
>    @ 11,1 SAY "                Valor 2:" GET nValor2 MESS 'Digite el
> Segundo sumando'
>    @ 12,1 SAY "Aqui falla con el Mouse:" GET nSuma WHEN (nSuma :=
> ROUND(nValor1*nValor2,2))<0;
>        MESS "Este es el Producto"
>    READ MSG AT 15,1,78 MSG COLOR 'w+/b'
>    wait
>    IF LASTKEY()=K_ESC
>       EXIT
>    ENDIF
> ENDDO
> RETURN
>
> **************************
>
> En Harbour / In harbour:
>
> IN SPANISH
> 1.- En el tercer GET, No debe permitir su edicion cuando es menor  
> que 0,
> sin embargo si lo permite y luego se cuelga
> 2.- No muestra los mensajes que se indican en la clausula MESS
>
> IN ENGLISH
> 1.- In the third one GET, should Not permit its edicion when is  
> smaller
> that 0, nevertheless if permits it and then hang
> 2.- Does not it show the messages that are indicated in the clause  
> MESS
>
> Best Regards
> GVS
>
>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Sep  9 13:50:04 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 13:50:13 2007
Subject: [Harbour] Error con el Mouse en Clase tBrowe / Error with the
	Mouse in Class tBrowe
In-Reply-To: <46E35BE9.7070604@ec-red.com>
References: <46E2EFF7.2080807@ec-red.com> <46E31979.5070005@ec-red.com>
	<699967DD-3F7C-4930-9E31-B93DBF94E0CA@syenar.hu>
	<46E35BE9.7070604@ec-red.com>
Message-ID: <104E8599-AC4E-40B8-B64B-00999B1CC96F@syenar.hu>

Thanks, if you have anything closer, tell me and I'll
look into it.

Test with the new repository first, might be that it
fixed the problem.

Brgds,
Viktor

On 2007.09.09., at 4:35, Guillermo Varona Silup? wrote:

> Szak?ts Viktor escribi?:
>> Hi,
> Hi Viktor, thank for your answer
>> Could you pls provide an small example which
>> demonstrates the problem?
> He intentado aislar el problema, pero no he podido, el problema lo  
> veo en la aplicacion completa que estoy probando, en Clipper  
> funciona bien, pero en harbour cambia los colores.
> Seguire intentando aislar el problema.
>
> ENGLISH:
> I have tried to isolate the problem, but I have not been able, the  
> problem I see it in the aplicacion complete that I am testing, in  
> Clipper functions well, but in harbour changes the colors. I  
> continued trying to isolate the problem.
> Best Regards
> GVS
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Sep  9 13:50:41 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 13:50:48 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <46E35D4F.4030300@ec-red.com>
References: <46E317F2.2050501@ec-red.com>
	<7B4D33DF-61B0-400E-9EAB-CE2C74448766@syenar.hu>
	<46E35D4F.4030300@ec-red.com>
Message-ID: <9FDD653A-856E-4920-93D5-45A4A1658178@syenar.hu>

> Szak?ts Viktor escribi?:
>> 1) I'll check into the WHEN problem.
> Thank again.
>> 2) it seems that Harbour's (and xhb's) TGETLIST doesn't have
>>    support for any C5.3 features, like MESSAGE. I'll look into
>>    it too.
> The Example functions correctly in Clipper 5.3b: and xHarbour + BCC  
> + WinXP Sp2

You're right, xhb has some message support albeit it's not


>
> Best Regards
> GVS
>
>
>> Notice however that MESSAGE support is kind of a mess in C5.3
>> (at least what I've seen from it) and actual implementation
>> differs from documented behaviour in the NG.
>>
>> Brgds,
>> Viktor
>>
>> On 2007.09.08., at 23:45, Guillermo Varona Silup? wrote:
>>
>>> Hi / Hola:
>>>
>>> SP: Este Ejemplo funciona correctamente en Clipper 5.3b:
>>> EN: This Example functions correctly in Clipper 5.3b:
>>>
>>> Uso: WinXP + MinGW
>>>
>>> #include "INKEY.CH"
>>> PROCEDURE main
>>> LOCAL nValor1 := nValor2 := nSuma := 0
>>> setmode(25,80)
>>> CLS
>>>
>>> SET(_SET_EVENTMASK, INKEY_ALL)
>>> MSETCURSOR(.T.)
>>>
>>> DO WHILE .T.
>>>    @ 10,1 SAY "                Valor 1:" GET nValor1 MESS 'Digite el
>>> Primer sumando'
>>>    @ 11,1 SAY "                Valor 2:" GET nValor2 MESS 'Digite el
>>> Segundo sumando'
>>>    @ 12,1 SAY "Aqui falla con el Mouse:" GET nSuma WHEN (nSuma :=
>>> ROUND(nValor1*nValor2,2))<0;
>>>        MESS "Este es el Producto"
>>>    READ MSG AT 15,1,78 MSG COLOR 'w+/b'
>>>    wait
>>>    IF LASTKEY()=K_ESC
>>>       EXIT
>>>    ENDIF
>>> ENDDO
>>> RETURN
>>>
>>> **************************
>>>
>>> En Harbour / In harbour:
>>>
>>> IN SPANISH
>>> 1.- En el tercer GET, No debe permitir su edicion cuando es menor  
>>> que 0,
>>> sin embargo si lo permite y luego se cuelga
>>> 2.- No muestra los mensajes que se indican en la clausula MESS
>>>
>>> IN ENGLISH
>>> 1.- In the third one GET, should Not permit its edicion when is  
>>> smaller
>>> that 0, nevertheless if permits it and then hang
>>> 2.- Does not it show the messages that are indicated in the  
>>> clause MESS
>>>
>>> Best Regards
>>> GVS
>>>
>>>
>>>
>>> _______________________________________________
>>> Harbour mailing list
>>> Harbour@harbour-project.org
>>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Sep  9 13:53:01 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 13:53:11 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <46E35D4F.4030300@ec-red.com>
References: <46E317F2.2050501@ec-red.com>
	<7B4D33DF-61B0-400E-9EAB-CE2C74448766@syenar.hu>
	<46E35D4F.4030300@ec-red.com>
Message-ID: <131002D3-1709-4B28-A78B-DE9A7453905A@syenar.hu>

> Szak?ts Viktor escribi?:
>> 1) I'll check into the WHEN problem.
> Thank again.
>> 2) it seems that Harbour's (and xhb's) TGETLIST doesn't have
>>    support for any C5.3 features, like MESSAGE. I'll look into
>>    it too.
> The Example functions correctly in Clipper 5.3b: and xHarbour + BCC  
> + WinXP Sp2

You're right, xhb has some message support albeit it's not
fully CA-Cl*pper 5.3 compatible. Since message support
is a mess in C5.3 anyway, this might not be a problem in
practice, but Harbour and xhb won't be fully compatible
here (Harbour being closer to C5.3, at least after we've
finished nailing the remaining bugs).

Brgds,
Viktor


>
> Best Regards
> GVS
>
>
>> Notice however that MESSAGE support is kind of a mess in C5.3
>> (at least what I've seen from it) and actual implementation
>> differs from documented behaviour in the NG.
>>
>> Brgds,
>> Viktor
>>
>> On 2007.09.08., at 23:45, Guillermo Varona Silup? wrote:
>>
>>> Hi / Hola:
>>>
>>> SP: Este Ejemplo funciona correctamente en Clipper 5.3b:
>>> EN: This Example functions correctly in Clipper 5.3b:
>>>
>>> Uso: WinXP + MinGW
>>>
>>> #include "INKEY.CH"
>>> PROCEDURE main
>>> LOCAL nValor1 := nValor2 := nSuma := 0
>>> setmode(25,80)
>>> CLS
>>>
>>> SET(_SET_EVENTMASK, INKEY_ALL)
>>> MSETCURSOR(.T.)
>>>
>>> DO WHILE .T.
>>>    @ 10,1 SAY "                Valor 1:" GET nValor1 MESS 'Digite el
>>> Primer sumando'
>>>    @ 11,1 SAY "                Valor 2:" GET nValor2 MESS 'Digite el
>>> Segundo sumando'
>>>    @ 12,1 SAY "Aqui falla con el Mouse:" GET nSuma WHEN (nSuma :=
>>> ROUND(nValor1*nValor2,2))<0;
>>>        MESS "Este es el Producto"
>>>    READ MSG AT 15,1,78 MSG COLOR 'w+/b'
>>>    wait
>>>    IF LASTKEY()=K_ESC
>>>       EXIT
>>>    ENDIF
>>> ENDDO
>>> RETURN
>>>
>>> **************************
>>>
>>> En Harbour / In harbour:
>>>
>>> IN SPANISH
>>> 1.- En el tercer GET, No debe permitir su edicion cuando es menor  
>>> que 0,
>>> sin embargo si lo permite y luego se cuelga
>>> 2.- No muestra los mensajes que se indican en la clausula MESS
>>>
>>> IN ENGLISH
>>> 1.- In the third one GET, should Not permit its edicion when is  
>>> smaller
>>> that 0, nevertheless if permits it and then hang
>>> 2.- Does not it show the messages that are indicated in the  
>>> clause MESS
>>>
>>> Best Regards
>>> GVS
>>>
>>>
>>>
>>> _______________________________________________
>>> Harbour mailing list
>>> Harbour@harbour-project.org
>>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From teo at windtelsoft.com  Sun Sep  9 16:56:01 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sun Sep  9 16:56:09 2007
Subject: [Harbour] [Viktor] HBEditor: Scope of some vars
In-Reply-To: <1B4C20DE-E035-4AF7-8AA6-0917B530BAC8@syenar.hu>
References: <200709090524.58531.teo@windtelsoft.com>
	<1B4C20DE-E035-4AF7-8AA6-0917B530BAC8@syenar.hu>
Message-ID: <200709091556.02001.teo@windtelsoft.com>

On Sunday 09 September 2007 12:45:29 pm Szak?ts Viktor wrote:
> Hi Teo,
>
> Changes committed, please test the END key behaviour
> in the debugger (source code window probably), if it's
> working alright.

With your last changes it is working ok now.

Regarding the K_END key code inside of the debugger, maybe I'm wrong but IIRC 
in the old Clipper the K_END key used to move the cursor to the end of 
current line in the source code window.

Which is the subject for another little problem with the debugger; in the 
following sample, please move the cursor up to the end of line by using the 
K_LEFT arrow key, please compile it with the -b flag:

[prg]
FUNCTION Main()
 
  AltD()

  ? ".....................................................................................This 
is a very long line of source code"

RETURN NIL
[\prg]

You'll see that suddenly all the source code window is cleared.



Thanks Viktor.


best regards

Teo
From harbour.01 at syenar.hu  Sun Sep  9 19:56:12 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 19:56:12 2007
Subject: [Harbour] CHANGELOG: 2007-09-10 01:53 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f33d$Blat.v2.6.1$002cdee6$eb0ea1193f6@127.0.0.1>

2007-09-10 01:53 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/tgetlist.prg
     ! Fixed two typos in previous commit.

   * source/debug/dbgtobj.prg
   * source/debug/dbgthsh.prg
   * source/debug/dbgwa.prg
   * source/debug/debugger.prg
   * source/debug/dbgtarr.prg
     * Further formatting, cleanup, minor optimizations.
     + Added Ctrl+PgUp/PgDn + Ctrl+Home/End everywhere as 
       synonyms to Home/End.

From harbour.01 at syenar.hu  Sun Sep  9 21:30:03 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 21:30:01 2007
Subject: [Harbour] CHANGELOG: 2007-09-10 03:28 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f34a$Blat.v2.6.1$1ccd314c$14ec3e212fa6@127.0.0.1>

2007-09-10 03:28 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/color53.prg
     ! Fixed ApplyDefau().
     % Optimized.

   * source/debug/tbrwtext.prg
     ! Minor formatting.

   * source/rtl/memoedit.prg
     ! Variable name cleanup.

   * source/rtl/memoedit.prg
   * source/rtl/symbol.prg
   * source/rtl/color53.prg
   * source/rtl/teditor.prg
   * source/debug/dbgthsh.prg
   * source/debug/dbgtarr.prg
     ! "=" operators changed to ":=" (or "==" as per context)

From harbour.01 at syenar.hu  Sun Sep  9 21:31:40 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 21:31:48 2007
Subject: [Harbour] [Viktor] HBEditor: Scope of some vars
In-Reply-To: <200709091556.02001.teo@windtelsoft.com>
References: <200709090524.58531.teo@windtelsoft.com>
	<1B4C20DE-E035-4AF7-8AA6-0917B530BAC8@syenar.hu>
	<200709091556.02001.teo@windtelsoft.com>
Message-ID: <0AF41C68-8210-43AA-9C94-14B0A945CDB9@syenar.hu>

> With your last changes it is working ok now.
>
> Regarding the K_END key code inside of the debugger, maybe I'm  
> wrong but IIRC
> in the old Clipper the K_END key used to move the cursor to the end of
> current line in the source code window.

Well, I've just tested and C5.2 doesn't do anything when pressing
the END key, so I think we're fine now in Harbour. It actually
goes to the end of the line, but it seems to be off by some chars
for some reason (probably because some more methods would have
to be overloaded along with :GetLine(), which adds the line
number to beginning of each line, the cursor is off by exactly the
width of the line number).

CA-Cl*pper does however go to top and bottom using Ctrl+PgUp/PgDn.
I've added that to Harbour.

> Which is the subject for another little problem with the debugger;  
> in the
> following sample, please move the cursor up to the end of line by  
> using the
> K_LEFT arrow key, please compile it with the -b flag:

I guess this will be something inside the HBEditor() class or
the way it's subclassed. I'm afraid I won't be able to allocate
enough time to fix this one. If anyone would be kind enough to
jump in for a fix, it would be great.

Brgds,
Viktor

>
> [prg]
> FUNCTION Main()
>
>   AltD()
>
>   ?  
> "..................................................................... 
> ................This
> is a very long line of source code"
>
> RETURN NIL
> [\prg]
>
> You'll see that suddenly all the source code window is cleared.
>
>
>
> Thanks Viktor.
>
>
> best regards
>
> Teo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Sep  9 21:39:46 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep  9 21:39:44 2007
Subject: [Harbour] CHANGELOG: 2007-09-10 03:38 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f34b$Blat.v2.6.1$77c408c2$16e4b96a3b30@127.0.0.1>

2007-09-10 03:38 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/scrollbr.prg
   * source/rtl/tpopup.prg
     % Removed two no more needed classname override lines.

From harbour.01 at syenar.hu  Mon Sep 10 06:02:01 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 10 06:02:00 2007
Subject: [Harbour] CHANGELOG: 2007-09-10 12:01 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f391$Blat.v2.6.1$a22a66a6$1704faa15524@127.0.0.1>

2007-09-10 12:01 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/color53.prg
     + Added HB_COMPAT_C53 guards.

   * source/rtl/tgetlist.prg
     + Two new methods to return Self rather than NIL.

   * source/rtl/einstvar.prg
     + Added HB_C52_STRICT branch.

   * source/rtl/tbrowse.prg
     + Continued prev. changed.

From druzus at priv.onet.pl  Mon Sep 10 14:13:19 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 10 14:13:27 2007
Subject: [Harbour] ChangeLog(s)
Message-ID: <20070910181319.GA14677@localhost.localdomain>

2007-09-10 20:05 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/contrib/rdd_ads/ads1.c
    * changed HB_TR_ALWAYS to HB_TR_DEBUG in two places and
      removed some old comment for which Brian received answer from ExtSys

2007-09-10 19:25 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbset.h
    * declare hb_set with HB_EXPORT attribute when HB_SET_IMPORT macro
      is not set - it's temporry modification and it will be removed when
      we will have real hb_setGet*() and hb_setPut*() functions.

2007-09-10 19:05 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbdefs.h
    + added HB_IMPORT macro

  * harbour/include/hbset.h
    * declare hb_set with HB_IMPORT attribute when HB_SET_IMPORT macro is set
    + added macros to retrieve information from hb_set structure:
      hb_setGetCPtr(), hb_setGetNI(), hb_setGetNL(), hb_setGetL()
      In the future these macros will be replaced by functions and
      direct access to hb_set structure from non core code will be
      forbidden so please update your code and and replace all
         hb_set.HB_SET_*
      with
         hb_setGet*( HB_SET_* )
      f.e. replace:
         hb_set.HB_SET_SOFTSEEK
      with:
         hb_setGetL( HB_SET_SOFTSEEK )
      I'll also add hb_setPut*() functions to assign some set values.
      Both hb_setGet*() and hb_setPut*() functions will validate parameters
      and in future MT mode will operate on global or thread local structures.

  * harbour/contrib/rdd_ads/ads1.c
    * define HB_SET_IMPORT before #include "hbset.h"
    * use hb_setGet*() to access SET values

2007-09-10 17:25 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/dbinfo.ch
  * harbour/source/rdd/workarea.c
    * renamed RDDI_TRIGGERS to RDDI_TRIGGER
    + added RDDI_PENDINGTRIGGER, RDDI_PENDINGPASSWORD,
      DBI_TRIGGER, DBI_OPENINFO
    * do not generate RT error in WA default ORDERINFO() method

  * harbour/common.mak
  * harbour/source/rtl/Makefile
  + harbour/source/rtl/hbini.prg
    + added HB_ReadIni()/HB_WriteIni() - code by Giancarlo Niccolai
      borowed from xHarbour with some minor fixes

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 10 15:12:37 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 10 15:12:57 2007
Subject: [Harbour] ChangeLog(s)
In-Reply-To: <20070910181319.GA14677@localhost.localdomain>
References: <20070910181319.GA14677@localhost.localdomain>
Message-ID: <4B8CEEDF-C714-451A-93FD-997837915851@syenar.hu>

Hi Przemek,

>   * harbour/common.mak
>   * harbour/source/rtl/Makefile
>   + harbour/source/rtl/hbini.prg
>     + added HB_ReadIni()/HB_WriteIni() - code by Giancarlo Niccolai
>       borowed from xHarbour with some minor fixes

I think we should rename these to:
hb_IniRead()
hb_IniWrite()
hb_IniSetComment() (this could be a (or two) standard Set()(s))

To have the full .ini support under the
hb_Ini*() namespace.

(with new translates in hbcompat.ch)

Brgds,
Viktor

From gvarona at ec-red.com  Mon Sep 10 16:54:27 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Mon Sep 10 16:48:41 2007
Subject: [Harbour] Get se cuelga con el Mouse . . . / Get hang with the
	Mouse. . .
In-Reply-To: <DF6F14CE-D35B-4AFF-849B-DF3763DB7853@syenar.hu>
References: <46E317F2.2050501@ec-red.com>
	<DF6F14CE-D35B-4AFF-849B-DF3763DB7853@syenar.hu>
Message-ID: <46E5AF03.9080900@ec-red.com>

Szak?ts Viktor escribi?:

> Both should be fixed now.

Thank Viktor, now all work fine

Best Regard
GVS

>
> Brgds,
> Viktor
>
> On 2007.09.08., at 23:45, Guillermo Varona Silup? wrote:
>
>> Hi / Hola:
>>
>> SP: Este Ejemplo funciona correctamente en Clipper 5.3b:
>> EN: This Example functions correctly in Clipper 5.3b:
>>
>> Uso: WinXP + MinGW
>>
>> #include "INKEY.CH"
>> PROCEDURE main
>> LOCAL nValor1 := nValor2 := nSuma := 0
>> setmode(25,80)
>> CLS
>>
>> SET(_SET_EVENTMASK, INKEY_ALL)
>> MSETCURSOR(.T.)
>>
>> DO WHILE .T.
>>    @ 10,1 SAY "                Valor 1:" GET nValor1 MESS 'Digite el
>> Primer sumando'
>>    @ 11,1 SAY "                Valor 2:" GET nValor2 MESS 'Digite el
>> Segundo sumando'
>>    @ 12,1 SAY "Aqui falla con el Mouse:" GET nSuma WHEN (nSuma :=
>> ROUND(nValor1*nValor2,2))<0;
>>        MESS "Este es el Producto"
>>    READ MSG AT 15,1,78 MSG COLOR 'w+/b'
>>    wait
>>    IF LASTKEY()=K_ESC
>>       EXIT
>>    ENDIF
>> ENDDO
>> RETURN
>>
>> **************************
>>
>> En Harbour / In harbour:
>>
>> IN SPANISH
>> 1.- En el tercer GET, No debe permitir su edicion cuando es menor  
>> que 0,
>> sin embargo si lo permite y luego se cuelga
>> 2.- No muestra los mensajes que se indican en la clausula MESS
>>
>> IN ENGLISH
>> 1.- In the third one GET, should Not permit its edicion when is  smaller
>> that 0, nevertheless if permits it and then hang
>> 2.- Does not it show the messages that are indicated in the clause  MESS
>>
>> Best Regards
>> GVS
>>
>>
>>
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>

From gvarona at ec-red.com  Mon Sep 10 16:56:01 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Mon Sep 10 16:50:05 2007
Subject: [Harbour] Error con el Mouse en Clase tBrowe / Error with the
	Mouse in Class tBrowe
In-Reply-To: <104E8599-AC4E-40B8-B64B-00999B1CC96F@syenar.hu>
References: <46E2EFF7.2080807@ec-red.com>
	<46E31979.5070005@ec-red.com>	<699967DD-3F7C-4930-9E31-B93DBF94E0CA@syenar.hu>	<46E35BE9.7070604@ec-red.com>
	<104E8599-AC4E-40B8-B64B-00999B1CC96F@syenar.hu>
Message-ID: <46E5AF61.2020107@ec-red.com>

Szak?ts Viktor escribi?:

> Test with the new repository first, might be that it
> fixed the problem.

Thank Viktor, now work fine.

Best Regards
GVS



>
> Brgds,
> Viktor
>
> On 2007.09.09., at 4:35, Guillermo Varona Silup? wrote:
>
>> Szak?ts Viktor escribi?:
>>
>>> Hi,
>>
>> Hi Viktor, thank for your answer
>>
>>> Could you pls provide an small example which
>>> demonstrates the problem?
>>
>> He intentado aislar el problema, pero no he podido, el problema lo  
>> veo en la aplicacion completa que estoy probando, en Clipper  
>> funciona bien, pero en harbour cambia los colores.
>> Seguire intentando aislar el problema.
>>
>> ENGLISH:
>> I have tried to isolate the problem, but I have not been able, the  
>> problem I see it in the aplicacion complete that I am testing, in  
>> Clipper functions well, but in harbour changes the colors. I  
>> continued trying to isolate the problem.
>> Best Regards
>> GVS
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>

From harbour.01 at syenar.hu  Mon Sep 10 16:54:17 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 10 16:54:13 2007
Subject: [Harbour] CHANGELOG: 2007-09-10 22:51 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f3ec$Blat.v2.6.1$c0bb690c$f943bfa6e24@127.0.0.1>

2007-09-10 22:51 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * contrib/libct/ctnet.c
   * contrib/libct/dattime2.c
   * contrib/samples/date.c
   * contrib/bmdbfcdx/bmdbfcdx1.c
     * Changed hb_set. access to hb_setGet*() in all 
       contrib code.

   * source/rtl/hbini.prg
     + Further cleanup.

From druzus at priv.onet.pl  Mon Sep 10 17:06:17 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 10 17:06:25 2007
Subject: [Harbour] ChangeLog(s)
In-Reply-To: <4B8CEEDF-C714-451A-93FD-997837915851@syenar.hu>
References: <20070910181319.GA14677@localhost.localdomain>
	<4B8CEEDF-C714-451A-93FD-997837915851@syenar.hu>
Message-ID: <20070910210617.GA11310@localhost.localdomain>

On Mon, 10 Sep 2007, Szak?ts Viktor wrote:
> >  * harbour/common.mak
> >  * harbour/source/rtl/Makefile
> >  + harbour/source/rtl/hbini.prg
> >    + added HB_ReadIni()/HB_WriteIni() - code by Giancarlo Niccolai
> >      borowed from xHarbour with some minor fixes
> I think we should rename these to:
> hb_IniRead()
> hb_IniWrite()
> hb_IniSetComment() (this could be a (or two) standard Set()(s))
> To have the full .ini support under the
> hb_Ini*() namespace.
> (with new translates in hbcompat.ch)

Good idea.

best regards,
Przemek
From gvarona at ec-red.com  Mon Sep 10 17:25:38 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Mon Sep 10 17:19:43 2007
Subject: [Harbour] =?iso-8859-1?q?Edici=F3n_de_campo_Memo_siempre_pregunt?=
 =?iso-8859-1?q?a_=22Abort_Edit=3F_=28Y/N=29=22?=
Message-ID: <46E5B652.2020408@ec-red.com>

Hola / Hi :
SPANISH
En el siguiente ejemplo, cuando edito el campo memo, siempre me 
pregunta:  Abort Edit? (Y/N)
En Clipper solo pregunta cuando cambie algo y presiono la tecla escape.
ENGLISH
In the following example, when I edit the field memo, always asks me:  
Abort Edit?  (And/N)
In Clipper alone asks when change something and I pressure the key escape. 

procedure main
LOCAL cMemo := "C?mo hago para que al presiona la tecla ESC no salga el 
mensaje Abort Edit? (Y/N)"
CLS
* Campo Memo
cMemo := MEMOEDIT(cMemo,13,10,20,76)

Best Regards
GVS
From harbour.01 at syenar.hu  Mon Sep 10 18:41:28 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 10 18:42:42 2007
Subject: [Harbour] CHANGELOG: 2007-09-11 00:40 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f3fb$Blat.v2.6.1$b9ea84e6$1090542eb660@127.0.0.1>

2007-09-11 00:40 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * include/hbcompat.ch
   * include/hbextern.ch
   * source/rtl/hbini.prg
     + .ini functions added to hbextern.ch.
     * .ini functions renamed so that all of them reside 
       in the hb_ini*() namespace. xhb compatibility translates 
       added.

   * source/debug/debugger.prg
     * Formatting.

   * source/rtl/memoedit.prg
     % Minor optimization.

   * source/rtl/teditor.prg
     ! Fixed to not ask for confirmation when pressing 
       <Esc> on an unedited buffer.

From harbour.01 at syenar.hu  Mon Sep 10 18:42:23 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 10 18:43:35 2007
Subject: =?ISO-8859-1?Q?Re:_[Harbour]_Edici=F3n_de_campo_Memo_siempre_pre?=
	=?ISO-8859-1?Q?gunta_"Abort_Edit=3F_=28Y/N=29"?=
In-Reply-To: <46E5B652.2020408@ec-red.com>
References: <46E5B652.2020408@ec-red.com>
Message-ID: <7CDC1374-B851-4E9B-BA36-58E243CDB9DE@syenar.hu>

Thanks Guillermo. It should be okey now, pls check.
(this was a very old bug)

Brgds,
Viktor

On 2007.09.10., at 23:25, Guillermo Varona Silup? wrote:

> Hola / Hi :
> SPANISH
> En el siguiente ejemplo, cuando edito el campo memo, siempre me  
> pregunta:  Abort Edit? (Y/N)
> En Clipper solo pregunta cuando cambie algo y presiono la tecla  
> escape.
> ENGLISH
> In the following example, when I edit the field memo, always asks  
> me:  Abort Edit?  (And/N)
> In Clipper alone asks when change something and I pressure the key  
> escape.
> procedure main
> LOCAL cMemo := "C?mo hago para que al presiona la tecla ESC no  
> salga el mensaje Abort Edit? (Y/N)"
> CLS
> * Campo Memo
> cMemo := MEMOEDIT(cMemo,13,10,20,76)
>
> Best Regards
> GVS
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Tue Sep 11 03:24:52 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Sep 11 03:24:55 2007
Subject: [Harbour] get bug and debugger/classes issue
Message-ID: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>

The test below shows 3 "pseudo buttons" under C53b <Ok> <Cancel>
<Quit> while it shows nothing under Harbour dev. It seems mainly a
display problem.

If you build the test with -b switch it shows a debugger problem: if
you try to inspect the oGet object you'll get "Error BASE/42 Scope
violation (protected): GET:BBLOCK"

I've removed PROTECTED from tget.prg to see if the problem was there
and as expected it worked but I've also seen that object shows both
BBLOCK and BLOCK like BUFFER and CBUFFER.

best regards,
Lorenzo


   #command @ <row>, <col> GETBUTTON <var>                                 ;
                           [CODE <code>]                                   ;
                           [CAPTION <caption>]                             ;
                           [CLICK <click>]                                 ;
                           [PICTURE <pic>]                                 ;
                           [VALID <valid>]                                 ;
                           [WHEN <when>]                                   ;
                                                                           ;
         => SetPos( <row>, <col> )                                         ;
          ; AAdd(                                                          ;
                  GetList,                                                 ;
                          _GET_( <var>, <(var)>, <pic>, <{valid}>, <{when}> )  ;
                )                                                          ;
          ; ATAIL(GetList):cargo := { 0, <code>, alltrim( <caption> ),
<{click}> } ;
          ; ATAIL(GetList):colordisp( "GR/N" )


procedure main()

   local GetList := {}
   local aBtns := array( 3 )

   cls

   @ 10, 10 GETBUTTON aBtns[ 1 ] CODE 1 CAPTION "Ok"
   @ 10, 20 GETBUTTON aBtns[ 2 ] CODE 2 CAPTION "Cancel"
   @ 10, 30 GETBUTTON aBtns[ 3 ] CODE 3 CAPTION "Quit"

   _getdisplay( GetList )

   read

return

function _getdisplay( GetList )

   local nCount
   local oGet

   altd()

   for nCount := 1 to len( GetList )
      oGet := GetList[ nCount ]
      if oGet:cargo[1] == 0
         oGet:VarPut( "<" + oGet:cargo[3] + ">" )
      endif
      oGet:Assign()
      oGet:display()
   next

return nil
From harbour.01 at syenar.hu  Tue Sep 11 05:16:56 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 05:17:09 2007
Subject: [Harbour] get bug and debugger/classes issue
In-Reply-To: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
References: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
Message-ID: <EDD64DDB-D3F8-4D24-BA90-3387D29BFA7C@syenar.hu>

Hi Lorenzo,

> The test below shows 3 "pseudo buttons" under C53b <Ok> <Cancel>
> <Quit> while it shows nothing under Harbour dev. It seems mainly a
> display problem.

It's a bit deeper than that, but I'll look into it.

If you change :colorDisp( "GR/N" ) to :colorSpec := "GR/N",
it will work perfectly with no bad side effects. Actually
it's even better since you save one unnecessary display of
an empty buffer on initialization. But nevertheless we should
be compatible here.

> If you build the test with -b switch it shows a debugger problem: if
> you try to inspect the oGet object you'll get "Error BASE/42 Scope
> violation (protected): GET:BBLOCK"
>
> I've removed PROTECTED from tget.prg to see if the problem was there
> and as expected it worked but I've also seen that object shows both
> BBLOCK and BLOCK like BUFFER and CBUFFER.

This seems to be a deeper (and older) problem regarding how to handle
class flags in the debugger. I'll leave that problem for someone with
better knowledge on classes and the debugger.

Brgds,
Viktor

From druzus at priv.onet.pl  Tue Sep 11 06:37:56 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 11 06:38:02 2007
Subject: [Harbour] get bug and debugger/classes issue
In-Reply-To: <EDD64DDB-D3F8-4D24-BA90-3387D29BFA7C@syenar.hu>
References: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
	<EDD64DDB-D3F8-4D24-BA90-3387D29BFA7C@syenar.hu>
Message-ID: <20070911103756.GA28427@localhost.localdomain>

On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
> >If you build the test with -b switch it shows a debugger problem: if
> >you try to inspect the oGet object you'll get "Error BASE/42 Scope
> >violation (protected): GET:BBLOCK"
> >I've removed PROTECTED from tget.prg to see if the problem was there
> >and as expected it worked but I've also seen that object shows both
> >BBLOCK and BLOCK like BUFFER and CBUFFER.
> This seems to be a deeper (and older) problem regarding how to handle
> class flags in the debugger. I'll leave that problem for someone with
> better knowledge on classes and the debugger.

This is not trivial problem.
Of course I can very easy unblock sending private and hidden messages
from debugger code but in some cases it will change the results.
Harbour supports real private class data and automatically resolves
name conflicts. It means in Harbour 'classA' can have public message
'msg' then 'classB' can inherit from 'classA' and define its own hidden
message 'msg'. In such case real classB code will execute its own hidden
'msg' message but the rest of world the public 'msg' from classA.
IMHO it's one of the most important features which allows to work on big
projects in a team because it gives real private class data so programmers
do not have to worry about name conflicts and do not have to agree name
of each message they plan to add to classes they are working on - in
complicated inheritence scheme where final classes inherits from many
others written by different programmers it's a nightmare.
Now in Harbour hidden messages belongs _only_ to class where they are
defined and current Harbour classy code resolves all name conflicts and
instance area super casting automatically.
If I'll allow to access hidden method and members from debugger code
then for classes with name conflicts it will change the executed method.
Programmer should know about it. So for debugging we should create new
inspector code which should add prefix with visibility flag and when
name conflicts appear he should show both messages, f.e for above
example with classA and classB and message 'msg' it should be:
    (E)classA:msg ...
    (H)classB:msg ...
I do not know current debugger inspector code but probably it will need
some deeper modifications. I do not have time now to work on it so maybe
someone else will try.
We can also as temporary solution disable scope checking in debugger
what will reduce debugging functionality to xHarbour and other dbase
like languages level and return to the problem when we will have real
class objects like in class(y) what should allow to create quite nice
object/class inspectors much easier.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep 11 07:34:39 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 07:34:50 2007
Subject: [Harbour] get bug and debugger/classes issue
In-Reply-To: <20070911103756.GA28427@localhost.localdomain>
References: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
	<EDD64DDB-D3F8-4D24-BA90-3387D29BFA7C@syenar.hu>
	<20070911103756.GA28427@localhost.localdomain>
Message-ID: <F98919E9-3729-4562-830E-61EA4E55EB93@syenar.hu>

Is it a solution to simply hide every hidden/protected
messages when debugging user code, and unhide all of them
when the debugger is stepping inside one of the class
methods?

In all cases I think currently we have to solve the problem
where __objGetValueList/__objMethodList() would return even
the hidden/protected messages, while __objSendMsg() would
RTE when trying to access the hidden/protected ones from this
list.

This inconsistency is easy to demonstrate using this code:

FUNCTION Main()
    LOCAL o := TBrowseNew( 0, 0, 20, 20 )
    LOCAL a := __objGetValueList( o )

    RETURN NIL

This will result in:
"Error BASE/42  Scope Violation (protected): TBROWSE:ACOLSINFO"

Brgds,
Viktor

On 2007.09.11., at 12:37, Przemyslaw Czerpak wrote:

> On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
>>> If you build the test with -b switch it shows a debugger problem: if
>>> you try to inspect the oGet object you'll get "Error BASE/42 Scope
>>> violation (protected): GET:BBLOCK"
>>> I've removed PROTECTED from tget.prg to see if the problem was there
>>> and as expected it worked but I've also seen that object shows both
>>> BBLOCK and BLOCK like BUFFER and CBUFFER.
>> This seems to be a deeper (and older) problem regarding how to handle
>> class flags in the debugger. I'll leave that problem for someone with
>> better knowledge on classes and the debugger.
>
> This is not trivial problem.
> Of course I can very easy unblock sending private and hidden messages
> from debugger code but in some cases it will change the results.
> Harbour supports real private class data and automatically resolves
> name conflicts. It means in Harbour 'classA' can have public message
> 'msg' then 'classB' can inherit from 'classA' and define its own  
> hidden
> message 'msg'. In such case real classB code will execute its own  
> hidden
> 'msg' message but the rest of world the public 'msg' from classA.
> IMHO it's one of the most important features which allows to work  
> on big
> projects in a team because it gives real private class data so  
> programmers
> do not have to worry about name conflicts and do not have to agree  
> name
> of each message they plan to add to classes they are working on - in
> complicated inheritence scheme where final classes inherits from many
> others written by different programmers it's a nightmare.
> Now in Harbour hidden messages belongs _only_ to class where they are
> defined and current Harbour classy code resolves all name conflicts  
> and
> instance area super casting automatically.
> If I'll allow to access hidden method and members from debugger code
> then for classes with name conflicts it will change the executed  
> method.
> Programmer should know about it. So for debugging we should create new
> inspector code which should add prefix with visibility flag and when
> name conflicts appear he should show both messages, f.e for above
> example with classA and classB and message 'msg' it should be:
>     (E)classA:msg ...
>     (H)classB:msg ...
> I do not know current debugger inspector code but probably it will  
> need
> some deeper modifications. I do not have time now to work on it so  
> maybe
> someone else will try.
> We can also as temporary solution disable scope checking in debugger
> what will reduce debugging functionality to xHarbour and other dbase
> like languages level and return to the problem when we will have real
> class objects like in class(y) what should allow to create quite nice
> object/class inspectors much easier.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Tue Sep 11 07:59:46 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 11 07:59:53 2007
Subject: [Harbour] get bug and debugger/classes issue
In-Reply-To: <F98919E9-3729-4562-830E-61EA4E55EB93@syenar.hu>
References: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
	<EDD64DDB-D3F8-4D24-BA90-3387D29BFA7C@syenar.hu>
	<20070911103756.GA28427@localhost.localdomain>
	<F98919E9-3729-4562-830E-61EA4E55EB93@syenar.hu>
Message-ID: <20070911115946.GA28825@localhost.localdomain>

On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
> Is it a solution to simply hide every hidden/protected
> messages when debugging user code, and unhide all of them
> when the debugger is stepping inside one of the class
> methods?
> In all cases I think currently we have to solve the problem
> where __objGetValueList/__objMethodList() would return even
> the hidden/protected messages, while __objSendMsg() would
> RTE when trying to access the hidden/protected ones from this
> list.
> This inconsistency is easy to demonstrate using this code:
> FUNCTION Main()
>    LOCAL o := TBrowseNew( 0, 0, 20, 20 )
>    LOCAL a := __objGetValueList( o )
>    RETURN NIL
> This will result in:
> "Error BASE/42  Scope Violation (protected): TBROWSE:ACOLSINFO"

As a work around the easiest solution seems to be changing
__objGetValueList() to execute __objSendMsg() inside
begin sequence / recover / end statement.
F.e.:

FUNCTION __objGetValueList( oObject, aExcept )
   LOCAL aDataSymbol
   LOCAL nLen
   LOCAL aData
   LOCAL cSymbol, cData
   LOCAL oErr
   LOCAL n

   IF !ISOBJECT( oObject )
      __errRT_BASE( EG_ARG, 3101, NIL, ProcName( 0 ) )
   ENDIF

   IF !ISARRAY( aExcept )
      aExcept := {}
   ENDIF

   aDataSymbol := __objGetMsgList( oObject )
   nLen        := Len( aDataSymbol )
   aData       := {}

   FOR n := 1 to nLen
      cSymbol := aDataSymbol[ n ]
      IF AScan( aExcept, {| tmp | tmp == cSymbol } ) == 0
         BEGIN SEQUENCE with {|oErr| break(oErr)}
            cData := __objSendMsg( oObject, cSymbol )
         RECOVER USING oErr
            cData := oErr:description
         END
         AAdd( aData, { cSymbol, cData } )
      ENDIF
   NEXT

   RETURN aData


best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep 11 08:08:16 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 08:08:22 2007
Subject: [Harbour] get bug and debugger/classes issue
In-Reply-To: <20070911115946.GA28825@localhost.localdomain>
References: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
	<EDD64DDB-D3F8-4D24-BA90-3387D29BFA7C@syenar.hu>
	<20070911103756.GA28427@localhost.localdomain>
	<F98919E9-3729-4562-830E-61EA4E55EB93@syenar.hu>
	<20070911115946.GA28825@localhost.localdomain>
Message-ID: <8A895BCC-6741-40D8-ABA4-15280CD0C708@syenar.hu>

Why is it good that __objGet*List() returns the
full list (including hidden/protected) of messages?

I'd find it better if these would either only return
public messages and/or __objSendMsg() could have
a way to access the hidden/protected ones (for debugging).

Does these make sense?

Brgds,
Viktor

On 2007.09.11., at 13:59, Przemyslaw Czerpak wrote:

> On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
>> Is it a solution to simply hide every hidden/protected
>> messages when debugging user code, and unhide all of them
>> when the debugger is stepping inside one of the class
>> methods?
>> In all cases I think currently we have to solve the problem
>> where __objGetValueList/__objMethodList() would return even
>> the hidden/protected messages, while __objSendMsg() would
>> RTE when trying to access the hidden/protected ones from this
>> list.
>> This inconsistency is easy to demonstrate using this code:
>> FUNCTION Main()
>>    LOCAL o := TBrowseNew( 0, 0, 20, 20 )
>>    LOCAL a := __objGetValueList( o )
>>    RETURN NIL
>> This will result in:
>> "Error BASE/42  Scope Violation (protected): TBROWSE:ACOLSINFO"
>
> As a work around the easiest solution seems to be changing
> __objGetValueList() to execute __objSendMsg() inside
> begin sequence / recover / end statement.
> F.e.:
>
> FUNCTION __objGetValueList( oObject, aExcept )
>    LOCAL aDataSymbol
>    LOCAL nLen
>    LOCAL aData
>    LOCAL cSymbol, cData
>    LOCAL oErr
>    LOCAL n
>
>    IF !ISOBJECT( oObject )
>       __errRT_BASE( EG_ARG, 3101, NIL, ProcName( 0 ) )
>    ENDIF
>
>    IF !ISARRAY( aExcept )
>       aExcept := {}
>    ENDIF
>
>    aDataSymbol := __objGetMsgList( oObject )
>    nLen        := Len( aDataSymbol )
>    aData       := {}
>
>    FOR n := 1 to nLen
>       cSymbol := aDataSymbol[ n ]
>       IF AScan( aExcept, {| tmp | tmp == cSymbol } ) == 0
>          BEGIN SEQUENCE with {|oErr| break(oErr)}
>             cData := __objSendMsg( oObject, cSymbol )
>          RECOVER USING oErr
>             cData := oErr:description
>          END
>          AAdd( aData, { cSymbol, cData } )
>       ENDIF
>    NEXT
>
>    RETURN aData
>
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Tue Sep 11 08:51:41 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 11 08:51:46 2007
Subject: [Harbour] get bug and debugger/classes issue
In-Reply-To: <8A895BCC-6741-40D8-ABA4-15280CD0C708@syenar.hu>
References: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
	<EDD64DDB-D3F8-4D24-BA90-3387D29BFA7C@syenar.hu>
	<20070911103756.GA28427@localhost.localdomain>
	<F98919E9-3729-4562-830E-61EA4E55EB93@syenar.hu>
	<20070911115946.GA28825@localhost.localdomain>
	<8A895BCC-6741-40D8-ABA4-15280CD0C708@syenar.hu>
Message-ID: <20070911125141.GA29716@localhost.localdomain>

On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
> Why is it good that __objGet*List() returns the
> full list (including hidden/protected) of messages?

These functions were implemented when [x]Harbour had no
support for any scoping and this is result.

> I'd find it better if these would either only return
> public messages and/or __objSendMsg() could have
> a way to access the hidden/protected ones (for debugging).

Information about scope violation may be also important for
debugging. IMHO it's as good Information as any other, f.e.
like message return value which we show now.

> Does these make sense?

If you ask me about __obj*() functions then personally I would removed
most of them. I know that is impossible now and I do not plan to fight
forcing my ideas here so I simply left them as they are. In the past
I fixed only few critical bugs in these functions though some of them
cannot be fixed and _NEVER_ worked correctly in whole [x]Harbour
history, f.e. __objDelData() so I do not care much about them. If some
is using these functions then only for his own risk. If some notice
some problem with some of them then I can update them only if it will
not force core code modifications and if it will be possible.
For me it is obsolete code.

The hack with BEGIN SEQUENCE / END is as good for me as any other one.
With good class description like in Class(y) we can define which object
items should be inspected and things like inspection of SETGET methods
will be controlled by programmer.
Anyhow if you want to reduce the message list only to public ones then
I can add to __CLASSSEL() function support for second parameter with
scope value.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep 11 09:04:30 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 09:04:40 2007
Subject: [Harbour] get bug and debugger/classes issue
In-Reply-To: <20070911125141.GA29716@localhost.localdomain>
References: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
	<EDD64DDB-D3F8-4D24-BA90-3387D29BFA7C@syenar.hu>
	<20070911103756.GA28427@localhost.localdomain>
	<F98919E9-3729-4562-830E-61EA4E55EB93@syenar.hu>
	<20070911115946.GA28825@localhost.localdomain>
	<8A895BCC-6741-40D8-ABA4-15280CD0C708@syenar.hu>
	<20070911125141.GA29716@localhost.localdomain>
Message-ID: <00BA91FD-409C-4207-AC20-FE95F05CD7D2@syenar.hu>

>> Does these make sense?
>
> If you ask me about __obj*() functions then personally I would removed
> most of them. I know that is impossible now and I do not plan to fight
> forcing my ideas here so I simply left them as they are. In the past
> I fixed only few critical bugs in these functions though some of them
> cannot be fixed and _NEVER_ worked correctly in whole [x]Harbour
> history, f.e. __objDelData() so I do not care much about them. If some
> is using these functions then only for his own risk. If some notice
> some problem with some of them then I can update them only if it will
> not force core code modifications and if it will be possible.
> For me it is obsolete code.

Well, I personally couldn't care less about __obj*() methods,
the only problem with them is that Harbour debug code is actively
using them, so we'd need to concentrate to make them at least
consistent (or properly working) inside Harbour itself.

(If there is a different method to solve the debugging than
__obj*() API, it can also be a solution).

> The hack with BEGIN SEQUENCE / END is as good for me as any other one.
> With good class description like in Class(y) we can define which  
> object
> items should be inspected and things like inspection of SETGET methods
> will be controlled by programmer.
> Anyhow if you want to reduce the message list only to public ones then
> I can add to __CLASSSEL() function support for second parameter with
> scope value.

Yes, that would be great. Plus I think we'd need a way to read
hidden/protected vars outside the class, for the sole purpose
of debugging. Can you add such a feature too? (this is needed
only if we want to ever allow the debugger to "see" those
vars too, but I think this is essential if someone wants to
debug a class code having hidden/protected vars. Still left
to solve is when to show hidden/protected vars and when not,
but at least we have the class infrastructure to implement that.

Brgds,
Viktor


From gvarona at ec-red.com  Tue Sep 11 09:10:52 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Tue Sep 11 09:05:00 2007
Subject: [Harbour] =?ISO-8859-1?Q?Edici=F3n_de_campo_Memo_sie?=
	=?ISO-8859-1?Q?mpre_pregunta_=22Abort_Edit=3F_=28Y/N=29=22?=
In-Reply-To: <7CDC1374-B851-4E9B-BA36-58E243CDB9DE@syenar.hu>
References: <46E5B652.2020408@ec-red.com>
	<7CDC1374-B851-4E9B-BA36-58E243CDB9DE@syenar.hu>
Message-ID: <46E693DC.20005@ec-red.com>

Szak?ts Viktor escribi?:

> Thanks Guillermo. It should be okey now, pls check.

Thanks Viktor, Solucionado !!! /  It solved!!!

Best Regards
GVS

> (this was a very old bug)
>
> Brgds,
> Viktor
>
> On 2007.09.10., at 23:25, Guillermo Varona Silup? wrote:
>
>> Hola / Hi :
>> SPANISH
>> En el siguiente ejemplo, cuando edito el campo memo, siempre me  
>> pregunta:  Abort Edit? (Y/N)
>> En Clipper solo pregunta cuando cambie algo y presiono la tecla  escape.
>> ENGLISH
>> In the following example, when I edit the field memo, always asks  
>> me:  Abort Edit?  (And/N)
>> In Clipper alone asks when change something and I pressure the key  
>> escape.
>> procedure main
>> LOCAL cMemo := "C?mo hago para que al presiona la tecla ESC no  salga 
>> el mensaje Abort Edit? (Y/N)"
>> CLS
>> * Campo Memo
>> cMemo := MEMOEDIT(cMemo,13,10,20,76)
>>
>> Best Regards
>> GVS
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>

From harbour.01 at syenar.hu  Tue Sep 11 09:38:41 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 09:38:47 2007
Subject: [Harbour] CHANGELOG: 2007-09-11 15:34 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f479$Blat.v2.6.1$10f5f284$e20972d0ba@127.0.0.1>

2007-09-11 15:34 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * tests/rto_get.prg
   * source/rtl/tget.prg
     ! Fixed display issue when using display->varput->display 
       sequence. (Thanks Lorenzo)
     + Above case added to test suite.

   * source/rtl/tbrowse.prg
     + Some scattered logic moved inside :Configure()
     ! Some TOFIX-es added.
     ! ::ColorSpec() to call Configure().

   * source/debug/dbgtobj.prg
   * source/debug/dbgwa.prg
     + Formatting, var name cleanup.

From harbour.01 at syenar.hu  Tue Sep 11 09:39:06 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 09:39:13 2007
Subject: [Harbour] get bug and debugger/classes issue
In-Reply-To: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
References: <9257026e0709110024g613d4ce0kf7789747a99b1cca@mail.gmail.com>
Message-ID: <84CA794D-9DFD-439F-89C0-CF0ACA7F15B0@syenar.hu>

Hi Lorenzo,

The GET should be fine now.

Brgds,
Viktor

On 2007.09.11., at 9:24, Lorenzo Fiorini wrote:

> The test below shows 3 "pseudo buttons" under C53b <Ok> <Cancel>
> <Quit> while it shows nothing under Harbour dev. It seems mainly a
> display problem.
>
> If you build the test with -b switch it shows a debugger problem: if
> you try to inspect the oGet object you'll get "Error BASE/42 Scope
> violation (protected): GET:BBLOCK"
>
> I've removed PROTECTED from tget.prg to see if the problem was there
> and as expected it worked but I've also seen that object shows both
> BBLOCK and BLOCK like BUFFER and CBUFFER.
>
> best regards,
> Lorenzo
>
>
>    #command @ <row>, <col> GETBUTTON  
> <var>                                 ;
>                            [CODE  
> <code>]                                   ;
>                            [CAPTION  
> <caption>]                             ;
>                            [CLICK  
> <click>]                                 ;
>                            [PICTURE  
> <pic>]                                 ;
>                            [VALID  
> <valid>]                                 ;
>                            [WHEN  
> <when>]                                   ;
>                                                                        
>      ;
>          => SetPos( <row>,  
> <col> )                                         ;
>           ; AAdd 
> (                                                          ;
>                    
> GetList,                                                 ;
>                           _GET_( <var>, <(var)>, <pic>, <{valid}>, < 
> {when}> )  ;
>                 )                                                      
>      ;
>           ; ATAIL(GetList):cargo := { 0, <code>, alltrim( <caption> ),
> <{click}> } ;
>           ; ATAIL(GetList):colordisp( "GR/N" )
>
>
> procedure main()
>
>    local GetList := {}
>    local aBtns := array( 3 )
>
>    cls
>
>    @ 10, 10 GETBUTTON aBtns[ 1 ] CODE 1 CAPTION "Ok"
>    @ 10, 20 GETBUTTON aBtns[ 2 ] CODE 2 CAPTION "Cancel"
>    @ 10, 30 GETBUTTON aBtns[ 3 ] CODE 3 CAPTION "Quit"
>
>    _getdisplay( GetList )
>
>    read
>
> return
>
> function _getdisplay( GetList )
>
>    local nCount
>    local oGet
>
>    altd()
>
>    for nCount := 1 to len( GetList )
>       oGet := GetList[ nCount ]
>       if oGet:cargo[1] == 0
>          oGet:VarPut( "<" + oGet:cargo[3] + ">" )
>       endif
>       oGet:Assign()
>       oGet:display()
>    next
>
> return nil
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Tue Sep 11 10:49:00 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 10:49:10 2007
Subject: [Harbour] ENDWITH question
Message-ID: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>

Hi all,

If there are no objections I'd add END WITH and ENDWITH
to std.ch as valid synonyms to end a WITH OBJECT construct.

To be consistent with the other statements.

Brgds,
Viktor

From druzus at priv.onet.pl  Tue Sep 11 11:36:39 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 11 11:36:46 2007
Subject: [Harbour] ENDWITH question
In-Reply-To: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
References: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
Message-ID: <20070911153639.GA30332@localhost.localdomain>

On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
> Hi all,
> If there are no objections I'd add END WITH and ENDWITH
> to std.ch as valid synonyms to end a WITH OBJECT construct.
> To be consistent with the other statements.

Good idea - please do it.
l think it will be better to add ENDWITH and ENDSWITCH to lexer
and grammar parser - it will allow to trap some typos like wrongly
used END directives. If we make simple translation to END on PP
level only then such code:

   SWITCH xVal
      case 1
      case 2
      case 3
         ? "123"
         exit
      otherwiser
         WITH OBJECT oVal
            :display()
            :close()
         END SWITCH
   END WITH

can be compiled without any error messages.

I know that it's not Clipper compatible but I also suggest
to add to grammar rules support for ENDSEQUENCE and validation
of variable name in
   NEXT <var>
and remove PP rules which translate above statements from std.ch
or better cover them by HB_C52_STRICT macro.
If you agree then I can do that.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep 11 11:42:23 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 11:42:33 2007
Subject: [Harbour] ENDWITH question
In-Reply-To: <20070911153639.GA30332@localhost.localdomain>
References: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
	<20070911153639.GA30332@localhost.localdomain>
Message-ID: <4DF6EC81-0404-48D3-AD0C-25923E5373AE@syenar.hu>

> Good idea - please do it.
> l think it will be better to add ENDWITH and ENDSWITCH to lexer
> and grammar parser - it will allow to trap some typos like wrongly
> used END directives. If we make simple translation to END on PP
> level only then such code:
>
>    SWITCH xVal
>       case 1
>       case 2
>       case 3
>          ? "123"
>          exit
>       otherwiser
>          WITH OBJECT oVal
>             :display()
>             :close()
>          END SWITCH
>    END WITH
>
> can be compiled without any error messages.

That's right. I used to correct plain "END"s now in
the source, but there is indeed no guarantee that
a mistake is not slipping in (or that there isn't
any existing one).

I'd personally make plain "END" obsolete in the
language (well I have some other ideas too to
make source code syntax more consistent), but
this is of course impossible.

> I know that it's not Clipper compatible but I also suggest
> to add to grammar rules support for ENDSEQUENCE and validation
> of variable name in
>    NEXT <var>
> and remove PP rules which translate above statements from std.ch
> or better cover them by HB_C52_STRICT macro.
> If you agree then I can do that.

Yes, absolutely and thanks.

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Sep 11 12:12:09 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 12:12:21 2007
Subject: [Harbour] ENDWITH question
In-Reply-To: <20070911153639.GA30332@localhost.localdomain>
References: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
	<20070911153639.GA30332@localhost.localdomain>
Message-ID: <9729EB96-6435-4F6A-8988-EB3650E598B3@syenar.hu>

Przemek,

Pls add "ENDSWITCH" and "END SWITCH" to the list.

Brgds,
Viktor

On 2007.09.11., at 17:36, Przemyslaw Czerpak wrote:

> On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
>> Hi all,
>> If there are no objections I'd add END WITH and ENDWITH
>> to std.ch as valid synonyms to end a WITH OBJECT construct.
>> To be consistent with the other statements.
>
> Good idea - please do it.
> l think it will be better to add ENDWITH and ENDSWITCH to lexer
> and grammar parser - it will allow to trap some typos like wrongly
> used END directives. If we make simple translation to END on PP
> level only then such code:
>
>    SWITCH xVal
>       case 1
>       case 2
>       case 3
>          ? "123"
>          exit
>       otherwiser
>          WITH OBJECT oVal
>             :display()
>             :close()
>          END SWITCH
>    END WITH
>
> can be compiled without any error messages.
>
> I know that it's not Clipper compatible but I also suggest
> to add to grammar rules support for ENDSEQUENCE and validation
> of variable name in
>    NEXT <var>
> and remove PP rules which translate above statements from std.ch
> or better cover them by HB_C52_STRICT macro.
> If you agree then I can do that.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Tue Sep 11 12:30:12 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 11 12:30:21 2007
Subject: [Harbour] ENDWITH question
In-Reply-To: <9729EB96-6435-4F6A-8988-EB3650E598B3@syenar.hu>
References: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
	<20070911153639.GA30332@localhost.localdomain>
	<9729EB96-6435-4F6A-8988-EB3650E598B3@syenar.hu>
Message-ID: <20070911163012.GA1774@localhost.localdomain>

On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
> Przemek,
> Pls add "ENDSWITCH" and "END SWITCH" to the list.

ENDSWITCH in grammar rules will be enough.
For END SWITCH we can make PP translation:
    #command END SWITCH => ENDSWITCH

We only need one unique label for each statement to redirect
PP rules.
I've just added ENDSEQUENCE, ENDSWITCH and ENDWITH and I can
commit it in few minutes.
But I'd like to ask also about yet another thing. I made the
modifications which replace HB_IT_* as field type in RDD code by
HB_FT_* and added field flag and updated all core RDDs for them.
I also added to ADS RDD support for MODTIME and ROWVERSION fields,
to DBF* RDDs AUTOINC, MOIDTIME and ROWVER fields and to DELIM and
SDF RDDs translation for the new fields. If you want then I can
send patch here for tests. I can also commit this modifications
if other developers agree for such modification. Anyhow I'd like
to know what I should do with it because now I have to work with
two different repository copies - first with the above RDD
modification and second with all others.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep 11 12:37:18 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 12:37:26 2007
Subject: [Harbour] ENDWITH question
In-Reply-To: <20070911163012.GA1774@localhost.localdomain>
References: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
	<20070911153639.GA30332@localhost.localdomain>
	<9729EB96-6435-4F6A-8988-EB3650E598B3@syenar.hu>
	<20070911163012.GA1774@localhost.localdomain>
Message-ID: <CEEE35C0-735D-47F3-A1CF-DD2C39505952@syenar.hu>

> On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
>> Przemek,
>> Pls add "ENDSWITCH" and "END SWITCH" to the list.
>
> ENDSWITCH in grammar rules will be enough.
> For END SWITCH we can make PP translation:
>     #command END SWITCH => ENDSWITCH
>
> We only need one unique label for each statement to redirect
> PP rules.
> I've just added ENDSEQUENCE, ENDSWITCH and ENDWITH and I can
> commit it in few minutes.

Fully agreed.

> But I'd like to ask also about yet another thing. I made the
> modifications which replace HB_IT_* as field type in RDD code by
> HB_FT_* and added field flag and updated all core RDDs for them.
> I also added to ADS RDD support for MODTIME and ROWVERSION fields,
> to DBF* RDDs AUTOINC, MOIDTIME and ROWVER fields and to DELIM and
> SDF RDDs translation for the new fields. If you want then I can
> send patch here for tests. I can also commit this modifications
> if other developers agree for such modification. Anyhow I'd like
> to know what I should do with it because now I have to work with
> two different repository copies - first with the above RDD
> modification and second with all others.

I don't see any problems with committing it, unless it
creates some compatibility concerns. I can do some basic
tests if you send the patch to me (I can also upload it
to my page and post a link, so that others can have a look
too).

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Sep 11 12:37:26 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 12:37:35 2007
Subject: [Harbour] Clipper language syntax cleanup (with compatibility in
	mind)
Message-ID: <186B2510-CF98-4991-80DF-B3FC1889D7BF@syenar.hu>

Hi all,

Some ideas to make source code more consistent (readable,
interchangeable, less error prone):

- inline ifs to be always iif() (not if())
- plain "END" statements not allowed
- END form accepted: ENDDO, ENDSEQUENCE, ENDCASE, etc. (in one word,  
for easier grepping/persing)
- always "DO WHILE" (not WHILE, or vice versa, but ENDDO is better in  
sync with DO WHILE)
- no 4 letter abbreviation for functions or build-in statements
- ".not." not allowed.
- Unequality check with "!=" only (or be it <>, but != is more C-like).
- plain "=" not allowed as assigment.
- plain (non exact) "=" to be replaced by a function as an equality  
operator
- old (dBase) style comments to be obsoleted: "*"
- macro evaluation in strings to be turned off by default.
- since PROCEDUREs doesn't add much to the language, the might
   be simply deleted, or be replaced by FUNCTIONs returning NIL
- multiple ANNOUNCEes should be allowed in a .prg
- CLASS syntax cleanup and standardization (by removing some
   synonyms).
- Quite some "old style" command could be dropped too:
   SELECT, SETs, STORE
- Quite some undocumented C5.2 constructs could also go.
   (this is easy already by not #define-ing HB_C52_UNDOC)
- Things solely there for dBase compatibility, to be dropped:
   SET ECHO, SET MENU, etc.

All this have some consequences:

- "!=" would be equivalent for "!( x == y )" for string to be
   consistent, but this would create quite bad compatibility problems,
   so this one might be out of question.

Some things which can be done right on spot:

- __SetCentury() should get it's own proper _SET_CENTURY SET.
- __Keyboard()/KEYBOARD, __Eject()/EJECT, __Run()/RUN, __Quit()/QUIT,
   __Pack()/PACK, __Zap()/ZAP to get a proper HB_*() function  
equivalents.
- CLS to get a proper function version: HB_CLS().

Since we're breaking compatibility big-time here, the only
viable way to implement these is via -k switches, if at all.
I'm not suggesting any instant actions now in these direction,
or I'm not saying that any of these _must_ be done, just some
ideas, food for thought and base for discussion for future
decisions in order to strengthen the language.

As a rule of thumb we can say that any programs coded according
to the cleaned standard _has to_ compile and work identical
with C5.x. The reverse is not true: There might me such code
which compiles in C5.x, but doesn't in Harbour (when compiled
using the appropriate switches of course).

I personally feel that the Clipper language has a bit too many
ways to describe the same thing, mostly with no benefit, but
some considerable costs along learning and development. Mostly
the reason for these multiple construct is the dBase and C'87
roots of Clipper, many of them unjustified after 25 years.

And pls note that I'm not trying to turn away from the
strictly compatible goal we used to have since the beginning.
The base for any such modernization is a solid compatible
background which we can start from (if we want).

Pls comment on this if you feel.

Brgds,
Viktor

From druzus at priv.onet.pl  Tue Sep 11 13:30:10 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 11 13:30:17 2007
Subject: [Harbour] ENDWITH question
In-Reply-To: <CEEE35C0-735D-47F3-A1CF-DD2C39505952@syenar.hu>
References: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
	<20070911153639.GA30332@localhost.localdomain>
	<9729EB96-6435-4F6A-8988-EB3650E598B3@syenar.hu>
	<20070911163012.GA1774@localhost.localdomain>
	<CEEE35C0-735D-47F3-A1CF-DD2C39505952@syenar.hu>
Message-ID: <20070911173010.GA5207@localhost.localdomain>

On Tue, 11 Sep 2007, Szak?ts Viktor wrote:
> >But I'd like to ask also about yet another thing. I made the
> >modifications which replace HB_IT_* as field type in RDD code by
> >HB_FT_* and added field flag and updated all core RDDs for them.
> >I also added to ADS RDD support for MODTIME and ROWVERSION fields,
> >to DBF* RDDs AUTOINC, MOIDTIME and ROWVER fields and to DELIM and
> >SDF RDDs translation for the new fields. If you want then I can
> >send patch here for tests. I can also commit this modifications
> >if other developers agree for such modification. Anyhow I'd like
> >to know what I should do with it because now I have to work with
> >two different repository copies - first with the above RDD
> >modification and second with all others.
> I don't see any problems with committing it, unless it
> creates some compatibility concerns. I can do some basic
> tests if you send the patch to me (I can also upload it
> to my page and post a link, so that others can have a look
> too).

The patch is in attachment. You can make tests.

If you want to see how new fields works in DBF format then
you can use this code for tests:

    proc main()
    dbcreate("_tst", {{"F1","C",3,0},;
                      {"F2","+",4,0},;
                      {"F3","^",8,0},;
                      {"F4","=",8,0}}
    use _tst
    while lastrec()<10
       dbAppend()
       replace F1 with strzero( ( recno() - 1 ) % 3 + 1, 3 )
    enddo
    dbGotop()
    browse()
    return

This modification will force updating 3-rd party RDD code.
Programmes will have to replace HB_IT_* constants with HB_FT_* ones
and initialize uiFlags (assign 0) if they are allocating DBFIELDINFO
structure without memset(..., 0, ...).

best regards,
Przemek
-------------- next part --------------
A non-text attachment was scrubbed...
Name: svn.diff.gz
Type: application/x-gzip
Size: 14299 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20070911/a2794142/svn.diff-0001.gz
From lorenzo.fiorini at gmail.com  Tue Sep 11 14:09:54 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Sep 11 14:09:59 2007
Subject: [Harbour] another get issue
Message-ID: <9257026e0709111109v5a722bd4u2a9b3240dbf6e8f0@mail.gmail.com>

Test below shows a white "test" with red background in c53b but
nothing in Harbour.

best regards,
Lorenzo

#command @ <row>, <col> LABEL [BOX] <sayexpr> [ NAME <cName> ]          ;
                         [ PICTURE <picture> ] [ <lRight: RIGHT> ]         ;
                         [ COLORS <fg>, <bg> ]                             ;
                         [ SIZE <nWidth>, <nHeight> ]                      ;
       ;
       => @ (<row>), (<col>) GET <cName>                                   ;
          ;atail( GetList ):cargo := { 0, <{sayexpr}> }                    ;
          ;atail( GetList ):Name := <"cName">                              ;
          ;atail( GetList ):colorspec := "N/W+"                            ;
          [;atail( GetList ):colorspec := <"fg">+"/"+<"bg">]               ;
          [;atail( GetList ):picture := <picture>]                         ;
          ;atail( GetList ):preblock := {|| .f. }                          ;
          ;atail( GetList ):VarPut( <sayexpr> )                            ;
          ;atail( GetList ):UpdateBuffer()                                 ;
          ;atail( GetList ):display()

procedure main()

   local cLabel := "test"

   clear

   @ 10, 10 label box cLabel NAME cLabel COLORS "W", "R"

   wait


return
From teo at windtelsoft.com  Tue Sep 11 14:16:41 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Tue Sep 11 14:16:47 2007
Subject: [Harbour] ENDWITH question
In-Reply-To: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
References: <E7D207BB-6594-479D-85B7-EFBA79B8C1D6@syenar.hu>
Message-ID: <200709111316.41770.teo@windtelsoft.com>

On Tuesday 11 September 2007 09:49:00 am Szak?ts Viktor wrote:
> Hi all,
>
> If there are no objections I'd add END WITH and ENDWITH
> to std.ch as valid synonyms to end a WITH OBJECT construct.
>
> To be consistent with the other statements.

Agree, and maybe the same can be do for SWITCH/ENDSWITCH

best regards

Teo


From harbour.01 at syenar.hu  Tue Sep 11 14:42:54 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 14:43:03 2007
Subject: [Harbour] another get issue
In-Reply-To: <9257026e0709111109v5a722bd4u2a9b3240dbf6e8f0@mail.gmail.com>
References: <9257026e0709111109v5a722bd4u2a9b3240dbf6e8f0@mail.gmail.com>
Message-ID: <5B9CDE40-0FA1-4BB9-ADEF-F7A3D20D6F9E@syenar.hu>

Hey Lorenzo,

>           [;atail( GetList ):colorspec := <"fg"> 
> +"/"+<"bg">]               ;

There is a strange thing in this expression, where
the actual color string assigned comes up as:
"W"/"R"

CA-Cl*pper's TGET color parser eats this, but not Harbour's.
You can see this by displaying :colorSpec() after the
assigment, it will show "N/N,N/N".

I'll look into it.

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Tue Sep 11 16:21:17 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Sep 11 16:21:20 2007
Subject: [Harbour] another get issue
In-Reply-To: <5B9CDE40-0FA1-4BB9-ADEF-F7A3D20D6F9E@syenar.hu>
References: <9257026e0709111109v5a722bd4u2a9b3240dbf6e8f0@mail.gmail.com>
	<5B9CDE40-0FA1-4BB9-ADEF-F7A3D20D6F9E@syenar.hu>
Message-ID: <9257026e0709111321k648f8a93t2c9fb351e976eb4b@mail.gmail.com>

On 9/11/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> There is a strange thing in this expression, where
> the actual color string assigned comes up as:
> "W"/"R"
>
> CA-Cl*pper's TGET color parser eats this, but not Harbour's.
> You can see this by displaying :colorSpec() after the
> assigment, it will show "N/N,N/N".
>
> I'll look into it.

Viktor, it's not a big problem. I'm simply giving examples of code
that "worked" since C 5.01 and with xHarbour but not in Harbour.

As information C53b reports W/R,W/R,W/R,W/R while Harbour reports W/R,W/R using

   ? atail( getList ):colorSpec()

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Tue Sep 11 17:29:47 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Sep 11 17:29:50 2007
Subject: [Harbour] HBGETLIST rt error
Message-ID: <9257026e0709111429v1c392412va3155fc3189da82f@mail.gmail.com>

The test below gives:

Error BASE/1066  Argument error: conditional
Called from HBGETLIST:SHOWGETMSG(1432)
Called from HBGETLIST:GUIREADER(775)
Called from GUIREADER(413)
Called from (b)MAIN(13)
Called from READMODAL(143)
Called from MAIN(49)

at start. It works with C53b/xHarbour.

best regards,
Lorenzo

#include "inkey.ch"

procedure main

   local cState, cColor, oTB, uDummy, lReadOnly, lCancel, Getlist, aGroup

   SET EVENTMASK TO INKEY_ALL

   clear

   @ 2, 5 GET lCancel PUSHBUTTON ;
                CAPTION "Ca&ncel" ;
                STATE { || ReadKill( .T. ) }

   cState := "NY"

   @ 5, 20, 10, 30 GET cState LISTBOX { { "Alabama", "AL" }, ;
                                     { "Alaska", "AK" }   , ;
                                     { "Arizona", "AZ" }, ;
                                     { "New York", "NY" } } ;
                CAPTION "&State" ;
                MESSAGE "Select the client's state"

   lReadOnly := .F.

   @ 5, 40 GET lReadOnly CHECKBOX ;
                CAPTION "&Read Only" ;
                MESSAGE "Check to open file for reading only" ;
                STYLE "[X ]"

   cColor := "R"          //default to red.
        aGroup := ARRAY( 3 )
        aGroup[ 1 ] := RadioButto( 16, 22, "&Red", "R" )
        aGroup[ 2 ] := RadioButto( 17, 22, "&Green", "G" )
        aGroup[ 3 ] := RadioButto( 18, 22, "&Blue", "B" )
        @ 15, 20, 24, 40 GET cColor RADIOGROUP aGroup

   use test

   oTB := TBrowseDB( 7, 50, 20, 70 )
        oTB:AddColumn(tbColumnNew("Last Name",{||test->first}))
        oTB:AddColumn(tbColumnNew("First Name",{||test->last}))
        oTB:AddColumn(tbColumnNew("Street",{||test->street}))
        uDummy := NIL
        oTB:HeadSep := "-"
        oTB:ColSep := "|"
        @ 7, 50, 20, 70 GET uDummy TBROWSE oTB

   READ

   return
From harbour.01 at syenar.hu  Tue Sep 11 17:36:03 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 17:36:09 2007
Subject: [Harbour] CHANGELOG: 2007-09-11 23:34 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f4bb$Blat.v2.6.1$c0fa9da0$14705115e3cc@127.0.0.1>

2007-09-11 23:34 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/hbgtcore.c
     ! Fixed handling of some strangely formatted colorstrings
       mainly inside TGet(). The low-level functionality 
       modified is the colorstring to number conversion. The 
       only change is to continue (and not exit) on a non-std 
       char.

   * utils/hbtest/rt_misc.prg
     + Added some color string parsing tests. Some of them fail.

   * source/rtl/achoice.prg
   * source/debug/debugger.prg
   * utils/hbtest/hbtest.prg
   * utils/hbtest/rt_array.prg
     * Formatting.

From harbour.01 at syenar.hu  Tue Sep 11 17:36:48 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 17:36:58 2007
Subject: [Harbour] another get issue
In-Reply-To: <9257026e0709111109v5a722bd4u2a9b3240dbf6e8f0@mail.gmail.com>
References: <9257026e0709111109v5a722bd4u2a9b3240dbf6e8f0@mail.gmail.com>
Message-ID: <1025DA16-4105-4017-BB87-8205E27D2A1E@syenar.hu>

This should now be fixed. But note that Harbour can
be confused with some other non-standard colorstrings.

Brgds,
Viktor

On 2007.09.11., at 20:09, Lorenzo Fiorini wrote:

> Test below shows a white "test" with red background in c53b but
> nothing in Harbour.
>
> best regards,
> Lorenzo
>
> #command @ <row>, <col> LABEL [BOX] <sayexpr> [ NAME  
> <cName> ]          ;
>                          [ PICTURE <picture> ] [ <lRight:  
> RIGHT> ]         ;
>                          [ COLORS <fg>,  
> <bg> ]                             ;
>                          [ SIZE <nWidth>,  
> <nHeight> ]                      ;
>        ;
>        => @ (<row>), (<col>) GET  
> <cName>                                   ;
>           ;atail( GetList ):cargo := { 0, <{sayexpr} 
> > }                    ;
>           ;atail( GetList ):Name :=  
> <"cName">                              ;
>           ;atail( GetList ):colorspec := "N/W 
> +"                            ;
>           [;atail( GetList ):colorspec := <"fg"> 
> +"/"+<"bg">]               ;
>           [;atail( GetList ):picture :=  
> <picture>]                         ;
>           ;atail( GetList ):preblock :=  
> {|| .f. }                          ;
>           ;atail( GetList ):VarPut 
> ( <sayexpr> )                            ;
>           ;atail( GetList ):UpdateBuffer 
> ()                                 ;
>           ;atail( GetList ):display()
>
> procedure main()
>
>    local cLabel := "test"
>
>    clear
>
>    @ 10, 10 label box cLabel NAME cLabel COLORS "W", "R"
>
>    wait
>
>
> return
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Tue Sep 11 17:45:22 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 11 17:45:39 2007
Subject: [Harbour] HBGETLIST rt error
In-Reply-To: <9257026e0709111429v1c392412va3155fc3189da82f@mail.gmail.com>
References: <9257026e0709111429v1c392412va3155fc3189da82f@mail.gmail.com>
Message-ID: <411A4CFC-C0E3-4E02-8797-683619873236@syenar.hu>

Hi,

Please try it after a checkout, this is working for me (at least
to the point where test.dbf is missing).

Brgds,
Viktor

On 2007.09.11., at 23:29, Lorenzo Fiorini wrote:

> The test below gives:
>
> Error BASE/1066  Argument error: conditional
> Called from HBGETLIST:SHOWGETMSG(1432)
> Called from HBGETLIST:GUIREADER(775)
> Called from GUIREADER(413)
> Called from (b)MAIN(13)
> Called from READMODAL(143)
> Called from MAIN(49)
>
> at start. It works with C53b/xHarbour.
>
> best regards,
> Lorenzo
>
> #include "inkey.ch"
>
> procedure main
>
>    local cState, cColor, oTB, uDummy, lReadOnly, lCancel, Getlist,  
> aGroup
>
>    SET EVENTMASK TO INKEY_ALL
>
>    clear
>
>    @ 2, 5 GET lCancel PUSHBUTTON ;
>                 CAPTION "Ca&ncel" ;
>                 STATE { || ReadKill( .T. ) }
>
>    cState := "NY"
>
>    @ 5, 20, 10, 30 GET cState LISTBOX { { "Alabama", "AL" }, ;
>                                      { "Alaska", "AK" }   , ;
>                                      { "Arizona", "AZ" }, ;
>                                      { "New York", "NY" } } ;
>                 CAPTION "&State" ;
>                 MESSAGE "Select the client's state"
>
>    lReadOnly := .F.
>
>    @ 5, 40 GET lReadOnly CHECKBOX ;
>                 CAPTION "&Read Only" ;
>                 MESSAGE "Check to open file for reading only" ;
>                 STYLE "[X ]"
>
>    cColor := "R"          //default to red.
>         aGroup := ARRAY( 3 )
>         aGroup[ 1 ] := RadioButto( 16, 22, "&Red", "R" )
>         aGroup[ 2 ] := RadioButto( 17, 22, "&Green", "G" )
>         aGroup[ 3 ] := RadioButto( 18, 22, "&Blue", "B" )
>         @ 15, 20, 24, 40 GET cColor RADIOGROUP aGroup
>
>    use test
>
>    oTB := TBrowseDB( 7, 50, 20, 70 )
>         oTB:AddColumn(tbColumnNew("Last Name",{||test->first}))
>         oTB:AddColumn(tbColumnNew("First Name",{||test->last}))
>         oTB:AddColumn(tbColumnNew("Street",{||test->street}))
>         uDummy := NIL
>         oTB:HeadSep := "-"
>         oTB:ColSep := "|"
>         @ 7, 50, 20, 70 GET uDummy TBROWSE oTB
>
>    READ
>
>    return
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Tue Sep 11 20:10:28 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 11 20:10:34 2007
Subject: [Harbour] ChangeLog 2007-09-12 02:10 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070912001028.GA21610@localhost.localdomain>

2007-09-12 02:10 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/std.ch
    * cover ENDSEQUENCE translation with HB_C52_STRICT macro
    + added translations for END SWITCH, END WITH, END OBJECT

  * harbour/source/compiler/complex.c
  * harbour/source/compiler/harbour.y
  * harbour/source/compiler/harbour.yyc
  * harbour/source/compiler/harbour.yyh
    + added support for ENDSEQ[UENCE], ENDSW[ITCH] and ENDW[ITH]

  * harbour/source/rtl/hbgtcore.c
    ! changed string to color number translation to be fully Clipper
      compatible. Now I do not know any examples which we translate
      differently - if someone will find any them then please inform me.
      The only one intentional difference between Harbour and Clipper
      is in color number to string translation and background highlighting
      attribute "*", Clipper put it just before "/" as part of foreground
      color (f.e.: 248 => "N*+/W") but Harbour as part background color
      (f.e.: 248 => "N+/W*") - Clipper compatible behavior is enabled when
      Harbour is compiled with HB_C52_STRICT macro

  * harbour/utils/hbtest/rt_misc.prg
    * control the position of background highlighting attribute (*) in
      expected results depending on HB_C52_STRICT. Harbour passes correctly
      all included color translation tests.

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Wed Sep 12 01:59:38 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 01:59:41 2007
Subject: [Harbour] HBGETLIST rt error
In-Reply-To: <411A4CFC-C0E3-4E02-8797-683619873236@syenar.hu>
References: <9257026e0709111429v1c392412va3155fc3189da82f@mail.gmail.com>
	<411A4CFC-C0E3-4E02-8797-683619873236@syenar.hu>
Message-ID: <9257026e0709112259k70283a4cyd9f6ecf516f14b46@mail.gmail.com>

On 9/11/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> Please try it after a checkout, this is working for me (at least
> to the point where test.dbf is missing).

You can take away use test.dbf and tbrowse however test.dbf is in /tests dir.

The problem seems to be in aMsg[ MSGFLAG ] which is NIL while it is
checked as logical using IF !Empty( aMsg ) .AND. aMsg[ MSGFLAG ] in
::ShowMsg and ::EraseGetMsg

best regards,
Lorenzo
From harbour.01 at syenar.hu  Wed Sep 12 02:01:51 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 02:02:01 2007
Subject: [Harbour] HBGETLIST rt error
In-Reply-To: <9257026e0709112259k70283a4cyd9f6ecf516f14b46@mail.gmail.com>
References: <9257026e0709111429v1c392412va3155fc3189da82f@mail.gmail.com>
	<411A4CFC-C0E3-4E02-8797-683619873236@syenar.hu>
	<9257026e0709112259k70283a4cyd9f6ecf516f14b46@mail.gmail.com>
Message-ID: <C5940E58-A93C-4DEA-B51F-33345964722F@syenar.hu>

Okey, I'm looking into it.

Brgds,
Viktor

On 2007.09.12., at 7:59, Lorenzo Fiorini wrote:

> On 9/11/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
>
>> Please try it after a checkout, this is working for me (at least
>> to the point where test.dbf is missing).
>
> You can take away use test.dbf and tbrowse however test.dbf is in / 
> tests dir.
>
> The problem seems to be in aMsg[ MSGFLAG ] which is NIL while it is
> checked as logical using IF !Empty( aMsg ) .AND. aMsg[ MSGFLAG ] in
> ::ShowMsg and ::EraseGetMsg
>
> best regards,
> Lorenzo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Wed Sep 12 02:31:17 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 02:31:23 2007
Subject: [Harbour] CHANGELOG: 2007-09-12 08:29 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f506$Blat.v2.6.1$8662fb92$b94ee8775a0@127.0.0.1>

2007-09-12 08:29 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/getsys.prg
     ! Fix for crash in TGetList():ShowGetMsg() reported by Lorenzo.

   * contrib/libct/blank.prg
   * source/rtl/menuto.prg
   * source/rtl/valtoexp.prg
   * source/rtl/readkey.prg
   * source/rtl/browse.prg
   * source/debug/debugger.prg
     + Replaced END with ENDSWITCH and ENDWITH

From harbour.01 at syenar.hu  Wed Sep 12 02:32:07 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 02:32:16 2007
Subject: [Harbour] HBGETLIST rt error
In-Reply-To: <9257026e0709112259k70283a4cyd9f6ecf516f14b46@mail.gmail.com>
References: <9257026e0709111429v1c392412va3155fc3189da82f@mail.gmail.com>
	<411A4CFC-C0E3-4E02-8797-683619873236@syenar.hu>
	<9257026e0709112259k70283a4cyd9f6ecf516f14b46@mail.gmail.com>
Message-ID: <4ACE9D42-300A-4939-8D0A-5998006B678E@syenar.hu>

This should be fixed now.

Brgds,
Viktor

On 2007.09.12., at 7:59, Lorenzo Fiorini wrote:

> On 9/11/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
>
>> Please try it after a checkout, this is working for me (at least
>> to the point where test.dbf is missing).
>
> You can take away use test.dbf and tbrowse however test.dbf is in / 
> tests dir.
>
> The problem seems to be in aMsg[ MSGFLAG ] which is NIL while it is
> checked as logical using IF !Empty( aMsg ) .AND. aMsg[ MSGFLAG ] in
> ::ShowMsg and ::EraseGetMsg
>
> best regards,
> Lorenzo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Wed Sep 12 03:42:26 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 03:42:30 2007
Subject: [Harbour] Harbour text UI vs HTML forms
Message-ID: <9257026e0709120042k688b179arc5ce309b9061c884@mail.gmail.com>

IMHO today html forms are the "minimum" level of UI that every user
expects from a software but using standard Harbour get system we
cannot match this basic level.

Many here don't care since they use win/gtk libs or have their own lib
which do everything but a new developer that today download Harbour
can't do what is possible to do with an html page in 2 minutes.

Since Viktor has worked hard to fix the text UI I think this could be
a good moment to do a small step ahead and add some small things that
will make the text UI usable out of the box.

I've attached guitest.prg which is what we can do today with standard
Harbour and guitest.html with all the standard controls that can be
used in html ( menus are not included since they are not comparable).

We have sth more like tbrowse but we miss:

1 password input: I think everyone here has code for it so it's only
matter of pick up one

2 textarea: HBEditor has almost everything necessary and we can follow
get ... tbrowse example

3 drop down: here we can extend listbox or create a new class

Any comment?

best regards,
Lorenzo
-------------- next part --------------
#include "inkey.ch"

procedure main

   local cState, cColor, oTB, uDummy, lReadOnly, lCancel, Getlist, aGroup

   SET EVENTMASK TO INKEY_ALL

   clear 

   @ 2, 5 GET lCancel PUSHBUTTON ;
                CAPTION "Ca&ncel" ;
                STATE { || ReadKill( .T. ) }

   use test

   oTB := TBrowseDB( 2, 30, 12, 70 )
        oTB:AddColumn(tbColumnNew("Last Name",{||test->first}))
        oTB:AddColumn(tbColumnNew("First Name",{||test->last}))
        oTB:AddColumn(tbColumnNew("Street",{||test->street}))
        uDummy := NIL
        oTB:HeadSep := "-"
        oTB:ColSep := "|"
        @ 2, 30, 12, 70 GET uDummy TBROWSE oTB

   cState := "NY"

   @ 4, 5, 10, 15 GET cState LISTBOX { { "Alabama", "AL" }, ;
                                     { "Alaska", "AK" }   , ;
                                     { "Arizona", "AZ" }, ;
                                     { "New York", "NY" } } ;
                CAPTION "&State" ;
                MESSAGE "Select the client's state"

   lReadOnly := .F.

   @ 12, 5 GET lReadOnly CHECKBOX ;
                CAPTION "&Read Only" ;
                MESSAGE "Check to open file for reading only" ;
                STYLE "[X ]"


   cColor := "R"          //default to red.
        aGroup := ARRAY( 3 )
        aGroup[ 1 ] := RadioButto( 16, 07, "&Red", "R" )
        aGroup[ 2 ] := RadioButto( 17, 07, "&Green", "G" )
        aGroup[ 3 ] := RadioButto( 18, 07, "&Blue", "B" )
        @ 15, 5, 24, 25 GET cColor RADIOGROUP aGroup

   READ

   return
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20070912/5ef43bcb/guitest.html
From harbour.01 at syenar.hu  Wed Sep 12 04:04:41 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 04:04:50 2007
Subject: [Harbour] Harbour text UI vs HTML forms
In-Reply-To: <9257026e0709120042k688b179arc5ce309b9061c884@mail.gmail.com>
References: <9257026e0709120042k688b179arc5ce309b9061c884@mail.gmail.com>
Message-ID: <29C01C5B-D416-4185-9EA0-ADE673033759@syenar.hu>


On 2007.09.12., at 9:42, Lorenzo Fiorini wrote:

> IMHO today html forms are the "minimum" level of UI that every user
> expects from a software but using standard Harbour get system we
> cannot match this basic level.
>
> Many here don't care since they use win/gtk libs or have their own lib
> which do everything but a new developer that today download Harbour
> can't do what is possible to do with an html page in 2 minutes.
>
> Since Viktor has worked hard to fix the text UI I think this could be
> a good moment to do a small step ahead and add some small things that
> will make the text UI usable out of the box.
>
> I've attached guitest.prg which is what we can do today with standard
> Harbour and guitest.html with all the standard controls that can be
> used in html ( menus are not included since they are not comparable).
>
> We have sth more like tbrowse but we miss:
>
> 1 password input: I think everyone here has code for it so it's only
> matter of pick up one

Well, definitely. This probably needs some extensions for
TGet() to be done without any above-level hacks. The extension
being a new var called: :hideInput and maybe a new :style
var to control the mask char. Anything we'd need here?

> 2 textarea: HBEditor has almost everything necessary and we can follow
> get ... tbrowse example

Yes, definitely. We need an UI control class compatible
interface to HBEditor(), named HBTextBox() or similar.

> 3 drop down: here we can extend listbox or create a new class

I vote for a new class here (HBDropDown()) (current LISTBOX
code can be used as a starting point to not reinvent the
whole class, but I'd not vote for subclassing either).

I'd welcome any contributions on the above and I promise to
help integrating them into current Harbour, I'll see what
I can do with the TGet() password support.

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Wed Sep 12 04:44:36 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 04:44:38 2007
Subject: [Harbour] Harbour text UI vs HTML forms
In-Reply-To: <29C01C5B-D416-4185-9EA0-ADE673033759@syenar.hu>
References: <9257026e0709120042k688b179arc5ce309b9061c884@mail.gmail.com>
	<29C01C5B-D416-4185-9EA0-ADE673033759@syenar.hu>
Message-ID: <9257026e0709120144j7985933bj88d5eff415c40f1b@mail.gmail.com>

On 9/12/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> Well, definitely. This probably needs some extensions for
> TGet() to be done without any above-level hacks. The extension
> being a new var called: :hideInput and maybe a new :style
> var to control the mask char. Anything we'd need here?

You're now the "UI master" :) I'm sure you'll do the best.

> Yes, definitely. We need an UI control class compatible
> interface to HBEditor(), named HBTextBox() or similar.

Often a TEXTBOX is what we call a GET. I think HBTextArea would be better.

> I vote for a new class here (HBDropDown()) (current LISTBOX
> code can be used as a starting point to not reinvent the
> whole class, but I'd not vote for subclassing either).

I agree.

> I'd welcome any contributions on the above and I promise to
> help integrating them into current Harbour, I'll see what
> I can do with the TGet() password support.

I see if I can find some "good" code from my lib :)

best regards,
Lorenzo
From mbelgrano at deltain.it  Wed Sep 12 05:29:45 2007
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Sep 12 05:30:19 2007
Subject: [Harbour] What about a "Replaceable User Interface"?
In-Reply-To: <20070803192434.GB20898@localhost.localdomain>
References: <9257026e0708030621l45504efbye2e139afbec6823d@mail.gmail.com><AFB948164110ED43B5EB849E8DEEF03809A836@SRV02.deltain.net><9257026e0708030849g64b57ab4if7b88d5a85d74846@mail.gmail.com><AFB948164110ED43B5EB849E8DEEF03809A838@SRV02.deltain.net><9257026e0708031000y437dc889rb088548635c631b9@mail.gmail.com><001301c7d5f7$e068a020$a139e060$@com>
	<20070803192434.GB20898@localhost.localdomain>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03809A8DE@SRV02.deltain.net>

Wich is the situation of this dream?
Will multi windows based on ctwin syntax?


>A library which I can use with CUI, GUI and WWW Browsers without source
code modification.
>Porting application to GUI only mode is a waste of time.
>We will need interface which will allow to run application remotely in
CUI mode and when user turn off his terminal in scale register ;-)
>without closing application on the server and reconnect from office
using desktop computer he should continue his job in GUI mode in the
>same instance of application and finally if he will want then we will
have to allow him to finish the job using PDA and WWW browser when >he
will return to home.
>I plan to work on such library in the future.

>We have to stop thinking in desktop and in web development as different
entities. We need a common interface for all our developments.
>That would be the most important target for Harbour 2.0 :-)


From harbour.01 at syenar.hu  Wed Sep 12 06:44:30 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 06:44:40 2007
Subject: [Harbour] SetColor( "" ) problem
Message-ID: <3688F0B4-6554-4BEC-B3D6-1AA345F17F34@syenar.hu>

Hi,

There is a small incompatibility in the results of this program:

FUNC Main()

? SetColor()
SetColor( "R/G,R/G,R/G,R/G,R/G" )
? SetColor()
SetColor( "" )
? SetColor() // This result is wrong in Harbour: W/N,N/W,N/N,N/N,W/N  
while it should be W/N,N/W,N/N,N/N,N/W

RETURN NIL

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Sep 12 06:55:19 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 06:55:23 2007
Subject: [Harbour] CHANGELOG: 2007-09-12 12:54 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f52b$Blat.v2.6.1$68975cdc$1528103ac5c4@127.0.0.1>

2007-09-12 12:54 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/teditor.prg
   * source/rtl/tbrowse.prg
     ! Fixed to assign SetColor() in New() rather than in INIT.
       (INIT value gets evaluated and stored on first class usage, 
       not on every instantiantion.)

   * source/rtl/tget.prg
   * tests/rto_get.prg
     + Added Harbour extensions:
       :hideInput (logical value)
       :style (1 char long string to control mask character when :hideInput is .T.)
       QUESTION: Is there any need to support multiple hiding styles?
                 (like always fully masked or masked with random chars?)
     ! Fixed several bugs in SET DELIMITERS handling.
       (color, focus behaviour, "caching", positioning)
     + Added test cases for SET DELIMITERS issues.

From harbour.01 at syenar.hu  Wed Sep 12 06:56:23 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 06:56:28 2007
Subject: [Harbour] CHANGELOG: 2007-09-12 12:54 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f52b$Blat.v2.6.1$8f1c5aec$146815134144@127.0.0.1>

2007-09-12 12:54 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/teditor.prg
   * source/rtl/tbrowse.prg
     ! Fixed to assign SetColor() in New() rather than in INIT.
       (INIT value gets evaluated and stored on first class usage, 
       not on every instantiantion.)

   * source/rtl/tget.prg
   * tests/rto_get.prg
     + Added Harbour extensions:
       :hideInput (logical value)
       :style (1 char long string to control mask character when :hideInput is .T.)
       QUESTION: Is there any need to support multiple hiding styles?
                 (like always fully masked or masked with random chars?)
     ! Fixed several bugs in SET DELIMITERS handling.
       (color, focus behaviour, "caching", positioning)
     + Added test cases for SET DELIMITERS issues.

From makis1970 at gmail.com  Wed Sep 12 07:01:57 2007
From: makis1970 at gmail.com (Mike Evans (Gmail))
Date: Wed Sep 12 07:07:25 2007
Subject: [Harbour] CHANGELOG: 2007-09-12 12:54 UTC+0100 Viktor
	Szakats	(harbour.01 syenar.hu)
In-Reply-To: <01c7f52b$Blat.v2.6.1$8f1c5aec$146815134144@127.0.0.1>
References: <01c7f52b$Blat.v2.6.1$8f1c5aec$146815134144@127.0.0.1>
Message-ID: <002e01c7f52c$5873d1e0$095b75a0$@com>

Szakats,
Very nice addition but it will be even better if we support another feature.
When a user press a key before we replace the character with * (or any
character) it will be nice if we see the pressed key for a second and after
that (or when the user press the next key) to replace the real char with the
*.

Regards
Mike Evans

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Szakats Viktor
Sent: Wednesday, September 12, 2007 1:56 PM
To: harbour@harbour-project.org
Subject: [Harbour] CHANGELOG: 2007-09-12 12:54 UTC+0100 Viktor Szakats
(harbour.01 syenar.hu)

2007-09-12 12:54 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/teditor.prg
   * source/rtl/tbrowse.prg
     ! Fixed to assign SetColor() in New() rather than in INIT.
       (INIT value gets evaluated and stored on first class usage, 
       not on every instantiantion.)

   * source/rtl/tget.prg
   * tests/rto_get.prg
     + Added Harbour extensions:
       :hideInput (logical value)
       :style (1 char long string to control mask character when :hideInput
is .T.)
       QUESTION: Is there any need to support multiple hiding styles?
                 (like always fully masked or masked with random chars?)
     ! Fixed several bugs in SET DELIMITERS handling.
       (color, focus behaviour, "caching", positioning)
     + Added test cases for SET DELIMITERS issues.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Wed Sep 12 07:14:42 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 07:14:47 2007
Subject: [Harbour] CHANGELOG: 2007-09-12 12:54 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <01c7f52b$Blat.v2.6.1$68975cdc$1528103ac5c4@127.0.0.1>
References: <01c7f52b$Blat.v2.6.1$68975cdc$1528103ac5c4@127.0.0.1>
Message-ID: <9257026e0709120414w7d22781k5990976ce7af64b@mail.gmail.com>

On 9/12/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

>    * source/rtl/tget.prg
>    * tests/rto_get.prg
>      + Added Harbour extensions:
>        :hideInput (logical value)
>        :style (1 char long string to control mask character when :hideInput is .T.)
>        QUESTION: Is there any need to support multiple hiding styles?
>                  (like always fully masked or masked with random chars?)

IMHO "*" are quite standard and more than enough.

best regards,
Lorenzo
From harbour.01 at syenar.hu  Wed Sep 12 07:25:31 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 07:25:42 2007
Subject: [Harbour] CHANGELOG: 2007-09-12 12:54 UTC+0100 Viktor
	Szakats	(harbour.01 syenar.hu)
In-Reply-To: <002e01c7f52c$5873d1e0$095b75a0$@com>
References: <01c7f52b$Blat.v2.6.1$8f1c5aec$146815134144@127.0.0.1>
	<002e01c7f52c$5873d1e0$095b75a0$@com>
Message-ID: <AD24E1D2-AF69-463B-895D-D28340CA17A6@syenar.hu>

Hi Mike,

I think that should be implemented by a custom
reader on the user-level by showing the last char
for a moment after calling the :display method.
This can only get tricky if the GET has some more
complicated PICTUREs (like @S or @R), but that's
usually not the case with passwords:

...
IF Len( RTrim( oGet:buffer ) ) > 0
    DispBegin()
    oGet:display()
    DispOutAt( oGet:row, oGet:col + Len( RTrim( oGet:buffer ) ) - 1,;
       SubStr( oGet:buffer, oGet:pos, 1 ),;
       hb_ColorIndex( oGet:colorSpec, 1 ) )
    DispEnd()
    Inkey( 0 ) // ; Can be extended to accept any keys pressed while  
waiting
ENDIF
oGet:display()
...

Brgds,
Viktor

On 2007.09.12., at 13:01, Mike Evans ((Gmail)) wrote:

> Szakats,
> Very nice addition but it will be even better if we support another  
> feature.
> When a user press a key before we replace the character with * (or any
> character) it will be nice if we see the pressed key for a second  
> and after
> that (or when the user press the next key) to replace the real char  
> with the
> *.
>
> Regards
> Mike Evans
>
> -----Original Message-----
> From: harbour-bounces@harbour-project.org
> [mailto:harbour-bounces@harbour-project.org] On Behalf Of Szakats  
> Viktor
> Sent: Wednesday, September 12, 2007 1:56 PM
> To: harbour@harbour-project.org
> Subject: [Harbour] CHANGELOG: 2007-09-12 12:54 UTC+0100 Viktor Szakats
> (harbour.01 syenar.hu)
>
> 2007-09-12 12:54 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>    * source/rtl/teditor.prg
>    * source/rtl/tbrowse.prg
>      ! Fixed to assign SetColor() in New() rather than in INIT.
>        (INIT value gets evaluated and stored on first class usage,
>        not on every instantiantion.)
>
>    * source/rtl/tget.prg
>    * tests/rto_get.prg
>      + Added Harbour extensions:
>        :hideInput (logical value)
>        :style (1 char long string to control mask character  
> when :hideInput
> is .T.)
>        QUESTION: Is there any need to support multiple hiding styles?
>                  (like always fully masked or masked with random  
> chars?)
>      ! Fixed several bugs in SET DELIMITERS handling.
>        (color, focus behaviour, "caching", positioning)
>      + Added test cases for SET DELIMITERS issues.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>

From druzus at priv.onet.pl  Wed Sep 12 07:56:18 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 12 07:56:24 2007
Subject: [Harbour] SetColor( "" ) problem
In-Reply-To: <3688F0B4-6554-4BEC-B3D6-1AA345F17F34@syenar.hu>
References: <3688F0B4-6554-4BEC-B3D6-1AA345F17F34@syenar.hu>
Message-ID: <20070912115618.GA12339@localhost.localdomain>

On Wed, 12 Sep 2007, Szak?ts Viktor wrote:
> Hi,
> There is a small incompatibility in the results of this program:
> FUNC Main()
> ? SetColor()
> SetColor( "R/G,R/G,R/G,R/G,R/G" )
> ? SetColor()
> SetColor( "" )
> ? SetColor() // This result is wrong in Harbour: W/N,N/W,N/N,N/N,W/N  
> while it should be W/N,N/W,N/N,N/N,N/W
> RETURN NIL

2007-09-12 13:55 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rtl/hbgtcore.c
    * changed default UNSELECTED collor from W/N to N/W

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Sep 12 08:00:07 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 08:00:19 2007
Subject: [Harbour] SetColor( "" ) problem
In-Reply-To: <20070912115618.GA12339@localhost.localdomain>
References: <3688F0B4-6554-4BEC-B3D6-1AA345F17F34@syenar.hu>
	<20070912115618.GA12339@localhost.localdomain>
Message-ID: <4FB32981-CD64-4E54-A8C1-35D9E1B2BB5E@syenar.hu>

Thanks a lot.

Brgds,
Viktor

On 2007.09.12., at 13:56, Przemyslaw Czerpak wrote:

> On Wed, 12 Sep 2007, Szak?ts Viktor wrote:
>> Hi,
>> There is a small incompatibility in the results of this program:
>> FUNC Main()
>> ? SetColor()
>> SetColor( "R/G,R/G,R/G,R/G,R/G" )
>> ? SetColor()
>> SetColor( "" )
>> ? SetColor() // This result is wrong in Harbour: W/N,N/W,N/N,N/N,W/N
>> while it should be W/N,N/W,N/N,N/N,N/W
>> RETURN NIL
>
> 2007-09-12 13:55 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/source/rtl/hbgtcore.c
>     * changed default UNSELECTED collor from W/N to N/W
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From i at kevincarmody.com  Wed Sep 12 09:27:23 2007
From: i at kevincarmody.com (Kevin Carmody)
Date: Wed Sep 12 10:21:09 2007
Subject: [Harbour] Clipper language syntax cleanup (with compatibility
	in	mind)
In-Reply-To: <186B2510-CF98-4991-80DF-B3FC1889D7BF@syenar.hu>
References: <186B2510-CF98-4991-80DF-B3FC1889D7BF@syenar.hu>
Message-ID: <46E7E93B.9010605@kevincarmody.com>

Szak?ts Viktor wrote:
> Hi all,
>
> Some ideas to make source code more consistent (readable,
> interchangeable, less error prone):
>
> - inline ifs to be always iif() (not if())
> - plain "END" statements not allowed
> - END form accepted: ENDDO, ENDSEQUENCE, ENDCASE, etc. (in one word, 
> for easier grepping/persing)
> - always "DO WHILE" (not WHILE, or vice versa, but ENDDO is better in 
> sync with DO WHILE)
> - no 4 letter abbreviation for functions or build-in statements
> - ".not." not allowed.
> - Unequality check with "!=" only (or be it <>, but != is more C-like).
> - plain "=" not allowed as assigment.
> - plain (non exact) "=" to be replaced by a function as an equality 
> operator
> - old (dBase) style comments to be obsoleted: "*"
> - macro evaluation in strings to be turned off by default.
> - since PROCEDUREs doesn't add much to the language, the might
>   be simply deleted, or be replaced by FUNCTIONs returning NIL
> - multiple ANNOUNCEes should be allowed in a .prg
> - CLASS syntax cleanup and standardization (by removing some
>   synonyms).
> - Quite some "old style" command could be dropped too:
>   SELECT, SETs, STORE
> - Quite some undocumented C5.2 constructs could also go.
>   (this is easy already by not #define-ing HB_C52_UNDOC)
> - Things solely there for dBase compatibility, to be dropped:
>   SET ECHO, SET MENU, etc.

Some of these sound good, but others sound like individualistic style 
preferences.  For instance, I think avoiding 4-letter abbreviations is a 
step in the right direction, but requiring IIF() instead of IF() does 
not.  I find IF() clearer and avoid IIF() because it's harder to read 
and type.

Here's how I would categorize your suggestions:

Definitely good ideas:

- END form accepted: ENDDO, ENDSEQUENCE, ENDCASE, etc. (in one word, for 
easier grepping/persing)
- no 4 letter abbreviation for functions or build-in statements
- Unequality check with "!=" only (or be it <>, but != is more C-like).
- plain "=" not allowed as assigment.
- plain (non exact) "=" to be replaced by a function as an equality 
operator
      -- I very much like the idea of something that is independent of 
SET EXACT.  I think an operator would be better than a function.  See 
below under "!=".
- old (dBase) style comments to be obsoleted: "*"
     -- Don't forget "&&".  Perhaps we can also eliminate [] and `' as 
string delimiters.  Note the last pair, which is undocumented and little 
known, in which the lead character is backwards apostrophe, also called 
the grave character, not a regular apostrophe.
- multiple ANNOUNCEes should be allowed in a .prg
- CLASS syntax cleanup and standardization (by removing some
  synonyms).
- Quite some "old style" command could be dropped too:
  STORE
- Quite some undocumented C5.2 constructs could also go.
  (this is easy already by not #define-ing HB_C52_UNDOC)
- Things solely there for dBase compatibility, to be dropped:
  SET ECHO, SET MENU, etc.

Possibly good ideas:

- ".not." not allowed.
- macro evaluation in strings to be turned off by default.
    -- I think this should be subject to a SET rather than a compiler 
switch.
- since PROCEDUREs doesn't add much to the language, the might
  be simply deleted, or be replaced by FUNCTIONs returning NIL
- Quite some "old style" command could be dropped too:
  SELECT, SETs

Questionable:

- inline ifs to be always iif() (not if())
    -- I find IF() clearer than IIF()!
- plain "END" statements not allowed
    -- I know ENDIF is clearer than END, but END is easier to type, and 
I don't miss ENDIF.
- always "DO WHILE" (not WHILE, or vice versa, but ENDDO is better in 
sync with DO WHILE)
    -- I prefer to type WHILE and do not miss DO WHILE at all.

>
> All this have some consequences:
>
> - "!=" would be equivalent for "!( x == y )" for string to be
>   consistent, but this would create quite bad compatibility problems,
>   so this one might be out of question.

How about adding "!==" as an alternative to "!( x == y )"?  Similarly, I 
think that "=" as a operator (assuming SET EXACT is off) should be 
replaced with an operator independent of SET EXACT, such as ~ or =|, and 
then what is now != could become !~ or !=|.

>
> Some things which can be done right on spot:
>
> - __SetCentury() should get it's own proper _SET_CENTURY SET.
> - __Keyboard()/KEYBOARD, __Eject()/EJECT, __Run()/RUN, __Quit()/QUIT,
>   __Pack()/PACK, __Zap()/ZAP to get a proper HB_*() function equivalents.
> - CLS to get a proper function version: HB_CLS().

This sounds good to me too.

> Since we're breaking compatibility big-time here, the only
> viable way to implement these is via -k switches, if at all.
> I'm not suggesting any instant actions now in these direction,
> or I'm not saying that any of these _must_ be done, just some
> ideas, food for thought and base for discussion for future
> decisions in order to strengthen the language.
>
> As a rule of thumb we can say that any programs coded according
> to the cleaned standard _has to_ compile and work identical
> with C5.x. The reverse is not true: There might me such code
> which compiles in C5.x, but doesn't in Harbour (when compiled
> using the appropriate switches of course).
>
> I personally feel that the Clipper language has a bit too many
> ways to describe the same thing, mostly with no benefit, but
> some considerable costs along learning and development. Mostly
> the reason for these multiple construct is the dBase and C'87
> roots of Clipper, many of them unjustified after 25 years.

In general, different ways of doing things had led different developers 
to develop different styles.  A variety of methods can be regarded as a 
strength rather than a weakness, since it welcomes so many types of 
style, such as a Visual Basic type of style in addition to a C type of 
style.

At the same time, some elements are clearly outmoded and little used, 
and will probably not be greatly missed.

> And pls note that I'm not trying to turn away from the
> strictly compatible goal we used to have since the beginning.
> The base for any such modernization is a solid compatible
> background which we can start from (if we want).
>
> Pls comment on this if you feel.

Kevin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20070912/50648e81/attachment-0001.html
From harbour.01 at syenar.hu  Wed Sep 12 10:12:30 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 10:31:48 2007
Subject: [Harbour] LIBCT migration from CONTRIB to CORE
Message-ID: <BAB61488-D460-4D10-9C2B-5EF8F233D9D5@syenar.hu>

Hi all,

I was thinking how to integrate LIBCT into Harbour
properly.

LIBCT is pretty popular, an almost must-have, many
ppl used/uses it (disclaimer: me personally not).
Notice that xhb already merged it into the core. This
move would indeed be nice so that the lib could be
built and used as part of Harbour. Notice also that
this is not a must-have, and this is just a proposal,
not something which _must_ be done.

For this to be possible, we need to deal with a few
Harbour-conformance issues:
1) code quality
2) multiplatform issues (meaning: Windows-only or
    other platform dependent implementations)
3) namespace issues

As for 1) and 2) LIBCT seems to be at a stage where
most parts are portable and more or less (rather more)
conformant. Opinions are welcome though.

As for 3) this is a big issue as those who are not
using CT3, can easily run into a public function
name already occupied by CT and colliding with user
code.

So I'd like to propose to transpose the whole CT
function set to the CT_*() namespace and add a
header file to translate back those CT_*() names
into their original equivalent. The only thing
to be done for CT users is to include this header
(can be automatically controlled by a HB_COMPAT_CT
flag to make it even easier).

There will be a few more header filename issues to
sort out, but they can be solved along the same line.

A new rule should at the same time be layed for
Harbour core development, namely that no CT functions
are used from other parts of the core, so that
core functionality doesn't depend on CT functions.
(this can be easily solved by moving the required CT
functionality into a low-level Harbour function
and do it the other way round - a good candidate
for this would be the windowing GT.).

Any other concerns, opinions?

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Wed Sep 12 09:59:36 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 10:33:04 2007
Subject: [Harbour] Harbour text UI vs HTML forms
In-Reply-To: <29C01C5B-D416-4185-9EA0-ADE673033759@syenar.hu>
References: <9257026e0709120042k688b179arc5ce309b9061c884@mail.gmail.com>
	<29C01C5B-D416-4185-9EA0-ADE673033759@syenar.hu>
Message-ID: <9257026e0709120659ka759646t9a794291577ac164@mail.gmail.com>

On 9/12/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> Yes, definitely. We need an UI control class compatible
> interface to HBEditor(), named HBTextBox() or similar.

As you can guess I've already integrated memoedit in my custom get
system. I talk about memoedit since I did it in C5x days but the
result has always been an horror that I want to remove asap :)

I've already started to work on teditor.prg ( please note that I use a
modified xHarbour's version ) and I'd like your opinion about some
issues I've already found:

1 TAB/ESC key management: TAB and SH_TAB are the standard way to
navigate between controls so TAB and ESC management should be
"excluded" when teditor is called by getsys.

2 Set/Get var and Save/Abort: these actions should be controlled
externally using buttons so there should be methods for them.

3 here is a possible hittest code

METHOD HitTest( mrow,mcol ) CLASS HBEditor
   LOCAL nRet := HTCLIENT

   if ( mRow < ::nTop  .or. mRow > ::nBottom ) .or. ;
      ( mCol < ::nLeft .or. mCol > ::nRight )
      return HTNOWHERE
   endif

Return nRet

4 could it be sth like:
oEdt := HBTextArea( t, l, b, r )
@ t, l, b, r GET lDummy HBEDITOR oEdt

Just for test I've replaced HBEDITOR with TBROWSE and added:

   METHOD Configure() INLINE nil
   METHOD Stabilize() INLINE .t.
   METHOD ApplyKey( nKey ) INLINE iif( nKey == K_TAB .or. nKey ==
K_SH_TAB, 1, ( ::Edit( nKey ), 0 ) )

   DATA AutoLite

to HBEditor to "fool" HBGETLIST and it "start" to work :)

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Wed Sep 12 10:18:59 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 10:43:05 2007
Subject: [Harbour] tget rt error
Message-ID: <9257026e0709120718g4a05036n97bd35b2c65ee020@mail.gmail.com>

Using mouse with guitest.prg does not work anymore and when I goes
over checkbox I get:

Error BASE/1081  Argument error: +
Called from GET:HITTEST(1452)
Called from HBGETLIST:HITTEST(1372)
Called from HBGETLIST:GUIAPPLYKEY(961)
Called from HBGETLIST:GUIREADER(791)
Called from GUIREADER(413)
Called from (b)MAIN(15)
Called from READMODAL(143)
Called from MAIN(65)

Can it be related to _SET_DELIMITERS?

best regards,
Lorenzo
From harbour.01 at syenar.hu  Wed Sep 12 11:18:17 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 11:18:27 2007
Subject: [Harbour] Harbour text UI vs HTML forms
In-Reply-To: <9257026e0709120659ka759646t9a794291577ac164@mail.gmail.com>
References: <9257026e0709120042k688b179arc5ce309b9061c884@mail.gmail.com>
	<29C01C5B-D416-4185-9EA0-ADE673033759@syenar.hu>
	<9257026e0709120659ka759646t9a794291577ac164@mail.gmail.com>
Message-ID: <3B62B50B-AEA2-493C-A2E6-A3F68C873347@syenar.hu>

> As you can guess I've already integrated memoedit in my custom get
> system. I talk about memoedit since I did it in C5x days but the
> result has always been an horror that I want to remove asap :)

:) Yeah, I have my own too.

> I've already started to work on teditor.prg ( please note that I use a
> modified xHarbour's version ) and I'd like your opinion about some
> issues I've already found:

Is there anything we could implement here from xhb?

> 1 TAB/ESC key management: TAB and SH_TAB are the standard way to
> navigate between controls so TAB and ESC management should be
> "excluded" when teditor is called by getsys.
>
> 2 Set/Get var and Save/Abort: these actions should be controlled
> externally using buttons so there should be methods for them.
>
> 3 here is a possible hittest code
>
> METHOD HitTest( mrow,mcol ) CLASS HBEditor
>    LOCAL nRet := HTCLIENT
>
>    if ( mRow < ::nTop  .or. mRow > ::nBottom ) .or. ;
>       ( mCol < ::nLeft .or. mCol > ::nRight )
>       return HTNOWHERE
>    endif
>
> Return nRet
>
> 4 could it be sth like:
> oEdt := HBTextArea( t, l, b, r )
> @ t, l, b, r GET lDummy HBEDITOR oEdt
>
> Just for test I've replaced HBEDITOR with TBROWSE and added:
>
>    METHOD Configure() INLINE nil
>    METHOD Stabilize() INLINE .t.
>    METHOD ApplyKey( nKey ) INLINE iif( nKey == K_TAB .or. nKey ==
> K_SH_TAB, 1, ( ::Edit( nKey ), 0 ) )
>
>    DATA AutoLite
>
> to HBEditor to "fool" HBGETLIST and it "start" to work :)

Well I think we can add some new methods to HBEditor(),
but there is no need for anything serious really to move
forward. Basically we need a :reader function (to handle
the above keys) added as a method to TGetList(), to rename
:refreshWindow() into :display(), :Saved() to :Changed,
:HitTest() added as you suggest, and we're pretty much done.
I'm not even sure we need a separate class or reader method
either.

I'll commit some steps towards the goal.

Brgds,
Viktor



From harbour.01 at syenar.hu  Wed Sep 12 12:06:54 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 12:07:26 2007
Subject: [Harbour] tget rt error
In-Reply-To: <9257026e0709120718g4a05036n97bd35b2c65ee020@mail.gmail.com>
References: <9257026e0709120718g4a05036n97bd35b2c65ee020@mail.gmail.com>
Message-ID: <9A0FE86C-0B5A-4D3D-87DD-5C7E0EEF54FC@syenar.hu>


On 2007.09.12., at 16:18, Lorenzo Fiorini wrote:

> Using mouse with guitest.prg does not work anymore and when I goes
> over checkbox I get:
>
> Error BASE/1081  Argument error: +
> Called from GET:HITTEST(1452)
> Called from HBGETLIST:HITTEST(1372)
> Called from HBGETLIST:GUIAPPLYKEY(961)
> Called from HBGETLIST:GUIREADER(791)
> Called from GUIREADER(413)
> Called from (b)MAIN(15)
> Called from READMODAL(143)
> Called from MAIN(65)
>
> Can it be related to _SET_DELIMITERS?

I don't think so. But I'll review the code.

Actually I could make C5.3 crash in a similar
way by using a hittest() right after GET creation.

Brgds,
Viktor

From druzus at priv.onet.pl  Wed Sep 12 12:17:34 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 12 12:17:41 2007
Subject: [Harbour] LIBCT migration from CONTRIB to CORE
In-Reply-To: <BAB61488-D460-4D10-9C2B-5EF8F233D9D5@syenar.hu>
References: <BAB61488-D460-4D10-9C2B-5EF8F233D9D5@syenar.hu>
Message-ID: <20070912161734.GA17401@localhost.localdomain>

On Wed, 12 Sep 2007, Szak?ts Viktor wrote:
> Hi all,
> I was thinking how to integrate LIBCT into Harbour
> properly.
> LIBCT is pretty popular, an almost must-have, many
> ppl used/uses it (disclaimer: me personally not).
> Notice that xhb already merged it into the core. This
> move would indeed be nice so that the lib could be
> built and used as part of Harbour. Notice also that
> this is not a must-have, and this is just a proposal,
> not something which _must_ be done.

CT library is build by default by GNU make system but
so far I haven't added CT3 to harbour shared library
(harbour.{dll,so,dyn,...}) in default build but it can
be done by moving "ct" string from mk_hbgetlibsctb() to
mk_hbgetlibs() in bin/hb-func.sh so it's not a problem.
Sometimes I'm creating such builds for my own use when
I need hbdot or hbrun with all CT functions.

> For this to be possible, we need to deal with a few
> Harbour-conformance issues:
> 1) code quality
> 2) multiplatform issues (meaning: Windows-only or
>    other platform dependent implementations)
> 3) namespace issues
> As for 1) and 2) LIBCT seems to be at a stage where
> most parts are portable and more or less (rather more)
> conformant. Opinions are welcome though.

I cleaned existing CT code and adopted all xHarbour fixes
and added many other ones so now Harbour CT3 is better then
xHarbour ones but it should be verified bu users/testers.
I haven't ported from xHarbour only functions in file
diskutil.prg because they needed some additional cleanup.

> As for 3) this is a big issue as those who are not
> using CT3, can easily run into a public function
> name already occupied by CT and colliding with user
> code.
> 
> So I'd like to propose to transpose the whole CT
> function set to the CT_*() namespace and add a
> header file to translate back those CT_*() names
> into their original equivalent. The only thing
> to be done for CT users is to include this header
> (can be automatically controlled by a HB_COMPAT_CT
> flag to make it even easier).

Please remeber that PP trnaslations do not work in macro
compiler so it will not resolve the problem. hbcompat.ch
is workaround which helps in many places but it's not
solution which resolves whole problem.
Also in programs like hbdot CT_ prefix will not be added
automatically what will cause other confusions for users.
It's possible that such modification may cause more problems
in longer terms and because people will begin to use functions
with CT_ prefix it will not be possible to revert it.

> There will be a few more header filename issues to
> sort out, but they can be solved along the same line.
> A new rule should at the same time be layed for
> Harbour core development, namely that no CT functions
> are used from other parts of the core, so that
> core functionality doesn't depend on CT functions.
> (this can be easily solved by moving the required CT
> functionality into a low-level Harbour function
> and do it the other way round - a good candidate
> for this would be the windowing GT.).

CTWIN in Harbour is quite nicely integrated with core code
IMHO much better then in xHarbour and unlike in xHarbour we
have full CTWIN implementation when in xHarbour some important
functionality still not exists and many features work only partially
with some unpleasure visual side side effects - people reported
such problems on xharbour.news. Additionally original CTWIN makes
many small modifications in GT code like different cursor positioning
interactions with scrolling, etc.
Harbour by default is CA-Cl*pper compatible but in the moment
when you use first CTWIN function GTCTW is activated and overloads
GT methods switching to CT3 compatibility mode. xHarbour after
integration CTWIN code with standard GT API is neither CA-Cl*pper
nor CTWIN compatible. It's a mix of separated fixes created by
different developers when they noticed that something did not work
like in their Clipper applications. Unfortunately some of developers
used CTWIN and some others didn't. Non integrated with core code
CTWIN implementation caused that I had to invest a little bit more
time in some cases (f.e. we have two low level ALERT() implementation
because the one in CTWIN is different then the standard CA-Cl*pper)
but the final result is much better. In test/ctwtest.prg we have
test code for CTWIN. Compile it by Harbour and xHarbour and compare
results. Switch between windows using 0-9 keys, move them using arrows,
change cursor shape (INS/DEL) enable/disable borders (B) and move windows
in both mode, etc. You will find that xHarbour CTWIN implementation
is in practice unusable if code uses CTWIN extensively and not only
some very basic features.
It's good example that sometimes strict integration does not have
to resolve problems but can be source of some new ones.
I'd like to have CT3 as part of default build but I'm not sure if
adding prefix to all CT3 functions is good idea. IMHO for most of
users it will be enough to add support for CTLIB into common.mak
CTLIB as separate library does not have to be linked with user code
so the problem with namespace is minor. But if we make CTLIB lib
part harbour shared library (f.e. harbour.dll) then we have situation
like all or nothing so maybe including CTLIB should be optional.

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Sep 12 12:36:35 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 12:36:45 2007
Subject: [Harbour] LIBCT migration from CONTRIB to CORE
In-Reply-To: <20070912161734.GA17401@localhost.localdomain>
References: <BAB61488-D460-4D10-9C2B-5EF8F233D9D5@syenar.hu>
	<20070912161734.GA17401@localhost.localdomain>
Message-ID: <37C278D1-DA80-4671-B565-B59FD36CA8EC@syenar.hu>

Yes, your the last changes in CT made me reconsider
the integration, and the layered GT is a very powerful
tool too, I'm very happy that we have it done right.
Especially now that I have migrated my own windowing
code to it (so that it now became multiplatform) :)

So, let's roll along the idea that we don't prefix
anything.

We need to have a _separate_ .lib (that's no problem)
and a separate _.dll_ then, with a name like hbct[.dll]
or similar. Is this possible? Plus we need to make sure
that LIBCT is not included by default by build helper
scripts (bld.bat and bash friends) to avoid any unexpected
namespace problems.

Remains hbextern.ch which I wouldn't add anything
new, instead we can simply move over the existing
ctextern.ch file to the central include/ dir.

So basically what will change is the location of
LIBCT and the fact that non-GNU VC/BC build scripts
will include building LIBCT, plus an automatically
distributed, but separate .lib and .dll.

Am I missing something, any more namespace or other
issues?

I can do the raw part of the integration, along with
the GNU and non-GNU make files.

Brgds,
Viktor

On 2007.09.12., at 18:17, Przemyslaw Czerpak wrote:

> On Wed, 12 Sep 2007, Szak?ts Viktor wrote:
>> Hi all,
>> I was thinking how to integrate LIBCT into Harbour
>> properly.
>> LIBCT is pretty popular, an almost must-have, many
>> ppl used/uses it (disclaimer: me personally not).
>> Notice that xhb already merged it into the core. This
>> move would indeed be nice so that the lib could be
>> built and used as part of Harbour. Notice also that
>> this is not a must-have, and this is just a proposal,
>> not something which _must_ be done.
>
> CT library is build by default by GNU make system but
> so far I haven't added CT3 to harbour shared library
> (harbour.{dll,so,dyn,...}) in default build but it can
> be done by moving "ct" string from mk_hbgetlibsctb() to
> mk_hbgetlibs() in bin/hb-func.sh so it's not a problem.
> Sometimes I'm creating such builds for my own use when
> I need hbdot or hbrun with all CT functions.
>
>> For this to be possible, we need to deal with a few
>> Harbour-conformance issues:
>> 1) code quality
>> 2) multiplatform issues (meaning: Windows-only or
>>    other platform dependent implementations)
>> 3) namespace issues
>> As for 1) and 2) LIBCT seems to be at a stage where
>> most parts are portable and more or less (rather more)
>> conformant. Opinions are welcome though.
>
> I cleaned existing CT code and adopted all xHarbour fixes
> and added many other ones so now Harbour CT3 is better then
> xHarbour ones but it should be verified bu users/testers.
> I haven't ported from xHarbour only functions in file
> diskutil.prg because they needed some additional cleanup.
>
>> As for 3) this is a big issue as those who are not
>> using CT3, can easily run into a public function
>> name already occupied by CT and colliding with user
>> code.
>>
>> So I'd like to propose to transpose the whole CT
>> function set to the CT_*() namespace and add a
>> header file to translate back those CT_*() names
>> into their original equivalent. The only thing
>> to be done for CT users is to include this header
>> (can be automatically controlled by a HB_COMPAT_CT
>> flag to make it even easier).
>
> Please remeber that PP trnaslations do not work in macro
> compiler so it will not resolve the problem. hbcompat.ch
> is workaround which helps in many places but it's not
> solution which resolves whole problem.
> Also in programs like hbdot CT_ prefix will not be added
> automatically what will cause other confusions for users.
> It's possible that such modification may cause more problems
> in longer terms and because people will begin to use functions
> with CT_ prefix it will not be possible to revert it.
>
>> There will be a few more header filename issues to
>> sort out, but they can be solved along the same line.
>> A new rule should at the same time be layed for
>> Harbour core development, namely that no CT functions
>> are used from other parts of the core, so that
>> core functionality doesn't depend on CT functions.
>> (this can be easily solved by moving the required CT
>> functionality into a low-level Harbour function
>> and do it the other way round - a good candidate
>> for this would be the windowing GT.).
>
> CTWIN in Harbour is quite nicely integrated with core code
> IMHO much better then in xHarbour and unlike in xHarbour we
> have full CTWIN implementation when in xHarbour some important
> functionality still not exists and many features work only partially
> with some unpleasure visual side side effects - people reported
> such problems on xharbour.news. Additionally original CTWIN makes
> many small modifications in GT code like different cursor positioning
> interactions with scrolling, etc.
> Harbour by default is CA-Cl*pper compatible but in the moment
> when you use first CTWIN function GTCTW is activated and overloads
> GT methods switching to CT3 compatibility mode. xHarbour after
> integration CTWIN code with standard GT API is neither CA-Cl*pper
> nor CTWIN compatible. It's a mix of separated fixes created by
> different developers when they noticed that something did not work
> like in their Clipper applications. Unfortunately some of developers
> used CTWIN and some others didn't. Non integrated with core code
> CTWIN implementation caused that I had to invest a little bit more
> time in some cases (f.e. we have two low level ALERT() implementation
> because the one in CTWIN is different then the standard CA-Cl*pper)
> but the final result is much better. In test/ctwtest.prg we have
> test code for CTWIN. Compile it by Harbour and xHarbour and compare
> results. Switch between windows using 0-9 keys, move them using  
> arrows,
> change cursor shape (INS/DEL) enable/disable borders (B) and move  
> windows
> in both mode, etc. You will find that xHarbour CTWIN implementation
> is in practice unusable if code uses CTWIN extensively and not only
> some very basic features.
> It's good example that sometimes strict integration does not have
> to resolve problems but can be source of some new ones.
> I'd like to have CT3 as part of default build but I'm not sure if
> adding prefix to all CT3 functions is good idea. IMHO for most of
> users it will be enough to add support for CTLIB into common.mak
> CTLIB as separate library does not have to be linked with user code
> so the problem with namespace is minor. But if we make CTLIB lib
> part harbour shared library (f.e. harbour.dll) then we have situation
> like all or nothing so maybe including CTLIB should be optional.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Wed Sep 12 12:41:35 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 12:41:43 2007
Subject: [Harbour] Harbour text UI vs HTML forms
In-Reply-To: <3B62B50B-AEA2-493C-A2E6-A3F68C873347@syenar.hu>
References: <9257026e0709120042k688b179arc5ce309b9061c884@mail.gmail.com>
	<29C01C5B-D416-4185-9EA0-ADE673033759@syenar.hu>
	<9257026e0709120659ka759646t9a794291577ac164@mail.gmail.com>
	<3B62B50B-AEA2-493C-A2E6-A3F68C873347@syenar.hu>
Message-ID: <9257026e0709120941k1e557bd0o76c3f2ec46607a80@mail.gmail.com>

On 9/12/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> Is there anything we could implement here from xhb?

I use xHarbour's since it has text selection and copy/cut/paste. I
have a CRM app that exchange a lot of data to/from emails and it is
absolutely necessary to select all text using Ctrl+A or part using
SH_UP/DOWN and do Ctrl+C, Ctrl+X to paste into email clients or paste
from them using Ctrl+V.
Fir this I've introduced HB_EXT_INKEY in xHarbour time ago to
distinguish between K_CTRL_x and K_movements keys.

I also use xHarbour's tbrowse due to "datacache". I've DBFs with
millions records and often filters with 1/10000 ratio. "Not cached"
tbrowse reread data block even moving left/right and this means that
user have to wait seconds only to see the next column.

> Well I think we can add some new methods to HBEditor(),
> but there is no need for anything serious really to move
> forward. Basically we need a :reader function (to handle
> the above keys) added as a method to TGetList(), to rename
> :refreshWindow() into :display(), :Saved() to :Changed,
> :HitTest() added as you suggest, and we're pretty much done.
> I'm not even sure we need a separate class or reader method
> either.
>
> I'll commit some steps towards the goal.

Many thanks.

best regards,
Lorenzo
From makis1970 at gmail.com  Wed Sep 12 12:55:43 2007
From: makis1970 at gmail.com (Mike Evans (Gmail))
Date: Wed Sep 12 13:01:03 2007
Subject: [Harbour] LIBCT migration from CONTRIB to CORE
In-Reply-To: <20070912161734.GA17401@localhost.localdomain>
References: <BAB61488-D460-4D10-9C2B-5EF8F233D9D5@syenar.hu>
	<20070912161734.GA17401@localhost.localdomain>
Message-ID: <001401c7f55d$c3a51c90$4aef55b0$@com>

Przemek,

I fully agree.

Regards
Mike Evans

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Przemyslaw Czerpak
Sent: Wednesday, September 12, 2007 7:18 PM
To: Harbour Project Main Developer List.
Subject: Re: [Harbour] LIBCT migration from CONTRIB to CORE

On Wed, 12 Sep 2007, Szak?ts Viktor wrote:
> Hi all,
> I was thinking how to integrate LIBCT into Harbour
> properly.
> LIBCT is pretty popular, an almost must-have, many
> ppl used/uses it (disclaimer: me personally not).
> Notice that xhb already merged it into the core. This
> move would indeed be nice so that the lib could be
> built and used as part of Harbour. Notice also that
> this is not a must-have, and this is just a proposal,
> not something which _must_ be done.

CT library is build by default by GNU make system but
so far I haven't added CT3 to harbour shared library
(harbour.{dll,so,dyn,...}) in default build but it can
be done by moving "ct" string from mk_hbgetlibsctb() to
mk_hbgetlibs() in bin/hb-func.sh so it's not a problem.
Sometimes I'm creating such builds for my own use when
I need hbdot or hbrun with all CT functions.

> For this to be possible, we need to deal with a few
> Harbour-conformance issues:
> 1) code quality
> 2) multiplatform issues (meaning: Windows-only or
>    other platform dependent implementations)
> 3) namespace issues
> As for 1) and 2) LIBCT seems to be at a stage where
> most parts are portable and more or less (rather more)
> conformant. Opinions are welcome though.

I cleaned existing CT code and adopted all xHarbour fixes
and added many other ones so now Harbour CT3 is better then
xHarbour ones but it should be verified bu users/testers.
I haven't ported from xHarbour only functions in file
diskutil.prg because they needed some additional cleanup.

> As for 3) this is a big issue as those who are not
> using CT3, can easily run into a public function
> name already occupied by CT and colliding with user
> code.
> 
> So I'd like to propose to transpose the whole CT
> function set to the CT_*() namespace and add a
> header file to translate back those CT_*() names
> into their original equivalent. The only thing
> to be done for CT users is to include this header
> (can be automatically controlled by a HB_COMPAT_CT
> flag to make it even easier).

Please remeber that PP trnaslations do not work in macro
compiler so it will not resolve the problem. hbcompat.ch
is workaround which helps in many places but it's not
solution which resolves whole problem.
Also in programs like hbdot CT_ prefix will not be added
automatically what will cause other confusions for users.
It's possible that such modification may cause more problems
in longer terms and because people will begin to use functions
with CT_ prefix it will not be possible to revert it.

> There will be a few more header filename issues to
> sort out, but they can be solved along the same line.
> A new rule should at the same time be layed for
> Harbour core development, namely that no CT functions
> are used from other parts of the core, so that
> core functionality doesn't depend on CT functions.
> (this can be easily solved by moving the required CT
> functionality into a low-level Harbour function
> and do it the other way round - a good candidate
> for this would be the windowing GT.).

CTWIN in Harbour is quite nicely integrated with core code
IMHO much better then in xHarbour and unlike in xHarbour we
have full CTWIN implementation when in xHarbour some important
functionality still not exists and many features work only partially
with some unpleasure visual side side effects - people reported
such problems on xharbour.news. Additionally original CTWIN makes
many small modifications in GT code like different cursor positioning
interactions with scrolling, etc.
Harbour by default is CA-Cl*pper compatible but in the moment
when you use first CTWIN function GTCTW is activated and overloads
GT methods switching to CT3 compatibility mode. xHarbour after
integration CTWIN code with standard GT API is neither CA-Cl*pper
nor CTWIN compatible. It's a mix of separated fixes created by
different developers when they noticed that something did not work
like in their Clipper applications. Unfortunately some of developers
used CTWIN and some others didn't. Non integrated with core code
CTWIN implementation caused that I had to invest a little bit more
time in some cases (f.e. we have two low level ALERT() implementation
because the one in CTWIN is different then the standard CA-Cl*pper)
but the final result is much better. In test/ctwtest.prg we have
test code for CTWIN. Compile it by Harbour and xHarbour and compare
results. Switch between windows using 0-9 keys, move them using arrows,
change cursor shape (INS/DEL) enable/disable borders (B) and move windows
in both mode, etc. You will find that xHarbour CTWIN implementation
is in practice unusable if code uses CTWIN extensively and not only
some very basic features.
It's good example that sometimes strict integration does not have
to resolve problems but can be source of some new ones.
I'd like to have CT3 as part of default build but I'm not sure if
adding prefix to all CT3 functions is good idea. IMHO for most of
users it will be enough to add support for CTLIB into common.mak
CTLIB as separate library does not have to be linked with user code
so the problem with namespace is minor. But if we make CTLIB lib
part harbour shared library (f.e. harbour.dll) then we have situation
like all or nothing so maybe including CTLIB should be optional.

best regards,
Przemek
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Wed Sep 12 13:01:44 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 13:01:50 2007
Subject: [Harbour] LIBCT migration from CONTRIB to CORE
In-Reply-To: <BAB61488-D460-4D10-9C2B-5EF8F233D9D5@syenar.hu>
References: <BAB61488-D460-4D10-9C2B-5EF8F233D9D5@syenar.hu>
Message-ID: <9257026e0709121001l3f114f1dtc5385b2475962a10@mail.gmail.com>

On 9/12/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> LIBCT is pretty popular, an almost must-have, many
> ppl used/uses it (disclaimer: me personally not).
> Notice that xhb already merged it into the core. This
> move would indeed be nice so that the lib could be
> built and used as part of Harbour. Notice also that
> this is not a must-have, and this is just a proposal,
> not something which _must_ be done.

I did the merge in xHarbour after I got exactly at the same conclusions.
Today I wouldn't do it again. It is really easy to add libct to .so
and .dll changing hbfunc.sh.

> As for 1) and 2) LIBCT seems to be at a stage where
> most parts are portable and more or less (rather more)
> conformant. Opinions are welcome though.

I use only Net functions to map printers so I can't say much about the rest.

> So I'd like to propose to transpose the whole CT
> function set to the CT_*() namespace and add a
> header file to translate back those CT_*() names
> into their original equivalent.

As you said LIBCT is pretty popular and I can add well documented ( if
you have CA doc ). Changing names could make the port to Harbour
harder.

best regards,
Lorenzo
From harbour.01 at syenar.hu  Wed Sep 12 13:11:19 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 13:11:29 2007
Subject: [Harbour] LIBCT migration from CONTRIB to CORE
In-Reply-To: <9257026e0709121001l3f114f1dtc5385b2475962a10@mail.gmail.com>
References: <BAB61488-D460-4D10-9C2B-5EF8F233D9D5@syenar.hu>
	<9257026e0709121001l3f114f1dtc5385b2475962a10@mail.gmail.com>
Message-ID: <20FEB9E3-D372-463A-9A81-A48A698B4DF7@syenar.hu>

> I did the merge in xHarbour after I got exactly at the same  
> conclusions.
> Today I wouldn't do it again. It is really easy to add libct to .so
> and .dll changing hbfunc.sh.

Any reasons why you regret your decision?

Otherwise you're right, overall it's just a small
annoyance to build it separately using the non-GNU
make files, and for the ADS_RDD we need to it anyways..
(also easy to automatize)

>> As for 1) and 2) LIBCT seems to be at a stage where
>> most parts are portable and more or less (rather more)
>> conformant. Opinions are welcome though.
>
> I use only Net functions to map printers so I can't say much about  
> the rest.
>
>> So I'd like to propose to transpose the whole CT
>> function set to the CT_*() namespace and add a
>> header file to translate back those CT_*() names
>> into their original equivalent.
>
> As you said LIBCT is pretty popular and I can add well documented ( if
> you have CA doc ). Changing names could make the port to Harbour
> harder.

Many thanks for you feedback.

Brgds,
Viktor



From harbour.01 at syenar.hu  Wed Sep 12 13:35:54 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 13:36:02 2007
Subject: [Harbour] CHANGELOG: 2007-09-12 19:27 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f563$Blat.v2.6.1$5f16d40c$f3814e74580@127.0.0.1>

2007-09-12 19:27 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/tget.prg
     ! :HitTest() crash fix.
     ! :HitTest() made more compatible.
     + Added proper wrappers for undocumented C5.3 vars.
     + Added support for Caption.
     + Added support for C5.3 color handling (it's quite ugly, 
       but it's on by default).
     ; Some snippets from xhb but heavily fixed.

   * source/rtl/scrollbr.prg
   * source/rtl/tpopup.prg
   * source/rtl/radiogrp.prg
   * source/rtl/listbox.prg
   * source/rtl/checkbox.prg
   * source/rtl/tget.prg
   * source/rtl/ttopbar.prg
   * source/rtl/pushbtn.prg
   * source/rtl/radiobtn.prg
     % __GUIColor() -> hb_ColorSelect()

From harbour.01 at syenar.hu  Wed Sep 12 13:36:07 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 13:36:15 2007
Subject: [Harbour] tget rt error
In-Reply-To: <9257026e0709120718g4a05036n97bd35b2c65ee020@mail.gmail.com>
References: <9257026e0709120718g4a05036n97bd35b2c65ee020@mail.gmail.com>
Message-ID: <9BFB5A8A-1BF4-475F-8EC1-A9D53D869FF8@syenar.hu>

Pls check now.

Brgds,
Viktor

On 2007.09.12., at 16:18, Lorenzo Fiorini wrote:

> Using mouse with guitest.prg does not work anymore and when I goes
> over checkbox I get:
>
> Error BASE/1081  Argument error: +
> Called from GET:HITTEST(1452)
> Called from HBGETLIST:HITTEST(1372)
> Called from HBGETLIST:GUIAPPLYKEY(961)
> Called from HBGETLIST:GUIREADER(791)
> Called from GUIREADER(413)
> Called from (b)MAIN(15)
> Called from READMODAL(143)
> Called from MAIN(65)
>
> Can it be related to _SET_DELIMITERS?
>
> best regards,
> Lorenzo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Wed Sep 12 14:33:28 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 14:33:39 2007
Subject: [Harbour] Clipper language syntax cleanup (with compatibility
	in	mind)
In-Reply-To: <46E7E93B.9010605@kevincarmody.com>
References: <186B2510-CF98-4991-80DF-B3FC1889D7BF@syenar.hu>
	<46E7E93B.9010605@kevincarmody.com>
Message-ID: <B0FC251E-9892-432D-8B8A-DA0B428D8A65@syenar.hu>

Kevin, thanks for your valuable comments.

> Some of these sound good, but others sound like individualistic  
> style preferences.  For instance, I think avoiding 4-letter  
> abbreviations is a step in the right direction, but requiring IIF()  
> instead of IF() does not.  I find IF() clearer and avoid IIF()  
> because it's harder to read and type.

Yes, the point would be to drive personal "habits" towards
a technical optimum with less variations. And this is by no
means obligatory as I said, these would only apply if the
"clean-mode" switch is on.

> - plain (non exact) "=" to be replaced by a function as an equality  
> operator
>       -- I very much like the idea of something that is independent  
> of SET EXACT.  I think an operator would be better than a  
> function.  See below under "!=".

 > How about adding "!==" as an alternative to "!( x == y )"?
 > Similarly, I think that "=" as a operator (assuming SET EXACT is off)
 > should be replaced with an operator independent of SET EXACT,
 > such as ~ or =|, and then what is now != could become !~ or !=|.

It crossed my mind, but the equal operator situation is
already more than too complicated, so I'd go for something
which lessen the confusion rather than add up to it (apart
from that !== would really be something logical, which might
fall back to). Well, discussion is open. I'm personally _always_
avoiding "=" because of the SET EXACT dependance. "=" with
SET EXACT OFF is more of a disaster from a language design
POV (the designers intentions could be to ease comparing
strings with right padded versions of the same string in
database fields, probably), so it'd be better to get rid
of it, if possible and IMO.

> - old (dBase) style comments to be obsoleted: "*"
>      -- Don't forget "&&".  Perhaps we can also eliminate [] and `'  
> as string delimiters.  Note the last pair, which is undocumented  
> and little known, in which the lead character is backwards  
> apostrophe, also called the grave character, not a regular apostrophe.

Thanks for these, I fully forgot about them :)

> Questionable:
>
> - inline ifs to be always iif() (not if())
>     -- I find IF() clearer than IIF()!

As for iif() vs if(), the big problem with the latter
is that it looks the same as a plain IF() statement,
so grepping for it is for example complicated, it is
after all an _i_nline IF.

> - plain "END" statements not allowed
>     -- I know ENDIF is clearer than END, but END is easier to type,  
> and I don't miss ENDIF.

As for END/ENDIF, well it always enhances readability
to match the closing statement with the opening one
(yes in C there is nothing like that, so debate is
open). Having been digging through almost a megabyte
of Harbour source code in the last few weeks (almost
line by line with some exaggeration), I've found it
much harder to decipher code where plain ENDs were used.

> - always "DO WHILE" (not WHILE, or vice versa, but ENDDO is better  
> in sync with DO WHILE)
>     -- I prefer to type WHILE and do not miss DO WHILE at all.

As for WHILE/DO WHILE, WHILE is perfect for me, we
could match it with an ENDWHILE pair, but at this point
transition is one-way, and this is not good. (I also used
to use WHILE BTW)

> In general, different ways of doing things had led different  
> developers to develop different styles.  A variety of methods can  
> be regarded as a strength rather than a weakness, since it welcomes  
> so many types of style, such as a Visual Basic type of style in  
> addition to a C type of style.

I would suggest to look at some newer language like C#,
where they've managed to keep the language syntax clean
and consistent. IMO this is very useful on the long run,
as you don't spend that much time on just trying to read
what the other programmer wanted to say. This way you'll
have more time for the programming logic.

Clipper allows a hundred variations even for the simplest
thing to express. I find this level of "flexibility" rather
a weakness than a strength. Again, let's keep in mind that
Clipper has a PP which is a tool for customizing the syntax,
so even if the base language would be "cleaned", the PP
would still be there to "extend" the syntax in almost any
ways, even on app level, for those who need it.

Let's hear other opinions, and maybe we'll get to something
which will be for the benefit of everyone.

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Wed Sep 12 16:53:58 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 16:54:03 2007
Subject: [Harbour] RT errors with guitest (sorry)
Message-ID: <9257026e0709121353r560ca593v1489132b2a2db5d6@mail.gmail.com>

ChangeLog: 2007-09-12 19:27 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)

Using guitest.prg, when I click on tbrowse area and the tbrowse is not
shown I get:

Error BASE/44  Assigned value is wrong class: HBGETLIST:NLASTEXITSTATE
Called from HBGETLIST:_NLASTEXITSTATE(0)
Called from HBGETLIST:SETTLE(643)
Called from READMODAL(148)
Called from MAIN(65)

if  I "open" the tbrowse using TAB and then I click on the area I get:

Error BASE/41  Scope violation (hidden): TBROWSE:NROWPOS
Called from TBROWSE:NROWPOS(0)
Called from TBMOUSE(3354)
Called from (b)INITKEYS(3104)
Called from TBROWSE:TAPPLYKEY(3146)
Called from TBROWSE:APPLYKEY(3080)
Called from HBGETLIST:TBREADER(1243)
Called from TBREADER(403)
Called from (b)MAIN(32)
Called from READMODAL(143)
Called from MAIN(65)

but this is probably due to the differences between my tbrowse and the svn one.

best regards,
Lorenzo
From harbour.01 at syenar.hu  Wed Sep 12 17:02:24 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 17:02:33 2007
Subject: [Harbour] RT errors with guitest (sorry)
In-Reply-To: <9257026e0709121353r560ca593v1489132b2a2db5d6@mail.gmail.com>
References: <9257026e0709121353r560ca593v1489132b2a2db5d6@mail.gmail.com>
Message-ID: <74FA1319-D16A-4A0F-887A-307425EB9444@syenar.hu>

> Error BASE/44  Assigned value is wrong class: HBGETLIST:NLASTEXITSTATE
> Called from HBGETLIST:_NLASTEXITSTATE(0)
> Called from HBGETLIST:SETTLE(643)
> Called from READMODAL(148)
> Called from MAIN(65)

I'll check this.

> if  I "open" the tbrowse using TAB and then I click on the area I get:
>
> Error BASE/41  Scope violation (hidden): TBROWSE:NROWPOS
> Called from TBROWSE:NROWPOS(0)
> Called from TBMOUSE(3354)
> Called from (b)INITKEYS(3104)
> Called from TBROWSE:TAPPLYKEY(3146)
> Called from TBROWSE:APPLYKEY(3080)
> Called from HBGETLIST:TBREADER(1243)
> Called from TBREADER(403)
> Called from (b)MAIN(32)
> Called from READMODAL(143)
> Called from MAIN(65)
>
> but this is probably due to the differences between my tbrowse and  
> the svn one.

Right, you must have a different version. I've actually fixed
this problem in SVN a few days ago.

TBMouse() should use the official public method to access
":rowPos" (and the other vars as well) instead of the internal var,
so this seems to be a bug in the old TBMouse().

Brgds,
Viktor

From druzus at priv.onet.pl  Wed Sep 12 16:59:42 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 12 17:04:58 2007
Subject: [Harbour] Clipper language syntax cleanup (with compatibility
	in	mind)
In-Reply-To: <46E7E93B.9010605@kevincarmody.com>
References: <186B2510-CF98-4991-80DF-B3FC1889D7BF@syenar.hu>
	<46E7E93B.9010605@kevincarmody.com>
Message-ID: <20070912205942.GA17894@localhost.localdomain>

On Wed, 12 Sep 2007, Kevin Carmody wrote:
> >- always "DO WHILE" (not WHILE, or vice versa, but ENDDO is better in 
> >sync with DO WHILE)

Do not forget about
    DO <id> [WITH <params,...>]
statement. In some case using DO WHILE can also confuse users, f.e.;

    proc p(while,x)
    DO while WITH x

is valid code in Harbour.

> >- no 4 letter abbreviation for functions or build-in statements
> >- ".not." not allowed.
> >- Unequality check with "!=" only (or be it <>, but != is more C-like).
> >- plain "=" not allowed as assigment.
> >- plain (non exact) "=" to be replaced by a function as an equality 
> >operator

You cannot touch only "=" without making corresponding modifications
in <, <=, >, >= operators because all of them are using the same logic.
and all of them are effected by _SET_EXACT switch. I do not like to
touch EXACT switch and I never do that. But I also do not think that
it's good idea to replace all of them by function calls due to serious
speed overhead. For me they work perfectly.

> >- old (dBase) style comments to be obsoleted: "*"
> >- macro evaluation in strings to be turned off by default.
> >- since PROCEDUREs doesn't add much to the language, the might
> >  be simply deleted, or be replaced by FUNCTIONs returning NIL
> >- multiple ANNOUNCEes should be allowed in a .prg
> >- CLASS syntax cleanup and standardization (by removing some
> >  synonyms).
> >- Quite some "old style" command could be dropped too:
> >  SELECT, SETs, STORE
> >- Quite some undocumented C5.2 constructs could also go.
> >  (this is easy already by not #define-ing HB_C52_UNDOC)
> >- Things solely there for dBase compatibility, to be dropped:
> >  SET ECHO, SET MENU, etc.
> Some of these sound good, but others sound like individualistic style 
> preferences.  For instance, I think avoiding 4-letter abbreviations is a 
> step in the right direction, but requiring IIF() instead of IF() does 
> not.  I find IF() clearer and avoid IIF() because it's harder to read 
> and type.

There is one very serious problem with IF() pseudo function which introduce
exception to valid IF statements, f.e.:

    IF( F1() )
        ? "..."
    ENDIF

can be compiled and works, this code:

    IF( F1(), F2() )
        ? "..."
    ENDIF

and this:

    IF( F1(), F2(), F3(), F4() )
        ? "..."
    ENDIF

also works without any problems, but:

    IF( F1(), F2(), F3() )
        ? "..."
    ENDIF

does not work due to exception for IF(p1,p2,p3) used as synonym of IIF()
and IMHO it's enough reason to not use it. IF() also complicates grammar
parser. Now both Harbour and xHarbour use hidden tricks to translate
IF(p1,p2,p3) to IIF(p1,p2,p3) before grammar parser to avoid such
complication in grammar rules. xHarbour uses additional PP #command
and Harbour makes translation in compiler lexer.

> Here's how I would categorize your suggestions:
> Definitely good ideas:
> - END form accepted: ENDDO, ENDSEQUENCE, ENDCASE, etc. (in one word, for 
> easier grepping/persing)
> - no 4 letter abbreviation for functions or build-in statements
> - Unequality check with "!=" only (or be it <>, but != is more C-like).
> - plain "=" not allowed as assigment.

That's OK for me, if you like it I can add to compiler such optional
functionality.

> - plain (non exact) "=" to be replaced by a function as an equality 
> operator

I do not like it. For me =, <, <=, >, >= operators are well documented
and works as I want. The only one problem is interaction with SET EXACT
switch so it's hard to create library code with such operators because
we do not know the SET EXACT state when it will be executed.

>      -- I very much like the idea of something that is independent of 
> SET EXACT.  I think an operator would be better than a function.  See 
> below under "!=".

We can add alternative relational operators which will not depend on
SET EXACT switch which will be used after setting some compiler switch.
IMHO it's enough. We can also add to common.ch some PP psedufunctions
which will simulate some other comparision, f.e.:
   #xtranslate HB_STR_LEE(<x>,<y>) => ( <x> < <y> .or. <x> == <y> )
what is effectively the same as requested <== operator.
In theory it's possible to implement many different new features in PP
if we add to PP information about operator precedence. Fo rsure I do not
want to change current PP base rules which are _VERY_ closed to Clipper
(I do not know any bugs or unintentional incompatibilities with Clipper
in current PP code) but I think it can be implemented with breaking
compatibility by introducing to PP new #operator directive and yet another
translation phase. Probably it will be the most flexible way to extend
language.

> - old (dBase) style comments to be obsoleted: "*"
>     -- Don't forget "&&".  Perhaps we can also eliminate [] and `' as 
> string delimiters.  Note the last pair, which is undocumented and little 
> known, in which the lead character is backwards apostrophe, also called 
> the grave character, not a regular apostrophe.

Just for information:
   We also support e"<C_like_string>", f.e: "First line\r\nSecond line"
   CLIP uses [] as operators to mark I18N strings.
   In xHarbour for such I18N strings I18N() pseudo function is used.

> - multiple ANNOUNCEes should be allowed in a .prg
> - CLASS syntax cleanup and standardization (by removing some
>  synonyms).
> - Quite some "old style" command could be dropped too:
>  STORE
> - Quite some undocumented C5.2 constructs could also go.
>  (this is easy already by not #define-ing HB_C52_UNDOC)
> - Things solely there for dBase compatibility, to be dropped:
>  SET ECHO, SET MENU, etc.
> Possibly good ideas:
> - ".not." not allowed.
> - macro evaluation in strings to be turned off by default.
>    -- I think this should be subject to a SET rather than a compiler 
> switch.

I think you missed the problem. To be Clipper compatible for _EACH_
string constant value which conatins '&' compiler generate special
PCODE which will make macro expansion for such string. Try to compile
this code:
   PROC MAIN()
      ? "QWE&ASD"
   RETURN
with -gc2 switch and check generated .c file. You will find:

	HB_P_PUSHFUNCSYM, 1, 0,	/* QOUT */
	HB_P_PUSHSTRSHORT, 8,	/* 8 */
	'Q', 'W', 'E', '&', 'A', 'S', 'D', 0, 
	HB_P_MACROTEXT,
	HB_P_DOSHORT, 1,

The HB_P_MACROTEXT is generated at compile time so at runtime &ASD
can be optionally replaced by contents of ASD memvar variable if it
exists. It's Clipper compatible behavior and many people do not know
about it. In Harbour I added -kM switch which disables such feature
so for the above code compiler will generate:

	HB_P_PUSHFUNCSYM, 1, 0,	/* QOUT */
	HB_P_PUSHSTRSHORT, 8,	/* 8 */
	'Q', 'W', 'E', '&', 'A', 'S', 'D', 0, 
	HB_P_DOSHORT, 1,

Just make a test. Everything happens at compile time and here is
no place for any RT SETs. Of course we can add new SET which will
cause that HVM will ignore HB_P_MACROTEXT PCODEs but in such case
we will introduce new problem similar to the one which we have
with SET EXACT now so IMHO it's very bad idea.

> - since PROCEDUREs doesn't add much to the language, the might
>  be simply deleted, or be replaced by FUNCTIONs returning NIL
> - Quite some "old style" command could be dropped too:
>  SELECT, SETs
> Questionable:
> - inline ifs to be always iif() (not if())
>    -- I find IF() clearer than IIF()!
> - plain "END" statements not allowed
>    -- I know ENDIF is clearer than END, but END is easier to type, and 
> I don't miss ENDIF.
> - always "DO WHILE" (not WHILE, or vice versa, but ENDDO is better in 
> sync with DO WHILE)
>    -- I prefer to type WHILE and do not miss DO WHILE at all.
> >All this have some consequences:
> >- "!=" would be equivalent for "!( x == y )" for string to be
> >  consistent, but this would create quite bad compatibility problems,
> >  so this one might be out of question.
> How about adding "!==" as an alternative to "!( x == y )"?  Similarly, I 
> think that "=" as a operator (assuming SET EXACT is off) should be 
> replaced with an operator independent of SET EXACT, such as ~ or =|, and 
> then what is now != could become !~ or !=|.

After some experience with new operators in xHarbour I suggest to
be very careful with adding new ones. Probably the only one way
to make the most users happy will be extending PP and introducing
new directives which will respect operators precedence so each of
them can easy implement his own ideas and extension. We can also
add:
   #warning [<level> [, <number> ]] <*msg*>
directive so the final effect will look like core compiler extensions.

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Wed Sep 12 17:23:19 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 17:23:23 2007
Subject: [Harbour] RT errors with guitest (sorry)
In-Reply-To: <74FA1319-D16A-4A0F-887A-307425EB9444@syenar.hu>
References: <9257026e0709121353r560ca593v1489132b2a2db5d6@mail.gmail.com>
	<74FA1319-D16A-4A0F-887A-307425EB9444@syenar.hu>
Message-ID: <9257026e0709121423h5b812103wd8281bb7d00b5eee@mail.gmail.com>

On 9/12/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> I'll check this.

The problem seems to be that ::aGetList[ nPos ]:ExitState for a
"closed" tbrowse is NIL and this NIL will get assigned to
::nLastExitState which is NUMERIC and rigthly complains.

I've temporary fixed it adding:

   IF nPos == 0
      nExitState := GE_DOWN
   ELSEIF nPos > 0 .AND. lInit /* NOTE: Never .T. in C5.2 mode. */
      nExitState := GE_NOEXIT
   ELSE
      nExitState := ::aGetList[ nPos ]:ExitState
>>>      if nExitState == nil
>>>         nExitState := GE_NOEXIT
>>>      endif
   ENDIF

in Settle method.

best regards,
Lorenzo
From harbour.01 at syenar.hu  Wed Sep 12 17:29:50 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 17:36:36 2007
Subject: [Harbour] Clipper language syntax cleanup (with compatibility
	in	mind)
In-Reply-To: <20070912205942.GA17894@localhost.localdomain>
References: <186B2510-CF98-4991-80DF-B3FC1889D7BF@syenar.hu>
	<46E7E93B.9010605@kevincarmody.com>
	<20070912205942.GA17894@localhost.localdomain>
Message-ID: <A56F952B-64FE-4B16-9891-E6A8C2E1CBB1@syenar.hu>

Another option to encourage better quality source code and
avoiding dubious constructs is to add optional compiler
warning for such things. Maybe this way it's more straightforward
and developer friendly.

For example an imaginary -wx01 switch could display these:
- Line 101: Warning: deprecated IF() construct used in expression.
- Line 102: Warning: ... "=" operator used in expression.
- Line 103: Warning: deprecated .not. operator used in expression.
- Line 104: Warning: 4 letter abbreviation used.
- Line 105: Warning: Old style (* or &&) comment used.

You get the idea. There can be more such switches for different
(set of) warnings.

As another thought I think we could compile Harbour with the -kM
switch. At first I cannot think a place where this could create
problems for us. Now with the C5.3 compatible features we have
some "&" in strings because this is the hotkey char.

On 2007.09.12., at 22:59, Przemyslaw Czerpak wrote:

> On Wed, 12 Sep 2007, Kevin Carmody wrote:
>>> - always "DO WHILE" (not WHILE, or vice versa, but ENDDO is  
>>> better in
>>> sync with DO WHILE)
>
> Do not forget about
>     DO <id> [WITH <params,...>]
> statement. In some case using DO WHILE can also confuse users, f.e.;
>
>     proc p(while,x)
>     DO while WITH x
>
> is valid code in Harbour.

Well, DO <x> WITH is agains something which could be obsoleted.
Causes quite some problems, and has quite some much better
alternatives even in Clipper 5.x and especially in Harbour.

>>> - no 4 letter abbreviation for functions or build-in statements
>>> - ".not." not allowed.
>>> - Unequality check with "!=" only (or be it <>, but != is more C- 
>>> like).
>>> - plain "=" not allowed as assigment.
>>> - plain (non exact) "=" to be replaced by a function as an equality
>>> operator
>
> You cannot touch only "=" without making corresponding modifications
> in <, <=, >, >= operators because all of them are using the same  
> logic.
> and all of them are effected by _SET_EXACT switch. I do not like to
> touch EXACT switch and I never do that. But I also do not think that
> it's good idea to replace all of them by function calls due to serious
> speed overhead. For me they work perfectly.

Yeah, it's better not to touch it. Maybe do something with SET_EXACT
instead, to guarantee that its state is fixed in the code. Meaning
that my code compiled with a given SET_EXACT, is not dependant on
any SET_EXACT runtime setting. It's like if the SET_EXACT setting
is burned into the code.

>> Here's how I would categorize your suggestions:
>> Definitely good ideas:
>> - END form accepted: ENDDO, ENDSEQUENCE, ENDCASE, etc. (in one  
>> word, for
>> easier grepping/persing)
>> - no 4 letter abbreviation for functions or build-in statements
>> - Unequality check with "!=" only (or be it <>, but != is more C- 
>> like).
>> - plain "=" not allowed as assigment.
>
> That's OK for me, if you like it I can add to compiler such optional
> functionality.

It would be great, see my comments at the beginning :)

>> - plain (non exact) "=" to be replaced by a function as an equality
>> operator
>
> I do not like it. For me =, <, <=, >, >= operators are well documented
> and works as I want. The only one problem is interaction with SET  
> EXACT
> switch so it's hard to create library code with such operators because
> we do not know the SET EXACT state when it will be executed.

You're right, see above.

>>      -- I very much like the idea of something that is independent of
>> SET EXACT.  I think an operator would be better than a function.  See
>> below under "!=".
>
> We can add alternative relational operators which will not depend on
> SET EXACT switch which will be used after setting some compiler  
> switch.
> IMHO it's enough. We can also add to common.ch some PP psedufunctions
> which will simulate some other comparision, f.e.:
>    #xtranslate HB_STR_LEE(<x>,<y>) => ( <x> < <y> .or. <x> == <y> )
> what is effectively the same as requested <== operator.
> In theory it's possible to implement many different new features in PP
> if we add to PP information about operator precedence. Fo rsure I  
> do not
> want to change current PP base rules which are _VERY_ closed to  
> Clipper
> (I do not know any bugs or unintentional incompatibilities with  
> Clipper
> in current PP code) but I think it can be implemented with breaking
> compatibility by introducing to PP new #operator directive and yet  
> another
> translation phase. Probably it will be the most flexible way to extend
> language.

A new #operator directive would be great, but it doesn't solve
to problem how to _disable_ existing ones, unless of course we
start to define let's say "#", "<>" as PP synonyms to "!=". Looks
like a good idea anyway.

> Just for information:
>    We also support e"<C_like_string>", f.e: "First line\r\nSecond  
> line"
>    CLIP uses [] as operators to mark I18N strings.
>    In xHarbour for such I18N strings I18N() pseudo function is used.

Beginning of the chaos :) I prefer pseudo functions for such purpose.

>> How about adding "!==" as an alternative to "!( x == y )"?   
>> Similarly, I
>> think that "=" as a operator (assuming SET EXACT is off) should be
>> replaced with an operator independent of SET EXACT, such as ~ or  
>> =|, and
>> then what is now != could become !~ or !=|.
>
> After some experience with new operators in xHarbour I suggest to
> be very careful with adding new ones. Probably the only one way

I agree.

> to make the most users happy will be extending PP and introducing
> new directives which will respect operators precedence so each of
> them can easy implement his own ideas and extension. We can also
> add:
>    #warning [<level> [, <number> ]] <*msg*>
> directive so the final effect will look like core compiler extensions.

Looks good!

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Wed Sep 12 17:47:41 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 12 17:47:46 2007
Subject: [Harbour] Harbour vs C53b mouse click handling
Message-ID: <9257026e0709121447m3e97a8b9m9ccea4a6ac88d049@mail.gmail.com>

Using guitest.prg I've noted a big difference with C53b:

When a control is clicked in C53b the "action" is executed while in
Harbour the first click means "select the control" and you need
another one to exec the action.

Is this an expected behavior?

best regards,
Lorenzo
From harbour.01 at syenar.hu  Wed Sep 12 22:44:04 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 12 22:44:08 2007
Subject: [Harbour] CHANGELOG: 2007-09-13 04:42 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f5af$Blat.v2.6.1$f28b6bb6$15f0c28299a0@127.0.0.1>

2007-09-13 04:42 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/memoedit.prg
   * source/rtl/teditor.prg
   * source/debug/tbrwtext.prg
     + HBEditor():RefreshWindow() renamed to :display()
       old message name kept for compatibility.
     + HBEditor():hitTest() added.
     + HBEditor():changed() added. (returns internal 
       ::lDirty which got renamed to ::lChanged)
       
   * source/rtl/getlist.prg
   * source/rtl/getsys.prg
   * source/rtl/tgetlist.prg
     ! Fixes for UI problems reported by Lorenzo 
       and more. Mostly from xhb.
     + ReadModal() core functionality moved inside 
       HBGetList()
     + ReadStats() functionality moved indide 
       HBGetList()
     + All HBGetList() vars made protected.
     + Cleaned up the .prg and class interfaces.
     ! Fixed crashes of several GETSYS compatibility 
       functions, when no getlist was active.
       We're still not fully C5.x compatible though.

   * source/rtl/tmenusys.prg
     + Uses ReadStats() instead of direct 
       HBGetList() var access.

   * source/rtl/tbrowse.prg
     ! :hitTest() fixed.

   * source/rtl/tget.prg
     ! Minor fixes to :capCol() and :capRow()

   * source/rtl/checkbox.prg
   * source/rtl/listbox.prg
   * source/rtl/menuto.prg
   * source/rtl/pushbtn.prg
   * source/rtl/radiobtn.prg
   * source/rtl/radiogrp.prg
   * source/rtl/scrollbr.prg
   * source/rtl/tbcolumn.prg
   * source/rtl/tbrowse.prg
   * source/rtl/tget.prg
   * source/rtl/tgetlist.prg
   * source/rtl/tpopup.prg
   * source/rtl/ttopbar.prg
     * Formatting (some varnames uniformized).

From teo at windtelsoft.com  Thu Sep 13 00:03:19 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Thu Sep 13 00:03:30 2007
Subject: [Harbour] [Viktor] Scope issue in HBGETLIST:OGET
Message-ID: <200709122303.19593.teo@windtelsoft.com>

Hello Viktor,

This is the log for a new error on your commit 7738:

[log]
Error BASE/42  Scope violation (protected): HBGETLIST:OGET
Called from Hbgetlist:Oget(0) => 
Called from Hbdebugger:Saveappscreen(2292) => 
Called from Hbdebugger:Show(2439) => 
Called from Hbdebugger:Activate(449) => 
Called from __dbgentry(155) => ../../debugger.prg
[/log]


best regards

Teo
From antonioharbour at gmail.com  Thu Sep 13 01:24:45 2007
From: antonioharbour at gmail.com (Antonio Linares)
Date: Thu Sep 13 01:25:17 2007
Subject: [Harbour] Clipper language syntax cleanup (with
	compatibilityin	mind)
In-Reply-To: <A56F952B-64FE-4B16-9891-E6A8C2E1CBB1@syenar.hu>
Message-ID: <46e8c9b6.01ba420a.3627.316d@mx.google.com>

Viktor, 

> - Line 101: Warning: deprecated IF() construct used in expression.

I really don't see any reason to drop If(). We use it in lots of places in
all our source code.

I thought that the Harbour Project was a Clipper compatible compiler
project. In these past months I really don't know where the project goes to:
first cloning xharbour, now trying to drop Clipper compatibility. Are we
trying to build a different compiler here ?

Maybe its time for a new fork that respects the original target of the
project. 

Regards,

Antonio

From M.Horodyski at pzuzycie.com.pl  Thu Sep 13 03:17:07 2007
From: M.Horodyski at pzuzycie.com.pl (Horodyski Marek (PZUZ))
Date: Thu Sep 13 03:17:15 2007
Subject: [Harbour] RE: Harbour Digest, Vol 11, Issue 27
Message-ID: <503AD832DBBF60469E9F807668A2F6A2027BCB50@PINK.zycie.pzu>

Viktor, 

>So I'd like to propose to transpose the whole CT function set 
>to the CT_*() namespace and add a header file to translate 
>back those CT_*() names into their original equivalent. The 
>only thing to be done for CT users is to include this header 
>(can be automatically controlled by a HB_COMPAT_CT flag to 
>make it even easier).


And what, when in my case all call of function are from script files,
through codeblock molar in fly ?

Regards,
Marek Horodyski
From lorenzo.fiorini at gmail.com  Thu Sep 13 03:50:17 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 13 03:50:20 2007
Subject: [Harbour] Many thanks to Viktor, Przemyslaw, ...
Message-ID: <9257026e0709130050l1ed0c841g94ca15c0717871ab@mail.gmail.com>

I want to thank Viktor for his impressive work on text UI. Not only in
few days I could drop almost all my "patches" but I've also found how
to optimize my code.

I also want to point to the quality of his PRG code. It is clean and
consistent and really easy to follow and to debug.

I want to thank Przemyslaw. Without the stability, speed and features
even the most fancy UI would be useless. I can't say much about his
code ( often I don't even understand what he his talking about :) but
I'm blindly sure that it works and it is the best solution.

And clearly thank to all other: developers that have contributed in
the past, actual developers: Marek, Mindaugas, Chen, Phil, Antonio,
...

With Harbour I can build rock solid linux/gtxwc/gttrm/cgi apps and
cross build for win32/gtwvt/gtwin/cgi using the same code and all
without a single warning or memory leak report.

With gttrm I can run my apps from PocketPCs and BarCode readers and
customers are impressed ( and scared ) to see they can enter sale
orders at the coffee room using an IPAQ with a stylus :)

With cgi/ajax I have built web based apps that can compete with JSP or
ASP best ones.

At last please let me thank xHarbour. Probably without it Harbour
would not be at this point. Since there are differences is natural to
have separate projects and this can be also an "healthy competition"
but I also hope that both will try to keep the "best possible"
compatibility ( often two parts are much less than the whole ).

I'm very proud to be part of this.

best regards,
Lorenzo
From harbour.01 at syenar.hu  Thu Sep 13 04:03:22 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 13 04:03:32 2007
Subject: [Harbour] Clipper language syntax cleanup (with
	compatibilityin	mind)
In-Reply-To: <46e8c9b6.01ba420a.3627.316d@mx.google.com>
References: <46e8c9b6.01ba420a.3627.316d@mx.google.com>
Message-ID: <80AE129F-701A-408A-9154-880F6CC7E9BC@syenar.hu>

Hi Antonio,

On 2007.09.13., at 7:24, Antonio Linares wrote:

> Viktor,
>
>> - Line 101: Warning: deprecated IF() construct used in expression.
>
> I really don't see any reason to drop If(). We use it in lots of  
> places in
> all our source code.
>
> I thought that the Harbour Project was a Clipper compatible compiler
> project. In these past months I really don't know where the project  
> goes to:
> first cloning xharbour, now trying to drop Clipper compatibility.  
> Are we

Do you have any specific features which you think
is a problem? (I'm also not a fan of porting everything
from xhb)

> trying to build a different compiler here ?

Read my message more carefully to see my intention.
I don't want to do anything like you suggest,
it's at best a new _optional_ switch which would
drop some feature for those who want higher quality
code.

> Maybe its time for a new fork that respects the original target of the
> project.

Yes, if you look even more carefully, you can see that
I've spend the last 2-3 weeks making the UI more
compatible with 5.2 and 5.3 and cleaning some parts
of Harbour which were not even touched in the last...
7 years after their first commit.

Brgds,
Viktor

From harbour.01 at syenar.hu  Thu Sep 13 04:05:08 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 13 04:05:15 2007
Subject: [Harbour] RE: Harbour Digest, Vol 11, Issue 27
In-Reply-To: <503AD832DBBF60469E9F807668A2F6A2027BCB50@PINK.zycie.pzu>
References: <503AD832DBBF60469E9F807668A2F6A2027BCB50@PINK.zycie.pzu>
Message-ID: <56210F5A-F7B7-4EE5-A74C-4DA14A5F8A79@syenar.hu>

Hi Marek,

Yes, looks like this is no solution.

Even integration doesn't look like a wise move,
so I don't think Harbour would take that step.

Brgds,
Viktor

On 2007.09.13., at 9:17, Horodyski Marek ((PZUZ)) wrote:

> Viktor,
>
>> So I'd like to propose to transpose the whole CT function set
>> to the CT_*() namespace and add a header file to translate
>> back those CT_*() names into their original equivalent. The
>> only thing to be done for CT users is to include this header
>> (can be automatically controlled by a HB_COMPAT_CT flag to
>> make it even easier).
>
>
> And what, when in my case all call of function are from script files,
> through codeblock molar in fly ?
>
> Regards,
> Marek Horodyski
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Thu Sep 13 05:00:45 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 13 05:00:48 2007
Subject: [Harbour] CHANGELOG: 2007-09-13 10:50 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f5e4$Blat.v2.6.1$925700f4$1750f20f2f8e@127.0.0.1>

2007-09-13 10:50 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/getsys.prg
   * source/rtl/tgetlist.prg
   * source/debug/debugger.prg
     ! Fixed scope violation in debugger by creating 
       a new :Get() method for HBGetList().
     ! Fixed some minor issues.
     % Minor optimization. Like dropping HBGetList():ReadExit() 
       which was just a wrapper to SET( _SET_EXIT ).
     ! Replaced a few remaining external HBGetList() var accesses 
       with :ReadStats() calls.
     ! TGetList():GetApplyKey() parameter list rearranged after 
       yesterday to keep it compatible with previous versions.
       This also avoids a crash in the debugger.

From harbour.01 at syenar.hu  Thu Sep 13 05:01:27 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 13 05:01:34 2007
Subject: [Harbour] [Viktor] Scope issue in HBGETLIST:OGET
In-Reply-To: <200709122303.19593.teo@windtelsoft.com>
References: <200709122303.19593.teo@windtelsoft.com>
Message-ID: <2E2F77C2-485F-48FA-92BC-CECC10A27094@syenar.hu>

Hi Teo,

It should be cool now. There was another crash
around the same area, also localized a fixed.

Brgds,
Viktor

On 2007.09.13., at 6:03, Teo Fonrouge wrote:

> Hello Viktor,
>
> This is the log for a new error on your commit 7738:
>
> [log]
> Error BASE/42  Scope violation (protected): HBGETLIST:OGET
> Called from Hbgetlist:Oget(0) =>
> Called from Hbdebugger:Saveappscreen(2292) =>
> Called from Hbdebugger:Show(2439) =>
> Called from Hbdebugger:Activate(449) =>
> Called from __dbgentry(155) => ../../debugger.prg
> [/log]
>
>
> best regards
>
> Teo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From antonioharbour at gmail.com  Thu Sep 13 05:54:19 2007
From: antonioharbour at gmail.com (Antonio Linares)
Date: Thu Sep 13 06:01:47 2007
Subject: [Harbour] Clipper language syntax cleanup
	(withcompatibilityin	mind)
In-Reply-To: <80AE129F-701A-408A-9154-880F6CC7E9BC@syenar.hu>
Message-ID: <46e908e4.163f420a.39c3.1ea6@mx.google.com>

Viktor, 

>
I don't want to do anything like you suggest, it's at best a new _optional_
switch which would drop some feature for those who want higher quality code.
>

Ok, thanks

>
Yes, if you look even more carefully, you can see that I've spend the last
2-3 weeks making the UI more compatible with 5.2 and 5.3 and cleaning some
parts of Harbour which were not even touched in the last... 7 years after
their first commit.
>

I do appreciate your great work, 

Regards,

Antonio

From lorenzo.fiorini at gmail.com  Thu Sep 13 06:02:17 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 13 06:02:24 2007
Subject: [Harbour] Running external prg/hrb inside an Harbour app
Message-ID: <9257026e0709130302g25c612a6k8c122a6ef5d8ed91@mail.gmail.com>

I'd like to add "scripting" to a custom made http server written in
Harbour. The server is statically linked to a "normal" Harbour app and
I need to access all the functions that are in the app. I also need to
pass oRequest, oResponse, oServer objects to the script and I have to
read the oResponse to send back data to the browser.

I've looked at hbdot and tried the code below but it is not what I'm
looking for.

Is it possible to do what I need?

Can anyone point me to the right direction?

best regards,
Lorenzo

METHOD Process( oRequest, oResponse, oServer ) CLASS MyHttpHandler

   LOCAL cFile
   LOCAL cPath, cName, cExt, cDrive
   LOCAL aIncDir := {}, xRetVal
   local cHost := oRequest:hHeaders[ "Host" ]

   cFile := oRequest:cReqUri

   HB_FNAMESPLIT( cFile, @cPath, @cName, @cExt, @cDrive )

   ...

   if lower( cExt ) == ".hrb"
      try
         xRetVal := __hrbRun( cName + cExt )
         oResponse:Flush( 200, "OK", "text/html", cName + cExt + "
__hrbrun gives: " + _XTOC( xRetVal ) )
      catch
         oResponse:Flush( 200, "OK", "text/html", cName + cExt + " rt error" )
      end
   ...
From harbour.01 at syenar.hu  Thu Sep 13 06:02:33 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 13 06:02:54 2007
Subject: [Harbour] Harbour text UI vs HTML forms
In-Reply-To: <9257026e0709120941k1e557bd0o76c3f2ec46607a80@mail.gmail.com>
References: <9257026e0709120042k688b179arc5ce309b9061c884@mail.gmail.com>
	<29C01C5B-D416-4185-9EA0-ADE673033759@syenar.hu>
	<9257026e0709120659ka759646t9a794291577ac164@mail.gmail.com>
	<3B62B50B-AEA2-493C-A2E6-A3F68C873347@syenar.hu>
	<9257026e0709120941k1e557bd0o76c3f2ec46607a80@mail.gmail.com>
Message-ID: <385388AE-0808-4821-B15E-6572AE9E83D3@syenar.hu>

> On 9/12/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
>
>> Is there anything we could implement here from xhb?
>
> I use xHarbour's since it has text selection and copy/cut/paste. I
> have a CRM app that exchange a lot of data to/from emails and it is
> absolutely necessary to select all text using Ctrl+A or part using
> SH_UP/DOWN and do Ctrl+C, Ctrl+X to paste into email clients or paste
> from them using Ctrl+V.
> Fir this I've introduced HB_EXT_INKEY in xHarbour time ago to
> distinguish between K_CTRL_x and K_movements keys.
>
> I also use xHarbour's tbrowse due to "datacache". I've DBFs with
> millions records and often filters with 1/10000 ratio. "Not cached"
> tbrowse reread data block even moving left/right and this means that
> user have to wait seconds only to see the next column.

Thanks for the info. TBrowse() caching is definitely
on my list. I'd do it without involving another class
for speed, but we will see. I think this is the last
major issue we have with Harbour in regards of CA-Cl*pper
compatibility.

Brgds,
Viktor



From harbour.01 at syenar.hu  Thu Sep 13 07:14:27 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 13 07:14:31 2007
Subject: [Harbour] CHANGELOG: 2007-09-13 13:00 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f5f7$Blat.v2.6.1$3fa0fe92$15707c856320@127.0.0.1>

2007-09-13 13:00 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * tests/rto_get.prg
     * Changes missed from previous commit.

From harbour.01 at syenar.hu  Thu Sep 13 07:47:58 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 13 07:48:02 2007
Subject: [Harbour] CHANGELOG: 2007-09-13 13:30 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f5fb$Blat.v2.6.1$ee6177f0$130cd7013b7e@127.0.0.1>

2007-09-13 13:30 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * makefile.vc
   * makefile.gc
   * makefile.bc
   * config/rules.cf
     + Using Harbour -kM switch when building Harbour itself.
       (this switch will turn off macro substitution in string 
       literals.)

From teo at windtelsoft.com  Thu Sep 13 08:52:25 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Thu Sep 13 08:52:30 2007
Subject: [Harbour] [Viktor] Scope issue in HBGETLIST:OGET
In-Reply-To: <2E2F77C2-485F-48FA-92BC-CECC10A27094@syenar.hu>
References: <200709122303.19593.teo@windtelsoft.com>
	<2E2F77C2-485F-48FA-92BC-CECC10A27094@syenar.hu>
Message-ID: <200709130752.25122.teo@windtelsoft.com>

On Thursday 13 September 2007 04:01:27 am Szak?ts Viktor wrote:
> Hi Teo,
>
> It should be cool now. There was another crash
> around the same area, also localized a fixed.
>

Thank you Viktor.

Your time and efforts are very appreciated here.


best regards

Teo
From lorenzo.fiorini at gmail.com  Thu Sep 13 09:13:08 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 13 09:13:17 2007
Subject: [Harbour] GT includes cleanup
Message-ID: <9257026e0709130613v132f604ld0e8b611da73a82b@mail.gmail.com>

I'd like to ask if it's possibile to move defines like the one below
to inkey.ch.

They are ALREADY in the svn in gtcrs.h, gtsln.h, gtwin.c, gtwvt.h so
it's not a change simply they are duplicated in many places.

best regards,
Lorenzo

/* xHarbour compatible definitions */
#define K_SH_LEFT            K_LEFT   /* Shift-Left  == Left  */
#define K_SH_UP              K_UP     /* Shift-Up    == Up    */
#define K_SH_RIGHT           K_RIGHT  /* Shift-Right == Right */
#define K_SH_DOWN            K_DOWN   /* Shift-Down  == Down  */
#define K_SH_INS             K_INS    /* Shift-Ins   == Ins   */
#define K_SH_DEL             K_DEL    /* Shift-Del   == Del   */
#define K_SH_HOME            K_HOME   /* Shift-Home  == Home  */
#define K_SH_END             K_END    /* Shift-End   == End   */
#define K_SH_PGUP            K_PGUP   /* Shift-PgUp  == PgUp  */
#define K_SH_PGDN            K_PGDN   /* Shift-PgDn  == PgDn  */
#define K_SH_RETURN          K_RETURN /* Shift-Enter == Enter */
#define K_SH_ENTER           K_ENTER  /* Shift-Enter == Enter */
From druzus at priv.onet.pl  Thu Sep 13 10:51:27 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 13 10:51:33 2007
Subject: [Harbour] ChangeLog 2007-09-13 16:40 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070913145127.GA19936@localhost.localdomain>

2007-09-13 16:40 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/Makefile
  + harbour/include/hbsxdef.ch
  * harbour/include/dbinfo.ch
  * harbour/include/hbrdddbf.h
  * harbour/include/hbrddcdx.h
  * harbour/include/hbrddntx.h
  * harbour/contrib/bmdbfcdx/hbrddbmcdx.h
  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/workarea.c
    + added SIx3 compatible triggers support
      They should work like in SIx3 with some intentional excpetions:
         1) if 4-th parameter exists (PREUSE/GET/PUT) then it's passed by
            reference otherwise is not passed at all and PCOUNT() in trigger
            functions returns 3
            SIx3 do not pass 4-th parameter by reference and if it not
            exist then passes 0
         2) EVENT_POSTCLOSE is executed after SUPER_CLOSE()
            SIx3 executes EVENT_POSTCLOSE just before SUPER_CLOSE()
         3) EVENT_UPDATE is executed _ALWAYS_ when DBF is updated also
            when WA does not have open indexes
            SIx3 executes EVENT_UPDATE only when at least one index is
            open without checking if it's updated or not
         4) EVENT_POSTUSE is executed from OPEN() method in "DBF" RDD not
            from index RDDs so before the indexes are open
            SIx3 executes EVENT_POSTUSE after opening indexes
            It's possible that I'll change this condition in the future

best regards,
Przemek
From randy at palmasdev.com  Thu Sep 13 11:01:00 2007
From: randy at palmasdev.com (Randy Portnoff)
Date: Thu Sep 13 11:00:20 2007
Subject: [Harbour] Next stable build?
In-Reply-To: <20070913145127.GA19936@localhost.localdomain>
References: <20070913145127.GA19936@localhost.localdomain>
Message-ID: <20070913150016.4B17647DF@smtp.tor.pathcom.com>

Hi all,

Is there any news regarding the next stable build (Release 1 or Beta 4)?

Regards,
Randy.


From lorenzo.fiorini at gmail.com  Thu Sep 13 11:19:21 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 13 11:19:25 2007
Subject: [Harbour] Please help with a segfault in contrig/gd
Message-ID: <9257026e0709130819t5df8bb98vf33e89e816c38fbc@mail.gmail.com>

Today I'm getting this:

#0  0x00bb46af in _int_free () from /lib/libc.so.6
#1  0x00bb8430 in free () from /lib/libc.so.6
#2  0x0097ec4d in gdFree () from /usr/lib/libgd.so.2
#3  0x0096d306 in gdImageDestroy () from /usr/lib/libgd.so.2

I haven't touched anything so I guess it could be a related to a Fedora Update:

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2007-2055
2007-09-07 10:19:30.625218
--------------------------------------------------------------------------------

Name        : gd
Product     : Fedora 7
Version     : 2.0.35
Release     : 1.fc7
Summary     : A graphics library for quick creation of PNG or JPEG images

is there anything I can do?

Here is the GDIMAGEDESTROY code:

/* ---------------------------------------------------------------------------*/

HB_FUNC( GDIMAGEDESTROY ) // gdImageDestroy(gdImagePtr im)
{
   if ( hb_pcount() == 1 &&
        hb_parinfo( 1 ) & HB_IT_POINTER )
   {
      gdImagePtr im;

      /* Retrieve image pointer */
      im = (gdImagePtr)hb_parptr( 1 );

      /* Destroy the image */
      gdImageDestroy( im );

   }
}

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Thu Sep 13 11:46:05 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 13 11:46:09 2007
Subject: [Harbour] contrib/gd segfault seems an Harbour problem
Message-ID: <9257026e0709130846q548a6284v5390ca827937bf52@mail.gmail.com>

I've reverted to 0.99.3 and it works where can I look?

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Thu Sep 13 12:21:28 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 13 12:21:35 2007
Subject: [Harbour] Re: contrib/gd segfault seems an Harbour problem
In-Reply-To: <9257026e0709130846q548a6284v5390ca827937bf52@mail.gmail.com>
References: <9257026e0709130846q548a6284v5390ca827937bf52@mail.gmail.com>
Message-ID: <9257026e0709130921r11e61afo81ea8633741db0d@mail.gmail.com>

On 9/13/07, Lorenzo Fiorini <lorenzo.fiorini@gmail.com> wrote:
> I've reverted to 0.99.3 and it works where can I look?

contrig/gd/test/bartest.prg reveals the segfault:

hbmk -n -static -gtcgi bartest -lgd

and ./bartest > bar

works with 0.99.3 but not with actual svn

best regards,
Lorenzo
From druzus at priv.onet.pl  Thu Sep 13 12:33:47 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 13 12:36:50 2007
Subject: [Harbour] Please help with a segfault in contrig/gd
In-Reply-To: <9257026e0709130819t5df8bb98vf33e89e816c38fbc@mail.gmail.com>
References: <9257026e0709130819t5df8bb98vf33e89e816c38fbc@mail.gmail.com>
Message-ID: <20070913163347.GA5310@localhost.localdomain>

On Thu, 13 Sep 2007, Lorenzo Fiorini wrote:
> Today I'm getting this:
> #0  0x00bb46af in _int_free () from /lib/libc.so.6
> #1  0x00bb8430 in free () from /lib/libc.so.6
> #2  0x0097ec4d in gdFree () from /usr/lib/libgd.so.2
> #3  0x0096d306 in gdImageDestroy () from /usr/lib/libgd.so.2
> I haven't touched anything so I guess it could be a related to a Fedora Update:
> --------------------------------------------------------------------------------
> Fedora Update Notification
> FEDORA-2007-2055
> 2007-09-07 10:19:30.625218
> --------------------------------------------------------------------------------
> Name        : gd
> Product     : Fedora 7
> Version     : 2.0.35
> Release     : 1.fc7
> Summary     : A graphics library for quick creation of PNG or JPEG images
> is there anything I can do?

If it's not old Harbour GD bug exploited by recent update then
probably you should report problem to FC team.

> Here is the GDIMAGEDESTROY code:
> /* ---------------------------------------------------------------------------*/
> HB_FUNC( GDIMAGEDESTROY ) // gdImageDestroy(gdImagePtr im)
> {
>    if ( hb_pcount() == 1 &&
>         hb_parinfo( 1 ) & HB_IT_POINTER )
>    {
>       gdImagePtr im;
>       /* Retrieve image pointer */
>       im = (gdImagePtr)hb_parptr( 1 );
>       /* Destroy the image */
>       gdImageDestroy( im );
>    }
> }

This code is dangerous. If you execute GDIMAGEDESTROY() twice
with the same parameter you can cause such effect. The GT library
should be redesigned to use GC pointers. It will give two nice
features:
    1. it will be safe for user mistakes
    2. it will not be necessary to execute GDIMAGEDESTROY() function
       at all because it will be executed automatically when the variables
       with gdImagePtr will be cleard.

Here is a code example how to make it:

/* gdImage destructor, it's executed automatically
 */
static HB_GARBAGE_FUNC( hb_gdImage_Destructor )
{
   /* Retrieve image pointer holder */
   gdImagePtr * imPtr = ( gdImagePtr * ) Cargo;

   /* Check if pointer is not NULL to avoid multiple freeing */
   if( * imPtr )
   {
      /* Destroy the image */
      gdImageDestroy( * imPtr );

      /* set pointer to NULL to avoid multiple freeing */
      * imPtr = NULL;
   }
}

/* function returns gdImage pointer or NULL when wrong variable is
 * passed or gdImage was freed before
 */
static gdImagePtr hb_parGdImage( int iParam )
{
   gdImagePtr * imPtr =
               ( gdImagePtr * ) hb_parptrGC( hb_gdImage_Destructor, iParam );

   if( imPtr )
      return * imPtr;
   else
      return NULL;
}

/* function create in HVM stack return value item with gdImage pointer
 */
static void hb_retGdImage( gdImagePtr im )
{
   gdImagePtr * imPtr;

   imPtr = ( gdImagePtr * ) hb_gcAlloc( sizeof( gdImagePtr ),
                                        hb_gdImage_Destructor );
   * imPtr = im;
   hb_retptrGC( ( void * ) imPtr );
}

/* function returns PHB_ITEM with gdImage pointer
 */
static PHB_ITEM hb_gdImageItemNew( gdImagePtr im )
{
   gdImagePtr * imPtr;

   imPtr = ( gdImagePtr * ) hb_gcAlloc( sizeof( gdImagePtr ),
                                        hb_gdImage_Destructor );
   * imPtr = im;
   return hb_itemPutPtrGC( NULL, ( void * ) imPtr );
}

To return GdImage pointer you should use:
    hb_retGdImage( im );
or:
    hb_itemReturnRelease( hb_gdImageItemNew( im ) );
instead of current:
    hb_retptr( im );

and to retrive pointer value:
    hb_parGdImage( iParam )
instead of current:
    hb_parptr( iParam );

then you can safely remove GDIMAGEDESTROY() function. It will not be
longer necessary. Instead of calling:
    GDIMAGEDESTROY( im )
it will be enough to make:
    im := NIL
and clenup code will be activate automatically if 'im' is the only one
existing pointer to GdImage structure in HVM.

Below I'm attaching patch which makes such modification in gdwrp.c
but only for GdImage pointers. Similar modification should be done
for GdFont by I'm leaving it to GD author.

Such modifications should be done in _ALL_ [x]Harbour libraries which
returns memory pointers to some structures. So far lot of Windows
code makes casting to numeric values when it returns some pointer.
F.e. Windows handles are usually casted to [U]LONG and returned with
hb_retnl() - it's very bad idea which may cause unpredictable results.
F.e. in XP64 [U]LONG is still 32bit integer and all Windows handles
are 64bit integer. If the most significant 32bit are not zero then
they will be lost during such conversion. Many of MS-Windows handles
are usually memory pointers. XP64 allocates memory for process
starting from 0. It's fatal design decision because buggy / not updated
to 64bit OSes 32bit application may work for some time and GPF later
when process memory exceeds 4GB, so it's not possible to easy detect
wrong code. So it's possible that your programs now works but have
very serious potential bugs and may stop to work suddenly when memory
addresses will exceed 4GB. Please remember that it's virtual address
and such problem can appear in systems with much less memory. It's
enough that some code will make for example memory mapping to file
with DVD image or sth similar. So I strongly suggest to check if
used tools return number or pointer items and update them if they
still operate on numbers. I hope that above example will help 3-rd
party code developers to use pointer items with automatic destructors.

best regards,
Przemek
-------------- next part --------------
Index: gdwrp.c
===================================================================
--- gdwrp.c	(wersja 7743)
+++ gdwrp.c	(kopia robocza)
@@ -93,6 +93,64 @@
 /* Internal functions                                                         */
 /* ---------------------------------------------------------------------------*/
 
+/* gdImage destructor, it's executed automatically
+ */
+static HB_GARBAGE_FUNC( hb_gdImage_Destructor )
+{
+   /* Retrieve image pointer holder */
+   gdImagePtr * imPtr = ( gdImagePtr * ) Cargo;
+
+   /* Check if pointer is not NULL to avoid multiple freeing */
+   if( * imPtr )
+   {
+      /* Destroy the image */
+      gdImageDestroy( * imPtr );
+
+      /* set pointer to NULL to avoid multiple freeing */
+      * imPtr = NULL;
+   }
+}
+
+/* function returns gdImage pointer or NULL when wrong variable is
+ * passed or gdImage was freed before
+ */
+static gdImagePtr hb_parGdImage( int iParam )
+{
+   gdImagePtr * imPtr =
+               ( gdImagePtr * ) hb_parptrGC( hb_gdImage_Destructor, iParam );
+
+   if( imPtr )
+      return * imPtr;
+   else
+      return NULL;
+}
+
+/* function create in HVM stack return value item with gdImage pointer
+ */
+static void hb_retGdImage( gdImagePtr im )
+{
+   gdImagePtr * imPtr;
+
+   imPtr = ( gdImagePtr * ) hb_gcAlloc( sizeof( gdImagePtr ),
+                                        hb_gdImage_Destructor );
+   * imPtr = im;
+   hb_retptrGC( ( void * ) imPtr );
+}
+
+#if 0
+/* function returns PHB_ITEM with gdImage pointer
+ */
+static PHB_ITEM hb_gdImageItemNew( gdImagePtr im )
+{
+   gdImagePtr * imPtr;
+
+   imPtr = ( gdImagePtr * ) hb_gcAlloc( sizeof( gdImagePtr ),
+                                        hb_gdImage_Destructor );
+   * imPtr = im;
+   return hb_itemPutPtrGC( NULL, ( void * ) imPtr );
+}
+#endif
+
 static void * LoadImageFromHandle( FHANDLE fhandle, int sz )
 {
    void *iptr;
@@ -202,7 +260,7 @@
    {
 
       /* Retrieve image pointer */
-      iptr = hb_parptr( 1 );
+      iptr = hb_parGdImage( 1 );
       /* Retrieve image size */
       sz     = hb_parni( 2 );
    }
@@ -258,7 +316,7 @@
       }
 
       /* Return image pointer */
-      hb_retptr( im );
+      hb_retGdImage( im );
 
       /* Free memory */
       hb_xfree( iptr );
@@ -282,7 +340,7 @@
       int level = 0, fg = 0;
 
       /* Retrieve image pointer */
-       im = (gdImagePtr)hb_parptr(1);
+      im = hb_parGdImage( 1 );
 
       /* Get file name or an output handler or NIL it I want a return string */
       if ( !( ISNIL(2) ||
@@ -460,7 +518,7 @@
       im = gdImageCreate( sx, sy );
 
       /* Return image pointer */
-      hb_retptr( im );
+      hb_retGdImage( im );
    }
    else
    {
@@ -502,7 +560,7 @@
       im = gdImageCreateTrueColor( sx, sy );
 
       /* Return image pointer */
-      hb_retptr( im );
+      hb_retGdImage( im );
    }
    else
    {
@@ -607,23 +665,8 @@
 
 /* ---------------------------------------------------------------------------*/
 
-HB_FUNC( GDIMAGEDESTROY ) // gdImageDestroy(gdImagePtr im)
-{
-   if ( hb_pcount() == 1 &&
-        hb_parinfo( 1 ) & HB_IT_POINTER )
-   {
-      gdImagePtr im;
 
-      /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
 
-      /* Destroy the image */
-      gdImageDestroy( im );
-
-   }
-}
-
-
 /* ---------------------------------------------------------------------------*/
 
 /* ---------------------------------------------------------------------------*/
@@ -644,7 +687,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord values */
       x = hb_parni( 2 );
@@ -687,7 +730,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord values */
       x1 = hb_parni( 2 );
@@ -733,7 +776,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord values */
       x1 = hb_parni( 2 );
@@ -783,7 +826,7 @@
       gdPoint points[50]; // TODO: make this dynamic
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point array */
       pPoints     = hb_param( 2, HB_IT_ARRAY );
@@ -840,7 +883,7 @@
       gdPoint points[50]; // TODO: make this dynamic
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point array */
       pPoints     = hb_param( 2, HB_IT_ARRAY );
@@ -894,7 +937,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord values */
       x1 = hb_parni( 2 );
@@ -939,7 +982,7 @@
 //      int cx, cy, w, h, color;
 //
 //      /* Retrieve image pointer */
-//      im = (gdImagePtr) hb_parptr( 1 );
+//      im = hb_parGdImage( 1 );
 //
 //      /* Retrieve point values */
 //      cx = hb_parni( 2 );
@@ -989,7 +1032,7 @@
       gdPoint points[50];
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point array */
       pPoints     = hb_param( 2, HB_IT_ARRAY );
@@ -1042,7 +1085,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord values */
       x1 = hb_parni( 2 );
@@ -1089,7 +1132,7 @@
       int cx, cy, w, h, s, e, color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point values */
       cx = hb_parni( 2 );
@@ -1139,7 +1182,7 @@
       int cx, cy, w, h, s, e, color, style;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point values */
       cx = hb_parni( 2 );
@@ -1191,7 +1234,7 @@
       int cx, cy, w, h, color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point values */
       cx = hb_parni( 2 );
@@ -1235,7 +1278,7 @@
       int x, y, border, color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point values */
       x = hb_parni( 2 );
@@ -1279,7 +1322,7 @@
       int cx, cy, w, h, color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point values */
       cx = hb_parni( 2 );
@@ -1323,7 +1366,7 @@
       int x, y, color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve point values */
       x = hb_parni( 2 );
@@ -1360,7 +1403,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve color value */
       color = hb_parni( 2 );
@@ -1396,7 +1439,7 @@
       int dont_blend;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve color value */
       color = hb_parni( 2 );
@@ -1433,10 +1476,10 @@
       gdImagePtr brush;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve brush pointer */
-      brush = (gdImagePtr)hb_parptr( 2 );
+      brush = hb_parGdImage( 2 );
 
       /* Set Brush */
       gdImageSetBrush(im, brush);
@@ -1467,10 +1510,10 @@
       gdImagePtr tile;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve tile pointer */
-      tile = (gdImagePtr)hb_parptr( 2 );
+      tile = hb_parGdImage( 2 );
 
       /* Set Tile */
       gdImageSetTile(im, tile);
@@ -1507,7 +1550,7 @@
       int styles[50]; // TODO: make this dynamic
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve style array */
       pStyles     = hb_param( 2, HB_IT_ARRAY );
@@ -1547,7 +1590,7 @@
       int oldthick;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve thickness value */
       thickness = hb_parni( 2 );
@@ -1587,7 +1630,7 @@
       int blending;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve blending value - logical */
       blending = hb_parl( 2 );
@@ -1621,7 +1664,7 @@
       int saveFlag;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve saveFlag value - logical */
       saveFlag = hb_parl( 2 );
@@ -1658,7 +1701,7 @@
       int x1, y1, x2, y2;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coords value */
       x1 = hb_parni( 2 );
@@ -1697,7 +1740,7 @@
       PHB_ITEM pClipArray;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Get clipping rectangle */
       gdImageGetClip(im, &x1, &y1, &x2, &y2);
@@ -1741,7 +1784,7 @@
       gdImagePtr im;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Get Colors total */
       hb_retni( gdImageColorsTotal(im) );
@@ -1772,7 +1815,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve saveFlag value */
       color = hb_parni( 2 );
@@ -1806,7 +1849,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve saveFlag value */
       color = hb_parni( 2 );
@@ -1840,7 +1883,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve saveFlag value */
       color = hb_parni( 2 );
@@ -1874,7 +1917,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve saveFlag value */
       color = hb_parni( 2 );
@@ -1906,7 +1949,7 @@
       gdImagePtr im;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Get Image Width in pixels */
       hb_retni( gdImageSX(im) );
@@ -1935,7 +1978,7 @@
       gdImagePtr im;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Get Image Height in pixels */
       hb_retni( gdImageSY(im) );
@@ -1967,7 +2010,7 @@
       int x,y;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord value */
       x = hb_parni( 2 );
@@ -2003,7 +2046,7 @@
       int x,y;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord value */
       x = hb_parni( 2 );
@@ -2036,7 +2079,7 @@
       gdImagePtr im;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Image is interlaced ? */
       hb_retl( gdImageGetInterlaced(im) );
@@ -2065,7 +2108,7 @@
       gdImagePtr im;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Image is trasparent ? */
       hb_retl( gdImageGetTransparent(im) );
@@ -2094,7 +2137,7 @@
       gdImagePtr im;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Is TrueColor ? */
       hb_retl( gdImageTrueColor(im) );
@@ -2126,7 +2169,7 @@
       int ditherFlag, colorsWanted;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve ditherFlag - logical */
       ditherFlag = hb_parl( 2 );
@@ -2165,7 +2208,7 @@
       int ditherFlag, colorsWanted;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve ditherFlag - logical */
       ditherFlag = hb_parl( 2 );
@@ -2177,7 +2220,7 @@
       imNew = gdImageCreatePaletteFromTrueColor(im, ditherFlag, colorsWanted);
 
       /* Return image pointer */
-      hb_retptr( imNew );
+      hb_retGdImage( imNew );
 
    }
    else
@@ -2206,7 +2249,7 @@
       int x,y;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord value */
       x = hb_parni( 2 );
@@ -2242,7 +2285,7 @@
       int x,y;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve coord value */
       x = hb_parni( 2 );
@@ -2275,7 +2318,7 @@
       gdImagePtr im;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Return previous */
       hb_retni( im->thick );
@@ -2382,7 +2425,7 @@
       unsigned char *s;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve font pointer */
       font = (gdFontPtr)hb_parptr( 2 );
@@ -2442,7 +2485,7 @@
       unsigned char *s;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve font pointer */
       font = (gdFontPtr)hb_parptr( 2 );
@@ -2517,7 +2560,7 @@
       int resolution;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr)( hb_parinfo( 1 ) & HB_IT_POINTER ? hb_parptr( 1 ) : NULL );
+      im = hb_parGdImage( 1 );
       //TraceLog( NULL, "Image pointer: %p\n\r", im );
 
       /* Retrieve rectangle array */
@@ -2651,7 +2694,7 @@
       char *err;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve pos value */
       cx = hb_parni( 2 );
@@ -2794,7 +2837,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve RGB values */
       r = hb_parni( 2 );
@@ -2833,7 +2876,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve saveFlag value */
       color = hb_parni( 2 );
@@ -2872,7 +2915,7 @@
       int a;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve RGB values */
       r = hb_parni( 2 );
@@ -2918,7 +2961,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve RGB values */
       r = hb_parni( 2 );
@@ -2962,7 +3005,7 @@
       int a;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve RGB values */
       r = hb_parni( 2 );
@@ -3008,7 +3051,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve RGB values */
       r = hb_parni( 2 );
@@ -3050,7 +3093,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve RGB values */
       r = hb_parni( 2 );
@@ -3092,7 +3135,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve RGB values */
       r = hb_parni( 2 );
@@ -3136,7 +3179,7 @@
       int a;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve RGB values */
       r = hb_parni( 2 );
@@ -3179,7 +3222,7 @@
       int color;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve saveFlag value */
       color = hb_parni( 2 );
@@ -3299,10 +3342,10 @@
       int dstX, dstY, srcX, srcY, w, h;
 
       /* Retrieve destination image pointer */
-      dst = (gdImagePtr)hb_parptr( 1 );
+      dst = hb_parGdImage( 1 );
 
       /* Retrieve source image pointer */
-      src = (gdImagePtr)hb_parptr( 2 );
+      src = hb_parGdImage( 2 );
 
       /* Retrieve destination pos value */
       dstX = hb_parni( 3 );
@@ -3356,10 +3399,10 @@
       int dstW, dstH, srcW, srcH;
 
       /* Retrieve destination image pointer */
-      dst = (gdImagePtr)hb_parptr( 1 );
+      dst = hb_parGdImage( 1 );
 
       /* Retrieve source image pointer */
-      src = (gdImagePtr)hb_parptr( 2 );
+      src = hb_parGdImage( 2 );
 
       /* Retrieve destination pos value */
       dstX = hb_parni( 3 );
@@ -3420,10 +3463,10 @@
       int dstW, dstH, srcW, srcH;
 
       /* Retrieve destination image pointer */
-      dst = (gdImagePtr)hb_parptr( 1 );
+      dst = hb_parGdImage( 1 );
 
       /* Retrieve source image pointer */
-      src = (gdImagePtr)hb_parptr( 2 );
+      src = hb_parGdImage( 2 );
 
       /* Retrieve destination pos value */
       dstX = hb_parni( 3 );
@@ -3483,10 +3526,10 @@
       int srcX, srcY, srcW, srcH, angle;
 
       /* Retrieve destination image pointer */
-      dst = (gdImagePtr)hb_parptr( 1 );
+      dst = hb_parGdImage( 1 );
 
       /* Retrieve source image pointer */
-      src = (gdImagePtr)hb_parptr( 2 );
+      src = hb_parGdImage( 2 );
 
       /* Retrieve destination pos value */
       dstX = hb_parnd( 3 );
@@ -3542,10 +3585,10 @@
       int dstX, dstY, srcX, srcY, w, h, pct;
 
       /* Retrieve destination image pointer */
-      dst =(gdImagePtr)hb_parptr( 1 );
+      dst =hb_parGdImage( 1 );
 
       /* Retrieve source image pointer */
-      src = (gdImagePtr)hb_parptr( 2 );
+      src = hb_parGdImage( 2 );
 
       /* Retrieve destination pos value */
       dstX = hb_parni( 3 );
@@ -3601,10 +3644,10 @@
       int dstX, dstY, srcX, srcY, w, h, pct;
 
       /* Retrieve destination image pointer */
-      dst = (gdImagePtr)hb_parptr( 1 );
+      dst = hb_parGdImage( 1 );
 
       /* Retrieve source image pointer */
-      src = (gdImagePtr)hb_parptr( 2 );
+      src = hb_parGdImage( 2 );
 
       /* Retrieve destination pos value */
       dstX = hb_parni( 3 );
@@ -3652,10 +3695,10 @@
       gdImagePtr dst, src;
 
       /* Retrieve destination image pointer */
-      dst = (gdImagePtr)hb_parptr( 1 );
+      dst = hb_parGdImage( 1 );
 
       /* Retrieve source image pointer */
-      src = (gdImagePtr)hb_parptr( 2 );
+      src = hb_parGdImage( 2 );
 
       /* Perform copy */
       gdImagePaletteCopy(dst, src);
@@ -3685,7 +3728,7 @@
       int radius;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve radius value */
       radius = hb_parni( 2 );
@@ -3719,7 +3762,7 @@
       int pct;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve percentual value */
       pct = hb_parni( 2 );
@@ -3756,10 +3799,10 @@
       gdImagePtr dst, src;
 
       /* Retrieve destination image pointer */
-      dst = (gdImagePtr)hb_parptr( 1 );
+      dst = hb_parGdImage( 1 );
 
       /* Retrieve source image pointer */
-      src = (gdImagePtr)hb_parptr( 2 );
+      src = hb_parGdImage( 2 );
 
       /* Compare images - if return <> 0 check value for infos */
       hb_retni( gdImageCompare(dst, src) );
@@ -3789,7 +3832,7 @@
       int interlace;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve interlace value */
       interlace = hb_parl( 2 );
@@ -3848,7 +3891,7 @@
       int GlobalCM, Loops;
 
       /* Retrieve image pointer */
-      im = (gdImagePtr) hb_parptr( 1 );
+      im = hb_parGdImage( 1 );
 
       /* Retrieve global color map value */
       GlobalCM = hb_parni( 3 );
@@ -3914,14 +3957,14 @@
       int LocalCM, LeftOfs, TopOfs, Delay, Disposal;
 
       /* Retrieve parameters */
-      im       = (gdImagePtr)hb_parptr( 1 );
+      im       = hb_parGdImage( 1 );
 
       LocalCM  = hb_parni( 3 );
       LeftOfs  = hb_parni( 4 );
       TopOfs   = hb_parni( 5 );
       Delay    = hb_parni( 6 );
       Disposal = hb_parni( 7 );
-      previm   = (gdImagePtr)hb_parptr( 8 );
+      previm   = hb_parGdImage( 8 );
 
       /* Run function and return value */
       iptr = gdImageGifAnimAddPtr(im, &size, LocalCM, LeftOfs, TopOfs, Delay, Disposal, previm);
From lorenzo.fiorini at gmail.com  Thu Sep 13 13:07:02 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 13 13:20:27 2007
Subject: [Harbour] Please help with a segfault in contrig/gd
In-Reply-To: <20070913163347.GA5310@localhost.localdomain>
References: <9257026e0709130819t5df8bb98vf33e89e816c38fbc@mail.gmail.com>
	<20070913163347.GA5310@localhost.localdomain>
Message-ID: <9257026e0709131007p3deaefb9q503f84871ff3ce6a@mail.gmail.com>

On 9/13/07, Przemyslaw Czerpak <druzus@priv.onet.pl> wrote:

> This code is dangerous. If you execute GDIMAGEDESTROY() twice
> with the same parameter you can cause such effect.

As usual you're right.

I've fixed the gdimage class to not call twice the GDIIMAGEDESTROY and it works.

I'll contact Francesco Saverio, the author, to see if he can fix the C code.

Many thanks,
Lorenzo
From myorg63 at mail.ru  Thu Sep 13 15:21:15 2007
From: myorg63 at mail.ru (Petr Chornyj)
Date: Thu Sep 13 15:21:18 2007
Subject: [Harbour] Harbour OOP
Message-ID: <12661636.post@talk.nabble.com>


After running I got a crash this demo app without any message.

#include "hbclass.ch"

PROCEDURE main
LOCAL nI := Demo():New()

	nI:Interval := 5
	? nI:Interval()
	? nI:Interval

RETURN Nil

CLASS Demo
PROTECTED:
	DATA Interval

EXPORTED:
	ACCESS Interval 
	ASSIGN Interval( n ) INLINE ::Interval( n )
	METHOD Interval( n ) 
	METHOD Init INLINE Self CONSTRUCTOR
ENDCLASS

METHOD Interval( n ) CLASS Demo
	IF (PCOUNT() > 0 ) .AND. HB_IsNumeric( n )
		::Interval := n
	ENDIF
RETURN ::Interval

I know a reason of this crash is a conflict of the names.
But a compiler processes this code without any error or warning. 
I think it not very good.
Is it possible to eliminate the conflict of the names on the stage of
compiling of the program?


-- 
View this message in context: http://www.nabble.com/Harbour-OOP-tf4437851.html#a12661636
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at priv.onet.pl  Thu Sep 13 15:54:17 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 13 15:54:34 2007
Subject: [Harbour] Harbour OOP
In-Reply-To: <12661636.post@talk.nabble.com>
References: <12661636.post@talk.nabble.com>
Message-ID: <20070913195417.GA24147@localhost.localdomain>

On Thu, 13 Sep 2007, Petr Chornyj wrote:
> After running I got a crash this demo app without any message.
> #include "hbclass.ch"
> PROCEDURE main
[...]
> I know a reason of this crash is a conflict of the names.

You are wrong. There is no name conflict and it's perfectly valid
code executed correctly by HVM. Many people create classes where
different messages are redirected to the single method. There is
nothing wrong in such code and of course such functionality cannot
be forbidden, f.e. each time when you use SETGET method you need
such functionality because two different messages <msgname> and
_<msgname> are redirected to single function.

The reason of crush in your example is caused by absolutely different
thing. You simply created infinite recursion loop in your code.
The program was executed until you had free stack memory and finally
caused GPF - that's all. [x]Harbour does not reduce VM call stack so
it's only limited by stack size allocated for process by OS or
application startup code.

> But a compiler processes this code without any error or warning. 
> I think it not very good.
> Is it possible to eliminate the conflict of the names on the stage of
> compiling of the program?

It's not possible to detect all infinite recursion loops at compile
time. I've never even heard about language which will generate
warnings even for very simple recursion like:

    func main()
    retu main()

though such situations can be detected. Just simply recursion is
very important feature so compiler cannot guess when it is not
intentional valid code and when it's programmer's mistake.

best regards,
Przemek
From teo at windtelsoft.com  Thu Sep 13 15:55:28 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Thu Sep 13 15:55:41 2007
Subject: [Harbour] Harbour OOP
In-Reply-To: <12661636.post@talk.nabble.com>
References: <12661636.post@talk.nabble.com>
Message-ID: <200709131455.28521.teo@windtelsoft.com>

On Thursday 13 September 2007 02:21:15 pm Petr Chornyj wrote:
> After running I got a crash this demo app without any message.
>
> #include "hbclass.ch"
>
> PROCEDURE main
> LOCAL nI := Demo():New()
>
> 	nI:Interval := 5
> 	? nI:Interval()
> 	? nI:Interval
>
> RETURN Nil
>
> CLASS Demo
> PROTECTED:
> 	DATA Interval
>
> EXPORTED:
> 	ACCESS Interval
> 	ASSIGN Interval( n ) INLINE ::Interval( n )
> 	METHOD Interval( n )
> 	METHOD Init INLINE Self CONSTRUCTOR
> ENDCLASS
>
> METHOD Interval( n ) CLASS Demo
> 	IF (PCOUNT() > 0 ) .AND. HB_IsNumeric( n )
>
> 		::Interval := n
>
> 	ENDIF
> RETURN ::Interval
>
> I know a reason of this crash is a conflict of the names.
> But a compiler processes this code without any error or warning.
> I think it not very good.
> Is it possible to eliminate the conflict of the names on the stage of
> compiling of the program?

Try compiling it by using the -es2 -w3 flags.


best regards

Teo Fonrouge
From lkrausem at shaw.ca  Thu Sep 13 15:45:52 2007
From: lkrausem at shaw.ca (Luis Krause Mantilla)
Date: Thu Sep 13 15:58:24 2007
Subject: [Harbour] Harbour OOP
In-Reply-To: <12661636.post@talk.nabble.com>
References: <12661636.post@talk.nabble.com>
Message-ID: <46E99370.4010905@shaw.ca>

Petr:

More than a name conflict, it looks the problem is your trying to assign
a value to a protected ivar instead of using the assign method:

	nI:Interval := 5  // this is the problem

	nI:Interval( 5 )  // this should fix the problem

Strange you don't get any error whatsoever.

Regards,

Petr Chornyj wrote:

>After running I got a crash this demo app without any message.
>
>#include "hbclass.ch"
>
>PROCEDURE main
>LOCAL nI := Demo():New()
>
>	nI:Interval := 5
>	? nI:Interval()
>	? nI:Interval
>
>RETURN Nil
>
>CLASS Demo
>PROTECTED:
>	DATA Interval
>
>EXPORTED:
>	ACCESS Interval 
>	ASSIGN Interval( n ) INLINE ::Interval( n )
>	METHOD Interval( n ) 
>	METHOD Init INLINE Self CONSTRUCTOR
>ENDCLASS
>
>METHOD Interval( n ) CLASS Demo
>	IF (PCOUNT() > 0 ) .AND. HB_IsNumeric( n )
>		::Interval := n
>	ENDIF
>RETURN ::Interval
>
>I know a reason of this crash is a conflict of the names.
>But a compiler processes this code without any error or warning. 
>I think it not very good.
>Is it possible to eliminate the conflict of the names on the stage of
>compiling of the program?
>
>
>  
>

-- 
Luis Krause Mantilla
lkrausem at shaw dot ca
luis_krause at hotmail dot com
"May the Source be with GNU"


From info at fsgiudice.com  Fri Sep 14 03:13:33 2007
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Fri Sep 14 03:13:55 2007
Subject: [Harbour] Please help with a segfault in contrig/gd
References: <9257026e0709130819t5df8bb98vf33e89e816c38fbc@mail.gmail.com><20070913163347.GA5310@localhost.localdomain>
	<9257026e0709131007p3deaefb9q503f84871ff3ce6a@mail.gmail.com>
Message-ID: <000801c7f69e$c3ed1a30$b400a8c0@ASUSFSG>

Lorenzo,

I'll check it in this weekend if I can.

Best Regards

Francesco

----- Original Message ----- 
From: "Lorenzo Fiorini" <lorenzo.fiorini@gmail.com>
To: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Sent: Thursday, September 13, 2007 7:07 PM
Subject: Re: [Harbour] Please help with a segfault in contrig/gd


> On 9/13/07, Przemyslaw Czerpak <druzus@priv.onet.pl> wrote:
>
>> This code is dangerous. If you execute GDIMAGEDESTROY() twice
>> with the same parameter you can cause such effect.
>
> As usual you're right.
>
> I've fixed the gdimage class to not call twice the GDIIMAGEDESTROY and it 
> works.
>
> I'll contact Francesco Saverio, the author, to see if he can fix the C 
> code.
>
> Many thanks,
> Lorenzo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour 
From lorenzo.fiorini at gmail.com  Fri Sep 14 03:22:49 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Fri Sep 14 03:22:53 2007
Subject: [Harbour] Please help with a segfault in contrig/gd
In-Reply-To: <000801c7f69e$c3ed1a30$b400a8c0@ASUSFSG>
References: <9257026e0709130819t5df8bb98vf33e89e816c38fbc@mail.gmail.com>
	<20070913163347.GA5310@localhost.localdomain>
	<9257026e0709131007p3deaefb9q503f84871ff3ce6a@mail.gmail.com>
	<000801c7f69e$c3ed1a30$b400a8c0@ASUSFSG>
Message-ID: <9257026e0709140022n2ae6c530l77e7cdf0a7429b3f@mail.gmail.com>

On 9/14/07, Francesco Saverio Giudice <info@fsgiudice.com> wrote:

> I'll check it in this weekend if I can.

Many thanks Francesco.

As a workaround I've added ::lDestroy := FALSE

   METHOD Destroy()   INLINE gdImageDestroy( ::pImage ), ::lDestroy := FALSE

since in the DESTRUCTOR there is:

PROCEDURE Destruct() CLASS GDImage
  //__OutDebug( "Destroyed" )
  IF ::lDestroy
     ::Destroy()
  ENDIF
RETURN

best regards,
Lorenzo
From soporte at dsgsoftware.com  Fri Sep 14 04:12:01 2007
From: soporte at dsgsoftware.com (=?iso-8859-1?Q?Juan_G=E1lvez?=)
Date: Fri Sep 14 04:12:29 2007
Subject: [Harbour] RegEx issue ?
Message-ID: <000c01c7f6a6$fa50ecc0$1700000a@PcJuanxp>

Hi All,

I've tried to build my app with current CVS and I get these link errors :

MAKE Version 5.2  Copyright (c) 1987, 2000 Borland
 c:\utl\bcc55\bin\ilink32.exe -Gn -q -t -aa -Tpe -s -jobjh32\develop\CONTAPro 
 -Iobjh32\develop\CONTAPro -Lc:\utl\bcc55\lib @MAKE0000.@@@
Error: Unresolved external '_pcre_stack_malloc' referenced from 
C:\UTL\HARBOUR\LIB\RTL.LIB|hbregex
Error: Unresolved external '_pcre_stack_free' referenced from 
C:\UTL\HARBOUR\LIB\RTL.LIB|hbregex

When I try to build Harbour with HB_PCRE_REGEX as define flag I get :

source\rtl\hbregex.c:
Error E2340 source\rtl\hbregex.c 111: Type mismatch in parameter 6 (wanted 
'int *', got 'int') in function hb_regexec
Error E2340 source\rtl\hbregex.c 111: Type mismatch in parameter 7 (wanted 
'int', got 'int *') in function hb_regexec
Error E2227 source\rtl\hbregex.c 111: Extra parameter in call to pcre_exec 
in function hb_regexec
Error E2451 source\rtl\hbregex.c 548: Undefined symbol 'pcre_stack_malloc' 
in function _hb_regex_init_
Error E2451 source\rtl\hbregex.c 549: Undefined symbol 'pcre_stack_free' in 
function _hb_regex_init_
*** 5 errors in Compile ***

What is it wrong ?

Could someone explain a litle bit about how [x]Harbour uses regex ?

Many thanks
Juan 

From druzus at priv.onet.pl  Fri Sep 14 08:01:19 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Fri Sep 14 08:01:28 2007
Subject: [Harbour] RegEx issue ?
In-Reply-To: <000c01c7f6a6$fa50ecc0$1700000a@PcJuanxp>
References: <000c01c7f6a6$fa50ecc0$1700000a@PcJuanxp>
Message-ID: <20070914120119.GB23335@localhost.localdomain>

On Fri, 14 Sep 2007, Juan G?lvez wrote:
> Hi All,
> I've tried to build my app with current CVS and I get these link errors :
> MAKE Version 5.2  Copyright (c) 1987, 2000 Borland
> c:\utl\bcc55\bin\ilink32.exe -Gn -q -t -aa -Tpe -s 
> -jobjh32\develop\CONTAPro -Iobjh32\develop\CONTAPro -Lc:\utl\bcc55\lib 
> @MAKE0000.@@@
> Error: Unresolved external '_pcre_stack_malloc' referenced from 
> C:\UTL\HARBOUR\LIB\RTL.LIB|hbregex
> Error: Unresolved external '_pcre_stack_free' referenced from 
> C:\UTL\HARBOUR\LIB\RTL.LIB|hbregex

You havn't added hbpcre to linked library list.

> When I try to build Harbour with HB_PCRE_REGEX as define flag I get :
> source\rtl\hbregex.c:
> Error E2340 source\rtl\hbregex.c 111: Type mismatch in parameter 6 (wanted 
> 'int *', got 'int') in function hb_regexec
> Error E2340 source\rtl\hbregex.c 111: Type mismatch in parameter 7 (wanted 
> 'int', got 'int *') in function hb_regexec
> Error E2227 source\rtl\hbregex.c 111: Extra parameter in call to pcre_exec 
> in function hb_regexec
> Error E2451 source\rtl\hbregex.c 548: Undefined symbol 'pcre_stack_malloc' 
> in function _hb_regex_init_
> Error E2451 source\rtl\hbregex.c 549: Undefined symbol 'pcre_stack_free' in 
> function _hb_regex_init_
> *** 5 errors in Compile ***
> What is it wrong ?

BCC contain it's own POSIX regex library (just like most other C compilers).
But this is very old PCRE library which is not compatible with current PCRE
releases. HB_PCRE_REGEX macro means that you want to use external PCRE
library instead of the one inside Harbour (hbpcre.lib)
In such case if you also uses BCC then please be sure that PCRE header files
will be scanned before BCC headers or remove pcre.h form BCC include
directory. Of course if you have such external PCRE library.
You can also set HB_POSIX_REGEX what force to use POSIX compatible
regular expressions (it's part of many C compilers and/or system libraries,
in practice exists in all *nixes) and HB_PCRE_REGEX_BCC if you want to
use the old PCRE library which is part of BCC. But if you do not know
the differences between them then I suggest to not set any of the above
macros and simply add hbpcre.lib to linked library list.

> Could someone explain a litle bit about how [x]Harbour uses regex ?

I hope the above text will make it more clear but it's only description
for Harbour.
xHarbour does not support any external regex library so can used only
with it's own PCRE regex library which always have to be linked with
final binaries. In xHarbour this library is called: pcrepos.lib not
hbpcre.lib

best regards,
Przemek
From antonioharbour at gmail.com  Fri Sep 14 08:23:44 2007
From: antonioharbour at gmail.com (Antonio Linares)
Date: Fri Sep 14 08:24:15 2007
Subject: [Harbour] Please help with a segfault in contrig/gd
In-Reply-To: <20070913163347.GA5310@localhost.localdomain>
Message-ID: <46ea7d69.1e8d420a.6a4a.fffff6b7@mx.google.com>

Przemek, 

> F.e. in XP64 [U]LONG is still 32bit integer and all Windows handles are
64bit integer.

Could they be casted to LONGLONG ? Is it there an ULONGLONG ?

Thanks,

Regards,

Antonio

From myorg63 at mail.ru  Fri Sep 14 09:21:03 2007
From: myorg63 at mail.ru (Petr Chornyj)
Date: Fri Sep 14 09:21:07 2007
Subject: [Harbour] Harbour OOP
In-Reply-To: <20070913195417.GA24147@localhost.localdomain>
References: <12661636.post@talk.nabble.com>
	<20070913195417.GA24147@localhost.localdomain>
Message-ID: <12675232.post@talk.nabble.com>


Thank you all and especially Przhemek, you are right.   

I also agree with Victor  
- CLASS syntax cleanup and standardization (by removing some synonyms).  

But what is classic (native) syntax of classes for Harbour ? 
In my demo I use xHb class syntax.


Best regards, 
Petr
-- 
View this message in context: http://www.nabble.com/Harbour-OOP-tf4437851.html#a12675232
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From soporte at dsgsoftware.com  Fri Sep 14 09:57:52 2007
From: soporte at dsgsoftware.com (=?iso-8859-2?Q?Juan_G=E1lvez?=)
Date: Fri Sep 14 09:59:24 2007
Subject: [Harbour] RegEx issue ?
References: <000c01c7f6a6$fa50ecc0$1700000a@PcJuanxp>
	<20070914120119.GB23335@localhost.localdomain>
Message-ID: <001401c7f6d7$70a1c540$1700000a@PcJuanxp>

Przemek,

Many thanks for your didactic explanation.

Best regards
Juan

----- Original Message ----- 
From: "Przemyslaw Czerpak" <druzus@priv.onet.pl>
To: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Sent: Friday, September 14, 2007 2:01 PM
Subject: Re: [Harbour] RegEx issue ?


> On Fri, 14 Sep 2007, Juan G?lvez wrote:
>> Hi All,
>> I've tried to build my app with current CVS and I get these link errors :
>> MAKE Version 5.2  Copyright (c) 1987, 2000 Borland
>> c:\utl\bcc55\bin\ilink32.exe -Gn -q -t -aa -Tpe -s
>> -jobjh32\develop\CONTAPro -Iobjh32\develop\CONTAPro -Lc:\utl\bcc55\lib
>> @MAKE0000.@@@
>> Error: Unresolved external '_pcre_stack_malloc' referenced from
>> C:\UTL\HARBOUR\LIB\RTL.LIB|hbregex
>> Error: Unresolved external '_pcre_stack_free' referenced from
>> C:\UTL\HARBOUR\LIB\RTL.LIB|hbregex
>
> You havn't added hbpcre to linked library list.
>
>> When I try to build Harbour with HB_PCRE_REGEX as define flag I get :
>> source\rtl\hbregex.c:
>> Error E2340 source\rtl\hbregex.c 111: Type mismatch in parameter 6 
>> (wanted
>> 'int *', got 'int') in function hb_regexec
>> Error E2340 source\rtl\hbregex.c 111: Type mismatch in parameter 7 
>> (wanted
>> 'int', got 'int *') in function hb_regexec
>> Error E2227 source\rtl\hbregex.c 111: Extra parameter in call to 
>> pcre_exec
>> in function hb_regexec
>> Error E2451 source\rtl\hbregex.c 548: Undefined symbol 
>> 'pcre_stack_malloc'
>> in function _hb_regex_init_
>> Error E2451 source\rtl\hbregex.c 549: Undefined symbol 'pcre_stack_free' 
>> in
>> function _hb_regex_init_
>> *** 5 errors in Compile ***
>> What is it wrong ?
>
> BCC contain it's own POSIX regex library (just like most other C 
> compilers).
> But this is very old PCRE library which is not compatible with current 
> PCRE
> releases. HB_PCRE_REGEX macro means that you want to use external PCRE
> library instead of the one inside Harbour (hbpcre.lib)
> In such case if you also uses BCC then please be sure that PCRE header 
> files
> will be scanned before BCC headers or remove pcre.h form BCC include
> directory. Of course if you have such external PCRE library.
> You can also set HB_POSIX_REGEX what force to use POSIX compatible
> regular expressions (it's part of many C compilers and/or system 
> libraries,
> in practice exists in all *nixes) and HB_PCRE_REGEX_BCC if you want to
> use the old PCRE library which is part of BCC. But if you do not know
> the differences between them then I suggest to not set any of the above
> macros and simply add hbpcre.lib to linked library list.
>
>> Could someone explain a litle bit about how [x]Harbour uses regex ?
>
> I hope the above text will make it more clear but it's only description
> for Harbour.
> xHarbour does not support any external regex library so can used only
> with it's own PCRE regex library which always have to be linked with
> final binaries. In xHarbour this library is called: pcrepos.lib not
> hbpcre.lib
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour 

From harbour.01 at syenar.hu  Fri Sep 14 12:48:16 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 14 12:48:19 2007
Subject: [Harbour] CHANGELOG: 2007-09-14 18:46 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f6ef$Blat.v2.6.1$0c48c220$c40ba29702@127.0.0.1>

2007-09-14 18:46 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * harbour/source/rtl/tbrowse.prg
     ! Fixed cell color. This was needed because the oCol:colorBlock() 
       now always contains a block (it cannot be NIL) to be CA-Cl*pper 
       compatible, so the logic had to be adjusted in :DispCell() 
       accordingly.

From harbour.01 at syenar.hu  Sat Sep 15 07:54:48 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 15 07:54:52 2007
Subject: [Harbour] CHANGELOG: 2007-09-14 18:46 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f78f$Blat.v2.6.1$37a44f0c$ec0405b5bd6@127.0.0.1>

2007-09-14 18:46 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/tbrowse.prg
     ! Color handling made fully C5.x compatible. Pls test.
     + One C5.3 bug replicated where no special header/footer 
       colors are being used if there is not header/footer separator 
       sepcified.
     ! Fixed compile error (because of unused var warning) when 
       HB_COMPAT_C53 is not defined.

   * source/rtl/numeric.prg
   * source/rtl/memoedit.prg
   * source/rtl/typefile.prg
   * source/rtl/block.prg
   * source/rtl/symbol.prg
   * source/rtl/errorsys.prg
   * source/rtl/scalar.prg
   * source/rtl/nil.prg
   * source/rtl/radiogrp.prg
   * source/rtl/logical.prg
   * source/rtl/array.prg
   * source/rtl/listbox.prg
   * source/rtl/browse.prg
   * source/rtl/characte.prg
   * source/rtl/pushbtn.prg
   * source/rtl/ttextlin.prg
   * source/rtl/profiler.prg
   * source/rtl/date.prg
   * source/rtl/persist.prg
   * source/debug/dbgbrwsr.prg
   * source/debug/tbrwtext.prg
   * source/debug/dbgtmenu.prg
     + Enabled "PROTECTED:" keyword in profiler.prg
     * Finished CLASS declarations to use a more or less consistent syntax 
       inside Harbour (Class(y) compatible except SETGET and the METHOD 
       parameter lists, maybe some more).
     * Finished WHILE, iif(), END, string quotation to be consistent along Harbour.
     ! Fixed some indentations.
     * Some other minor cleanups.

From harbour.01 at syenar.hu  Sun Sep 16 06:54:57 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 16 08:23:28 2007
Subject: [Harbour] CHANGELOG: 2007-09-16 12:53 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f850$Blat.v2.6.1$0579a4de$d04b5ade8b4@127.0.0.1>

2007-09-16 12:53 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * contrib/libct/makefile.vc
     * Some alignment.

   * source/rtl/listbox.prg
     ! Using manifest constant.

   * source/rtl/tbrowse.prg
     ! Some final fixes for full color compatibility.

   * source/common/hbver.c
     + Added NOTE about what CA-Cl*ppers are returning 
       for Version().

From harbour.01 at syenar.hu  Sun Sep 16 12:45:02 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 16 13:41:11 2007
Subject: [Harbour] CHANGELOG: 2007-09-16 18:44 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f880$Blat.v2.6.1$ed9fea72$fa09cac8422@127.0.0.1>

2007-09-16 18:44 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/tbrowse.prg
     ! Another fix for TBrowse() full color compatibility.

From harbour.01 at syenar.hu  Sun Sep 16 14:16:36 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 16 14:34:08 2007
Subject: [Harbour] CHANGELOG: 2007-09-16 20:14 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f88d$Blat.v2.6.1$b808a540$1134a8332120@127.0.0.1>

2007-09-16 20:14 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/tbrowse.prg
     ! C5.x compatible fix for non-numeric values inside the 
       defColor array or the one returned by colorBlock.

From druzus at priv.onet.pl  Sun Sep 16 15:33:24 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sun Sep 16 15:33:40 2007
Subject: [Harbour] Please help with a segfault in contrig/gd
In-Reply-To: <46ea7d69.1e8d420a.6a4a.fffff6b7@mx.google.com>
References: <20070913163347.GA5310@localhost.localdomain>
	<46ea7d69.1e8d420a.6a4a.fffff6b7@mx.google.com>
Message-ID: <20070916193324.GA21526@localhost.localdomain>

On Fri, 14 Sep 2007, Antonio Linares wrote:
> > F.e. in XP64 [U]LONG is still 32bit integer and all Windows handles are
> 64bit integer.
> Could they be casted to LONGLONG ? Is it there an ULONGLONG ?

Technically yes. They can be casted to [U]LONGLON without losing
information in XP64, where [U]LONGLONG is 64bit integer (early
versions of MSVC for XP64 had some bugs with UINT64 conversions
but I believe that MS already fixed them but I do not use Windows
so I'm not sure). Anyhow I strongly suggest to not use numbers
to keep pointers on .prg level because even stupid typo in .prg
code will cause GPF. Additionally you cannot easy validate if
given parameter is correct address after conversion from number.
Finally you do not know how long returned pointer is accessible
from .prg code and when to free resources bound with this pointer
or handle. It means that user has to "release" them explicitly
in his code and should be careful to not make it twice. All this
problems can be resolved when you begin to use GC inspected
pointer items because you can bound with memory block your own
destructor function which will make give you some important
extensions:
   1. inside hb_parptrGC() HVM will check if given block has
      the same destructor function so you do not have to worry
      that user by mistake pass to your function different handler.
      It resolves the problem with parameters validation.
   2. When the last variable containing with returned handler will be
      cleared (it will be out of scope, some different values will be
      assigned to it or GC will free some set of unaccessible items)
      then you destructor function will be executed automatically.
      It resolves the problem with freeing allocated memory or other
      resources so user will not have to remember about it.
   3. if you support in your code explicit destructor function which can
      be executed by user from .prg code then you can easy add protection
      against multiple executing it. It resolves the problem like in GD
      code reported recently by Lorenzo.

See as example the modifications in GD code.

Please note that the code which uses GC pointers can detect bugs in
user .prg code and report nice RT errors. If it uses numbers then
simply generates GPF if user by mistake mix parameters or in worser
case it works longer but corrupts some internal memory structures
causing unpredictable results in different part of application.
So working with library which uses handlers is much more pleasure for
users.

There is also yet another important possibilities which I'll add in the
future for GC pointers. Just like arrays they are also very good holders
for object instance data. For people who are creating classes in C code
it will be much more flexible to use GC pointers which will hold C
structures directly then arrays with some additional translation code.

best regards,
Przemek
From druzus at priv.onet.pl  Sun Sep 16 15:34:39 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sun Sep 16 15:34:52 2007
Subject: [Harbour] ChangeLog(s)
Message-ID: <20070916193439.GB21526@localhost.localdomain>

2007-09-16 22:45 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/compiler/hbopt.c
    ! fixed bad typo in last modification - thanks to Viktor
    * added additional line number validation to not make optimizations
      which will change line numbers

2007-09-15 22:35 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbapi.h
    + HB_ISFIRSTIDCHAR() and HB_ISNEXTIDCHAR() macros

  * harbour/source/rdd/wafunc.c
    * changed FIELD->, _FIELD->, <alias>-> stripping from expressions
      to respect shortcuts

  * harbour/source/compiler/hbmain.c
  * harbour/source/compiler/hbdead.c
  * harbour/source/compiler/hbopt.c
    * jump joining optimization changed to work also for code with line
      numbers

best regards,
Przemek
From druzus at priv.onet.pl  Sun Sep 16 15:45:30 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sun Sep 16 15:45:42 2007
Subject: [Harbour] Next stable build?
In-Reply-To: <20070913150016.4B17647DF@smtp.tor.pathcom.com>
References: <20070913145127.GA19936@localhost.localdomain>
	<20070913150016.4B17647DF@smtp.tor.pathcom.com>
Message-ID: <20070916194530.GC21526@localhost.localdomain>

On Thu, 13 Sep 2007, Randy Portnoff wrote:
> Hi all,
> Is there any news regarding the next stable build (Release 1 or Beta 4)?

I think that after Viktor will have finished modifications in .prg classes.
This was the last part of Harbour which needed deep modifications
to be fully Clipper compatible so IMHO it's very important to wait
for Viktor's work.
It also means that we will need BETA4 because user feedback will
be very important.
If other developers will agree then I'd like to also replace HB_IT_*
as field type in RDD code with HB_FT_* and add field flags as HB_FF_*
but without touching .prg functions like dbCreate()/dbStruct()/AFields()
so we can still discuss about .prg API for new functionality having base
C API. I already have such patch and it works nice.
It's basically the patch I sent few days to this list with some minor
modifications.
So if someone does not like it then I would like to hear his opinion.

best regards,
Przemek
From info at fsgiudice.com  Sun Sep 16 16:25:13 2007
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sun Sep 16 16:25:31 2007
Subject: [Harbour] [GD] 2007-09-16 22:30 UTC+0200 Francesco Saverio Giudice
	<info/at/fsgiudice.com>
References: <9257026e0709130819t5df8bb98vf33e89e816c38fbc@mail.gmail.com><20070913163347.GA5310@localhost.localdomain><9257026e0709131007p3deaefb9q503f84871ff3ce6a@mail.gmail.com>
	<000801c7f69e$c3ed1a30$b400a8c0@ASUSFSG>
Message-ID: <001401c7f89f$b3e4e700$6501a8c0@ASUSFSG>

2007-09-16 22:30 UTC+0200 Francesco Saverio Giudice <info/at/fsgiudice.com>
  * contrib/gd/source/gdwrp.c
    * changed pointers handling, thanks to Przemek for code

Lorenzo, please test it and confirm. Thanks.

Best Regards

Francesco

From info at fsgiudice.com  Sun Sep 16 16:30:39 2007
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sun Sep 16 16:30:52 2007
Subject: [Harbour] [GD] 2007-09-16 22:28 UTC+0200 Francesco Saverio Giudice
	<info/at/fsgiudice.com>
References: <20070916193439.GB21526@localhost.localdomain>
Message-ID: <002101c7f8a0$76f98bb0$6501a8c0@ASUSFSG>

2007-09-16 22:28 UTC+0200 Francesco Saverio Giudice <info/at/fsgiudice.com>
  * contrib/gd/source/gdwrp.c
    * cleaned some comments
  * contrib/gd/ChangeLog
    * adjusted time of previous commit

Best Regards

Francesco
From gvarona at ec-red.com  Sun Sep 16 20:56:49 2007
From: gvarona at ec-red.com (=?UTF-8?B?R3VpbGxlcm1vIFZhcm9uYSBTaWx1cMO6?=)
Date: Sun Sep 16 20:56:55 2007
Subject: [Harbour] Errores en el tBrowse, HBEditor y Debug
Message-ID: <46EDD0D1.6060107@ec-red.com>

Hola Amigos, reporto los siguientes errores:
Hello Friends, I report the following mistakes:

1.- Este C?digo funciona bien en Clipper 5.3b:
1.-This Code works well in Clipper 5.3b:

#include "INKEY.CH"
PROCEDURE main
LOCAL cCond := "Probando . . . " , cSN:="S"
CLS
@ 14,2 TO 22,78; @ 24,0; @ 24,0 SAY '<Ctrl>+W = Salir' COLOR "GR+*/R"
cCond := MEMOEDIT(cCond,15,3,21,77)
KEYB CHR(K_ESC); MEMOEDIT(cCond,15,3,21,77,.F.)
RETURN

Pero en Harbour me da el siguiente error:
But in Harbour it gives me the following mistake:

Error BASE/42 Scope violation (protected): HBMEMOEDITOR:LEXITEDIT
Called from HBMEMOEDITOR:LEXITEDIT(0)
Called from BROWSETEXT(1065)
Called from HBEDITOR:EDIT(650)
Called from HBMEMOEDITOR:EDIT(136)
Called from MEMOEDIT(291)
Called from MAIN(7) ????????????????????????????????????????????????

2.- Este C?digo funciona bien en Clipper 5.3b.
2.-This Code works well in Clipper 5.3b:

#include "INKEY.CH"
PROCEDURE main

aDbf := {}
AADD(aDbf, { "Nombre", "C", 25, 0 })
AADD(aDbf, { "Direccion", "C", 1024, 0 })
AADD(aDbf, { "Telefono", "N", 13, 0 })

IF !FILE("Agenda.dbf")
DBCREATE("Agenda", aDbf)
ENDIF
USE Agenda
CLS

bCampo := {|| Nombre+'?'+Direccion+'?'+TRAN(Telefono,'#####')}
oDbMenu := TBrowseDb(5, 5, 20, 75)
oDbMenu:AddColumn(TBColumnNew('',bCampo))

DO WHILE .T.
DO WHILE !oDbMenu:Stabilize() .AND. INKEY()=0; ENDDO
IF oDbMenu:Stable; nTecla := Inkey(0); ENDIF
oDbMenu:RefreshCurrent()
DO CASE
CASE nTecla = K_DOWN; oDbMenu:Down()
CASE nTecla = K_UP; oDbMenu:Up()
CASE nTecla = K_PGUP; oDbMenu:PageUp()
CASE nTecla = K_PGDN; oDbMenu:PageDown()
CASE nTecla = K_CTRL_PGUP; oDbMenu:GoTop()
CASE nTecla = K_CTRL_PGDN; oDbMenu:GoBottom()
CASE nTecla = K_ESC; EXIT
CASE nTecla = K_ENTER; EXIT
ENDCASE
ENDDO
RETURN

Pero en Harbour, cuando presiono la tecla hacia abajo y luego Enter, me 
da el siguiente error:
But in Harbour, when I press the key down and then Enter, it gives me 
the following mistake:

Error BASE/1081 Argument error: +
Called from TBROWSE:STABILIZE(1048)
Called from MAIN(21)

Esto sucede en un DBF vacio, cuando el DBF tiene registros, no hay problema.
Otra cosa, en clipper, el cursor aparece en la columna 5, en harbour, 
aparece en la columna 40

This happens in an empty DBF, when the DBF has records, there is no problem.
Another thing, in clipper, the cursor appears in the column 5, in 
harbour, appears in the column 40

3.- Este C?digo funciona bien en Clipper 5.3b, es decir, puedo 
seleccionar una opcion presionando la letra inicial.
3.-This Code works well in Clipper 5.3b, that is to say, I can select an 
option pressing the initial letter.

#include "INKEY.CH"
PROCEDURE main

aMeses := {"Enero ","Febrero ","Marzo ","Abril ","Mayo ","Junio ",;
"Julio ","Agosto ","Setiembre","Octubre ","Noviembre","Diciembre"}
nOpc := 1
CLS
@ 24, 0 SAY PADC("Seleccione el Mes de Trabajo o la primera letra del 
mes, <Esc> para salir",80)
*nOpc := PopMenu(6,35,19,45,aMeses)
nOpc := ACHOICE(6,35,19,45,aMeses)

RETURN

Pero en Harbour, cuando presiono la primera letra, no selecciona la 
opcion que comienza con la letra que presiono en el teclado. No se si me 
explico.
But in Harbour, when I press the first letter, it does not select the 
option that begins with the letter that I press in the keyboard. Not if 
I explain.

4.- En el Depurador, no funcionan las teclas:
4.-In the Purifier, the keys do not work:

F7 To cursor
F9 Breakpoint

Disculpen lo extenso del mail, pero esto es el resultado de varios dias 
sin internet.
Forgive the extensive thing of the mail, but this is the result of 
several days without Internet.

Gracias de Antemano.
TIA

Best Regards
GVS
From myorg63 at mail.ru  Mon Sep 17 01:34:28 2007
From: myorg63 at mail.ru (Petr Chornyj)
Date: Mon Sep 17 01:34:32 2007
Subject: [Harbour] CHANGELOG: 2007-09-14 18:46 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <01c7f78f$Blat.v2.6.1$37a44f0c$ec0405b5bd6@127.0.0.1>
References: <01c7f78f$Blat.v2.6.1$37a44f0c$ec0405b5bd6@127.0.0.1>
Message-ID: <12729610.post@talk.nabble.com>


Hi, Viktor !

Why method Add class Array always returns .t. ?


function main()
local a1 := Array( 3 )
local a2 := hbArray( 3 )
local i AS NUMERIC

for i := 1 to 3
	? AAdd( a1, i)
next i

for i := 1 to 3
	? a2:Add( i )
next i

return 0

1
2
3
.T.
.T.
.T.


Regards,
Petr
-- 
View this message in context: http://www.nabble.com/CHANGELOG%3A-2007-09-14-18%3A46-UTC%2B0100-Viktor-Szakats-%28harbour.01-syenar.hu%29-tf4447536.html#a12729610
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Mon Sep 17 03:16:14 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 03:16:25 2007
Subject: [Harbour] Errores en el tBrowse, HBEditor y Debug
In-Reply-To: <46EDD0D1.6060107@ec-red.com>
References: <46EDD0D1.6060107@ec-red.com>
Message-ID: <493455E9-723A-4380-B8ED-09664BD94391@syenar.hu>

Thanks, I'll fix these.

Brgds,
Viktor

On 2007.09.17., at 2:56, Guillermo Varona Silup? wrote:

> Hola Amigos, reporto los siguientes errores:
> Hello Friends, I report the following mistakes:
>
> 1.- Este C?digo funciona bien en Clipper 5.3b:
> 1.-This Code works well in Clipper 5.3b:
>
> #include "INKEY.CH"
> PROCEDURE main
> LOCAL cCond := "Probando . . . " , cSN:="S"
> CLS
> @ 14,2 TO 22,78; @ 24,0; @ 24,0 SAY '<Ctrl>+W = Salir' COLOR "GR+*/R"
> cCond := MEMOEDIT(cCond,15,3,21,77)
> KEYB CHR(K_ESC); MEMOEDIT(cCond,15,3,21,77,.F.)
> RETURN
>
> Pero en Harbour me da el siguiente error:
> But in Harbour it gives me the following mistake:
>
> Error BASE/42 Scope violation (protected): HBMEMOEDITOR:LEXITEDIT
> Called from HBMEMOEDITOR:LEXITEDIT(0)
> Called from BROWSETEXT(1065)
> Called from HBEDITOR:EDIT(650)
> Called from HBMEMOEDITOR:EDIT(136)
> Called from MEMOEDIT(291)
> Called from MAIN(7)  
> ??????????????????????? 
> ??????????????????????? 
> ??
>
> 2.- Este C?digo funciona bien en Clipper 5.3b.
> 2.-This Code works well in Clipper 5.3b:
>
> #include "INKEY.CH"
> PROCEDURE main
>
> aDbf := {}
> AADD(aDbf, { "Nombre", "C", 25, 0 })
> AADD(aDbf, { "Direccion", "C", 1024, 0 })
> AADD(aDbf, { "Telefono", "N", 13, 0 })
>
> IF !FILE("Agenda.dbf")
> DBCREATE("Agenda", aDbf)
> ENDIF
> USE Agenda
> CLS
>
> bCampo := {|| Nombre+'?'+Direccion+'?'+TRAN(Telefono,'#####')}
> oDbMenu := TBrowseDb(5, 5, 20, 75)
> oDbMenu:AddColumn(TBColumnNew('',bCampo))
>
> DO WHILE .T.
> DO WHILE !oDbMenu:Stabilize() .AND. INKEY()=0; ENDDO
> IF oDbMenu:Stable; nTecla := Inkey(0); ENDIF
> oDbMenu:RefreshCurrent()
> DO CASE
> CASE nTecla = K_DOWN; oDbMenu:Down()
> CASE nTecla = K_UP; oDbMenu:Up()
> CASE nTecla = K_PGUP; oDbMenu:PageUp()
> CASE nTecla = K_PGDN; oDbMenu:PageDown()
> CASE nTecla = K_CTRL_PGUP; oDbMenu:GoTop()
> CASE nTecla = K_CTRL_PGDN; oDbMenu:GoBottom()
> CASE nTecla = K_ESC; EXIT
> CASE nTecla = K_ENTER; EXIT
> ENDCASE
> ENDDO
> RETURN
>
> Pero en Harbour, cuando presiono la tecla hacia abajo y luego  
> Enter, me da el siguiente error:
> But in Harbour, when I press the key down and then Enter, it gives  
> me the following mistake:
>
> Error BASE/1081 Argument error: +
> Called from TBROWSE:STABILIZE(1048)
> Called from MAIN(21)
>
> Esto sucede en un DBF vacio, cuando el DBF tiene registros, no hay  
> problema.
> Otra cosa, en clipper, el cursor aparece en la columna 5, en  
> harbour, aparece en la columna 40
>
> This happens in an empty DBF, when the DBF has records, there is no  
> problem.
> Another thing, in clipper, the cursor appears in the column 5, in  
> harbour, appears in the column 40
>
> 3.- Este C?digo funciona bien en Clipper 5.3b, es decir, puedo  
> seleccionar una opcion presionando la letra inicial.
> 3.-This Code works well in Clipper 5.3b, that is to say, I can  
> select an option pressing the initial letter.
>
> #include "INKEY.CH"
> PROCEDURE main
>
> aMeses := {"Enero ","Febrero ","Marzo ","Abril ","Mayo ","Junio ",;
> "Julio ","Agosto ","Setiembre","Octubre ","Noviembre","Diciembre"}
> nOpc := 1
> CLS
> @ 24, 0 SAY PADC("Seleccione el Mes de Trabajo o la primera letra  
> del mes, <Esc> para salir",80)
> *nOpc := PopMenu(6,35,19,45,aMeses)
> nOpc := ACHOICE(6,35,19,45,aMeses)
>
> RETURN
>
> Pero en Harbour, cuando presiono la primera letra, no selecciona la  
> opcion que comienza con la letra que presiono en el teclado. No se  
> si me explico.
> But in Harbour, when I press the first letter, it does not select  
> the option that begins with the letter that I press in the  
> keyboard. Not if I explain.
>
> 4.- En el Depurador, no funcionan las teclas:
> 4.-In the Purifier, the keys do not work:
>
> F7 To cursor
> F9 Breakpoint
>
> Disculpen lo extenso del mail, pero esto es el resultado de varios  
> dias sin internet.
> Forgive the extensive thing of the mail, but this is the result of  
> several days without Internet.
>
> Gracias de Antemano.
> TIA
>
> Best Regards
> GVS
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Sep 17 03:49:22 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 03:49:34 2007
Subject: [Harbour] Errores en el tBrowse, HBEditor y Debug
In-Reply-To: <46EDD0D1.6060107@ec-red.com>
References: <46EDD0D1.6060107@ec-red.com>
Message-ID: <908B3AAA-3402-475F-A4F5-6F279DA25641@syenar.hu>

Hi Guillermo,

Pls test after you copy over the attached teditor.prg
to the one in repo.

Brgds,
Viktor

-------------- next part --------------
A non-text attachment was scrubbed...
Name: teditor.prg.zip
Type: application/zip
Size: 8574 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20070917/2cbb0689/teditor.prg.zip
-------------- next part --------------

On 2007.09.17., at 2:56, Guillermo Varona Silup? wrote:

> Hola Amigos, reporto los siguientes errores:
> Hello Friends, I report the following mistakes:
>
> 1.- Este C?digo funciona bien en Clipper 5.3b:
> 1.-This Code works well in Clipper 5.3b:
>
> #include "INKEY.CH"
> PROCEDURE main
> LOCAL cCond := "Probando . . . " , cSN:="S"
> CLS
> @ 14,2 TO 22,78; @ 24,0; @ 24,0 SAY '<Ctrl>+W = Salir' COLOR "GR+*/R"
> cCond := MEMOEDIT(cCond,15,3,21,77)
> KEYB CHR(K_ESC); MEMOEDIT(cCond,15,3,21,77,.F.)
> RETURN
>
> Pero en Harbour me da el siguiente error:
> But in Harbour it gives me the following mistake:
>
> Error BASE/42 Scope violation (protected): HBMEMOEDITOR:LEXITEDIT
> Called from HBMEMOEDITOR:LEXITEDIT(0)
> Called from BROWSETEXT(1065)
> Called from HBEDITOR:EDIT(650)
> Called from HBMEMOEDITOR:EDIT(136)
> Called from MEMOEDIT(291)
> Called from MAIN(7)  
> ??????????????????????? 
> ??????????????????????? 
> ??
>
> 2.- Este C?digo funciona bien en Clipper 5.3b.
> 2.-This Code works well in Clipper 5.3b:
>
> #include "INKEY.CH"
> PROCEDURE main
>
> aDbf := {}
> AADD(aDbf, { "Nombre", "C", 25, 0 })
> AADD(aDbf, { "Direccion", "C", 1024, 0 })
> AADD(aDbf, { "Telefono", "N", 13, 0 })
>
> IF !FILE("Agenda.dbf")
> DBCREATE("Agenda", aDbf)
> ENDIF
> USE Agenda
> CLS
>
> bCampo := {|| Nombre+'?'+Direccion+'?'+TRAN(Telefono,'#####')}
> oDbMenu := TBrowseDb(5, 5, 20, 75)
> oDbMenu:AddColumn(TBColumnNew('',bCampo))
>
> DO WHILE .T.
> DO WHILE !oDbMenu:Stabilize() .AND. INKEY()=0; ENDDO
> IF oDbMenu:Stable; nTecla := Inkey(0); ENDIF
> oDbMenu:RefreshCurrent()
> DO CASE
> CASE nTecla = K_DOWN; oDbMenu:Down()
> CASE nTecla = K_UP; oDbMenu:Up()
> CASE nTecla = K_PGUP; oDbMenu:PageUp()
> CASE nTecla = K_PGDN; oDbMenu:PageDown()
> CASE nTecla = K_CTRL_PGUP; oDbMenu:GoTop()
> CASE nTecla = K_CTRL_PGDN; oDbMenu:GoBottom()
> CASE nTecla = K_ESC; EXIT
> CASE nTecla = K_ENTER; EXIT
> ENDCASE
> ENDDO
> RETURN
>
> Pero en Harbour, cuando presiono la tecla hacia abajo y luego  
> Enter, me da el siguiente error:
> But in Harbour, when I press the key down and then Enter, it gives  
> me the following mistake:
>
> Error BASE/1081 Argument error: +
> Called from TBROWSE:STABILIZE(1048)
> Called from MAIN(21)
>
> Esto sucede en un DBF vacio, cuando el DBF tiene registros, no hay  
> problema.
> Otra cosa, en clipper, el cursor aparece en la columna 5, en  
> harbour, aparece en la columna 40
>
> This happens in an empty DBF, when the DBF has records, there is no  
> problem.
> Another thing, in clipper, the cursor appears in the column 5, in  
> harbour, appears in the column 40
>
> 3.- Este C?digo funciona bien en Clipper 5.3b, es decir, puedo  
> seleccionar una opcion presionando la letra inicial.
> 3.-This Code works well in Clipper 5.3b, that is to say, I can  
> select an option pressing the initial letter.
>
> #include "INKEY.CH"
> PROCEDURE main
>
> aMeses := {"Enero ","Febrero ","Marzo ","Abril ","Mayo ","Junio ",;
> "Julio ","Agosto ","Setiembre","Octubre ","Noviembre","Diciembre"}
> nOpc := 1
> CLS
> @ 24, 0 SAY PADC("Seleccione el Mes de Trabajo o la primera letra  
> del mes, <Esc> para salir",80)
> *nOpc := PopMenu(6,35,19,45,aMeses)
> nOpc := ACHOICE(6,35,19,45,aMeses)
>
> RETURN
>
> Pero en Harbour, cuando presiono la primera letra, no selecciona la  
> opcion que comienza con la letra que presiono en el teclado. No se  
> si me explico.
> But in Harbour, when I press the first letter, it does not select  
> the option that begins with the letter that I press in the  
> keyboard. Not if I explain.
>
> 4.- En el Depurador, no funcionan las teclas:
> 4.-In the Purifier, the keys do not work:
>
> F7 To cursor
> F9 Breakpoint
>
> Disculpen lo extenso del mail, pero esto es el resultado de varios  
> dias sin internet.
> Forgive the extensive thing of the mail, but this is the result of  
> several days without Internet.
>
> Gracias de Antemano.
> TIA
>
> Best Regards
> GVS
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Sep 17 04:00:06 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 04:06:20 2007
Subject: [Harbour] CHANGELOG: 2007-09-14 18:46 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <12729610.post@talk.nabble.com>
References: <01c7f78f$Blat.v2.6.1$37a44f0c$ec0405b5bd6@127.0.0.1>
	<12729610.post@talk.nabble.com>
Message-ID: <0F6A6C02-C1D2-4A40-8D79-0A38D38A631F@syenar.hu>

Hi Petr,

I think the class is there to give similar functionality
to Class(y)'s scalar classes.

Class(y) also returns .T. in this case.

The name of the class function is different though in Harbour
(HBArray() as opposed to CsyArray() and we're not even consistent
in this in Harbour, which I think we should fix.) (Also in Class(y)
CsyArray( x ) would not work, just CsyArray:New( x ), but we're
backwards compatible.)

So I propose to fix the type class function names consistently to:
HBCharacter()
HBLogical()
HBDate()
etc...

Brgds,
Viktor

On 2007.09.17., at 7:34, Petr Chornyj wrote:

>
> Hi, Viktor !
>
> Why method Add class Array always returns .t. ?
>
>
> function main()
> local a1 := Array( 3 )
> local a2 := hbArray( 3 )
> local i AS NUMERIC
>
> for i := 1 to 3
> 	? AAdd( a1, i)
> next i
>
> for i := 1 to 3
> 	? a2:Add( i )
> next i
>
> return 0
>
> 1
> 2
> 3
> .T.
> .T.
> .T.
>
>
> Regards,
> Petr
> --  
> View this message in context: http://www.nabble.com/CHANGELOG% 
> 3A-2007-09-14-18%3A46-UTC%2B0100-Viktor-Szakats-%28harbour.01- 
> syenar.hu%29-tf4447536.html#a12729610
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Mon Sep 17 06:18:41 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 17 06:18:48 2007
Subject: [Harbour] CHANGELOG: 2007-09-14 18:46 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <0F6A6C02-C1D2-4A40-8D79-0A38D38A631F@syenar.hu>
References: <01c7f78f$Blat.v2.6.1$37a44f0c$ec0405b5bd6@127.0.0.1>
	<12729610.post@talk.nabble.com>
	<0F6A6C02-C1D2-4A40-8D79-0A38D38A631F@syenar.hu>
Message-ID: <20070917101841.GA27263@localhost.localdomain>

On Mon, 17 Sep 2007, Szak?ts Viktor wrote:
> Hi Petr,
> I think the class is there to give similar functionality
> to Class(y)'s scalar classes.
> Class(y) also returns .T. in this case.
> The name of the class function is different though in Harbour
> (HBArray() as opposed to CsyArray() and we're not even consistent
> in this in Harbour, which I think we should fix.) (Also in Class(y)
> CsyArray( x ) would not work, just CsyArray:New( x ), but we're
> backwards compatible.)
> So I propose to fix the type class function names consistently to:
> HBCharacter()
> HBLogical()
> HBDate()
> etc...

In source/rtl we have:
    array.prg, block.prg, characte.prg, date.prg, logical.prg, nil.prg,
    numeric.prg, scalar.prg
but as I can see they never worked like in Class(y).
In Class(y) it's not necessary to call class function for scalar
classes. Just simply scalar classes define behavior for basic types.
So instead of calling:
    a:=hbArray():new(5)
you simply make:
    a:=array(6)
and then you can make:
    ? a:AsString()
I'll add support for scalar classes and they will work for basic
types so please remember that we can change class function name
(hbCharacter(), hbLogical(), etc. seems to be good idea for me)
but we should not touch class name which should be the same as
in basic types because it will be used to recognize it.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 17 06:28:30 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 06:28:29 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 12:25 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f915$Blat.v2.6.1$7dd6fa7e$13c8fa311f1e@127.0.0.1>

2007-09-17 12:25 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * common.mak
   + source/rtl/tbrowsys.prg
   * source/rtl/Makefile
   * source/rtl/getsys.prg
   * source/rtl/tbrowse.prg
     + Added new file for C5.3 TB*() functions.
       Most of them is dummy, a few of them were moved 
       here from existing files.

   * include/hbextern.ch
     + Added rest of C5.3 TB*() functions.

   * source/rtl/teditor.prg
     ! Fixed new scope violations reported by Guillermo.

   * source/rtl/tbrowse.prg
     + :border implemented (to be tested).
     ! :setColumn() return value fixed, NOTE added.
     ! Non-character :picture handled properly.
       (to be tested for full compatibility)
     % Some optimizations.
     - :TApplyKey() removed (it is not a C5.3 method)
     ; Some source cleanup and other changes.
     ; Work in progress.

   * include/hbextern.ch
   * common.mak
   * source/rtl/Makefile
   + source/rtl/tscalar.prg
   - source/rtl/array.prg
   - source/rtl/block.prg
   - source/rtl/characte.prg
   - source/rtl/date.prg
   - source/rtl/logical.prg
   - source/rtl/nil.prg
   - source/rtl/numeric.prg
   - source/rtl/scalar.prg
     + Consolidated scalar classes to one file.
     + Minor optimizations and cleanup done on files.
     + Class function names now consistently HB*()
       (was non-Class(y) compatible and a mixed list 
       of plain unprefixed class names and class names 
       prefixed with an underscore). Notice however that 
       Class(y) has only CsyArray() defined in its own 
       library, the rest was seemingly made only 
       available as additional source code.
     ! Fixed NIL class to be named NIL (was _NIL).
     % Some unneeded MESSAGE redirections removed.
     % LOCAL var[0] -> LOCAL var := {}. This results 
       in better pcode.
     + Added all these symbols to hbextern.ch

   * source/rtl/symbol.prg
     * Some cleanup.
     ; I believe this should be named HBSymbol() and 
       added to hbextern.ch

From harbour.01 at syenar.hu  Mon Sep 17 06:28:47 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 06:28:56 2007
Subject: [Harbour] CHANGELOG: 2007-09-14 18:46 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070917101841.GA27263@localhost.localdomain>
References: <01c7f78f$Blat.v2.6.1$37a44f0c$ec0405b5bd6@127.0.0.1>
	<12729610.post@talk.nabble.com>
	<0F6A6C02-C1D2-4A40-8D79-0A38D38A631F@syenar.hu>
	<20070917101841.GA27263@localhost.localdomain>
Message-ID: <FFC8E313-E01F-4185-A86B-A80472E4EC38@syenar.hu>

> In source/rtl we have:
>     array.prg, block.prg, characte.prg, date.prg, logical.prg,  
> nil.prg,
>     numeric.prg, scalar.prg
> but as I can see they never worked like in Class(y).
> In Class(y) it's not necessary to call class function for scalar
> classes. Just simply scalar classes define behavior for basic types.
> So instead of calling:
>     a:=hbArray():new(5)
> you simply make:
>     a:=array(6)
> and then you can make:
>     ? a:AsString()
> I'll add support for scalar classes and they will work for basic
> types so please remember that we can change class function name
> (hbCharacter(), hbLogical(), etc. seems to be good idea for me)

Yes, that explains. I'll commit the consolidation in a few
minutes, however hard I tried to find out any explicit
function names there is nothing in the final Class(y) lib,
only in the source code provided in the package, with "csy"
prefixes.

> but we should not touch class name which should be the same as
> in basic types because it will be used to recognize it.

I've changed "_Nil" to "NIL", but if I understand correctly
the old one was wrong.

Brgds,
Viktor


From harbour.01 at syenar.hu  Mon Sep 17 06:35:18 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 06:35:15 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 12:34 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f916$Blat.v2.6.1$71047424$157c52d9e460@127.0.0.1>

2007-09-17 12:34 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/tscalar.prg
     ! Some fixes for previous commit regarding scalar classes.

From e.m.giordano at emagsoftware.it  Mon Sep 17 06:51:45 2007
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Sep 17 06:51:57 2007
Subject: [Harbour] Error in latest SVN
Message-ID: <02bb01c7f918$c0422480$ca64fea9@emag>

Fatal: 'obj\b32\tbrowsys.obj' does not exist - don't know how to make it

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic
From druzus at priv.onet.pl  Mon Sep 17 07:07:19 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 17 07:07:25 2007
Subject: [Harbour] necessary cleanup
Message-ID: <20070917110719.GB27263@localhost.localdomain>

Viktor some small notes about last commits:
   + source/rtl/tbrowsys.prg
was not added to SVN repository and all files you added:
   + source/rtl/tscalar.prg
   + tests/rto_tb.prg
   + source/rtl/gui.prg
   + source/rtl/menusys.prg
   + source/rtl/tmenusys.prg
use CRLF EOLs instead of 'native' ones.

If we decided to keep all scalar classes in one file then
please remember that we should change the initialization code.
Some linker will not allow to overload only single function
from compiled module and keep the rest. In such case I suggest
to declare scalar class functions as static and create one
initialization function, f.e. __InitScalar() executed from
at HVM startup which will register all scalar classes.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 17 07:27:21 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 07:27:17 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 13:26 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f91d$Blat.v2.6.1$b6760d4a$12ec1629e24@127.0.0.1>

2007-09-17 13:26 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * tests/rto_get.prg
   * tests/rto_tb.prg
   * source/rtl/gui.prg
   + source/rtl/tbrowsys.prg
   * source/rtl/tmenusys.prg
   * source/rtl/menusys.prg
   * source/rtl/tscalar.prg
   * source/rtl/tbrowse.prg
     + Added missing file from previous commit.
     + Set Id keyword and eol-style to native on newly added files.

From lorenzo.fiorini at gmail.com  Mon Sep 17 07:30:39 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Sep 17 07:30:43 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 12:25 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <01c7f915$Blat.v2.6.1$7dd6fa7e$13c8fa311f1e@127.0.0.1>
References: <01c7f915$Blat.v2.6.1$7dd6fa7e$13c8fa311f1e@127.0.0.1>
Message-ID: <9257026e0709170430k6f236844v4b6eb1d9a0c78714@mail.gmail.com>

On 9/17/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> 2007-09-17 12:25 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>    * common.mak
>    + source/rtl/tbrowsys.prg
>    * source/rtl/Makefile
>    * source/rtl/getsys.prg
>    * source/rtl/tbrowse.prg
>      + Added new file for C5.3 TB*() functions.
>        Most of them is dummy, a few of them were moved
>        here from existing files.

Is this really necessary? :)

Please remember I'm using xHarbour's tbrowse.prg and this will enlarge
my diffs while I'm trying to keep as small as possible.

best regards,
Lorenzo
From harbour.01 at syenar.hu  Mon Sep 17 07:29:43 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 07:37:01 2007
Subject: [Harbour] necessary cleanup
In-Reply-To: <20070917110719.GB27263@localhost.localdomain>
References: <20070917110719.GB27263@localhost.localdomain>
Message-ID: <E08D312A-1358-4269-AB53-C48B1A6989F4@syenar.hu>

> Viktor some small notes about last commits:
>    + source/rtl/tbrowsys.prg
> was not added to SVN repository and all files you added:
>    + source/rtl/tscalar.prg
>    + tests/rto_tb.prg
>    + source/rtl/gui.prg
>    + source/rtl/menusys.prg
>    + source/rtl/tmenusys.prg
> use CRLF EOLs instead of 'native' ones.
>
> If we decided to keep all scalar classes in one file then
> please remember that we should change the initialization code.
> Some linker will not allow to overload only single function
> from compiled module and keep the rest. In such case I suggest
> to declare scalar class functions as static and create one
> initialization function, f.e. __InitScalar() executed from
> at HVM startup which will register all scalar classes.

Hm, I'd rather prefer splitting them again, but giving
them some more consistent filenames, like tscalr?.prg
where ? is the type ID (except for Integer, if we once
implement it).

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Sep 17 07:40:03 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 07:40:12 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 12:25 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <9257026e0709170430k6f236844v4b6eb1d9a0c78714@mail.gmail.com>
References: <01c7f915$Blat.v2.6.1$7dd6fa7e$13c8fa311f1e@127.0.0.1>
	<9257026e0709170430k6f236844v4b6eb1d9a0c78714@mail.gmail.com>
Message-ID: <E86BFB17-6E8C-4295-BAC2-CDCD3167D910@syenar.hu>

Hi Lorenzo,

On 2007.09.17., at 13:30, Lorenzo Fiorini wrote:

> On 9/17/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
>
>> 2007-09-17 12:25 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>>    * common.mak
>>    + source/rtl/tbrowsys.prg
>>    * source/rtl/Makefile
>>    * source/rtl/getsys.prg
>>    * source/rtl/tbrowse.prg
>>      + Added new file for C5.3 TB*() functions.
>>        Most of them is dummy, a few of them were moved
>>        here from existing files.
>
> Is this really necessary? :)
>
> Please remember I'm using xHarbour's tbrowse.prg and this will enlarge
> my diffs while I'm trying to keep as small as possible.

Does it solves the problem if I move TBMOUSE() back to tbrowse.prg?

I've been thinking about this to not include the whole TB*() bloat
by using TBrowse().

BTW, does anyone know what is the purpose of these functions,
and (where) are they documented? The only place I've found is
reserved.ch of C5.3.

Brgds,
Viktor

From druzus at priv.onet.pl  Mon Sep 17 08:32:56 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 17 08:33:03 2007
Subject: [Harbour] necessary cleanup
In-Reply-To: <E08D312A-1358-4269-AB53-C48B1A6989F4@syenar.hu>
References: <20070917110719.GB27263@localhost.localdomain>
	<E08D312A-1358-4269-AB53-C48B1A6989F4@syenar.hu>
Message-ID: <20070917123256.GA29913@localhost.localdomain>

On Mon, 17 Sep 2007, Szak?ts Viktor wrote:
> >Some linker will not allow to overload only single function
> >from compiled module and keep the rest. In such case I suggest
> >to declare scalar class functions as static and create one
> >initialization function, f.e. __InitScalar() executed from
> >at HVM startup which will register all scalar classes.
> Hm, I'd rather prefer splitting them again, but giving
> them some more consistent filenames, like tscalr?.prg
> where ? is the type ID (except for Integer, if we once
> implement it).

When classy code is activated (it happens when VM sends 1-st message)
then it checks which csy<TYPENAME>() functions have been linked and
executes all found ones. If any of csy<TYPENAME>() function returns
valid class object then it's registered otherwise default implementation
is used - in practice the code from ScalarObject class. Only ARRAY class
has extended functionality to ScalarObject class so it's a part of
classy.lib.
So we also do not need to keep separated implementation of all scalar
classes in RTL library but we can use default one.
Anyhow we will need to initialize this classes automatically. I do not
like the idea of initialization when 1-st message is called and I'd
rather prefer to make some more explicit initialization at HVM startup.
Then we will have to execute class functions so it will be necessary to
define some strict names if we chose class(y) like initialization.
It means that hb<TYPENAME>() will be reserved for HVM and should not
be used for any other thing. As alternative we can define that some
classes names are reserved for basic types and when user code will
register such class at any moment then it will be used as scalar
class for basic item type with the same name. The 3-rd method is
using some different syntax for scalar classes so they will be
registered in different way then other classes. Personally I do not
like it.
In summary before you will make some modifications in file locations
and split/join code in different files then it will be good to chose
the method of scalar classes definition/initialization because it
will interact with these modifications.

HTH,

best regards,
Przemek
From e.m.giordano at emagsoftware.it  Mon Sep 17 08:40:21 2007
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Sep 17 08:41:03 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 13:26 UTC+0100 Viktor
	Szakats(harbour.01 syenar.hu)
References: <01c7f91d$Blat.v2.6.1$b6760d4a$12ec1629e24@127.0.0.1>
Message-ID: <004b01c7f927$febb0a60$ca64fea9@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: <harbour@harbour-project.org>
Data invio: luned? 17 settembre 2007 13.27
Oggetto: [Harbour] CHANGELOG: 2007-09-17 13:26 UTC+0100 Viktor 
Szakats(harbour.01 syenar.hu)


> 2007-09-17 13:26 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>   * tests/rto_get.prg
>   * tests/rto_tb.prg
>   * source/rtl/gui.prg
>   + source/rtl/tbrowsys.prg
>   * source/rtl/tmenusys.prg
>   * source/rtl/menusys.prg
>   * source/rtl/tscalar.prg
>   * source/rtl/tbrowse.prg
>     + Added missing file from previous commit.
>     + Set Id keyword and eol-style to native on newly added files.

Thank you.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From e.m.giordano at emagsoftware.it  Mon Sep 17 08:40:57 2007
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Sep 17 08:41:05 2007
Subject: [Harbour] Warning in latest SVN
Message-ID: <004c01c7f927$ff53a0e0$ca64fea9@emag>

Warning: public '_HB_FUN_TBAPPLYKEY' in module 'tbrowsys' clashes with prior 
module 'getsys'

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From e.m.giordano at emagsoftware.it  Mon Sep 17 08:46:50 2007
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Sep 17 08:46:55 2007
Subject: [Harbour] Bug in TBrowse
Message-ID: <005401c7f928$d1039730$ca64fea9@emag>

This is the sample:

FUNCTION MAIN()

    SETMODE( 25, 80 )

    USE TEST

    BROWSE()

    CLOSE

    RETURN NIL

Just try to press PageDown and keep pressing it till the bottom of file. 
Then press PageUp and you will see a strange behavior of the row color.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Mon Sep 17 09:24:06 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 09:24:19 2007
Subject: [Harbour] Bug in TBrowse
In-Reply-To: <005401c7f928$d1039730$ca64fea9@emag>
References: <005401c7f928$d1039730$ca64fea9@emag>
Message-ID: <F9573F97-2A43-4926-A4EA-0685FC73B617@syenar.hu>

Hi,

Yes, this is an old bug, I'll look into it.

Brgds,
Viktor

On 2007.09.17., at 14:46, Enrico Maria Giordano wrote:

> This is the sample:
>
> FUNCTION MAIN()
>
>    SETMODE( 25, 80 )
>
>    USE TEST
>
>    BROWSE()
>
>    CLOSE
>
>    RETURN NIL
>
> Just try to press PageDown and keep pressing it till the bottom of  
> file. Then press PageUp and you will see a strange behavior of the  
> row color.
>
> EMG
>
> --
> EMAG Software Homepage:     http://www.emagsoftware.it
> The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
> The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
> The EMG Music page:         http://www.emagsoftware.it/emgmusic
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Sep 17 09:26:06 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 09:26:15 2007
Subject: [Harbour] Warning in latest SVN
In-Reply-To: <004c01c7f927$ff53a0e0$ca64fea9@emag>
References: <004c01c7f927$ff53a0e0$ca64fea9@emag>
Message-ID: <D3E982E0-F31B-4BBA-910A-9B6FF56BD09A@syenar.hu>

Thanks, fixed. I moved this back to getsys.prg to avoid bloat
(just like for TBMouse()).

Brgds,
Viktor

On 2007.09.17., at 14:40, Enrico Maria Giordano wrote:

> Warning: public '_HB_FUN_TBAPPLYKEY' in module 'tbrowsys' clashes  
> with prior module 'getsys'
>
> EMG
>
> --
> EMAG Software Homepage:     http://www.emagsoftware.it
> The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
> The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
> The EMG Music page:         http://www.emagsoftware.it/emgmusic
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From gvarona at ec-red.com  Mon Sep 17 09:46:23 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Mon Sep 17 09:40:18 2007
Subject: [Harbour] Errores en el tBrowse, HBEditor y Debug
In-Reply-To: <908B3AAA-3402-475F-A4F5-6F279DA25641@syenar.hu>
References: <46EDD0D1.6060107@ec-red.com>
	<908B3AAA-3402-475F-A4F5-6F279DA25641@syenar.hu>
Message-ID: <46EE852F.80708@ec-red.com>

Szak?ts Viktor escribi?:

> Pls test after you copy over the attached teditor.prg
> to the one in repo.

Thanks Viktor, Tested and solved.

I've tested with:

/*
 * $Id: ChangeLog 7763 2007-09-17 11:27:09Z vszakats $
 */

>> 1.- Este C?digo funciona bien en Clipper 5.3b:
>> 1.-This Code works well in Clipper 5.3b:
>>
>> #include "INKEY.CH"
>> PROCEDURE main
>> LOCAL cCond := "Probando . . . " , cSN:="S"
>> CLS
>> @ 14,2 TO 22,78; @ 24,0; @ 24,0 SAY '<Ctrl>+W = Salir' COLOR "GR+*/R"
>> cCond := MEMOEDIT(cCond,15,3,21,77)
>> KEYB CHR(K_ESC); MEMOEDIT(cCond,15,3,21,77,.F.)
>> RETURN
>>
>> Pero en Harbour me da el siguiente error:
>> But in Harbour it gives me the following mistake:
>>
>> Error BASE/42 Scope violation (protected): HBMEMOEDITOR:LEXITEDIT
>> Called from HBMEMOEDITOR:LEXITEDIT(0)
>> Called from BROWSETEXT(1065)
>> Called from HBEDITOR:EDIT(650)
>> Called from HBMEMOEDITOR:EDIT(136)
>> Called from MEMOEDIT(291)
>> Called from MAIN(7)
>
Solved!!!

>> 2.- Este C?digo funciona bien en Clipper 5.3b.
>> 2.-This Code works well in Clipper 5.3b:
>>
>> #include "INKEY.CH"
>> PROCEDURE main
>>
>> aDbf := {}
>> AADD(aDbf, { "Nombre", "C", 25, 0 })
>> AADD(aDbf, { "Direccion", "C", 1024, 0 })
>> AADD(aDbf, { "Telefono", "N", 13, 0 })
>>
>> IF !FILE("Agenda.dbf")
>> DBCREATE("Agenda", aDbf)
>> ENDIF
>> USE Agenda
>> CLS
>>
>> bCampo := {|| Nombre+'?'+Direccion+'?'+TRAN(Telefono,'#####')}
>> oDbMenu := TBrowseDb(5, 5, 20, 75)
>> oDbMenu:AddColumn(TBColumnNew('',bCampo))
>>
>> DO WHILE .T.
>> DO WHILE !oDbMenu:Stabilize() .AND. INKEY()=0; ENDDO
>> IF oDbMenu:Stable; nTecla := Inkey(0); ENDIF
>> oDbMenu:RefreshCurrent()
>> DO CASE
>> CASE nTecla = K_DOWN; oDbMenu:Down()
>> CASE nTecla = K_UP; oDbMenu:Up()
>> CASE nTecla = K_PGUP; oDbMenu:PageUp()
>> CASE nTecla = K_PGDN; oDbMenu:PageDown()
>> CASE nTecla = K_CTRL_PGUP; oDbMenu:GoTop()
>> CASE nTecla = K_CTRL_PGDN; oDbMenu:GoBottom()
>> CASE nTecla = K_ESC; EXIT
>> CASE nTecla = K_ENTER; EXIT
>> ENDCASE
>> ENDDO
>> RETURN
>>
>> Pero en Harbour, cuando presiono la tecla hacia abajo y luego  Enter, 
>> me da el siguiente error:
>> But in Harbour, when I press the key down and then Enter, it gives  
>> me the following mistake:
>>
>> Error BASE/1081 Argument error: +
>> Called from TBROWSE:STABILIZE(1048)
>> Called from MAIN(21)
>>
>> Esto sucede en un DBF vacio, cuando el DBF tiene registros, no hay  
>> problema.
>> Otra cosa, en clipper, el cursor aparece en la columna 5, en  
>> harbour, aparece en la columna 40
>>
>> This happens in an empty DBF, when the DBF has records, there is no  
>> problem.
>> Another thing, in clipper, the cursor appears in the column 5, in  
>> harbour, appears in the column 40
>
Solucionado parcialmente.
La columna ya esta bien.
Pero, a?n sigue saliendo el error:
Error BASE/1081  Argument error: +
Called from TBROWSE:STABILIZE(1116)
Called from MAIN(23)

IN ENGLISH
It solved partly. 
The column already this well. 
But, still continues leaving the error: 
Error BASE/1081  Argument error: +
Called from TBROWSE:STABILIZE(1116)
Called from MAIN(23)

>> 3.- Este C?digo funciona bien en Clipper 5.3b, es decir, puedo  
>> seleccionar una opcion presionando la letra inicial.
>> 3.-This Code works well in Clipper 5.3b, that is to say, I can  
>> select an option pressing the initial letter.
>>
>> #include "INKEY.CH"
>> PROCEDURE main
>>
>> aMeses := {"Enero ","Febrero ","Marzo ","Abril ","Mayo ","Junio ",;
>> "Julio ","Agosto ","Setiembre","Octubre ","Noviembre","Diciembre"}
>> nOpc := 1
>> CLS
>> @ 24, 0 SAY PADC("Seleccione el Mes de Trabajo o la primera letra  
>> del mes, <Esc> para salir",80)
>> *nOpc := PopMenu(6,35,19,45,aMeses)
>> nOpc := ACHOICE(6,35,19,45,aMeses)
>>
>> RETURN
>>
>> Pero en Harbour, cuando presiono la primera letra, no selecciona la  
>> opcion que comienza con la letra que presiono en el teclado. No se  
>> si me explico.
>> But in Harbour, when I press the first letter, it does not select  
>> the option that begins with the letter that I press in the  keyboard. 
>> Not if I explain.
>
Solved!

>> 4.- En el Depurador, no funcionan las teclas:
>> 4.-In the Purifier, the keys do not work:
>>
>> F7 To cursor
>> F9 Breakpoint
>
Cuando compilo con el depurador obtengo este mensaje de error :
When I compile with the debugger I obtain this error message: 

    ==> Linking to make C:\CLIP53\SOURCE\SAMPLE\getgvs.EXE ...
C:\MinGW\BIN\GCC.EXE -Wall -mno-cygwin 
-oC:\CLIP53\SOURCE\SAMPLE\getgvs.EXE -LC:\hmg\lib -LC:\HARBOU~1\lib 
-LC:\MinGW\lib C:\CLIP53\SOURCE\SAMPLE\OBJM2GH\getgvs.o -mconsole 
-Wl,--start-group -lMinigui -lgtwin -lhbsix -lvm -lrdd -lmacro -lpp 
-lrtl -llang -lcommon -lnulsys -ldbfntx -ldbfcdx -ldbffpt -luser32 
-lwinspool -lcomctl32 -lcomdlg32 -lgdi32 -lole32 -loleaut32 -luuid 
-lwinmm -lvfw32 -lwsock32 -lct -lmisc -lgraph -ledit -lreport -lini 
-leditex -lcrypt -lhbole -lregistry -lcodepage -ldebug -lhsx -lrddads 
-lstdc++ -Wl,--end-group
C:\HARBOU~1\lib/librtl.a(tbrowsys.o)(.text+0xad):tbrowsys.c: multiple 
definition of `HB_FUN_TBAPPLYKEY'
C:\HARBOU~1\lib/librtl.a(getsys.o)(.text+0x29a):getsys.c: first defined here
collect2: ld returned 1 exit status

deleting C:\CLIP53\SOURCE\SAMPLE\getgvs.EXE

Si compilo sin el depurador  funciona bien.
If I compile without the debugger functions well. 

Best Regards.
GVS

From e.m.giordano at emagsoftware.it  Mon Sep 17 09:45:19 2007
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Sep 17 09:45:25 2007
Subject: [Harbour] Bug in TBrowse
References: <005401c7f928$d1039730$ca64fea9@emag>
	<F9573F97-2A43-4926-A4EA-0685FC73B617@syenar.hu>
Message-ID: <00db01c7f930$fc9fdc70$ca64fea9@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: luned? 17 settembre 2007 15.24
Oggetto: Re: [Harbour] Bug in TBrowse


> Hi,
>
> Yes, this is an old bug, I'll look into it.

Thank you.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From e.m.giordano at emagsoftware.it  Mon Sep 17 10:39:34 2007
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Sep 17 10:39:46 2007
Subject: [Harbour] Warning in latest SVN
References: <004c01c7f927$ff53a0e0$ca64fea9@emag>
	<D3E982E0-F31B-4BBA-910A-9B6FF56BD09A@syenar.hu>
Message-ID: <018601c7f938$908d1b80$ca64fea9@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: luned? 17 settembre 2007 15.26
Oggetto: Re: [Harbour] Warning in latest SVN


> Thanks, fixed. I moved this back to getsys.prg to avoid bloat
> (just like for TBMouse()).

Thank you. I still don't see your fix on the SVN. Did you already uploaded 
it?

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Mon Sep 17 10:28:03 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 12:27:44 2007
Subject: [Harbour] necessary cleanup
In-Reply-To: <20070917123256.GA29913@localhost.localdomain>
References: <20070917110719.GB27263@localhost.localdomain>
	<E08D312A-1358-4269-AB53-C48B1A6989F4@syenar.hu>
	<20070917123256.GA29913@localhost.localdomain>
Message-ID: <D2169EA1-90B2-4868-B2D0-C42701AE7643@syenar.hu>

Okey, not being a Class(y) user I cannot comment pro or
contra on your proposed methods. I'll hold any changes
regarding those classes until we decide.

For those who do need this feature (Antonio ?), pls comment.

Brgds,
Viktor

On 2007.09.17., at 14:32, Przemyslaw Czerpak wrote:

> On Mon, 17 Sep 2007, Szak?ts Viktor wrote:
>>> Some linker will not allow to overload only single function
>>> from compiled module and keep the rest. In such case I suggest
>>> to declare scalar class functions as static and create one
>>> initialization function, f.e. __InitScalar() executed from
>>> at HVM startup which will register all scalar classes.
>> Hm, I'd rather prefer splitting them again, but giving
>> them some more consistent filenames, like tscalr?.prg
>> where ? is the type ID (except for Integer, if we once
>> implement it).
>
> When classy code is activated (it happens when VM sends 1-st message)
> then it checks which csy<TYPENAME>() functions have been linked and
> executes all found ones. If any of csy<TYPENAME>() function returns
> valid class object then it's registered otherwise default  
> implementation
> is used - in practice the code from ScalarObject class. Only ARRAY  
> class
> has extended functionality to ScalarObject class so it's a part of
> classy.lib.
> So we also do not need to keep separated implementation of all scalar
> classes in RTL library but we can use default one.
> Anyhow we will need to initialize this classes automatically. I do not
> like the idea of initialization when 1-st message is called and I'd
> rather prefer to make some more explicit initialization at HVM  
> startup.
> Then we will have to execute class functions so it will be  
> necessary to
> define some strict names if we chose class(y) like initialization.
> It means that hb<TYPENAME>() will be reserved for HVM and should not
> be used for any other thing. As alternative we can define that some
> classes names are reserved for basic types and when user code will
> register such class at any moment then it will be used as scalar
> class for basic item type with the same name. The 3-rd method is
> using some different syntax for scalar classes so they will be
> registered in different way then other classes. Personally I do not
> like it.
> In summary before you will make some modifications in file locations
> and split/join code in different files then it will be good to chose
> the method of scalar classes definition/initialization because it
> will interact with these modifications.
>
> HTH,
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Sep 17 12:42:55 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 12:42:54 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 18:41 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f949$Blat.v2.6.1$cc1dc882$143097cf014e@127.0.0.1>

2007-09-17 18:41 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/tbrowsys.prg
   * source/rtl/getsys.prg
   * source/rtl/tbrowse.prg
     ! Some rearrangements to avoid including the C5.3 
       compatible (and yet to be implemented) bloat in tbrowsys.prg

From e.m.giordano at emagsoftware.it  Mon Sep 17 13:49:18 2007
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Sep 17 13:49:22 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 18:41 UTC+0100 Viktor
	Szakats(harbour.01 syenar.hu)
References: <01c7f949$Blat.v2.6.1$cc1dc882$143097cf014e@127.0.0.1>
Message-ID: <001a01c7f953$11e87fc0$ca64fea9@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: <harbour@harbour-project.org>
Data invio: luned? 17 settembre 2007 18.42
Oggetto: [Harbour] CHANGELOG: 2007-09-17 18:41 UTC+0100 Viktor 
Szakats(harbour.01 syenar.hu)


> 2007-09-17 18:41 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>   * source/rtl/tbrowsys.prg
>   * source/rtl/getsys.prg
>   * source/rtl/tbrowse.prg
>     ! Some rearrangements to avoid including the C5.3
>       compatible (and yet to be implemented) bloat in tbrowsys.prg

Thank you.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Mon Sep 17 18:43:22 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 18:43:32 2007
Subject: [Harbour] Errores en el tBrowse, HBEditor y Debug
In-Reply-To: <46EE852F.80708@ec-red.com>
References: <46EDD0D1.6060107@ec-red.com>
	<908B3AAA-3402-475F-A4F5-6F279DA25641@syenar.hu>
	<46EE852F.80708@ec-red.com>
Message-ID: <8F04EB1F-A391-419B-878F-CDFA612F98F6@syenar.hu>

Sorry, I missed this TBrowse() report of yours completely.

Since we will have quite many changes, let's review
this after them to see what happened.

Brgds,
Viktor

>>> #include "INKEY.CH"
>>> PROCEDURE main
>>>
>>> aDbf := {}
>>> AADD(aDbf, { "Nombre", "C", 25, 0 })
>>> AADD(aDbf, { "Direccion", "C", 1024, 0 })
>>> AADD(aDbf, { "Telefono", "N", 13, 0 })
>>>
>>> IF !FILE("Agenda.dbf")
>>> DBCREATE("Agenda", aDbf)
>>> ENDIF
>>> USE Agenda
>>> CLS
>>>
>>> bCampo := {|| Nombre+'?'+Direccion+'?'+TRAN(Telefono,'#####')}
>>> oDbMenu := TBrowseDb(5, 5, 20, 75)
>>> oDbMenu:AddColumn(TBColumnNew('',bCampo))
>>>
>>> DO WHILE .T.
>>> DO WHILE !oDbMenu:Stabilize() .AND. INKEY()=0; ENDDO
>>>
>>> But in Harbour, when I press the key down and then Enter, it  
>>> gives  me the following mistake:
>>>
>>> Error BASE/1081 Argument error: +
>>> Called from TBROWSE:STABILIZE(1048)
>>> Called from MAIN(21)
>>>
>>> This happens in an empty DBF, when the DBF has records, there is  
>>> no  problem.
>>> Another thing, in clipper, the cursor appears in the column 5,  
>>> in  harbour, appears in the column 40
>>
> It solved partly. The column already this well. But, still  
> continues leaving the error: Error BASE/1081  Argument error: +
> Called from TBROWSE:STABILIZE(1116)
> Called from MAIN(23)

From druzus at priv.onet.pl  Mon Sep 17 18:45:12 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 17 18:45:20 2007
Subject: [Harbour] ChangeLog 2007-09-18 00:45 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070917224512.GA26492@localhost.localdomain>

2007-09-18 00:45 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbapicls.h
  * harbour/source/vm/hvm.c
    + added hb_clsDoInit() function to initialize classy .prg functions

  * harbour/source/compiler/complex.c
    * allow to use NIL as class name

  * harbour/source/compiler/harbour.yyc
  * harbour/source/compiler/harbour.y
  * harbour/source/compiler/harbour.yyh
    % optimize automatically var[0] declaration and generate the same
      PCODE as for var:={}

  * harbour/source/rtl/tscalar.prg
    + added HASH, POINTER and SYMBOL scalar classes
    * changed NIL class to not use any instance variables

  * harbour/source/vm/classes.c
    + added support for scalar classes. Now at startup classy code looks
      for hb<TYPENAME> functions and try to execute them to register
      scalar classes. It's Class(y) compatible behavior and only the prefix
      of scalar ceases class function is different: 'CSY' in class(y) and
      'HB' in Harbour, f.e.: hbNumeric()
      If you prefer xHarbour like not automatic scalar class registration
      with some PP commands:
         ASSOCIATE CLASS <ClassName> WITH TYPE
                           ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                           NUMERIC|POINTER|SYMBOL
         ENABLE CLASS TYPE ALL
         ENABLE TYPE CLASS ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                           NUMERIC|POINTER|SYMBOL
         EXTEND [TYPE] ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                       NUMERIC|POINTER|SYMBOL WITH METHOD <SomeFunc>
      Then I can replace current code with it. If not then we should
      divide scalar cases definitions into separated files to allow
      easier overloading. I'm interesting in your opinions.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 17 20:05:59 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 17 20:05:57 2007
Subject: [Harbour] CHANGELOG: 2007-09-17 18:41 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7f987$Blat.v2.6.1$b18e07c8$a5c538f41e0@127.0.0.1>

2007-09-17 18:41 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rtl/tbrowsys.prg
   * source/rtl/getsys.prg
   * source/rtl/tbrowse.prg
     ! Some rearrangements to avoid including the C5.3 
       compatible (and yet to be implemented) bloat in tbrowsys.prg

Brgds,
Viktor

From soporte at dsgsoftware.com  Tue Sep 18 05:17:23 2007
From: soporte at dsgsoftware.com (=?iso-8859-1?Q?Juan_G=E1lvez?=)
Date: Tue Sep 18 05:17:42 2007
Subject: [Harbour] Ole2 contrib buggy ?
Message-ID: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>

Hi all,

I'm testing my current xHarbour / FWH app with Harbour and I get a lot of 
memory leaks when I exit from it.

I use an activeX control which makes use of a TOleAuto object (::oDisp). I 
suspect the problem occurs from the error handler of my TActiveX class :

METHOD OnError( ... ) CLASS TActiveX

   LOCAL cMethod := __GetMessage()

   IF Left( cMethod, 1 ) == "_"
      cMethod := SubStr( cMethod, 2 )
   ENDIF

RETURN HB_ExecFromArray( ::oDisp, cMethod, HB_aParams() )

Any ideas ?

Many thanks
Juan 

From druzus at priv.onet.pl  Tue Sep 18 05:54:53 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 05:55:09 2007
Subject: [Harbour] necessary cleanup
In-Reply-To: <D2169EA1-90B2-4868-B2D0-C42701AE7643@syenar.hu>
References: <20070917110719.GB27263@localhost.localdomain>
	<E08D312A-1358-4269-AB53-C48B1A6989F4@syenar.hu>
	<20070917123256.GA29913@localhost.localdomain>
	<D2169EA1-90B2-4868-B2D0-C42701AE7643@syenar.hu>
Message-ID: <20070918095453.GA22046@localhost.localdomain>

On Mon, 17 Sep 2007, Szak?ts Viktor wrote:
> Okey, not being a Class(y) user I cannot comment pro or
> contra on your proposed methods. I'll hold any changes
> regarding those classes until we decide.

As you can see I already committed support for scalar classes.
It's enabled for each item type if HB<TYPENAME>() function is
register in HVM and returns object item.
Now I suggest to add "__" prefix to all HB<TYPENAME>() functions
in tscalar.prg and then add 10 files called:
tscalar<T>.{c,prg} where <T> is type returned by VALTYPE() function.
These will be very simple files, f.e.:

tscalara.prg
============
FUNCTION HBArray()
RETURN __HBArray():New()

we can also rewrite them in .c if we do not want to register automatically
scalar classes in applications linked with shared (.dll,.so,...) harbour
library - please remember that all core .prg functions are always registered
in such case.
As C code it may look like:

tscalara.c
==========
HB_FUNC_EXTERN( __HBARRAY );
HB_FUNC( HBARRAY )
{
    PHB_ITEM pItem;
    HB_FUNC_EXEC( __HBARRAY );
    pItem = hb_param( -1, HB_IT_ANY );
    if( HB_IS_OBJECT( pItem ) && hb_vmRequestQuery() == 0 )
    {
        hb_vmPushDynSym( hb_dynsymGetCase( "NEW" ) );
        hb_vmPush( pItem );
        hb_vmSend( 0 );
    }
}

I'll also add to hbclass.ch similar to xHarbour:
    ENABLE CLASS TYPE ALL
    ENABLE TYPE CLASS ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                      NUMERIC|POINTER|SYMBOL

but they will work in different way making simple REQUEST HB<TYPENAME>
so they can be used in any place of code/module.
And also:
    ASSOCIATE CLASS <ClassName> WITH TYPE
                      ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                      NUMERIC|POINTER|SYMBOL

After above modifications user can still use default scalar class
implementation and also inherit from them, f.e.:

    PROC MAIN()
        LOCAL a:={}
        ASSOCIATE CLASS MyArray WITH TYPE ARRAY
        a += "elem1"
        a += "elem2"
        a += "elem3"
        a += "elem4"
	? a:asString, a:isScalar
        AEVAL(a,{|x,i|QOUT(i,x)})
    RETURN
    CREATE CLASS MyArray INHERIT __HBArray
       OPERATOR "+" ARG xValue INLINE AADD( Self, xValue ), Self
    ENDCLASS

Results are:

druzus:/tmp/009# hbmk -n -w -es2 t && ./t
Harbour devel build 1.1-1 Intl.
Copyright 1999-2007, http://www.harbour-project.org/
Compiling 't.prg'...
Lines 702, Functions/Procedures 2
Generating C source output to 't.c'... Done.

{ ... } .T.
         1 elem1
         2 elem2
         3 elem3
         4 elem4
druzus:/tmp/009#

I'd like to commit above modifications.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep 18 06:03:52 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 06:04:05 2007
Subject: [Harbour] Ole2 contrib buggy ?
In-Reply-To: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>
References: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>
Message-ID: <20070918100352.GB22046@localhost.localdomain>

On Tue, 18 Sep 2007, Juan G?lvez wrote:
> Hi all,
> I'm testing my current xHarbour / FWH app with Harbour and I get a lot of 
> memory leaks when I exit from it.
> I use an activeX control which makes use of a TOleAuto object (::oDisp). I 
> suspect the problem occurs from the error handler of my TActiveX class :
> METHOD OnError( ... ) CLASS TActiveX
>   LOCAL cMethod := __GetMessage()
>   IF Left( cMethod, 1 ) == "_"
>      cMethod := SubStr( cMethod, 2 )
>   ENDIF
> RETURN HB_ExecFromArray( ::oDisp, cMethod, HB_aParams() )
> Any ideas ?

IMHO it's problem with Win32OLE C code. I do not know any method
to cause memory leak using .prg code only in Harbour.
Win32OLE C code in Harbour is in practice copy of xHarbour c code
so IMHO if such problem exist then it should also appear in xHarbour
but default xHarbour builds does not use memory statistic module so
it will not report it.
Try to link your xHarbour application with FM statistic module
(REQUEST HB_FM_STAT) and check if it has the same problem.

BTW memory statistic module has noticeable speed overhead.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep 18 07:58:28 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 18 08:00:29 2007
Subject: [Harbour] necessary cleanup
In-Reply-To: <20070918095453.GA22046@localhost.localdomain>
References: <20070917110719.GB27263@localhost.localdomain>
	<E08D312A-1358-4269-AB53-C48B1A6989F4@syenar.hu>
	<20070917123256.GA29913@localhost.localdomain>
	<D2169EA1-90B2-4868-B2D0-C42701AE7643@syenar.hu>
	<20070918095453.GA22046@localhost.localdomain>
Message-ID: <18C5E7C3-68C3-4C4B-94CE-3B5FFF912C54@syenar.hu>

Hi Przemek,

It looks good to me.

I vote for the .c version to avoid any unnecessary overhead
for those users who don't need type classes.

Brgds,
Viktor

On 2007.09.18., at 11:54, Przemyslaw Czerpak wrote:

> On Mon, 17 Sep 2007, Szak?ts Viktor wrote:
>> Okey, not being a Class(y) user I cannot comment pro or
>> contra on your proposed methods. I'll hold any changes
>> regarding those classes until we decide.
>
> As you can see I already committed support for scalar classes.
> It's enabled for each item type if HB<TYPENAME>() function is
> register in HVM and returns object item.
> Now I suggest to add "__" prefix to all HB<TYPENAME>() functions
> in tscalar.prg and then add 10 files called:
> tscalar<T>.{c,prg} where <T> is type returned by VALTYPE() function.
> These will be very simple files, f.e.:
>
> tscalara.prg
> ============
> FUNCTION HBArray()
> RETURN __HBArray():New()
>
> we can also rewrite them in .c if we do not want to register  
> automatically
> scalar classes in applications linked with shared (.dll,.so,...)  
> harbour
> library - please remember that all core .prg functions are always  
> registered
> in such case.
> As C code it may look like:
>
> tscalara.c
> ==========
> HB_FUNC_EXTERN( __HBARRAY );
> HB_FUNC( HBARRAY )
> {
>     PHB_ITEM pItem;
>     HB_FUNC_EXEC( __HBARRAY );
>     pItem = hb_param( -1, HB_IT_ANY );
>     if( HB_IS_OBJECT( pItem ) && hb_vmRequestQuery() == 0 )
>     {
>         hb_vmPushDynSym( hb_dynsymGetCase( "NEW" ) );
>         hb_vmPush( pItem );
>         hb_vmSend( 0 );
>     }
> }
>
> I'll also add to hbclass.ch similar to xHarbour:
>     ENABLE CLASS TYPE ALL
>     ENABLE TYPE CLASS ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
>                       NUMERIC|POINTER|SYMBOL
>
> but they will work in different way making simple REQUEST HB<TYPENAME>
> so they can be used in any place of code/module.
> And also:
>     ASSOCIATE CLASS <ClassName> WITH TYPE
>                       ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
>                       NUMERIC|POINTER|SYMBOL
>
> After above modifications user can still use default scalar class
> implementation and also inherit from them, f.e.:
>
>     PROC MAIN()
>         LOCAL a:={}
>         ASSOCIATE CLASS MyArray WITH TYPE ARRAY
>         a += "elem1"
>         a += "elem2"
>         a += "elem3"
>         a += "elem4"
> 	? a:asString, a:isScalar
>         AEVAL(a,{|x,i|QOUT(i,x)})
>     RETURN
>     CREATE CLASS MyArray INHERIT __HBArray
>        OPERATOR "+" ARG xValue INLINE AADD( Self, xValue ), Self
>     ENDCLASS
>
> Results are:
>
> druzus:/tmp/009# hbmk -n -w -es2 t && ./t
> Harbour devel build 1.1-1 Intl.
> Copyright 1999-2007, http://www.harbour-project.org/
> Compiling 't.prg'...
> Lines 702, Functions/Procedures 2
> Generating C source output to 't.c'... Done.
>
> { ... } .T.
>          1 elem1
>          2 elem2
>          3 elem3
>          4 elem4
> druzus:/tmp/009#
>
> I'd like to commit above modifications.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Tue Sep 18 08:47:36 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 08:48:31 2007
Subject: [Harbour] ChangeLog 2007-09-18 14:40 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070918124736.GA26229@localhost.localdomain>

2007-09-18 14:40 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbclass.ch
    + added new commands for scalar classes:
         ASSOCIATE CLASS <ClassName> WITH TYPE
                           ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                           NUMERIC|POINTER|SYMBOL
         ENABLE CLASS TYPE ALL
         ENABLE TYPE CLASS ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                           NUMERIC|POINTER|SYMBOL
      Please remeber that:
          ENABLE CLASS TYPE ALL
      and:
          ENABLE TYPE CLASS ...
      can be used in any place of code - this commands are translated to
          REQUEST HB<TYPENAME>
      so are not executed

  * harbour/source/vm/classes.c
    + added __clsAssocType( <hClass>, <cType> ) => <lOK>

  * harbour/common.mak
  * harbour/source/rtl/tscalar.prg
  * harbour/source/rtl/Makefile
  + harbour/source/rtl/tscalars.c
  + harbour/source/rtl/tscalard.c
  + harbour/source/rtl/tscalarh.c
  + harbour/source/rtl/tscalarl.c
  + harbour/source/rtl/tscalarp.c
  + harbour/source/rtl/tscalara.c
  + harbour/source/rtl/tscalaru.c
  + harbour/source/rtl/tscalarb.c
  + harbour/source/rtl/tscalarn.c
  + harbour/source/rtl/tscalarc.c
    + added scalar classes for basic types,
      Now it's possible to define messages also for basic item types.
      It's even possible to overload some not defined in HVM operators,
      f.e. in this example we overload operator "+" so it makes
        AADD( <aValue>, <xValue> )
      for code like <aValue> + <xValue>:
        #include "hbclass.ch"
        PROC MAIN()
            LOCAL a:={}
            ASSOCIATE CLASS MyArray WITH TYPE ARRAY
            a := a + "elem1"
            a += "elem2"
            a := a + "elem3"
            a += "elem4"
            ? a:asString, a:isScalar
            AEVAL(a,{|x,i|QOUT(i,x)})
        RETURN
        CREATE CLASS MyArray INHERIT __HBArray
           OPERATOR "+" ARG xValue INLINE AADD( Self, xValue ), Self
        ENDCLASS
      Operators which have default actions for given types defined in HVM
      cannot be overloaded.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep 18 08:48:54 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 08:49:00 2007
Subject: [Harbour] necessary cleanup
In-Reply-To: <18C5E7C3-68C3-4C4B-94CE-3B5FFF912C54@syenar.hu>
References: <20070917110719.GB27263@localhost.localdomain>
	<E08D312A-1358-4269-AB53-C48B1A6989F4@syenar.hu>
	<20070917123256.GA29913@localhost.localdomain>
	<D2169EA1-90B2-4868-B2D0-C42701AE7643@syenar.hu>
	<20070918095453.GA22046@localhost.localdomain>
	<18C5E7C3-68C3-4C4B-94CE-3B5FFF912C54@syenar.hu>
Message-ID: <20070918124854.GB26229@localhost.localdomain>

On Tue, 18 Sep 2007, Szak?ts Viktor wrote:
> Hi Przemek,
> It looks good to me.
> I vote for the .c version to avoid any unnecessary overhead
> for those users who don't need type classes.

Done.

best regards,
Przemek
From gvarona at ec-red.com  Tue Sep 18 09:26:34 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Tue Sep 18 09:20:28 2007
Subject: [Harbour] =?iso-8859-1?q?=BFC=F3mo_puedo_saber_que_funciones_tie?=
 =?iso-8859-1?q?ne_una_Librer=EDa=3F_/_How_can_I_know_that_functions_has_a?=
 =?iso-8859-1?q?_Library_=28*=2Ea=29=3F_?=
Message-ID: <46EFD20A.3050903@ec-red.com>

Hola / Hi:
?C?mo puedo saber que funciones tiene una Librer?a?
Existe algun comando o algo similar para obtener una lista de las
funciones que contiene una libreria.

How can I know that functions has a Library (*.a)?
It exists any command or somewhat similar to obtain a list of the
functions that contains a LIB (*.a)

Gracias de Antemano
TIA

Salu2,
GVS

From soporte at dsgsoftware.com  Tue Sep 18 12:29:50 2007
From: soporte at dsgsoftware.com (=?iso-8859-2?Q?Juan_G=E1lvez?=)
Date: Tue Sep 18 12:30:12 2007
Subject: [Harbour] Ole2 contrib buggy ?
References: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>
	<20070918100352.GB22046@localhost.localdomain>
Message-ID: <000601c7fa11$274a0960$1700000a@PcJuanxp>

Hi Przemek,

> IMHO it's problem with Win32OLE C code. I do not know any method
> to cause memory leak using .prg code only in Harbour.
> Win32OLE C code in Harbour is in practice copy of xHarbour c code
> so IMHO if such problem exist then it should also appear in xHarbour
> but default xHarbour builds does not use memory statistic module so
> it will not report it.
> Try to link your xHarbour application with FM statistic module
> (REQUEST HB_FM_STAT) and check if it has the same problem.
>
> BTW memory statistic module has noticeable speed overhead.

I tried it and xHarbour didn't show any memory leak.

Is it a normal situation that I get between 1500 and 2500 unreleased blocks 
on the memory leak report of Harbour ?

Best regards
Juan 

From toninhofwi at yahoo.com.br  Tue Sep 18 12:25:46 2007
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Tue Sep 18 12:49:07 2007
Subject: [Harbour] ChangeLog 2007-09-18 00:45 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20070917224512.GA26492@localhost.localdomain>
References: <20070917224512.GA26492@localhost.localdomain>
Message-ID: <gquve3tkv9ojasdjqhknbekff72k4m9840@4ax.com>

>      If you prefer xHarbour like not automatic scalar class registration
>      with some PP commands:

Przemek, first of all thanks!

I vote for more compatibilitie in both Harbour and XHarbour, so I vote
for not automatic scalar class registration.

Best regards,

Toninho.


		
_______________________________________________________ 
Yahoo! Mail - Sempre a melhor opo para voc! 
Experimente j e veja as novidades. 
http://br.yahoo.com/mailbeta/tudonovo/
 

From druzus at priv.onet.pl  Tue Sep 18 14:52:18 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 15:25:31 2007
Subject: [Harbour] ChangeLog 2007-09-18 00:45 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <gquve3tkv9ojasdjqhknbekff72k4m9840@4ax.com>
References: <20070917224512.GA26492@localhost.localdomain>
	<gquve3tkv9ojasdjqhknbekff72k4m9840@4ax.com>
Message-ID: <20070918185218.GA6048@localhost.localdomain>

On Tue, 18 Sep 2007, Toninho@fwi wrote:
> >      If you prefer xHarbour like not automatic scalar class registration
> >      with some PP commands:
> Przemek, first of all thanks!
> I vote for more compatibilitie in both Harbour and XHarbour, so I vote
> for not automatic scalar class registration.

I had committed modifications which made scalar classes code similar
to both Class(y) and xHarbour. You can use xHarbour like:
     ASSOCIATE CLASS <ClassName> WITH TYPE
                       ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                       NUMERIC|POINTER|SYMBOL
     ENABLE CLASS TYPE ALL
     ENABLE TYPE CLASS ARRAY|BLOCK|CHARACTER|DATE|HASH|LOGICAL|NIL|
                       NUMERIC|POINTER|SYMBOL
but ENABLE* commands work internally in different way then in
xHarbour. If you add to any of your .prg file in any place:
    ENABLE CLASS TYPE ALL
then you will have automatic scalar classes registration because
in Harbour they do not execute any code but simply makes series
of REQUESTs for scalar class functions.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep 18 14:41:25 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 15:26:20 2007
Subject: [Harbour] Ole2 contrib buggy ?
In-Reply-To: <000601c7fa11$274a0960$1700000a@PcJuanxp>
References: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>
	<20070918100352.GB22046@localhost.localdomain>
	<000601c7fa11$274a0960$1700000a@PcJuanxp>
Message-ID: <20070918184125.GA5663@localhost.localdomain>

On Tue, 18 Sep 2007, Juan G?lvez wrote:
> >IMHO it's problem with Win32OLE C code. I do not know any method
> >to cause memory leak using .prg code only in Harbour.
> >Win32OLE C code in Harbour is in practice copy of xHarbour c code
> >so IMHO if such problem exist then it should also appear in xHarbour
> >but default xHarbour builds does not use memory statistic module so
> >it will not report it.
> >Try to link your xHarbour application with FM statistic module
> >(REQUEST HB_FM_STAT) and check if it has the same problem.
> >BTW memory statistic module has noticeable speed overhead.
> I tried it and xHarbour didn't show any memory leak.

What does your xHarbour application show when run with //info switch?
Can you send it here?
I've just compared C code in Harbour w32ole.c and xHarbour win32ole.prg
In both cases it's in practice the same. The only one significant
difference is inside enumerator code. Do you use FOR EACH with OLE
objects?
Can you create some reduce example which exploits the problem
so I we can ask some other windows users to make tests.

> Is it a normal situation that I get between 1500 and 2500 unreleased blocks 
> on the memory leak report of Harbour ?

No it's not normal but whole win32ole is not normal code.
If you will send some reduced example then maybe some
Windows developers can help you.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep 18 15:39:54 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 18 15:40:09 2007
Subject: [Harbour] Ole2 contrib buggy ?
In-Reply-To: <20070918184125.GA5663@localhost.localdomain>
References: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>
	<20070918100352.GB22046@localhost.localdomain>
	<000601c7fa11$274a0960$1700000a@PcJuanxp>
	<20070918184125.GA5663@localhost.localdomain>
Message-ID: <AC0DA8EE-2F5B-43A1-AD89-7E63FEA900EE@syenar.hu>

Maybe nothing to do with this issue, just a reminder, that currently
this .c file is the only one in Harbour giving compiler warnings
(with GCC 4.12):

contrib/ole2:
../../w32ole.c: In function 'hb_oleItemToVariant':
../../w32ole.c:402: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:418: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:446: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:460: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:541: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:542: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:585: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:586: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:629: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:630: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:666: warning: dereferencing type-punned pointer will  
break strict-aliasing rules
../../w32ole.c:667: warning: dereferencing type-punned pointer will  
break strict-aliasing rules

Brgds,
Viktor

On 2007.09.18., at 20:41, Przemyslaw Czerpak wrote:

> On Tue, 18 Sep 2007, Juan G?lvez wrote:
>>> IMHO it's problem with Win32OLE C code. I do not know any method
>>> to cause memory leak using .prg code only in Harbour.
>>> Win32OLE C code in Harbour is in practice copy of xHarbour c code
>>> so IMHO if such problem exist then it should also appear in xHarbour
>>> but default xHarbour builds does not use memory statistic module so
>>> it will not report it.
>>> Try to link your xHarbour application with FM statistic module
>>> (REQUEST HB_FM_STAT) and check if it has the same problem.
>>> BTW memory statistic module has noticeable speed overhead.
>> I tried it and xHarbour didn't show any memory leak.
>
> What does your xHarbour application show when run with //info switch?
> Can you send it here?
> I've just compared C code in Harbour w32ole.c and xHarbour  
> win32ole.prg
> In both cases it's in practice the same. The only one significant
> difference is inside enumerator code. Do you use FOR EACH with OLE
> objects?
> Can you create some reduce example which exploits the problem
> so I we can ask some other windows users to make tests.
>
>> Is it a normal situation that I get between 1500 and 2500  
>> unreleased blocks
>> on the memory leak report of Harbour ?
>
> No it's not normal but whole win32ole is not normal code.
> If you will send some reduced example then maybe some
> Windows developers can help you.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lkrausem at shaw.ca  Tue Sep 18 16:22:56 2007
From: lkrausem at shaw.ca (Luis Krause Mantilla)
Date: Tue Sep 18 16:26:18 2007
Subject: [Harbour] Ole2 contrib buggy ?
In-Reply-To: <20070918184125.GA5663@localhost.localdomain>
References: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>
	<20070918100352.GB22046@localhost.localdomain>
	<000601c7fa11$274a0960$1700000a@PcJuanxp>
	<20070918184125.GA5663@localhost.localdomain>
Message-ID: <46F033A0.3030001@shaw.ca>

Przemek:

I posted another issue I found with win32ole back in Aug 8

[Harbour] obj:Set( "PropertyName",    ... ) syntax for TOleAuto doesn't work

Don't know if it's related or not to Juan's problem, but there's someting in
HB_EXECFROMARRAY that doesn't work like in xHarbour.  Here's my post
again for your convenience:

Hi:

I have a small app that creates Excel files with TOleAuto with
Clipper/FW/TOLEAuto from Jos? Gim?nez as
well as with [x]Harbour/FWH.

Since Clipper won't handle property names longer than 10
character I use the ::Set() method and pass the property name
in quotes to set it's value ( or ::Get() to grab it).

Under xHarbour it works fine but I get an E_FAIL error with Harbour
on the same line.
I can't seem to find the difference in harbour\contrib\ole2\win32ole.prg
vs. the xHarbour one, so I'm not sure what's causing the different
behaviour.

Here's a small sample demonstrating the problem (using current SVN):

//----
function main()
local oExcel

oExcel := TOleAuto():New( "Excel.Application" )
oExcel:DisplayAlerts := .f.
oExcel:Set( "DisplayAlerts", .t. )  // syntax works OK with Clipper/FW16 
bits and xHarbour but not Harbour.

? "test successful"

return nil
//----

And this is the error reported in Harbour:

Error Excel.Application/16389  E_FAIL: DISPLAYALERTS
Called from TOLEAUTO:DISPLAYALERTS(0)
Called from HB_EXECFROMARRAY(0)
Called from TOLEAUTO:SET(344)
Called from MAIN(7)

Regards,

-- 
Luis Krause Mantilla
lkrausem at shaw dot ca
luis_krause at hotmail dot com
"May the Source be with GNU"


From druzus at priv.onet.pl  Tue Sep 18 17:04:04 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 17:04:12 2007
Subject: [Harbour] Ole2 contrib buggy ?
In-Reply-To: <AC0DA8EE-2F5B-43A1-AD89-7E63FEA900EE@syenar.hu>
References: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>
	<20070918100352.GB22046@localhost.localdomain>
	<000601c7fa11$274a0960$1700000a@PcJuanxp>
	<20070918184125.GA5663@localhost.localdomain>
	<AC0DA8EE-2F5B-43A1-AD89-7E63FEA900EE@syenar.hu>
Message-ID: <20070918210404.GA6432@localhost.localdomain>

On Tue, 18 Sep 2007, Szak?ts Viktor wrote:
> Maybe nothing to do with this issue, just a reminder, that currently
> this .c file is the only one in Harbour giving compiler warnings
> (with GCC 4.12):
> contrib/ole2:
> ../../w32ole.c: In function 'hb_oleItemToVariant':
> ../../w32ole.c:402: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:418: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:446: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:460: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:541: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:542: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:585: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:586: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:629: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:630: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:666: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules
> ../../w32ole.c:667: warning: dereferencing type-punned pointer will  
> break strict-aliasing rules

All these places can be source of some unexpected results and
for sure have to be fixed in both (Harbour and xHarbour) compilers
but they should not cause memory leaks reported by our FM module.
W32OLE C code does not have any call to hb_xgrab() or hb_xalloc()
so if memory leaks are reported then they are caused by corruption
of some internal memory structures - nothing amazing because some
pointers to HB_ITEM internals are passed to low level OLE code
and then other applications. It means that even small mistake in
executed 3-rd party code can corrupt HVM. IMHO it's unacceptable
situation and I hope that some MS-Windows user will create new
OLE module in different way without such code.
Maybe some more detail information about unreleased blocks can
help us to locate what has been overwritten.
BTW because OLE code does not use hb_xgrab()/hb_xalloc() them
real memory leaks in this modules are not reported in both
compilers and only situations when some internals HVM structures
are corrupted/overwritten will be reported. This code is highly
alignment dependent so it's also very important to use exactly
the same alignment switches as for rest of core Harbour code
and also compatible with expected alignment for OLE structures.
If someone will work on new OLE implementation then he should
create code alignment independent to Harbour core code so it
will be limited only by expected alignment for OLE structures.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep 18 17:10:00 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 17:10:07 2007
Subject: [Harbour] Ole2 contrib buggy ?
In-Reply-To: <46F033A0.3030001@shaw.ca>
References: <000501c7f9d4$c04ec840$1700000a@PcJuanxp>
	<20070918100352.GB22046@localhost.localdomain>
	<000601c7fa11$274a0960$1700000a@PcJuanxp>
	<20070918184125.GA5663@localhost.localdomain>
	<46F033A0.3030001@shaw.ca>
Message-ID: <20070918211000.GB6432@localhost.localdomain>

On Tue, 18 Sep 2007, Luis Krause Mantilla wrote:
> Przemek:
> I posted another issue I found with win32ole back in Aug 8
> [Harbour] obj:Set( "PropertyName",    ... ) syntax for TOleAuto doesn't work
> Don't know if it's related or not to Juan's problem, but there's someting in
> HB_EXECFROMARRAY that doesn't work like in xHarbour.  Here's my post
> again for your convenience:

In this test HB_EXECFROMARRAY() works like in xHarbour but W32OLE .prg
code uses:
    aDel( HB_aParams(), 1, .T. )
so you need Harbour core code compiled with HB_COMPAT_XHB or DisplayAlerts
will receive two parameters: .T., NIL what may cause such problem.
This code should be fixed so instead of:

    METHOD Invoke( ... ) CLASS TOleAuto
       LOCAL cMethod := HB_aParams()[1]
    RETURN HB_ExecFromArray( Self, cMethod, aDel( HB_aParams(), 1, .T. ) )

We should have:

    METHOD Invoke( cMethod, ... ) CLASS TOleAuto
    RETURN HB_ExecFromArray( Self, cMethod, { ... } )

Make such modification in contrib/ole2/win32ole.prg and check if
it helps. If not then you will have to ask for help some MS-Windows
developers.

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Tue Sep 18 17:27:13 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Sep 18 17:27:18 2007
Subject: [Harbour] How to load and execute external prg code
Message-ID: <9257026e0709181427m6d4a2944n90cafe2d44be2306@mail.gmail.com>

I need to load and exec files with prg code or better with a mix of
text and prg code that will be send to a web browser ( sth like asp or
jsp ).

I've tried the hbdot approach but I need to pass two objects as
parameters oRequest, oResponse.

Which is the best way ( and quickest ) way to do it with actual Harbour?

Maybe extended codeblocks?

I need it for rapid prototype so performance is not an issue.

best regards,
Lorenzo
From druzus at priv.onet.pl  Tue Sep 18 18:47:42 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 18 18:47:49 2007
Subject: [Harbour] How to load and execute external prg code
In-Reply-To: <9257026e0709181427m6d4a2944n90cafe2d44be2306@mail.gmail.com>
References: <9257026e0709181427m6d4a2944n90cafe2d44be2306@mail.gmail.com>
Message-ID: <20070918224742.GA7358@localhost.localdomain>

On Tue, 18 Sep 2007, Lorenzo Fiorini wrote:
> I need to load and exec files with prg code or better with a mix of
> text and prg code that will be send to a web browser ( sth like asp or
> jsp ).
> I've tried the hbdot approach but I need to pass two objects as
> parameters oRequest, oResponse.
> Which is the best way ( and quickest ) way to do it with actual Harbour?
> Maybe extended codeblocks?
> I need it for rapid prototype so performance is not an issue.

Can you define that this .prg code will use some fixed name
startup function?
If yes, then simply chose some name, f.e. HRBMAIN() and then
after loading compiled module (__HRBLOAD()) simply execute this
function passing all necessary parameters, f.e.:

    DYNAMIC HRBMAIN
    IF !EMPTY( pHRB := __HRBLOAD( cHrbBodyOrFile ) )
        xResult := HRBMAIN( oRequest, oResponse )
        __HRBUNLOAD( xResult )
    ENDIF

If you cannot chose such fixed name function as module startup
symbol then you will have to use __HRBRUN() to execute first
function in loaded module, but because __HRBRUN() accepts only
string parameters (just like parameters passed to application
from command line) then you will have to pass oRequest, oResponse
in different way. F.e. as PRIVATE variables:

    IF !EMPTY( pHRB := __HRBLOAD( cHrbBodyOrFile ) )
	PRIVATE oRequest := oRequestVar, oResponse := oResponseVar
        xResult := __HRBDO( pHRB )
        __HRBUNLOAD( xResult )
    ENDIF

There are also other possible methods but in all cases it seems
to be trivial problem so I think that I'm missing sth important
with conditions you have to pass.
If the above will not help you please try to describe the exact
problem and what you expect.

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Wed Sep 19 02:38:58 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 19 02:39:04 2007
Subject: [Harbour] How to load and execute external prg code
In-Reply-To: <20070918224742.GA7358@localhost.localdomain>
References: <9257026e0709181427m6d4a2944n90cafe2d44be2306@mail.gmail.com>
	<20070918224742.GA7358@localhost.localdomain>
Message-ID: <9257026e0709182338w3668a815t39db91be02eafab0@mail.gmail.com>

On 9/19/07, Przemyslaw Czerpak <druzus@priv.onet.pl> wrote:

>     DYNAMIC HRBMAIN
>     IF !EMPTY( pHRB := __HRBLOAD( cHrbBodyOrFile ) )
>         xResult := HRBMAIN( oRequest, oResponse )
>         __HRBUNLOAD( xResult )
>     ENDIF

Many thanks, I missed __HRBLOAD. It works perfectly in this way:
...
      try
         IF !EMPTY( pHRB := __HRBLOAD( cName + cExt ) )
            xResult := HRBMAIN( oRequest, oResponse )
            oResponse:Flush( 200, "OK",, xResult )
             __HRBUNLOAD( pHRB )
         ENDIF
      catch
         oResponse:Flush( 200, "OK", "text/html", cName + cExt + " rt error" )
      end
...

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Wed Sep 19 02:53:37 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 19 02:53:40 2007
Subject: [Harbour] How to embed prg code into html using <% %> like jsp/asp
Message-ID: <9257026e0709182353i2fecf4eufe3a9156cba40dbe@mail.gmail.com>

I'm writing an application server and I need external prg code that
can be easily and quickly customized at customer site.

Actually I use code like this compiled into hrb:

#xcommand TEXTSTREAM INTO <v> => #pragma __cstream|<v>+=%s

#pragma escapedstrings = on

function HRBMAIN( oRequest, oResponse )

   local cContent := ""
   local cHost := oRequest:hHeaders[ "Host" ]

   oResponse:hHeaders[ "Content-type" ] := "xyz"

   TEXTSTREAM INTO cContent
<?xml version="1.0"?>
...
   ENDTEXT

   cContent := strtran( cContent, "<%cHost%>", cHost )
   cContent := strtran( cContent, "<%xyz%>", cXyz )
   ...

   return cContent

BUT I'd like to replace with sth like:

<%
#pragma escapedstrings = on

function HRBMAIN( oRequest, oResponse )

   local cContent := ""
   local cHost := oRequest:hHeaders[ "Host" ]

   oResponse:hHeaders[ "Content-type" ] := "xyz"
%>

<?xml version="1.0"?>
...
   <%cHost%>
...

<%
return ....
%>

in this way I could avoid the TEXTSTREAM command and many strtrans at end.

I'm working with sth like:

cText := MEMOREAD( cPrgFile )
cText := PROCESSPRG( cText ) <--- here is the point
cHrb := HB_COMPILEFROMBUF( cText, ... )
pHrb := __HRBLOAD( cHrb )
_HRBDO( pHrb )

but I can't see an efficient way to combine the "pure text" part with
the prg code.

Is there anyone that has already done sth like that?

Any suggestion?

best regards,
Lorenzo
From M.Horodyski at pzuzycie.com.pl  Wed Sep 19 03:12:15 2007
From: M.Horodyski at pzuzycie.com.pl (Horodyski Marek (PZUZ))
Date: Wed Sep 19 03:12:21 2007
Subject: [Harbour] RE: Harbour Digest, Vol 11, Issue 43
Message-ID: <503AD832DBBF60469E9F807668A2F6A2027BD078@PINK.zycie.pzu>

>Message: 2
>Date: Tue, 18 Sep 2007 14:47:36 +0200
>From: Przemyslaw Czerpak <druzus@priv.onet.pl>
>Subject: [Harbour] ChangeLog 2007-09-18 14:40 UTC+0200 Przemyslaw

[ ... ]
>        ENDCLASS
>      Operators which have default actions for given types 
>defined in HVM
>      cannot be overloaded.
>
>best regards,
>Przemek

Przemek, can I use this solution when array is created from code block
(in fly, from script).
In xHarbour, when I make "request _array" in EXE, I can do this.

Regards,
Marek Horodyski

From lorenzo.fiorini at gmail.com  Wed Sep 19 03:12:47 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 19 03:12:51 2007
Subject: [Harbour] [GD] 2007-09-16 22:30 UTC+0200 Francesco Saverio
	Giudice <info/at/fsgiudice.com>
In-Reply-To: <001401c7f89f$b3e4e700$6501a8c0@ASUSFSG>
References: <9257026e0709130819t5df8bb98vf33e89e816c38fbc@mail.gmail.com>
	<20070913163347.GA5310@localhost.localdomain>
	<9257026e0709131007p3deaefb9q503f84871ff3ce6a@mail.gmail.com>
	<000801c7f69e$c3ed1a30$b400a8c0@ASUSFSG>
	<001401c7f89f$b3e4e700$6501a8c0@ASUSFSG>
Message-ID: <9257026e0709190012g68296435i1eb215d01d2e8106@mail.gmail.com>

On 9/16/07, Francesco Saverio Giudice <info@fsgiudice.com> wrote:

> Lorenzo, please test it and confirm. Thanks.

Many thanks it seem ok.

best regards,
Lorenzo
From druzus at priv.onet.pl  Wed Sep 19 03:48:30 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 19 03:48:37 2007
Subject: [Harbour] RE: Harbour Digest, Vol 11, Issue 43
In-Reply-To: <503AD832DBBF60469E9F807668A2F6A2027BD078@PINK.zycie.pzu>
References: <503AD832DBBF60469E9F807668A2F6A2027BD078@PINK.zycie.pzu>
Message-ID: <20070919074830.GA15775@localhost.localdomain>

On Wed, 19 Sep 2007, Horodyski Marek (PZUZ) wrote:
> >        ENDCLASS
> >      Operators which have default actions for given types 
> >defined in HVM
> >      cannot be overloaded.
> Przemek, can I use this solution when array is created from code block
> (in fly, from script).
> In xHarbour, when I make "request _array" in EXE, I can do this.

It doesn't matter how array or any other basic type item is created.
Scalar classes allows to define messages for predefined VM item types
like BLOCK, CHARACTER, NUMERIC, ... F.e. if you want to use EXEC()
instead of EVAL to evaluate codeblocks, then you can make:

    #include "hbclass.ch"
    PROC MAIN()
       LOCAL cb:={|a,b,c|qout("=>", a, b, c, "<=")}
       ASSOCIATE CLASS myClass WITH TYPE BLOCK
       cb:EXEC("X","Y","Z")
    RETURN
    CREATE CLASS myClass
       METHOD EXEC
    ENDCLASS
    METHOD EXEC( ... )
    RETURN ::EVAL( ... )

When you use:
    ASSOCIATE CLASS <className> WITH TYPE <TYPENAME>

then you inform HVM messages send to <TYPENAME> variables
have to be redirected to class <className>.
It works like in xHarbour. In Harbour you only have one additional
functionality. You do not have to use ASSOCIATE CLASS ... but you
can simply define in your code function called: hb<TYPENAME>(),
just like in Class(y) csy<TYPENAME>(), so the above example can be
reduced to:

    #include "hbclass.ch"
    PROC MAIN()
       LOCAL cb:={|a,b,c|qout("=>", a, b, c, "<=")}
       cb:EXEC("X","Y","Z")
    RETURN
    CREATE CLASS hbBlock
       METHOD EXEC
    ENDCLASS
    METHOD EXEC( ... )
    RETURN ::EVAL( ... )

and even without ASSOCIATE CLASS ... messages sending to CODEBLOCK
items will be redirected to hbBlock class.
When we will finish full Class(y) support we add set of translations
like:
    #xtranslate scyBlock => hbBlock
so Class(y) code can be used with Harbour without any modifications.

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Wed Sep 19 03:50:50 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Sep 19 03:50:56 2007
Subject: [Harbour] OT: http proxy for harbour applications
Message-ID: <9257026e0709190050g3f149a38n60a5bdee59aa35ea@mail.gmail.com>

I'm writing an application in Harbour that has an http interface.

The application is a "normal" Harbour app and so it's not stateless it
has static variables, user informations, record locking and so on.

Under Windows there are no problems since ever user has his own pc the
exe runs "locally" and access dbfs on the server but under Linux all
the binaries run on the same host.

I plan to have tipically less than 50-100 users, so I thought to use a
range of ports but every user should use ONE and ONLY ONE during one
"session".

I see two possibilities:

- create a custom proxy in Harbour that routes the user's requests
based on a table
- use standard a proxy like squid in reverse configuration

Are there other possibilities I don't see?

Has anybody done sth like that?

Does anybody know if it's possible to use squid ( or other proxy ) in this way.

best regards,
Lorenzo
From soporte at dsgsoftware.com  Wed Sep 19 05:23:42 2007
From: soporte at dsgsoftware.com (=?iso-8859-2?Q?Juan_G=E1lvez?=)
Date: Wed Sep 19 05:24:19 2007
Subject: [Harbour] Ole2 contrib buggy ?
References: <000501c7f9d4$c04ec840$1700000a@PcJuanxp><20070918100352.GB22046@localhost.localdomain><000601c7fa11$274a0960$1700000a@PcJuanxp>
	<20070918184125.GA5663@localhost.localdomain>
Message-ID: <005d01c7fa9e$d4be5a50$1700000a@PcJuanxp>

Przemek,

I'm very sorry for your loss of time but I think I've discovered the real 
problem is FWH.

I've modified the original TActiveX class of FWH to use a TOleAuto object 
and the fact that xHarbour doesn't show any memory leak made me to suppose 
that TOleAuto of Harbour was the problem.

I've tested a FWH sample with its original TActiveX class and Harbour and 
the memory leaks appear.

I'll contact to Antonio and I'll explain the problem.

Do you have any idea why xHarbour doesn't show any memory leak ?

Many thanks for your help
Juan

----- Original Message ----- 
From: "Przemyslaw Czerpak" <druzus@priv.onet.pl>
To: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Sent: Tuesday, September 18, 2007 8:41 PM
Subject: Re: [Harbour] Ole2 contrib buggy ?


> On Tue, 18 Sep 2007, Juan G?lvez wrote:
>> >IMHO it's problem with Win32OLE C code. I do not know any method
>> >to cause memory leak using .prg code only in Harbour.
>> >Win32OLE C code in Harbour is in practice copy of xHarbour c code
>> >so IMHO if such problem exist then it should also appear in xHarbour
>> >but default xHarbour builds does not use memory statistic module so
>> >it will not report it.
>> >Try to link your xHarbour application with FM statistic module
>> >(REQUEST HB_FM_STAT) and check if it has the same problem.
>> >BTW memory statistic module has noticeable speed overhead.
>> I tried it and xHarbour didn't show any memory leak.
>
> What does your xHarbour application show when run with //info switch?
> Can you send it here?
> I've just compared C code in Harbour w32ole.c and xHarbour win32ole.prg
> In both cases it's in practice the same. The only one significant
> difference is inside enumerator code. Do you use FOR EACH with OLE
> objects?
> Can you create some reduce example which exploits the problem
> so I we can ask some other windows users to make tests.
>
>> Is it a normal situation that I get between 1500 and 2500 unreleased 
>> blocks
>> on the memory leak report of Harbour ?
>
> No it's not normal but whole win32ole is not normal code.
> If you will send some reduced example then maybe some
> Windows developers can help you.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour 

From antonioharbour at gmail.com  Wed Sep 19 06:36:41 2007
From: antonioharbour at gmail.com (Antonio Linares)
Date: Wed Sep 19 06:37:28 2007
Subject: [Harbour] Ole2 contrib buggy ?
In-Reply-To: <005d01c7fa9e$d4be5a50$1700000a@PcJuanxp>
Message-ID: <46f0fbe2.07aa420a.10c1.ffffdfe4@mx.google.com>

> I'm very sorry for your loss of time but I think I've discovered the real
problem is FWH.

We have been talking on the phone with Juan and there is no proof at all
that the problem comes from FWH

We have told Juan some tests to do to find where the problem may come from.

Regards,

Antonio

From mbelgrano at deltain.it  Wed Sep 19 09:53:24 2007
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Sep 19 09:54:14 2007
Subject: R: [Harbour] Triggers over all RDD ?
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03809A843@SRV02.deltain.net>
References: <46B96BE4.5020704@marchuet.net>
	<AFB948164110ED43B5EB849E8DEEF03809A843@SRV02.deltain.net>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03809A915@SRV02.deltain.net>

I am very intrrested too
Same news?

-----Messaggio originale-----
Da: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] Per conto di Massimo Belgrano
Inviato: gioved? 9 agosto 2007 10.31
A: Harbour Project Main Developer List.
Oggetto: R: [Harbour] Triggers over all RDD ?

Yes i am very interested!


-----Messaggio originale-----
Da: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] Per conto di Miguel Angel Marchuet
Inviato: mercoled? 8 agosto 2007 9.08
A: xharbour developer list; Harbour Project Main Developer List.
Oggetto: [Harbour] Triggers over all RDD ?

I can implement triggers over RDD. Any one is interested on it?

Best regards,
Miguel Angel Marchuet

  Sx_SetTrigger():

  Syntax:   Sx_SetTrigger( <nAction> [,<cTriggerName>] )

         nAction = A numeric value indicating the action to be taken with
                   the currently active or specified trigger function.
                   These values are defined as manifest constants in the
                   SIXCDX.CH file, and are as follows:

                     TRIGGER_ENABLE   = Activate an installed trigger
                     TRIGGER_DISABLE  = Deactivate an installed trigger
                     TRIGGER_REMOVE   = Uninstall an installed trigger
                     TRIGGER_INSTALL  = Install a new trigger function.
                                        A newly installed trigger automatic-
                                        ally uninstalls any previously
                                        installed trigger.  The new trigger
                                        also becomes ENABLEd automatically.

                   NOTE:  Although these constants preprocess into numeric
                          values, you should not use the numeric values in
                          your source code.  Instead, you should use the
                          constants, as defined above.  This will insure
                          compatibility with all future releases of the
                          SIx Driver.

    cTriggerName = Optional name of a trigger function to install.  This
                   parameter is only required if the first parameter is
                   TRIGGER_INSTALL.

  Returns:  The currently active trigger name.

  Description:  This function allows the developer to activate (or install)
                a function to handle each triggerable event.  This is
                done by using the TRIGGER_INSTALL constant as the first
                parameter, and passing the new function name as the second
                parameter.  The specified function would then handle all
                subsequent triggerable events for that workarea, until it is
                disabled or uninstalled.

                An installed trigger function can be temporarily disabled,
                by using the TRIGGER_DISABLE constant.  This would result
                in all triggerable events being controlled by the default
                actions in Sx_DefTrigger().

                A disabled trigger function can be reactivated by using the
                TRIGGER_ENABLE constant.

                To totally remove a previously installed trigger function,
                use the TRIGGER_REMOVE constant.

  Example:


    /*
       The following example uses a custom trigger function that handles
       special operations for two different events:

        1.  Looks for and, if found, reads in a <cDBFname>.INI file for
            each database file that is opened.  (See the ".INI Files"
            section for more details on their use.)

        2.  Prompts the user for a password upon opening a data file.  If
            the password is not kosher, it transfers trigger control to a
            different user-defined trigger function "LimitTrig()".  (The
            source for LimitTrig() is not shown.)

        3.  Displays an "Are you sure?" message whenever a ZAP command is
            issued.
    */

    #include "INKEY.CH"
    #include "SIXCDX.CH"

    Sx_SetPass( "Pengo" )
    USE test VIA "SIXCDX" TRIGGER "CustomTrig"
    browse()

    //----------------------------------------------------------//
    FUNC CustomTrig( nEvent, nArea, nFieldPos, xTrigVal )

       LOCAL nKey := 0, cPassWord := Space(10)
       LOCAL GetList := {}

       DO CASE

          CASE nEvent == EVENT_PREUSE

             _sx_INIinit( nArea )         // Read in .INI file information

             @ MaxRow(),0 SAY "PASSWORD:" GET cPassWord
             READ

             IF LastKey() == K_ESC .or. cPassWord != "FooBar"
                Sx_SetTrigger( TRIGGER_INSTALL, "LimitTrig" )
             ENDIF

          CASE nEvent == EVENT_ZAP

             nKey := Alert( "ZAP : Are you sure?", {"Yes","No"} )
             if nKey == 1
                Return( .T. )  // Okay to ZAP
             else
                Return( .F. )  // Don't ZAP
             endif

       ENDCASE

    Return( .T. )




  Sx_DefTrigger():

  Syntax:   Sx_DefTrigger( <nEvent>, <nArea>, <nFieldPos>, <xTrigVal> )

        nEvent = A numeric value indicating the type of event that is
                 activating the trigger.  These values are defined as
                 manifest constants in the SIXCDX.CH file, and are as
                 follows:

                 EVENT_PREUSE       = A DBF file is about to be opened
               * EVENT_POSTUSE      = A DBF file has just been opened
               * EVENT_UPDATE       = An index is being updated
                 EVENT_APPEND       = A new record is being appended
                 EVENT_DELETE       = A record is being deleted
                 EVENT_RECALL       = A deleted record is being recalled
                 EVENT_PACK         = The DBF file is being packed
                 EVENT_ZAP          = The DBF file is being zapped
                 EVENT_PUT          = A value is being stored in the DBF
                 EVENT_GET          = A value is being retrieved from the DBF
                 EVENT_PRECLOSE     = The DBF file is about to be closed
               * EVENT_POSTCLOSE    = The DBF file has just been closed
                 EVENT_PREMEMOPACK  = A MEMOPACK is just about to occur
                 EVENT_POSTMEMOPACK = A MEMOPACK has just been completed

                 NOTE:  Although these constants preprocess into numeric
                        values, you should not use the numeric values in
                        your source code.  Instead, you should use the
                        constants, as defined above.  This will insure
                        compatibility with all future releases of the
                        SIx Driver.

               (*) - The events marked with an asterisk (*) will continue
                     even if the return value for that event is set to false
                     (.F.).  This is to insure data integrity.

         nArea = The currently active workarea number.

     nFieldPos = The field position for the PUT or GET, if applicable.

      xTrigVal = This parameter contains the value, if any, associated with
                 the event being processed.  If no value of significance is
                 associated with the event, a zero (0) is passed down.

  Returns:   Logical.  TRUE (.T.) if the current event should be allowed to
             successfully complete, FALSE (.F.) if not.

  Description:  By default, this function is automatically called whenever
                any of the events listed above occurs.  It contains the
                default triggers (none) to be attached to each event.

                The parameters are passed to it automatically by the SIx
                Driver.  This is similar to the way parameters are
                automatically passed to a UDF used in Clipper's MemoEdit()
                or AChoice() functions.

                To cause the SIx Driver to use a different set of triggers,
                you would USE the file with the TRIGGER keyword, specifying
                the name of the desired trigger function in quotes.  For
                example, to use a modified Sx_DefTrigger() function called
                DemoTrigger(), you would do this:

                    USE test VIA "SIXCDX" TRIGGER "DemoTrigger"

                This would cause all triggerable events for this workarea to
                be handled through DemoTrigger(), rather than the SIx
                Driver's default Sx_DefTrigger() function.

                The Clipper source code for Sx_DefTrigger() is contained in
                SIXTRIG.PRG, and can be modified as desired.  Just insure
                that the new SIXTRIG.OBJ module is linked into your
                application ahead of the SIXCDX.LIB file.  The complete
                source for Sx_DefTrigger() is also listed below in the
                Example section.

                In its present condition, Sx_DefTrigger() maintains the
                exact same behavior as in previous SIx Driver releases.
                The call to Sx_SetTrigger( TRIGGER_REMOVE ) under the
                EVENT_PREUSE case effectively removes the trigger controls
                just prior to a database being opened.  To allow support
                for event trigger handling, just comment out this call to
                Sx_SetTrigger().

                Also, if you want the SIx Driver to automatically look for
                an associated .INI file when a .DBF is USEd, you need to
                uncomment the _sx_INIinit( nArea ) call.  See the section
                on ".INI Files" for more details on these.  The _sx_INIinit()
                function can ONLY be used in this manner.  If it is called
                anywhere else in your application, unpredictable results can
                occur.


    NOTE:  See the TRIGDEMO.PRG file for an example of using event triggers.


  Example:

    #include "SIXCDX.CH"

    FUNC Sx_DefTrigger( nEvent, nArea, nFieldPos, xTrigVal )

      DO CASE

        CASE nEvent == EVENT_PREUSE
    //    _sx_INIinit( nArea )
          Sx_SetTrigger( TRIGGER_REMOVE )

        CASE nEvent == EVENT_POSTUSE

        CASE nEvent == EVENT_UPDATE

        CASE nEvent == EVENT_APPEND

        CASE nEvent == EVENT_DELETE

        CASE nEvent == EVENT_RECALL

        CASE nEvent == EVENT_PACK

        CASE nEvent == EVENT_ZAP

        CASE nEvent == EVENT_PUT

        CASE nEvent == EVENT_GET

        CASE nEvent == EVENT_PRECLOSE

        CASE nEvent == EVENT_POSTCLOSE

        CASE nEvent == EVENT_PREMEMOPACK

        CASE nEvent == EVENT_POSTMEMOPACK

      ENDCASE

    Return( .T. )
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From druzus at priv.onet.pl  Wed Sep 19 10:06:02 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 19 10:06:11 2007
Subject: R: [Harbour] Triggers over all RDD ?
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03809A915@SRV02.deltain.net>
References: <46B96BE4.5020704@marchuet.net>
	<AFB948164110ED43B5EB849E8DEEF03809A843@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03809A915@SRV02.deltain.net>
Message-ID: <20070919140602.GA17226@localhost.localdomain>

On Wed, 19 Sep 2007, Massimo Belgrano wrote:
> I am very intrrested too
> Same news?

See the ChangeLog.

best regards,
Przemek
From druzus at priv.onet.pl  Wed Sep 19 10:15:28 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 19 10:15:34 2007
Subject: [Harbour] Ole2 contrib buggy ?
In-Reply-To: <005d01c7fa9e$d4be5a50$1700000a@PcJuanxp>
References: <20070918184125.GA5663@localhost.localdomain>
	<005d01c7fa9e$d4be5a50$1700000a@PcJuanxp>
Message-ID: <20070919141528.GA17358@localhost.localdomain>

On Wed, 19 Sep 2007, Juan G?lvez wrote:
> Przemek,
> I'm very sorry for your loss of time but I think I've discovered the real 
> problem is FWH.
> I've modified the original TActiveX class of FWH to use a TOleAuto object 
> and the fact that xHarbour doesn't show any memory leak made me to suppose 
> that TOleAuto of Harbour was the problem.
> I've tested a FWH sample with its original TActiveX class and Harbour and 
> the memory leaks appear.
> I'll contact to Antonio and I'll explain the problem.
> Do you have any idea why xHarbour doesn't show any memory leak ?

You have to be sure that you linked your xHarbour application with
memory statistic module. For some linkers REQUEST HB_FM_STAT may not
be enough and can still links applicatin with  FM module without
memory statistic. TO check run your xHarbur application with //info
switch. You should seen an informations about xHarbour libraries used
to link final application. If you are using WinXP then in console
window you can redirect the stderr output to file. Run your appication
by:
    <myprog> //info 2>log.err

and then check what it in log.err file. MemStat:[Off|On] will inform you
if memory statistic is linked or not.

best regards,
Przemek
From mbelgrano at deltain.it  Wed Sep 19 12:30:24 2007
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Sep 19 12:30:43 2007
Subject: R: R: [Harbour] Triggers over all RDD ?
In-Reply-To: <20070919140602.GA17226@localhost.localdomain>
References: <46B96BE4.5020704@marchuet.net><AFB948164110ED43B5EB849E8DEEF03809A843@SRV02.deltain.net><AFB948164110ED43B5EB849E8DEEF03809A915@SRV02.deltain.net>
	<20070919140602.GA17226@localhost.localdomain>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03809A91B@SRV02.deltain.net>

Very thanks 

2007-09-13 16:40 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/Makefile
  + harbour/include/hbsxdef.ch
  * harbour/include/dbinfo.ch
  * harbour/include/hbrdddbf.h
  * harbour/include/hbrddcdx.h
  * harbour/include/hbrddntx.h
  * harbour/contrib/bmdbfcdx/hbrddbmcdx.h
  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/workarea.c
    + added SIx3 compatible triggers support
      They should work like in SIx3 with some intentional excpetions:
         1) if 4-th parameter exists (PREUSE/GET/PUT) then it's passed by
            reference otherwise is not passed at all and PCOUNT() in trigger
            functions returns 3
            SIx3 do not pass 4-th parameter by reference and if it not
            exist then passes 0
         2) EVENT_POSTCLOSE is executed after SUPER_CLOSE()
            SIx3 executes EVENT_POSTCLOSE just before SUPER_CLOSE()
         3) EVENT_UPDATE is executed _ALWAYS_ when DBF is updated also
            when WA does not have open indexes
            SIx3 executes EVENT_UPDATE only when at least one index is
            open without checking if it's updated or not
         4) EVENT_POSTUSE is executed from OPEN() method in "DBF" RDD not
            from index RDDs so before the indexes are open
            SIx3 executes EVENT_POSTUSE after opening indexes
            It's possible that I'll change this condition in the future

-----Messaggio originale-----
Da: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] Per conto di Przemyslaw Czerpak
Inviato: mercoled? 19 settembre 2007 16.06
A: Harbour Project Main Developer List.
Oggetto: Re: R: [Harbour] Triggers over all RDD ?

On Wed, 19 Sep 2007, Massimo Belgrano wrote:
> I am very intrrested too
> Same news?

See the ChangeLog.

best regards,
Przemek
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From gvarona at ec-red.com  Wed Sep 19 19:40:06 2007
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Wed Sep 19 19:33:58 2007
Subject: [Harbour] =?ISO-8859-1?Q?=BFC=F3mo_puedo_saber_que_f?=
	=?ISO-8859-1?Q?unciones_tiene_una_Librer=EDa=3F_/_How_can_?=
	=?ISO-8859-1?Q?I_know_that_functions_has_a_Library_=28*=2E?=
	=?ISO-8859-1?Q?a=29=3F_?=
In-Reply-To: <46EFD20A.3050903@ec-red.com>
References: <46EFD20A.3050903@ec-red.com>
Message-ID: <46F1B356.8020207@ec-red.com>

Se puede hacer esto?
alqun TIP?

This it can be done? 
Any HINT? 

TIA

Best Regards
GVS

Guillermo Varona Silup? escribi?:

> Hola / Hi:
> ?C?mo puedo saber que funciones tiene una Librer?a?
> Existe algun comando o algo similar para obtener una lista de las
> funciones que contiene una libreria.
>
> How can I know that functions has a Library (*.a)?
> It exists any command or somewhat similar to obtain a list of the
> functions that contains a LIB (*.a)
>
> Gracias de Antemano
> TIA
>
> Salu2,
> GVS
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>

From teo at windtelsoft.com  Wed Sep 19 20:28:14 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Wed Sep 19 20:28:55 2007
Subject: [Harbour]
	=?iso-8859-1?q?=BFC=F3mo_puedo_saber_que_funciones_tiene_una_Librer=EDa=3F?=
	=?iso-8859-1?q?_/_How_can_I_know_that_functions_has_a_Library?= (*.a)?
In-Reply-To: <46F1B356.8020207@ec-red.com>
References: <46EFD20A.3050903@ec-red.com> <46F1B356.8020207@ec-red.com>
Message-ID: <200709191928.14296.teo@windtelsoft.com>

On Wednesday 19 September 2007 06:40:06 pm Guillermo Varona Silup? wrote:
> Se puede hacer esto?
> alqun TIP?
>
> This it can be done?
> Any HINT?
>
> TIA
>
> Best Regards
> GVS
>
> Guillermo Varona Silup? escribi?:
> > Hola / Hi:
> > ?C?mo puedo saber que funciones tiene una Librer?a?
> > Existe algun comando o algo similar para obtener una lista de las
> > funciones que contiene una libreria.
> >
> > How can I know that functions has a Library (*.a)?
> > It exists any command or somewhat similar to obtain a list of the
> > functions that contains a LIB (*.a)

Utiliza el comando nm, puedes utilizarlo para mostrar el contenido de los 
simbolos de uno o mas archivos *.o, *.a

$ nm mylibrary.a

el manual esta en:

$ man nm 

No estoy seguro pero si no tienes esta utileria debes instalar el paquete 
binutils.


best regards

Teo Fonrouge
From druzus at priv.onet.pl  Wed Sep 19 20:30:04 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 19 20:30:44 2007
Subject: [Harbour] =?iso-8859-2?B?P0PzbW8gcHVl?=
	=?iso-8859-2?Q?do_saber_que_funciones_tiene_una_Librer=EDa?=
	=?iso-8859-2?Q?=3F?= / How can I know that functions has a Library
	(*.a)? 
In-Reply-To: <46F1B356.8020207@ec-red.com>
References: <46EFD20A.3050903@ec-red.com> <46F1B356.8020207@ec-red.com>
Message-ID: <20070920003004.GA20279@localhost.localdomain>

On Wed, 19 Sep 2007, Guillermo Varona Silup? wrote:
> >How can I know that functions has a Library (*.a)?
> >It exists any command or somewhat similar to obtain a list of the
> >functions that contains a LIB (*.a)

    man nm

and then:

    nm <libname>.a | grep " T HB_FUN_" | sed -e 's/^.* HB_FUN_//g'

best regards,
Przemek
From gvarona at ec-red.com  Wed Sep 19 21:00:19 2007
From: gvarona at ec-red.com (=?ISO-8859-2?Q?Guillermo_Varona_Silup=FA?=)
Date: Wed Sep 19 20:54:17 2007
Subject: [Harbour] =?ISO-8859-2?Q?=3FC=F3mo_puedo_saber_que_f?=
	=?ISO-8859-2?Q?unciones_tiene_una_Librer=EDa=3F_/_How_can_?=
	=?ISO-8859-2?Q?I_know_that_functions_has_a_Library_=28*=2E?=
	=?ISO-8859-2?Q?a=29=3F?=
In-Reply-To: <20070920003004.GA20279@localhost.localdomain>
References: <46EFD20A.3050903@ec-red.com> <46F1B356.8020207@ec-red.com>
	<20070920003004.GA20279@localhost.localdomain>
Message-ID: <46F1C623.3050805@ec-red.com>

Przemyslaw Czerpak escribi?:

>On Wed, 19 Sep 2007, Guillermo Varona Silup? wrote:
>  
>
>>>How can I know that functions has a Library (*.a)?
>>>It exists any command or somewhat similar to obtain a list of the
>>>functions that contains a LIB (*.a)
>>>      
>>>
>
>    man nm
>
>and then:
>
>    nm <libname>.a | grep " T HB_FUN_" | sed -e 's/^.* HB_FUN_//g'
>  
>
Gracias por sus repuestas
Habra algo similar para WindowsXP?

Thanks by its replacements. 
There will be somewhat similar for WindowsXP?  

Best Regards.
GVS
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20070919/5331f716/attachment.html
From lkrausem at shaw.ca  Wed Sep 19 22:14:48 2007
From: lkrausem at shaw.ca (Luis Krause Mantilla)
Date: Wed Sep 19 22:15:42 2007
Subject: [Harbour] =?ISO-8859-2?Q?=3FC=F3mo_puedo_saber_que_f?=
	=?ISO-8859-2?Q?unciones_tiene_una_Librer=EDa=3F_/_How_can_?=
	=?ISO-8859-2?Q?I_know_that_functions_has_a_Library_=28*=2E?=
	=?ISO-8859-2?Q?a=29=3F?=
In-Reply-To: <46F1C623.3050805@ec-red.com>
References: <46EFD20A.3050903@ec-red.com> <46F1B356.8020207@ec-red.com>
	<20070920003004.GA20279@localhost.localdomain>
	<46F1C623.3050805@ec-red.com>
Message-ID: <46F1D798.6030403@shaw.ca>

Guillermo:

Tlib.exe sirve para tal efecto:

TLIB libname [/C] [/E] [/P] [/0] commands, listfile

p.ej

tlib  fiveh.lib, fiveh.lst

fiveh.lst es un archivo de texto listando las funciones en fiveh.lib.

Este ejecutable es de Borland; el de Microsoft funciona muy parecido.

Guillermo Varona Silup? wrote:

> Przemyslaw Czerpak escribi?:
>
>>On Wed, 19 Sep 2007, Guillermo Varona Silup? wrote:
>>  
>>
>>>>How can I know that functions has a Library (*.a)?
>>>>It exists any command or somewhat similar to obtain a list of the
>>>>functions that contains a LIB (*.a)
>>>>      
>>>>
>>
>>    man nm
>>
>>and then:
>>
>>    nm <libname>.a | grep " T HB_FUN_" | sed -e 's/^.* HB_FUN_//g'
>>  
>>
> Gracias por sus repuestas
> Habra algo similar para WindowsXP?
>
> Thanks by its replacements. 
> There will be somewhat similar for WindowsXP?  
>
> Best Regards.
> GVS
>
>------------------------------------------------------------------------
>
>_______________________________________________
>Harbour mailing list
>Harbour@harbour-project.org
>http://lists.harbour-project.org/mailman/listinfo/harbour
>  
>

-- 
Luis Krause Mantilla
lkrausem at shaw dot ca
luis_krause at hotmail dot com
"May the Source be with GNU"


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20070919/8f20e307/attachment.html
From lorenzo.fiorini at gmail.com  Thu Sep 20 00:51:50 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 20 00:51:56 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
Message-ID: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>

I'd like to buy a MacBook or other Mac to build Mac version of Harbour apps.

Any advice? Is 1GB enough?

best regards,
Lorenzo
From harbour.01 at syenar.hu  Thu Sep 20 00:58:00 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 00:58:12 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
References: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
Message-ID: <DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>

Hi Lorenzo,

I have 1.25GB in mine, and it's okey for most basic
applications, but I'd recommend 2GB (or even more if
you can afford and the machine supports it) for development.

(OS X loves RAM.)

Brgds,
Viktor

On 2007.09.20., at 6:51, Lorenzo Fiorini wrote:

> I'd like to buy a MacBook or other Mac to build Mac version of  
> Harbour apps.
>
> Any advice? Is 1GB enough?
>
> best regards,
> Lorenzo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Thu Sep 20 01:11:07 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 20 01:11:11 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>
References: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
	<DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>
Message-ID: <9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>

On 9/20/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> I have 1.25GB in mine, and it's okey for most basic
> applications, but I'd recommend 2GB (or even more if
> you can afford and the machine supports it) for development.
>
> (OS X loves RAM.)

Thanks for the reply.

Do you have a MacBook?

Would youy buy a MacBookPro?

best regards,
Lorenzo
From devlist.harbour at gmail.com  Thu Sep 20 01:25:56 2007
From: devlist.harbour at gmail.com (Patrick Mast, xHarbour.com)
Date: Thu Sep 20 01:26:06 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>
References: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
	<DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>
	<9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>
Message-ID: <E8548AEE-FB93-43CF-BCB1-6998FFB330B8@GMail.com>

Hey Lorenzo,

>> I have 1.25GB in mine, and it's okey for most basic
>> applications, but I'd recommend 2GB (or even more if
>> you can afford and the machine supports it) for development.
>>
>> (OS X loves RAM.)
>
> Thanks for the reply.
> Do you have a MacBook?
> Would youy buy a MacBookPro?

I have a Macbook and a MacBook Pro. I'd recommend a MacBook Pro as it  
has a better video card. Some apps don't run in the macbook because  
of its lower video card.

Since I use mac's, I think I never will return to PC's. I never have  
to reformat my mac, as i see my fellow PC users do every x,y,z months :)

I DO use Parallels as my virtualization software to run Windows apps.  
This way I have the best of both worlds. My MacBook Pro has 2GB of  
Ram. I never encounter situation where I'm in the need for more RAM.

Mac is pure quality!

Patrick

PS. I think that there will be new MacBook Pro's this year, so, if I  
was you and you can wait a bit, wait. There will be a new OS in  
October, and maybe it will come together with new MacPro's or/and new  
MacBook Pro's. Never sure though about new releases on the Apple  
front, so don't quote me on this :)
From lorenzo.fiorini at gmail.com  Thu Sep 20 01:32:51 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 20 01:32:55 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <E8548AEE-FB93-43CF-BCB1-6998FFB330B8@GMail.com>
References: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
	<DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>
	<9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>
	<E8548AEE-FB93-43CF-BCB1-6998FFB330B8@GMail.com>
Message-ID: <9257026e0709192232i9a49e2dpd2f8fe917cfc95cf@mail.gmail.com>

On 9/20/07, Patrick Mast, xHarbour.com <devlist.harbour@gmail.com> wrote:

> I have a Macbook and a MacBook Pro. I'd recommend a MacBook Pro as it
> ...
> front, so don't quote me on this :)

Many thanks Patrick.

I'll follow your advices.

It  could be my Xmas gift :)

best regards,
Lorenzo
From devlist.harbour at gmail.com  Thu Sep 20 02:51:28 2007
From: devlist.harbour at gmail.com (Patrick Mast, xHarbour.com)
Date: Thu Sep 20 02:53:16 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <9257026e0709192232i9a49e2dpd2f8fe917cfc95cf@mail.gmail.com>
References: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
	<DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>
	<9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>
	<E8548AEE-FB93-43CF-BCB1-6998FFB330B8@GMail.com>
	<9257026e0709192232i9a49e2dpd2f8fe917cfc95cf@mail.gmail.com>
Message-ID: <B6EEA444-FC94-41FB-8FF3-1353EECD439C@GMail.com>

Hey Lorenzo,

>> I have a Macbook and a MacBook Pro. I'd recommend a MacBook Pro as it
>> ...
>> front, so don't quote me on this :)
>
> Many thanks Patrick.
> I'll follow your advices.
> It  could be my Xmas gift :)

This is the perfect super gift for Xmas!! ;-)

Success!

Patrick
From antonioharbour at gmail.com  Thu Sep 20 04:13:41 2007
From: antonioharbour at gmail.com (Antonio Linares)
Date: Thu Sep 20 04:14:33 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <B6EEA444-FC94-41FB-8FF3-1353EECD439C@GMail.com>
Message-ID: <46f22bdf.2871420a.2362.05e5@mx.google.com>

> This is the perfect super gift for Xmas!! ;-)

No need to wait for Xmas :-)

You can get it for 600 euros (Core Duo E6600 2,4, same as iMac 24) and run
Linux, Windows (Vista and XP) and OSX (Tiger and beta Leopard) on it,
natively!

http://www.osx86project.org/

;-)

Antonio

From harbour.01 at syenar.hu  Thu Sep 20 05:09:09 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 05:09:18 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>
References: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
	<DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>
	<9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>
Message-ID: <FEBF0DF9-7AB1-423B-AC93-98FBF6B985D9@syenar.hu>


On 2007.09.20., at 7:11, Lorenzo Fiorini wrote:

> On 9/20/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
>
>> I have 1.25GB in mine, and it's okey for most basic
>> applications, but I'd recommend 2GB (or even more if
>> you can afford and the machine supports it) for development.
>>
>> (OS X loves RAM.)
>
> Thanks for the reply.
>
> Do you have a MacBook?
>
> Would youy buy a MacBookPro?

Definitely. I have a 2004 PowerBook G4, working perfectly.
I'd probably buy a MacBook Pro, but the MacBook is also
pretty good (except maybe the glossy display).

Brgds,
Viktor

>
> best regards,
> Lorenzo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Thu Sep 20 05:16:21 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 05:16:31 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <E8548AEE-FB93-43CF-BCB1-6998FFB330B8@GMail.com>
References: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
	<DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>
	<9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>
	<E8548AEE-FB93-43CF-BCB1-6998FFB330B8@GMail.com>
Message-ID: <F9136707-4B15-4176-8EEB-F75467815ABC@syenar.hu>

I can second that. This machine works everytime I open
the lid, sleeps in a few seconds everytime I close it,
and there is really no such permanent fiddling as with
Windows. The whole experience is leaps better, I just
simply love it.

As my next step I'll probably get rid of my classic
desktop mid-tower PC ("beige-box") for a Mac.

Brgds,
Viktor

On 2007.09.20., at 7:25, Patrick Mast, xHarbour.com wrote:

> Hey Lorenzo,
>
>>> I have 1.25GB in mine, and it's okey for most basic
>>> applications, but I'd recommend 2GB (or even more if
>>> you can afford and the machine supports it) for development.
>>>
>>> (OS X loves RAM.)
>>
>> Thanks for the reply.
>> Do you have a MacBook?
>> Would youy buy a MacBookPro?
>
> I have a Macbook and a MacBook Pro. I'd recommend a MacBook Pro as  
> it has a better video card. Some apps don't run in the macbook  
> because of its lower video card.
>
> Since I use mac's, I think I never will return to PC's. I never  
> have to reformat my mac, as i see my fellow PC users do every x,y,z  
> months :)
>
> I DO use Parallels as my virtualization software to run Windows  
> apps. This way I have the best of both worlds. My MacBook Pro has  
> 2GB of Ram. I never encounter situation where I'm in the need for  
> more RAM.
>
> Mac is pure quality!
>
> Patrick
>
> PS. I think that there will be new MacBook Pro's this year, so, if  
> I was you and you can wait a bit, wait. There will be a new OS in  
> October, and maybe it will come together with new MacPro's or/and  
> new MacBook Pro's. Never sure though about new releases on the  
> Apple front, so don't quote me on this :)
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Thu Sep 20 05:48:21 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 20 05:48:25 2007
Subject: [Harbour] Differences building apps with Harbour and xHarbour
Message-ID: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>

I'm not asking anything and I don't want to start flames.
I list only what I've found different building MY apps and keeping in
sync some RTL "customizations".

IMHO reducing some "casual and unwanted differences" would be good for all.

legend:
HB=Harbour XHB=xHarbour
[HB|XHB] has means the the other hasn't
[HB|XHB]= means different names for a "comparable thing"

list:
- XHB=IN HB=$
- XHB has LIKE
- XHB has HBLOG functions
- HB has hbcompat.ch ( to help port XHB prgs )
- common.ch is different
- HB compiler has -kM switch
- XHB compiler has -J<app>.hil ( and some i18n support )
- pcre lib HB=hbpcre XHB=pcrepos
( here I vote for hbpcre )
- contrib/gd HB=hbgd XHB=gdlib
( here I vote for hbgd )
- XHB gt subsys "requires" gtnul HB doesn't have it
- HB gt subsys has gttrm as default for Linux/Unix XHB doesn't have it
- XHB has HB_OpenProcess/HB_ProcessValue
- HB has #pragma escapedstrings = on
- HB has SET EOL <eol>
- XHB has some trace functions at prg level like valtoprg, tracelog, ...
- XHB shell scripts are xhb* HB are hb*

P.S. if xHarbour would use -W2 to warn about unused prg's vars in RTL it would
help to move code from xHarbour to Harbour.

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Thu Sep 20 05:56:38 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 20 05:56:43 2007
Subject: [Harbour] I'd like to buy a Mac to build Harbour apps. Any advice?
In-Reply-To: <FEBF0DF9-7AB1-423B-AC93-98FBF6B985D9@syenar.hu>
References: <9257026e0709192151x52ada2d1o56090401b7de2c28@mail.gmail.com>
	<DA415221-8834-4E6A-BACD-19183CF52D38@syenar.hu>
	<9257026e0709192211x2bf4b4e5u7ed54995f6e13eaa@mail.gmail.com>
	<FEBF0DF9-7AB1-423B-AC93-98FBF6B985D9@syenar.hu>
Message-ID: <9257026e0709200256m8595bf3l525b1e5df08ae458@mail.gmail.com>

On 9/20/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> Definitely. I have a 2004 PowerBook G4, working perfectly.
> I'd probably buy a MacBook Pro, but the MacBook is also
> pretty good (except maybe the glossy display).

Thanks for the informations.

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Thu Sep 20 06:01:26 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 20 06:01:35 2007
Subject: [Harbour] hbmk -gh tries to link .o
Message-ID: <9257026e0709200301i329a2298r667a807aa58a6a12@mail.gmail.com>

Not a big problem but it can confuse.

best regards,
Lorenzo

Harbour devel build 1.1-1 Intl.
Copyright 1999-2007, http://www.harbour-project.org/
Compiling 'demo2.prg'...
Lines 144, Functions/Procedures 1
Generating Harbour Portable Object source output to 'demo2.hrb'... Done.
gcc: ./demo2.o: No such file or directory
From lorenzo.fiorini at gmail.com  Thu Sep 20 06:14:17 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 20 06:14:20 2007
Subject: [Harbour] #ifdef __HARBOUR__ question
Message-ID: <9257026e0709200314g4a1c6b28odd9d5c59b4369158@mail.gmail.com>

Since __HARBOUR__ is true also for xHarbour I use sth like:

#ifdef __HARBOUR__
#ifndef __XHARBOUR__
DYNAMIC HRBMAIN
#endif
#endif

is there a define that is true ONLY for Harbour?

best regards,
Lorenzo
From miguelangel at marchuet.net  Thu Sep 20 06:21:07 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Thu Sep 20 06:27:20 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps with
 Harbour and	xHarbour
In-Reply-To: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
Message-ID: <46F24993.1020303@marchuet.net>

and what about of:

"abcd"[2] => "b"

is posible in xHarbour but not in Harbour
From teo at windtelsoft.com  Thu Sep 20 07:01:32 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Thu Sep 20 07:01:39 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <46F24993.1020303@marchuet.net>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<46F24993.1020303@marchuet.net>
Message-ID: <200709200601.32838.teo@windtelsoft.com>

On Thursday 20 September 2007 05:21:07 am Miguel Angel Marchuet wrote:
> and what about of:
>
> "abcd"[2] => "b"
>
> is posible in xHarbour but not in Harbour

With the Harbour's capability to extend the scalar types as classes, you can 
do this:

[prg]
#include "hbclass.ch"

FUNCTION Main
  LOCAL s
  LOCAL i

  ACCEPT "Enter any string:" TO s

  FOR i:=1 TO s:Size
    ? i, s[i]
  NEXT

  WAIT

RETURN NIL

CLASS HBCHARACTER
  METHOD Index OPERATOR "[]"
  METHOD Size INLINE Len( Self )
ENDCLASS

METHOD Index( n ) CLASS HBCHARACTER
RETURN SubStr( Self, n, 1 )
[/prg]


best regards

Teo Fonrouge
From harbour.01 at syenar.hu  Thu Sep 20 07:15:05 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 07:15:13 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709200601.32838.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<46F24993.1020303@marchuet.net>
	<200709200601.32838.teo@windtelsoft.com>
Message-ID: <5AFE04DD-E6B9-45A5-AA07-A52A88589023@syenar.hu>

Very nice!

To lessen the differences between Harbour and xhb, we
could add a new compatibility lib (named hbxhb for example)
into contrib where those parts could be implemented
(ported). This would allow to add extensions like this
one, above the current one implemented in hbcompat.ch
(which has its limits of course).

This work could be done without the strict Harbour core
rules.

Or, to extend the idea a bit, we could have a whole tree
dedicated to compatibility libs for different flavours
of the Clipper language implementation. Including all
sort of extensions via HB_COMPAT_* macros are more and
more becoming a problem, and it's not very flexible
either, since one needs to rebuild the whole Harbout
to include/exclude some of them. Of course, not
everything can be implemented as a separate lib, but I
think it's a good direction.

So, at the end of the developers can choose to link-in extra
libs if they need some non-C5.2 (or now C5.3) compatible features.

Any thoughs on this?

Brgds,
Viktor

On 2007.09.20., at 13:01, Teo Fonrouge wrote:

> On Thursday 20 September 2007 05:21:07 am Miguel Angel Marchuet wrote:
>> and what about of:
>>
>> "abcd"[2] => "b"
>>
>> is posible in xHarbour but not in Harbour
>
> With the Harbour's capability to extend the scalar types as  
> classes, you can
> do this:
>
> [prg]
> #include "hbclass.ch"
>
> FUNCTION Main
>   LOCAL s
>   LOCAL i
>
>   ACCEPT "Enter any string:" TO s
>
>   FOR i:=1 TO s:Size
>     ? i, s[i]
>   NEXT
>
>   WAIT
>
> RETURN NIL
>
> CLASS HBCHARACTER
>   METHOD Index OPERATOR "[]"
>   METHOD Size INLINE Len( Self )
> ENDCLASS
>
> METHOD Index( n ) CLASS HBCHARACTER
> RETURN SubStr( Self, n, 1 )
> [/prg]
>
>
> best regards
>
> Teo Fonrouge
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From miguelangel at marchuet.net  Thu Sep 20 07:27:49 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Thu Sep 20 07:34:04 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and xHarbour
In-Reply-To: <200709200601.32838.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>	<46F24993.1020303@marchuet.net>
	<200709200601.32838.teo@windtelsoft.com>
Message-ID: <46F25935.1020807@marchuet.net>

Thank's good idea :)

But not the same speed :(

Best regards,
Miguel Angel Marchuet

Teo Fonrouge escribi?:
> On Thursday 20 September 2007 05:21:07 am Miguel Angel Marchuet wrote:
>> and what about of:
>>
>> "abcd"[2] => "b"
>>
>> is posible in xHarbour but not in Harbour
> 
> With the Harbour's capability to extend the scalar types as classes, you can 
> do this:
> 
> [prg]
> #include "hbclass.ch"
> 
> FUNCTION Main
>   LOCAL s
>   LOCAL i
> 
>   ACCEPT "Enter any string:" TO s
> 
>   FOR i:=1 TO s:Size
>     ? i, s[i]
>   NEXT
> 
>   WAIT
> 
> RETURN NIL
> 
> CLASS HBCHARACTER
>   METHOD Index OPERATOR "[]"
>   METHOD Size INLINE Len( Self )
> ENDCLASS
> 
> METHOD Index( n ) CLASS HBCHARACTER
> RETURN SubStr( Self, n, 1 )
> [/prg]
> 
> 
> best regards
> 
> Teo Fonrouge
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

From druzus at priv.onet.pl  Thu Sep 20 07:37:57 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 20 07:38:03 2007
Subject: [Harbour] #ifdef __HARBOUR__ question
In-Reply-To: <9257026e0709200314g4a1c6b28odd9d5c59b4369158@mail.gmail.com>
References: <9257026e0709200314g4a1c6b28odd9d5c59b4369158@mail.gmail.com>
Message-ID: <20070920113756.GA21612@localhost.localdomain>

On Thu, 20 Sep 2007, Lorenzo Fiorini wrote:
> Since __HARBOUR__ is true also for xHarbour I use sth like:
> 
> #ifdef __HARBOUR__
> #ifndef __XHARBOUR__
> DYNAMIC HRBMAIN
> #endif
> #endif

DYNAMIC is supported also by current xHarbour versions so if you
are using some older then I suggest to add some #xcommand to your
custom hbcompat.ch, f.e.:

    #xcommand DYNAMIC <!funcName1!> [, <!funcNameN!>] =>

> is there a define that is true ONLY for Harbour?

Nothing intentional but in Harbour definition in hbsetup.ch are
included in build int PP tables so you can use one of them. Compare
include/hbstd.ch in both projects.

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Thu Sep 20 07:45:26 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Sep 20 07:45:30 2007
Subject: [Harbour] #ifdef __HARBOUR__ question
In-Reply-To: <20070920113756.GA21612@localhost.localdomain>
References: <9257026e0709200314g4a1c6b28odd9d5c59b4369158@mail.gmail.com>
	<20070920113756.GA21612@localhost.localdomain>
Message-ID: <9257026e0709200445s87e12d0s833d85c974697323@mail.gmail.com>

On 9/20/07, Przemyslaw Czerpak <druzus@priv.onet.pl> wrote:

> DYNAMIC is supported also by current xHarbour versions so if you
> are using some older then I suggest to add some #xcommand to your
> custom hbcompat.ch, f.e.:

Sorry, DYNAMIC was only an example.

> Nothing intentional but in Harbour definition in hbsetup.ch are
> included in build int PP tables so you can use one of them. Compare
> include/hbstd.ch in both projects.

Many thanks.

best regards,
Lorenzo
From harbour.01 at syenar.hu  Thu Sep 20 07:47:53 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 07:48:01 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and xHarbour
In-Reply-To: <46F25935.1020807@marchuet.net>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>	<46F24993.1020303@marchuet.net>
	<200709200601.32838.teo@windtelsoft.com>
	<46F25935.1020807@marchuet.net>
Message-ID: <BBF63D70-9361-4871-8C84-FD936705B6F0@syenar.hu>

For speed we could introduce a new pcode for SubStr( c, n, 1 ),
so the advantage of c[ n ] would be even slimmer, yet the
language would not have an "invisible" kind of (and incompatible)
extension.

Brgds,
Viktor

On 2007.09.20., at 13:27, Miguel Angel Marchuet wrote:

> Thank's good idea :)
>
> But not the same speed :(
>
> Best regards,
> Miguel Angel Marchuet
>
> Teo Fonrouge escribi?:
>> On Thursday 20 September 2007 05:21:07 am Miguel Angel Marchuet  
>> wrote:
>>> and what about of:
>>>
>>> "abcd"[2] => "b"
>>>
>>> is posible in xHarbour but not in Harbour
>> With the Harbour's capability to extend the scalar types as  
>> classes, you can do this:
>> [prg]
>> #include "hbclass.ch"
>> FUNCTION Main
>>   LOCAL s
>>   LOCAL i
>>   ACCEPT "Enter any string:" TO s
>>   FOR i:=1 TO s:Size
>>     ? i, s[i]
>>   NEXT
>>   WAIT
>> RETURN NIL
>> CLASS HBCHARACTER
>>   METHOD Index OPERATOR "[]"
>>   METHOD Size INLINE Len( Self )
>> ENDCLASS
>> METHOD Index( n ) CLASS HBCHARACTER
>> RETURN SubStr( Self, n, 1 )
>> [/prg]
>> best regards
>> Teo Fonrouge
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Thu Sep 20 08:11:08 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 20 08:11:14 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709200601.32838.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<46F24993.1020303@marchuet.net>
	<200709200601.32838.teo@windtelsoft.com>
Message-ID: <20070920121108.GB21612@localhost.localdomain>

On Thu, 20 Sep 2007, Teo Fonrouge wrote:
> On Thursday 20 September 2007 05:21:07 am Miguel Angel Marchuet wrote:
> > and what about of:
> > "abcd"[2] => "b"
> > is posible in xHarbour but not in Harbour

This syntax is supported only when you compile Harbour with
HB_COMPAT_XHB macro but with working range checking and will
not be enabled in default build to its side effects. For sure
I will never replicate exact xHarbour behavior because it simply
disables RT error if I make some mistake in index of multidimensional
arrays, f.e.:

    proc main
    local s:="ABC"
    ? s[1,2,3,4,5,6,7,8,9]
    return

xHarbour compiles and executes this code without any errors.
In the past when I was using xHarbour for my applications I lost
much more time looking for errors in wrong indexing then I can
ever benefit from the above feature. People writing plagins for
my applications also asked me why they are not working as expected
in some cases and it was caused by typos in array indexing. Now I
simply answer: recompile the code with Harbour and check if all
indexes are correct and I do not want to return to this problem
again. For sure no one who has to use often multidimensional arrays
would never introduced such feature.
Enabling range checking like in Harbour compiled with HB_COMPAT_XHB
macro does not resolve the whole problem because cVal[n] returns
string so the above code can be changed to:

    proc main
    local s:="ABC"
    ? s[1,1,1,1,1,1,1,1,1]
    return

and now also Harbour will not generate RT error. The only one solution
for above problem is changing returning 1 character string value to
numeric value with ASCII code of given character and this is the default
Harbour behavior when compiled without HB_COMPAT_XHB and compile time
(-ks) and runtime (//FLAGS:s) switches are used. In such case:

    proc main
    local s:="ABC"
    ? s[2]
    return

shows:
        66

and:
    ? s[2,1]

generates RT error.

best regards,
Przemek
From druzus at priv.onet.pl  Thu Sep 20 08:12:12 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 20 08:12:18 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and xHarbour
In-Reply-To: <46F25935.1020807@marchuet.net>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<46F24993.1020303@marchuet.net>
	<200709200601.32838.teo@windtelsoft.com>
	<46F25935.1020807@marchuet.net>
Message-ID: <20070920121212.GC21612@localhost.localdomain>

On Thu, 20 Sep 2007, Miguel Angel Marchuet wrote:
> Thank's good idea :)
> But not the same speed :(

If speed is such important why do you use xHarbour?
It's 25-30% slower then Harbour on PCODE evaluation.

best regards,
Przemek
From teo at windtelsoft.com  Thu Sep 20 08:14:35 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Thu Sep 20 08:14:42 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <5AFE04DD-E6B9-45A5-AA07-A52A88589023@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200601.32838.teo@windtelsoft.com>
	<5AFE04DD-E6B9-45A5-AA07-A52A88589023@syenar.hu>
Message-ID: <200709200714.36305.teo@windtelsoft.com>

On Thursday 20 September 2007 06:15:05 am Szak?ts Viktor wrote:
> To lessen the differences between Harbour and xhb, we
> could add a new compatibility lib (named hbxhb for example)
> into contrib where those parts could be implemented
> (ported). This would allow to add extensions like this
> one, above the current one implemented in hbcompat.ch
> (which has its limits of course).

I believe that achieve a high grade of compatibility is not a easy task, there 
are deep differs between of two compilers.

My vote would be to create a set of resources that make easy to the 
xHarbour/Clipper/XBase++/Clip users the transition to the Harbour compiler, 
this resources would be:

  - *.ch files with preprocessor translations
  - *.prg files with the extensions that could be easy loaded in RT
    via the  __hrbLoad, __hrbRun, __hrbDo  functions.

>
> This work could be done without the strict Harbour core
> rules.

This is crucial to have a vertical evolution of the Harbour compiler.

>
> Or, to extend the idea a bit, we could have a whole tree
> dedicated to compatibility libs for different flavours
> of the Clipper language implementation. Including all
> sort of extensions via HB_COMPAT_* macros are more and
> more becoming a problem, and it's not very flexible
> either, since one needs to rebuild the whole Harbout
> to include/exclude some of them. Of course, not
> everything can be implemented as a separate lib, but I
> think it's a good direction.

See above.

>
> So, at the end of the developers can choose to link-in extra
> libs if they need some non-C5.2 (or now C5.3) compatible features.
>
> Any thoughs on this?

The Harbour compiler has many features that are unknown to the general public, 
and this adds a level more of incompatibility to the eventual users.

May be is time to start to think in a serious Documentation Project for 
Harbour.

Besides to have strong type checking in compiler time, multithreading support, 
extend the available types to integer float long etc, functions to unicode 
support .


best regards

Teo


PD: 7:15 am here . the bed calls .
From harbour.01 at syenar.hu  Thu Sep 20 08:42:40 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 08:44:14 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709200714.36305.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200601.32838.teo@windtelsoft.com>
	<5AFE04DD-E6B9-45A5-AA07-A52A88589023@syenar.hu>
	<200709200714.36305.teo@windtelsoft.com>
Message-ID: <E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>

> I believe that achieve a high grade of compatibility is not a easy  
> task, there
> are deep differs between of two compilers.

I agree, but even if there is some feature on the surface
which we need to support, it's better (but more work) to
add the necessary low-level interfaces to Harbour first,
then a standard solution can be implemented in a compatibility
dir. It all depends on the feature we're talking about,
that's true.

> My vote would be to create a set of resources that make easy to the
> xHarbour/Clipper/XBase++/Clip users the transition to the Harbour  
> compiler,
> this resources would be:
>
>   - *.ch files with preprocessor translations
>   - *.prg files with the extensions that could be easy loaded in RT
>     via the  __hrbLoad, __hrbRun, __hrbDo  functions.

Good idea, though this is just another method to use those
compatibility .prgs. Some might prefer a lib, some to load
them as .prg. Both can be supported easily. Remember though
that some features might need .c files, where lib is the
only option.

This xhb compatibility lib project can be started anytime
by those users who want it. It's just a matter of creating
a new folder in contrib and start to add ported compatibility
code.

> e Harbour compiler has many features that are unknown to the  
> general public,
> and this adds a level more of incompatibility to the eventual users.
>
> May be is time to start to think in a serious Documentation Project  
> for
> Harbour.
>
> Besides to have strong type checking in compiler time,  
> multithreading support,
> extend the available types to integer float long etc, functions to  
> unicode
> support .

Yes, documentation would need contributors, which we used
to fall short of. I kinda understand this because those
who could write great docs, usually don't need those great
docs.

Since we're compatible with C5.x most of the time, anyone
can access the original docs to create complete apps, so on the
first round we'd need to document the extensions and differences
only. There are many-many detailed mails (usually from Przemek)
on the list having good documentation of specific Harbour parts,
plus we have the docs folder with some valuable information, and
sometimes we have differences and features documented in the code.
Someone would "just" need to put these into some digestable format.

Brgds,
Viktor

From harbour.01 at syenar.hu  Thu Sep 20 08:48:00 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 08:50:14 2007
Subject: [Harbour] Differences building apps with Harbour and xHarbour
In-Reply-To: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
Message-ID: <990FFF68-49D4-4F47-8EE1-C7B3B5AB6DF1@syenar.hu>

Thanks for the list.

As for common.ch, xhb has only ISPOINTER() as an extra
which is covered in hbcompat.ch in Harbour, plus we have
hash stuff in it, which could be included in the xhb
branch of hbcompat.ch.

The rest are those OPTIMIZE_VALTYPE optimizations in
xhb, which are not needed to compile any source (but
xhb doesn't have them or at least I couldn't spot them).

Brgds,
Viktor

On 2007.09.20., at 11:48, Lorenzo Fiorini wrote:

> I'm not asking anything and I don't want to start flames.
> I list only what I've found different building MY apps and keeping in
> sync some RTL "customizations".
>
> IMHO reducing some "casual and unwanted differences" would be good  
> for all.
>
> legend:
> HB=Harbour XHB=xHarbour
> [HB|XHB] has means the the other hasn't
> [HB|XHB]= means different names for a "comparable thing"
>
> list:
> - XHB=IN HB=$
> - XHB has LIKE
> - XHB has HBLOG functions
> - HB has hbcompat.ch ( to help port XHB prgs )
> - common.ch is different
> - HB compiler has -kM switch
> - XHB compiler has -J<app>.hil ( and some i18n support )
> - pcre lib HB=hbpcre XHB=pcrepos
> ( here I vote for hbpcre )
> - contrib/gd HB=hbgd XHB=gdlib
> ( here I vote for hbgd )
> - XHB gt subsys "requires" gtnul HB doesn't have it
> - HB gt subsys has gttrm as default for Linux/Unix XHB doesn't have it
> - XHB has HB_OpenProcess/HB_ProcessValue
> - HB has #pragma escapedstrings = on
> - HB has SET EOL <eol>
> - XHB has some trace functions at prg level like valtoprg,  
> tracelog, ...
> - XHB shell scripts are xhb* HB are hb*
>
> P.S. if xHarbour would use -W2 to warn about unused prg's vars in  
> RTL it would
> help to move code from xHarbour to Harbour.
>
> best regards,
> Lorenzo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Thu Sep 20 09:16:24 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 20 09:20:53 2007
Subject: [Harbour] Differences building apps with Harbour and xHarbour
In-Reply-To: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
Message-ID: <20070920131624.GD21612@localhost.localdomain>

On Thu, 20 Sep 2007, Lorenzo Fiorini wrote:
> list:
> - XHB=IN HB=$

Not true. XHB can use IN as synonym of $.
IN in xHarbour does not make any other job then $ and is translated
by lexer to $.
$ in xHarbour has additional functionality. It can be used also for
ARRAYs and HASHes.
In Harbour such functionality is enabled by HB_COMPAT_XHB though
here I think that it may be good to enable it by default too.

> - XHB has LIKE

and also HAS. IN, HAS, LIKE are not enabled in Harbour because using
identifiers as operators breaks PP rules. In PP identifiers have different
precedence then non id characters use for operators so they cannot be
added to Harbour without breaking compatibility with Clipper.

> - XHB has HBLOG functions

Just like few other RTL functions but most of them can be collected
in separate library and added to Harbour without any problems.

> - HB has hbcompat.ch ( to help port XHB prgs )

Please note that this file has two sections. It can be usable also
in xHarbour so I suggest to add it also to xHarbour CVS.

> - common.ch is different

nothing seriously important what cannot be hidden by few rules in
hbcompat.ch

> - HB compiler has -kM switch
> - XHB compiler has -J<app>.hil ( and some i18n support )

I'll add i18n support to Harbour though I have some doubts if
reinventing the wheel is good idea. Instead of using our own
format I plan to use gettext format so it will be possible
to use a lot of well known different tools which help in
translations and also make lot of them automatically.

> - pcre lib HB=hbpcre XHB=pcrepos
> ( here I vote for hbpcre )
> - contrib/gd HB=hbgd XHB=gdlib
> ( here I vote for hbgd )
> - XHB gt subsys "requires" gtnul HB doesn't have it

Not true. Harbour have GTNUL and it's always included in RTL library.

> - HB gt subsys has gttrm as default for Linux/Unix XHB doesn't have it
> - XHB has HB_OpenProcess/HB_ProcessValue

The same as for HBLOG above.

> - HB has #pragma escapedstrings = on
> - HB has SET EOL <eol>
> - XHB has some trace functions at prg level like valtoprg, tracelog, ...

The same as for HBLOG above.

> - XHB shell scripts are xhb* HB are hb*

IMHO it's good - you can use both compilers simultaneously on the same
machine.

> P.S. if xHarbour would use -W2 to warn about unused prg's vars in RTL it would
> help to move code from xHarbour to Harbour.

This is my list oriented to core code extensions.
IMHO adding separated functions to the list does not make big sense
because anyone can port most of them between project in few hours.

XHARBOUR core extensions not supported by Harbour even with HB_COMPAT_XHB
=========================================================================
1. bit operators: BITAND(&) BITOR(|) BITXOR(^^) BITSHIFTR(>>) BITSHIFTL(<<)
2. IN, HAS, LIKE operators

   Probably I'll add #operator directive to PP so support for them can
   be added in hbcompat.ch if someone will need it.

3. using one character length string as numeric value

   Probbly will be never supported - at least I do not want to make it.
   It causes even more problems then using [] for strings.

4. reverted behavior of item references stored in arrays

   Implemented strictly (not like in xHarbour where it's not respected
   in some places) will have some good effects eliminating some Clipper
   anomalies and in general it's not bad idea. Unfortunately it breaks
   Clipper compatibility so I do not think that Harbour will support it
   (at least in default build) because users have code which needs
   original Clipper behavior. This code was using arrays as workaround
   for limited in Clipper number of function parameters.
   AFAIK in xHarbour it was reverted only for one reason: when user
   assigns item in array returned by hb_aParams() and corresponding
   parameter was passed by reference then reference is respected and
   original parameter is changed. I do not know any other reasons why
   in xHarbour it was changed breaking Clipper compatibility.

5. background tasks

   I hope we will add them with Ryszard's asynchronous task library

6. GLOBAL / GLOBAL EXTERNAL (GLOBAL_EXTERN)

   I think that I'll add them somewhere in the future but it will
   be implemented internally in different way then in xHarbour.
   In xHarbour GLOBALs can be used _ONLY_ if compiler generate C
   code and the implementation strictly depends on C compiler and
   linker behavior.

7. MT mode

   Harbour does not have MT mode yet. I'll add it but the low level
   implementation will be absolutely different then xHarbour ones.
   In fact for real MT mode it's necessary to make much deeper
   modifications then in xHarbour. In xHarbour most of subsystem was
   never updated for MT mode so xHarbour MT applications can crash
   randomly, f.e. classes code is not protected at all and new classes
   can be added dynamically. It means that if one thread executes some
   methods and other will create new class (1-st time calls class
   function) then you have very bad race condition because s_pClasses
   will be reallocated and can change its address in memory. For real
   MT mode all such problems have to be resolved.

We can also create list of Harbour features not supported by xHarbour.

best regards,
Przemek
From gvarona at ec-red.com  Thu Sep 20 11:46:05 2007
From: gvarona at ec-red.com (=?ISO-8859-2?Q?Guillermo_Varona_Silup=FA?=)
Date: Thu Sep 20 11:50:34 2007
Subject: [Harbour] =?ISO-8859-2?Q?=3FC=F3mo_puedo_saber_que_f?=
	=?ISO-8859-2?Q?unciones_tiene_una_Librer=EDa=3F_/_How_can_?=
	=?ISO-8859-2?Q?I_know_that_functions_has_a_Library_=28*=2E?=
	=?ISO-8859-2?Q?a=29=3F?=
In-Reply-To: <46F1D798.6030403@shaw.ca>
References: <46EFD20A.3050903@ec-red.com>
	<46F1B356.8020207@ec-red.com>	<20070920003004.GA20279@localhost.localdomain>	<46F1C623.3050805@ec-red.com>
	<46F1D798.6030403@shaw.ca>
Message-ID: <46F295BD.4070402@ec-red.com>

Gracias a todos.

El MinGW para Windows, tambien trae en comando nm:
Con esto obtuve una lista de funciones de la libreria libct.a:

C:\HARBOU~1\lib>\mingw\bin\nm -g libct.a >libct.lst

Best Regards.
GVS

Luis Krause Mantilla escribi?:

> Guillermo:
>
> Tlib.exe sirve para tal efecto:
>
> TLIB libname [/C] [/E] [/P] [/0] commands, listfile
>
> p.ej
>
> tlib  fiveh.lib, fiveh.lst
>
> fiveh.lst es un archivo de texto listando las funciones en fiveh.lib.
>
> Este ejecutable es de Borland; el de Microsoft funciona muy parecido.
>
> Guillermo Varona Silup? wrote:
>
>> Przemyslaw Czerpak escribi?:
>>
>>>On Wed, 19 Sep 2007, Guillermo Varona Silup? wrote:
>>>  
>>>
>>>>>How can I know that functions has a Library (*.a)?
>>>>>It exists any command or somewhat similar to obtain a list of the
>>>>>functions that contains a LIB (*.a)
>>>>>      
>>>>>
>>>
>>>    man nm
>>>
>>>and then:
>>>
>>>    nm <libname>.a | grep " T HB_FUN_" | sed -e 's/^.* HB_FUN_//g'
>>>  
>>>
>> Gracias por sus repuestas
>> Habra algo similar para WindowsXP?
>>
>> Thanks by its replacements. 
>> There will be somewhat similar for WindowsXP?  
>>
>> Best Regards.
>> GVS
>>
>>------------------------------------------------------------------------
>>
>>_______________________________________________
>>Harbour mailing list
>>Harbour@harbour-project.org
>>http://lists.harbour-project.org/mailman/listinfo/harbour
>>  
>>
>
>-- 
>Luis Krause Mantilla
>lkrausem at shaw dot ca
>luis_krause at hotmail dot com
>"May the Source be with GNU"
>
>  
>
>------------------------------------------------------------------------
>
>_______________________________________________
>Harbour mailing list
>Harbour@harbour-project.org
>http://lists.harbour-project.org/mailman/listinfo/harbour
>  
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20070920/b8c6c274/attachment.html
From devlist.harbour at gmail.com  Thu Sep 20 12:19:20 2007
From: devlist.harbour at gmail.com (Patrick Mast, xHarbour.com)
Date: Thu Sep 20 12:21:06 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200601.32838.teo@windtelsoft.com>
	<5AFE04DD-E6B9-45A5-AA07-A52A88589023@syenar.hu>
	<200709200714.36305.teo@windtelsoft.com>
	<E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
Message-ID: <B615A0FC-739D-4BBF-B56E-3C0B351F1979@GMail.com>

Hey Viktor,

>> May be is time to start to think in a serious Documentation  
>> Project for
>> Harbour.
>>
>> Besides to have strong type checking in compiler time,  
>> multithreading support,
>> extend the available types to integer float long etc, functions to  
>> unicode
>> support .
>
> Yes, documentation would need contributors, which we used
> to fall short of. I kinda understand this because those
> who could write great docs, usually don't need those great
> docs.
>
> Since we're compatible with C5.x most of the time, anyone
> can access the original docs to create complete apps, so on the
> first round we'd need to document the extensions and differences
> only. There are many-many detailed mails (usually from Przemek)
> on the list having good documentation of specific Harbour parts,
> plus we have the docs folder with some valuable information, and
> sometimes we have differences and features documented in the code.
> Someone would "just" need to put these into some digestable format.

Harbour users are off-course also welcome to use xHarbour.com's xHDN  
( xHarbour Developers Network ) pages as their documentation  
reference. It's open and free to use. More than 2.000 items are  
documented on xHDN. All the doc's on xHDN are written from scratch  
and have samples, references, etc..

The xHarbour Developer Network pages are here:
See http://www.xHarbour.com/xHDN

Patrick
From info at fsgiudice.com  Thu Sep 20 13:03:06 2007
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Thu Sep 20 13:06:52 2007
Subject: [Harbour] Differences building apps with Harbour and xHarbour
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<20070920131624.GD21612@localhost.localdomain>
Message-ID: <003f01c7fba8$1fdb6d20$ba00f50a@ASUSFSG>


----- Original Message ----- 
From: "Przemyslaw Czerpak" <druzus@priv.onet.pl>
To: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Sent: Thursday, September 20, 2007 3:16 PM
Subject: Re: [Harbour] Differences building apps with Harbour and xHarbour


> 
> 5. background tasks
> 
>   I hope we will add them with Ryszard's asynchronous task library
> 

Just as note, I have background tasks already ported and guarded from 
#ifdef HB_COMPAT_XHB / #endif
if someone needs them I can upload until Ryszard completes its new lib.

Best Regards

Francesco
From teo at windtelsoft.com  Thu Sep 20 13:34:04 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Thu Sep 20 13:48:04 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200714.36305.teo@windtelsoft.com>
	<E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
Message-ID: <200709201234.04593.teo@windtelsoft.com>

On Thursday 20 September 2007 07:42:40 am Szak?ts Viktor wrote:
> > I believe that achieve a high grade of compatibility is not a easy
> > task, there
> > are deep differs between of two compilers.
>
> I agree, but even if there is some feature on the surface
> which we need to support, it's better (but more work) to
> add the necessary low-level interfaces to Harbour first,
> then a standard solution can be implemented in a compatibility
> dir. It all depends on the feature we're talking about,
> that's true.
>
> > My vote would be to create a set of resources that make easy to the
> > xHarbour/Clipper/XBase++/Clip users the transition to the Harbour
> > compiler,
> > this resources would be:
> >
> >   - *.ch files with preprocessor translations
> >   - *.prg files with the extensions that could be easy loaded in RT
> >     via the  __hrbLoad, __hrbRun, __hrbDo  functions.
>
> Good idea, though this is just another method to use those
> compatibility .prgs. Some might prefer a lib, some to load
> them as .prg. Both can be supported easily. Remember though
> that some features might need .c files, where lib is the
> only option.
>
> This xhb compatibility lib project can be started anytime
> by those users who want it. It's just a matter of creating
> a new folder in contrib and start to add ported compatibility
> code.
>
> > e Harbour compiler has many features that are unknown to the
> > general public,
> > and this adds a level more of incompatibility to the eventual users.
> >
> > May be is time to start to think in a serious Documentation Project
> > for
> > Harbour.
> >
> > Besides to have strong type checking in compiler time,
> > multithreading support,
> > extend the available types to integer float long etc, functions to
> > unicodeI 
> > support .
>
> Yes, documentation would need contributors, which we used
> to fall short of. I kinda understand this because those
> who could write great docs, usually don't need those great
> docs.
>
> Since we're compatible with C5.x most of the time, anyone
> can access the original docs to create complete apps, so on the
> first round we'd need to document the extensions and differences
> only. There are many-many detailed mails (usually from Przemek)
> on the list having good documentation of specific Harbour parts,
> plus we have the docs folder with some valuable information, and
> sometimes we have differences and features documented in the code.
> Someone would "just" need to put these into some digestable format.

Viktor,

I would like to start some simple documentation regarding this features and 
put this files under the /doc dir, furthermore, do some cleaning and updating 
for the docs currently in that directory.

Also I might finish the conversion of TIP library in the contrib dir.

So, it would be nice that I could have write access granted to the SVN Harbour 
repository.

Can you or other project admin, kindly give me this permission ?


Thanks in advance


best regards

Teo Fonrouge
From dbtopas at dbtopas.lt  Thu Sep 20 15:41:28 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Thu Sep 20 15:42:39 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <20070920121108.GB21612@localhost.localdomain>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>	<46F24993.1020303@marchuet.net>	<200709200601.32838.teo@windtelsoft.com>
	<20070920121108.GB21612@localhost.localdomain>
Message-ID: <46F2CCE8.8060204@dbtopas.lt>

Przemyslaw Czerpak wrote:
> On Thu, 20 Sep 2007, Teo Fonrouge wrote:
>> On Thursday 20 September 2007 05:21:07 am Miguel Angel Marchuet wrote:
>>> and what about of:
>>> "abcd"[2] => "b"
>>> is posible in xHarbour but not in Harbour
> 
> This syntax is supported only when you compile Harbour with
> HB_COMPAT_XHB macro but with working range checking and will
> not be enabled in default build to its side effects. For sure
> I will never replicate exact xHarbour behavior because it simply
> disables RT error if I make some mistake in index of multidimensional
> arrays, f.e.:
> 

>     proc main
>     local s:="ABC"
>     ? s[1,2,3,4,5,6,7,8,9]
>     return
> 
> xHarbour compiles and executes this code without any errors.
> In the past when I was using xHarbour for my applications I lost
> much more time looking for errors in wrong indexing then I can
> ever benefit from the above feature. People writing plagins for
> my applications also asked me why they are not working as expected
> in some cases and it was caused by typos in array indexing.


Hello,


The same problem for me after I've changed in my source:
    aArray := {{key1, value1}, {key2, value2}, ...}
to
    aKey := {key1, key2, ...}
    aValue := {value1, value2, ...}

In one place in a loop I left my source unchanged:
    FOR nI := 1 TO LEN(aKey)
       DBSEEK(aKey[nI, 1])  // was aArray[nI, 1] should be aKey[nI]
       ...
    NEXT
The seek was made only for the first char of key and depending on 
database the results were wrong, but it was was not easy to find the reason.


I also do not like xHarbour's feature that one character strings are 
treated as integers. Well, I liked it before I found a reason for a 
strange seldom GPF.
I have SendMessage() Win API function. The last parameter of this 
function can be a number or a pointer depending on the message. My code was:
HB_FUNC( SENDMESSAGE )
{
    LPARAM   lParam;
    ...
    if ( ISNUM( 4 ) )
       lParam = (LPARAM) hb_parnl( 4 );
    else if ( ISCHAR( 4 ) )
       lParam = (LPARAM) hb_parc( 4 );
    else
       lParam = (LPARAM) NULL;
    ...
    SendMessage( hWnd, iMsg, wParam, lParam );
    ...
}

The problem is, ISNUM returns TRUE for one character strings, so I've 
send a message with pointer (char*)97 instead of (char*)"a". GPF is 
guaranteed. :)

I've changed the order of type checking in SendMessage() and it's OK 
now, but I'm still not sure:
    ? 1 + 'a'
Should it be 98 or 'b'? I guess it should be 98, but it is 'b'.


Best regards,
Mindaugas

From dbtopas at dbtopas.lt  Thu Sep 20 15:49:01 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Thu Sep 20 15:50:14 2007
Subject: [Harbour] Differences building apps with Harbour and xHarbour
In-Reply-To: <20070920131624.GD21612@localhost.localdomain>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<20070920131624.GD21612@localhost.localdomain>
Message-ID: <46F2CEAD.3050601@dbtopas.lt>

Przemyslaw Czerpak wrote:
>> - XHB compiler has -J<app>.hil ( and some i18n support )
> 
> I'll add i18n support to Harbour though I have some doubts if
> reinventing the wheel is good idea. Instead of using our own
> format I plan to use gettext format so it will be possible
> to use a lot of well known different tools which help in
> translations and also make lot of them automatically.

Hello,


I have used xHarbour's i18n and can say some comments about it.

*.hil file size grows, because text strings are appended after each 
compilation. So, I decided to collect all translations of my app in to 
separate app.hit and delete *.hil files before each recompile of the 
modules. To make a single *.hit file I've used:
   hbdict file1.hil app.hit
   hbdict file2.hil app.hit
   ...
   hbdict filen.hil app.hit
It's difficult to do because of large number of .prg modules. I wished 
to execute:
   hbdict *.hil app.hit

My application was in development stage and many messages have been 
changed. So, my app.hit file had a lot of unused string after few months 
of development. hbdict has no possibility to check if string is used or 
not. So, I've wrote my own hbdict for it. It shows table with 3 columns: 
original string, translated string and list of modules (.hil files) 
containing original string. The original hbdict has first two columns 
only. Now I can execute:
   myhbdict *.hil app.hit
and see strings of all modules, and see if string is used or not. If 
string is not used by any module I can press Del and delete it from .hit 
file.

One more problem I've encountered is that the same string should be 
translated in a different way for the different foreign languages.
Let's say I have two strings i18n("top"). The first is for top of the 
browse table. I'll translate it to lithuanian "prad?ia" (eng. 
beginning). The second is for top of the hill, and I'll translate it to 
"vir?un?" (eng. summit). So, we need something for making these string 
different for translator, but it must show the same text in the original 
source code language. Maybe some "top#1", "top#2" could be a solution. I 
can see these strings in .hil/.hit files, but i18n("top#1") should 
return "top". I've not implemented this because I still can not decide 
which "escape syntax" to use for marking a different strings. :)


Best regards,
Mindaugas


P.S. I'm just starting to read docs about GNU's gettext, so maybe these 
problems are already solved there.
From harbour.01 at syenar.hu  Thu Sep 20 15:58:26 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 15:58:41 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709201234.04593.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200714.36305.teo@windtelsoft.com>
	<E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
	<200709201234.04593.teo@windtelsoft.com>
Message-ID: <0E131A7C-00E0-4A58-92F1-9930327B071A@syenar.hu>

Hi Teo,

> I would like to start some simple documentation regarding this  
> features and
> put this files under the /doc dir, furthermore, do some cleaning  
> and updating
> for the docs currently in that directory.
>
> Also I might finish the conversion of TIP library in the contrib dir.
>
> So, it would be nice that I could have write access granted to the  
> SVN Harbour
> repository.
>
> Can you or other project admin, kindly give me this permission ?

Yes, of course, just pls give me your sourceforge user ID.

Brgds,
Viktor



From teo at windtelsoft.com  Thu Sep 20 16:31:46 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Thu Sep 20 16:31:55 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <0E131A7C-00E0-4A58-92F1-9930327B071A@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709201234.04593.teo@windtelsoft.com>
	<0E131A7C-00E0-4A58-92F1-9930327B071A@syenar.hu>
Message-ID: <200709201531.46862.teo@windtelsoft.com>

On Thursday 20 September 2007 02:58:26 pm Szak?ts Viktor wrote:
> Hi Teo,
>
> > I would like to start some simple documentation regarding this
> > features and
> > put this files under the /doc dir, furthermore, do some cleaning
> > and updating
> > for the docs currently in that directory.
> >
> > Also I might finish the conversion of TIP library in the contrib dir.
> >
> > So, it would be nice that I could have write access granted to the
> > SVN Harbour
> > repository.
> >
> > Can you or other project admin, kindly give me this permission ?
>
> Yes, of course, just pls give me your sourceforge user ID.

tfonrouge

Thank you.


best regards

Teo
From harbour.01 at syenar.hu  Thu Sep 20 17:30:57 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 17:31:10 2007
Subject: [Harbour] Differences building apps with Harbour and xHarbour
In-Reply-To: <20070920131624.GD21612@localhost.localdomain>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<20070920131624.GD21612@localhost.localdomain>
Message-ID: <33CD10D1-DFFD-40F7-9F3D-C1D72FDB7328@syenar.hu>

Hi,

>> - HB compiler has -kM switch
>> - XHB compiler has -J<app>.hil ( and some i18n support )
>
> I'll add i18n support to Harbour though I have some doubts if
> reinventing the wheel is good idea. Instead of using our own
> format I plan to use gettext format so it will be possible
> to use a lot of well known different tools which help in
> translations and also make lot of them automatically.

I agree with using gettext for this job. This would be
my app level choice and gettext does it's job prefectly
as far as I could see. It is the quasi-standard in i18n.

> 3. using one character length string as numeric value
>
>    Probbly will be never supported - at least I do not want to make  
> it.
>    It causes even more problems then using [] for strings.

This is more than scary and seems to break compatibility
big time.

> 5. background tasks
>
>    I hope we will add them with Ryszard's asynchronous task library

As for xhb's current implementation this would also be a perfect
thing to add to our not yet existing xhb compatibility contrib.

> 6. GLOBAL / GLOBAL EXTERNAL (GLOBAL_EXTERN)
>
>    I think that I'll add them somewhere in the future but it will
>    be implemented internally in different way then in xHarbour.
>    In xHarbour GLOBALs can be used _ONLY_ if compiler generate C
>    code and the implementation strictly depends on C compiler and
>    linker behavior.

This seems useful if implemented properly.

Brgds,
Viktor

From harbour.01 at syenar.hu  Thu Sep 20 17:36:38 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 17:36:50 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709201531.46862.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709201234.04593.teo@windtelsoft.com>
	<0E131A7C-00E0-4A58-92F1-9930327B071A@syenar.hu>
	<200709201531.46862.teo@windtelsoft.com>
Message-ID: <D88A4B77-CE43-4DFD-98FB-B43D17B9E159@syenar.hu>

Thanks Teo, you are added now. Welcome :)

Brgds,
Viktor

On 2007.09.20., at 22:31, Teo Fonrouge wrote:

> On Thursday 20 September 2007 02:58:26 pm Szak?ts Viktor wrote:
>> Hi Teo,
>>
>>> I would like to start some simple documentation regarding this
>>> features and
>>> put this files under the /doc dir, furthermore, do some cleaning
>>> and updating
>>> for the docs currently in that directory.
>>>
>>> Also I might finish the conversion of TIP library in the contrib  
>>> dir.
>>>
>>> So, it would be nice that I could have write access granted to the
>>> SVN Harbour
>>> repository.
>>>
>>> Can you or other project admin, kindly give me this permission ?
>>
>> Yes, of course, just pls give me your sourceforge user ID.
>
> tfonrouge
>
> Thank you.
>
>
> best regards
>
> Teo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Thu Sep 20 17:43:07 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Sep 20 17:43:16 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <B615A0FC-739D-4BBF-B56E-3C0B351F1979@GMail.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200601.32838.teo@windtelsoft.com>
	<5AFE04DD-E6B9-45A5-AA07-A52A88589023@syenar.hu>
	<200709200714.36305.teo@windtelsoft.com>
	<E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
	<B615A0FC-739D-4BBF-B56E-3C0B351F1979@GMail.com>
Message-ID: <83CD9C13-ABDC-46A3-B518-C568620349D4@syenar.hu>

Hi Patrick,

Congrats for the docs, the format and the content is
very professional. (I wouldn't miss the login requirement,
but it's very light, so no prob with it :)

Most of it can indeed be used for Harbour, too. Many thanks
for the suggestion.

Brgds,
Viktor

On 2007.09.20., at 18:19, Patrick Mast, xHarbour.com wrote:

> Hey Viktor,
>
>>> May be is time to start to think in a serious Documentation  
>>> Project for
>>> Harbour.
>>>
>>> Besides to have strong type checking in compiler time,  
>>> multithreading support,
>>> extend the available types to integer float long etc, functions  
>>> to unicode
>>> support .
>>
>> Yes, documentation would need contributors, which we used
>> to fall short of. I kinda understand this because those
>> who could write great docs, usually don't need those great
>> docs.
>>
>> Since we're compatible with C5.x most of the time, anyone
>> can access the original docs to create complete apps, so on the
>> first round we'd need to document the extensions and differences
>> only. There are many-many detailed mails (usually from Przemek)
>> on the list having good documentation of specific Harbour parts,
>> plus we have the docs folder with some valuable information, and
>> sometimes we have differences and features documented in the code.
>> Someone would "just" need to put these into some digestable format.
>
> Harbour users are off-course also welcome to use xHarbour.com's  
> xHDN ( xHarbour Developers Network ) pages as their documentation  
> reference. It's open and free to use. More than 2.000 items are  
> documented on xHDN. All the doc's on xHDN are written from scratch  
> and have samples, references, etc..
>
> The xHarbour Developer Network pages are here:
> See http://www.xHarbour.com/xHDN
>
> Patrick
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Fri Sep 21 02:25:27 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Fri Sep 21 02:25:31 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and xHarbour
In-Reply-To: <83CD9C13-ABDC-46A3-B518-C568620349D4@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200601.32838.teo@windtelsoft.com>
	<5AFE04DD-E6B9-45A5-AA07-A52A88589023@syenar.hu>
	<200709200714.36305.teo@windtelsoft.com>
	<E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
	<B615A0FC-739D-4BBF-B56E-3C0B351F1979@GMail.com>
	<83CD9C13-ABDC-46A3-B518-C568620349D4@syenar.hu>
Message-ID: <9257026e0709202325t4636429dyd259bd0e8c50bde0@mail.gmail.com>

On 9/20/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> Congrats for the docs, the format and the content is
> very professional. (I wouldn't miss the login requirement,
> but it's very light, so no prob with it :)
>
> Most of it can indeed be used for Harbour, too. Many thanks
> for the suggestion.

That's the reason why I'm trying to keep open a "channel" between
Harbour and xHarbour. Like Przemyslaw has said many times without
xHarbour.com we would not have things like that.

I'm not an xHarbour.com customer, my main paltform is Linux and web
and my developers use only Harbour but I still think that both the
projects should keep an eye to the "interoperability" and I consider
myself member of both.
Clearly actually I'm more involved in Harbour but I checkout xHarbour
after every commit, build it and build my apps with xHarbour and C53B,
report to xHarbour dev list every problem and guard with #ifdefs
Harbour/xHarbour specific extensions.

For me there is a common ground that is C53B and two set of
extensions: Harbour and xHarbour and xHarbour.com is a company that
sells documentation and tools much like Zend does for PHP.

Said that, both teams are free to make choices and keep the
differences they think are "necessary" but also I hope that both will
do the best to reduce "unneeded" ones.

best regards,
Lorenzo

P.S. I agree that operators like IN, HAS, LIKE are unneeded and
looking in xHdn operators list they are the only ones "alphabetical".
From lorenzo.fiorini at gmail.com  Fri Sep 21 02:59:17 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Fri Sep 21 02:59:20 2007
Subject: [Harbour] Differences building apps with Harbour and xHarbour
In-Reply-To: <20070920131624.GD21612@localhost.localdomain>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<20070920131624.GD21612@localhost.localdomain>
Message-ID: <9257026e0709202359td465021vf1d9988cf0610ad5@mail.gmail.com>

On 9/20/07, Przemyslaw Czerpak <druzus@priv.onet.pl> wrote:

> Not true. XHB can use IN as synonym of $.
> ...
> We can also create list of Harbour features not supported by xHarbour.

It was not my intention to say that xHarbour has more than Harbour or
which is the better.

Today I use only Harbour since gttrm and #pragma escapedstrings = on
are critical for my apps.

I have "ported" HBLOG into my contrib like the HBXML you sent to me.
If the team agree I think they could be added to svn in the contrib dir.

About the core low level features I can't say much but I agree that
cString[1] is more a problem than a feature and that "alphabetical"
operators should be avoided for the PP but also because they  look
"wrong" in a language that has "C/Clipper style".

best regards,
Lorenzo
From teo at windtelsoft.com  Fri Sep 21 05:33:32 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Fri Sep 21 05:33:38 2007
Subject: [Harbour] ChangeLog: 7768 2007-09-21 09:17:46Z tfonrouge $
Message-ID: <200709210433.32695.teo@windtelsoft.com>


Changes to compile TIP without the --with xhb flag.
* Changed hash creation mode from {=>}/Hash() to HB_HSetAutoAdd( {=>} )
* Changed xHb's string index access extensions:  <string>[ n ], SubStr, Stuff 
used now
* Changed Inet* functions to HB_Inet*
* Changed use of hb_EnumIndex() to <enum>:__enumIndex()
; Tip library compiles now without xhb compatibility flag
; Please test it, I don't use all the functionality


best regards

Teo
From teo at windtelsoft.com  Fri Sep 21 05:46:21 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Fri Sep 21 05:46:27 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <D88A4B77-CE43-4DFD-98FB-B43D17B9E159@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709201531.46862.teo@windtelsoft.com>
	<D88A4B77-CE43-4DFD-98FB-B43D17B9E159@syenar.hu>
Message-ID: <200709210446.21843.teo@windtelsoft.com>

On Thursday 20 September 2007 04:36:38 pm Szak?ts Viktor wrote:
> Thanks Teo, you are added now. Welcome :)
>

Thank you Viktor,

What are you using to update the ChangeLog in the SVN root ?



best regards

Teo
From harbour.01 at syenar.hu  Fri Sep 21 06:17:05 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 21 06:17:20 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709210446.21843.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709201531.46862.teo@windtelsoft.com>
	<D88A4B77-CE43-4DFD-98FB-B43D17B9E159@syenar.hu>
	<200709210446.21843.teo@windtelsoft.com>
Message-ID: <82E454B2-87E7-48E5-8F8E-A8BE052E0AC2@syenar.hu>

I do it manually. To help that and not to forget
to include any changed files, I first start a test
commit, so that SVN pops up a list of changed files,
then I cancel this commit, finish my entry using the
list of changed files as a base, then I do the live
commit. I have a small script to do the commit with
the attached changelog entry and to send this entry
automatically to this list).

If that's what you meant :)

As for TIP, you can add your changes to the local
TIP ChangeLog.

Brgds,
Viktor

On 2007.09.21., at 11:46, Teo Fonrouge wrote:

> On Thursday 20 September 2007 04:36:38 pm Szak?ts Viktor wrote:
>> Thanks Teo, you are added now. Welcome :)
>>
>
> Thank you Viktor,
>
> What are you using to update the ChangeLog in the SVN root ?
>
>
>
> best regards
>
> Teo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Fri Sep 21 09:09:21 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Fri Sep 21 09:09:26 2007
Subject: [Harbour] ChangeLog: 7768 2007-09-21 09:17:46Z tfonrouge $
In-Reply-To: <200709210433.32695.teo@windtelsoft.com>
References: <200709210433.32695.teo@windtelsoft.com>
Message-ID: <9257026e0709210609if4396ebyb5c30d0543e4c13c@mail.gmail.com>

On 9/21/07, Teo Fonrouge <teo@windtelsoft.com> wrote:

> Changes to compile TIP without the --with xhb flag.
> * Changed hash creation mode from {=>}/Hash() to HB_HSetAutoAdd( {=>} )
> * Changed xHb's string index access extensions:  <string>[ n ], SubStr, Stuff
> used now
> * Changed Inet* functions to HB_Inet*
> * Changed use of hb_EnumIndex() to <enum>:__enumIndex()
> ; Tip library compiles now without xhb compatibility flag
> ; Please test it, I don't use all the functionality

Which ones you didn't test?

best regards,
Lorenzo
From teo at windtelsoft.com  Fri Sep 21 10:35:43 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Fri Sep 21 10:35:50 2007
Subject: [Harbour] ChangeLog: 7768 2007-09-21 09:17:46Z tfonrouge $
In-Reply-To: <9257026e0709210609if4396ebyb5c30d0543e4c13c@mail.gmail.com>
References: <200709210433.32695.teo@windtelsoft.com>
	<9257026e0709210609if4396ebyb5c30d0543e4c13c@mail.gmail.com>
Message-ID: <200709210935.43664.teo@windtelsoft.com>

On Friday 21 September 2007 08:09:21 am Lorenzo Fiorini wrote:
> On 9/21/07, Teo Fonrouge <teo@windtelsoft.com> wrote:
> > Changes to compile TIP without the --with xhb flag.
> > * Changed hash creation mode from {=>}/Hash() to HB_HSetAutoAdd( {=>} )
> > * Changed xHb's string index access extensions:  <string>[ n ], SubStr,
> > Stuff used now
> > * Changed Inet* functions to HB_Inet*
> > * Changed use of hb_EnumIndex() to <enum>:__enumIndex()
> > ; Tip library compiles now without xhb compatibility flag
> > ; Please test it, I don't use all the functionality
>
> Which ones you didn't test?

All the prg based. I just use the basic HB_Init* functions which are already 
in rtl/hbinet.c .


best regards

Teo
From teo at windtelsoft.com  Fri Sep 21 10:36:29 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Fri Sep 21 10:36:33 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <82E454B2-87E7-48E5-8F8E-A8BE052E0AC2@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709210446.21843.teo@windtelsoft.com>
	<82E454B2-87E7-48E5-8F8E-A8BE052E0AC2@syenar.hu>
Message-ID: <200709210936.29859.teo@windtelsoft.com>

On Friday 21 September 2007 05:17:05 am Szak?ts Viktor wrote:
> I do it manually. To help that and not to forget
> to include any changed files, I first start a test
> commit, so that SVN pops up a list of changed files,
> then I cancel this commit, finish my entry using the
> list of changed files as a base, then I do the live
> commit. I have a small script to do the commit with
> the attached changelog entry and to send this entry
> automatically to this list).
>
> If that's what you meant :)

That was, exactly :)

>
> As for TIP, you can add your changes to the local
> TIP ChangeLog.

Thank you Viktor


best regards

Teo
From druzus at priv.onet.pl  Fri Sep 21 14:15:48 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Fri Sep 21 14:15:53 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709210446.21843.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709201531.46862.teo@windtelsoft.com>
	<D88A4B77-CE43-4DFD-98FB-B43D17B9E159@syenar.hu>
	<200709210446.21843.teo@windtelsoft.com>
Message-ID: <20070921181548.GA4236@localhost.localdomain>

On Fri, 21 Sep 2007, Teo Fonrouge wrote:
> What are you using to update the ChangeLog in the SVN root ?

First please read doc/howtosvn.txt. In section 1.3 you will find
information about ChangeLog format.

Then if you want you can use some scripts to make some things
automatically.
Below I'm attaching two scripts. Both should be executed in
directory containing copy of repository SF SVN repository in
'harbour' subdirecotry.
1-st (svn-stat) one generates ChangeLog.new file which will have
formated information about modified, deleted, added files. You will
have to add exact description with your modifications.
2-nd (svn-commit) one takes ChangeLog.new, refreshes date and creates
ChangeLog.cur, updates main ChangeLog file adding new entry with
ChangeLog.cur, commits changes and finally sends mail with ChangeLog
to this list.
If you want to use them then please remember about updating USRID
and never forget that they may need some updates to follow some
future modifications in SF repository.

best regards,
Przemek
-------------- next part --------------
#!/bin/sh
SVNURL="https://harbour-project.svn.sourceforge.net/svnroot/harbour-project/trunk/harbour"
PROJECT="harbour"
USRID="John Do (johhny/at/lost.in.space)"
CHGLOG="ChangeLog.new"

svn status "${PROJECT}" \
   | grep -v "/linux$\|/w32$\|/dos$" \
   > svn-log~

grep -v "^[?]" svn-log~ \
   | sed -e "s/^M     /  */g" -e "s/^A     /  +/g" -e "s/^D     /  -/g" \
   > svn-logX
grep    "^[?]" svn-log~ > svn-logY
rm -f svn-log~

date "+%F %R UTC%z $USRID" > "${CHGLOG}"
cat svn-logX >> "${CHGLOG}"

cat "${CHGLOG}"
-------------- next part --------------
#!/bin/sh
SVNURL="https://harbour-project.svn.sourceforge.net/svnroot/harbour-project/trunk/harbour"
PROJECT="harbour"
USRID="John Do (johhny/at/lost.in.space)"
CHGLOG1="ChangeLog.new"
CHGLOG2="ChangeLog.cur"
CHGLOG3="ChangeLog.main"
MAILADR="harbour@harbour-project.org"

# update time
LOGHEAD=`date "+%F %R UTC%z $USRID"`
(echo "${LOGHEAD}"; tail +2 "${CHGLOG1}") > "${CHGLOG2}"

cat "${CHGLOG2}"
read
if svn update "${PROJECT}"
then
   ( head -9 "${PROJECT}/ChangeLog"
   echo
   cat "${CHGLOG2}"
   tail +10 "${PROJECT}/ChangeLog") > "${CHGLOG3}"
   mv -f "${PROJECT}/ChangeLog" "ChangeLog.bak"
   mv -f "${CHGLOG3}" "${PROJECT}/ChangeLog"
   if svn commit -F ${CHGLOG2} "$@" "${PROJECT}"
   then
      mail -s "${LOGHEAD}" "${MAILADR}" < "${CHGLOG2}"
   else
      mv -f "ChangeLog.bak" "${PROJECT}/ChangeLog"
   fi
else
   echo "Cannot update"
fi
From teo at windtelsoft.com  Sat Sep 22 02:05:06 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sat Sep 22 02:11:13 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?utf-8?q?and=09xHarbour?=
In-Reply-To: <20070921181548.GA4236@localhost.localdomain>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709210446.21843.teo@windtelsoft.com>
	<20070921181548.GA4236@localhost.localdomain>
Message-ID: <200709220105.06057.teo@windtelsoft.com>

On Friday 21 September 2007 01:15:48 pm Przemyslaw Czerpak wrote:
> On Fri, 21 Sep 2007, Teo Fonrouge wrote:
> > What are you using to update the ChangeLog in the SVN root ?
>
> First please read doc/howtosvn.txt. In section 1.3 you will find
> information about ChangeLog format.
>
> Then if you want you can use some scripts to make some things
> automatically.
> Below I'm attaching two scripts. Both should be executed in
> directory containing copy of repository SF SVN repository in
> 'harbour' subdirecotry.
> 1-st (svn-stat) one generates ChangeLog.new file which will have
> formated information about modified, deleted, added files. You will
> have to add exact description with your modifications.
> 2-nd (svn-commit) one takes ChangeLog.new, refreshes date and creates
> ChangeLog.cur, updates main ChangeLog file adding new entry with
> ChangeLog.cur, commits changes and finally sends mail with ChangeLog
> to this list.
> If you want to use them then please remember about updating USRID
> and never forget that they may need some updates to follow some
> future modifications in SF repository.

Thank you Przemek. I'll add & use this scripts in my SVN copy.


best regards

Teo
From lorenzo.fiorini at gmail.com  Sat Sep 22 16:33:45 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sat Sep 22 16:33:49 2007
Subject: [Harbour] hblog ported from xHarbour
Message-ID: <9257026e0709221333te0c1dajabc43c2b58570ea5@mail.gmail.com>

Here attached there is a "raw" port of hblog functions from xHarbour.

I've tested console and file channels under Linux and they works for me.

Could it be added to contrib/hblog?

Could any C developer check C code?

best regards,
Lorenzo
-------------- next part --------------
A non-text attachment was scrubbed...
Name: hblog.tgz
Type: application/x-gzip
Size: 9417 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20070922/2f67f34c/hblog.tgz
From teo at windtelsoft.com  Sat Sep 22 23:16:18 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sat Sep 22 23:16:26 2007
Subject: [Harbour] HB_HAutoAdd return value
Message-ID: <200709222216.18693.teo@windtelsoft.com>

Hello,

Should I change in the hashfunc.c:

628:	hb_retni( iOldFlags );

to

628:	hb_retl( iOldFlags );

?


best regards

Teo
From teo at windtelsoft.com  Sat Sep 22 23:19:17 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sat Sep 22 23:19:22 2007
Subject: [Harbour] ChangeLog 7769 2007-09-23 02:45:29Z tfonrouge $
Message-ID: <200709222219.17387.teo@windtelsoft.com>

2007-09-22 21:43 UTC-0500 Teo Fonrouge (teo/at/windtelsoft/dot/com)
  * contrib/tip/thtml.prg
  * contrib/tip/cgi.prg
  * contrib/tip/httpcln.prg
    ! Fixed missing logical parameter on HB_HSetAutoAdd

best regards

Teo
From harbour.01 at syenar.hu  Sun Sep 23 06:06:49 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 23 06:07:00 2007
Subject: [Harbour] HB_HAutoAdd return value
In-Reply-To: <200709222216.18693.teo@windtelsoft.com>
References: <200709222216.18693.teo@windtelsoft.com>
Message-ID: <B5B3FBB9-7475-4C29-88D0-0415FB360584@syenar.hu>

Hi Teo,

hb_retni() seems correct to me, iOldFlags
holds two bits of information as the
"and" mask in the line before has the
value of 3. The function also accepts
numeric values as incoming parameter
(and also logical as an option), so it
looks consistent.

Brgds,
Viktor

On 2007.09.23., at 5:16, Teo Fonrouge wrote:

> Hello,
>
> Should I change in the hashfunc.c:
>
> 628:	hb_retni( iOldFlags );
>
> to
>
> 628:	hb_retl( iOldFlags );
>
> ?
>
>
> best regards
>
> Teo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From teo at windtelsoft.com  Sun Sep 23 12:46:23 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sun Sep 23 12:46:29 2007
Subject: [Harbour] HB_HAutoAdd return value
In-Reply-To: <B5B3FBB9-7475-4C29-88D0-0415FB360584@syenar.hu>
References: <200709222216.18693.teo@windtelsoft.com>
	<B5B3FBB9-7475-4C29-88D0-0415FB360584@syenar.hu>
Message-ID: <200709231146.23992.teo@windtelsoft.com>

On Sunday 23 September 2007 05:06:49 am Szak?ts Viktor wrote:
> Hi Teo,
>
> hb_retni() seems correct to me, iOldFlags
> holds two bits of information as the
> "and" mask in the line before has the
> value of 3. The function also accepts
> numeric values as incoming parameter
> (and also logical as an option), so it
> looks consistent.

The point is, that is a little confusing to give a logical parameter and get a 
numeric value for the previous state of the flag.

What do you think to change the logic to this: return a numeric value only if 
a numeric parameter is given ?


best regards

Teo


From druzus at priv.onet.pl  Sun Sep 23 13:01:39 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sun Sep 23 13:01:46 2007
Subject: [Harbour] HB_HAutoAdd return value
In-Reply-To: <B5B3FBB9-7475-4C29-88D0-0415FB360584@syenar.hu>
References: <200709222216.18693.teo@windtelsoft.com>
	<B5B3FBB9-7475-4C29-88D0-0415FB360584@syenar.hu>
Message-ID: <20070923170139.GA27703@localhost.localdomain>

On Sun, 23 Sep 2007, Szak?ts Viktor wrote:
> Hi Teo,
> hb_retni() seems correct to me, iOldFlags
> holds two bits of information as the
> "and" mask in the line before has the
> value of 3. The function also accepts
> numeric values as incoming parameter
> (and also logical as an option), so it
> looks consistent.

Exactly. Accepting logical parameter is optional - numeric
is a must. If it confuses users then we can remove support
for logical values and allow to use only numeric values.
Probably it will force more clear code because now user
may not know if .T. means:
    1. AUTOADD in ACCESS operation, f.e.: ? hVal[xKey]
    2. AUTOADD in ASSIGN operation, f.e.: hVal[xKey] := 123.45
       (It's xHarbour compatible AUTOADD mode)
    3. BOTH AUTOADD in ACCESS or ASSIGN

The fact that Teo asked about it mens that he didn't know about
above possibilities because he should know that it's impossible
to replace 4 state value by 2 state (logical) value without losing
some functionality.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Sep 23 13:12:48 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 23 13:12:59 2007
Subject: [Harbour] HB_HAutoAdd return value
In-Reply-To: <20070923170139.GA27703@localhost.localdomain>
References: <200709222216.18693.teo@windtelsoft.com>
	<B5B3FBB9-7475-4C29-88D0-0415FB360584@syenar.hu>
	<20070923170139.GA27703@localhost.localdomain>
Message-ID: <96AA9E82-ECE4-4E88-A1F7-03E81D2B6273@syenar.hu>

Hi Przemek, Teo,

If we need to clean this up, I vote to remove the logical
option.

The only downside is that "common.ch" needs to be included,
but that's not a big problem.

Brgds,
Viktor

On 2007.09.23., at 19:01, Przemyslaw Czerpak wrote:

> On Sun, 23 Sep 2007, Szak?ts Viktor wrote:
>> Hi Teo,
>> hb_retni() seems correct to me, iOldFlags
>> holds two bits of information as the
>> "and" mask in the line before has the
>> value of 3. The function also accepts
>> numeric values as incoming parameter
>> (and also logical as an option), so it
>> looks consistent.
>
> Exactly. Accepting logical parameter is optional - numeric
> is a must. If it confuses users then we can remove support
> for logical values and allow to use only numeric values.
> Probably it will force more clear code because now user
> may not know if .T. means:
>     1. AUTOADD in ACCESS operation, f.e.: ? hVal[xKey]
>     2. AUTOADD in ASSIGN operation, f.e.: hVal[xKey] := 123.45
>        (It's xHarbour compatible AUTOADD mode)
>     3. BOTH AUTOADD in ACCESS or ASSIGN
>
> The fact that Teo asked about it mens that he didn't know about
> above possibilities because he should know that it's impossible
> to replace 4 state value by 2 state (logical) value without losing
> some functionality.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From teo at windtelsoft.com  Sun Sep 23 13:34:42 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sun Sep 23 13:34:47 2007
Subject: [Harbour] HB_HAutoAdd return value
In-Reply-To: <96AA9E82-ECE4-4E88-A1F7-03E81D2B6273@syenar.hu>
References: <200709222216.18693.teo@windtelsoft.com>
	<20070923170139.GA27703@localhost.localdomain>
	<96AA9E82-ECE4-4E88-A1F7-03E81D2B6273@syenar.hu>
Message-ID: <200709231234.42116.teo@windtelsoft.com>

On Sunday 23 September 2007 12:12:48 pm Szak?ts Viktor wrote:
> Hi Przemek, Teo,
>
> If we need to clean this up, I vote to remove the logical
> option.
>
> The only downside is that "common.ch" needs to be included,
> but that's not a big problem.

I too agree to remove the logical parameter as a option, it is much clear and 
the users will be aware of the additional functionality.


best regards

Teo
From teo at windtelsoft.com  Sun Sep 23 14:03:39 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sun Sep 23 14:03:45 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200714.36305.teo@windtelsoft.com>
	<E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
Message-ID: <200709231303.39437.teo@windtelsoft.com>

On Thursday 20 September 2007 07:42:40 am Szak?ts Viktor wrote:
> > I believe that achieve a high grade of compatibility is not a easy
> > task, there
> > are deep differs between of two compilers.
>
> I agree, but even if there is some feature on the surface
> which we need to support, it's better (but more work) to
> add the necessary low-level interfaces to Harbour first,
> then a standard solution can be implemented in a compatibility
> dir. It all depends on the feature we're talking about,
> that's true.
>
> > My vote would be to create a set of resources that make easy to the
> > xHarbour/Clipper/XBase++/Clip users the transition to the Harbour
> > compiler,
> > this resources would be:
> >
> >   - *.ch files with preprocessor translations
> >   - *.prg files with the extensions that could be easy loaded in RT
> >     via the  __hrbLoad, __hrbRun, __hrbDo  functions.
>
> Good idea, though this is just another method to use those
> compatibility .prgs. Some might prefer a lib, some to load
> them as .prg. Both can be supported easily. Remember though
> that some features might need .c files, where lib is the
> only option.

What about, as a starting point, to have available in runtime some set 
function's in the form:

  HB_SetCompat("XHARBOUR","Hash","AutoAdd")
  HB_SetCompat("XHARBOUR","$")
  HB_SetCompat("XHARBOUR","CHARACTER","IndexedAccess")
  ...
  HB_SetCompat("CLIPPER53b","Someitem")

I'm aware that in some cases, this can add some overhead, but in change we 
get:
  - Keep a (easy to find) list of compatibility issues solved.
  - Help the xHB users to minimize the need to build Harbour --with xhb
  - Increase the compatibility level between compilers.

Also luckily the folks at xHarbour could have a similar set of compat 
functions to allow Harbour users to solve some incompatibility issues when 
using the xHarbour compiler:

  HB_SetCompat("HARBOUR","Hash","AutoAdd")
  HB_SetCompat("HARBOUR","$")
  HB_SetCompat("HARBOUR","CHARACTER","IndexedAccess")

This work can be done gradually and without touch any Harbour's core rules.

What you people think ?


[snip]

best regards

Teo
From harbour.01 at syenar.hu  Sun Sep 23 14:36:19 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 23 14:36:28 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709231303.39437.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200714.36305.teo@windtelsoft.com>
	<E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
	<200709231303.39437.teo@windtelsoft.com>
Message-ID: <6CE44A52-4B76-4CCD-8F52-CCB0E26F9FEE@syenar.hu>

Hi,

>> Good idea, though this is just another method to use those
>> compatibility .prgs. Some might prefer a lib, some to load
>> them as .prg. Both can be supported easily. Remember though
>> that some features might need .c files, where lib is the
>> only option.
>
> What about, as a starting point, to have available in runtime some set
> function's in the form:
>
>   HB_SetCompat("XHARBOUR","Hash","AutoAdd")
>   HB_SetCompat("XHARBOUR","$")
>   HB_SetCompat("XHARBOUR","CHARACTER","IndexedAccess")
>   ...
>   HB_SetCompat("CLIPPER53b","Someitem")
>
> I'm aware that in some cases, this can add some overhead, but in  
> change we
> get:
>   - Keep a (easy to find) list of compatibility issues solved.
>   - Help the xHB users to minimize the need to build Harbour --with  
> xhb
>   - Increase the compatibility level between compilers.
>
> Also luckily the folks at xHarbour could have a similar set of compat
> functions to allow Harbour users to solve some incompatibility  
> issues when
> using the xHarbour compiler:
>
>   HB_SetCompat("HARBOUR","Hash","AutoAdd")
>   HB_SetCompat("HARBOUR","$")
>   HB_SetCompat("HARBOUR","CHARACTER","IndexedAccess")
>
> This work can be done gradually and without touch any Harbour's  
> core rules.
>
> What you people think ?

I vote against this. Since this way we introduce yet another layer
of compatibility complexity to the ones we already have, and we've
already way too much compatibility complications, so I don't think
adding - especially a runtime - one, would do any good (but would harm
those who don't need it, plus the core developers, who need to maintain
it).

Remember that full xhb compatibility _is not_ (and never was) a project
goal for Harbour.

Also remember that using those extensions is not a must, so developers
are encouraged to use portable language constructs for these cases,
so they don't stumble into such problems in the first place. Portability
these days is worth much more than a few microseconds which is supposed
to be gained by for example string[n] access, and performance/ 
optimization
is something we can always work on.

Current tools for xhb developers wanting to migrate to Harbour are:
1) Numerous xhb features implemented natively.
2) -k? compiler flags.
3) hbcompat.ch (enabling the usage of several ported features without  
any code modification)
4) HB_COMPAT_XHB build-time switch.

The rest of the missing bits can either be:
a) added to a compatibility library (or app code) and linked in.
b) avoided in app source (like "IN", which has not much point).

Notice that even such things as AINS()/SUBSTR() extensions can be added
as a combination of compatibility library and .ch file, so this thing
_can_ be dynamic instead of being a build-time switch like  
HB_COMPAT_XHB.

in lib (non-optimized code):
FUNCTION xhb_AIns( aArray, nPos, xValue )
    AIns( aArray, nPos )
    aArray[ nPos ] := xValue
    RETURN aArray
in xhb.ch:
    #define AINS( a, n, x ) xhb_AIns( a, n, x )

This couldn't be cleaner.

(yes, I know that this wouldn't solve using extensions in macros, but
for macros one can simple avoid extensions totally or use app level
wrappers. This is a reasonable compromise to take.)

So, to summarize I'd create that external library along with xhb.ch and
I'd start to migrate features into that library (from xhb and even from
Harbour's HB_COMPAT_XHB parts if possible). Clean and simple.

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Sun Sep 23 16:42:51 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sun Sep 23 16:43:08 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and xHarbour
In-Reply-To: <6CE44A52-4B76-4CCD-8F52-CCB0E26F9FEE@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709200714.36305.teo@windtelsoft.com>
	<E89DFC16-27B1-422B-AACB-FE7EC26B5343@syenar.hu>
	<200709231303.39437.teo@windtelsoft.com>
	<6CE44A52-4B76-4CCD-8F52-CCB0E26F9FEE@syenar.hu>
Message-ID: <9257026e0709231342r287780abj55fabe543a86b500@mail.gmail.com>

On 9/23/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> I vote against this. Since this way we introduce yet another layer
> of compatibility complexity to the ones we already have
> ...
> 3) hbcompat.ch (enabling the usage of several ported features without
> any code modification)
> 4) HB_COMPAT_XHB build-time switch.

I agree, HB_COMPAT_XHB and hbcompat.ch are enough and in contrib they
are even "necessary". For example TIP is maintained mainly in xHarbour
and having ( too much ) differents set of code will only make the sync
harder.

HB_COMPAT_XHB also allows to have hashes autoadd and string indexes
which are "normal" for my  developers that come from php. For them
hGets := Hash() is much easy to understand than hGets :=
HB_HSetAutoAdd( {=>} ) and since they don't understand where to use
HB_ and where not, hbcompat.ch helps.

best regards,
Lorenzo
From teo at windtelsoft.com  Sun Sep 23 19:25:43 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sun Sep 23 19:26:01 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <6CE44A52-4B76-4CCD-8F52-CCB0E26F9FEE@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709231303.39437.teo@windtelsoft.com>
	<6CE44A52-4B76-4CCD-8F52-CCB0E26F9FEE@syenar.hu>
Message-ID: <200709231825.43054.teo@windtelsoft.com>

On Sunday 23 September 2007 01:36:19 pm Szak?ts Viktor wrote:

[snip]

> > What you people think ?
>
> I vote against this. Since this way we introduce yet another layer
> of compatibility complexity to the ones we already have, and we've
> already way too much compatibility complications, so I don't think
> adding - especially a runtime - one, would do any good (but would harm
> those who don't need it, plus the core developers, who need to maintain
> it).

I understand this.

>
> Remember that full xhb compatibility _is not_ (and never was) a project
> goal for Harbour.

Already I'm aware of this.

>
> Also remember that using those extensions is not a must, so developers
> are encouraged to use portable language constructs for these cases,
> so they don't stumble into such problems in the first place. Portability
> these days is worth much more than a few microseconds which is supposed
> to be gained by for example string[n] access, and performance/
> optimization
> is something we can always work on.

I agree with this.

>
> Current tools for xhb developers wanting to migrate to Harbour are:
> 1) Numerous xhb features implemented natively.
> 2) -k? compiler flags.
> 3) hbcompat.ch (enabling the usage of several ported features without
> any code modification)
> 4) HB_COMPAT_XHB build-time switch.
>
> The rest of the missing bits can either be:
> a) added to a compatibility library (or app code) and linked in.
> b) avoided in app source (like "IN", which has not much point).
>
> Notice that even such things as AINS()/SUBSTR() extensions can be added
> as a combination of compatibility library and .ch file, so this thing
> _can_ be dynamic instead of being a build-time switch like
> HB_COMPAT_XHB.
>
> in lib (non-optimized code):
> FUNCTION xhb_AIns( aArray, nPos, xValue )
>     AIns( aArray, nPos )
>     aArray[ nPos ] := xValue
>     RETURN aArray
> in xhb.ch:
>     #define AINS( a, n, x ) xhb_AIns( a, n, x )
>
> This couldn't be cleaner.
>
> (yes, I know that this wouldn't solve using extensions in macros, but
> for macros one can simple avoid extensions totally or use app level
> wrappers. This is a reasonable compromise to take.)
>
> So, to summarize I'd create that external library along with xhb.ch and
> I'd start to migrate features into that library (from xhb and even from
> Harbour's HB_COMPAT_XHB parts if possible). Clean and simple.

Do you have available a complete list of this features ?

I have 'ported' without problems a few projects with several thousands lines 
of source code from xHarbour to Harbour, and this apps are running fine, 
however, the only xHB extension that I'm missing now is the extended "$" 
operator.

I don't want my team to have a non stock (in the sense that is not the 
official available binary to download) compiler binary and have to build the 
Harbour compiler with the xhb compatibility flag. 

This increases the overall complexity of a project, and is why I'm trying to 
have this feature available in RT with a stock binary Harbour compiler.


best regards

Teo


From harbour.01 at syenar.hu  Sun Sep 23 20:04:09 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 23 20:04:18 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709231825.43054.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709231303.39437.teo@windtelsoft.com>
	<6CE44A52-4B76-4CCD-8F52-CCB0E26F9FEE@syenar.hu>
	<200709231825.43054.teo@windtelsoft.com>
Message-ID: <789E1818-4B77-4EE0-BA94-45F2D9F2588F@syenar.hu>

> Do you have available a complete list of this features ?

No, but it can be get relatively quickly using
a "grep -R HB_COMPAT_XHB *" (or something like this)
command on the source tree.

After a quick scan I've found these:
- array function differences: AINS, ADEL, ASCAN (can be put into lib  
+ .ch)
- runtime flag default (arrays as strings) (?)
- hash autoadd default (I'm sure this can be controlled from app code)
- hash compatibility (without hb_ prefix) functions (can be put into  
lib or .ch)
- hash operators (can be put into lib using operator overloading, or  
the language feature to be avoided by using hash functions.)
- arrays as string (can be put into lib using operator overloading,  
but this should definitely be avoided IMO. Also maybe we should intro  
a HB_P_SUBSTR1 pcode to achieve speed)
- some memvar handling difference which I don't know more about.
- inet compatibility functions (without hb_ prefix) (can be put into  
lib or .ch)
- two hb_deserial*() functions (can be put into lib or .ch)
- Wildmatch() function (without hb_ prefix) (can be put into lib or .ch)

As far as I can see, most features can be easily moved
into a .lib + .ch.

> I have 'ported' without problems a few projects with several  
> thousands lines
> of source code from xHarbour to Harbour, and this apps are running  
> fine,
> however, the only xHB extension that I'm missing now is the  
> extended "$"
> operator.

It is exactly the same as AScan( a, x ) (expressed with a bit fewer  
pcodes,
but this can be solved by introducing a dedicated HB_P_ASCAN one, if we
agree on it that it's good for performance. I personally use AScan()  
with
a scanner codeblock in the waste majority of the cases though.)

> I don't want my team to have a non stock (in the sense that is not the
> official available binary to download) compiler binary and have to  
> build the
> Harbour compiler with the xhb compatibility flag.
>
> This increases the overall complexity of a project, and is why I'm  
> trying to
> have this feature available in RT with a stock binary Harbour  
> compiler.

Yes, I perfectly understand that, that's why it would be better to move
away from the current HB_COMPAT_* methods (including, and most  
importantly
HB_COMPAT_XHB) to external compatibility libraries in contrib.

Maybe this wouldn't solve _all_ the compatibility problems, but with
some work on the application side too, you can fully migrate to the
std Harbour build.

Brgds,
Viktor

From druzus at priv.onet.pl  Sun Sep 23 20:05:10 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sun Sep 23 20:05:16 2007
Subject: [Harbour] ChangeLog 2007-09-24 02:05 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070924000510.GA8122@localhost.localdomain>

2007-09-24 02:05 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/contrib/ole2/win32ole.prg
    * changed Invoke() method to work with core code compiled without
      HB_COMPAT_XHB

  * harbour/source/rtl/gttrm/gttrm.c
  * harbour/source/rdd/dbcmd.c
    * code clean-up

  * harbour/include/hbset.h
  * harbour/source/rtl/set.c
    * code clean-up
    + added functions to access set parameters:
         hb_setAltHan()
         hb_setCentury()
         hb_setExtraHan()
         hb_setPrintHan()
         hb_setAlternate()
         hb_setAltFile()
         hb_setAutOpen()
         hb_setAutOrder()
         hb_setAutoShare()
         hb_setBell()
         hb_setCancel()
         hb_setColor()
         hb_setConfirm()
         hb_setConsole()
         hb_setDateFormat()
         hb_setDebug()
         hb_setDecimals()
         hb_setDefault()
         hb_setDeleted()
         hb_setDelimChars()
         hb_setDelimiters()
         hb_setDevice()
         hb_setEOF()
         hb_setEpoch()
         hb_setEscape()
         hb_setEventMask()
         hb_setExact()
         hb_setExclusive()
         hb_setExit()
         hb_setExtra()
         hb_setExtraFile()
         hb_setFixed()
         hb_setIdleRepeat()
         hb_setInsert()
         hb_setIntensity()
         hb_setPath()
         hb_setMargin()
         hb_setMBlockSize()
         hb_setMCenter()
         hb_setMessage()
         hb_setMFileExt()
         hb_setOptimize()
         hb_setPrinter()
         hb_setPrintFile()
         hb_setScoreBoard()
         hb_setScrollBreak()
         hb_setSoftSeek()
         hb_setStrictRead()
         hb_setTypeAhead()
         hb_setUnique()
         hb_setFileCase()
         hb_setDirCase()
         hb_setDirSeparator()
         hb_setVideoMode()
         hb_setWrap()
         hb_setDBFLockScheme()
         hb_setHardCommit()
         hb_setForceOpt()
         hb_setDefExtension()
         hb_setEOL()
         hb_setTrimFileName()
      This is compatible with recent modifications by Andi Jahja
      in xHarbour.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Sep 23 20:20:40 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 23 20:20:51 2007
Subject: [Harbour] ChangeLog 2007-09-24 02:05 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20070924000510.GA8122@localhost.localdomain>
References: <20070924000510.GA8122@localhost.localdomain>
Message-ID: <F8B55568-AE60-4FFA-BE4A-72567B29789C@syenar.hu>

Hi Przemek,

I honestly find this set() solution hugely inelegant,
can I ask what is the point of these functions? considering
that you've just introduced hb_setGetL( set_ID )/hb_setGetCPrt( set_ID )
etc... which _is_ the way this problem should be addressed
in a nice way.

We do have a flexible enum system for all sets (and for good
reason), and now graving those into stone by creating separate
functions, well, this _is_ ugly. This is if we'd be creating
SetExact() in Clipper level which would be nem synomym of
Set( _SET_EXACT ). What is the point?

If we really need these (which I see no reason at this
point), can we at least move them to another new .c file,
to avoid this bloat to be included in every program.

But I'd vote to revert this.

Brgds,
Viktor

On 2007.09.24., at 2:05, Przemyslaw Czerpak wrote:

> 2007-09-24 02:05 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/contrib/ole2/win32ole.prg
>     * changed Invoke() method to work with core code compiled without
>       HB_COMPAT_XHB
>
>   * harbour/source/rtl/gttrm/gttrm.c
>   * harbour/source/rdd/dbcmd.c
>     * code clean-up
>
>   * harbour/include/hbset.h
>   * harbour/source/rtl/set.c
>     * code clean-up
>     + added functions to access set parameters:
>          hb_setAltHan()
>          hb_setCentury()
>          hb_setExtraHan()
>          hb_setPrintHan()
>          hb_setAlternate()
>          hb_setAltFile()
>          hb_setAutOpen()
>          hb_setAutOrder()
>          hb_setAutoShare()
>          hb_setBell()
>          hb_setCancel()
>          hb_setColor()
>          hb_setConfirm()
>          hb_setConsole()
>          hb_setDateFormat()
>          hb_setDebug()
>          hb_setDecimals()
>          hb_setDefault()
>          hb_setDeleted()
>          hb_setDelimChars()
>          hb_setDelimiters()
>          hb_setDevice()
>          hb_setEOF()
>          hb_setEpoch()
>          hb_setEscape()
>          hb_setEventMask()
>          hb_setExact()
>          hb_setExclusive()
>          hb_setExit()
>          hb_setExtra()
>          hb_setExtraFile()
>          hb_setFixed()
>          hb_setIdleRepeat()
>          hb_setInsert()
>          hb_setIntensity()
>          hb_setPath()
>          hb_setMargin()
>          hb_setMBlockSize()
>          hb_setMCenter()
>          hb_setMessage()
>          hb_setMFileExt()
>          hb_setOptimize()
>          hb_setPrinter()
>          hb_setPrintFile()
>          hb_setScoreBoard()
>          hb_setScrollBreak()
>          hb_setSoftSeek()
>          hb_setStrictRead()
>          hb_setTypeAhead()
>          hb_setUnique()
>          hb_setFileCase()
>          hb_setDirCase()
>          hb_setDirSeparator()
>          hb_setVideoMode()
>          hb_setWrap()
>          hb_setDBFLockScheme()
>          hb_setHardCommit()
>          hb_setForceOpt()
>          hb_setDefExtension()
>          hb_setEOL()
>          hb_setTrimFileName()
>       This is compatible with recent modifications by Andi Jahja
>       in xHarbour.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From teo at windtelsoft.com  Sun Sep 23 23:58:53 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Sun Sep 23 23:59:00 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour =?iso-8859-1?q?and=09xHarbour?=
In-Reply-To: <789E1818-4B77-4EE0-BA94-45F2D9F2588F@syenar.hu>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709231825.43054.teo@windtelsoft.com>
	<789E1818-4B77-4EE0-BA94-45F2D9F2588F@syenar.hu>
Message-ID: <200709232258.53309.teo@windtelsoft.com>

On Sunday 23 September 2007 07:04:09 pm Szak?ts Viktor wrote:
> > Do you have available a complete list of this features ?
>
> No, but it can be get relatively quickly using
> a "grep -R HB_COMPAT_XHB *" (or something like this)
> command on the source tree.
>
> After a quick scan I've found these:
> - array function differences: AINS, ADEL, ASCAN (can be put into lib
> + .ch)
> - runtime flag default (arrays as strings) (?)
> - hash autoadd default (I'm sure this can be controlled from app code)
> - hash compatibility (without hb_ prefix) functions (can be put into
> lib or .ch)
> - hash operators (can be put into lib using operator overloading, or
> the language feature to be avoided by using hash functions.)
> - arrays as string (can be put into lib using operator overloading,
> but this should definitely be avoided IMO. Also maybe we should intro
> a HB_P_SUBSTR1 pcode to achieve speed)
> - some memvar handling difference which I don't know more about.
> - inet compatibility functions (without hb_ prefix) (can be put into
> lib or .ch)
> - two hb_deserial*() functions (can be put into lib or .ch)
> - Wildmatch() function (without hb_ prefix) (can be put into lib or .ch)
>
> As far as I can see, most features can be easily moved
> into a .lib + .ch.

Ok, just to make things clear to me here, this means that new incomming xHB 
users just will need to link this LIB and use the standard Harbour build ?

>
> > I have 'ported' without problems a few projects with several
> > thousands lines
> > of source code from xHarbour to Harbour, and this apps are running
> > fine,
> > however, the only xHB extension that I'm missing now is the
> > extended "$"
> > operator.
>
> It is exactly the same as AScan( a, x ) (expressed with a bit fewer
> pcodes,
> but this can be solved by introducing a dedicated HB_P_ASCAN one, if we
> agree on it that it's good for performance. I personally use AScan()
> with
> a scanner codeblock in the waste majority of the cases though.)

In this case, i think that we just need to overload the "$" operator in the 
extended type class, in the form:

<prg>
CLASS HBCharacter FROM HBScalar
PRIVATE:
PROTECTED:
PUBLIC:
  METHOD IsIn   OPERATOR "$"
PUBLISHED:
ENDCLASS

FUNCTION IsIn( itm ) CLASS HBCharacter
  IF HB_IsArray( itm )
    RETURN AScan( itm, Self ) > 0
  ENDIF
RETURN self $ itm
</prg>

to get the wanted functionality:

<prg>

  ? "a" $ "juan"  // .T.
  ? "juan" $ {"john","peter","juan"}   // .T.
  ? "pedro" $ {"john","peter","juan"}  // .F.

</prg>

and maybe do the same with other HBScalar descendants, to get the same results 
i.e. the numeric type:

<prg>

  ? 3 $ {1,2,3,4,5}  // .T.  

</prg>

>
> > I don't want my team to have a non stock (in the sense that is not the
> > official available binary to download) compiler binary and have to
> > build the
> > Harbour compiler with the xhb compatibility flag.
> >
> > This increases the overall complexity of a project, and is why I'm
> > trying to
> > have this feature available in RT with a stock binary Harbour
> > compiler.
>
> Yes, I perfectly understand that, that's why it would be better to move
> away from the current HB_COMPAT_* methods (including, and most
> importantly
> HB_COMPAT_XHB) to external compatibility libraries in contrib.
>
> Maybe this wouldn't solve _all_ the compatibility problems, but with
> some work on the application side too, you can fully migrate to the
> std Harbour build.

Adding the above changes suggested, I believe that now my team can use the 
standard Harbour build.


Thanks Viktor.


best regards

Teo
From harbour.01 at syenar.hu  Mon Sep 24 04:08:44 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 24 04:08:56 2007
Subject: [Harbour] Re: [xHarbour-developers] Differences building apps
	with Harbour and	xHarbour
In-Reply-To: <200709232258.53309.teo@windtelsoft.com>
References: <9257026e0709200248p199ad31bufd8cdef3e33465e6@mail.gmail.com>
	<200709231825.43054.teo@windtelsoft.com>
	<789E1818-4B77-4EE0-BA94-45F2D9F2588F@syenar.hu>
	<200709232258.53309.teo@windtelsoft.com>
Message-ID: <84693310-AAE1-4BFC-94F4-26482C162316@syenar.hu>

>> As far as I can see, most features can be easily moved
>> into a .lib + .ch.
>
> Ok, just to make things clear to me here, this means that new  
> incomming xHB
> users just will need to link this LIB and use the standard Harbour  
> build ?

Yes, that's the idea. Plus to add a new xhb.ch file (which should
be used instead of the current hbcompat.ch)

>>> I have 'ported' without problems a few projects with several
>>> thousands lines
>>> of source code from xHarbour to Harbour, and this apps are running
>>> fine,
>>> however, the only xHB extension that I'm missing now is the
>>> extended "$"
>>> operator.
>>
>> It is exactly the same as AScan( a, x ) (expressed with a bit fewer
>> pcodes,
>> but this can be solved by introducing a dedicated HB_P_ASCAN one,  
>> if we
>> agree on it that it's good for performance. I personally use AScan()
>> with
>> a scanner codeblock in the waste majority of the cases though.)
>
> In this case, i think that we just need to overload the "$"  
> operator in the
> extended type class, in the form:
>
> <prg>
> CLASS HBCharacter FROM HBScalar
> PRIVATE:
> PROTECTED:
> PUBLIC:
>   METHOD IsIn   OPERATOR "$"
> PUBLISHED:
> ENDCLASS
>
> FUNCTION IsIn( itm ) CLASS HBCharacter
>   IF HB_IsArray( itm )
>     RETURN AScan( itm, Self ) > 0
>   ENDIF
> RETURN self $ itm
> </prg>

Yes, exactly.

> and maybe do the same with other HBScalar descendants, to get the  
> same results
> i.e. the numeric type:

I'm really not sure which side of the operator
should be overloaded in this case. Might be that
it's enough to overload the array.

>> Maybe this wouldn't solve _all_ the compatibility problems, but with
>> some work on the application side too, you can fully migrate to the
>> std Harbour build.
>
> Adding the above changes suggested, I believe that now my team can  
> use the
> standard Harbour build.
>
>
> Thanks Viktor.

No problem, now what's left is to implement it. I'll commit
some frame for this lib to start it up. (after I'm finished
with TBrowse())

Brgds,
Viktor

From druzus at priv.onet.pl  Mon Sep 24 09:29:37 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 24 09:29:44 2007
Subject: [Harbour] ChangeLog 2007-09-24 02:05 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <F8B55568-AE60-4FFA-BE4A-72567B29789C@syenar.hu>
References: <20070924000510.GA8122@localhost.localdomain>
	<F8B55568-AE60-4FFA-BE4A-72567B29789C@syenar.hu>
Message-ID: <20070924132937.GA11021@localhost.localdomain>

On Mon, 24 Sep 2007, Szak?ts Viktor wrote:
> Hi Przemek,
> I honestly find this set() solution hugely inelegant,
> can I ask what is the point of these functions? considering
> that you've just introduced hb_setGetL( set_ID )/hb_setGetCPrt( set_ID )
> etc... which _is_ the way this problem should be addressed
> in a nice way.

My main goal is creating API which will allow to stop accessing
hb_set internals by 3-rd party code. hb_setGet*()/hb_setPut*()
functions give nice solution and I'll implement them. But I do
not see anything wrong in having also hb_set<SetName>() functions
to access set values. They are little bit faster then hb_setGet*()
because they eliminate passing parameter and one switch().

> We do have a flexible enum system for all sets (and for good
> reason), and now graving those into stone by creating separate
> functions, well, this _is_ ugly. This is if we'd be creating
> SetExact() in Clipper level which would be nem synomym of
> Set( _SET_EXACT ). What is the point?

It has nothing to .prg code. I want that 3-rd party developers
will stop using hb_set structure directly. My experience shows
that most of [x]Harbour developers do not feel how fast is C
code in comparison to .prg code and try to inline all functions
to reduce "overhead" but in fact they operate on level which
cannot be even measured. It means that real speed factor is less
important then their feeling. So if they will use these functions
seeing their minimal overhead then I reach my goal. In the future
when we will have MT mode it will be _VERY_ important to not use
hb_set directly because some SETs can be global to all threads
and some others local. The functions will hide it so 3-rd party
code will not have to be updated.

> If we really need these (which I see no reason at this
> point), can we at least move them to another new .c file,
> to avoid this bloat to be included in every program.
> But I'd vote to revert this.

If you want. Personally I do not see anything wrong with them
and additional code is minimal. For C calling convention
each function takes only few bytes and look like:

    MOV  AX,hb_set[nn]
    RET

Anyhow if you think that they should be removed then I'll accept
group decision. What's other opinions?
Just for information for people who do not know C internals:
    switch( iValue )
when iValue uses continuous indexes is compiler to very fast
code which looks like:
    JUMP   switch_addrs[ iValue ];
So the overhead caused by switch() in hb_setGet*() functions
will be minimal.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 24 09:50:15 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 24 09:50:32 2007
Subject: [Harbour] ChangeLog 2007-09-24 02:05 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20070924132937.GA11021@localhost.localdomain>
References: <20070924000510.GA8122@localhost.localdomain>
	<F8B55568-AE60-4FFA-BE4A-72567B29789C@syenar.hu>
	<20070924132937.GA11021@localhost.localdomain>
Message-ID: <5F8482CB-872E-4F62-B0F2-90DE3BB9C0A2@syenar.hu>

Hi Przemek,

On 2007.09.24., at 15:29, Przemyslaw Czerpak wrote:

> On Mon, 24 Sep 2007, Szak?ts Viktor wrote:
>> Hi Przemek,
>> I honestly find this set() solution hugely inelegant,
>> can I ask what is the point of these functions? considering
>> that you've just introduced hb_setGetL( set_ID )/hb_setGetCPrt 
>> ( set_ID )
>> etc... which _is_ the way this problem should be addressed
>> in a nice way.
>
> My main goal is creating API which will allow to stop accessing
> hb_set internals by 3-rd party code. hb_setGet*()/hb_setPut*()
> functions give nice solution and I'll implement them. But I do
> not see anything wrong in having also hb_set<SetName>() functions
> to access set values. They are little bit faster then hb_setGet*()
> because they eliminate passing parameter and one switch().
>> We do have a flexible enum system for all sets (and for good
>> reason), and now graving those into stone by creating separate
>> functions, well, this _is_ ugly. This is if we'd be creating
>> SetExact() in Clipper level which would be nem synomym of
>> Set( _SET_EXACT ). What is the point?
>
> It has nothing to .prg code. I want that 3-rd party developers
> will stop using hb_set structure directly. My experience shows
> that most of [x]Harbour developers do not feel how fast is C
> code in comparison to .prg code and try to inline all functions
> to reduce "overhead" but in fact they operate on level which
> cannot be even measured. It means that real speed factor is less
> important then their feeling. So if they will use these functions
> seeing their minimal overhead then I reach my goal. In the future
> when we will have MT mode it will be _VERY_ important to not use
> hb_set directly because some SETs can be global to all threads
> and some others local. The functions will hide it so 3-rd party
> code will not have to be updated.

I perfectly understand the problem of not allowing direct access
to these settings, but I fail to see why do we need to have
_two_ APIs to achieve the same goal.

Your original hb_setGet*() proposal looked like a perfect
solution, but since it's not implemented yet, I think it is
too early to start worrying about them being too slow. (especially
since the difference will probably be _marginal_, and the
settings can be cached locally, if we're talking about a
very tight loop where this call is the main bottleneck.)

Giving such a direct access to internal buffers might also
create problems, since app code can corrupt them.

> If you want. Personally I do not see anything wrong with them
> and additional code is minimal. For C calling convention
> each function takes only few bytes and look like:
>
>     MOV  AX,hb_set[nn]
>     RET
>
> Anyhow if you think that they should be removed then I'll accept
> group decision. What's other opinions?
> Just for information for people who do not know C internals:
>     switch( iValue )
> when iValue uses continuous indexes is compiler to very fast
> code which looks like:
>     JUMP   switch_addrs[ iValue ];
> So the overhead caused by switch() in hb_setGet*() functions
> will be minimal.

Well, to save a few CPU opcodes, I think it's more than
overkill to publish and maintain an alternate set of
low-level API with the exact same purpose.

If we need this extra last bit of speed on SET access, we can
add some _internal_ direct API functions, but only for those
ones where this is indeed important (maybe the few ones used
in the VM and console).

Brgds,
Viktor

From dbtopas at dbtopas.lt  Mon Sep 24 10:56:46 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Sep 24 10:57:51 2007
Subject: [Harbour] ChangeLog 2007-09-24 02:05 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20070924132937.GA11021@localhost.localdomain>
References: <20070924000510.GA8122@localhost.localdomain>	<F8B55568-AE60-4FFA-BE4A-72567B29789C@syenar.hu>
	<20070924132937.GA11021@localhost.localdomain>
Message-ID: <46F7D02E.6060401@dbtopas.lt>

> If you want. Personally I do not see anything wrong with them
> and additional code is minimal. 
> Anyhow if you think that they should be removed then I'll accept
> group decision. What's other opinions?

Hello,


I remember your earlier proposal of 
hb_setGet<Type>(HB_SET_*)/hb_setSet<Type>(HB_SET_*) and I like it.
I thing the problem with Andi's proposed SET access API is not because 
every SET values can be obtained using different function, but because 
the name of the function is missing "get".

I mean
   hb_setAutOpen() and hb_setAutOrder() is bad not because is two 
functions instead of one hb_setGetLogical(HB_SET_*), but it's missing 
"get", it would be better to call it hb_setGetAutOpen(), 
hb_setAutOrder(), etc.

In the future we will need a function to set SET value, i.e. something 
like hb_setSetAutOpen()/hb_setPutAutOpen() or something. So, I think it 
would be more nice solution, if hb_set* prefix would be used for all SET 
related functions, including get functions with hb_setGet* prefix and 
set functions with hb_setPut*/hb_setSet* prefix.

I've tried to write this to xHarbour's list, but spam filter rejects 
mail because of
    550-5.0 INVALID_DATE           Invalid Date: header (not RFC 2822)
though I can see any difference between RFC and Thunderbird's date format :(


I do not know what is better: hb_setGetAutOpen() or 
hb_setGetLogical(HB_SET_*), so I do not vote for any of it. I think we 
must select the best choice, and perhaps it's not too late to change 
functions name or API style in xHarbour, if want to be compatible.


Best regards,
Mindaugas
From lorenzo.fiorini at gmail.com  Mon Sep 24 11:20:51 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Sep 24 11:20:55 2007
Subject: [Harbour] hrb strings "obfuscation"
Message-ID: <9257026e0709240820v760adc41x5c575ce7337da05@mail.gmail.com>

I'm using hrbs as dynamic loadable scripts with the schema below to
avoid many string concatenations but I've found that opening the hrb
with vi the "code" is easily readable and well formatted.

Is there an easy way to obfuscate hrbs strings in hrbs?

I'm not looking for strong security  and I don't plan to use clear
text passwords or sensitive informations but this make really easy to
read urls, parameters, comments and someone could try to "experiment".

best regards,
Lorenzo

#xcommand TEXTSTREAM INTO <v> => #pragma __cstream|<v>+=%s

#pragma escapedstrings = on

function XYZ()

   local cContent := ""

   TEXTSTREAM INTO cContent

   ... html/code here ...

   ENDTEXT

   return cContent
From druzus at priv.onet.pl  Mon Sep 24 12:14:14 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 24 12:14:19 2007
Subject: [Harbour] hrb strings "obfuscation"
In-Reply-To: <9257026e0709240820v760adc41x5c575ce7337da05@mail.gmail.com>
References: <9257026e0709240820v760adc41x5c575ce7337da05@mail.gmail.com>
Message-ID: <20070924161414.GA13128@localhost.localdomain>

On Mon, 24 Sep 2007, Lorenzo Fiorini wrote:
> I'm using hrbs as dynamic loadable scripts with the schema below to
> avoid many string concatenations but I've found that opening the hrb
> with vi the "code" is easily readable and well formatted.
> Is there an easy way to obfuscate hrbs strings in hrbs?
> I'm not looking for strong security  and I don't plan to use clear
> text passwords or sensitive informations but this make really easy to
> read urls, parameters, comments and someone could try to "experiment".

    proc main()
       ? "First normal text"
    #pragma TEXTHIDDEN(1)
       ? "This text is hidden"
    #pragma TEXTHIDDEN(0)
       ? "Second normal text"
    return

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 24 12:41:59 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 24 12:42:08 2007
Subject: [Harbour] ChangeLog 2007-09-24 02:05 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <46F7D02E.6060401@dbtopas.lt>
References: <20070924000510.GA8122@localhost.localdomain>	<F8B55568-AE60-4FFA-BE4A-72567B29789C@syenar.hu>
	<20070924132937.GA11021@localhost.localdomain>
	<46F7D02E.6060401@dbtopas.lt>
Message-ID: <516CCCBA-F419-4EEB-A7A9-C987179CE69D@syenar.hu>

Hi,

On 2007.09.24., at 16:56, Mindaugas Kavaliauskas wrote:

>> If you want. Personally I do not see anything wrong with them
>> and additional code is minimal. Anyhow if you think that they  
>> should be removed then I'll accept
>> group decision. What's other opinions?
>
> Hello,
>
>
> I remember your earlier proposal of hb_setGet<Type>(HB_SET_*)/ 
> hb_setSet<Type>(HB_SET_*) and I like it.
> I thing the problem with Andi's proposed SET access API is not  
> because every SET values can be obtained using different function,  
> but because the name of the function is missing "get".

I fully agree with it in case we want to keep all or
any of these functions even as internal alternatives.

> I mean
>   hb_setAutOpen() and hb_setAutOrder() is bad not because is two  
> functions instead of one hb_setGetLogical(HB_SET_*), but it's  
> missing "get", it would be better to call it hb_setGetAutOpen(),  
> hb_setAutOrder(), etc.
>
> In the future we will need a function to set SET value, i.e.  
> something like hb_setSetAutOpen()/hb_setPutAutOpen() or something.  
> So, I think it would be more nice solution, if hb_set* prefix would  
> be used for all SET related functions, including get functions with  
> hb_setGet* prefix and set functions with hb_setPut*/hb_setSet* prefix.
>
> I've tried to write this to xHarbour's list, but spam filter  
> rejects mail because of
>    550-5.0 INVALID_DATE           Invalid Date: header (not RFC 2822)
> though I can see any difference between RFC and Thunderbird's date  
> format :(
>
> I do not know what is better: hb_setGetAutOpen() or hb_setGetLogical 
> (HB_SET_*), so I do not vote for any of it. I think we must select  
> the best choice, and perhaps it's not too late to change functions  
> name or API style in xHarbour, if want to be compatible.

I agree. My vote to hb_setGet*( enum ) because it's easier to extend,
maintain, much more elegant, much less redundant and much better follows
the CA-Cl*pper level API logic.

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Mon Sep 24 13:11:21 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Sep 24 13:11:30 2007
Subject: [Harbour] hrb strings "obfuscation"
In-Reply-To: <20070924161414.GA13128@localhost.localdomain>
References: <9257026e0709240820v760adc41x5c575ce7337da05@mail.gmail.com>
	<20070924161414.GA13128@localhost.localdomain>
Message-ID: <9257026e0709241011n56072974h3fc9684e8d0604f4@mail.gmail.com>

On 9/24/07, Przemyslaw Czerpak <druzus@priv.onet.pl> wrote:

>     proc main()
>        ? "First normal text"
>     #pragma TEXTHIDDEN(1)
>        ? "This text is hidden"
>     #pragma TEXTHIDDEN(0)
>        ? "Second normal text"
>     return

I've tried but I get:

demo2.hrb operation: TEXTHIDDEN description: Unknown or unregistered
symbol oscode: 0 subsys/subcode: BASE/9999 proc/line:

best regards,
Lorenzo
From druzus at priv.onet.pl  Mon Sep 24 13:35:27 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 24 13:35:35 2007
Subject: [Harbour] hrb strings "obfuscation"
In-Reply-To: <9257026e0709241011n56072974h3fc9684e8d0604f4@mail.gmail.com>
References: <9257026e0709240820v760adc41x5c575ce7337da05@mail.gmail.com>
	<20070924161414.GA13128@localhost.localdomain>
	<9257026e0709241011n56072974h3fc9684e8d0604f4@mail.gmail.com>
Message-ID: <20070924173527.GA13493@localhost.localdomain>

On Mon, 24 Sep 2007, Lorenzo Fiorini wrote:
> >     proc main()
> >        ? "First normal text"
> >     #pragma TEXTHIDDEN(1)
> >        ? "This text is hidden"
> >     #pragma TEXTHIDDEN(0)
> >        ? "Second normal text"
> >     return
> I've tried but I get:
> demo2.hrb operation: TEXTHIDDEN description: Unknown or unregistered
> symbol oscode: 0 subsys/subcode: BASE/9999 proc/line:

Lorenzo I do not know what you've tried but for sure it was
not code like above because it does not contain any TEXTHIDDEN()
function.
You added somewhere to your code call to TEXTHIDDEN() function
and this is the reason of RT error.
In the code above we only have PP directive:
    #pragma TEXTHIDDEN(0|1)
It's not a functin call. If you like then you can also use:
    #pragma TEXTHIDDEN = 0|1
f.e.:

    proc main()
       ? "First normal text"
    #pragma TEXTHIDDEN = 1
       ? "This text is hidden"
    #pragma TEXTHIDDEN = 0
       ? "Second normal text"
    return

Both versions means the same and both works.

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Mon Sep 24 15:58:51 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Sep 24 15:59:18 2007
Subject: [Harbour] hrb strings "obfuscation"
In-Reply-To: <20070924173527.GA13493@localhost.localdomain>
References: <9257026e0709240820v760adc41x5c575ce7337da05@mail.gmail.com>
	<20070924161414.GA13128@localhost.localdomain>
	<9257026e0709241011n56072974h3fc9684e8d0604f4@mail.gmail.com>
	<20070924173527.GA13493@localhost.localdomain>
Message-ID: <9257026e0709241258g65ce82c1s8b018d2d65e72335@mail.gmail.com>

On 9/24/07, Przemyslaw Czerpak <druzus@priv.onet.pl> wrote:

> You added somewhere to your code call to TEXTHIDDEN() function
> and this is the reason of RT error.

Sorry you're right I've left a "test row" elsewhere :(

Once fixed it worked as expected.

best regards,
Lorenzo
From druzus at priv.onet.pl  Mon Sep 24 16:01:03 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 24 16:01:16 2007
Subject: [Harbour] hblog ported from xHarbour
In-Reply-To: <9257026e0709221333te0c1dajabc43c2b58570ea5@mail.gmail.com>
References: <9257026e0709221333te0c1dajabc43c2b58570ea5@mail.gmail.com>
Message-ID: <20070924200103.GA18873@localhost.localdomain>

On Sat, 22 Sep 2007, Lorenzo Fiorini wrote:
> Here attached there is a "raw" port of hblog functions from xHarbour.
> I've tested console and file channels under Linux and they works for me.
> Could it be added to contrib/hblog?

IMHO we should create contrib/xhb library and keep all xHarbour
functions which we do not want to have in core code in this library.
You can start it

> Could any C developer check C code?

I'll look at it.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 24 16:12:07 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 24 16:12:24 2007
Subject: [Harbour] hblog ported from xHarbour
In-Reply-To: <20070924200103.GA18873@localhost.localdomain>
References: <9257026e0709221333te0c1dajabc43c2b58570ea5@mail.gmail.com>
	<20070924200103.GA18873@localhost.localdomain>
Message-ID: <108DA091-9BFF-4173-AAD8-ACD4142EB7F0@syenar.hu>


On 2007.09.24., at 22:01, Przemyslaw Czerpak wrote:

> On Sat, 22 Sep 2007, Lorenzo Fiorini wrote:
>> Here attached there is a "raw" port of hblog functions from xHarbour.
>> I've tested console and file channels under Linux and they works  
>> for me.
>> Could it be added to contrib/hblog?
>
> IMHO we should create contrib/xhb library and keep all xHarbour
> functions which we do not want to have in core code in this library.
> You can start it

I'll do this soon.

contrib/xhb/ (or compxhb? because we might have other compatibility  
libs too)
contrib/xhb/xhb.ch
contrib/xhb/usual make files
contrib/xhb/program files (.c and .prg)

As an added bonus, xhb compatible low-level API calls can
also be added (and moved) here.

Brgds,
Viktor

From druzus at priv.onet.pl  Mon Sep 24 16:50:52 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 24 16:50:59 2007
Subject: [Harbour] hblog ported from xHarbour
In-Reply-To: <108DA091-9BFF-4173-AAD8-ACD4142EB7F0@syenar.hu>
References: <9257026e0709221333te0c1dajabc43c2b58570ea5@mail.gmail.com>
	<20070924200103.GA18873@localhost.localdomain>
	<108DA091-9BFF-4173-AAD8-ACD4142EB7F0@syenar.hu>
Message-ID: <20070924205052.GC18873@localhost.localdomain>

On Mon, 24 Sep 2007, Szak?ts Viktor wrote:
> >IMHO we should create contrib/xhb library and keep all xHarbour
> >functions which we do not want to have in core code in this library.
> >You can start it
> I'll do this soon.
> contrib/xhb/ (or compxhb? because we might have other compatibility  
> libs too)
> contrib/xhb/xhb.ch
> contrib/xhb/usual make files
> contrib/xhb/program files (.c and .prg)
> As an added bonus, xhb compatible low-level API calls can
> also be added (and moved) here.

I've already created such library in contrib/xhb with
HBLOG, HBXML, HBCSTRUCT
If you agree then I'd like to commit it.
I also want to commit RDD modifications with HB_FT_* and HB_FF_*
as I informed in last week and HBSIX library with all SIx3 Sx_*()
functions.
I plan to make it ASAP so if someone wants to stop me then should
tell me about it now.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 24 17:21:55 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 24 17:22:04 2007
Subject: [Harbour] hblog ported from xHarbour
In-Reply-To: <20070924205052.GC18873@localhost.localdomain>
References: <9257026e0709221333te0c1dajabc43c2b58570ea5@mail.gmail.com>
	<20070924200103.GA18873@localhost.localdomain>
	<108DA091-9BFF-4173-AAD8-ACD4142EB7F0@syenar.hu>
	<20070924205052.GC18873@localhost.localdomain>
Message-ID: <3EDCE8E5-8370-4765-98A9-F60AD575A66B@syenar.hu>


On 2007.09.24., at 22:50, Przemyslaw Czerpak wrote:

> On Mon, 24 Sep 2007, Szak?ts Viktor wrote:
>>> IMHO we should create contrib/xhb library and keep all xHarbour
>>> functions which we do not want to have in core code in this library.
>>> You can start it
>> I'll do this soon.
>> contrib/xhb/ (or compxhb? because we might have other compatibility
>> libs too)
>> contrib/xhb/xhb.ch
>> contrib/xhb/usual make files
>> contrib/xhb/program files (.c and .prg)
>> As an added bonus, xhb compatible low-level API calls can
>> also be added (and moved) here.
>
> I've already created such library in contrib/xhb with
> HBLOG, HBXML, HBCSTRUCT
> If you agree then I'd like to commit it.
> I also want to commit RDD modifications with HB_FT_* and HB_FF_*
> as I informed in last week and HBSIX library with all SIx3 Sx_*()
> functions.
> I plan to make it ASAP so if someone wants to stop me then should
> tell me about it now.

OK, I agree. I understand this is the low-level part of the RDD
modification, right? (so we're not touching any dbCreate()
structures yet)

BTW, there is a bug in dbcmd.c/dbSkipper() where it returns
NIL instead of 0 (I've confirmed with XPP), when the table
is empty. The fix is simple: hb_retnl( lSkipped ) should be moved
one level higher. This bug had pretty wide consequences in xhb
and ignited many workarounds on TBrowse() level, and there was
a TBrowse() crash report here too a few weeks ago, caused by this
same problem. (The new TBrowse() will mask this problem on its
own level by not allowing the ::skipBlock to return anything
else than a numeric, but that's another matter.)

I have the fix pending, but if you could commit it now, it
would be even better.

Brgds,
Viktor

From druzus at priv.onet.pl  Mon Sep 24 21:20:15 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 24 21:20:23 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070925012014.GA7796@localhost.localdomain>

2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbset.h
  * harbour/source/rtl/set.c
    * changed recently added hb_set*() functions to hb_setGet*()
      Please do not use these functions yet - it's possible that
      they will be removed soon.
    + added hb_setGetL(), hb_setGetCPtr(), hb_setGetNI(), hb_setGetNL()

  * harbour/contrib/libct/dattime2.c
  * harbour/contrib/samples/date.c
    * use hb_setGetCentury() instead of hb_setGetL( hb_set_century )
      we do not have hb_set_century SET switch so hb_setGetL() cannot
      be used

  * harbour/harbour.spec
  * harbour/bin/hb-func.sh
  * harbour/bin/pack_src.sh
  * harbour/contrib/Makefile
  + harbour/contrib/xhb
  + harbour/contrib/xhb/hboutdbg.c
  + harbour/contrib/xhb/cstruct.ch
  + harbour/contrib/xhb/hblog.prg
  + harbour/contrib/xhb/hblog.ch
  + harbour/contrib/xhb/hblognet.prg
  + harbour/contrib/xhb/hbxml.c
  + harbour/contrib/xhb/hbxml.h
  + harbour/contrib/xhb/hbxml.ch
  + harbour/contrib/xhb/hblogdef.ch
  + harbour/contrib/xhb/hbctypes.ch
  + harbour/contrib/xhb/wintypes.ch
  + harbour/contrib/xhb/txml.prg
  + harbour/contrib/xhb/hbsyslog.c
  + harbour/contrib/xhb/cstructc.c
  + harbour/contrib/xhb/Makefile
  + harbour/contrib/xhb/cstruct.prg
  + harbour/contrib/xhb/xhbfunc.c
    + added XHB library with xharbour compatible functions borrowed from
      xHarbour. Now it contains HBLOG, HBXML, HBCSTRUCT, HASH, INET*()
      functions and classes.

  * harbour/source/rtl/itemseri.c
  * harbour/source/rtl/strmatch.c
  * harbour/source/rtl/hbinet.c
  * harbour/source/vm/hashfunc.c
     * moved xHarbour compatible functions to XHB library

  * harbour/source/vm/classes.c
     + added support for ERROR HANDLER message in scalar classes

  * harbour/contrib/tip/mail.prg
  * harbour/contrib/tip/ftpcln.prg
    + added #include "hbcompat.ch"

  * harbour/include/hbdbferr.h
    + added new RT errors: EDBF_CREATE_TEMP, EDBF_WRITE_TEMP, EDBF_READ_TEMP

  * harbour/include/dbinfo.ch
    + added DBI_ENCRYPT, DBI_DECRYPT, DBI_MEMOPACK, DBI_DIRTYREAD
    + added DBOI_INDEXTYPE, DBOI_USECURRENT
    + added RDDI_LOCKRETRY, RDDI_DIRTYREAD

  * harbour/include/dbinfo.ch
  * harbour/include/hbrdddbf.h
  * harbour/include/hbrddfpt.h
  * harbour/include/hbrddcdx.h
  * harbour/include/hbrddntx.h
  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/dbffpt/dbffpt1.c
  * harbour/source/rdd/dbfntx/dbfntx1.c
  * harbour/source/rdd/dbfcdx/dbfcdx1.c
    + added support for MEMOPACK, table ENCRYPT/DECRYPT, index DIRTYREAD

  * harbour/include/hbapirdd.h
  * harbour/include/dbstruct.ch
  * harbour/include/hbusrrdd.ch
  * harbour/contrib/rdd_ads/ads1.c
  * harbour/contrib/rdd_ads/ace.h
  * harbour/source/rdd/dbfdbt/dbfdbt1.c
  * harbour/source/rdd/dbffpt/dbffpt1.c
  * harbour/source/rdd/dbcmd.c
  * harbour/source/rdd/wafunc.c
  * harbour/source/rdd/workarea.c
  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/sdf1.c
  * harbour/source/rdd/delim1.c
    * changed HB_IT_* as field type to HB_FT_*
    + added field flags HB_FF_*
    + added support for new field types to core code

  * harbour/source/rdd/dbf1.c
    + added support for AUTOINC (+), ROWVERSION (^), TIME (T), DAYTIME (@)
      and MODTIME (=) fields

  * harbour/contrib/rdd_ads/ads1.c
  * harbour/contrib/rdd_ads/ace.h
    + added support for ROWVERSION (^), and MODTIME (=) fields

  ! harbour/source/rdd/dbcmd.c
    * fixed bug in dbSkipper() reported by Viktor

  + harbour/include/hbsix.ch
  * harbour/source/rdd/hbsix/Makefile
  * harbour/source/rdd/hbsix/sxdate.c
  * harbour/source/rdd/hbsix/sxcompr.c
  * harbour/source/rdd/hbsix/sxcrypt.c
  + harbour/source/rdd/hbsix/sxsem.c
  + harbour/source/rdd/hbsix/sxord.c
  + harbour/source/rdd/hbsix/sxredir.c
  + harbour/source/rdd/hbsix/sxfname.c
  + harbour/source/rdd/hbsix/sxtable.c
  + harbour/source/rdd/hbsix/sxutil.c
  + harbour/source/rdd/hbsix/sxcompat.prg
  + harbour/source/rdd/hbsix/sxtrig.prg
  + harbour/source/rdd/hbsix/sxini.prg
    + added SIx3 compatible functions:
         RDD_Count(), RDD_Name(), RDD_Info(), SetRDD(),
         sxChar(), sxNum(), sxDate(), sxLog(),
         Sx_DToP(), Sx_PToD(),
         Sx_BLOB2File(), Sx_File2BLOB(),
         Sx_Compress(), Sx_Decompress(),
         Sx_FCompress(), Sx_FDecompress(),
         Sx_AutoOpen(), Sx_AutoShare(),
         Sx_MemoExt(), Sx_MemoBlk(), Sx_SetMemoBlock(), Sx_MemoPack(),
         Sx_SetTrigger(), Sx_SetTrig(), Sx_DefTrigger(), 
         Sx_INIheader(), _sx_INIinit(), _sxOpenInit(),
         Sx_SetPass(),
         Sx_Encrypt(), Sx_Decrypt(), Sx_DBFdecrypt(), Sx_DBFencrypt(),
         sx_MakeSem(), sx_KillSem(), sx_IsSem(),
         Sx_ClrScope(), Sx_SetScope(),
         Sx_Freeze(), Sx_Warm(), Sx_Chill(), Sx_Thermometer(),
         Sx_IsReindex(), Sx_Step(), Sx_KeysIncluded(),
         Sx_I_IndexName(), Sx_I_TagName(),
         Sx_IndexCount(), Sx_IndexName(), Sx_IndexType(), Sx_IndexFilter(),
         Sx_ROXLock(), Sx_ROXUnLock(), Sx_IsMyROX(), Sx_IsROXLock(),
         Sx_KeyAdd(), Sx_KeyDrop(), Sx_KeyData(),
         Sx_KeySkip(), Sx_KeyCount(), Sx_KeyNo(), Sx_KeyGoto(),
         Sx_WildSeek(), Sx_WildMatch(),
         Sx_IsFLocked(), Sx_IsReadOnly(), Sx_IsShared(),
         Sx_IsLocked(), Sx_IsDBT(),
         Sx_IDtype(), Sx_TableType(), Sx_TableName(),
         Sx_SetTurbo(), Sx_TurboArea(), Sx_SetDirty(), Sx_DirtyArea(),
         Sx_RLock(), Sx_UnLock(), Sx_GetLocks(), Sx_LockRetry(),
         Sx_SeekLast(), Sx_FindRec(),
         Sx_SkipUnique(), Sx_TagUnique(),
         Sx_TagCount(), Sx_TagOrder(), Sx_TagNo(), Sx_TagName(),
         Sx_TagInfo(), Sx_Tags(),
         Sx_SetTag(), Sx_SetTagOrder(), Sx_SetTagNo(),
         Sx_KillTag(),
         Sx_FileOrder(), Sx_SetFileOrd(), Sx_ClearOrder(),
         Sx_VSigLen(), Sx_VFGet(),
         Sx_dbCreate(), Sx_StrxCheck(), Sx_Rollback(), Sx_SortOption(),
         _sxCondSet(),
         Sx_FNameParser(), Sx_SlimFast(),
         Sx_Version(), Sx_Error(),

    + added SIx3 compatible commands:
         SET DIRTYREAD ON|OFF
         USE ... [TRIGGER <cTrigger>] [PASSWORD <cPassword>]
         SORT ... USECURRENT
         WILDSEEK <str>
         WILDSEEKNEXT <str>
         CLEAR ORDER <order>
         SET TAGORDER TO [<order>]
         SET ORDER TO TAG <(tag)> [OF <(bag)>]
         SET TAG TO [<tag> [OF <(bag)>]]
         REINDEX OPTION <eval> [STEP <step>]
         DELETE TAG <(tag1)> [OF <(bag1)>] [, <(tagN)> [OF <(bagN)>]]
         DELETE TAG ALL [OF <(bag)>]
         CLEAR SCOPE
         SET SCOPETOP TO [<value>]
         SET SCOPEBOTTOM TO [<value>]
         SET SCOPE TO [<value>]
         SET TURBOREAD ON|OFF
         MEMOPACK [BLOCK <size>] [OPTION <opt> [STEP <step>]]
         SET MEMOBLOCK TO <value>
         SUBINDEX ON <key> TO <(file)> ;
               [OPTION <eval> [STEP <every>]] [FILTERON] [EMPTY]
         SUBINDEX ON <key> TAG <(tag)> [OF <(bag)>] [TO <(bag)>] ;
               [OPTION <eval> [STEP <every>]] [FILTERON] [EMPTY]
         INDEX ON <key> [TAG <(tag)>] TO <(bag)> ;
               [OPTION <eval> [STEP <every>]] [FILTERON] [EMPTY] [SUBINDEX]
         INDEX ON <key> TAG <(tag)> [OF <(bag)>] [TO <(bag)>] ;
               [OPTION <eval> [STEP <every>]] [FILTERON] [EMPTY] [SUBINDEX]

      Unlike Ads*() functions the Sx_*() ones can be used with any RDD
      and will work if RDD supports necessary functionality.

      The global settings in SIx3 are RDD dependent in Harbour, f.e.
      in SIx3 Sx_MemoExt() change MEMO file extensions in all SIX* RDDs
      but in Harbour only in default RDD driver.
      In Harbour default trigger function "Sx_DefTrigger" is not
      enabled by default. If user needs such functionality then he
      has to enable it himself using
         rddInfo( RDDI_TRIGGER, "SX_DEFTRIGGER", [<cRDD>] )
      f.e. this code:
         init procedure sx_inittrig()
            local aRDDs := { "DBF", "DBFNTX", "DBFCDX", "SIXCDX", ;
                             "RMDBFNTX", "RMDBFCDX" }
            local aRDDList := RddList(), cRdd

            for each cRdd in aRDDs
               if ascan( aRDDList, { |x| x == cRdd } ) != 0
                  rddInfo( RDDI_TRIGGER, "SX_DEFTRIGGER", cRDD )
               endif
            next
         return
      sets SX_DEFTRIGGER as default trigger in DBF* based RDDs.

      I still do not allow to encrypt tables with memo fields to not
      replicate SIx3 bugs which may cause data corruption.

best regards,
Przemek
From druzus at priv.onet.pl  Mon Sep 24 21:48:14 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Mon Sep 24 21:48:20 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:35 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070925014814.GB7796@localhost.localdomain>

2007-09-25 03:35 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbextern.ch
  + harbour/contrib/xhb/xhbextrn.ch
  * harbour/contrib/xhb/Makefile
    * moved xHarbour compatible functions from hbextern.ch to xhbextrn.ch

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Sep 24 21:54:46 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 24 21:54:56 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20070925012014.GA7796@localhost.localdomain>
References: <20070925012014.GA7796@localhost.localdomain>
Message-ID: <3DF60C9D-CF8A-4BF9-B577-F30395C324CE@syenar.hu>

Thanks Przemek. Massive commit.

Back to the field flags topic. Is it possible
to use the type field to specify additional
field flags, instead of using a new dbstruct
array member? First of all because one Clipper
implementation already uses the type field this
way (as you've said), second: it's much easier
to add one (or two) more character(s) to those
field type where this is needed, than adding
a whole new column to every line of every
table declaration arrays where one wants to
add even a single type flag. Also, since this
is not a compatible extension, some might want
to disable it for other Clipper compilers,
which is impossible to do by simple methods,
like #ifdefs, even reprocessing the array
is much slower than keeping the first char of
the type string.

One plus reason is that we'll have to more
severaly extend several functions dealing
with table structures, instead of just
saying that type can be more than one char
inside Harbour from now on.

Can we at least select the flag characters
in a way that they wouldn't collide with
existing type characters (maybe this is the
case already), so that we have the future
possibility or option to mix them (if we cannot
do this move right now).

What do you think?

Brgds,
Viktor

On 2007.09.25., at 3:20, Przemyslaw Czerpak wrote:

> 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/include/hbset.h
>   * harbour/source/rtl/set.c
>     * changed recently added hb_set*() functions to hb_setGet*()
>       Please do not use these functions yet - it's possible that
>       they will be removed soon.
>     + added hb_setGetL(), hb_setGetCPtr(), hb_setGetNI(),  
> hb_setGetNL()
>
>   * harbour/contrib/libct/dattime2.c
>   * harbour/contrib/samples/date.c
>     * use hb_setGetCentury() instead of hb_setGetL( hb_set_century )
>       we do not have hb_set_century SET switch so hb_setGetL() cannot
>       be used
>
>   * harbour/harbour.spec
>   * harbour/bin/hb-func.sh
>   * harbour/bin/pack_src.sh
>   * harbour/contrib/Makefile
>   + harbour/contrib/xhb
>   + harbour/contrib/xhb/hboutdbg.c
>   + harbour/contrib/xhb/cstruct.ch
>   + harbour/contrib/xhb/hblog.prg
>   + harbour/contrib/xhb/hblog.ch
>   + harbour/contrib/xhb/hblognet.prg
>   + harbour/contrib/xhb/hbxml.c
>   + harbour/contrib/xhb/hbxml.h
>   + harbour/contrib/xhb/hbxml.ch
>   + harbour/contrib/xhb/hblogdef.ch
>   + harbour/contrib/xhb/hbctypes.ch
>   + harbour/contrib/xhb/wintypes.ch
>   + harbour/contrib/xhb/txml.prg
>   + harbour/contrib/xhb/hbsyslog.c
>   + harbour/contrib/xhb/cstructc.c
>   + harbour/contrib/xhb/Makefile
>   + harbour/contrib/xhb/cstruct.prg
>   + harbour/contrib/xhb/xhbfunc.c
>     + added XHB library with xharbour compatible functions borrowed  
> from
>       xHarbour. Now it contains HBLOG, HBXML, HBCSTRUCT, HASH, INET*()
>       functions and classes.
>
>   * harbour/source/rtl/itemseri.c
>   * harbour/source/rtl/strmatch.c
>   * harbour/source/rtl/hbinet.c
>   * harbour/source/vm/hashfunc.c
>      * moved xHarbour compatible functions to XHB library
>
>   * harbour/source/vm/classes.c
>      + added support for ERROR HANDLER message in scalar classes
>
>   * harbour/contrib/tip/mail.prg
>   * harbour/contrib/tip/ftpcln.prg
>     + added #include "hbcompat.ch"
>
>   * harbour/include/hbdbferr.h
>     + added new RT errors: EDBF_CREATE_TEMP, EDBF_WRITE_TEMP,  
> EDBF_READ_TEMP
>
>   * harbour/include/dbinfo.ch
>     + added DBI_ENCRYPT, DBI_DECRYPT, DBI_MEMOPACK, DBI_DIRTYREAD
>     + added DBOI_INDEXTYPE, DBOI_USECURRENT
>     + added RDDI_LOCKRETRY, RDDI_DIRTYREAD
>
>   * harbour/include/dbinfo.ch
>   * harbour/include/hbrdddbf.h
>   * harbour/include/hbrddfpt.h
>   * harbour/include/hbrddcdx.h
>   * harbour/include/hbrddntx.h
>   * harbour/source/rdd/dbf1.c
>   * harbour/source/rdd/dbffpt/dbffpt1.c
>   * harbour/source/rdd/dbfntx/dbfntx1.c
>   * harbour/source/rdd/dbfcdx/dbfcdx1.c
>     + added support for MEMOPACK, table ENCRYPT/DECRYPT, index  
> DIRTYREAD
>
>   * harbour/include/hbapirdd.h
>   * harbour/include/dbstruct.ch
>   * harbour/include/hbusrrdd.ch
>   * harbour/contrib/rdd_ads/ads1.c
>   * harbour/contrib/rdd_ads/ace.h
>   * harbour/source/rdd/dbfdbt/dbfdbt1.c
>   * harbour/source/rdd/dbffpt/dbffpt1.c
>   * harbour/source/rdd/dbcmd.c
>   * harbour/source/rdd/wafunc.c
>   * harbour/source/rdd/workarea.c
>   * harbour/source/rdd/dbf1.c
>   * harbour/source/rdd/sdf1.c
>   * harbour/source/rdd/delim1.c
>     * changed HB_IT_* as field type to HB_FT_*
>     + added field flags HB_FF_*
>     + added support for new field types to core code
>
>   * harbour/source/rdd/dbf1.c
>     + added support for AUTOINC (+), ROWVERSION (^), TIME (T),  
> DAYTIME (@)
>       and MODTIME (=) fields
>
>   * harbour/contrib/rdd_ads/ads1.c
>   * harbour/contrib/rdd_ads/ace.h
>     + added support for ROWVERSION (^), and MODTIME (=) fields
>
>   ! harbour/source/rdd/dbcmd.c
>     * fixed bug in dbSkipper() reported by Viktor
>
>   + harbour/include/hbsix.ch
>   * harbour/source/rdd/hbsix/Makefile
>   * harbour/source/rdd/hbsix/sxdate.c
>   * harbour/source/rdd/hbsix/sxcompr.c
>   * harbour/source/rdd/hbsix/sxcrypt.c
>   + harbour/source/rdd/hbsix/sxsem.c
>   + harbour/source/rdd/hbsix/sxord.c
>   + harbour/source/rdd/hbsix/sxredir.c
>   + harbour/source/rdd/hbsix/sxfname.c
>   + harbour/source/rdd/hbsix/sxtable.c
>   + harbour/source/rdd/hbsix/sxutil.c
>   + harbour/source/rdd/hbsix/sxcompat.prg
>   + harbour/source/rdd/hbsix/sxtrig.prg
>   + harbour/source/rdd/hbsix/sxini.prg
>     + added SIx3 compatible functions:
>          RDD_Count(), RDD_Name(), RDD_Info(), SetRDD(),
>          sxChar(), sxNum(), sxDate(), sxLog(),
>          Sx_DToP(), Sx_PToD(),
>          Sx_BLOB2File(), Sx_File2BLOB(),
>          Sx_Compress(), Sx_Decompress(),
>          Sx_FCompress(), Sx_FDecompress(),
>          Sx_AutoOpen(), Sx_AutoShare(),
>          Sx_MemoExt(), Sx_MemoBlk(), Sx_SetMemoBlock(), Sx_MemoPack(),
>          Sx_SetTrigger(), Sx_SetTrig(), Sx_DefTrigger(),
>          Sx_INIheader(), _sx_INIinit(), _sxOpenInit(),
>          Sx_SetPass(),
>          Sx_Encrypt(), Sx_Decrypt(), Sx_DBFdecrypt(), Sx_DBFencrypt(),
>          sx_MakeSem(), sx_KillSem(), sx_IsSem(),
>          Sx_ClrScope(), Sx_SetScope(),
>          Sx_Freeze(), Sx_Warm(), Sx_Chill(), Sx_Thermometer(),
>          Sx_IsReindex(), Sx_Step(), Sx_KeysIncluded(),
>          Sx_I_IndexName(), Sx_I_TagName(),
>          Sx_IndexCount(), Sx_IndexName(), Sx_IndexType(),  
> Sx_IndexFilter(),
>          Sx_ROXLock(), Sx_ROXUnLock(), Sx_IsMyROX(), Sx_IsROXLock(),
>          Sx_KeyAdd(), Sx_KeyDrop(), Sx_KeyData(),
>          Sx_KeySkip(), Sx_KeyCount(), Sx_KeyNo(), Sx_KeyGoto(),
>          Sx_WildSeek(), Sx_WildMatch(),
>          Sx_IsFLocked(), Sx_IsReadOnly(), Sx_IsShared(),
>          Sx_IsLocked(), Sx_IsDBT(),
>          Sx_IDtype(), Sx_TableType(), Sx_TableName(),
>          Sx_SetTurbo(), Sx_TurboArea(), Sx_SetDirty(), Sx_DirtyArea(),
>          Sx_RLock(), Sx_UnLock(), Sx_GetLocks(), Sx_LockRetry(),
>          Sx_SeekLast(), Sx_FindRec(),
>          Sx_SkipUnique(), Sx_TagUnique(),
>          Sx_TagCount(), Sx_TagOrder(), Sx_TagNo(), Sx_TagName(),
>          Sx_TagInfo(), Sx_Tags(),
>          Sx_SetTag(), Sx_SetTagOrder(), Sx_SetTagNo(),
>          Sx_KillTag(),
>          Sx_FileOrder(), Sx_SetFileOrd(), Sx_ClearOrder(),
>          Sx_VSigLen(), Sx_VFGet(),
>          Sx_dbCreate(), Sx_StrxCheck(), Sx_Rollback(), Sx_SortOption 
> (),
>          _sxCondSet(),
>          Sx_FNameParser(), Sx_SlimFast(),
>          Sx_Version(), Sx_Error(),
>
>     + added SIx3 compatible commands:
>          SET DIRTYREAD ON|OFF
>          USE ... [TRIGGER <cTrigger>] [PASSWORD <cPassword>]
>          SORT ... USECURRENT
>          WILDSEEK <str>
>          WILDSEEKNEXT <str>
>          CLEAR ORDER <order>
>          SET TAGORDER TO [<order>]
>          SET ORDER TO TAG <(tag)> [OF <(bag)>]
>          SET TAG TO [<tag> [OF <(bag)>]]
>          REINDEX OPTION <eval> [STEP <step>]
>          DELETE TAG <(tag1)> [OF <(bag1)>] [, <(tagN)> [OF <(bagN)>]]
>          DELETE TAG ALL [OF <(bag)>]
>          CLEAR SCOPE
>          SET SCOPETOP TO [<value>]
>          SET SCOPEBOTTOM TO [<value>]
>          SET SCOPE TO [<value>]
>          SET TURBOREAD ON|OFF
>          MEMOPACK [BLOCK <size>] [OPTION <opt> [STEP <step>]]
>          SET MEMOBLOCK TO <value>
>          SUBINDEX ON <key> TO <(file)> ;
>                [OPTION <eval> [STEP <every>]] [FILTERON] [EMPTY]
>          SUBINDEX ON <key> TAG <(tag)> [OF <(bag)>] [TO <(bag)>] ;
>                [OPTION <eval> [STEP <every>]] [FILTERON] [EMPTY]
>          INDEX ON <key> [TAG <(tag)>] TO <(bag)> ;
>                [OPTION <eval> [STEP <every>]] [FILTERON] [EMPTY]  
> [SUBINDEX]
>          INDEX ON <key> TAG <(tag)> [OF <(bag)>] [TO <(bag)>] ;
>                [OPTION <eval> [STEP <every>]] [FILTERON] [EMPTY]  
> [SUBINDEX]
>
>       Unlike Ads*() functions the Sx_*() ones can be used with any RDD
>       and will work if RDD supports necessary functionality.
>
>       The global settings in SIx3 are RDD dependent in Harbour, f.e.
>       in SIx3 Sx_MemoExt() change MEMO file extensions in all SIX*  
> RDDs
>       but in Harbour only in default RDD driver.
>       In Harbour default trigger function "Sx_DefTrigger" is not
>       enabled by default. If user needs such functionality then he
>       has to enable it himself using
>          rddInfo( RDDI_TRIGGER, "SX_DEFTRIGGER", [<cRDD>] )
>       f.e. this code:
>          init procedure sx_inittrig()
>             local aRDDs := { "DBF", "DBFNTX", "DBFCDX", "SIXCDX", ;
>                              "RMDBFNTX", "RMDBFCDX" }
>             local aRDDList := RddList(), cRdd
>
>             for each cRdd in aRDDs
>                if ascan( aRDDList, { |x| x == cRdd } ) != 0
>                   rddInfo( RDDI_TRIGGER, "SX_DEFTRIGGER", cRDD )
>                endif
>             next
>          return
>       sets SX_DEFTRIGGER as default trigger in DBF* based RDDs.
>
>       I still do not allow to encrypt tables with memo fields to not
>       replicate SIx3 bugs which may cause data corruption.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Sep 24 22:43:28 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Sep 24 22:43:33 2007
Subject: [Harbour] CHANGELOG: 2007-09-25 04:30 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7ff1d$Blat.v2.6.2$da564f94$15e8ecd1ded0@127.0.0.1>

2007-09-25 04:30 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * contrib/xhb/Makefile
   * contrib/xhb/xhbfunc.c
   + contrib/xhb/xhb.ch
   + contrib/xhb/xhbcomp.prg
     + Added xhb_AScan(), xhb_AIns(), xhb_ADel() plus defines 
       to redirect extended AScan(), AIns(), ADel() calls to these 
       functions. They need to be tested as I'm no xhb user.
     + Added compatibility header, which adds a the above translations 
       and include hbcompat.ch.
     + Added INIT PROC xhb_Init() as a future place for xhb specific 
       startup settings.
     ; TODO:
       - Add $ and [] operator overloading.
       - Add operator overloading for hash type.
       - Add a way hash API call to control the default flag 
         hb_hashNew() uses, then add this default setting to 
         the xhb libs INIT PROC.
     ; For better xhb compatibility, developers should add 
       #ifndef __XHARBOUR__
          #include "xhb.ch"
       #endif
       to every .prg file they use.

   + contrib/xhb/make_b32.bat
   + contrib/xhb/make_vc.bat
   + contrib/xhb/makefile.bc
   + contrib/xhb/makefile.vc
     + Added non-GNU makefiles for xhb lib.

   * include/hbcompat.ch
     + Added xhb compatibility translates for ENDSWITCH end friends.

   * source/rtl/scrollbr.prg
     * Minor formatting.
--
Brgds,
Viktor

From teo at windtelsoft.com  Tue Sep 25 00:09:13 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Tue Sep 25 00:09:21 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20070925012014.GA7796@localhost.localdomain>
References: <20070925012014.GA7796@localhost.localdomain>
Message-ID: <200709242309.13576.teo@windtelsoft.com>

On Monday 24 September 2007 08:20:15 pm Przemyslaw Czerpak wrote:
> 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/include/hbset.h

[snip]

The following sample shows a wrong DbStruct array:

<prg>
FUNCTION Main
  LOCAL a
  LOCAL b
  LOCAL f,e

  a := { { "FIELD1", "C", 10, 0 } }

  DBCreate( "test", a  )

  USE test

  b := DBStruct()

  FOR EACH f IN b
    FOR EACH e IN f
      ? e
    NEXT
    ?
  NEXT

RETURN NIL
</prg>

best regards

Teo
From druzus at priv.onet.pl  Tue Sep 25 07:11:53 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 25 07:12:00 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <200709242309.13576.teo@windtelsoft.com>
References: <20070925012014.GA7796@localhost.localdomain>
	<200709242309.13576.teo@windtelsoft.com>
Message-ID: <20070925111153.GA30269@localhost.localdomain>

On Mon, 24 Sep 2007, Teo Fonrouge wrote:
> On Monday 24 September 2007 08:20:15 pm Przemyslaw Czerpak wrote:
> > 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
> >   * harbour/include/hbset.h
> [snip]
> The following sample shows a wrong DbStruct array:
> <prg>
[...]

Thanks for the information. Fixed:

    2007-09-25 13:10 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
      * harbour/source/rdd/wafunc.c
        ! fixed typo which broke array returned by dbStrunct()

best regards,
Przemek
From teo at windtelsoft.com  Tue Sep 25 10:44:51 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Tue Sep 25 10:49:16 2007
Subject: [Harbour] CHANGELOG: 2007-09-25 04:30 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <01c7ff1d$Blat.v2.6.2$da564f94$15e8ecd1ded0@127.0.0.1>
References: <01c7ff1d$Blat.v2.6.2$da564f94$15e8ecd1ded0@127.0.0.1>
Message-ID: <200709250944.52213.teo@windtelsoft.com>

On Monday 24 September 2007 09:43:28 pm Szak?ts Viktor wrote:
> 2007-09-25 04:30 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>    * contrib/xhb/Makefile
>    * contrib/xhb/xhbfunc.c
>    + contrib/xhb/xhb.ch
>    + contrib/xhb/xhbcomp.prg
>      + Added xhb_AScan(), xhb_AIns(), xhb_ADel() plus defines
>        to redirect extended AScan(), AIns(), ADel() calls to these
>        functions. They need to be tested as I'm no xhb user.
>      + Added compatibility header, which adds a the above translations
>        and include hbcompat.ch.
>      + Added INIT PROC xhb_Init() as a future place for xhb specific
>        startup settings.
>      ; TODO:
>        - Add $ and [] operator overloading.
>        - Add operator overloading for hash type.

2007-09-25 00:55 UTC-0500 Teo Fonrouge (teo/at/windtelsoft/dot/com)
  * contrib/xhb/xhbcomp.prg
    + added "[]" operator overloading for the HBCharacter type class:
      <string>[n] : access
      assign is not implemented ( <string>[n] := <char> )
      negative index is not implemented ( <string>[-n] )

    + added "$" operator overloading for the following type classes:
      HBCharacter : <char> $ <array|hash>
      HBDate      : <date> $ <array|hash>
      HBLogical   : <logical> $ <array|hash>
      HBNil       : <nil> $ <array|hash>
      HBNumeric   : <numeric> $ <array|hash>

    ; all the new extended types, has a ::ClassName with the "HB" prefix.


[snip]

best regards

Teo
From miguelangel at marchuet.net  Tue Sep 25 10:40:37 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Tue Sep 25 10:51:38 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20070925012014.GA7796@localhost.localdomain>
References: <20070925012014.GA7796@localhost.localdomain>
Message-ID: <46F91DE5.2070709@marchuet.net>

Sorry Przemyslaw, but in VFP

          case 'T':
             pFieldInfo.uiType = HB_FT_TIME;
             pFieldInfo.uiLen = 4;
             break;

is

          case 'T':
             pFieldInfo.uiType = HB_FT_DATETIME; // HB_FT_MODTIME
             pFieldInfo.uiLen = 8;
             break;

When datetime will be supported by harbour, what about backward compatibilitie ?

Best regards,
Miguel Angel Marchuet



From harbour.01 at syenar.hu  Tue Sep 25 12:52:20 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 25 12:52:30 2007
Subject: [Harbour] CHANGELOG: 2007-09-25 18:51 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7ff94$Blat.v2.6.2$705084da$d4c240a4034@127.0.0.1>

2007-09-25 18:51 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * include/hbcompat.ch
   * source/vm/arrayshb.c
   * contrib/xhb/xhb.ch
   * contrib/xhb/xhbfunc.c
     + Added HB_ASCAN() to Harbour, which does the same as 
       the plain AScan() in xhb. I decided to do this 
       because we already had hb_RAscan() implemented, and 
       having hb_Ascan() is good to keep symetry.
     * Modified xhb lib to use the Harbour one.
     * Translations moved to hbcompat.ch.
     - Removed HB_COMPAT_XHB from Harbour level array functions.
--
Brgds,
Viktor

From druzus at priv.onet.pl  Tue Sep 25 13:16:12 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 25 13:16:21 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <46F91DE5.2070709@marchuet.net>
References: <20070925012014.GA7796@localhost.localdomain>
	<46F91DE5.2070709@marchuet.net>
Message-ID: <20070925171612.GA3709@localhost.localdomain>

On Tue, 25 Sep 2007, Miguel Angel Marchuet wrote:
> Sorry Przemyslaw, but in VFP
>          case 'T':
>             pFieldInfo.uiType = HB_FT_TIME;
>             pFieldInfo.uiLen = 4;
>             break;
> is
>          case 'T':
>             pFieldInfo.uiType = HB_FT_DATETIME; // HB_FT_MODTIME
>             pFieldInfo.uiLen = 8;
>             break;

Probably this in not the only one name conflict.
Simply different languages uses the same letter to describe
different fields. F.e.: "B" is 'double' in VFP and 'binary memo'
in DBASE. We have to chose sth for .prg level.
In low level .c code when the DBF header signature is set to 0x30
or 0x31 (VFP file) we should simply translate 'T' to '@'. That's all.
I think also that when user set table type to VFP:
    rddInfo( RDDI_TABLETYPE, DB_DBF_VFP )
then we should forbid using extended types not supported by VFP.
Now Harbour DBF* RDDs support many different field types but VFP
only few of them so it will not be able to open DBFs with all
supported by Harbour fields.

> When datetime will be supported by harbour, what about backward
> compatibilitie ?

Sorry but I do not understand what backward compatibility you are
talking about and what is the relation to above field signature.
I'll add support for DAYTIME items to Harbour VM but the internal
HVM implementation does not interacts with the storage format used
in different database tables.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Sep 25 13:20:07 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 25 13:20:24 2007
Subject: [Harbour] CHANGELOG: 2007-09-25 19:15 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c7ff98$Blat.v2.6.2$51c662ba$ad88a0278cc@127.0.0.1>

2007-09-25 19:15 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * contrib/xhb/xhbcomp.prg
     + Added "string as array" implementation. I didn't test 
       it for 100% compatibility, but the base is there.
       One problem though that Harbour won't allow an zero 
       or negative index even with the -ks switch. (I find 
       the error useful though, so we should keep it, but allow 
       it with a switch -ks?)
--
Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Tue Sep 25 13:47:35 2007
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Sep 25 13:47:42 2007
Subject: [Harbour] CHANGELOG: 2007-09-25 18:51 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <01c7ff94$Blat.v2.6.2$705084da$d4c240a4034@127.0.0.1>
References: <01c7ff94$Blat.v2.6.2$705084da$d4c240a4034@127.0.0.1>
Message-ID: <9257026e0709251047j5ffb24f5g54a52aa3b1e8c634@mail.gmail.com>

On 9/25/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

>      - Removed HB_COMPAT_XHB from Harbour level array functions.

Please remember I rely on HB_COMPAT_XHB for my production apps.

I'm a little be scared :)

best regards,
Lorenzo
From harbour.01 at syenar.hu  Tue Sep 25 14:15:11 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 25 14:15:21 2007
Subject: [Harbour] CHANGELOG: 2007-09-25 18:51 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <9257026e0709251047j5ffb24f5g54a52aa3b1e8c634@mail.gmail.com>
References: <01c7ff94$Blat.v2.6.2$705084da$d4c240a4034@127.0.0.1>
	<9257026e0709251047j5ffb24f5g54a52aa3b1e8c634@mail.gmail.com>
Message-ID: <33292808-DFA2-40BE-AA82-5ADFCA0EB013@syenar.hu>

Hi Lorenzo,

There is not many HB_COMPAT_XHB left now.

The goal is to keep all existing features (meaning
HB_COMPAT_XHB ones), but as a dynamic rather than
an build-time option.

Pls try to change using the new xhb lib. Your
reports are welcome.

Brgds,
Viktor

On 2007.09.25., at 19:47, Lorenzo Fiorini wrote:

> On 9/25/07, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
>
>>      - Removed HB_COMPAT_XHB from Harbour level array functions.
>
> Please remember I rely on HB_COMPAT_XHB for my production apps.
>
> I'm a little be scared :)
>
> best regards,
> Lorenzo

From harbour.01 at syenar.hu  Tue Sep 25 14:39:46 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 25 14:40:20 2007
Subject: [Harbour] :__enumIndex() revisited
Message-ID: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>

Hi all,

I'd like to revisit the question of :__enumIndex().

IMO the name is wrong and suggests something internal
to be avoided by developers (*), which is strange for
a (core) _statement_ of the language.

So, may I propose to change these :__enum*() methods names to:
:hb_enum*()

So that :__enumIndex() becomes :hb_enumIndex()

This is something to be done before a final release
because later on it's much harder to change such thing.

This is also better in line with xhb, which actually
got the name right in this case.

Brgds,
Viktor

(*) As a convention in Harbour, just like in Clipper,
every identifier starting with an underscore or double
underscore are considered "internal" features, which
can be changed anytime in later versions, and developers
are generally discouraged to use anything in the core
language with these, just like declaring and using such
identifiers in app code.

From miguelangel at marchuet.net  Tue Sep 25 15:40:20 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Tue Sep 25 15:43:21 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw
	Czerpak(druzus/at/priv.onet.pl)
References: <20070925012014.GA7796@localhost.localdomain><46F91DE5.2070709@marchuet.net>
	<20070925171612.GA3709@localhost.localdomain>
Message-ID: <010a01c7ffab$e8c93760$d801a8c0@ingachka>

before nothing,
thank you very much by your great work

Exactly, I think that is more correct to use T for DateTime format and @ to
TimeStamp under flag signature
0x30 0x31 for VFP, but there are other signatures that support it.

What signature suports T - 4 as simple Time?

Too we can use T - 8 - 0 as DateTime and T - 4 - 0 as SingleTime and all
signatures will be reader.

But all are DBFCDX rdd, we need a parameter in DbCreate to indicate the
correct signature.

Memo record type signature:
 00h Picture. This normally indicates that file is produced on a MacIntosh,
since pictures on the DOS/Windows platform are "objects".
 01h Memo
 02h Object
 ??h for Blob, Is possible is 02h too ?

Field-level flags:
Bit 1: is this a "system" (hidden) field
Bit 2: is this field nullable
Bit 3: is this field NOCPTRANS and BINARY (have the same meaning and efect)
Bit 4: is this field AUTOINC

But when is AUTOINC always is NOCPTRANS or BINARY

I think DateTime is the more important type, that DBF needs, as VFP DBF.

In the future we needs too, use it as item type. the type Date is a DateTime
with time 00:00. We need compare DateTime with Date easily.
As you know all SQL servers support type DateTime.

The way as is implemented in xharbour is very interesting, But in VFP is a
diferent ValType

ValType( iDateTime ) => 'T' in VFP and 'D' in xHarbour
ValType( iDate ) => 'D' in VFP and 'D' in xHarbour

the convert api in VFP are:
TToC( ... )
TToS( ... )  (commonly used in index over DateTime an TimeStamp)
CToT( ... )
SToT( ... )
... and others

Best regards,
Miguel Angel Marchuet

----- Original Message ----- 
From: "Przemyslaw Czerpak" <druzus@priv.onet.pl>
To: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Sent: Tuesday, September 25, 2007 7:16 PM
Subject: Re: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw
Czerpak(druzus/at/priv.onet.pl)


> On Tue, 25 Sep 2007, Miguel Angel Marchuet wrote:
> > Sorry Przemyslaw, but in VFP
> >          case 'T':
> >             pFieldInfo.uiType = HB_FT_TIME;
> >             pFieldInfo.uiLen = 4;
> >             break;
> > is
> >          case 'T':
> >             pFieldInfo.uiType = HB_FT_DATETIME; // HB_FT_MODTIME
> >             pFieldInfo.uiLen = 8;
> >             break;
>
> Probably this in not the only one name conflict.
> Simply different languages uses the same letter to describe
> different fields. F.e.: "B" is 'double' in VFP and 'binary memo'
> in DBASE. We have to chose sth for .prg level.
> In low level .c code when the DBF header signature is set to 0x30
> or 0x31 (VFP file) we should simply translate 'T' to '@'. That's all.
> I think also that when user set table type to VFP:
>     rddInfo( RDDI_TABLETYPE, DB_DBF_VFP )
> then we should forbid using extended types not supported by VFP.
> Now Harbour DBF* RDDs support many different field types but VFP
> only few of them so it will not be able to open DBFs with all
> supported by Harbour fields.
>
> > When datetime will be supported by harbour, what about backward
> > compatibilitie ?
>
> Sorry but I do not understand what backward compatibility you are
> talking about and what is the relation to above field signature.
> I'll add support for DAYTIME items to Harbour VM but the internal
> HVM implementation does not interacts with the storage format used
> in different database tables.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
> __________ Informaci?n de NOD32, revisi?n 2335 (20070616) __________
>
> Este mensaje ha sido analizado con NOD32 antivirus system
> http://www.nod32.com
>
>

From miguelangel at marchuet.net  Tue Sep 25 15:53:23 2007
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Tue Sep 25 15:57:26 2007
Subject: [Harbour] :__enumIndex() revisited
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
Message-ID: <012801c7ffad$bba00500$d801a8c0@ingachka>

Instead of message, can be implemented too
an HB_QWith( nWith ) function to send this message
and retrieve the wanted Object

Example:

WITH OBJECT A

    WITH OBJECT B
        HB_QWITH( 0 ) // RETURNS OBJECT B
        HB_QWITH( 1 ) // RETURNS OBJECT A
        HB_QWITH( 2 ) // RETURNS NILL
    END WITH

    WITH OBJECT C
        HB_QWITH( 0 ) // RETURNS OBJECT C
        HB_QWITH( 1 ) // RETURNS OBJECT A
        HB_QWITH( 2 ) // RETURNS NILL
    END WITH

    HB_QWITH( 0 ) // RETURNS OBJECT A
    HB_QWITH( 1 ) // RETURNS NILL

END WITH

Why reinvent the wheel? , if some programmers of [x]harbour already know the
HB_QWith() pseudo-function.

Best regards,
Miguel Angel marchuet


----- Original Message ----- 
From: "Szak?ts Viktor" <harbour.01@syenar.hu>
To: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Sent: Tuesday, September 25, 2007 8:39 PM
Subject: [Harbour] :__enumIndex() revisited


> Hi all,
>
> I'd like to revisit the question of :__enumIndex().
>
> IMO the name is wrong and suggests something internal
> to be avoided by developers (*), which is strange for
> a (core) _statement_ of the language.
>
> So, may I propose to change these :__enum*() methods names to:
> :hb_enum*()
>
> So that :__enumIndex() becomes :hb_enumIndex()
>
> This is something to be done before a final release
> because later on it's much harder to change such thing.
>
> This is also better in line with xhb, which actually
> got the name right in this case.
>
> Brgds,
> Viktor
>
> (*) As a convention in Harbour, just like in Clipper,
> every identifier starting with an underscore or double
> underscore are considered "internal" features, which
> can be changed anytime in later versions, and developers
> are generally discouraged to use anything in the core
> language with these, just like declaring and using such
> identifiers in app code.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
> __________ Informaci?n de NOD32, revisi?n 2335 (20070616) __________
>
> Este mensaje ha sido analizado con NOD32 antivirus system
> http://www.nod32.com
>
>

From harbour.01 at syenar.hu  Tue Sep 25 18:47:20 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 25 18:47:29 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <012801c7ffad$bba00500$d801a8c0@ingachka>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<012801c7ffad$bba00500$d801a8c0@ingachka>
Message-ID: <94D8772B-1496-4648-9992-6B533098897A@syenar.hu>

Hi Miguel,

> Instead of message, can be implemented too
> an HB_QWith( nWith ) function to send this message
> and retrieve the wanted Object
>
> Example:
>
> WITH OBJECT A
>
>     WITH OBJECT B
>         HB_QWITH( 0 ) // RETURNS OBJECT B
>         HB_QWITH( 1 ) // RETURNS OBJECT A
>         HB_QWITH( 2 ) // RETURNS NILL
>     END WITH
>
>     WITH OBJECT C
>         HB_QWITH( 0 ) // RETURNS OBJECT C
>         HB_QWITH( 1 ) // RETURNS OBJECT A
>         HB_QWITH( 2 ) // RETURNS NILL
>     END WITH
>
>     HB_QWITH( 0 ) // RETURNS OBJECT A
>     HB_QWITH( 1 ) // RETURNS NILL
>
> END WITH
>
> Why reinvent the wheel? , if some programmers of [x]harbour already  
> know the
> HB_QWith() pseudo-function.

Sorry, but this looks fuzzy to me, and this feature
was not implemented in Harbour, so probably not many
folks are aware of it. This solution has the disadvantage
that you have to count nesting levels to know what
number to use, moreover the real object name is fully
hidden in the source, so you cannot find it with a
"grep" command for example (or a simple text search),
well, you cannot even see it. Not to mention when
you miscount the number and get unexpected results,
which are difficult to spot.

I find our current solution very elegant actually,
except the name of the methods, which look if they
were internal messages, which they are not, they
are Harbour defined "official" messages. So, nothing
fundamental should be changed I think, just the names.

(Old/Current names can probably be made supported by
some PP rules)

Brgds,
Viktor


>
> Best regards,
> Miguel Angel marchuet
>
>
> ----- Original Message -----
> From: "Szak?ts Viktor" <harbour.01@syenar.hu>
> To: "Harbour Project Main Developer List." <harbour@harbour- 
> project.org>
> Sent: Tuesday, September 25, 2007 8:39 PM
> Subject: [Harbour] :__enumIndex() revisited
>
>
>> Hi all,
>>
>> I'd like to revisit the question of :__enumIndex().
>>
>> IMO the name is wrong and suggests something internal
>> to be avoided by developers (*), which is strange for
>> a (core) _statement_ of the language.
>>
>> So, may I propose to change these :__enum*() methods names to:
>> :hb_enum*()
>>
>> So that :__enumIndex() becomes :hb_enumIndex()
>>
>> This is something to be done before a final release
>> because later on it's much harder to change such thing.
>>
>> This is also better in line with xhb, which actually
>> got the name right in this case.
>>
>> Brgds,
>> Viktor
>>
>> (*) As a convention in Harbour, just like in Clipper,
>> every identifier starting with an underscore or double
>> underscore are considered "internal" features, which
>> can be changed anytime in later versions, and developers
>> are generally discouraged to use anything in the core
>> language with these, just like declaring and using such
>> identifiers in app code.
>>
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>> __________ Informaci?n de NOD32, revisi?n 2335 (20070616) __________
>>
>> Este mensaje ha sido analizado con NOD32 antivirus system
>> http://www.nod32.com
>>
>>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Tue Sep 25 19:07:47 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Sep 25 19:07:55 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <012801c7ffad$bba00500$d801a8c0@ingachka>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<012801c7ffad$bba00500$d801a8c0@ingachka>
Message-ID: <C6F7A583-0BA7-45FE-8517-4AD268E74595@syenar.hu>

Oops we (I definitely) seem to have been mixing DO WITH
with FOR EACH. To clarify, I was talking about FOR EACH
in my initial mail, since this is the only place where we
have __enumIndex().

As for DO WITH, I'd definitiely check some other
languages, how they solved the problem first (but I'll
leave this for some other time).

Brgds,
Viktor


On 2007.09.25., at 21:53, Miguel Angel Marchuet wrote:

> Instead of message, can be implemented too
> an HB_QWith( nWith ) function to send this message
> and retrieve the wanted Object
>
> Example:
>
> WITH OBJECT A
>
>     WITH OBJECT B
>         HB_QWITH( 0 ) // RETURNS OBJECT B
>         HB_QWITH( 1 ) // RETURNS OBJECT A
>         HB_QWITH( 2 ) // RETURNS NILL
>     END WITH
>
>     WITH OBJECT C
>         HB_QWITH( 0 ) // RETURNS OBJECT C
>         HB_QWITH( 1 ) // RETURNS OBJECT A
>         HB_QWITH( 2 ) // RETURNS NILL
>     END WITH
>
>     HB_QWITH( 0 ) // RETURNS OBJECT A
>     HB_QWITH( 1 ) // RETURNS NILL
>
> END WITH
>
> Why reinvent the wheel? , if some programmers of [x]harbour already  
> know the
> HB_QWith() pseudo-function.
>
> Best regards,
> Miguel Angel marchuet
>
>
> ----- Original Message -----
> From: "Szak?ts Viktor" <harbour.01@syenar.hu>
> To: "Harbour Project Main Developer List." <harbour@harbour- 
> project.org>
> Sent: Tuesday, September 25, 2007 8:39 PM
> Subject: [Harbour] :__enumIndex() revisited
>
>
>> Hi all,
>>
>> I'd like to revisit the question of :__enumIndex().
>>
>> IMO the name is wrong and suggests something internal
>> to be avoided by developers (*), which is strange for
>> a (core) _statement_ of the language.
>>
>> So, may I propose to change these :__enum*() methods names to:
>> :hb_enum*()
>>
>> So that :__enumIndex() becomes :hb_enumIndex()
>>
>> This is something to be done before a final release
>> because later on it's much harder to change such thing.
>>
>> This is also better in line with xhb, which actually
>> got the name right in this case.
>>
>> Brgds,
>> Viktor
>>
>> (*) As a convention in Harbour, just like in Clipper,
>> every identifier starting with an underscore or double
>> underscore are considered "internal" features, which
>> can be changed anytime in later versions, and developers
>> are generally discouraged to use anything in the core
>> language with these, just like declaring and using such
>> identifiers in app code.
>>
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>> __________ Informaci?n de NOD32, revisi?n 2335 (20070616) __________
>>
>> Este mensaje ha sido analizado con NOD32 antivirus system
>> http://www.nod32.com
>>
>>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Tue Sep 25 20:33:50 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 25 20:33:56 2007
Subject: [Harbour] ChangeLog 2007-09-26 02:30 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070926003350.GA18324@localhost.localdomain>

2007-09-26 02:30 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbclass.ch
    + added:
         ON ERROR FUNCTION <FuncName>
         OPERATOR <op> FUNCTION <FuncName> <scope>

  * harbour/include/hbapicls.h
  * harbour/source/vm/classes.c
  * harbour/source/vm/hvm.c
    + added support for overloading right side $ operator

  * harbour/contrib/xhb/xhbfunc.c
    * rewritten xhb_ains() and xhb_adel() in C

  * harbour/contrib/xhb/xhb.ch
    * changed AINS() conversion to be xHarbour compatible

  * harbour/contrib/xhb/Makefile
    + added xhb.ch to PRG_HEADERS so it's installed automatically
      during 'make install'

  * harbour/contrib/xhb/Makefile
  + harbour/contrib/xhb/xhbmsgs.c
  * harbour/contrib/xhb/xhbcomp.prg
    + added support for $ operator used with hashes and arrays
      on right side working _exactly_ like in xHarbour.
    + added support for negative indexes in used in [] operator
      for array and strings.
      Please remember that standard harbour build (without
      HB_COMPAT_XHB flag) generate warning for negative indexes,
      if you wan to pacify them then instead of var[-1] use var[(-1)]
    + added support for assign string characters with [] index.
      Please remember that for standard harbour build (without
      HB_COMPAT_XHB flag) you have to use -ks compile time switch
      if you want to assign strings in such way because this feature
      needs different PCODE, f.e. try to compile this code:
         proc main()
            local s:="ABC"
            s[(-1)] := "*"
            ? s
         return
      with and without -ks switch
    + added support for accessing hash items using OO interface, f.e.:
         proc main()
            local h:={"ABC"=>123.45,"XYZ"=>567.89}
            ? h["ABC"], h["XYZ"]
            ? h:ABC, h:XYZ
            h:ABC+=1000
            h:XYZ:=-2000
            ? h:ABC, h:XYZ
         return

      All of the above extensions are written in C code so the speed
      overhead is very small. Harbour evaluates PCODE faster then xHarbour
      so in speed tests where above operators are executed in loop without
      any other code the xHarbour results with native support are comparable
      with Harbour ones where above operators are overloaded using scalar
      classes so in normal code you should not find any difference with
      one exception for assigning characters in very long strings.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep 25 21:01:17 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 25 21:01:26 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
Message-ID: <20070926010117.GB18324@localhost.localdomain>

On Tue, 25 Sep 2007, Szak?ts Viktor wrote:
> Hi all,
> I'd like to revisit the question of :__enumIndex().
> IMO the name is wrong and suggests something internal
> to be avoided by developers (*), which is strange for
> a (core) _statement_ of the language.
> So, may I propose to change these :__enum*() methods names to:
> :hb_enum*()
> So that :__enumIndex() becomes :hb_enumIndex()

I do not see anything wrong in __enum*() messages.
My personal opinion is to leave them as they are now.
These are not function names so here we do not have potential
global name conflict and "__" is very good choice for me due
to already defined special meaning for messages with "_" prefix.
If we replace it by "hb_" then probably we should also
remove compiler warnings about sending enumerator messages
to non enumerator variables, f.e.:
    proc main()
        local o
        ? o:__enumIndex()
        ? (o):__enumIndex()
    return

That's my opinion but :__enum*() messages is Ryszard choice
so it will be good the hear also his opinion.

Please also remember what Lorenzo said. For people who do not
know Clipper our name space is very strange. They simply do
not understand why some functions have "hb_" prefix and why
some other don't. But for functions it can be very easy
resolved by adding simple wrappers with alternative names.
For messages it cannot be done such easy so if we begin to
force "hb_" prefix also in messages then IMHO we only create
bigger problem for most of users.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep 25 21:30:45 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 25 21:30:51 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <012801c7ffad$bba00500$d801a8c0@ingachka>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<012801c7ffad$bba00500$d801a8c0@ingachka>
Message-ID: <20070926013045.GC18324@localhost.localdomain>

On Tue, 25 Sep 2007, Miguel Angel Marchuet wrote:
> Instead of message, can be implemented too
> an HB_QWith( nWith ) function to send this message
> and retrieve the wanted Object
> Example:
> WITH OBJECT A
[...]

__ENUM*() messages are used in FOR EACH statement not in WITH OBJECT.
Inside WITH OBJECT Harbour support special message :__withObject()
which allow to retrieve or change current WITH OBJECT object, f.e.:

    proc main()
       WITH OBJECT errorNew()
          ? :className
          ? valtype(:__withObject)
          ? :__withObject:className
          ?
          :__withObject := getNew()
          ? :className
          ? valtype(:__withObject)
          ? :__withObject:className
       ENDWITH
    return

and if necessary then programmer can overload this method.

Of course we can add to Harbour support for HB_QWITH( [<nLevel>] )
into XHB library (AFAIR xHarbour does not support <nLevel> parameter)
and also for HB_RESETWITH() and HB_WITHOBJECTCOUNTER(). It's possible
to also implement HB_SETWITH() though this function cannot be easy
implemented without touching compiler code because it directly
allocates/remove items on HVM stack. Anyhow it's potentially
very dangerous functions which allow to make some very bad things
in xHarbour so I do not think it's good idea to add it.

best regards,
Przemek
From druzus at priv.onet.pl  Tue Sep 25 23:01:01 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Tue Sep 25 23:01:06 2007
Subject: [Harbour] ChangeLog 2007-09-26 05:00 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20070926030101.GA24337@localhost.localdomain>

2007-09-26 05:00 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/contrib/xhb/Makefile
  + harbour/contrib/xhb/xhbwith.c
    + added HB_QWith( [<nLevel>] ), HB_QWithObjectCounter(),  HB_QResetWith()

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Sep 26 03:51:13 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 26 03:51:21 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <20070926010117.GB18324@localhost.localdomain>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<20070926010117.GB18324@localhost.localdomain>
Message-ID: <6B4134D3-E721-467A-B7F9-063723417E56@syenar.hu>

Hi Przemek,

> I do not see anything wrong in __enum*() messages.
> My personal opinion is to leave them as they are now.
> These are not function names so here we do not have potential
> global name conflict and "__" is very good choice for me due
> to already defined special meaning for messages with "_" prefix.

Special meaning of "_" has not much to do with documented
interface. It is just an internal representation used to
differenciate between "set"s and "get"s. AFAIU.

> If we replace it by "hb_" then probably we should also
> remove compiler warnings about sending enumerator messages
> to non enumerator variables, f.e.:
>     proc main()
>         local o
>         ? o:__enumIndex()
>         ? (o):__enumIndex()
>     return

I think it's just a matter of which name is "burned into"
the compiler for this check.

> That's my opinion but :__enum*() messages is Ryszard choice
> so it will be good the hear also his opinion.

Definitely.

> Please also remember what Lorenzo said. For people who do not
> know Clipper our name space is very strange. They simply do
> not understand why some functions have "hb_" prefix and why
> some other don't. But for functions it can be very easy

Strange what you say, because the logic looks pretty clear
(to me at least).

- First we have everything which is compatibility function,
with Clipper, undocumented Clipper, xBase++, etc: in these
cases we use the original names (with "__", "_" or whatever
the original one used).

- Second we have our own function names beginning with "__",
these are internal functions which are not "official" or
documented. They function is to support Harbour core itself,
and not app code. Good example: __dbg*()

- Third we have the "hb_" prefix which is used in all
documented extensions. (This hb prefix is "hb" for class
names, which is indeed a violation.)

Might be that we violate these rules in some cases, but
generally I think this is followed quite consistently.
(and if not, we can still fix it).

> resolved by adding simple wrappers with alternative names.
> For messages it cannot be done such easy so if we begin to
> force "hb_" prefix also in messages then IMHO we only create
> bigger problem for most of users.

That's the reason we should sort this out it before a final
release. But notice that we're not xhb compatible, so there
is already a confusion in this area, and most code is pbly
not compatible with the current solution anyway.

We can leave the old name there for compatibility, if
that's a concern (which might well be).

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Sep 26 03:53:42 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 26 03:53:50 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <20070926013045.GC18324@localhost.localdomain>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<012801c7ffad$bba00500$d801a8c0@ingachka>
	<20070926013045.GC18324@localhost.localdomain>
Message-ID: <6586C8D2-6EDC-4CEF-BDF7-F0C6802E4609@syenar.hu>

> __ENUM*() messages are used in FOR EACH statement not in WITH OBJECT.
> Inside WITH OBJECT Harbour support special message :__withObject()
> which allow to retrieve or change current WITH OBJECT object, f.e.:

Thanks for the info Przemek.

I'd add :__withObject() to the list which should
rather have :hb_withObject() to stay consistent in names.

>
>     proc main()
>        WITH OBJECT errorNew()
>           ? :className
>           ? valtype(:__withObject)
>           ? :__withObject:className
>           ?
>           :__withObject := getNew()
>           ? :className
>           ? valtype(:__withObject)
>           ? :__withObject:className
>        ENDWITH
>     return
>
> and if necessary then programmer can overload this method.
>
> Of course we can add to Harbour support for HB_QWITH( [<nLevel>] )
> into XHB library (AFAIR xHarbour does not support <nLevel> parameter)
> and also for HB_RESETWITH() and HB_WITHOBJECTCOUNTER(). It's possible
> to also implement HB_SETWITH() though this function cannot be easy
> implemented without touching compiler code because it directly
> allocates/remove items on HVM stack. Anyhow it's potentially
> very dangerous functions which allow to make some very bad things
> in xHarbour so I do not think it's good idea to add it.

Please don't, these extensions don't look very good.

Brgds,
Viktor

From antonioharbour at gmail.com  Wed Sep 26 04:41:02 2007
From: antonioharbour at gmail.com (Antonio Linares)
Date: Wed Sep 26 04:41:07 2007
Subject: [Harbour] INDEX ON ... CUSTOM question (Przemek)
Message-ID: <9471afc80709260141o6a465112n6d58ab52ad302620@mail.gmail.com>

I create an index this way:

   INDEX ON Field->Last TAG "North"  CUSTOM
If later on I want to add a record to this custom index, should I do ?

OrdKeyAdd()   // It returns .F.

OrdKeyAdd( , RecNo() ) // It returns .F.

OrdKeyAdd( , Field->Last ) // It returns .F.

How to do it ? Thanks,

regards,

Antonio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20070926/89eb1c5c/attachment-0001.html
From soporte at dsgsoftware.com  Wed Sep 26 05:22:53 2007
From: soporte at dsgsoftware.com (=?iso-8859-1?Q?Juan_G=E1lvez?=)
Date: Wed Sep 26 05:24:50 2007
Subject: [Harbour] INDEX ON ... CUSTOM question (Przemek)
References: <9471afc80709260141o6a465112n6d58ab52ad302620@mail.gmail.com>
Message-ID: <005f01c8001e$d7842640$1700000a@PcJuanxp>

Antonio,

Perhaps "North" isn't the current tag and you should add this tag name as first argument of OrdKeyAdd().

Best regards
Juan
  ----- Original Message ----- 
  From: Antonio Linares 
  To: harbour@harbour-project.org 
  Sent: Wednesday, September 26, 2007 10:41 AM
  Subject: [Harbour] INDEX ON ... CUSTOM question (Przemek)


  I create an index this way:

     INDEX ON Field->Last TAG "North"  CUSTOM

  If later on I want to add a record to this custom index, should I do ?

  OrdKeyAdd()   // It returns .F.

  OrdKeyAdd( , RecNo() ) // It returns .F.

  OrdKeyAdd( , Field->Last ) // It returns .F.

  How to do it ? Thanks,

  regards,

  Antonio


------------------------------------------------------------------------------


  _______________________________________________
  Harbour mailing list
  Harbour@harbour-project.org
  http://lists.harbour-project.org/mailman/listinfo/harbour
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20070926/117d96af/attachment.html
From antonioharbour at gmail.com  Wed Sep 26 05:33:34 2007
From: antonioharbour at gmail.com (Antonio Linares)
Date: Wed Sep 26 05:33:39 2007
Subject: [Harbour] INDEX ON ... CUSTOM question (Przemek)
In-Reply-To: <005f01c8001e$d7842640$1700000a@PcJuanxp>
References: <9471afc80709260141o6a465112n6d58ab52ad302620@mail.gmail.com>
	<005f01c8001e$d7842640$1700000a@PcJuanxp>
Message-ID: <9471afc80709260233h2051bea4pb3dc15a63fb3d897@mail.gmail.com>

Juan,

>
Perhaps "North" isn't the current tag and you should add this tag name
as first argument of OrdKeyAdd().
>

"North" is the selected tag name, I have checked it using OrdName()
and returns "North".

I wonder how to properly use OrdKeyAdd(). Thanks for your help,

Regards,

Antonio
From druzus at priv.onet.pl  Wed Sep 26 06:31:09 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 26 06:31:17 2007
Subject: [Harbour] INDEX ON ... CUSTOM question (Przemek)
In-Reply-To: <9471afc80709260141o6a465112n6d58ab52ad302620@mail.gmail.com>
References: <9471afc80709260141o6a465112n6d58ab52ad302620@mail.gmail.com>
Message-ID: <20070926103109.GA488@localhost.localdomain>

On Wed, 26 Sep 2007, Antonio Linares wrote:
> I create an index this way:
>    INDEX ON Field->Last TAG "North"  CUSTOM
> If later on I want to add a record to this custom index, should I do ?
> OrdKeyAdd()   // It returns .F.
> OrdKeyAdd( , RecNo() ) // It returns .F.
> OrdKeyAdd( , Field->Last ) // It returns .F.
> How to do it ? Thanks,

If you need answer then please create self contain as small as
possible example which illustrates the problem.
Then please test it in CL53. If you will have the same results
as with Harbour then in 99% answer is in CL53 documentation.
If you still will have some doubts then send this example here
and I or someone else will tell you what happens.
Without such self contain example question like above are usually
waste of your and our time time because such behavior may be caused
by many different things so is correct and we can only guess what
you made. Usually starting from writing such example ourself.
Nearly each time I'm answering for such questions I'm asking about
examples. Please remember about it in the future. Below is such
example which probably give you an answer for your question but
please understand that I do not have time to create such examples
for everybody who makes some typos in his code or do not want to
invest few minutes in reading Clipper documentation. If it won't
help you then in next message please attach the example which
illustrates the problem which can be compiled by CL53 and Harbour
so I can verify it at beginning.

best regards,
Przemek

    #include "ord.ch"
    request DBFCDX
    proc main()
    rddSetDefault("DBFCDX")
    dbCreate("_tst",{{"F1","N",10,3}})
    use _tst
    index on FIELD->F1 tag T1 custom
    ? ordKeyAdd(), ordKeyCount()
    dbAppend()
    ? ordKeyAdd(), ordKeyCount()
    return
From druzus at priv.onet.pl  Wed Sep 26 07:27:36 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 26 07:27:54 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <6586C8D2-6EDC-4CEF-BDF7-F0C6802E4609@syenar.hu>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<012801c7ffad$bba00500$d801a8c0@ingachka>
	<20070926013045.GC18324@localhost.localdomain>
	<6586C8D2-6EDC-4CEF-BDF7-F0C6802E4609@syenar.hu>
Message-ID: <20070926112736.GA1095@localhost.localdomain>

On Wed, 26 Sep 2007, Szak?ts Viktor wrote:
> >Of course we can add to Harbour support for HB_QWITH( [<nLevel>] )
> >into XHB library (AFAIR xHarbour does not support <nLevel> parameter)
> >and also for HB_RESETWITH() and HB_WITHOBJECTCOUNTER(). It's possible
> >to also implement HB_SETWITH() though this function cannot be easy
> >implemented without touching compiler code because it directly
> >allocates/remove items on HVM stack. Anyhow it's potentially
> >very dangerous functions which allow to make some very bad things
> >in xHarbour so I do not think it's good idea to add it.
> Please don't, these extensions don't look very good.

Ups. too late I've already added to XHB library HB_QWITH( [<nLevel>] ),
HB_RESETWITH() and HB_WITHOBJECTCOUNTER() and committed. In summary
if XHB should be xHarbour compatible layer then why not. I've seen
that Miguel is porting to xHarbour unlimited FOR EACH and WITH OBJECT
so I think it may help him too.

I haven't added HB_SETWITH() because as I said it was not normal function,
and without touching compiler code it couldn't be easy implemented.
It's possible but it will be necessary to make some direct modifications
in HVM stack to change some offsets and move few items. Support for
HB_SETWITH() in compiler is trivial and will not take more then few
lines but for sure I do not want to have such function in core code.
xHarbour uses HB_SETWITH() in few places as storage stack for temporary
variables so in most case code which uses it can be updated to use
some functions like: HB_PUSH(), HB_POP(), HB_TOP() which will use
internally some stack hold in array inside static variable.

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Sep 26 08:10:52 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Sep 26 08:11:02 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <20070926112736.GA1095@localhost.localdomain>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<012801c7ffad$bba00500$d801a8c0@ingachka>
	<20070926013045.GC18324@localhost.localdomain>
	<6586C8D2-6EDC-4CEF-BDF7-F0C6802E4609@syenar.hu>
	<20070926112736.GA1095@localhost.localdomain>
Message-ID: <121A9573-4ECE-405D-A8EC-DF9A259B6539@syenar.hu>

Hi Przemek,

On 2007.09.26., at 13:27, Przemyslaw Czerpak wrote:

> On Wed, 26 Sep 2007, Szak?ts Viktor wrote:
>>> Of course we can add to Harbour support for HB_QWITH( [<nLevel>] )
>>> into XHB library (AFAIR xHarbour does not support <nLevel>  
>>> parameter)
>>> and also for HB_RESETWITH() and HB_WITHOBJECTCOUNTER(). It's  
>>> possible
>>> to also implement HB_SETWITH() though this function cannot be easy
>>> implemented without touching compiler code because it directly
>>> allocates/remove items on HVM stack. Anyhow it's potentially
>>> very dangerous functions which allow to make some very bad things
>>> in xHarbour so I do not think it's good idea to add it.
>> Please don't, these extensions don't look very good.
>
> Ups. too late I've already added to XHB library HB_QWITH 
> ( [<nLevel>] ),
> HB_RESETWITH() and HB_WITHOBJECTCOUNTER() and committed. In summary
> if XHB should be xHarbour compatible layer then why not. I've seen
> that Miguel is porting to xHarbour unlimited FOR EACH and WITH OBJECT
> so I think it may help him too.

No problem at all, this is exactly why we have xhb lib :)
Thanks for the commit.

> I haven't added HB_SETWITH() because as I said it was not normal  
> function,
> and without touching compiler code it couldn't be easy implemented.
> It's possible but it will be necessary to make some direct  
> modifications
> in HVM stack to change some offsets and move few items. Support for
> HB_SETWITH() in compiler is trivial and will not take more then few
> lines but for sure I do not want to have such function in core code.
> xHarbour uses HB_SETWITH() in few places as storage stack for  
> temporary
> variables so in most case code which uses it can be updated to use
> some functions like: HB_PUSH(), HB_POP(), HB_TOP() which will use
> internally some stack hold in array inside static variable.

Okey, I'd vote not to touch Harbour core this time.

Brgds,
Viktor


From antonioharbour at gmail.com  Wed Sep 26 09:08:36 2007
From: antonioharbour at gmail.com (Antonio Linares)
Date: Wed Sep 26 09:09:53 2007
Subject: [Harbour] INDEX ON ... CUSTOM question (Przemek)
In-Reply-To: <20070926103109.GA488@localhost.localdomain>
Message-ID: <46fa5a1b.2871420a.1e11.ffffca19@mx.google.com>

Przemek,

Many thanks for your help. I was testing a complex Windows application and
it was not easy to quickly provide a sample of it, without Windows. Now the
code is ok, I found my own bug.

Regards,

Antonio

From druzus at priv.onet.pl  Wed Sep 26 09:22:59 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Wed Sep 26 09:23:06 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <121A9573-4ECE-405D-A8EC-DF9A259B6539@syenar.hu>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<012801c7ffad$bba00500$d801a8c0@ingachka>
	<20070926013045.GC18324@localhost.localdomain>
	<6586C8D2-6EDC-4CEF-BDF7-F0C6802E4609@syenar.hu>
	<20070926112736.GA1095@localhost.localdomain>
	<121A9573-4ECE-405D-A8EC-DF9A259B6539@syenar.hu>
Message-ID: <20070926132259.GB1095@localhost.localdomain>

On Wed, 26 Sep 2007, Szak?ts Viktor wrote:
> >I haven't added HB_SETWITH() because as I said it was not normal  
> >function,
> >and without touching compiler code it couldn't be easy implemented.
> >It's possible but it will be necessary to make some direct  
> >modifications
> >in HVM stack to change some offsets and move few items. Support for
> >HB_SETWITH() in compiler is trivial and will not take more then few
> >lines but for sure I do not want to have such function in core code.
> >xHarbour uses HB_SETWITH() in few places as storage stack for  
> >temporary
> >variables so in most case code which uses it can be updated to use
> >some functions like: HB_PUSH(), HB_POP(), HB_TOP() which will use
> >internally some stack hold in array inside static variable.
> Okey, I'd vote not to touch Harbour core this time.

Just for test I implemented it without touching compiler code.
Below is the code which can be added to xhbwith.c.
Anyhow hb_setWith() is danger function so people should be very
careful if want to use it. As you can see  that it hacks HVM stack
and because it's not implemented in compiler then we cannot add
protection against using it in wrong places. But as I can see in
xHarbour code then it also does not have any protection though
HB_SETWITH() is implemented as pseudo function inside compiler.
In summary using WITH OBJECT / END statement is much more safe then
    HB_SetWith( xObject )
        [...]
    HB_SetWith()
because grammar rules unintentionally force basic protection and
compiler adds if necessary cleanup code f.e. when EXIT or LOOP is
used inside WITH OBJECT / END statement.
IMHO such constructions like in xHarbour std.ch:

    #command TEXT INTO <lValue> => <lValue> := "" ;;
                                   hb_setwith( {|_1| <lValue> += _1 } );;
                                   text __TextInto, hb_SetWith

should be replaced by:

    #command TEXT INTO <lValue> => <lValue> := "" ;;
                               WITH OBJECT {|_1| <lValue> += _1 };;
                               text __TextInto, END

and hb_setWith() eliminated from the core code but it's information
rather for xHarbour developers.

BTW __TextInto() in xHarbour makes sth like:
    proc __TextInto( cText )
    eval( hb_QWith(), cText )
    return

using current PP:
    TEXT INTO <var>
    ...
    ENDTEXT

can be implemented much more in simpler and more efficient way by:
    #command TEXT INTO <v> => #pragma __text|<v>+=%s;<v>:=""

but in hbcompat.ch we have:
    #xcommand TEXT INTO <v> => #pragma __text|<v>+=%s+HB_OSNEWLINE();<v>:=""

which keeps EOLs in text. What is the expected behavior for this command?

best regards,
Przemek



/*
 * HB_SETWITH()
 */

/* With object auto destructor function */
static HB_GARBAGE_FUNC( hb_withObjectDestructor )
{
   LONG * plWithObjectBase = ( LONG * ) Cargo;
   hb_stackWithObjectSetOffset( * plWithObjectBase );
}

static void hb_vmWithObjectPush( PHB_ITEM pObject )
{
   LONG * plWithObjectBase, lFuncOffset;
   PHB_ITEM pItem;

   HB_TRACE(HB_TR_DEBUG, ("hb_vmWithObjectPush(%p)", pObject));

   lFuncOffset = hb_stackBaseOffset() - 1;

   /* dirty hack: move function symbol */
   hb_itemCopy( hb_stackAllocItem(), hb_stackItem( lFuncOffset ) );

   /* Set WITH OBJECT base value */
   hb_itemCopy( hb_stackItem( lFuncOffset ), pObject );

   /* Create WITH OBJECT auto destructor */
   pItem = hb_stackItem( lFuncOffset + 1 );
   plWithObjectBase = ( LONG * ) hb_gcAlloc( sizeof( LONG ),
                                             hb_withObjectDestructor );
   * plWithObjectBase = hb_stackWithObjectOffset();
   pItem->type = HB_IT_POINTER;
   pItem->item.asPointer.value = plWithObjectBase;
   pItem->item.asPointer.collect = pItem->item.asPointer.single = TRUE;
   hb_stackWithObjectSetOffset( lFuncOffset );

   /* dirty hack: update function base offset */
   hb_stack.pBase += 2;
}

static void hb_vmWithObjectPop( void )
{
   LONG lFuncOffset, lWithOffset;

   HB_TRACE(HB_TR_DEBUG, ("hb_vmWithObjectPop()"));

   lFuncOffset = hb_stackBaseOffset() - 1;
   lWithOffset = hb_stackWithObjectOffset();
   /* Verify if HB_SETWITH() is executed with valid WITH OBJECT on HVM stack */
   if( lWithOffset != lFuncOffset - 2 )
      hb_errRT_BASE( EG_BOUND, 1607, NULL, "HB_SETWITH", 0, NULL );
   else
   {
      /* dirty hack: move function symbol */
      hb_itemMove( hb_stackItem( lWithOffset ), hb_stackItem( lFuncOffset ) );
      /* dirty hack: update function base offset */
      hb_stack.pBase -= 2;
   }
}

HB_FUNC( HB_SETWITH )
{
   PHB_ITEM pItem = hb_vmWithObjectItem( 0 );

   if( hb_pcount() >= 1 )
      hb_vmWithObjectPush( hb_param( 1, HB_IT_ANY ) );
   else
      hb_vmWithObjectPop();
   hb_itemReturn( pItem );
}
From druzus at priv.onet.pl  Thu Sep 27 09:30:21 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 27 09:30:28 2007
Subject: [Harbour] 2007-09-27 15:29 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <200709271330.l8RDULqb001674@31-mo5-4.acn.waw.pl>

2007-09-27 15:29 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/dbinfo.ch
  * harbour/contrib/rdd_ads/ads1.c
  * harbour/source/rdd/workarea.c
  * harbour/source/rdd/delim1.c
  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/sdf1.c
    + added support for DBI_POSITIONED flag. Because some RDDs may not
      support phantom record then checking for EOF() does not have to
      be enough to detect that the cursor is positioned to phantom
      record. Checking for RecNo() == LastRec() + 1 does not have to
      work either because some RDD may use not use continuous record
      numbers f.e. ADT. So in code like BROWSE() if you want to be sure
      that current record is phantom one then (!dbInfo(DBI_POSITIONED))
      should be used.
From druzus at priv.onet.pl  Thu Sep 27 10:09:29 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Thu Sep 27 10:09:36 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw
	Czerpak(druzus/at/priv.onet.pl)
In-Reply-To: <010a01c7ffab$e8c93760$d801a8c0@ingachka>
References: <20070925171612.GA3709@localhost.localdomain>
	<010a01c7ffab$e8c93760$d801a8c0@ingachka>
Message-ID: <20070927140929.GA1985@localhost.localdomain>

On Tue, 25 Sep 2007, Miguel Angel Marchuet wrote:
> Exactly, I think that is more correct to use T for DateTime format and @ to
> TimeStamp under flag signature
> 0x30 0x31 for VFP, but there are other signatures that support it.

Internal both DateTime and TimeStamp have the same representation in DBF.
It's Julian's day and number of milliseconds.
> What signature suports T - 4 as simple Time?

ADT.

> Too we can use T - 8 - 0 as DateTime and T - 4 - 0 as SingleTime and all
> signatures will be reader.

I've juse made such modification so now {"T", 8, 0} is daytime and
{"T",4,0} as simple time.

> But all are DBFCDX rdd, we need a parameter in DbCreate to indicate the
> correct signature.

We already have it.
It's enough to use rddInfo(). If you want to create VFP compatible files
then add to your code:
    rddInfo( RDDI_TABLETYPE, DB_DBF_VFP, "DBFCDX" )

If you want then you can leave current DBFCDX as is and create new
RDD, f.e. "VFPCDX" by adding to your code:

    ANNOUNCE VFPCDX
    REQUEST DBFCDX, DBFFPT
    FUNCTION VFPCDX_GETFUNCTABLE( pFuncCount, pFuncTable, pSuperTable, nRddID )
    RETURN USRRDD_GETFUNCTABLE( pFuncCount, pFuncTable, pSuperTable, nRddID, ;
                        	"DBFCDX", {} )
    INIT PROC VFPCDX_INIT()
    rddRegister( "VFPCDX", RDT_FULL )
    rddInfo( RDDI_TABLETYPE, DB_DBF_VFP, "VFPCDX" )
    rddInfo( RDDI_MEMOTYPE, DB_MEMO_FPT, "VFPCDX" )
    rddInfo( RDDI_MEMOVERSION, DB_MEMOVER_STD, "VFPCDX" )
    rddInfo( RDDI_LOCKSCHEME, DB_DBFLOCK_VFP, "VFPCDX" )
    RETURN

and this RDD will create VFP compatible tables.

> Memo record type signature:
>  00h Picture. This normally indicates that file is produced on a MacIntosh,
> since pictures on the DOS/Windows platform are "objects".
>  01h Memo
>  02h Object
>  ??h for Blob, Is possible is 02h too ?

See in hbrddfpt.h:
    #define FPTIT_DUMMY        0xDEADBEAF
    #define FPTIT_BINARY       0x0000
    #define FPTIT_PICT         0x0000      /* Picture */
    #define FPTIT_TEXT         0x0001      /* Text    */
    #define FPTIT_OBJ          0x0002      /* Object  */

and other types like Flex ones:
    #define FPTIT_FLEX_*
or SIx3 ones:
    #define FPTIT_SIX_*

I added to DBFFPT support for DBT, SMT, FPT, FPT Flex, FPT Six and FPT CLIP.
Type of memo file is recognized automatically when table is open using
information from DBF header and/or memo file header.
For newly created files you can use RDDI_MEMOTYPE, RDDI_MEMOVERSION, see
above VFPCDX RDD

> Field-level flags:
> Bit 1: is this a "system" (hidden) field
> Bit 2: is this field nullable
> Bit 3: is this field NOCPTRANS and BINARY (have the same meaning and efect)
> Bit 4: is this field AUTOINC
> But when is AUTOINC always is NOCPTRANS or BINARY

I'll add valid settings for these bits with support for NULLABLE and
VARLENGTH types.

> I think DateTime is the more important type, that DBF needs, as VFP DBF.
> In the future we needs too, use it as item type. the type Date is a DateTime
> with time 00:00. We need compare DateTime with Date easily.
> As you know all SQL servers support type DateTime.
> The way as is implemented in xharbour is very interesting, But in VFP is a
> diferent ValType
> ValType( iDateTime ) => 'T' in VFP and 'D' in xHarbour
> ValType( iDate ) => 'D' in VFP and 'D' in xHarbour
> the convert api in VFP are:
> TToC( ... )
> TToS( ... )  (commonly used in index over DateTime an TimeStamp)
> CToT( ... )
> SToT( ... )
> ... and others

we will discuss details of DateTime implementation when we will be adding
it to Harbour VM.

best regards,
Przemek
From rglab at przesiew.imid.med.pl  Thu Sep 27 10:33:55 2007
From: rglab at przesiew.imid.med.pl (Ryszard Glab)
Date: Thu Sep 27 10:24:57 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
Message-ID: <46FBDB73.5431.D07470@rglab.przesiew.imid.med.pl>

On 25 Sep 2007 at 20:39, Szak?ts Viktor wrote:

> I'd like to revisit the question of :__enumIndex().
> 
> IMO the name is wrong and suggests something internal
> to be avoided by developers (*), which is strange for
> a (core) _statement_ of the language.
[...]
> (*) As a convention in Harbour, just like in Clipper,
> every identifier starting with an underscore or double
> underscore are considered "internal" features, which
> can be changed anytime in later versions, and developers
> are generally discouraged to use anything in the core
> language with these, just like declaring and using such
> identifiers in app code.

  I decided to use '__' prefix because these messages are some kind 
of operators build into the core of the compiler and the VM. For me, 
the HB_ prefix suggests the runtime extension that can be implemented 
outside of the compiler and the VM (by linking different libraries).

Regards, Ryszard

From harbour.01 at syenar.hu  Fri Sep 28 05:57:35 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 05:57:35 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>

2007-09-28 11:56 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/compiler/hbusage.c
     ! Show the -ks switch only when compiled with HB_COMPAT_XHB.
--
Brgds,
Viktor

From druzus at priv.onet.pl  Fri Sep 28 08:08:48 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Fri Sep 28 08:08:54 2007
Subject: [Harbour] 2007-09-28 14:08 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <200709281208.l8SC8m3P023030@31-mo5-4.acn.waw.pl>

2007-09-28 14:08 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbapi.h
  * harbour/source/vm/itemapi.c
  * harbour/source/vm/garbage.c
    + added extended item references - it's universal reference which
      can be used by HVM for many different things without introducing
      new item types

  * harbour/include/hbexprb.c
    * respect -ks compiler also with <op>=, --, ++ operators

  * harbour/include/hbvm.h
  * harbour/source/vm/hvm.c
  * harbour/source/vm/classes.c
    + added extended references for SETGET methods used as object
      item references
    * use extended references to respect overloaded [] operator in
      object item references
    + added support for passing indexes to string item characters
      ( @cValue[n] ) by reference using extended references - extension
      enabled by -ks compiler switch and //flags:s RT switch. 
    + added hb_vmPushItemRef()

  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/usrrdd/usrrdd.c
    * use hb_vmPushItemRef()

  * harbour/contrib/xhb/xhbcomp.prg
  * harbour/contrib/xhb/xhbmsgs.c
    * overload +, -, *, %, ^, ++, -- in string and numeric scalar
      classes to emulated xHarbour behavior when 1 byte string is
      used as numeric value.
      Note: <nun> + <char1> in XHB lib gives numeric value when in
            xHarbour character. But because <nun> <anyOtherOper> <char1>
            in xHarbour gives numeric value then I guess that it's
            xHarbour bug and I should not replicate it, f.e.:
               proc main()
                  ? 1+"A", 131-"A", 33 * 2, 132 / chr(2), 133 % "C"
               return
    * overload +, - in hash scalar class to emulated xHarbour behavior
      for <hash> + <hash> and <hash> - <hash>
      Seems that now we can remove HB_COMPAT_XHB flag from HVM and keep
      Harbour compatibility only with -ks compile time switch and XHB
      library. Please make some tests with Harbour compiled without
      HB_COMPAT_XHB and xHarbour code using REQUEST XHB_LIB. It's possible
      that I missed sth but some basic test shows that our emulation is
      better then original and addresses places where xHarbour does not
      work at all or gives strange results, f.e.:

         #ifndef __XHARBOUR__
            request XHB_LIB
         #endif
         proc main()
            local h:={"ABC"=>123.45}
            ? h:abc
            h:abc+=1000   ; ? h:abc
            h["ABC"]+=1000; ? h:abc
            p(@h:abc)     ; ? h:abc
            p(@h["ABC"])  ; ? h:abc
         return
         proc p(x)
            x+=1000
         return

      or:

         #ifndef __XHARBOUR__
            request XHB_LIB
         #endif
         #include "hbclass.ch"
         proc main()
            local o:=myClass():new()
            o:setget:="ABC"; ? o:setget
            o:setget[2]:=42; ? o:setget
            o:setget[2]+=42; ? o:setget
            ? o:setget[2]+=42; ? o:setget
            ?
            o:var:="ABC"; ? o:var
            o:var[2]:=42; ? o:var
            o:var[2]+=42; ? o:var
            ? o:var[2]+=42; ? o:var
         return
         CREATE CLASS myClass
            VAR    var
            METHOD setget SETGET
         END CLASS
         METHOD setget( xNewVal ) CLASS myClass
            IF pcount() > 0
               ::var := xNewVal
            ENDIF
         RETURN ::var

  * harbour/include/hbapirdd.h
  * harbour/source/rdd/dbcmd.c
  * harbour/source/rdd/workarea.c
  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/dbffpt/dbffpt1.c
  * harbour/source/rdd/dbfcdx/dbfcdx1.c
  * harbour/source/rdd/dbfdbt/dbfdbt1.c
  * harbour/source/rdd/usrrdd/usrrdd.c
  * harbour/contrib/rdd_ads/ads1.c
    * changed second parameter in RELTEXT() method to PHB_ITEM
      Now RELTEXT() works like FILTERTEXT() and the size of
      expression is not limited. It's a modification I wanted
      to make for a long time and I think that now is a good
      moment to make it together with HB_FT_* modifications
    - rmoved not longer necessary HARBOUR_MAX_RDD_RELTEXT_LENGTH

  * harbour/source/rtl/gttrm/gttrm.c
    * small cleanup

best regards
Przemek
From druzus at priv.onet.pl  Fri Sep 28 08:31:49 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Fri Sep 28 08:31:56 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
Message-ID: <20070928123149.GA11820@localhost.localdomain>

On Fri, 28 Sep 2007, Szak?ts Viktor wrote:
> 2007-09-28 11:56 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>    * source/compiler/hbusage.c
>      ! Show the -ks switch only when compiled with HB_COMPAT_XHB.

Viktor -ks is not xHarbour compatible switch. It was added by Ryszard
long time ago and it allows to assign characters in string items
using array index operator [].
We have runtime switch //flags:s but it's not enough to assign strings.
Without -ks only access works, f.e. try this code with and without -ks
switch:

    /*** t.prg ***/
    proc main()
    local s:="ABC"
    ? s, s[2], s[2]:="*", s
    return

druzus:/tmp/4# hbmk -n -w -es2 t && ./t //flags:s
Harbour devel build 1.1-1 Intl.
Copyright 1999-2007, http://www.harbour-project.org/
Compiling 't.prg'...
Lines 4, Functions/Procedures 1
Generating C source output to 't.c'... Done.

ABC         66 * ABC
druzus:/tmp/4# hbmk -n -w -es2 t -ks && ./t //flags:s
Harbour devel build 1.1-1 Intl.
Copyright 1999-2007, http://www.harbour-project.org/
Compiling 't.prg'...
Lines 4, Functions/Procedures 1
Generating C source output to 't.c'... Done.

ABC         66 * A*C
druzus:/tmp/4#


As you can see s[2]:="*" works only when you compile .prg code
with -ks switch. After my recent modifications it's possible
to compile Harbour without HB_COMPAT_XHB macro and still use
xHarbour extensions by simple linking with XHB lib (REQUEST XHB_LIB).
But if you want to assign strings then you will need to use -ks switch
during compilation of your .prg code so it's very important to keep
information about this switch when HB_COMPAT_XHB is not set.
So please revert this modifications.

Just for information. If you do not want to assign string characters
using [] operator then I suggest to not enable this switch because
it may reduce a little bit performance in some cases. In xHarbour
such performance reduction is always present.

best regards,
Przemek
From harbour.01 at syenar.hu  Fri Sep 28 09:24:40 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 09:24:51 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070928123149.GA11820@localhost.localdomain>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
	<20070928123149.GA11820@localhost.localdomain>
Message-ID: <7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>


On 2007.09.28., at 14:31, Przemyslaw Czerpak wrote:

> On Fri, 28 Sep 2007, Szak?ts Viktor wrote:
>> 2007-09-28 11:56 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
>>    * source/compiler/hbusage.c
>>      ! Show the -ks switch only when compiled with HB_COMPAT_XHB.
>
> Viktor -ks is not xHarbour compatible switch. It was added by Ryszard
> long time ago and it allows to assign characters in string items
> using array index operator [].

Does this mean, that although xhb added the "strings as arrays"
concept (which we didn't natively support in Harbour), xhb still
doesn't have support for "s[n] := char"? (so this is essentially
a Harbour extension of an xhb extension?)

To clarify, in my understanding "s[n] := char" is a subfeature
of the whole "strings as arrays" featureset.

> We have runtime switch //flags:s but it's not enough to assign  
> strings.
> Without -ks only access works, f.e. try this code with and without -ks
> switch:

This looks strange to me. Why does someone need to use
a runtime flag to enable a compile-time feature?

> As you can see s[2]:="*" works only when you compile .prg code
> with -ks switch. After my recent modifications it's possible
> to compile Harbour without HB_COMPAT_XHB macro and still use
> xHarbour extensions by simple linking with XHB lib (REQUEST XHB_LIB).
> But if you want to assign strings then you will need to use -ks switch
> during compilation of your .prg code so it's very important to keep
> information about this switch when HB_COMPAT_XHB is not set.
> So please revert this modifications.
>
> Just for information. If you do not want to assign string characters
> using [] operator then I suggest to not enable this switch because
> it may reduce a little bit performance in some cases. In xHarbour
> such performance reduction is always present.

Hm, many thanks for your mail, first off because I never grasped
the concept of using -ks + //flags switches for language feature.
To tell you the truth I still find this very odd, even as a developer
and as an app user that I have to use two different switches
(one compile-time and one runtime) to get some features to work.

Is there any sense in using:
1) Just the compiler switch?
    I've tried and it gives an array access error. So, using the  
compiler
    time switch made no sense here.
2) Just the runtime switch?
    I've tried and the s[n]:=c operation just gets ignored.
    So using the compiler time switch without the runtime one didn't  
make sense.

So, if the two can only work as expected if _both_ are used,
couldn't we find a solution to eliminate the runtime one?

Brgds,
Viktor

From harbour.01 at syenar.hu  Fri Sep 28 09:27:38 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 09:27:47 2007
Subject: [Harbour] 2007-09-28 14:08 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <200709281208.l8SC8m3P023030@31-mo5-4.acn.waw.pl>
References: <200709281208.l8SC8m3P023030@31-mo5-4.acn.waw.pl>
Message-ID: <E5C48952-98C7-4D69-9BCF-B11E5CDB15E7@syenar.hu>

Great stuff.

Just a few small notes:

1) To use xhb lib in app code, the preferred method is
adding this one line on top of every .prg:
#include "xhb.ch"

2) As another note, I'd suggest migrating relevant
parts of hbcompat.ch (or rather the whole thing)
to xhb.ch, because this is where it really belongs.

The portion which deals with reverse compatibility
(to compile Harbour app under xhb) should really go
to xhb itself, but I think it's also safe to move
it to xhb lib (at least better than leaving it in
Harbour).

3) I think we can now safely remove related HB_COMPAT_XHBs
switches.

Brgds,
Viktor

On 2007.09.28., at 14:08, Przemyslaw Czerpak wrote:

> 2007-09-28 14:08 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/include/hbapi.h
>   * harbour/source/vm/itemapi.c
>   * harbour/source/vm/garbage.c
>     + added extended item references - it's universal reference which
>       can be used by HVM for many different things without introducing
>       new item types
>
>   * harbour/include/hbexprb.c
>     * respect -ks compiler also with <op>=, --, ++ operators
>
>   * harbour/include/hbvm.h
>   * harbour/source/vm/hvm.c
>   * harbour/source/vm/classes.c
>     + added extended references for SETGET methods used as object
>       item references
>     * use extended references to respect overloaded [] operator in
>       object item references
>     + added support for passing indexes to string item characters
>       ( @cValue[n] ) by reference using extended references -  
> extension
>       enabled by -ks compiler switch and //flags:s RT switch.
>     + added hb_vmPushItemRef()
>
>   * harbour/source/rdd/dbf1.c
>   * harbour/source/rdd/usrrdd/usrrdd.c
>     * use hb_vmPushItemRef()
>
>   * harbour/contrib/xhb/xhbcomp.prg
>   * harbour/contrib/xhb/xhbmsgs.c
>     * overload +, -, *, %, ^, ++, -- in string and numeric scalar
>       classes to emulated xHarbour behavior when 1 byte string is
>       used as numeric value.
>       Note: <nun> + <char1> in XHB lib gives numeric value when in
>             xHarbour character. But because <nun> <anyOtherOper>  
> <char1>
>             in xHarbour gives numeric value then I guess that it's
>             xHarbour bug and I should not replicate it, f.e.:
>                proc main()
>                   ? 1+"A", 131-"A", 33 * 2, 132 / chr(2), 133 % "C"
>                return
>     * overload +, - in hash scalar class to emulated xHarbour behavior
>       for <hash> + <hash> and <hash> - <hash>
>       Seems that now we can remove HB_COMPAT_XHB flag from HVM and  
> keep
>       Harbour compatibility only with -ks compile time switch and XHB
>       library. Please make some tests with Harbour compiled without
>       HB_COMPAT_XHB and xHarbour code using REQUEST XHB_LIB. It's  
> possible
>       that I missed sth but some basic test shows that our  
> emulation is
>       better then original and addresses places where xHarbour does  
> not
>       work at all or gives strange results, f.e.:
>
>          #ifndef __XHARBOUR__
>             request XHB_LIB
>          #endif
>          proc main()
>             local h:={"ABC"=>123.45}
>             ? h:abc
>             h:abc+=1000   ; ? h:abc
>             h["ABC"]+=1000; ? h:abc
>             p(@h:abc)     ; ? h:abc
>             p(@h["ABC"])  ; ? h:abc
>          return
>          proc p(x)
>             x+=1000
>          return
>
>       or:
>
>          #ifndef __XHARBOUR__
>             request XHB_LIB
>          #endif
>          #include "hbclass.ch"
>          proc main()
>             local o:=myClass():new()
>             o:setget:="ABC"; ? o:setget
>             o:setget[2]:=42; ? o:setget
>             o:setget[2]+=42; ? o:setget
>             ? o:setget[2]+=42; ? o:setget
>             ?
>             o:var:="ABC"; ? o:var
>             o:var[2]:=42; ? o:var
>             o:var[2]+=42; ? o:var
>             ? o:var[2]+=42; ? o:var
>          return
>          CREATE CLASS myClass
>             VAR    var
>             METHOD setget SETGET
>          END CLASS
>          METHOD setget( xNewVal ) CLASS myClass
>             IF pcount() > 0
>                ::var := xNewVal
>             ENDIF
>          RETURN ::var
>
>   * harbour/include/hbapirdd.h
>   * harbour/source/rdd/dbcmd.c
>   * harbour/source/rdd/workarea.c
>   * harbour/source/rdd/dbf1.c
>   * harbour/source/rdd/dbffpt/dbffpt1.c
>   * harbour/source/rdd/dbfcdx/dbfcdx1.c
>   * harbour/source/rdd/dbfdbt/dbfdbt1.c
>   * harbour/source/rdd/usrrdd/usrrdd.c
>   * harbour/contrib/rdd_ads/ads1.c
>     * changed second parameter in RELTEXT() method to PHB_ITEM
>       Now RELTEXT() works like FILTERTEXT() and the size of
>       expression is not limited. It's a modification I wanted
>       to make for a long time and I think that now is a good
>       moment to make it together with HB_FT_* modifications
>     - rmoved not longer necessary HARBOUR_MAX_RDD_RELTEXT_LENGTH
>
>   * harbour/source/rtl/gttrm/gttrm.c
>     * small cleanup
>
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From rglab at przesiew.imid.med.pl  Fri Sep 28 09:56:15 2007
From: rglab at przesiew.imid.med.pl (Ryszard Glab)
Date: Fri Sep 28 09:44:21 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>,
	<20070928123149.GA11820@localhost.localdomain>,
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
Message-ID: <46FD241F.6600.10123A3@rglab.przesiew.imid.med.pl>

On 28 Sep 2007 at 15:24, Szak?ts Viktor wrote:

> Is there any sense in using:
> 1) Just the compiler switch?
>     I've tried and it gives an array access error. So, using the  
> compiler
>     time switch made no sense here.
> 2) Just the runtime switch?
>     I've tried and the s[n]:=c operation just gets ignored.
>     So using the compiler time switch without the runtime one didn't  
> make sense.
> 
> So, if the two can only work as expected if _both_ are used,
> couldn't we find a solution to eliminate the runtime one?

  Please notice that my intention for introduction of -k switch in 
compiler was elimination of 
#ifdef __SOMETHING__
in the code so the compiler can be build with all the features 
supported. The decision of which of these features will be used is 
left to the programmer by the use of -k switch at the compile time.

  The runtime settings //flags: was added to run code from libraries 
that were compiled with different set of switches.
  For example I don't use [] for strings in my application so I 
compile my code without -ks switch. If I will have to use an external 
library (given to me as a .lib or .a or .dll) which relays on this 
feature then I can enable it at runtime.

Regards, Ryszard
From harbour.01 at syenar.hu  Fri Sep 28 09:56:44 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 09:56:54 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <46FD241F.6600.10123A3@rglab.przesiew.imid.med.pl>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>,
	<20070928123149.GA11820@localhost.localdomain>,
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<46FD241F.6600.10123A3@rglab.przesiew.imid.med.pl>
Message-ID: <947F3533-5858-4E31-9E84-2D1F4182E636@syenar.hu>

Thanks Ryszard.

Can't this be solved by two different pcodes, one which
behaves if //flags:s was specified, one other which
acts as the current default. Then when someone uses
/ks at compile time, the special pcode would be used,
otherwise the normal one?

This would solve the lib problem, as a I reckon. Moreover
it would do so without interacting any other app level
code and would make //flags:s unnecessary.

Brgds,
Viktor

On 2007.09.28., at 15:56, Ryszard Glab wrote:

> On 28 Sep 2007 at 15:24, Szak?ts Viktor wrote:
>
>> Is there any sense in using:
>> 1) Just the compiler switch?
>>     I've tried and it gives an array access error. So, using the
>> compiler
>>     time switch made no sense here.
>> 2) Just the runtime switch?
>>     I've tried and the s[n]:=c operation just gets ignored.
>>     So using the compiler time switch without the runtime one didn't
>> make sense.
>>
>> So, if the two can only work as expected if _both_ are used,
>> couldn't we find a solution to eliminate the runtime one?
>
>   Please notice that my intention for introduction of -k switch in
> compiler was elimination of
> #ifdef __SOMETHING__
> in the code so the compiler can be build with all the features
> supported. The decision of which of these features will be used is
> left to the programmer by the use of -k switch at the compile time.
>
>   The runtime settings //flags: was added to run code from libraries
> that were compiled with different set of switches.
>   For example I don't use [] for strings in my application so I
> compile my code without -ks switch. If I will have to use an external
> library (given to me as a .lib or .a or .dll) which relays on this
> feature then I can enable it at runtime.
>
> Regards, Ryszard
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Fri Sep 28 10:32:22 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Fri Sep 28 10:32:28 2007
Subject: [Harbour] 2007-09-28 16:32 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <200709281432.l8SEWMNQ031171@31-mo5-4.acn.waw.pl>

2007-09-28 16:32 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbexprb.c
    * respect -ks in macrovars and array item references

  * harbour/source/vm/memvars.c
    * do not detach array items during detaching enumerator variable
      also in standard (without HB_COMPAT_XHB) build

best regards
Przemek
From harbour.01 at syenar.hu  Fri Sep 28 10:41:20 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 10:41:32 2007
Subject: [Harbour] :__enumIndex() revisited
In-Reply-To: <46FBDB73.5431.D07470@rglab.przesiew.imid.med.pl>
References: <E387ACC6-61FA-429A-A54E-0F38A8544C7E@syenar.hu>
	<46FBDB73.5431.D07470@rglab.przesiew.imid.med.pl>
Message-ID: <21D39902-F4DF-49A2-A5AD-552E625FDEE3@syenar.hu>

>> I'd like to revisit the question of :__enumIndex().
>>
>> IMO the name is wrong and suggests something internal
>> to be avoided by developers (*), which is strange for
>> a (core) _statement_ of the language.
> [...]
>> (*) As a convention in Harbour, just like in Clipper,
>> every identifier starting with an underscore or double
>> underscore are considered "internal" features, which
>> can be changed anytime in later versions, and developers
>> are generally discouraged to use anything in the core
>> language with these, just like declaring and using such
>> identifiers in app code.
>
>   I decided to use '__' prefix because these messages are some kind
> of operators build into the core of the compiler and the VM. For me,
> the HB_ prefix suggests the runtime extension that can be implemented
> outside of the compiler and the VM (by linking different libraries).

I see, thanks for the feedback.

Aside from the internal implementation - from a developers POV -,
it behaves just like any other built-in message, like :ClassName()
for example. "__" is reserved for functions (symbols) to be used
by core Harbour only (IOW "internal" functions), independely of
the actual internal implementation (VM, RTL, compiler, PP).
__enum*() though, is definitely meant to be used by everyone,
as it's a _core part_ of the FOR EACH feature.

"hb_" prefix should go for everything implemented by Harbour
(and not other flavours of the compiler), and it can be used
idependently of the features' internal implementation IMO.

That why I think hb_enum*() would fit much better than __enum*()
and would encourage it's app level usage amongst developers.

Brgds,
Viktor

From harbour.01 at syenar.hu  Fri Sep 28 10:52:41 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 10:52:50 2007
Subject: [Harbour] 2007-09-28 16:32 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <200709281432.l8SEWMNQ031171@31-mo5-4.acn.waw.pl>
References: <200709281432.l8SEWMNQ031171@31-mo5-4.acn.waw.pl>
Message-ID: <4AD18F1B-A675-477C-B438-AE5F33162867@syenar.hu>

Hi Przemek,

Back to the -ks switch, and to eliminate another HB_COMPAT_XHB,
we could add a new #pragma for -ks, and add this #pragma to
xhb.ch. This way default Harbour build could be used without
any special command line switch, if "xhb.ch" is included.

What do you think?

Brgds,
Viktor

On 2007.09.28., at 16:32, Przemyslaw Czerpak wrote:

> 2007-09-28 16:32 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/include/hbexprb.c
>     * respect -ks in macrovars and array item references
>
>   * harbour/source/vm/memvars.c
>     * do not detach array items during detaching enumerator variable
>       also in standard (without HB_COMPAT_XHB) build
>
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From soporte at dsgsoftware.com  Fri Sep 28 11:17:14 2007
From: soporte at dsgsoftware.com (=?iso-8859-1?Q?Juan_G=E1lvez?=)
Date: Fri Sep 28 11:19:25 2007
Subject: [Harbour] 2007-09-28 14:08 UTC+0200 Przemyslaw
	Czerpak(druzus/at/priv.onet.pl)
References: <200709281208.l8SC8m3P023030@31-mo5-4.acn.waw.pl>
Message-ID: <000a01c801e2$b8148b90$1700000a@PcJuanxp>

Hi Przemek,

>      ...
>      Seems that now we can remove HB_COMPAT_XHB flag from HVM and keep
>      Harbour compatibility only with -ks compile time switch and XHB
>      library. Please make some tests with Harbour compiled without
>      HB_COMPAT_XHB and xHarbour code using REQUEST XHB_LIB.
>      ...

Sorry but I think negative values on index array doesn't work. The compiler 
shows an "Error E0041  Bound error: 'Numeric'"

Many thanks for your great work.

Best regards
Juan 

From harbour.01 at syenar.hu  Fri Sep 28 11:31:54 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 11:31:53 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 17:26 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c801e4$Blat.v2.6.2$b2d7578c$9a4c3fa5db0@127.0.0.1>

2007-09-28 17:26 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * include/Makefile
   - include/hbcompat.ch
   + contrib/xhb/hbcompat.ch
   * contrib/xhb/xhb.ch
   * contrib/xhb/Makefile
     * Moved content or hbcompat.ch into xhb.ch.
       Those who need compatibility, have to replace 
     * Moved hbcompat.ch (for compatibility) to contrib/xhb
--
Brgds,
Viktor

From teo at windtelsoft.com  Fri Sep 28 13:24:01 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Fri Sep 28 13:24:26 2007
Subject: [Harbour] 2007-09-28 14:08 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <200709281208.l8SC8m3P023030@31-mo5-4.acn.waw.pl>
References: <200709281208.l8SC8m3P023030@31-mo5-4.acn.waw.pl>
Message-ID: <200709281224.01242.teo@windtelsoft.com>

On Friday 28 September 2007 07:08:48 am Przemyslaw Czerpak wrote:
> 2007-09-28 14:08 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/include/hbapi.h
>   * harbour/source/vm/itemapi.c
>   * harbour/source/vm/garbage.c
>     + added extended item references - it's universal reference which
>       can be used by HVM for many different things without introducing
>       new item types

[snip]

>
>     + added hb_vmPushItemRef()
>
>   * harbour/source/rdd/dbf1.c
>   * harbour/source/rdd/usrrdd/usrrdd.c
>     * use hb_vmPushItemRef()

[snip]

Hello Prezmek,

Can you kindly elaborate a little on this feature (extended item references) ?

A small sample would be enough.


best regards

Teo
From druzus at priv.onet.pl  Fri Sep 28 13:26:33 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Fri Sep 28 13:26:39 2007
Subject: [Harbour] 2007-09-28 19:26 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <200709281726.l8SHQXdb011044@31-mo5-4.acn.waw.pl>

2007-09-28 19:26 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbcomp.h
    * pass compile time -ks state to RT macro compiler flags.
      It means that if you compile some with which &macros
      then -ks compile time switch will be passed also to
      macro compiler and respected later at runtime

  * harbour/source/macro/macro.yyc
  * harbour/source/macro/macro.y
    + added support for passing by reference array and object items

  * harbour/source/compiler/harbour.y
  * harbour/source/compiler/harbour.yyc
    * generate compile time error for @func(<vars,...>)
      only @func() is acceptable

best regards
Przemek
From druzus at priv.onet.pl  Fri Sep 28 16:00:04 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Fri Sep 28 16:00:13 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
	<20070928123149.GA11820@localhost.localdomain>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
Message-ID: <20070928200004.GA9026@localhost.localdomain>

On Fri, 28 Sep 2007, Szak?ts Viktor wrote:
> >Viktor -ks is not xHarbour compatible switch. It was added by Ryszard
> >long time ago and it allows to assign characters in string items
> >using array index operator [].
> Does this mean, that although xhb added the "strings as arrays"
> concept (which we didn't natively support in Harbour), xhb still
> doesn't have support for "s[n] := char"? (so this is essentially
> a Harbour extension of an xhb extension?)

No. AFAIK the intention was to add full support for assigning
string characters in all places in xHarbour. So xHarbour always
tries to generate code similar to the one we have using -ks switch.
But not all language constructions are well supported so it does not
work in many places in xHarbour.
The funny thing is that now Harbour with -ks switch and XHB_LIB
works in all situations but xHarbour doesn't.

> To clarify, in my understanding "s[n] := char" is a subfeature
> of the whole "strings as arrays" featureset.

Harbour when compiled without HB_COMPAT_XHB and without scalar
classes overloaded by XHB_LIB for "s[n]" returns number and
xHarbour 1 byte character value.

> >We have runtime switch //flags:s but it's not enough to assign  
> >strings.
> >Without -ks only access works, f.e. try this code with and without -ks
> >switch:
> This looks strange to me. Why does someone need to use
> a runtime flag to enable a compile-time feature?

It was Ryszard choice. I guess he didn't want to add new PCODEs.
Now for access we do not need -ks switch and only runtime flags
so the same PCODEs can be evaluated in different way. Only for assign
-ks switch is necessary.
If we want to eliminate runtime switch so compile switch will determinate
the behavior then we will have to introduce alternative version for the
following PCODEs:
    HB_P_ARRAYPUSH, HB_P_ARRAYPUSHREF, HB_P_ARRAYPOP, HB_P_MACROPUSHINDEX

> Hm, many thanks for your mail, first off because I never grasped
> the concept of using -ks + //flags switches for language feature.
> To tell you the truth I still find this very odd, even as a developer
> and as an app user that I have to use two different switches
> (one compile-time and one runtime) to get some features to work.
> Is there any sense in using:
> 1) Just the compiler switch?
>    I've tried and it gives an array access error. So, using the  
> compiler
>    time switch made no sense here.

-ks can be used with runtime 's' flag. Without it overloading []
operator in assign operation will not work.

> 2) Just the runtime switch?
>    I've tried and the s[n]:=c operation just gets ignored.
>    So using the compiler time switch without the runtime one didn't  
> make sense.

Assing strings in overloaded [] - it alos not work without -ks

> So, if the two can only work as expected if _both_ are used,
> couldn't we find a solution to eliminate the runtime one?

It's very simple. We have to add four new PCODEs - see above
but in such case we will have problem with overloading []. As I said
in Harbour s[n] return number and in xHarbour it returns string.
Overloading operators which are defined in HVM is intentionally
forbidden so if we add these new PCODEs then we will not be able
to emulate xHarbour behavior. We will need two compile time switches:
1-st working like current -ks for XHB compatibility and second
working like -ks + RT //flags:s so it will use new PCODEs.

best regards,
Przemek

ps. I can see some messages on
        http://lists.harbour-project.org/pipermail/harbour/
    but I haven't received them yet so I'll answer here:

    Juan negative indexes work as they should. Please read my
    ChangeLog notes:
    2007-09-26 02:30 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
    [...]
      + added support for negative indexes in used in [] operator
        for array and strings.
        Please remember that standard harbour build (without
        HB_COMPAT_XHB flag) generate warning for negative indexes,
        if you wan to pacify them then instead of var[-1] use var[(-1)]
	                                          ^^^^^^^     ^^^^^^^^^
    If you want to use then with standard build (without HB_COMPAT_XHB)
    then you have to use parentheses as in example above.

    Teo, 'extended references' is a mechanism used internally by HVM.
    If I'll find some time then I'll write some text about them. Now
    they are used to support references to string item characters,
    references to SETGET methods, references to overloaded object items
    accessed by [] operators and simple C item references. Inside hvm.c
    you can find as example how they were implemented.
    void hb_vmPushItemRef( PHB_ITEM pItem ) is very simple function
    which push the reference to given item on HVM stack. 3-rd party
    developers very often asked me about such functionality and because
    it was missing then they were creating their own workarounds hacking
    HVM internals. Now such function is part of documented API and you
    can use it if you want to execute some function or method from C level
    passing some items by reference, f.e.

	hb_vmPushDynSym( hb_dynsymGetCase( "MYFUNC" ) );
	hb_vmPushNil();
	hb_vmPushItemRef( pItem );
	hb_vmDo( 1 );

    The programmer have to guard that pItem will exist during MYFUNC()
    execution.
    HTH.

best regards,
Przemek
From teo at windtelsoft.com  Fri Sep 28 16:39:44 2007
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Fri Sep 28 16:39:52 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070928200004.GA9026@localhost.localdomain>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<20070928200004.GA9026@localhost.localdomain>
Message-ID: <200709281539.45092.teo@windtelsoft.com>

On Friday 28 September 2007 03:00:04 pm Przemyslaw Czerpak wrote:

[snip]

>     Teo, 'extended references' is a mechanism used internally by HVM.
>     If I'll find some time then I'll write some text about them. Now
>     they are used to support references to string item characters,
>     references to SETGET methods, references to overloaded object items
>     accessed by [] operators and simple C item references. Inside hvm.c
>     you can find as example how they were implemented.
>     void hb_vmPushItemRef( PHB_ITEM pItem ) is very simple function
>     which push the reference to given item on HVM stack. 3-rd party
>     developers very often asked me about such functionality and because
>     it was missing then they were creating their own workarounds hacking
>     HVM internals. Now such function is part of documented API and you
>     can use it if you want to execute some function or method from C level
>     passing some items by reference, f.e.
>
> 	hb_vmPushDynSym( hb_dynsymGetCase( "MYFUNC" ) );
> 	hb_vmPushNil();
> 	hb_vmPushItemRef( pItem );
> 	hb_vmDo( 1 );
>
>     The programmer have to guard that pItem will exist during MYFUNC()
>     execution.
>     HTH.

This is enough, thank you Przemek.


best regards

Teo
From dbtopas at dbtopas.lt  Fri Sep 28 17:02:29 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Fri Sep 28 17:03:23 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20070925012014.GA7796@localhost.localdomain>
References: <20070925012014.GA7796@localhost.localdomain>
Message-ID: <46FD6BE5.5040809@dbtopas.lt>

>   * harbour/source/rdd/dbf1.c
>     + added support for AUTOINC (+), ROWVERSION (^), TIME (T), DAYTIME (@)
>       and MODTIME (=) fields

Hi,


thanks for great contribution! Sometimes I think that Harbour should 
have "Prz" prefix in its name :)

I just wanted to ask, is this 32/64 bit access/assign intentional 
(dbf1.c, function hb_dbfGetRowVer)?

       *pValue = HB_GET_LE_UINT32( &dbField.bReserved2 ) + 1;
       HB_PUT_LE_UINT64( dbField.bReserved2, *pValue );


Best regards,
Mindaugas
From harbour.01 at syenar.hu  Fri Sep 28 17:26:40 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 17:26:50 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070928200004.GA9026@localhost.localdomain>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
	<20070928123149.GA11820@localhost.localdomain>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<20070928200004.GA9026@localhost.localdomain>
Message-ID: <6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>

Hi Przemek,

I had to reboot myself due to stack overflow after you e-mail :)
Not because of your actual comments, but the way Harbour
is working in this area. Honestly, who gets this? (besides you
and Ryszard). (Disclaimer: No flame of anything negative intended,
I see the proper intentions behind every move.)

Harbour now supports at least three different modes for array  
assigments:
a) string[num] -> RTE (Harbour and Clipper behaviour) (default or - 
ks, with difference in performance)
b) string[num] -> number (-ks + //flags:s)
c) string[num] -> 1 char string (HB_COMPAT_XHB)

Some more examples to add to the confusion:
d) string[num] := "c" -> "c", string unchanged (//flags:s)
e) string[num] := "c" -> "c", string changed (-ks + //flags:s)
f) string[num] := "c" -> ??, string ? (HB_COMPAT_XHB) (UNTESTED)
g) string[num] := "12" -> RTE (in all cases) (PARTIALLY UNTESTED)
h) string[num] := num -> ? (UNTESTED)

Notice that the exact behaviour depends on:
1) a compiler switch
2) a Harbour build switch
3) a runtime switch
4) operator operand type
5) operator operand _length_

I'm all for flexibility but I find the above nonsense for a compiler.
Very few ppl will be able to get this right, even if someone would
take the pain to properly document it.

So first of all, I'm not sure if have to support that many variations.
Worst case, we need one which is Clipper compatible (current default)
and one which supports "arrays as string".

I'm not sure how "arrays as strings" we would be xhb compatible,
but could we stay with one consistent variation? I'd vote for this:

- string[num] -> returns 1 char string
- string[num] := "c" -> returns 1 char string, changes string
- string[num] := non 1 len string -> RTE
- string/array[-1] -> compiler warning (not error)
- string/array[-1] -> compiler warning (not error)

"arrays as string" could be enabled with:
1) -ks switch
2) #pragma ARRSTR=on (as a synonym for the above) (automatically set  
by xhb.ch)

Following feature have to be removed IMO:
- //flags:s
- related HB_COMPAT_XHBs in hvm/compiler
- dependance of -ks switch default on HB_COMPAT_XHB

What I still fail to see (my ignorance), is why can't we emulate
everything using operator overloading?

If I understood you correctly, this is about inline with what you've
suggested, with the difference that I'd only keep _one_ variation of
the "strings as arrays" feature.

Brgds,
Viktor

On 2007.09.28., at 22:00, Przemyslaw Czerpak wrote:

> On Fri, 28 Sep 2007, Szak?ts Viktor wrote:
>>> Viktor -ks is not xHarbour compatible switch. It was added by  
>>> Ryszard
>>> long time ago and it allows to assign characters in string items
>>> using array index operator [].
>> Does this mean, that although xhb added the "strings as arrays"
>> concept (which we didn't natively support in Harbour), xhb still
>> doesn't have support for "s[n] := char"? (so this is essentially
>> a Harbour extension of an xhb extension?)
>
> No. AFAIK the intention was to add full support for assigning
> string characters in all places in xHarbour. So xHarbour always
> tries to generate code similar to the one we have using -ks switch.
> But not all language constructions are well supported so it does not
> work in many places in xHarbour.
> The funny thing is that now Harbour with -ks switch and XHB_LIB
> works in all situations but xHarbour doesn't.
>
>> To clarify, in my understanding "s[n] := char" is a subfeature
>> of the whole "strings as arrays" featureset.
>
> Harbour when compiled without HB_COMPAT_XHB and without scalar
> classes overloaded by XHB_LIB for "s[n]" returns number and
> xHarbour 1 byte character value.
>
>>> We have runtime switch //flags:s but it's not enough to assign
>>> strings.
>>> Without -ks only access works, f.e. try this code with and  
>>> without -ks
>>> switch:
>> This looks strange to me. Why does someone need to use
>> a runtime flag to enable a compile-time feature?
>
> It was Ryszard choice. I guess he didn't want to add new PCODEs.
> Now for access we do not need -ks switch and only runtime flags
> so the same PCODEs can be evaluated in different way. Only for assign
> -ks switch is necessary.
> If we want to eliminate runtime switch so compile switch will  
> determinate
> the behavior then we will have to introduce alternative version for  
> the
> following PCODEs:
>     HB_P_ARRAYPUSH, HB_P_ARRAYPUSHREF, HB_P_ARRAYPOP,  
> HB_P_MACROPUSHINDEX
>
>> Hm, many thanks for your mail, first off because I never grasped
>> the concept of using -ks + //flags switches for language feature.
>> To tell you the truth I still find this very odd, even as a developer
>> and as an app user that I have to use two different switches
>> (one compile-time and one runtime) to get some features to work.
>> Is there any sense in using:
>> 1) Just the compiler switch?
>>    I've tried and it gives an array access error. So, using the
>> compiler
>>    time switch made no sense here.
>
> -ks can be used with runtime 's' flag. Without it overloading []
> operator in assign operation will not work.
>
>> 2) Just the runtime switch?
>>    I've tried and the s[n]:=c operation just gets ignored.
>>    So using the compiler time switch without the runtime one didn't
>> make sense.
>
> Assing strings in overloaded [] - it alos not work without -ks
>
>> So, if the two can only work as expected if _both_ are used,
>> couldn't we find a solution to eliminate the runtime one?
>
> It's very simple. We have to add four new PCODEs - see above
> but in such case we will have problem with overloading []. As I said
> in Harbour s[n] return number and in xHarbour it returns string.
> Overloading operators which are defined in HVM is intentionally
> forbidden so if we add these new PCODEs then we will not be able
> to emulate xHarbour behavior. We will need two compile time switches:
> 1-st working like current -ks for XHB compatibility and second
> working like -ks + RT //flags:s so it will use new PCODEs.
>
> best regards,
> Przemek
>
> ps. I can see some messages on
>         http://lists.harbour-project.org/pipermail/harbour/
>     but I haven't received them yet so I'll answer here:
>
>     Juan negative indexes work as they should. Please read my
>     ChangeLog notes:
>     2007-09-26 02:30 UTC+0200 Przemyslaw Czerpak (druzus/at/ 
> priv.onet.pl)
>     [...]
>       + added support for negative indexes in used in [] operator
>         for array and strings.
>         Please remember that standard harbour build (without
>         HB_COMPAT_XHB flag) generate warning for negative indexes,
>         if you wan to pacify them then instead of var[-1] use var 
> [(-1)]
> 	                                          ^^^^^^^     ^^^^^^^^^
>     If you want to use then with standard build (without  
> HB_COMPAT_XHB)
>     then you have to use parentheses as in example above.
>
>     Teo, 'extended references' is a mechanism used internally by HVM.
>     If I'll find some time then I'll write some text about them. Now
>     they are used to support references to string item characters,
>     references to SETGET methods, references to overloaded object  
> items
>     accessed by [] operators and simple C item references. Inside  
> hvm.c
>     you can find as example how they were implemented.
>     void hb_vmPushItemRef( PHB_ITEM pItem ) is very simple function
>     which push the reference to given item on HVM stack. 3-rd party
>     developers very often asked me about such functionality and  
> because
>     it was missing then they were creating their own workarounds  
> hacking
>     HVM internals. Now such function is part of documented API and you
>     can use it if you want to execute some function or method from  
> C level
>     passing some items by reference, f.e.
>
> 	hb_vmPushDynSym( hb_dynsymGetCase( "MYFUNC" ) );
> 	hb_vmPushNil();
> 	hb_vmPushItemRef( pItem );
> 	hb_vmDo( 1 );
>
>     The programmer have to guard that pItem will exist during MYFUNC()
>     execution.
>     HTH.
>
> best regards,
> Przemek

From harbour.01 at syenar.hu  Fri Sep 28 17:27:30 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Sep 28 17:27:40 2007
Subject: [Harbour] ChangeLog 2007-09-25 03:20 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <46FD6BE5.5040809@dbtopas.lt>
References: <20070925012014.GA7796@localhost.localdomain>
	<46FD6BE5.5040809@dbtopas.lt>
Message-ID: <707572ED-5557-4EE9-A2C3-D35E72A98F6B@syenar.hu>

On 2007.09.28., at 23:02, Mindaugas Kavaliauskas wrote:

>>   * harbour/source/rdd/dbf1.c
>>     + added support for AUTOINC (+), ROWVERSION (^), TIME (T),  
>> DAYTIME (@)
>>       and MODTIME (=) fields
>
> Hi,
>
>
> thanks for great contribution! Sometimes I think that Harbour  
> should have "Prz" prefix in its name :)

:)

Brgds,
Viktor



From druzus at priv.onet.pl  Fri Sep 28 17:57:24 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Fri Sep 28 17:57:31 2007
Subject: [Harbour] 2007-09-28 23:57 UTC+0200 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <200709282157.l8SLvOxA009753@31-mo5-4.acn.waw.pl>

2007-09-28 23:57 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rdd/dbf1.c
    ! fixed typo in hb_dbfGetRowVer() reported by Mindaugas, many
      thanks for information, it was side effect of some experiments
      I hadn't cleanly removed before commit.

best regards
Przemek
From dbtopas at dbtopas.lt  Sat Sep 29 02:19:28 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Sat Sep 29 02:20:21 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>	<20070928123149.GA11820@localhost.localdomain>	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>	<20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
Message-ID: <46FDEE70.6030301@dbtopas.lt>

Szak?ts Viktor wrote:
> Not because of your actual comments, but the way Harbour
> is working in this area. Honestly, who gets this? (besides you
> and Ryszard).

I think I'll get this after I'll read it very carefully and look to the 
source, but this looks really complicated from the first look.


> I'd vote for this:
> 
> - string[num] -> returns 1 char string
> - string[num] := "c" -> returns 1 char string, changes string

This is not good. Because:
    "ABC"[2,1,1,1,1,1,1,1,1,1,1]
does not gives RTE. I think current implementation ( string[num] returns 
number ) is more correct.


> What I still fail to see (my ignorance), is why can't we emulate
> everything using operator overloading?

I'm not sure what is Przemek's answer for this, by I think this blocks 
some compiler optimisation. If I overload number + number by other 
operator function, I can not optimize 1 + 2 and generate 3 instead, 
because overloaded operator could return different value and the 
programmer will expect different result.

So, implementation of xHarbour's string[num] is not possible to overload 
and return 1 char string. We need HB_COMPAT_XHB define in HVM, so some 
other technique to emulate this behaviour. We can do some
   REQUEST HB_COMPAT_XHB // or #include "xhb.ch"
and put additional "if" in HVM code to return number or 1 char string 
for string[num] if HB_COMPAT_XHB is linked in. We will have small 
overhead this way.

But this blocks usage of string[num] in Harbour's RTL. Because the 
programmer can not relay on the fact that string[num] is number.


Best regards,
Mindaugas



From harbour.01 at syenar.hu  Sat Sep 29 03:44:29 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 03:44:37 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <46FDEE70.6030301@dbtopas.lt>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>	<20070928123149.GA11820@localhost.localdomain>	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>	<20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
Message-ID: <544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>

Hi,

> This is not good. Because:
>    "ABC"[2,1,1,1,1,1,1,1,1,1,1]
> does not gives RTE. I think current implementation ( string[num]  
> returns number ) is more correct.

But why should this give an RTE?

And how can a substring of a string "become" a number? This is
unprecedented in the Clipper language.

This equals to this:
"ABC"[2][1][1][1]...
which equals to:
"ABC"[2] -> "B"
"B"[1] -> "B"
"B"[1] -> "B"
...
"B"[1] -> "B" at the end.

I think this looks more "natural" to a Clipperhead.

>> What I still fail to see (my ignorance), is why can't we emulate
>> everything using operator overloading?
>
> I'm not sure what is Przemek's answer for this, by I think this  
> blocks some compiler optimisation. If I overload number + number by  
> other operator function, I can not optimize 1 + 2 and generate 3  
> instead, because overloaded operator could return different value  
> and the programmer will expect different result.

Thanks, this looks reasonable.

> So, implementation of xHarbour's string[num] is not possible to  
> overload and return 1 char string. We need HB_COMPAT_XHB define in  
> HVM, so some other technique to emulate this behaviour. We can do some
>   REQUEST HB_COMPAT_XHB // or #include "xhb.ch"
> and put additional "if" in HVM code to return number or 1 char  
> string for string[num] if HB_COMPAT_XHB is linked in. We will have  
> small overhead this way.

Well, I don't think we'd need to add another factor which
modifies this behaviour (REQUEST) :(

> But this blocks usage of string[num] in Harbour's RTL. Because the  
> programmer can not relay on the fact that string[num] is number.

Extremely confusing. I fail to see why we should do
hidden type conversion.

The Clipper language is pretty consistent in this regard,
and now we have something which breaks all kinds of rules
at once. IMO we need to reduce variations, and I think this
extension is a big mess and will never be perfect by its
nature. As a personal opinion I'd fully drop it.

Brgds,
Viktor

From druzus at priv.onet.pl  Sat Sep 29 04:26:33 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sat Sep 29 04:26:41 2007
Subject: [Harbour] Re: [xHarbour-developers] IN / .IN.
In-Reply-To: <06f601c8025f$4e1421b0$6a00a8c0@PAUL>
References: <001301c8023e$4fd95450$55b2a8c0@homepc>
	<06f601c8025f$4e1421b0$6a00a8c0@PAUL>
Message-ID: <20070929082633.GA12269@localhost.localdomain>

On Sat, 29 Sep 2007, Paul Tucker wrote:
> > What's the groups thought about the IN operator?
> > Should we also support (or ONLY support) .IN. ?
[...]
> Let's blame Ratliff for this.  Perhaps in the pre dBase II  days, .AND. was 
> meant to be a logical operation and AND was gong to be bitwise anding of 
> values, and that before release, they dropped the bitwise operators and 
> forgot to drop the dots.  (Ok, so I completely made that up).
> fwiw - SQL has an IN operator which works perfectly well without the dots.

Paul you forgot about the most important problem with IN, HAS and LIKE
xHarbour oprtators: PP cannot recognize them and adding support
for such operators to PP breaks Clipper compatibility. To keep Clipper
compatibility I couldn't add support for IN, HAS and LIKE to new PP.
It causes that this code:

    proc main
        ? "A" IN "ABC"
    return

does not work now but this one:

    proc main
        QOUT( "A" IN "ABC" )
    return

works. The reason is very simple. For PP:

    <exp1> IN <exp2>

is not single experssion but these are 3 expressions so

    #command ? <x> => qout( <x> )

cannot work. We can change PP and add special meaning for IN
identifier so it will work like other operators so <exp1> IN <exp2>
    ? "A" IN "ABC"
will work in such case but we will introduce other problem.
Each Clipper PP rules using optional clause starting with IN keyword
will stop to work. F.e. look at this command from Cl*pper std.ch:

    #command SET ORDER TO <t> [IN <(b)>] => ordSetFocus( <t> [, <(b)>] )

If programmer will use in his code:

    SET ORDER TO tag1 IN bag1

then PP will understand "tag1 IN bag1" as single expression so it will
translate this command to:
    ordSetFocus( tag1 IN "bag1" )

It was the behavior of old PP and people quite often reported that
their Clipper code is wrongly preprocessed by xHarbour.

It's impossible to add any hacks which will help in this problem, f.e.
you cannot use first token from optional clause (IN in this example)
to stop parsing the expression because in such cause you will wrongly
parse:
    SET ORDER TO tagpref + in IN bag1

It's mathematically impossible to have operators which are valid Clipper
identifier and still have Clipper compatible PP. PP does not know anything
about operator precedence and without full grammar parser which will
respect operator precedence hard coded inside PP it's impossible to
introduce new operators without breaking compatibility if this operators
do not concatenate expressions in Clipper's PP. The main difference
between
    <exp1> HAS <exp2>
and:
    <exp1> .HAS. <exp2>

is that the second version Clipper PP preprocess as single expression
so such operator can be introduce without breaking current PP rules.
Your comments about using IN in SQL statements and AS ANY in VO have
nothing to the core of problem. If you like then you can discuss what
look nicer: LIKE or .LIKE. and what is closer to xbase spirit but the
real problem is keeping compatibility with existing code and PP rules.
So my advice: Anytime in the future you will want to introduce new
binary operator please begin with checking if:
    <exp1> <newop> <exp2>
is preprocessed by Clipper as single expression. If not then you will
have situation like with IN now when you have to revert modification
to be Clipper compatible. Besides IN, HAS and LIKE (new PP ignores
them to be Clipper compatible so only grammar parser recognize them)
we have similar compatibility problem with expressions starting with :
inside WITH OBJECT statement - it was necessary to modify PP to accept
:<id> as single expression what introduced some bad side effects.
As workaround for them I had to begin to count spaces before ":"
what is not Clipper compatible at all. Ron removed this ugly hack
from new PP so now xHarbour cannot preproces valid clipper code like:
    @ 0, 0 SAY xVar PICTURE get:pict
but the real problem was caused by introducing new unary operator ':'
use inside WITH OBJECT without respecting Clipper PP rules when it
was enough to check that in Clipper:
    ? :subcode
is not preprocessed to:
    qout( :subcode )
because in Clipper expression cannot start with ":". For IN and .IN.
you can make the same test. Just use Clipper with -p option to preprocess
this code:
    ? "A" IN "ABC"
    ? "A" .IN. "ABC"
and check which line were translated to qout( ... ) and you will have
an answer. If you will not respect this then you will always break
some valid PP rules used in Clipper code. So please keep it in mind
in the future and to not increase already introduced problems.

BTW. IMHO alternative version for $ operator as IN or .IN. is not
     necessary but for sure you will have to make sth with HAS and LIKE
     These operators are not very widely used so it can be done yet.
     Probably now it's to late to change ':' used as unary operator
     inside WITH OBJECT so we will never be able to properly preprocess
     some valid Clipper code but if you decide to clean also this then
     you have my vote.

best regards,
Przemek

ps. I'm setting CC to [x]harbour devel lists because IMHO it's important
    for future choices of [x]Harbour developers.
From harbour.01 at syenar.hu  Sat Sep 29 05:03:01 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 05:03:15 2007
Subject: [Harbour] Re: [xHarbour-developers] IN / .IN.
In-Reply-To: <20070929082633.GA12269@localhost.localdomain>
References: <001301c8023e$4fd95450$55b2a8c0@homepc>
	<06f601c8025f$4e1421b0$6a00a8c0@PAUL>
	<20070929082633.GA12269@localhost.localdomain>
Message-ID: <E2D079CC-6D48-45DC-A2C7-B6A7A0F9E85F@syenar.hu>

Hi Paul,

Before adding new operators I think it would be important
to check if there is any added value by adding them.

IN   -> $ or AScan(a,x) (depending on the operator type, which hides  
logic)
LIKE -> one function call
HAS  -> one function call
&, |, >>, etc -> one function call respectively

Since a function call is pretty common in Clipper, I
personally see no reason to choose a few of them (which
are not even exceptionally common in normal code), and
convert them to operators.

To me, this looks like if someone wanted to make Clipper
"SQL-like", just like with the extended [] operator where
someone probably wanted to emulate "C-like" syntax.

Well, let's face it, Clipper is Clipper, not SQL, not C,
so it's simply not needed (and most of the time technically
not doable in a smooth way as Przemek used to point out)
to endorse random language features from different languages,
just for the sake of it.

Or maybe it's good to save a few keypresses during programming (?),
but with a huge price to pay. "Autocomplete" in editors solves
this in a much better way. Clearer code? Well, for this we'd
need to _lessen_ the varieties of similar language constructs,
and not add new ones. For clear code c# is a good example.

So I'd strongly vote against IN or .IN.

Of course it's up to xhb to decide on their project, and
.IN. might have the advantage that we can easily add PP
support for it in Harbour, which is definitely an advantage IMO.

Brgds,
Viktor

PS: As for speculation on dBase II. I don't think they've
wanted to add bitwise operators at all. Why would they
want to do so, dBase was a database app programming language.
If they've wanted to add it so badly, they could've added
them as functions. But this didn't happen until Nantucket Tools
(which is an paid option from much later days).

On 2007.09.29., at 10:26, Przemyslaw Czerpak wrote:

> On Sat, 29 Sep 2007, Paul Tucker wrote:
>>> What's the groups thought about the IN operator?
>>> Should we also support (or ONLY support) .IN. ?
> [...]
>> Let's blame Ratliff for this.  Perhaps in the pre dBase II   
>> days, .AND. was
>> meant to be a logical operation and AND was gong to be bitwise  
>> anding of
>> values, and that before release, they dropped the bitwise  
>> operators and
>> forgot to drop the dots.  (Ok, so I completely made that up).
>> fwiw - SQL has an IN operator which works perfectly well without  
>> the dots.
>
> Paul you forgot about the most important problem with IN, HAS and LIKE
> xHarbour oprtators: PP cannot recognize them and adding support
> for such operators to PP breaks Clipper compatibility. To keep Clipper
> compatibility I couldn't add support for IN, HAS and LIKE to new PP.
> It causes that this code:
>
>     proc main
>         ? "A" IN "ABC"
>     return
>
> does not work now but this one:
>
>     proc main
>         QOUT( "A" IN "ABC" )
>     return
>
> works. The reason is very simple. For PP:
>
>     <exp1> IN <exp2>
>
> is not single experssion but these are 3 expressions so
>
>     #command ? <x> => qout( <x> )
>
> cannot work. We can change PP and add special meaning for IN
> identifier so it will work like other operators so <exp1> IN <exp2>
>     ? "A" IN "ABC"
> will work in such case but we will introduce other problem.
> Each Clipper PP rules using optional clause starting with IN keyword
> will stop to work. F.e. look at this command from Cl*pper std.ch:
>
>     #command SET ORDER TO <t> [IN <(b)>] => ordSetFocus( <t> [, <(b) 
> >] )
>
> If programmer will use in his code:
>
>     SET ORDER TO tag1 IN bag1
>
> then PP will understand "tag1 IN bag1" as single expression so it will
> translate this command to:
>     ordSetFocus( tag1 IN "bag1" )
>
> It was the behavior of old PP and people quite often reported that
> their Clipper code is wrongly preprocessed by xHarbour.
>
> It's impossible to add any hacks which will help in this problem, f.e.
> you cannot use first token from optional clause (IN in this example)
> to stop parsing the expression because in such cause you will wrongly
> parse:
>     SET ORDER TO tagpref + in IN bag1
>
> It's mathematically impossible to have operators which are valid  
> Clipper
> identifier and still have Clipper compatible PP. PP does not know  
> anything
> about operator precedence and without full grammar parser which will
> respect operator precedence hard coded inside PP it's impossible to
> introduce new operators without breaking compatibility if this  
> operators
> do not concatenate expressions in Clipper's PP. The main difference
> between
>     <exp1> HAS <exp2>
> and:
>     <exp1> .HAS. <exp2>
>
> is that the second version Clipper PP preprocess as single expression
> so such operator can be introduce without breaking current PP rules.
> Your comments about using IN in SQL statements and AS ANY in VO have
> nothing to the core of problem. If you like then you can discuss what
> look nicer: LIKE or .LIKE. and what is closer to xbase spirit but the
> real problem is keeping compatibility with existing code and PP rules.
> So my advice: Anytime in the future you will want to introduce new
> binary operator please begin with checking if:
>     <exp1> <newop> <exp2>
> is preprocessed by Clipper as single expression. If not then you will
> have situation like with IN now when you have to revert modification
> to be Clipper compatible. Besides IN, HAS and LIKE (new PP ignores
> them to be Clipper compatible so only grammar parser recognize them)
> we have similar compatibility problem with expressions starting with :
> inside WITH OBJECT statement - it was necessary to modify PP to accept
> :<id> as single expression what introduced some bad side effects.
> As workaround for them I had to begin to count spaces before ":"
> what is not Clipper compatible at all. Ron removed this ugly hack
> from new PP so now xHarbour cannot preproces valid clipper code like:
>     @ 0, 0 SAY xVar PICTURE get:pict
> but the real problem was caused by introducing new unary operator ':'
> use inside WITH OBJECT without respecting Clipper PP rules when it
> was enough to check that in Clipper:
>     ? :subcode
> is not preprocessed to:
>     qout( :subcode )
> because in Clipper expression cannot start with ":". For IN and .IN.
> you can make the same test. Just use Clipper with -p option to  
> preprocess
> this code:
>     ? "A" IN "ABC"
>     ? "A" .IN. "ABC"
> and check which line were translated to qout( ... ) and you will have
> an answer. If you will not respect this then you will always break
> some valid PP rules used in Clipper code. So please keep it in mind
> in the future and to not increase already introduced problems.
>
> BTW. IMHO alternative version for $ operator as IN or .IN. is not
>      necessary but for sure you will have to make sth with HAS and  
> LIKE
>      These operators are not very widely used so it can be done yet.
>      Probably now it's to late to change ':' used as unary operator
>      inside WITH OBJECT so we will never be able to properly  
> preprocess
>      some valid Clipper code but if you decide to clean also this then
>      you have my vote.
>
> best regards,
> Przemek
>
> ps. I'm setting CC to [x]harbour devel lists because IMHO it's  
> important
>     for future choices of [x]Harbour developers.
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at priv.onet.pl  Sat Sep 29 05:47:50 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sat Sep 29 05:47:56 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
	<20070928123149.GA11820@localhost.localdomain>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
Message-ID: <20070929094750.GB12269@localhost.localdomain>

On Sat, 29 Sep 2007, Szak?ts Viktor wrote:
> >This is not good. Because:
> >   "ABC"[2,1,1,1,1,1,1,1,1,1,1]
> >does not gives RTE. I think current implementation ( string[num]  
> >returns number ) is more correct.
> But why should this give an RTE?

Detecting typos and bugs. In multidimensional array when you have
code like: aValue[idx1,idx2,idx3,...,idxN] if array has irregular
structure it's very important do detect wrong indexing and report
RTE so programmer can fix his code before delivering to customer.
IMHO such situation like in xHarbour where this code:
    proc main()
    local a:={"ABC"}
    ? a[1,2,3,4,5,6,7,8,9,0,-1,-2,-3,-4]
    return
does not generate error is not acceptable.

> And how can a substring of a string "become" a number?

Why "substring"? Viktor this is your definition. My definition is:
[] used for string returns ASCII value of given character. It's
IMHO much more clear because if "ABCDEF"[2] returns single "B"
character then it suggests that "ABCDEF"[2,4] should return
range of characters: "BCD"

> This is unprecedented in the Clipper language.
> This equals to this:
> "ABC"[2][1][1][1]...
> which equals to:
> "ABC"[2] -> "B"
> "B"[1] -> "B"
> "B"[1] -> "B"
> ...
> "B"[1] -> "B" at the end.
> I think this looks more "natural" to a Clipperhead.

I have different feeling but probably I'm not "natural" "Clipperhead"
example ;-)
IMHO you should stop to think that [] operator can be used only for
strings. Probably the description in -ks switch can confuse users now
so I'll try to describe the problem using different example.

If you want to overload [] operator in access operation then you can
make it without any problems and you do not need any additional compiler
switches. F.e. we can use [] to access bit in numbers, <nVal>[<n>]
will return .T. if <n>-th bit is set and .F. if not.

    #include "hbclass.ch"
    create class hbNumeric
       method NumIndex operator "[]"
    endclass
    method NumIndex( idx )
    return hb_bitTest( self, idx )

and now some test code which will show the number 123 in binary form:

    proc main()
       local n:=123, i
       ? n, "-> "
       for i:=7 to 0 step -1
          ?? iif( n[i], "1", "0" )
       next
    return

Works and gives:
       123 -> 01111011

nice, isn't it? ;-)

Now I'd like to extend this functionality and I want to add support
for ASSIGN with [] operator. And here is a problem. The internal
HVM envelopes used for types like ARRAY/OBJECT and HASH are not cloned
when passing as parameter so if you will want to overload ASSIGN with []
operator for them then you can still make and it will work without any
additional compile time switches. But what will happen for types like
STRING, NUMBER, LOGICAL, DATE? Just make a test. In the above example
we change method NumIndex() to:

    method NumIndex( idx, newVal )
       if pcount() > 1
          if newVal
             return hb_bitSet( self, idx )
          else
             return hb_bitReset( self, idx )
          endif
       endif
    return hb_bitTest( self, idx )

The whole code will look like:

    #include "hbclass.ch"
    proc main()
       local n:=123, i
       ? n, "-> "
       for i:=7 to 0 step -1
          ?? iif( n[i], "1", "0" )
       next
       n[(7)]:=.t.
       n[(0)]:=.f.
       ? n, "-> "
       for i:=7 to 0 step -1
          ?? iif( n[i], "1", "0" )
       next
    return

    create class hbNumeric
       method NumIndex operator "[]"
    endclass

    method NumIndex( idx, newVal )
       if pcount() > 1
          if newVal
             return hb_bitSet( self, idx )
          else
             return hb_bitReset( self, idx )
          endif
       endif
    return hb_bitTest( self, idx )

And now let's compile it without -ks switch and execute:

    druzus:/tmp/5# hbmk -n -w -es2 t1 && ./t1
    Harbour devel build 1.1-1 Intl.
    Copyright 1999-2007, http://www.harbour-project.org/
    Compiling 't1.prg'...
    Lines 724, Functions/Procedures 3
    Generating C source output to 't1.c'... Done.

           123 -> 01111011
           123 -> 01111011

as you can see assign <num>[<idx>] does not work. But if add -ks
compile time switch then:

    druzus:/tmp/5# hbmk -n -w -es2 t1 -ks && ./t1
    Harbour devel build 1.1-1 Intl.
    Copyright 1999-2007, http://www.harbour-project.org/
    Compiling 't1.prg'...
    Lines 724, Functions/Procedures 3
    Generating C source output to 't1.c'... Done.

           123 -> 01111011
           250 -> 11111010

BINGO !!! it's working.
In summary:
    What -ks does?
        It allows to overload ASSIGN operation in indexed variables for
        types which are always cloned when passing as parameters.
    How does it make?
        It forces passing reference to value instead of value before
	[] assing operators.


> >>What I still fail to see (my ignorance), is why can't we emulate
> >>everything using operator overloading?
> >I'm not sure what is Przemek's answer for this, by I think this  
> >blocks some compiler optimisation. If I overload number + number by  
> >other operator function, I can not optimize 1 + 2 and generate 3  
> >instead, because overloaded operator could return different value  
> >and the programmer will expect different result.
> Thanks, this looks reasonable.

This is one reason and the second is that if we change the behavior
of standard operators like +, -, ... for basic types then our RTL will
stop to work so hbClass()/hbObject() will not work too. We will not
be even able to report error because error handler is also .prg function.
Full operator overloading can be implemented but it will be usable only
for users who do not use any build in Harbour functions. Do you know
such users?

> >So, implementation of xHarbour's string[num] is not possible to  
> >overload and return 1 char string. We need HB_COMPAT_XHB define in  
> >HVM, so some other technique to emulate this behaviour. We can do some
> >  REQUEST HB_COMPAT_XHB // or #include "xhb.ch"
> >and put additional "if" in HVM code to return number or 1 char  
> >string for string[num] if HB_COMPAT_XHB is linked in. We will have  
> >small overhead this way.
> Well, I don't think we'd need to add another factor which
> modifies this behaviour (REQUEST) :(
> >But this blocks usage of string[num] in Harbour's RTL. Because the  
> >programmer can not relay on the fact that string[num] is number.
> Extremely confusing. I fail to see why we should do
> hidden type conversion.

Viktor, please think a while what you've written. It means that:
    a:={"ABC"}
    ? a[1]
is "extremely confusing" because a[1] makes "hidden type conversion"
from array to string. And what about n[1] in my example above?
Yet another hidden conversion from number to logical?

> The Clipper language is pretty consistent in this regard,
> and now we have something which breaks all kinds of rules
> at once. IMO we need to reduce variations, and I think this
> extension is a big mess and will never be perfect by its
> nature. As a personal opinion I'd fully drop it.

If you ask me about adding support for <cVal>[<idx>] to HVM
then I can agree. We can leave without it. But if you talk
about dropping -ks switch then sorry but I do not agree.
IMHO it's very important functionality which also allows us
to emulate xHarbour like string behavior.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Sep 29 06:01:43 2007
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 06:01:41 2007
Subject: [Harbour] CHANGELOG: 2007-09-29 11:50 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
Message-ID: <01c8027f$Blat.v2.6.2$bd064fce$1664b1da6968@127.0.0.1>

2007-09-29 11:50 UTC+0100 Viktor Szakats (harbour.01 syenar.hu)
   * source/rdd/dbfntx/dbfntx1.c
   * source/rdd/dbfcdx/dbfcdx1.c
   * source/rdd/dbf1.c
     + Added support for _SET_DEFEXTENSIONS to RDD.
       (Przemek pls review it. I cannot send you direct mail, because 
       it bounces)
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sat Sep 29 06:38:03 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 06:38:12 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070929094750.GB12269@localhost.localdomain>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
	<20070928123149.GA11820@localhost.localdomain>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<20070929094750.GB12269@localhost.localdomain>
Message-ID: <8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>

> Detecting typos and bugs. In multidimensional array when you have
> code like: aValue[idx1,idx2,idx3,...,idxN] if array has irregular
> structure it's very important do detect wrong indexing and report
> RTE so programmer can fix his code before delivering to customer.
> IMHO such situation like in xHarbour where this code:
>     proc main()
>     local a:={"ABC"}
>     ? a[1,2,3,4,5,6,7,8,9,0,-1,-2,-3,-4]
>     return
> does not generate error is not acceptable.

Clipper doesn't support "multidimensional" array. In Clipper
the second index is simply and index on the value of the
previous one. This is cleary stated in every Clipper docs
and manuals. ( a[1,2] == a[1][2] == (a[1])[2] )

So, while I see that it could be nice if compiler could
"automagically" detect such programmer errors, I don't think
we should change basic language rules to achieve that.

Moreover: Who in his/her right mind would write such code
in real world, so that this could become such a big problem?

I expect "cChar := cString[ nPos ]" and "cString[ nPos ] := cChar"
to be used in string processing loops, not in deep app logic.
Programmers usually replace a SubStr() or Stuff() call with that,
probably to get more speed.

(and again SubStr( string, n, 1 ) _could_ well be optimized to
single pcode, doing the same, without any .prg source modification,
probably the same could be done with Stuff( string, pos, 1, c ))

>> And how can a substring of a string "become" a number?
>
> Why "substring"? Viktor this is your definition. My definition is:
> [] used for string returns ASCII value of given character. It's

Because string is string, and one character of a string is a
character. not a number. At least in Clipper. See SubStr().

> IMHO much more clear because if "ABCDEF"[2] returns single "B"
> character then it suggests that "ABCDEF"[2,4] should return
> range of characters: "BCD"

Only if someone confuses [] with maybe a SubStr() function call.

Well I can see some point here:
Old code:
	c := SubStr( string, pos, 1 )
Updated code (intended):
	c := string[ nPos ]
Updated code (mistyped):
         // because someone made a mistake when modifying the code,  
is that we want to catch?
	c := string[ pos, 1 ] // this would properly work even if s[n]  
returns 1 char string.

>> This is unprecedented in the Clipper language.
>> This equals to this:
>> "ABC"[2][1][1][1]...
>> which equals to:
>> "ABC"[2] -> "B"
>> "B"[1] -> "B"
>> "B"[1] -> "B"
>> ...
>> "B"[1] -> "B" at the end.
>> I think this looks more "natural" to a Clipperhead.
>
> I have different feeling but probably I'm not "natural" "Clipperhead"
> example ;-)
> IMHO you should stop to think that [] operator can be used only for
> strings. Probably the description in -ks switch can confuse users now
> so I'll try to describe the problem using different example.

Well, I'm actually used to the fact that [] can only be used for
arrays (and now hashes).

With this extension I can use it for strings too.

How should I think about it then?

> If you want to overload [] operator in access operation then you can
> make it without any problems and you do not need any additional  
> compiler
> ...snip...
> BINGO !!! it's working.
> In summary:
>     What -ks does?
>         It allows to overload ASSIGN operation in indexed variables  
> for
>         types which are always cloned when passing as parameters.
>     How does it make?
>         It forces passing reference to value instead of value before
> 	[] assing operators.

Thanks for explanation. Shouldn't we then call -ks something
else than "strings as arrays"?

Like "allow array assigment on all types"?

>>> and the programmer will expect different result.
>> Thanks, this looks reasonable.
>
> This is one reason and the second is that if we change the behavior
> of standard operators like +, -, ... for basic types then our RTL will
> stop to work so hbClass()/hbObject() will not work too. We will not
> be even able to report error because error handler is also .prg  
> function.
> Full operator overloading can be implemented but it will be usable  
> only
> for users who do not use any build in Harbour functions. Do you know
> such users?

Okey, I understand.

>> hidden type conversion.
>
> Viktor, please think a while what you've written. It means that:
>     a:={"ABC"}
>     ? a[1]
> is "extremely confusing" because a[1] makes "hidden type conversion"
> from array to string. And what about n[1] in my example above?
> Yet another hidden conversion from number to logical?

Of course not. Since a is an array and any element of an
array can have any type in Clipper. The given element of
the array was loaded by the programmer, so the programmer
can expect that the same value is returned.

For strings though, someone passed a string. A substring of
a string used to be a character (closest synomym in Clipper
- SubStr() - returns a 1 char string), that's why I'm saying
it is "natural". Clipper is not C, in C someone could expect
a "number", but there there is not much diff between a
char and a number anyways.

Along with you train of though, s[n] could equally return
a hexadecimal representation (or anything) of the character,
right? strange? it is. Everyone can have an opionion on that,
question is what fits better the Clipper language, and
a Clipper programmer's natural expectation.

>> The Clipper language is pretty consistent in this regard,
>> and now we have something which breaks all kinds of rules
>> at once. IMO we need to reduce variations, and I think this
>> extension is a big mess and will never be perfect by its
>> nature. As a personal opinion I'd fully drop it.
>
> If you ask me about adding support for <cVal>[<idx>] to HVM
> then I can agree. We can leave without it. But if you talk
> about dropping -ks switch then sorry but I do not agree.
> IMHO it's very important functionality which also allows us
> to emulate xHarbour like string behavior.

Okey, can we do it this way:
1) -ks stays, but with a different name (see above) and without // 
flags:s
    and without the default implementation of "string as byte array"
    -ks should only enable the alternate pcode scheme where
    assigment is possible for [] operator.
2) "string as arrays" implementation is fully done using
    overloading in xhb lib.
    I'd drop the native support for "string as array" from
    Harbour this time and leave any implementation of
    overloading (if we need to support the current one,
    we can solve this using overloading inside Harbour).
+1) Also see my SubStr( s, n, 1 ) and Stuff( s, n, 1, c )
    pcode optimization suggestion. It might help much more old
    to run a bit faster.

Did I miss something?

I cannot send you private mail, your smtp says: "500 (Trying to talk  
with myself!)"

Brgds,
Viktor

From M.Horodyski at pzuzycie.com.pl  Sat Sep 29 07:21:26 2007
From: M.Horodyski at pzuzycie.com.pl (Horodyski Marek (PZUZ))
Date: Sat Sep 29 07:21:31 2007
Subject: [Harbour] RE: Harbour Digest, Vol 11, Issue 67
Message-ID: <503AD832DBBF60469E9F807668A2F6A202846D5F@PINK.zycie.pzu>

>From: Mindaugas Kavaliauskas <dbtopas@dbtopas.lt>
>Subject: Re: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor
>	Szakats	(harbour.01 syenar.hu)

[ ... ]

>> I'd vote for this:
>> 
>> - string[num] -> returns 1 char string
>> - string[num] := "c" -> returns 1 char string, changes string
>
>This is not good. Because:
>    "ABC"[2,1,1,1,1,1,1,1,1,1,1]
>does not gives RTE. I think current implementation ( string[num]
returns number ) is more correct.

Why ?
I use "string[num] := "c" - > returns 1 char string, changes string"
from many years, and im happy about this reason.

Regards,
Marek Horodyski
From harbour.01 at syenar.hu  Sat Sep 29 08:13:03 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 08:13:14 2007
Subject: [Harbour] Finishing DEFEXT support
Message-ID: <F74380BE-D9F6-45BB-9E5D-0BC72787EB3C@syenar.hu>

Hi Przemek,

I've completed a few remaining places where _SET_DEFEXTENSIONS
was not supported in RDD code. (I've left them pending last time)

Could you take a look at it, if it seems proper?

This test code:
---
REQUEST DBFCDX
REQUEST DBFNTX

PROCEDURE Main()

    Set( _SET_DEFEXTENSIONS, .F. )

    rddSetDefault( "DBFCDX" )

    dbCreate( "table_ntx", { { "TEST", "C", 10, 0 }, { "MEMO", "M",  
10, 0 } } )
    dbUseArea( .T.,, "table_ntx" )
    dbCreateIndex( "index_ntx", "FIELD->TEST", {|| FIELD->TEST }, .F.)

    rddSetDefault( "DBFCDX" )

    dbCreate( "table_cdx", { { "TEST", "C", 10, 0 }, { "MEMO", "M",  
10, 0 } } )
    dbUseArea( .T.,, "table_cdx" )
    dbCreateIndex( "index_cdx", "FIELD->TEST", {|| FIELD->TEST }, .F.)

    RETURN
---

- will create "table*" and "index*" with no extensions (it's  
programmer's responsibility to specify different names,
     and autoopen will obviously not work this way).
- behaviour for .dbt is unchanged.
- behaviour when _SET_DEFEXTENSIONS = .T. (default) is unchanged.

The reason for this feature is to be able to use
extension-less filenames returned by system functions
(like "get_temp_filename" and friends).

Brgds,
Viktor

From ptucker at sympatico.ca  Sat Sep 29 09:47:17 2007
From: ptucker at sympatico.ca (Paul Tucker)
Date: Sat Sep 29 09:48:18 2007
Subject: [Harbour] Re: [xHarbour-developers] IN / .IN.
References: <001301c8023e$4fd95450$55b2a8c0@homepc>
	<06f601c8025f$4e1421b0$6a00a8c0@PAUL>
	<20070929082633.GA12269@localhost.localdomain>
	<E2D079CC-6D48-45DC-A2C7-B6A7A0F9E85F@syenar.hu>
Message-ID: <003201c8029f$40586690$6a00a8c0@PAUL>

Victor,

 SV> Well, let's face it, Clipper is Clipper

That sums it up nicely.

 SV> Or maybe it's good to save a few keypresses during programming (?),
 SV> but with a huge price to pay. "Autocomplete" in editors solves
 SV> this in a much better way. Clearer code? Well, for this we'd
 SV> need to _lessen_ the varieties of similar language constructs,
 SV> and not add new ones. For clear code c# is a good example.

 SV> So I'd strongly vote against IN or .IN.

 SV> Of course it's up to xhb to decide on their project, and
 SV> .IN. might have the advantage that we can easily add PP
 SV> support for it in Harbour, which is definitely an advantage IMO.

I thought our respective pre-processors had this nailed.  I did not 
appreciate the problems till Przemeks explanation.

So - this can help.  I'll go try things in the pre-pro and see what I get.

 SV> Brgds,
 SV> Viktor

 SV> PS: As for speculation on dBase II. I don't think they've
 SV> wanted to add bitwise operators at all. Why would they
 SV> want to do so, dBase was a database app programming language.
 SV> If they've wanted to add it so badly, they could've added
 SV> them as functions. But this didn't happen until Nantucket Tools
 SV> (which is an paid option from much later days).

I'm pretty sure I was bordering on sarcasm when I said that. <g>

Paul 

From harbour.01 at syenar.hu  Sat Sep 29 09:59:09 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 09:59:17 2007
Subject: [Harbour] Re: [xHarbour-developers] IN / .IN.
In-Reply-To: <003201c8029f$40586690$6a00a8c0@PAUL>
References: <001301c8023e$4fd95450$55b2a8c0@homepc>
	<06f601c8025f$4e1421b0$6a00a8c0@PAUL>
	<20070929082633.GA12269@localhost.localdomain>
	<E2D079CC-6D48-45DC-A2C7-B6A7A0F9E85F@syenar.hu>
	<003201c8029f$40586690$6a00a8c0@PAUL>
Message-ID: <69FA0101-51A6-4D97-B690-2C5D396A1EC6@syenar.hu>

Hi Paul,

> SV> Of course it's up to xhb to decide on their project, and
> SV> .IN. might have the advantage that we can easily add PP
> SV> support for it in Harbour, which is definitely an advantage IMO.
>
> I thought our respective pre-processors had this nailed.  I did not  
> appreciate the problems till Przemeks explanation.
>
> So - this can help.  I'll go try things in the pre-pro and see what  
> I get.

Okey, this would really help creating cross-compatibility.

> SV> PS: As for speculation on dBase II. I don't think they've
> SV> wanted to add bitwise operators at all. Why would they
> SV> want to do so, dBase was a database app programming language.
> SV> If they've wanted to add it so badly, they could've added
> SV> them as functions. But this didn't happen until Nantucket Tools
> SV> (which is an paid option from much later days).
>
> I'm pretty sure I was bordering on sarcasm when I said that. <g>

Taken. Better late than never. :)

Brgds,
Viktor

From druzus at priv.onet.pl  Sat Sep 29 13:12:25 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sat Sep 29 13:13:37 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
	<20070928123149.GA11820@localhost.localdomain>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<20070929094750.GB12269@localhost.localdomain>
	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>
Message-ID: <20070929171225.GA24869@localhost.localdomain>

On Sat, 29 Sep 2007, Szak?ts Viktor wrote:
> >Detecting typos and bugs. In multidimensional array when you have
> >code like: aValue[idx1,idx2,idx3,...,idxN] if array has irregular
> >structure it's very important do detect wrong indexing and report
> >RTE so programmer can fix his code before delivering to customer.
> >IMHO such situation like in xHarbour where this code:
> >    proc main()
> >    local a:={"ABC"}
> >    ? a[1,2,3,4,5,6,7,8,9,0,-1,-2,-3,-4]
> >    return
> >does not generate error is not acceptable.
> Clipper doesn't support "multidimensional" array. In Clipper
> the second index is simply and index on the value of the
> previous one. This is cleary stated in every Clipper docs
> and manuals. ( a[1,2] == a[1][2] == (a[1])[2] )

To be precis Clipper have multi node, resizeable tree structures.
But it's only terminology. Anyhow your example clearly shows why
-ks is necessary and has to pass index argument by reference.
If you do not want to introduce anomalies then if code like:
    s:="ABC"; ? a[2,1]
works then it should also work in assign operation so:
    s:="ABC"; a[2,1]:="#"; ? a
should also work. Or this time you will really change one of the
"basic language rules".
The natural implementation will not give you such possibilities.
xHarbour is good example for that. Look at this code:

    #ifndef __XHARBOUR__
    REQUEST XHB_LIB
    #endif
    proc main()
    local s:="ABC"
       ? s, s[2], s[2,1]
       s[2]:="*"
       ? s, s[2], s[2,1]
       s[2,1]:="@"
       ? s, s[2], s[2,1]
    return

When compiled by Harbour we have:
    druzus:/tmp/5# hbmk -n -w -es2 -ks t2 && ./t2
    Harbour devel build 1.1-1 Intl.
    Copyright 1999-2007, http://www.harbour-project.org/
    Compiling 't2.prg'...
    Lines 11, Functions/Procedures 1
    Generating C source output to 't2.c'... Done.

    ABC B B
    A*C * *
    A@C @ @

But if you compile it with xHarbour then you will have:
    ABC B B
    A*C * *
    Error BASE/1068  Argument error: array access Arguments: ( [ 1] = Type: C Val: A*C [ 2] = Type: N Val:          2)
    Error at ...: MAIN(9) in Module: t2.prg

It's one of the reasons why I called our emulation better then original
xHarbour implementation.

> So, while I see that it could be nice if compiler could
> "automagically" detect such programmer errors, I don't think
> we should change basic language rules to achieve that.

We have been not changed anything yet. Don't be so fast <g>

> Moreover: Who in his/her right mind would write such code
> in real world, so that this could become such a big problem?

Yes, it is, f.e.: the example which was send by Mindaugas few
days ago with dbSeek()
    dbSeek( aVal[index1, index2, ...., indexN] )
It was one indexY more then necessary but what reduced passed string
to one character but it was still working. I and some of developers
which works with me also had such problems. If you have deep "arrays"
with string inside the xHarbour behavior is nightmare to detect bugs
or typos. If you do not use indexes to string intentionally the easiest
solution is recompilation with Clipper or Harbour.

> I expect "cChar := cString[ nPos ]" and "cString[ nPos ] := cChar"
> to be used in string processing loops, not in deep app logic.
> Programmers usually replace a SubStr() or Stuff() call with that,
> probably to get more speed.

Any item type which can represent all ASCII value is good to be used
in such string manipulations. Personally I'd expect it will be number
because it's faster then one character string it can be used for string
manipulations like cVal1[i]:=cVal2[i] but also also for some other things,
f.e calculating control sums, etc. For me the fact that you expect that
it will return single character is nothing more then your habits.
I do not see any correlations with "basic language rules".

> (and again SubStr( string, n, 1 ) _could_ well be optimized to
> single pcode, doing the same, without any .prg source modification,
> probably the same could be done with Stuff( string, pos, 1, c ))

Yes, sure. And also for ASC and CHR. I even say more - all this functions
clearly define item type used in parameters. It means that compiler can
give faster code for them by optimizing group of functions together.
F.e. for ASC( SUBSTR( cVal, i, 1 ) ) it can use PCODE which returns
number (HB_P_STRPEEK) and for SUBSTR( cVal, i, 1 ) other PCODE which
returns string (HB_P_SUBSTR1).

> >>And how can a substring of a string "become" a number?
> >Why "substring"? Viktor this is your definition. My definition is:
> >[] used for string returns ASCII value of given character. It's
> Because string is string, and one character of a string is a
> character. not a number. At least in Clipper. See SubStr().

It's not an answer. You simply defined that cVal[n] is synonym of
SUBSTR( cVal, n, 1 ) (and this is the exact xHarbour behavior and
explanation why xHarbour does not generate RT errors for indexes
which are out of scope - it exaclt replicate SUBSTR() behavior and
SUBSTR(<cVal>,<exp>,1) is internally translate by compiler to
<Val>[<exp>]) but it's _your_ definition. The same as Ron's one.
For me cVal[n] should work like STRPEEK( cVal, n ). This is my
definition which is more natural for me. For you xVal[n]:=x is
the same as STUFF( cVal, n, 1, x ) but for me it should be
STRPOKE( cVal, n, x ). Seems that Ryszard like me also preferred
numbers because he implemented cVal[n] as number so I'm not alone
expecting such results. But it doesn't matter because in both
cases we are talking about our personal habits and for sure any
of us can call own preferences "basic language rules".

> >IMHO much more clear because if "ABCDEF"[2] returns single "B"
> >character then it suggests that "ABCDEF"[2,4] should return
> >range of characters: "BCD"
> Only if someone confuses [] with maybe a SubStr() function call.

Exactly, and because you are defining that "ABCDEF"[2] is the same
as SUBSTR( "ABCDEF", 2, 1 ) so why not define that "ABCDEF"[2,4]
is the same as SUBSTR( "ABCDEF", 2, 4 ) so expected results will be
"BCDE"?
At the beginning you decided that cVal[n] works like SUBSTR( cVal, n, 1 )
and all what you now expects is results of your startup choice. It was
not good or bad choice. But also it's nothing more then _your_ _own_
choice and you should not expect that other developers will prefer the
same choices. Some of them yes and some other not.

> Well I can see some point here:
> Old code:
> 	c := SubStr( string, pos, 1 )
> Updated code (intended):
> 	c := string[ nPos ]
> Updated code (mistyped):
>         // because someone made a mistake when modifying the code,  
> is that we want to catch?
> 	c := string[ pos, 1 ] // this would properly work even if s[n]  
> returns 1 char string.

When you reduce the problem to indexes used only for strings then
it's not a big issue. Unfortunately it's not real world example.

> >I have different feeling but probably I'm not "natural" "Clipperhead"
> >example ;-)
> >IMHO you should stop to think that [] operator can be used only for
> >strings. Probably the description in -ks switch can confuse users now
> >so I'll try to describe the problem using different example.
> Well, I'm actually used to the fact that [] can only be used for
> arrays (and now hashes).
> With this extension I can use it for strings too.
> How should I think about it then?

As an operator for which you can define some expected results
for any types. For strings you reduced your choices to mapping
it to SUBSTR1, STUFF1 but it's only your choice not "basic
language rule".

> >If you want to overload [] operator in access operation then you can
> >make it without any problems and you do not need any additional  
> >compiler
> >...snip...
> >BINGO !!! it's working.
> >In summary:
> >    What -ks does?
> >        It allows to overload ASSIGN operation in indexed variables  
> >for
> >        types which are always cloned when passing as parameters.
> >    How does it make?
> >        It forces passing reference to value instead of value before
> >	[] assing operators.
> Thanks for explanation. Shouldn't we then call -ks something
> else than "strings as arrays"?

I think so.

> Like "allow array assigment on all types"?

"array" will also confuse users. IMHO
"allow indexed assignment on all types" is better but here I hope
that native English speakers will help us.

> >>hidden type conversion.
> >Viktor, please think a while what you've written. It means that:
> >    a:={"ABC"}
> >    ? a[1]
> >is "extremely confusing" because a[1] makes "hidden type conversion"
> >from array to string. And what about n[1] in my example above?
> >Yet another hidden conversion from number to logical?
> Of course not. Since a is an array and any element of an
> array can have any type in Clipper. The given element of
> the array was loaded by the programmer, so the programmer
> can expect that the same value is returned.
> For strings though, someone passed a string. A substring of
> a string used to be a character (closest synomym in Clipper
> - SubStr() - returns a 1 char string), that's why I'm saying
> it is "natural". Clipper is not C, in C someone could expect
> a "number", but there there is not much diff between a
> char and a number anyways.
> Along with you train of though, s[n] could equally return
> a hexadecimal representation (or anything) of the character,
> right? strange? it is. Everyone can have an opionion on that,
> question is what fits better the Clipper language, and
> a Clipper programmer's natural expectation.

Exactly. Each of use has his own preferences.

> >If you ask me about adding support for <cVal>[<idx>] to HVM
> >then I can agree. We can leave without it. But if you talk
> >about dropping -ks switch then sorry but I do not agree.
> >IMHO it's very important functionality which also allows us
> >to emulate xHarbour like string behavior.
> Okey, can we do it this way:
> 1) -ks stays, but with a different name (see above) and without // 
> flags:s
>    and without the default implementation of "string as byte array"
>    -ks should only enable the alternate pcode scheme where
>    assigment is possible for [] operator.

It's fine for me. Current code allows to easy implement different
behavior for [] operator in all types. It does not have to be
encoded inside HVM. We only need -ks or similar compile time switch.

> 2) "string as arrays" implementation is fully done using
>    overloading in xhb lib.
>    I'd drop the native support for "string as array" from
>    Harbour this time and leave any implementation of
>    overloading (if we need to support the current one,
>    we can solve this using overloading inside Harbour).

OK.

> +1) Also see my SubStr( s, n, 1 ) and Stuff( s, n, 1, c )
>    pcode optimization suggestion. It might help much more old
>    to run a bit faster.

I keep it in my mind, also with many other more complex optimizations.
The problem is only with spare time when I can add them. I have to
sleep somewhere works on my business jobs and I'd like to find time
to finish MT mode.

> Did I miss something?
> I cannot send you private mail, your smtp says: "500 (Trying to talk  
> with myself!)"

Probably sth wrong with my email account but it's out of my control.
It's probably the reason why I'm receiving only about 25% of mails
from this list.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Sep 29 14:21:52 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 14:28:41 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070929171225.GA24869@localhost.localdomain>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>
	<20070928123149.GA11820@localhost.localdomain>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<20070929094750.GB12269@localhost.localdomain>
	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>
	<20070929171225.GA24869@localhost.localdomain>
Message-ID: <84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>

Hey Przemek,

> To be precis Clipper have multi node, resizeable tree structures.
> But it's only terminology. Anyhow your example clearly shows why
> -ks is necessary and has to pass index argument by reference.
> If you do not want to introduce anomalies then if code like:
>     s:="ABC"; ? a[2,1]
> works then it should also work in assign operation so:
>     s:="ABC"; a[2,1]:="#"; ? a
> should also work. Or this time you will really change one of the
> "basic language rules".
> The natural implementation will not give you such possibilities.
> xHarbour is good example for that. Look at this code:
>
>     #ifndef __XHARBOUR__
>     REQUEST XHB_LIB
>     #endif
>     proc main()
>     local s:="ABC"
>        ? s, s[2], s[2,1]
>        s[2]:="*"
>        ? s, s[2], s[2,1]
>        s[2,1]:="@"
>        ? s, s[2], s[2,1]
>     return

If we keep the array analogy, last line should be: A@C @ @

> When compiled by Harbour we have:
>     druzus:/tmp/5# hbmk -n -w -es2 -ks t2 && ./t2
>     Harbour devel build 1.1-1 Intl.
>     Copyright 1999-2007, http://www.harbour-project.org/
>     Compiling 't2.prg'...
>     Lines 11, Functions/Procedures 1
>     Generating C source output to 't2.c'... Done.
>
>     ABC B B
>     A*C * *
>     A@C @ @

This seems to work as expected.

To be consistent though, I'd expect this to work too:
s := "ABC"
c := s[1]
s[1] := c
? s // -> "ABC"

Meaning that c is a 1 char string, not a number.
(and no, the solution is not that s[2] := should accept
a number :)

> But if you compile it with xHarbour then you will have:
>     ABC B B
>     A*C * *
>     Error BASE/1068  Argument error: array access Arguments: ( [ 1]  
> = Type: C Val: A*C [ 2] = Type: N Val:          2)
>     Error at ...: MAIN(9) in Module: t2.prg
>
> It's one of the reasons why I called our emulation better then  
> original
> xHarbour implementation.

This is definitely wrong.

>> Moreover: Who in his/her right mind would write such code
>> in real world, so that this could become such a big problem?
>
> Yes, it is, f.e.: the example which was send by Mindaugas few
> days ago with dbSeek()
>     dbSeek( aVal[index1, index2, ...., indexN] )
> It was one indexY more then necessary but what reduced passed string
> to one character but it was still working. I and some of developers
> which works with me also had such problems. If you have deep "arrays"
> with string inside the xHarbour behavior is nightmare to detect bugs
> or typos. If you do not use indexes to string intentionally the  
> easiest
> solution is recompilation with Clipper or Harbour.

Granted, this is ugly, but I can tell you a hundred more
ugly bugs which are not caught by the Clipper (and not
even Harbour) compiler. I don't think we should make
detecting wierd programming errors a higher priority than
consistent language behviour.

> Any item type which can represent all ASCII value is good to be used
> in such string manipulations. Personally I'd expect it will be number
> because it's faster then one character string it can be used for  
> string
> manipulations like cVal1[i]:=cVal2[i] but also also for some other  
> things,
> f.e calculating control sums, etc. For me the fact that you expect  
> that
> it will return single character is nothing more then your habits.
> I do not see any correlations with "basic language rules".

You say that you expect that the result of s[n] will be used
as an argument to ASC(). This might be true, but also might
not be true. I have tons of loops where I'm not using ASC()
on the SubStr( s, n, 1 ) result, so if I wanted to use this
implementation I'd have to Chr() the result. Which one is
better in this respect?

The driving moment here IMO should be the s[n] is mainly
used as a supposedly faster synonym for SubStr( s, n, 1 ),
which does return a 1 char string.

If we want to optimize ASC()/CHR() we can always add it as
a special pcode.

In case there is no agreement I'd vote to remove any built-in
logic from Harbour and let the compatibility layer (or the
app-level operator overloading code) decide about the workings.
Moreover I'd prefer to do this, even if we'd agree on this detail.

Small personal statistics: In my framework code, which is a
pretty SubStr() intensive code, I use ASC() around SUBSTR()
in _15%_ of cases. So the usage is not very typical. This
means that if I wanted to use the advantage of s[n] in my
code with the current implementation, I'd have to wrap 85%
of calls around Chr(), while I would have to remove ASC()
in the rest of cases. This (roughly) seems like a bad deal,
in development time and also in final performance.

>> (and again SubStr( string, n, 1 ) _could_ well be optimized to
>> single pcode, doing the same, without any .prg source modification,
>> probably the same could be done with Stuff( string, pos, 1, c ))
>
> Yes, sure. And also for ASC and CHR. I even say more - all this  
> functions
> clearly define item type used in parameters. It means that compiler  
> can
> give faster code for them by optimizing group of functions together.
> F.e. for ASC( SUBSTR( cVal, i, 1 ) ) it can use PCODE which returns
> number (HB_P_STRPEEK) and for SUBSTR( cVal, i, 1 ) other PCODE which
> returns string (HB_P_SUBSTR1).

Even better :)

>>>> And how can a substring of a string "become" a number?
>>> Why "substring"? Viktor this is your definition. My definition is:
>>> [] used for string returns ASCII value of given character. It's
>> Because string is string, and one character of a string is a
>> character. not a number. At least in Clipper. See SubStr().
>
> It's not an answer. You simply defined that cVal[n] is synonym of
> SUBSTR( cVal, n, 1 ) (and this is the exact xHarbour behavior and
> explanation why xHarbour does not generate RT errors for indexes
> which are out of scope - it exaclt replicate SUBSTR() behavior and
> SUBSTR(<cVal>,<exp>,1) is internally translate by compiler to
> <Val>[<exp>]) but it's _your_ definition. The same as Ron's one.

I don't know what Ron's definition is. I didn't say to
_replicate_ SubStr() with s[n]. What I'm saying is that we
should not change such _fundamental_ property as the returned
var _type_. Returning a number as a substring is simply
not Clipper-like.

You're right there are a dozen more implementation details
which can be debated here. That's why I feel it more and more
that Harbour should be no judge here, just give the full
VM infrastructure for any implementations.

> For me cVal[n] should work like STRPEEK( cVal, n ). This is my
> definition which is more natural for me. For you xVal[n]:=x is
> the same as STUFF( cVal, n, 1, x ) but for me it should be
> STRPOKE( cVal, n, x ). Seems that Ryszard like me also preferred
> numbers because he implemented cVal[n] as number so I'm not alone
> expecting such results. But it doesn't matter because in both
> cases we are talking about our personal habits and for sure any
> of us can call own preferences "basic language rules".

Would be good to hear other opinions. You and Ryszard
are C gurus, might be (I don't know) that's why you feel
this behaviour preferred, even if the behaviour resembles
much more to C than to Clipper.

>>> IMHO much more clear because if "ABCDEF"[2] returns single "B"
>>> character then it suggests that "ABCDEF"[2,4] should return
>>> range of characters: "BCD"
>> Only if someone confuses [] with maybe a SubStr() function call.
>
> Exactly, and because you are defining that "ABCDEF"[2] is the same
> as SUBSTR( "ABCDEF", 2, 1 ) so why not define that "ABCDEF"[2,4]
> is the same as SUBSTR( "ABCDEF", 2, 4 ) so expected results will be
> "BCDE"?

No way. I'm not defining s[n] _as_ SubStr(), pls don't try to paint
such intentions from my side. What I'm saying is that typical usage
of s[n] will be converting SubStr() to it. No one with a few days
of programming experience would confuse an array operator with an
function call argument enclosure. What you say never even crossed
my mind.

> At the beginning you decided that cVal[n] works like SUBSTR( cVal,  
> n, 1 )
> and all what you now expects is results of your startup choice. It was
> not good or bad choice. But also it's nothing more then _your_ _own_
> choice and you should not expect that other developers will prefer the
> same choices. Some of them yes and some other not.

Again pls don't try to exaggerate my analogy between s[n] and SubStr().
This is by _far_ not a 1-1 analogy. All I say is, SubStr() will be
converted to s[n] is most cases, and we should at least keep the type
of the return value. Plus that _hidden_ type conversion is not something
existing or expected in Clipper. Still, one's milage may vary, probably.

>> Well I can see some point here:
>> Old code:
>> 	c := SubStr( string, pos, 1 )
>> Updated code (intended):
>> 	c := string[ nPos ]
>> Updated code (mistyped):
>>         // because someone made a mistake when modifying the code,
>> is that we want to catch?
>> 	c := string[ pos, 1 ] // this would properly work even if s[n]
>> returns 1 char string.
>
> When you reduce the problem to indexes used only for strings then
> it's not a big issue. Unfortunately it's not real world example.

I'd be glad to see a real world one, but the dbSeek() example
you wrote is even less typical IMO.

>>> so I'll try to describe the problem using different example.
>> Well, I'm actually used to the fact that [] can only be used for
>> arrays (and now hashes).
>> With this extension I can use it for strings too.
>> How should I think about it then?
>
> As an operator for which you can define some expected results
> for any types. For strings you reduced your choices to mapping
> it to SUBSTR1, STUFF1 but it's only your choice not "basic
> language rule".

Okey, I've not got this part.

>>> If you want to overload [] operator in access operation then you can
>>> make it without any problems and you do not need any additional
>>> compiler
>>> ...snip...
>>> BINGO !!! it's working.
>>> In summary:
>>>    What -ks does?
>>>        It allows to overload ASSIGN operation in indexed variables
>>> for
>>>        types which are always cloned when passing as parameters.
>>>    How does it make?
>>>        It forces passing reference to value instead of value before
>>> 	[] assing operators.
>> Thanks for explanation. Shouldn't we then call -ks something
>> else than "strings as arrays"?
>
> I think so.
>
>> Like "allow array assigment on all types"?
>
> "array" will also confuse users. IMHO
> "allow indexed assignment on all types" is better but here I hope
> that native English speakers will help us.

Yes, not "array". Your definition looks good to me.
(maybe "array operator" instead of "indexed assigment",
while it's not that perfect, maybe more ppl could figure
what it is all about, but for me either is perfect).

>> Okey, can we do it this way:
>> 1) -ks stays, but with a different name (see above) and without //
>> flags:s
>>    and without the default implementation of "string as byte array"
>>    -ks should only enable the alternate pcode scheme where
>>    assigment is possible for [] operator.
>
> It's fine for me. Current code allows to easy implement different
> behavior for [] operator in all types. It does not have to be
> encoded inside HVM. We only need -ks or similar compile time switch.

Ok, good. "-ks" itself can stay, just with new description
and inner workings. I'm sure everyone will now remember -ks :)

>> +1) Also see my SubStr( s, n, 1 ) and Stuff( s, n, 1, c )
>>    pcode optimization suggestion. It might help much more old
>>    to run a bit faster.
>
> I keep it in my mind, also with many other more complex optimizations.
> The problem is only with spare time when I can add them. I have to
> sleep somewhere works on my business jobs and I'd like to find time
> to finish MT mode.

Przemek, don't take this anywhere near as a feature "order" or anything.
If you have time, when you have time, implement it, if not you,
maybe someone else will do it, or worst case it will stay this way,
but Harbour would still function properly.

Thanks.

Brgds,
Viktor



From druzus at priv.onet.pl  Sat Sep 29 15:32:58 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sat Sep 29 15:33:10 2007
Subject: [Harbour] Finishing DEFEXT support
Message-ID: <20070929193258.GA26082@localhost.localdomain>

Szak?ts Viktor harbour.01 at syenar.hu Sat Sep 29 08:13:03 EDT 2007
[...]

I haven't received this message but I can see it in Harbour mailing
list archive so I can answer.

The modifications is technically correct and it will work.
Anyhow programmer should be careful with this set.
Some RDD may need valid extension to recognize file type format
so disabling extensions may break them. In DBF* RDDs this SET
is intentionally ignored for MEMO files and production indexes
to avoid name conflicts.

But we have other problem with hbcompat.ch - you moved this file
from harbour/include directory to harbour/contrib/xhb/directory.
It means that TIP library cannot be longer compiled. It has to be
fixed because it broke some of standard build scripts.
IMHO if we are talking about common source code for Harbour and
xHarbour then both compilers should have header file with the
same name in both projects (so xhb.ch is not good choice because
it will look strange for xHarbour developers that they have to
include xhb.ch to enable Harbour extensions) inside main include
directory. IMHO hbcompat.ch was a good choice for that.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Sep 29 16:02:23 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 16:02:33 2007
Subject: [Harbour] Finishing DEFEXT support
In-Reply-To: <20070929193258.GA26082@localhost.localdomain>
References: <20070929193258.GA26082@localhost.localdomain>
Message-ID: <42236D53-217F-4C1B-B7BC-1D1CA9BB9A14@syenar.hu>

> The modifications is technically correct and it will work.
> Anyhow programmer should be careful with this set.
> Some RDD may need valid extension to recognize file type format
> so disabling extensions may break them. In DBF* RDDs this SET
> is intentionally ignored for MEMO files and production indexes
> to avoid name conflicts.

Thanks. I agree with your points.

> But we have other problem with hbcompat.ch - you moved this file
> from harbour/include directory to harbour/contrib/xhb/directory.
> It means that TIP library cannot be longer compiled. It has to be
> fixed because it broke some of standard build scripts.
> IMHO if we are talking about common source code for Harbour and
> xHarbour then both compilers should have header file with the
> same name in both projects (so xhb.ch is not good choice because
> it will look strange for xHarbour developers that they have to
> include xhb.ch to enable Harbour extensions) inside main include
> directory. IMHO hbcompat.ch was a good choice for that.

I saw that, but I think we should resolve it as a lib
dependency problem. TIP depends on xhb lib features, so we
need to somehow resolve this problem.

We can leave hbcompat.ch in core include, but the content
should be moved to xhb lib, if we want to do it properly,
so either way xhb.ch should be accessible by TIP, directly
or through hbcompat.ch.

In the future more and more libs can depend on each other
(or on xhb lib).

How to solve this dependency?

Brgds,
Viktor

From dbtopas at dbtopas.lt  Sat Sep 29 17:13:48 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Sat Sep 29 17:14:40 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>	<20070928123149.GA11820@localhost.localdomain>	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>	<20070928200004.GA9026@localhost.localdomain>	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
Message-ID: <46FEC00C.4040302@dbtopas.lt>

>> This is not good. Because:
>>    "ABC"[2,1,1,1,1,1,1,1,1,1,1]
>> does not gives RTE. I think current implementation ( string[num] 
>> returns number ) is more correct.
> 
> But why should this give an RTE?
> 
> And how can a substring of a string "become" a number? This is
> unprecedented in the Clipper language.
> 
> This equals to this:
> "ABC"[2][1][1][1]...
> which equals to:
> "ABC"[2] -> "B"
> "B"[1] -> "B"
> "B"[1] -> "B"
> ...
> "B"[1] -> "B" at the end.
> 
> I think this looks more "natural" to a Clipperhead.

I also think it's more natural to think that string is array of 
characters, but not array of characters' ASCII numbers. But the problem 
is that array's item (i.e. string[num]) is array itself ( string of 1 
element ). So, I do not get RTE if additional indexes is passed to 
access array. I've already used to see the bad side of it. I will just 
repeat my previous example, it's possible you've not get one:

----------------
The same problem for me after I've changed in my source:
    aArray := {{key1, value1}, {key2, value2}, ...}
to
    aKey := {key1, key2, ...}
    aValue := {value1, value2, ...}

In one place in a loop I left my source unchanged:
    FOR nI := 1 TO LEN(aKey)
       DBSEEK(aKey[nI, 1])  // was aArray[nI, 1] should be aKey[nI]
       ...
    NEXT
The seek was made only for the first char of key and depending on 
database the results were wrong, but it was was not easy to find the 
reason.
----------------

So, if string's item is a number, the additional indexing of number will 
give RTE and the bug can be easy detected.


Best regards,
Mindaugas
From harbour.01 at syenar.hu  Sat Sep 29 17:49:21 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Sep 29 17:49:29 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <46FEC00C.4040302@dbtopas.lt>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>	<20070928123149.GA11820@localhost.localdomain>	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>	<20070928200004.GA9026@localhost.localdomain>	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<46FEC00C.4040302@dbtopas.lt>
Message-ID: <1EAC3BCE-3529-4CCE-B5CB-711B0F672833@syenar.hu>

Hi Mindaugas,

> I also think it's more natural to think that string is array of  
> characters, but not array of characters' ASCII numbers. But the  
> problem is that array's item (i.e. string[num]) is array itself  
> ( string of 1 element ). So, I do not get RTE if additional indexes  
> is passed to access array. I've already used to see the bad side of  
> it. I will just repeat my previous example, it's possible you've  
> not get one:
>
> ----------------
> The same problem for me after I've changed in my source:
>    aArray := {{key1, value1}, {key2, value2}, ...}
> to
>    aKey := {key1, key2, ...}
>    aValue := {value1, value2, ...}
>
> In one place in a loop I left my source unchanged:
>    FOR nI := 1 TO LEN(aKey)
>       DBSEEK(aKey[nI, 1])  // was aArray[nI, 1] should be aKey[nI]
>       ...
>    NEXT
> The seek was made only for the first char of key and depending on  
> database the results were wrong, but it was was not easy to find  
> the reason.
> ----------------
>
> So, if string's item is a number, the additional indexing of number  
> will give RTE and the bug can be easy detected.

Good example, thanks for it.

Well, as we've discussed with Przemek, it seems the best
will be to lay the infrastructure in VM for all possible
implementations (via -ks switch, #pragma synonym and
operator overloading), and leave the decision on the
implementation details either to the app or lib developer.

This way Harbour stays fully Clipper compatible and we
avoid telling the final word on this feature this time,
as it seems there is no "fit for all" solution.

Some would call this an "open" solution.

As an aside (and not wanting to push this topic), I
think the Clipper language would have a much better way
to avoid this and hundreds of similar bugs; and this is
strong typing.

Brgds,
Viktor

From mpaliwoda at interia.pl  Sun Sep 30 04:48:13 2007
From: mpaliwoda at interia.pl (Marek Paliwoda)
Date: Sun Sep 30 04:48:22 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <1EAC3BCE-3529-4CCE-B5CB-711B0F672833@syenar.hu>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>	<20070928123149.GA11820@localhost.localdomain>	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>	<20070928200004.GA9026@localhost.localdomain>	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>	<46FDEE70.6030301@dbtopas.lt>	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>	<46FEC00C.4040302@dbtopas.lt>
	<1EAC3BCE-3529-4CCE-B5CB-711B0F672833@syenar.hu>
Message-ID: <46FF62CD.5090204@interia.pl>

Hi All,

Szak?ts Viktor wrote :
> Well, as we've discussed with Przemek, it seems the best
> will be to lay the infrastructure in VM for all possible
> implementations (via -ks switch, #pragma synonym and
> operator overloading), and leave the decision on the
> implementation details either to the app or lib developer.
> 
> This way Harbour stays fully Clipper compatible and we
> avoid telling the final word on this feature this time,
> as it seems there is no "fit for all" solution.
> 
> Some would call this an "open" solution.
> 
> As an aside (and not wanting to push this topic), I
> think the Clipper language would have a much better way
> to avoid this and hundreds of similar bugs; and this is
> strong typing.

I didn't follow the whole discussion about using [] for
strings (too many posts and very little free time) so I
am not in a position to say anything about its strength
or weakness.

What I can say is that I do not like this "feature" at
all in a language like Clipper is. To me it is more or
less "confusing" and brings more problems when I make
programming erros, then it gives advantages.

Also, I don't think many other "VM oriented" languages
allow to do this. At least I think that JavaScript, Lua,
C# and VB.NET do not allow this "feature". They all use
functions instead of indexed access. I'd say that this is
"a general" trend and now Harbour "breaks" it. IMO.

-- 

     Marek Paliwoda
mpaliwoda at interia pl



----------------------------------------------------------------------
Jak skompromitowac Wisniewskiego? 
Zobacz >>> http://link.interia.pl/f1be7

From dbtopas at dbtopas.lt  Sun Sep 30 06:32:45 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Sun Sep 30 06:33:38 2007
Subject: [Harbour] Re: [xHarbour-developers] IN / .IN.
In-Reply-To: <20070929082633.GA12269@localhost.localdomain>
References: <001301c8023e$4fd95450$55b2a8c0@homepc>	<06f601c8025f$4e1421b0$6a00a8c0@PAUL>
	<20070929082633.GA12269@localhost.localdomain>
Message-ID: <46FF7B4D.1060502@dbtopas.lt>

Przemyslaw Czerpak wrote:
>      Probably now it's to late to change ':' used as unary operator
>      inside WITH OBJECT so we will never be able to properly preprocess
>      some valid Clipper code but if you decide to clean also this then
>      you have my vote.


Hello,

what are alternatives for unary ':'? Should we completely drop WITH 
OBJECT or just change ':' syntax?

Best regards,
Mindaugas
From dbtopas at dbtopas.lt  Sun Sep 30 06:37:45 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Sun Sep 30 06:38:35 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070929094750.GB12269@localhost.localdomain>
References: <01c801b5$Blat.v2.6.2$fee29b52$958265173e0@127.0.0.1>	<20070928123149.GA11820@localhost.localdomain>	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>	<20070928200004.GA9026@localhost.localdomain>	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>	<46FDEE70.6030301@dbtopas.lt>	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<20070929094750.GB12269@localhost.localdomain>
Message-ID: <46FF7C79.70100@dbtopas.lt>

Przemyslaw Czerpak wrote:
>     What -ks does?
>         It allows to overload ASSIGN operation in indexed variables for
>         types which are always cloned when passing as parameters.
>     How does it make?
>         It forces passing reference to value instead of value before
> 	[] assing operators.

Hi,


what is wrong (speed of execution, Clipper compatibility, etc) if we 
always use -ks in compiler and always push a reference into stack?


Best regards,
Mindaugas

From druzus at priv.onet.pl  Sun Sep 30 06:49:17 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sun Sep 30 06:49:25 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>
References: <20070928123149.GA11820@localhost.localdomain>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<20070929094750.GB12269@localhost.localdomain>
	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>
	<20070929171225.GA24869@localhost.localdomain>
	<84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>
Message-ID: <20070930104917.GA21844@localhost.localdomain>

On Sat, 29 Sep 2007, Szak?ts Viktor wrote:
> In case there is no agreement I'd vote to remove any built-in
> logic from Harbour and let the compatibility layer (or the
> app-level operator overloading code) decide about the workings.
> Moreover I'd prefer to do this, even if we'd agree on this detail.

Me too. -ks switch gives programmer the possibilities to implement
the version he prefer. We do not need it in HVM. In XHB lib we already
emulated xHarbour behavior so after REQUEST XHB_LIB in Harbour code
it's possible to use [] for strings just like in xHarbour and AFAIK
it works in all cases.
XHB_LIB lib also emulates using one character length strings as number
in math operations so after
    REQUEST XHB_LIB
it's possible to make:
    ? "A" + 10

but I suggest to not use this "feature".

> Small personal statistics: In my framework code, which is a
> pretty SubStr() intensive code, I use ASC() around SUBSTR()
> in _15%_ of cases. So the usage is not very typical. This
> means that if I wanted to use the advantage of s[n] in my
> code with the current implementation, I'd have to wrap 85%
> of calls around Chr(), while I would have to remove ASC()
> in the rest of cases. This (roughly) seems like a bad deal,
> in development time and also in final performance.

I'm not surprised with results for existing Clipper code but probably
if you analyze your algorithms then you will find that this 85% of cases
can be divided for situations when you need strict character value and
when you need _ANY_ item type to hold information about character during
string manipulation so final results may look like:
    15% - strict number
    15% - strict character
    70% - any item type
IMHO such statistics are closer to real world.

If we'll agree that we should remove from HVM HB_COMPAT_XHB definitions
used for indexed strings then we will still have few others used in the
following operations:

    <hash1> + <hash2>   => <hash_union>
    <hash1> - <hash2>   => <hash_remove>
    <hash1> - <hashkey> => <hash_without_hashkey>

    <hashpair> $ <hash> => <lIncluded>
    <hashkey> $ <hash>  => <lIncluded>
    <item> $ <array>    => <lIncluded>

all these operators are emulated in XHB_LIB so they can be removed 
and we can still keep xHarbour compatibility. The question is if we
want to keep some of them in standard Harbour build or not.
Personally I think that
    <hashkey> $ <hash>  => <lIncluded>
should be allowed. It's very important operations for hashes and
very often used so IMHO standard HVM should support it.
If you want then we can implement separated PCODE for this operation
and add new compiler switch which will allow to use $ for hashes and/or
arrays.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Sep 30 07:06:11 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 30 07:06:21 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070930104917.GA21844@localhost.localdomain>
References: <20070928123149.GA11820@localhost.localdomain>
	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>
	<20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<20070929094750.GB12269@localhost.localdomain>
	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>
	<20070929171225.GA24869@localhost.localdomain>
	<84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>
	<20070930104917.GA21844@localhost.localdomain>
Message-ID: <9A0F2274-F5DB-401E-B389-448B65DCEF15@syenar.hu>

Hi Przemek,

> If we'll agree that we should remove from HVM HB_COMPAT_XHB  
> definitions
> used for indexed strings then we will still have few others used in  
> the
> following operations:
>
>     <hash1> + <hash2>   => <hash_union>
>     <hash1> - <hash2>   => <hash_remove>
>     <hash1> - <hashkey> => <hash_without_hashkey>
>
>     <hashpair> $ <hash> => <lIncluded>
>     <hashkey> $ <hash>  => <lIncluded>
>     <item> $ <array>    => <lIncluded>
>
> all these operators are emulated in XHB_LIB so they can be removed
> and we can still keep xHarbour compatibility. The question is if we
> want to keep some of them in standard Harbour build or not.
> Personally I think that
>     <hashkey> $ <hash>  => <lIncluded>

Agree with this one only and to remove the rest.

> should be allowed. It's very important operations for hashes and
> very often used so IMHO standard HVM should support it.
> If you want then we can implement separated PCODE for this operation
> and add new compiler switch which will allow to use $ for hashes  
> and/or
> arrays.

I don't think this is necessary, I'd vote to keep it simple.

Brgds,
Viktor

From druzus at priv.onet.pl  Sun Sep 30 07:13:11 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sun Sep 30 07:13:18 2007
Subject: [Harbour] Re: [xHarbour-developers] IN / .IN.
In-Reply-To: <46FF7B4D.1060502@dbtopas.lt>
References: <001301c8023e$4fd95450$55b2a8c0@homepc>
	<06f601c8025f$4e1421b0$6a00a8c0@PAUL>
	<20070929082633.GA12269@localhost.localdomain>
	<46FF7B4D.1060502@dbtopas.lt>
Message-ID: <20070930111311.GB21844@localhost.localdomain>

On Sun, 30 Sep 2007, Mindaugas Kavaliauskas wrote:
> Przemyslaw Czerpak wrote:
> >     Probably now it's to late to change ':' used as unary operator
> >     inside WITH OBJECT so we will never be able to properly preprocess
> >     some valid Clipper code but if you decide to clean also this then
> >     you have my vote.
> Hello,
> what are alternatives for unary ':'? Should we completely drop WITH 
> OBJECT or just change ':' syntax?

We do not have to drop WITH OBJECT. We only need other unary operator
which will not force to change Clipper compatible PP rules. If you test
in Clipper:
    ? :var
then you will find that it's not preprocessed to:
    qout( :var )
Instead of new unary operator we can also use some pseudo operator
or function for WITH OBJECT value. We need sth what will be preprocessed
in above example and will not break some other constructions f.e. '@:'
looks nice but Class(y) already uses it and we will have strange code with
double @ (@@) when someone will want to pass WITH OBJECT item by reference.
Maybe '.' used as synonym of WITH OBJECT value so we will have '.:', f.e.:
    ? .:var
Anyhow I do not want to touch it if it will not be synced with xHarbour
to not increase the compatibility problems.

best regards,
Przemek
From dbtopas at dbtopas.lt  Sun Sep 30 07:43:55 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Sun Sep 30 07:44:45 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070930104917.GA21844@localhost.localdomain>
References: <20070928123149.GA11820@localhost.localdomain>	<7213D2F9-B2D3-4E02-801A-1E600024AF0D@syenar.hu>	<20070928200004.GA9026@localhost.localdomain>	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>	<46FDEE70.6030301@dbtopas.lt>	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>	<20070929094750.GB12269@localhost.localdomain>	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>	<20070929171225.GA24869@localhost.localdomain>	<84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>
	<20070930104917.GA21844@localhost.localdomain>
Message-ID: <46FF8BFB.4070203@dbtopas.lt>

Przemyslaw Czerpak wrote:
> If we'll agree that we should remove from HVM HB_COMPAT_XHB definitions
> used for indexed strings then we will still have few others used in the
> following operations:
> 
>     <hash1> + <hash2>   => <hash_union>
>     <hash1> - <hash2>   => <hash_remove>
>     <hash1> - <hashkey> => <hash_without_hashkey>
> 
>     <hashpair> $ <hash> => <lIncluded>
>     <hashkey> $ <hash>  => <lIncluded>
>     <item> $ <array>    => <lIncluded>
> 
> all these operators are emulated in XHB_LIB so they can be removed 
> and we can still keep xHarbour compatibility. The question is if we
> want to keep some of them in standard Harbour build or not.
> Personally I think that
>     <hashkey> $ <hash>  => <lIncluded>
> should be allowed. It's very important operations for hashes and
> very often used so IMHO standard HVM should support it.
> If you want then we can implement separated PCODE for this operation
> and add new compiler switch which will allow to use $ for hashes and/or
> arrays.

Hello,


I see two of them usefull and clear:
     <hashkey> $ <hash>  => <lIncluded>
     <item> $ <array>    => <lIncluded>

The last one is not compatible with Clipper, so perhaps we will not 
agree on adding it to Harbour.

I think we should not add compiler switch, it make things complicated.


Sometimes I really wonder how much we can extend Clipper. Extensions are 
good, compatibility also. Where is the limit? The most common example of 
this is ADEL(). Even in Clipper it was very annoying to write:
    ADEL(aI, nI)
    ASIZE(aI, LEN(aI) - 1)
and I found xHarbour's
    ADEL(aI, nI, .T.)
really useful and it does not break compatibility. The same but not so 
annoying (because rare used) for AINS.

Of cause, every extension should be selected very well before applying 
it, and I'm strongly against STR(nI,,, .T.), because it does not looks 
natural: second parameter is meaningless, function is often used in 
index key and indexes will be not compatible if this extension is used, etc.


Best regards,
Mindaugas
From druzus at priv.onet.pl  Sun Sep 30 10:47:36 2007
From: druzus at priv.onet.pl (Przemyslaw Czerpak)
Date: Sun Sep 30 10:49:59 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <46FF8BFB.4070203@dbtopas.lt>
References: <20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<20070929094750.GB12269@localhost.localdomain>
	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>
	<20070929171225.GA24869@localhost.localdomain>
	<84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>
	<20070930104917.GA21844@localhost.localdomain>
	<46FF8BFB.4070203@dbtopas.lt>
Message-ID: <20070930144736.GC21844@localhost.localdomain>

On Sun, 30 Sep 2007, Mindaugas Kavaliauskas wrote:
> Hello,
> I see two of them usefull and clear:
>     <hashkey> $ <hash>  => <lIncluded>
>     <item> $ <array>    => <lIncluded>
> The last one is not compatible with Clipper, so perhaps we will not 
> agree on adding it to Harbour.

I have nothing against though <item> $ <array> is used much more seldom
when you have hashes because you stop using arrays for such things - just
simply hashes are much more efficient and <hashkey> $ <hash> is much
faster then <item> $ <array>.

> I think we should not add compiler switch, it make things complicated.

Complication is bad thing but if generated PCODE can be used with
any version of HVM then it's acceptable for me. For sure I'll add
new -k<?> switch to cover some optimizations which breaks strict
Clipper compatibility but are safe if code does not depend on some
side effects of Clipper implementation or RT errors.
BTW I'll add some #pragmas to control -k? switches from .prg code soon.

> Sometimes I really wonder how much we can extend Clipper. Extensions are 
> good, compatibility also. Where is the limit? The most common example of 
> this is ADEL(). Even in Clipper it was very annoying to write:
>    ADEL(aI, nI)
>    ASIZE(aI, LEN(aI) - 1)
> and I found xHarbour's
>    ADEL(aI, nI, .T.)
> really useful and it does not break compatibility. The same but not so 
> annoying (because rare used) for AINS.

As I said IMHO changing standard function parameters makes backward
portability of .prg code harder. For normal code PP can resolve the
problem but if such extensions are used in macros then the code is
in practice unportable. I think that the best choice is adding HB_AADD()
and HB_AINS() to core code. If some will really want to use extended
AINS() and ADEL() also in macros then he can add to his code:

#pragma begindump
   HB_FUNC_EXTERN( HB_AINS );
   HB_FUNC_EXTERN( HB_ADEL );
   HB_FUNC( AINS ) { HB_FUNC_EXEC( HB_AINS ); }
   HB_FUNC( ADEL ) { HB_FUNC_EXEC( HB_ADEL ); }
#pragma enddump

It's a hack but it will work with most of linkers. We can also add
less intrusive method to reach such effect and add C function which
allow to cleanly overload any public function. F.e.:
    hb_vmSetFunc( const char * szFuncName, PHB_SYMB pSym );
Such function can be executed from startup hb_vmAtInit() code.
I think that I'll add it to XHB lib as an example and I'll overload
AINS()/ADEL()

> Of cause, every extension should be selected very well before applying 
> it, and I'm strongly against STR(nI,,, .T.), because it does not looks 
> natural: second parameter is meaningless, function is often used in 
> index key and indexes will be not compatible if this extension is used, etc.

I fully agree here.touching STR() or other documented xbase functions is very
bad idea.
BTW has anyone checked what happens if someone will use such function
with ADS? And is xHarbour documentation updated to warn users which
functions supported by ADS may work differently in xHarbour to clearly
shows what is xHarbour extension and should not be used in ADS expressions?

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Sep 30 11:48:28 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 30 11:50:34 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <20070930144736.GC21844@localhost.localdomain>
References: <20070928200004.GA9026@localhost.localdomain>
	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>
	<46FDEE70.6030301@dbtopas.lt>
	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>
	<20070929094750.GB12269@localhost.localdomain>
	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>
	<20070929171225.GA24869@localhost.localdomain>
	<84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>
	<20070930104917.GA21844@localhost.localdomain>
	<46FF8BFB.4070203@dbtopas.lt>
	<20070930144736.GC21844@localhost.localdomain>
Message-ID: <C717435B-EBA2-4933-BCD9-648DB1FA0977@syenar.hu>

>> I see two of them usefull and clear:
>>     <hashkey> $ <hash>  => <lIncluded>
>>     <item> $ <array>    => <lIncluded>
>> The last one is not compatible with Clipper, so perhaps we will not
>> agree on adding it to Harbour.
>
> I have nothing against though <item> $ <array> is used much more  
> seldom
> when you have hashes because you stop using arrays for such things  
> - just
> simply hashes are much more efficient and <hashkey> $ <hash> is much
> faster then <item> $ <array>.

I agree.

>> I think we should not add compiler switch, it make things  
>> complicated.
>
> Complication is bad thing but if generated PCODE can be used with
> any version of HVM then it's acceptable for me. For sure I'll add
> new -k<?> switch to cover some optimizations which breaks strict
> Clipper compatibility but are safe if code does not depend on some
> side effects of Clipper implementation or RT errors.
> BTW I'll add some #pragmas to control -k? switches from .prg code  
> soon.

Sounds great. (except the pcode thing where I got lost this time :)

>> Sometimes I really wonder how much we can extend Clipper.  
>> Extensions are
>> good, compatibility also. Where is the limit? The most common  
>> example of
>> this is ADEL(). Even in Clipper it was very annoying to write:
>>    ADEL(aI, nI)
>>    ASIZE(aI, LEN(aI) - 1)
>> and I found xHarbour's
>>    ADEL(aI, nI, .T.)
>> really useful and it does not break compatibility. The same but  
>> not so
>> annoying (because rare used) for AINS.
>
> As I said IMHO changing standard function parameters makes backward
> portability of .prg code harder. For normal code PP can resolve the
> problem but if such extensions are used in macros then the code is
> in practice unportable. I think that the best choice is adding  
> HB_AADD()
> and HB_AINS() to core code. If some will really want to use extended
> AINS() and ADEL() also in macros then he can add to his code:
>
> #pragma begindump
>    HB_FUNC_EXTERN( HB_AINS );
>    HB_FUNC_EXTERN( HB_ADEL );
>    HB_FUNC( AINS ) { HB_FUNC_EXEC( HB_AINS ); }
>    HB_FUNC( ADEL ) { HB_FUNC_EXEC( HB_ADEL ); }
> #pragma enddump
>
> It's a hack but it will work with most of linkers. We can also add
> less intrusive method to reach such effect and add C function which
> allow to cleanly overload any public function. F.e.:
>     hb_vmSetFunc( const char * szFuncName, PHB_SYMB pSym );
> Such function can be executed from startup hb_vmAtInit() code.
> I think that I'll add it to XHB lib as an example and I'll overload
> AINS()/ADEL()

While this looks good technically, I'm not sure if this
is a good thing to add, because if there is an official
way to change .prg behaviour in such a drastic and _hidden_
way, well it can make it really difficult to find out what
is actually running when some .prg is run. At the same
time it doesn't give any speed difference, the thing
we "save" is the #include "xhb.ch" (but REQUEST LIB_XHB
is still needed anyway).

So technically brilliant, this can be a nightmare when
porting something or for an "average" Clipper programmer.

If we handle this at PP level (just like Clipper), everyone
can at least get a clear view what is really running,
by peeking at the .ppo code.

So pls, let's reconsider this new API.

Other than that I fully agree that AINS()/ADEL() should
not be touched to keep cross-compatibility, and in case
we want to introduce enhanced versions we should add HB_AINS(),
HB_ADEL().

>> Of cause, every extension should be selected very well before  
>> applying
>> it, and I'm strongly against STR(nI,,, .T.), because it does not  
>> looks
>> natural: second parameter is meaningless, function is often used in
>> index key and indexes will be not compatible if this extension is  
>> used, etc.
>
> I fully agree here.touching STR() or other documented xbase  
> functions is very
> bad idea.

Agreed.

Brgds,
Viktor

From dbtopas at dbtopas.lt  Sun Sep 30 12:35:35 2007
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Sun Sep 30 12:40:51 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <C717435B-EBA2-4933-BCD9-648DB1FA0977@syenar.hu>
References: <20070928200004.GA9026@localhost.localdomain>	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>	<46FDEE70.6030301@dbtopas.lt>	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>	<20070929094750.GB12269@localhost.localdomain>	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>	<20070929171225.GA24869@localhost.localdomain>	<84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>	<20070930104917.GA21844@localhost.localdomain>	<46FF8BFB.4070203@dbtopas.lt>	<20070930144736.GC21844@localhost.localdomain>
	<C717435B-EBA2-4933-BCD9-648DB1FA0977@syenar.hu>
Message-ID: <46FFD057.5040305@dbtopas.lt>

Szak?ts Viktor wrote:
>>> Sometimes I really wonder how much we can extend Clipper. Extensions are
>>> good, compatibility also. Where is the limit? The most common example of
>>> this is ADEL(). Even in Clipper it was very annoying to write:
>>>    ADEL(aI, nI)
>>>    ASIZE(aI, LEN(aI) - 1)
>>> and I found xHarbour's
>>>    ADEL(aI, nI, .T.)
>>> really useful and it does not break compatibility. The same but not so
>>> annoying (because rare used) for AINS.
>>
>> As I said IMHO changing standard function parameters makes backward
>> portability of .prg code harder. For normal code PP can resolve the
>> problem but if such extensions are used in macros then the code is
>> in practice unportable. I think that the best choice is adding HB_AADD()
>> and HB_AINS() to core code. If some will really want to use extended
>> AINS() and ADEL() also in macros then he can add to his code:
>>
>> #pragma begindump
>>    HB_FUNC_EXTERN( HB_AINS );
>>    HB_FUNC_EXTERN( HB_ADEL );
>>    HB_FUNC( AINS ) { HB_FUNC_EXEC( HB_AINS ); }
>>    HB_FUNC( ADEL ) { HB_FUNC_EXEC( HB_ADEL ); }
>> #pragma enddump
>>
>> It's a hack but it will work with most of linkers. We can also add
>> less intrusive method to reach such effect and add C function which
>> allow to cleanly overload any public function. F.e.:
>>     hb_vmSetFunc( const char * szFuncName, PHB_SYMB pSym );
>> Such function can be executed from startup hb_vmAtInit() code.
>> I think that I'll add it to XHB lib as an example and I'll overload
>> AINS()/ADEL()
> 
> While this looks good technically, I'm not sure if this
> is a good thing to add, because if there is an official
> way to change .prg behaviour in such a drastic and _hidden_
> way, well it can make it really difficult to find out what
> is actually running when some .prg is run. At the same
> time it doesn't give any speed difference, the thing
> we "save" is the #include "xhb.ch" (but REQUEST LIB_XHB
> is still needed anyway).
> 
> So technically brilliant, this can be a nightmare when
> porting something or for an "average" Clipper programmer.

Hi,


not so big nightmare. It's the same as write another implementation of 
ADEL/AINS and include it before hvm.lib in the linker library list 
(((it's the way I'm doing it with current SVN. I've used to add #define 
HB_COMPAT_XHB in the top of arrayshb.c with the earlier version of SVN 
to work AINS/ADEL as I expect))). The only problem is that arrayshb.c 
module has not only ADEL/AINS, but more functions. Overloading the part 
of the functions can be dangerous because of possible compiler inlining, 
function prologues, parameters optimisation, etc. hb_vmSetFunction() 
solves this problem on symbol table level, and this way it is save to 
overload only two functions of arrayshb.c module.


Best regards,
Mindaugas
From harbour.01 at syenar.hu  Sun Sep 30 13:33:08 2007
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Sep 30 13:37:49 2007
Subject: [Harbour] CHANGELOG: 2007-09-28 11:56 UTC+0100 Viktor Szakats
	(harbour.01 syenar.hu)
In-Reply-To: <46FFD057.5040305@dbtopas.lt>
References: <20070928200004.GA9026@localhost.localdomain>	<6E9F5C2D-19CA-46E9-989A-26C91EF3304C@syenar.hu>	<46FDEE70.6030301@dbtopas.lt>	<544DE1C1-A186-47D8-BFDC-61C8FFD322B6@syenar.hu>	<20070929094750.GB12269@localhost.localdomain>	<8E015644-65C2-4AF5-B675-60BEFCA876D6@syenar.hu>	<20070929171225.GA24869@localhost.localdomain>	<84255EAC-228E-47A9-988A-6CEEAA22E17C@syenar.hu>	<20070930104917.GA21844@localhost.localdomain>	<46FF8BFB.4070203@dbtopas.lt>	<20070930144736.GC21844@localhost.localdomain>
	<C717435B-EBA2-4933-BCD9-648DB1FA0977@syenar.hu>
	<46FFD057.5040305@dbtopas.lt>
Message-ID: <E6FA17BF-1483-46AC-9B55-DDC57A90274E@syenar.hu>

> Hi,
>
>
> not so big nightmare. It's the same as write another implementation  
> of ADEL/AINS and include it before hvm.lib in the linker library  
> list (((it's the way I'm doing it with current SVN. I've used to  
> add #define HB_COMPAT_XHB in the top of arrayshb.c with the earlier  
> version of SVN to work AINS/ADEL as I expect))). The only problem  
> is that arrayshb.c module has not only ADEL/AINS, but more  
> functions. Overloading the part of the functions can be dangerous  
> because of possible compiler inlining, function prologues,  
> parameters optimisation, etc. hb_vmSetFunction() solves this  
> problem on symbol table level, and this way it is save to overload  
> only two functions of arrayshb.c module.

Well, double symbols can also be a nightmare if the ordering
of them goes wrong, or you're simply not aware which symbol
is defined in which lib (and in one .obj with what else symbols),
and whether they override each other or not.

I've been chasing a GPF for years until I've found out it's
because a buggy STOD() implementation in one of the libs I've used.

I don't see any reason why this simple, backward and forward
compatible method is not doing the trick:

--
#define ADEL( a, b, c, d ) my_ADEL( a, b, c, d )

FUNC my_ADEL( a, b, c, d )
    //...
    RETURN x
--

After all, that's why we have one of the (if not the)
most sophisticated preprocessor out of every programming
language.

Doesn't solve macros, right. But that's what happens if
implementation specific extensions get added to existing
functions instead of keeping compatibility. That's a price
to pay. But I'm sure sure if Harbour has to pay this price.
If the extension goes to hb_ADEL() we don't even have this
whole set of problem.

Pls. keep Harbour simple.

Brgds,
Viktor

