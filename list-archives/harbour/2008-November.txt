From bedipritpal at hotmail.com  Sat Nov  1 02:58:48 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov  1 02:58:52 2008
Subject: [Harbour] How to retrieve - <pGT> from PRG to C
In-Reply-To: <20081029171138.GA11838@34-mo7-2.acn.waw.pl>
References: <20229416.post@talk.nabble.com>
	<20081029171138.GA11838@34-mo7-2.acn.waw.pl>
Message-ID: <20277987.post@talk.nabble.com>


Hi Przemek

I am trying something lile:

pGT1 := hb_gtCreate( 'WVG' )
pGT  := hb_gtSelect( pGT1 )
hb_gtInfo( HB_GTI_PRESPARAMS, { WS_EX_DLGMODALFRAME, NIL, 10, 10, 150, 100,
pGT, .F. } )

In hb_gt_wvt_Info()
  case HB_GTI_PRESPARAMS:
    PHB_ITEM pSome;

    pSome = hb_arrayGetPtr( pInfo->pNewVal, HB_GTI_PP_PARENT );
    if( hb_itemType( pSome ) & HB_IT_POINTER )
    {
         pWVT->pPP->pParentGT = hb_gt_ItemBase( pSome );
    }

Then in 
hb_gt_wvt_CreateWindow( pWVT )

   PHB_GTWVT pWVTp = HB_GTWVT_GET( pWVT->pPP->pParentGT )

I get nothing. Where I am wrong?

Regards
Pritpal Bedi

Everything compiles fine but 
-- 
View this message in context: http://www.nabble.com/How-to-retrieve---%3CpGT%3E-from-PRG-to-C-tp20229416p20277987.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sat Nov  1 03:24:24 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 03:24:32 2008
Subject: [Harbour] GTWVT and HB_GTI_ICONRES stopped working
Message-ID: <B562930B-FF4C-4AF3-9CC3-773986E3852E@syenar.hu>

Hi all,

Somewhere between rev 9760 and 9781, hb_gtInfo( HB_GTI_ICONRES,  
<string> )
stopped setting the system icon of the GTWVT window.

Could someone please check this?

Brgds,
Viktor

From harbour.01 at syenar.hu  Sat Nov  1 03:28:34 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 03:28:40 2008
Subject: [Harbour] 2008-10-31 13:02 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20273135.post@talk.nabble.com>
References: <20273135.post@talk.nabble.com>
Message-ID: <40DEE18B-DA39-4A53-B003-AB959967E192@syenar.hu>

Hi Pritpal,

Thanks. Could you pls also add it to the rest of 'all' files
in the same directory?

(Makefile, make_vc_all.bat and make_gcc_all.sh)

Brgds,
Viktor

On 2008.10.31., at 20:56, Pritpal Bedi wrote:

>
> 2008-10-31 13:02 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>  * harbour/contrib/make_b32_all.bat
>    + hbdbgfx librray for auto build.
>
> Regards
> Pritpal Bedi
> -- 
> View this message in context: http://www.nabble.com/2008-10-31-13%3A02-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20273135p20273135.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From hernad at sigma-com.net  Sat Nov  1 03:29:35 2008
From: hernad at sigma-com.net (Ernad Husremovic)
Date: Sat Nov  1 03:29:45 2008
Subject: [Harbour] Which "standard" GUI for Harbour
In-Reply-To: <1148012.7431225474251003.JavaMail.root@zimbra-1.sigma-com.net>
Message-ID: <25117370.7521225524575061.JavaMail.root@zimbra-1.sigma-com.net>

Lorenzo wrote:
> 
> I'll try to create a screencast.
> 
> BTW who knows simple and free screencast apps for Windows and Mac OS
> X?

http://www.jingproject.com/

Regards,
Ernad
From harbour.01 at syenar.hu  Sat Nov  1 03:32:10 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 03:32:16 2008
Subject: [Harbour] MT extensions
In-Reply-To: <490B2E54.2090901@dbtopas.lt>
References: <20081029163752.GA8772@34-mo7-2.acn.waw.pl>	<AF7287B9-E32B-49DE-A5F5-2C7A10B12192@syenar.hu>	<20081031000119.GA24870@34-mo7-2.acn.waw.pl>	<490AF149.8060204@mweb.co.za>	<A2891661-0415-4930-8753-651EE7F87647@syenar.hu>
	<20081031143245.GA18358@34-mo7-2.acn.waw.pl>
	<490B2E54.2090901@dbtopas.lt>
Message-ID: <0A0E1E5A-A750-4DDE-969D-0F6DDBF84FC5@syenar.hu>

SYNC[RONIZED] is much better than CRITICAL. Still, the only
problem with it that it used a different term than our other
Harbour functions targeting the same feature (hb_mutex*()).

Brgds,
Viktor

On 2008.10.31., at 17:12, Mindaugas Kavaliauskas wrote:

>>> Java uses the keyword "mutexed" which IMO tells it best
>>> that a given object is automatically protected by a mutex.
>> I didn't know about it. Can you show the whole syntax?
>
> Hi,
>
>
> I do not know Java well. I've wrote a single applet in my life. It  
> has method:
>
>  public synchronized void selectClass( String grupe )
>
> So, I do not know nothing about keyword "mutexed", but  
> "synchronized" exists for sure. This Java code actually made me to  
> propose "sync[hronized]" keyword in the previous letter.
>
>
> Best regards,
> Mindaugas
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sat Nov  1 04:28:51 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 04:28:50 2008
Subject: [Harbour] 2008-11-01 08:45 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93bfb$Blat.v2.6.2$deab456a$15248380cf68@127.0.0.1>

2008-11-01 08:45 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
  * common.mak
  * source/rtl/Makefile
  + source/rtl/hbi18n.c
    + Added basic/low level i18n functions:
      __I18N_SAVE( cFileName | nHandle, aSortedTable [, cComment ] ) => lSuccess
      __I18N_LOAD( cFileName | nHandle ) => trs
      __I18N_GETTEXT( @cText, trs ) => NIL
    ; NOTE: These were originally based on Giancarlo Niccolai's work in xhb, 
            but everything was completely reworked, fixed, internals removed, 
            made portable, lighter, shorter and probably quicker. The used file 
            format is incompatible, slightly smaller and portable.
    ; NOTE: The internal format of 'trs' (loaded translation) is also 
            different. For minimal memory/speed overhead, I've choosen a one 
            dimensional array, as opposed to the original two dimensional 
            (like the input aSortedTable array).
    ; TODO: Higher level functions to handle selecting a default 
            language, loading files automatically, possibly caching 
            multiple loaded language translations in memory and providing 
            a high level HB_I18N_GETTEXT() function. We may also readd 
            a low-level function to create 'trs' from a memory object 
            instead of loading it from the disk. We should in any case make 
            the higher level the lightest and less app specific as possible.

  * include/hbver.ch
  * source/rtl/version.c
  * utils/hbtest/rt_str.prg
  * ChangeLog
    ! Fixed returning bit width.
    * Reworked hb_version() parameter values as follows:
      (also fixed some differences between docs here in the 
      previous entry and actual code)
      HB_VERSION_HARBOUR        (was: HB_V_HARBOUR        )
      HB_VERSION_COMPILER       (was: HB_V_COMPILER       )
      HB_VERSION_MAJOR          (was: HB_V_MAJOR          )
      HB_VERSION_MINOR          (was: HB_V_MINOR          )
      HB_VERSION_MICRO          (was: HB_V_REV            )
      HB_VERSION_STATUS         (was: HB_V_STATUS         )
      HB_VERSION_REVISION       (was: HB_V_COUNT          )
      HB_VERSION_BLD_DATE_STR   (was: HB_V_DATE_TIME      )
      HB_VERSION_BLD_DATE       (was: HB_V_DATE           )
      HB_VERSION_BLD_TIME       (was: HB_V_TIME           )
      HB_VERSION_PCODE_VER      (was: HB_V_PCODE          )
      HB_VERSION_PCODE_VER_STR  (was: HB_V_PCODE_STR      )
      HB_VERSION_CHANGELOG_LAST (was: HB_V_CHANGELOG_LAST )
      HB_VERSION_CHANGELOG_REV  (was: HB_V_CHANGELOG_REV  )
      HB_VERSION_FLAG_PRG       (was: HB_V_FLAG_HARBOUR   )
      HB_VERSION_FLAG_C         (was: HB_V_FLAG_C         )
      HB_VERSION_FLAG_LINKER    (was: HB_V_FLAG_LINKER    )
      HB_VERSION_BITWIDTH       (was: HB_V_BITWIDTH       )
      HB_VERSION_ENDIANNESS     (was: HB_V_ENDIANNESS     )
      This function makes deprecated following functions:
      - HB_COMPILER() => hb_version( HB_VERSION_COMPILER )
      - HB_PCODEVER() => hb_version( HB_VERSION_PCODE_VER_STR )
      - HB_BUILDDATE() => hb_version( HB_VERSION_BLD_DATE_STR )
      and macros:
      - __ARCH16BIT__
      - __ARCH32BIT__
      - __ARCH64BIT__
      - __LITTLE_ENDIAN__
      - __BIG_ENDIAN__
      - __PDP_ENDIAN__
      - HB_VER_SVNID
      - HB_VER_CHLID
      - HB_VER_LENTRY 
      - HB_VER_C_USR
      - HB_VER_L_USR
      - HB_VER_PRG_USR
    ; TOFIX: Some term anomalies regarding 'REVISION'.

  * source/vm/runner.c
    * Minor formatting and added "s_" prefix to static var.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sat Nov  1 06:17:54 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 06:17:52 2008
Subject: [Harbour] 2008-11-01 11:11 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93c0b$Blat.v2.6.2$1a8b88ce$15242e5c17ac@127.0.0.1>

2008-11-01 11:11 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
  * source/rtl/hbi18n.c
    % Using buffered hb_file*() API in __I18N_LOAD() 
      instead of plain hb_fs*(). This will cause speedup when 
      buffering gets implemented in hb_file*(), because 
      currently two hb_fsRead() will be executed for each 
      string stored in the language file.
    - __I18N_LOAD(): Because of the above, passing a file handle 
      is no longer possible.
    + Added __I18N_LOADFROMMEMORY( <mem> ) => trs
    % Minor internal cleanups.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sat Nov  1 06:25:19 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 06:25:19 2008
Subject: [Harbour] 2008-11-01 11:24 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93c0c$Blat.v2.6.2$23c6c2f4$16bcdd0c29e6@127.0.0.1>

2008-11-01 11:24 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/hbi18n.c
    * Minor change in header to separate it visually from comment 
      field.
--
Brgds,
Viktor

From dmacias at mail.udg.mx  Sat Nov  1 06:59:53 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  1 06:59:53 2008
Subject: [Harbour] Re: Harbour under OS/2
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490C36A9.4060907@mail.udg.mx>

 > 2008-10-31 13:54 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >   * harbour/source/vm/dynlibhb.c
 >   * harbour/source/common/hbgete.c
 >   * harbour/source/common/hbfsapi.c
 >   * harbour/source/rtl/hbinet.c
 >   * harbour/source/rtl/hbffind.c
 >   * harbour/source/rtl/filesys.c
 >   * harbour/contrib/hbct/files.c
 >   * harbour/contrib/hbmzip/hbmzip.c
 >   * harbour/contrib/hbgf/hbgfos2/os2pm.c
 >     * cleanup casting in OS2 builds (use PCSZ/PSZ)

Thanks Przemek

Now current Harbour build fine under OS/2-gcc432 with just same well 
known warnings of gcc335

Harbour still does not build entirely with gcc432 due problem "ld.exe: 
emxbind failed" that I hope can be fixed in future gcc432 releases

David Macias




From harbour.01 at syenar.hu  Sat Nov  1 07:03:07 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 07:03:06 2008
Subject: [Harbour] 2008-11-01 12:02 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93c11$Blat.v2.6.2$6ba0dda8$16dc50e9a8d2@127.0.0.1>

2008-11-01 12:02 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
  * source/rtl/memofile.c
    + Added HB_MEMOREAD() which is identical to MEMOREAD() 
      except it won't truncate the last byte (on non-UNIX 
      compatible systems) if it's a EOF char.
      See also existing HB_MEMOWRIT().
      [TOMERGE 1.0]
--
Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Sat Nov  1 07:10:47 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sat Nov  1 07:10:52 2008
Subject: [Harbour] Colors and fonts with gtwvt/gtxwc
Message-ID: <9257026e0811010410n343a7725y158d69d0a87af83c@mail.gmail.com>

Can we say that the gtwvt's way to manage the palette will be also
compatible with gtxwc ( when it'll be added )?
I'm still using hard coded values in gtwvt.h and gtxwc.c and I'd like
to have an external configuration file.

I'm not finding a "clear" way to change the fixed font under gtxwc.
I'm using the xfontsel utility to understand what are the values that
can be used but I probably miss something.
Are there any guidelines to follow or something that prevent it by "design"?

best regards,
Lorenzo
From druzus at acn.waw.pl  Sat Nov  1 07:16:38 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 07:16:06 2008
Subject: [Harbour] HB_TRACE() - How to Invoke
In-Reply-To: <20268062.post@talk.nabble.com>
References: <20268062.post@talk.nabble.com>
Message-ID: <20081101111638.GA31088@34-mo7-2.acn.waw.pl>

On Fri, 31 Oct 2008, Pritpal Bedi wrote:

Hi Pritpal,

> How can I invoke 
> HB_TRACE( HB_TR_DEBUG, ( "hb_gt_wvt_Redraw(%p,%d,%d,%d)", pGT, iRow, iCol,
> iSize ) );
> to work ?

read doc/tracing.txt

Short instruction. Compile the code you want to trace with
HB_TR_LEVEL_DEBUG macro, f.e.:
   set C_USR=-DHB_TR_LEVEL_DEBUG

Before you run your application set HB_TR_LEVEL envvar to HB_TR_<level>,
f.e.:
  SET HB_TR_LEVEL=HB_TR_DEBUG
Do not set this variable if you recompile whole Harbour code with
HB_TR_LEVEL_* macro or the .prg files compilation will also be traced.
Use HB_TR_OUTPUT envvar if you want to redirect output to file.

> Also can this debug output be directed to outer debug engines, 
> I mean same as I can achieve with hb_ToOutDebug() function ?

I do not now hb_ToOutDebug() function. By default HB_TRACE send output
to stderr and can be redirected to file. You can also run your application
from parent process which redirects STDERR.

I guess you want to trace GUI application. You can also use MinGW mixed
mode. Just simply link Harbour application without -mwindows switch then
execute it from console window. STDOUT/STDERR will be automatically
redirected to this console so you can use simple printf().

best regards,
Przemek
From dmacias at mail.udg.mx  Sat Nov  1 07:48:17 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  1 07:48:19 2008
Subject: [Harbour] Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490C4201.5050204@mail.udg.mx>

 >copy config/w32/owatcom.cf to config/os2/owatcom.cf
 >and update it for OS2 builds. At least these lines should be changed:
 >[19]: CPPFLAGS = -w2 -d1 -zq -bt=NT
 >[56]: echo @%watcom%/binnt/wlink.lnk >> __link__.tmp
 >[57]: echo LIB kernel32.lib, user32.lib, wsock32.lib, winspool.lib,
 >oleaut32.lib, uuid.lib, comctl32.lib, mapi32.lib >> __link__.tmp
 >[62]: LDFLAGS = debug all OP osn=NT OP stack=65536 OP CASEEXACT

 >for OS2 builds. You will have to update -bt=NT and osn=NT,
 >directory with wlink.lnk (or maybe you can remove this line) and
 >library list. I suggest to start with removing lines 56 and 57 and then
 >try to add libraries if linker will report unresolved dependencies.
 >But 1-st Harbour will have to be updated for clean compilation.
 >I expect that you will see some errors. Please report them.
 >To compile Harbour set:

 >   rem update this path to real OpenWatcom location
 >   set WATCOM=C:\LNG\WATCOM
 >   rem In OS2 probably BINW and BINNT have different name, please check
 >   set PATH=%WATCOM%\BINW;%PATH%
 >   set INCLUDE=%WATCOM%\H;%WATCOM%\H\OS2
 >
 >   set HB_ARCHITECTURE=OS2
 >   set HB_COMPILER=owatcom

 >and then use GNU make to build harbour just like for GCC builds.

Przemek:

This is the first try of Harbour-OS/2-OpenWatcom 1.7

My OpenWatcom environment settings:
-------------------------
@ECHO OFF
SET WATCOM=E:\WATCOM
SET PATH=%WATCOM%\BINP;%WATCOM%\BINW;%PATH%
SET BEGINLIBPATH=%WATCOM%\BINP\DLL
SET EDPATH=%WATCOM%\EDDAT
SET INCLUDE=%WATCOM%\H\OS2;%WATCOM%\H
REM SET LIB=
SET HELP=%WATCOM%\BINP\HELP;%HELP%
SET BOOKSHELF=%WATCOM%\BINP\HELP;%BOOKSHELF%

Rem Named Pipes debug
Rem RUN=%WATCOM%\BINP\NMPBIND.EXE
-------------------------

My reduced make_ow.cmd:
-------------------------
set HB_ARCHITECTURE=os2
set HB_COMPILER=owatcom
set HB_GT_LIB=

set C_USR=-DHB_FM_STATISTICS_OFF

set HB_BIN_INSTALL=\harbour810\harbourow\bin\
set HB_LIB_INSTALL=\harbour810\harbourow\lib\
set HB_INC_INSTALL=\harbour810\harbourow\include\

    make -r %1 %2 %3 %4 %5 %6 %7 %8 %9 > make_ow.log
-------------------------

and for config\os2\owatcom.cf:

 >[19]: CPPFLAGS = -w2 -d1 -zq -bt=NT

-bt=OS2

 >[56]: echo @%watcom%/binnt/wlink.lnk >> __link__.tmp

For now is excluded

If included, should be used SYSTEM directive and which value ?

------------------------
For each executable file format that can be created using the Open Watcom
  Linker, a specific SYSTEM directive may be used.  The SYSTEM directive
selects a subset of the available directives necessary to create each
specific executable file format.

System
Description

[...]
os2
16-bit x86 OS/2 executable

os2_dll
16-bit x86 OS/2 Dynamic Link Library

os2_pm
16-bit x86 OS/2 Presentation Manager executable

os2v2
32-bit x86 OS/2 executable

os2v2_dll
32-bit x86 OS/2 Dynamic Link Library

os2v2_pm
32-bit x86 OS/2 Presentation Manager executable

[...]

windows
16-bit x86 Windows 3.x executable

windows_dll
16-bit x86 Windows 3.x Dynamic Link Library

win_vxd
32-bit x86 Windows 3.x or 9x Virtual Device Driver

win95
32-bit x86 Windows 9x executable

win95 dll
32-bit x86 Windows 9x Dynamic Link Library

nt
32-bit x86 Windows NT character-mode executable

nt_win
32-bit x86 Windows NT windowed executable

win32
synonym for "nt_win"

nt_dll
32-bit x86 Windows NT Dynamic Link Library

win386
32-bit x86 Open Watcom extended Windows 3.x executable or Dynamic Link 
Library

The various systems that we have listed above are defined in special 
linker directive files which are plain ASCII text files that you can 
edit.  These files are called wlink.lnk and wlsystem.lnk.

The file wlink.lnk is a special linker directive file that is 
automatically processed by the Open Watcom Linker before processing any 
other directives.  On a DOS, OS/2, or Windows-hosted system, this file 
must be located in one of the paths specified in the PATH environment 
variable.  On a QNX-hosted system, this file should be located in the 
/etc directory.  A default version of this file is located in the 
\watcom\binw directory on DOS-hosted systems, the \watcom\binp directory 
on OS/2-hosted systems, the /etc directory on QNX-hosted systems, and 
the \watcom\binnt directory on Windows 95 or Windows NT-hosted systems. 
  Note that the file wlink.lnk includes the file wlsystem.lnk which is 
located in the \watcom\binw directory on DOS, OS/2, or Windows-hosted 
systems and the /etc directory on QNX-hosted systems.

The files wlink.lnk and wlsystem.lnk reference the WATCOM environment 
variable which must be set to the directory in which you installed your 
software.

In the following sections, we show some of the typical directives that 
you might use to create a particular executable file format.  The common 
directives are described in the chapter entitled Linker Directives and 
Options.  They are "common" in the sense that they may be used with any 
executable format.  There are other, less general, directives that may 
be specified for a particular executable format.  In each of the 
following sections, we refer you to chapters in which you will find more 
information on the directives available with the executable format used.

At this point, it should be noted that various systems have adopted 
particular executable file formats.  For example, both the Tenberry 
Software DOS/4G(W) and FlashTek DOS extenders support one of the OS/2 
executable file formats.  It is for this reason that you may find that 
we direct you to a chapter which would, at first glance, seem unrelated 
to the executable file format in which you are interested.

To summarize, the steps that you should follow to learn about creating a 
particular executable are:

  1.Look for a section in this chapter that describes the executable 
format in which you are interested.

  2.See the chapter entitled Linker Directives and Options for a 
description of the common directives.

  3.If you require additional information, see also the chapter to which 
we have referred you.

  4.Also check the Open Watcom C/C++ Programmer's Guide or Open Watcom 
FORTRAN 77 Programmer's Guide for more information on creating specific 
types of applications.

------------------------


 >[57]: echo LIB kernel32.lib, user32.lib, wsock32.lib, winspool.lib,
 >oleaut32.lib, uuid.lib, comctl32.lib, mapi32.lib >> __link__.tmp

Excluded

 >[62]: LDFLAGS = debug all OP osn=NT OP stack=65536 OP CASEEXACT

osn excluded. OpenWatcom should define one based in platform

Rest of os2\owatcom.cf untouched

As expected, there are many errors at build time

Just 6 libraries are created:
----------------
  1/11/08  5:17a        20,480      0 a---  hbclipsm.lib
  1/11/08  5:16a       124,928      0 a---  hbcpage.lib
  1/11/08  5:17a        20,480      0 a---  hbgt.lib
  1/11/08  5:16a       299,520      0 a---  hblang.lib
  1/11/08  5:16a       182,784      0 a---  hbpcre.lib
  1/11/08  5:16a        89,600      0 a---  hbzlib.lib
----------------

Some errors found in make_ow.log are for example:

----------------------
make[3]: Entering directory `/harbour810/harbour/source/common/os2/owatcom'
wpp386   -DHB_FM_STATISTICS_OFF  ../../hbfsapi.c -fo=hbfsapi.obj
wpp386   -DHB_FM_STATISTICS_OFF  ../../hbfopen.c -fo=hbfopen.obj
wpp386   -DHB_FM_STATISTICS_OFF  ../../hbgete.c -fo=hbgete.obj
../../hbgete.c(93): Error! E473: col(21) function argument(s) do not 
match those in prototype
../../hbgete.c(93): Note! N392: col(21) definition: 'unsigned long 
syscall DosScanEnv( char const *, char * * )'
../../hbgete.c(93): Note! N643: col(21) cannot convert argument 2 
defined in: ../../hbgete.c(93) (col 40)
../../hbgete.c(93): Note! N630: col(21) source conversion type is 'char 
const * *'
../../hbgete.c(93): Note! N631: col(21) target conversion type is 'char * *'
../../hbgete.c(128): Error! E473: col(21) function argument(s) do not 
match those in prototype
../../hbgete.c(128): Note! N392: col(21) definition: 'unsigned long 
syscall DosScanEnv( char const *, char * * )'
../../hbgete.c(128): Note! N643: col(21) cannot convert argument 2 
defined in: ../../hbgete.c(128) (col 40)
../../hbgete.c(128): Note! N630: col(21) source conversion type is 'char 
const * *'
../../hbgete.c(128): Note! N631: col(21) target conversion type is 'char 
* *'
make[3]: Leaving directory `/harbour810/harbour/source/common/os2/owatcom'
make[2]: Leaving directory `/harbour810/harbour/source/common'
----------------------


make_ow.log are 118,591 bytes, 1813 lines long

Where can I send it to you ?

David Macias


From druzus at acn.waw.pl  Sat Nov  1 08:38:59 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 08:38:25 2008
Subject: [Harbour] Harbour under OS/2 - OpenWatcom
In-Reply-To: <490C4201.5050204@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490C4201.5050204@mail.udg.mx>
Message-ID: <20081101123859.GA25127@34-mo7-2.acn.waw.pl>

On Sat, 01 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> >[62]: LDFLAGS = debug all OP osn=NT OP stack=65536 OP CASEEXACT
> osn excluded. OpenWatcom should define one based in platform

Which does not have to be the one you want to create.
But we can leave it now.

> ../../hbgete.c(93): Error! E473: col(21) function argument(s) do not match 
> those in prototype

It's caused by this code:

      #ifdef __GNUC__
         PSZ EnvValue = ( PSZ ) "";
      #else
         PCSZ EnvValue = "";
      #endif

and as I can see in header files then
      PSZ EnvValue = ( PSZ ) "";
whould be used also for other compilers. I do not know why someone
created exception for GCC only so I haven't touched this code so far.
I'll change it.

> make_ow.log are 118,591 bytes, 1813 lines long
> Where can I send it to you ?

Please compress it and send it to my private address from this message
header.

best regards,
Przemek
From druzus at acn.waw.pl  Sat Nov  1 08:41:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 08:41:14 2008
Subject: [Harbour] 2008-11-01 13:41 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081101124147.GA3923@34-mo7-2.acn.waw.pl>

2008-11-01 13:41 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/common/hbgete.c
    ! fixed OS2 casting for non GCC compilers

best regards
Przemek
From bedipritpal at hotmail.com  Sat Nov  1 10:16:37 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov  1 10:16:41 2008
Subject: [Harbour] How to retrieve - <pGT> from PRG to C
In-Reply-To: <20277987.post@talk.nabble.com>
References: <20229416.post@talk.nabble.com>
	<20081029171138.GA11838@34-mo7-2.acn.waw.pl>
	<20277987.post@talk.nabble.com>
Message-ID: <20280783.post@talk.nabble.com>


Hello

Just to keep it alive!


Pritpal Bedi wrote:
> 
> Hi Przemek
> 
> I am trying something lile:
> 
> pGT1 := hb_gtCreate( 'WVG' )
> pGT  := hb_gtSelect( pGT1 )
> hb_gtInfo( HB_GTI_PRESPARAMS, { WS_EX_DLGMODALFRAME, NIL, 10, 10, 150,
> 100, pGT, .F. } )
> 
> In hb_gt_wvt_Info()
>   case HB_GTI_PRESPARAMS:
>     PHB_ITEM pSome;
> 
>     pSome = hb_arrayGetPtr( pInfo->pNewVal, HB_GTI_PP_PARENT );
>     if( hb_itemType( pSome ) & HB_IT_POINTER )
>     {
>          pWVT->pPP->pParentGT = hb_gt_ItemBase( pSome );
>     }
> 
> Then in 
> hb_gt_wvt_CreateWindow( pWVT )
> 
>    PHB_GTWVT pWVTp = HB_GTWVT_GET( pWVT->pPP->pParentGT )
> 
> I get nothing. Where I am wrong?
> 
> Regards
> Pritpal Bedi
> 
> Everything compiles fine but 
> 

-- 
View this message in context: http://www.nabble.com/How-to-retrieve---%3CpGT%3E-from-PRG-to-C-tp20229416p20280783.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Sat Nov  1 10:20:15 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 10:19:41 2008
Subject: [Harbour] 2008-11-01 15:20 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081101142015.GA14555@34-mo7-2.acn.waw.pl>

2008-11-01 15:20 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbdefs.h
    + added #define INCL_LONGLONG to include native compiler LONGLONG
      definition. It's necessary for OpenWatcom. Please check how it will
      interact with other OS2 compilers (GCC)

best regards
Przemek
From druzus at acn.waw.pl  Sat Nov  1 10:24:03 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 10:23:29 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <490C51CF.6050605@mail.udg.mx>
References: <45C51F90.1050102@mail.udg.mx>
	<20070205214347.GA10570@localhost.localdomain>
	<45C8811F.1080103@mail.udg.mx>
	<20070207115259.GA30204@localhost.localdomain>
	<45CFA04B.8030206@mail.udg.mx>
	<20070212092710.GA27856@localhost.localdomain>
	<45D83B8D.1060004@mail.udg.mx>
	<20070218125601.GB16738@localhost.localdomain>
	<490C51CF.6050605@mail.udg.mx>
Message-ID: <20081101142403.GA5276@34-mo7-2.acn.waw.pl>

On Sat, 01 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Trying with both e-mail address:
> - One of Changelog messages
>    2008-11-01 13:41 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
> - Other of your messages to Harbour mailing list
>    Przemyslaw Czerpak druzus at acn.waw.pl

I received it at acn.waw.pl.
Looks that OpenWatcom for OS2 does not enable LONGLONG support
by default. I've just committed:
   2008-11-01 15:20 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
     * harbour/include/hbdefs.h
       + added #define INCL_LONGLONG to include native compiler LONGLONG
         definition. It's necessary for OpenWatcom. Please check how it will
         interact with other OS2 compilers (GCC)

Please sync SVN repository and try to compile generating new log.

best regards,
Przemek
From druzus at acn.waw.pl  Sat Nov  1 10:36:28 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 10:35:54 2008
Subject: [Harbour] How to retrieve - <pGT> from PRG to C
In-Reply-To: <20277987.post@talk.nabble.com>
References: <20229416.post@talk.nabble.com>
	<20081029171138.GA11838@34-mo7-2.acn.waw.pl>
	<20277987.post@talk.nabble.com>
Message-ID: <20081101143628.GA18086@34-mo7-2.acn.waw.pl>

On Fri, 31 Oct 2008, Pritpal Bedi wrote:

Hi Pritpal,

> I am trying something lile:
> pGT1 := hb_gtCreate( 'WVG' )
> pGT  := hb_gtSelect( pGT1 )
> hb_gtInfo( HB_GTI_PRESPARAMS, { WS_EX_DLGMODALFRAME, NIL, 10, 10, 150, 100,
> pGT, .F. } )
> In hb_gt_wvt_Info()
>   case HB_GTI_PRESPARAMS:
>     PHB_ITEM pSome;
>     pSome = hb_arrayGetPtr( pInfo->pNewVal, HB_GTI_PP_PARENT );

Typo, you should use:
   pSome = hb_arrayGetIemPtr( pInfo->pNewVal, HB_GTI_PP_PARENT );

>     if( hb_itemType( pSome ) & HB_IT_POINTER )
>     {
>          pWVT->pPP->pParentGT = hb_gt_ItemBase( pSome );
>     }

Please remember that each time you call hb_gt_ItemBase() and it returns not
NULL pointer you should free it using hb_gt_BaseFree() to unlock GT for
other threads.
You can also keep GT item in your own item allocated by hb_gtNew().
It will protect releasing GT if in prg code pGT will be out of scope, f.e.
pParentGT can be PHB_ITEM and you can make:

   pWVT->pPP->pParentGT = hb_itemNew( hb_arrayGetIemPtr( pInfo->pNewVal,
                                                         HB_GTI_PP_PARENT ) );
and then when you want to access GT use:

   pGT = hb_gt_ItemBase( pWVT->pPP->pParentGT );
   if( pGT )
   {
      [...do sth with pGT...]
      hb_gt_BaseFree( pGT ); // unlock GT for other threads.
   }

> Then in 
> hb_gt_wvt_CreateWindow( pWVT )
>    PHB_GTWVT pWVTp = HB_GTWVT_GET( pWVT->pPP->pParentGT )
> I get nothing. Where I am wrong?

See above hb_arrayGetPtr() used instead of hb_arrayGetItemPtr().
Anyhow I suggest to change this code and keep pGT handler in PHB_ITEM
structure.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Nov  1 10:43:42 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 10:43:48 2008
Subject: [Harbour] Re: GTWVT and HB_GTI_ICONRES stopped working
In-Reply-To: <B562930B-FF4C-4AF3-9CC3-773986E3852E@syenar.hu>
References: <B562930B-FF4C-4AF3-9CC3-773986E3852E@syenar.hu>
Message-ID: <74D9B949-36B8-493C-9D65-B6863C99241C@syenar.hu>

Managed to solve this by moving this call after
my SetMode() call and an new 'hb_dispOutAt( 0, 0, " " )'
call between them.

HB_GTI_ICONRES assumes an already created window.

Brgds,
Viktor

On 2008.11.01., at 8:24, Szak?ts Viktor wrote:

> Hi all,
>
> Somewhere between rev 9760 and 9781, hb_gtInfo( HB_GTI_ICONRES,  
> <string> )
> stopped setting the system icon of the GTWVT window.
>
> Could someone please check this?
>
> Brgds,
> Viktor
>

From bedipritpal at hotmail.com  Sat Nov  1 10:46:00 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov  1 10:46:04 2008
Subject: [Harbour] 2008-11-01 07:31 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20281013.post@talk.nabble.com>


2008-11-01 07:31 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/make_vc_all.bat
  * harbour/contrib/make_gcc_all.sh
    + hbdbgfx librray for auto build.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-01-07%3A31-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20281013p20281013.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Sat Nov  1 10:49:18 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 10:48:44 2008
Subject: [Harbour] Re: GTWVT and HB_GTI_ICONRES stopped working
In-Reply-To: <74D9B949-36B8-493C-9D65-B6863C99241C@syenar.hu>
References: <B562930B-FF4C-4AF3-9CC3-773986E3852E@syenar.hu>
	<74D9B949-36B8-493C-9D65-B6863C99241C@syenar.hu>
Message-ID: <20081101144918.GA3405@34-mo7-2.acn.waw.pl>

On Sat, 01 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Managed to solve this by moving this call after
> my SetMode() call and an new 'hb_dispOutAt( 0, 0, " " )'
> call between them.
> HB_GTI_ICONRES assumes an already created window.

I suggest to store information about icon into pWVT structure so
it can be used when window is created 1-st time or recreated after
crash in future GTNET version. The same is for all other resources.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Nov  1 10:56:10 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 10:56:09 2008
Subject: [Harbour] 2008-11-01 15:47 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93c31$Blat.v2.6.2$fa41f360$184c795512d2@127.0.0.1>

2008-11-01 15:47 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/hbi18n.c
    % Removed 'comment' field from language file header. Any text 
      can be added simply by adding it to the translation table.

  * contrib/Makefile
    ! Missing hbdbgfx added here, too.
    ; BTW, I've intentionally left this lib out from the liblist 
      until we decide where to put these functions. There is 
      not much point maintaining for the sake of just a few functions.
      If there are no objections, I'll be moving these functions 
      to hbwin (until someone updates the code to work outside 
      Windows).
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sat Nov  1 11:40:48 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 11:40:15 2008
Subject: [Harbour] 2008-11-01 08:45 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c93bfb$Blat.v2.6.2$deab456a$15248380cf68@127.0.0.1>
References: <01c93bfb$Blat.v2.6.2$deab456a$15248380cf68@127.0.0.1>
Message-ID: <20081101154048.GA4312@34-mo7-2.acn.waw.pl>

On Sat, 01 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>     ; NOTE: The internal format of 'trs' (loaded translation) is also 
>             different. For minimal memory/speed overhead, I've choosen a one 
>             dimensional array, as opposed to the original two dimensional 
>             (like the input aSortedTable array).

I suggest to use internally hash array instead of normal array.
It will be more flexible on .prg level because user can simply make:
   trs[ cText ] := cTranslation
and then:
   ? trs[ cText ]

We should also add support to process .pot files generated by compiler with
-j option:

   proc main()
      ? HB_I18N_GETTEXT( "Hello World !!!" )
   return

to create final version compatible with format you added.
Please also remember that you can use hb_serialize*() functions to
convert Harbour items to text and hb_deserialize for reverted conversion.
It may simplify the code and will be easier to create helper tools at .prg
level. It's time to make some serialize functions public. See rtl/itemseri.c.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Nov  1 12:36:53 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 12:37:00 2008
Subject: [Harbour] 2008-11-01 08:45 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081101154048.GA4312@34-mo7-2.acn.waw.pl>
References: <01c93bfb$Blat.v2.6.2$deab456a$15248380cf68@127.0.0.1>
	<20081101154048.GA4312@34-mo7-2.acn.waw.pl>
Message-ID: <13EE125A-C8CB-4BA6-A1C4-C8AA06D7DC63@syenar.hu>

Hi Przemek,

Many thanks for your suggestions. I'm afraid
I'll quickly run out of my C expertise to rework
everything to another new format, but what you
say may all make sense.

As for serialize functions and hash, I'm not sure
they would be more efficient than now, especially
for loading. I have multiple language files around
700K, and they may be swapped at runtime when doing
specific stuff, like printing a document in foreign
language. Also, I very very rarely need to access
these translations explicitly (I expect the same
from other programs), so accessing them as hash is
IMO not a top necessity, but could indeed make the
solution more native and complete. I didn't do
measurements, so it may be possible we're talking
about fractions of time beyond perceptions, but
surely, gettext and load should be quick.

I have my ages old .pot processor written in
(now) Harbour, so I didn't need that part
personally, but it'd surely be useful. It can
be a bit different depending on how ppl want
to use this, for example I don't have translation
'domains' in my app (yet?), so I'm compiling
two separate .pot files into one language file
(yes, handling possible collisions is an issue).

Another useful tool (which I also have as a
very hackish and old Clipper program), is to
update an already existing .pot file from the
source, while keeping existing translations and
comments intact, backup deleted strings and
mark new ones as such. There are probably
better/standard tools for this job though.

I'm currently trying to create a higher level layer
(written in Harbour, based on my old functions
with similar purpose) to implement hb_i18n_gettext(),
but I already see that writing it in a generic
way may need too much special logic inside RTL for
my taste, so maybe it won't be committed.

I've been also thinking of using the .mo format, but
didn't see a good reason yet.

Anyhow pls feel free to modify these functions
as you think it's best.

Brgds,
Viktor

On 2008.11.01., at 16:40, Przemyslaw Czerpak wrote:

> On Sat, 01 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
>>    ; NOTE: The internal format of 'trs' (loaded translation) is also
>>            different. For minimal memory/speed overhead, I've  
>> choosen a one
>>            dimensional array, as opposed to the original two  
>> dimensional
>>            (like the input aSortedTable array).
>
> I suggest to use internally hash array instead of normal array.
> It will be more flexible on .prg level because user can simply make:
>   trs[ cText ] := cTranslation
> and then:
>   ? trs[ cText ]
>
> We should also add support to process .pot files generated by  
> compiler with
> -j option:
>
>   proc main()
>      ? HB_I18N_GETTEXT( "Hello World !!!" )
>   return
>
> to create final version compatible with format you added.
> Please also remember that you can use hb_serialize*() functions to
> convert Harbour items to text and hb_deserialize for reverted  
> conversion.
> It may simplify the code and will be easier to create helper tools  
> at .prg
> level. It's time to make some serialize functions public. See rtl/ 
> itemseri.c.
>
> best regards,
> Przemek

From harbour.01 at syenar.hu  Sat Nov  1 12:55:20 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 12:55:21 2008
Subject: [Harbour] 2008-11-01 17:52 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93c42$Blat.v2.6.2$9fe0c228$19209843b95c@127.0.0.1>

2008-11-01 17:52 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/gtwvt/gtwvt.h
  * source/rtl/gtwvt/gtwvt.c
    + Added support for HB_GTI_ICONRES, HB_GTI_ICONFILE 
      before the window is created.
    ! Fixed resource leak when HB_GTI_ICONFILE was used.
    ! Fixed problem with HB_GTI_ICONRES when it was resetting 
      the icon if a non-string/non-numeric parameter was passed
      passed, which included simply trying to read the value 
      using hb_gtInfo( HB_GTI_ICONRES ). If this was an intented 
      feature, pls speak up.
    ; Please review these changes.
--
Brgds,
Viktor

From dbtopas at dbtopas.lt  Sat Nov  1 14:14:38 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Sat Nov  1 14:14:39 2008
Subject: [Harbour] 2008-11-01 08:45 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081101154048.GA4312@34-mo7-2.acn.waw.pl>
References: <01c93bfb$Blat.v2.6.2$deab456a$15248380cf68@127.0.0.1>
	<20081101154048.GA4312@34-mo7-2.acn.waw.pl>
Message-ID: <490C9C8E.6070707@dbtopas.lt>

Hi,


> I suggest to use internally hash array instead of normal array.
> It will be more flexible on .prg level because user can simply make:
>    trs[ cText ] := cTranslation
> and then:
>    ? trs[ cText ]

Almost thee same solution I'm using in my local i18n runtime.


> Please also remember that you can use hb_serialize*() functions to
> convert Harbour items to text and hb_deserialize for reverted conversion.

Almost the same solution I'm using in my local i18n runtime. :) I just 
never wanted to make decision about translation table file format alone.


> It's time to make some serialize functions public. See rtl/itemseri.c.

Before that, I have one wish for item serialization (for another 
purpose, not for i18n). I want a possibility to save all item data 
including number width and decimals, also to avoid 0.0 be encoded as 0, etc.
A possible solution for this can be additional boolean parameter of 
encoding function. It can have default value .F. for .prg function 
version to maintain full backward compatibility.


Best regards,
Mindaugas
From druzus at acn.waw.pl  Sat Nov  1 15:09:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 15:09:14 2008
Subject: [Harbour] 2008-11-01 20:09 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081101190947.GA20871@34-mo7-2.acn.waw.pl>

2008-11-01 20:09 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rtl/gtwvt/gtwvt.h
  * harbour/source/rtl/gtwvt/gtwvt.c
    ! fixed HB_GTI_SETPOS_ROWCOL and HB_GTI_SETPOS_XY parameters decoding
    * automatically resize caret when cell size is changed
    * show window after setting its all parameters to eliminate visible
      resizing and repositioning. It did not eliminate multiple calls to
      hb_gt_wvt_FitSize() when windows is created. This has to be fixed
      yet or at least low level actions in this function not repeated
      when window and font dimensions are the same as in last call.
      Please test it in real MS-Windows. It should reduce startup
      flickering and increase the speed of initial code.

best regards
Przemek
From druzus at acn.waw.pl  Sat Nov  1 16:13:22 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 16:12:47 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>

2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rtl/itemseri.c
    ! fixed 8-bytes integer numbers deserialization
    + added support for serializing number with information about size
      and decimal places. It can be activated by passing .T. as second
      parameter to HB_SERIALIZE() function.
      Mindaugas please test if this is what you asked for.

  * harbour/source/rtl/hbi18n.c
    * changed USHORT to ULONG to pacify warning and minor speed increase
      (it eliminates later conversions to 32bits when variable is used)

best regards
Przemek
From bedipritpal at hotmail.com  Sat Nov  1 16:16:47 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov  1 16:16:51 2008
Subject: [Harbour] MT - WorkAreas - A Feature Request
In-Reply-To: <20268713.post@talk.nabble.com>
References: <20268713.post@talk.nabble.com>
Message-ID: <20284099.post@talk.nabble.com>


Just not to be buried under messages :-(


Pritpal Bedi wrote:
> 
> Hello Przemek
> 
> I am developing a RDBMS RDD (real-time) on top of USRRDD.
> So far so good, thanks for this superb tool.
> 
> Now MT is in picture, but the RDBMS communication layer is not 
> MT safe. I have guarded all functions in the communication layer 
> with hb_mutexLock()/hb_mutexUnlock() and it is working great.
> 
> Now the real issue:
> I have built the RDD on back of nWA which needs to be unique 
> for each table open. Now in MT every thread has common nWAs
> and this is breaking my methodology. Thou I can issue like:
> 
> STATIC nWorkArea := 0
> nWorkArea++
> 
> SELECT( nWorkArea )
> USE 'SomeTable' SHARED
> 
> This gives me unique workarea for each new table opened, but you 
> know it has a lot of limitations:
> 1) I can exhaust maximum WAs
> 2) Workareas cannot be reused once table is closed
> 3) MOST IMPORTANT: I have to change the sources whereever a table is
> opened.
> 
> My feature request:
> Is it possible that Harbour defines something like:
> SET( _SET_WORKAREAS, lUnique )
> and internally nWA is fetched form common pool if NEW clause is included
> in USE.
> 
> I will be saved days of work just to change the sources.
> 
> Regards
> Pritpal Bedi
> 

-- 
View this message in context: http://www.nabble.com/MT---WorkAreas---A-Feature-Request-tp20268713p20284099.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sat Nov  1 16:19:51 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 16:20:00 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
Message-ID: <47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>

Thank you. Shouldn't the cast in the changed line
be also changed to ( ULONG )?

Brgds,
Viktor

On 2008.11.01., at 21:13, Przemyslaw Czerpak wrote:

> 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>  * harbour/source/rtl/itemseri.c
>    ! fixed 8-bytes integer numbers deserialization
>    + added support for serializing number with information about size
>      and decimal places. It can be activated by passing .T. as second
>      parameter to HB_SERIALIZE() function.
>      Mindaugas please test if this is what you asked for.
>
>  * harbour/source/rtl/hbi18n.c
>    * changed USHORT to ULONG to pacify warning and minor speed  
> increase
>      (it eliminates later conversions to 32bits when variable is used)
>
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at acn.waw.pl  Sat Nov  1 16:39:51 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 16:39:17 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
Message-ID: <20081101203951.GA15722@34-mo7-2.acn.waw.pl>

On Sat, 01 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Thank you. Shouldn't the cast in the changed line
> be also changed to ( ULONG )?

Yes, It can be changed or removed though it will work without
warnings as is. BTW it will be more efficient to load whole
file at the beginning and then decode it but I do not think if it's
worth to change it. If we change this code to use hb_itemSerialize()/
hb_itemDeserialize() then it will force such modification. And don't
worry about the speed. The serialization/deserialization code is really
fast.
I think that using standard serialization method will increase
functionality, f.e. users can easy change the place where they store
i18n translation tables, f.e. they can use DBF with MEMO fields.
I can update this code but if Mindaugas already has some working code
then maybe we should not repeat the work.
Mindaugas?

best regards
Przemek
From druzus at acn.waw.pl  Sat Nov  1 17:00:56 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 17:00:22 2008
Subject: [Harbour] MT - WorkAreas - A Feature Request
In-Reply-To: <20268713.post@talk.nabble.com>
References: <20268713.post@talk.nabble.com>
Message-ID: <20081101210056.GB15722@34-mo7-2.acn.waw.pl>

On Fri, 31 Oct 2008, Pritpal Bedi wrote:

Hi Pritpal,

> Now the real issue:
> I have built the RDD on back of nWA which needs to be unique 
> for each table open. Now in MT every thread has common nWAs

Each thread has its own poll of WA numbers not common.

> and this is breaking my methodology.
> Thou I can issue like:
> STATIC nWorkArea := 0
> nWorkArea++
> SELECT( nWorkArea )
> USE 'SomeTable' SHARED
> This gives me unique workarea for each new table opened, but you 
> know it has a lot of limitations:
> 1) I can exhaust maximum WAs
> 2) Workareas cannot be reused once table is closed
> 3) MOST IMPORTANT: I have to change the sources whereever a table is opened.
> My feature request:
> Is it possible that Harbour defines something like:
> SET( _SET_WORKAREAS, lUnique )
> and internally nWA is fetched form common pool if NEW clause is included in
> USE.

It's default behavior.

Probably I do not understand what you need. If you want to add unique
for all thread number which is you low level table ID into each open WA
then simply add it to your RDD local workarea structure and extract it:
   nTableNO := USRRDD_AREADATA( nWA )[ MYWA_TABLE ]
and use it instead of nWA directly.
If you want to change the WA numbers allocating in Harbour RDD code
so they will be unique between threads then it's rather bad idea.
It will force blocking a lot of RDD code because we will need serialization
for everything what can allocate/release new WA. Many modifications,
bad performance/scalability overhead and new problems to resolve, f.e.
RT errors which can stop the thread with locked RDD internals.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Nov  1 17:07:53 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 17:07:59 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081101203951.GA15722@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
Message-ID: <F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>

>>
Hi Mindaugas, Przemek,

>> Thank you. Shouldn't the cast in the changed line
>> be also changed to ( ULONG )?
>
> Yes, It can be changed or removed though it will work without
> warnings as is. BTW it will be more efficient to load whole
> file at the beginning and then decode it but I do not think if it's
> worth to change it. If we change this code to use hb_itemSerialize()/
> hb_itemDeserialize() then it will force such modification. And don't
> worry about the speed. The serialization/deserialization code is  
> really
> fast.

The other issue is that 2 dimensional array. Currently
I'm changing it to 1 dimensional on load, and lookup
is faster this way, and the whole translation array
takes less space. Maybe it doesn't matter, I don't know.

BTW, I've now tested saved size with serialize as is
(2 dimensional), and it's almost exactly the same as
current __i18n_save(). This is pretty good. Then I've
tested loading speed, and it's only the half for
deserialize.

_i18n_loadfrommemory() [1D]: 3.6s
hb_deserialize() [2D]: 6.7s

1000 iterations with strings preloaded from disk,
for 9200 string pairs (682KB file for both) on a P4HT 2.6.

I've repeated the tests by using flattened 1 dimensional
array, which made the serialized files smaller than i18n
functions, and it also made the loading as below:

hb_deserialize() [1D]: 3.95s

Which is pretty good, so the most optimal would be to use
hb_serialize/deserialize with a flat array, flattened
on save. (saving is not speed or memory critical)

I didn't explore hash, as I have zero experience with them.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sat Nov  1 17:19:01 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 17:18:59 2008
Subject: [Harbour] 2008-11-01 17:52 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93c67$Blat.v2.6.2$75fda528$b94b0acd0da@127.0.0.1>

2008-11-01 17:52 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/gtwvt/gtwvt.c
    + Added support for HB_GTI_ICONRES, HB_GTI_ICONFILE 
      before the window is created.
    ! Fixed resource leak when HB_GTI_ICONFILE was used.
    ! Fixed problem with HB_GTI_ICONRES when it was resetting 
      the icon if a non-string/non-numeric parameter was passed
      passed, which included simply trying to read the value 
      using hb_gtInfo( HB_GTI_ICONRES ). If this was an intented 
      feature, pls speak up.
    ; Please review these changes.

(this file somehow didn't get committed previously)
--
Brgds,
Viktor

From hbco2 at sbcglobal.net  Sat Nov  1 17:21:21 2008
From: hbco2 at sbcglobal.net (Bill Smith)
Date: Sat Nov  1 17:20:51 2008
Subject: [Harbour] 2008-11-01 20:09 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081101190947.GA20871@34-mo7-2.acn.waw.pl>
References: <20081101190947.GA20871@34-mo7-2.acn.waw.pl>
Message-ID: <1225574481.3926.6.camel@hblx.340cst>

Hi Przmemek,

You might try the following:

(Windows XT, bcc compiler, hbmk -gui wvtext)

run wvtext
mouse->click on maximize screen [ ]
press F3, repaints but [ ] still inactive
mouse->click on minimize screen [-]
mouse->in tray, click to restore.  wvtext turns green
press F3
mouse->click on maximize screen [ ]
mouse->click on blue bar to move window left.  Window fragment remains,
maximize screen button turns active in moved window.

Thank you for your massive contributions!

Bill
 

On Sat, 2008-11-01 at 20:09 +0100, Przemyslaw Czerpak wrote:
> 2008-11-01 20:09 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/source/rtl/gtwvt/gtwvt.h
>   * harbour/source/rtl/gtwvt/gtwvt.c
>     ! fixed HB_GTI_SETPOS_ROWCOL and HB_GTI_SETPOS_XY parameters decoding
>     * automatically resize caret when cell size is changed
>     * show window after setting its all parameters to eliminate visible
>       resizing and repositioning. It did not eliminate multiple calls to
>       hb_gt_wvt_FitSize() when windows is created. This has to be fixed
>       yet or at least low level actions in this function not repeated
>       when window and font dimensions are the same as in last call.
>       Please test it in real MS-Windows. It should reduce startup
>       flickering and increase the speed of initial code.
> 
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sat Nov  1 18:01:25 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 18:01:24 2008
Subject: [Harbour] 2008-11-01 22:58 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93c6d$Blat.v2.6.2$623fc7fe$1a3cb227b2e0@127.0.0.1>

2008-11-01 22:58 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/hbi18n.c
    * Modified __I18N_GETTEXT() to not RTE when trs table 
      is non-array (like NIL).
    * USHORT -> ULONG in a few places.

  * source/rtl/gtwvt/gtwvt.c
    * Minor formatting.
--
Brgds,
Viktor

From info at fsgiudice.com  Sat Nov  1 18:12:18 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  1 18:12:26 2008
Subject: [Harbour] 2008-11-01 15:47 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c93c31$Blat.v2.6.2$fa41f360$184c795512d2@127.0.0.1>
References: <01c93c31$Blat.v2.6.2$fa41f360$184c795512d2@127.0.0.1>
Message-ID: <490CD442.7080406@fsgiudice.com>

Hi Viktor,

Il 01/11/2008 15.56, Szak?ts Viktor ha scritto:
> 2008-11-01 15:47 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>   * source/rtl/hbi18n.c
>     % Removed 'comment' field from language file header. Any text 
>       can be added simply by adding it to the translation table.
> 
>   * contrib/Makefile
>     ! Missing hbdbgfx added here, too.
>     ; BTW, I've intentionally left this lib out from the liblist 
>       until we decide where to put these functions. There is 
>       not much point maintaining for the sake of just a few functions.
>       If there are no objections, I'll be moving these functions 
>       to hbwin (until someone updates the code to work outside 
>       Windows).

actually hbdbgfx works with Windows and Linux if you use xhb (and in 
particular hboutdbg.c that it is included in xhb lib).
I wrongly said before that this lib works only under Windows because I 
made it one year ago and I forgot that hb_outdebug() in xhb was already 
made for windows and Linux.

If you want to test it just compile and link this test under linux:

PROCEDURE Main()

   hb_ToOutDebug( "Message = %s, Value = %i\n\r", "Test", 3 )

   WAIT

RETURN

hbmk -lhbdbgfx -xhb tstdbg

but before you have to comment out HB_OUTDEBUG function added at C level 
from Pritpal inside contrib/hbdbgfx/dbgfxc.c because it hides correct 
function from xhb.

I have proposed to move hboutdgb.c to hbdbgfx lib because I think that 
in xhb it is not used directly apart from hblog (that it is a collection 
of debug functions/classes) and I think that also this should be moved 
in hbdbgfx lib.

Best regards

Francesco

From harbour.01 at syenar.hu  Sat Nov  1 18:14:18 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 18:14:25 2008
Subject: [Harbour] i18n high level functions
Message-ID: <924B9927-7682-47E3-982C-B08AC7A87CD7@syenar.hu>

Hi all,

Pls find attached high level i18n_* functions. (untested)

hb_i18n_fnametemplate( [<newtemplate>] ) -> <oldtemplate>
hb_i18n_baselang( [<newlangid>] ) -> <oldlangid>
hb_i18n_activelang( [<newlangid>] ) -> <oldlangid>
hb_i18n_gettext( <cText> ) -> <cTranslatedText>
hb_i18n_gettextlang( <cText> [, <langid> ] -> <cTranslatedText>

Not strictly intended for the core as it has some
parts I wouldn't like to be included there, f.e. the
file template system. Maybe a callback block would
be better to pull a specific trs table however the
user wants it. Comments are welcome.

Brgds,
Viktor

-------------- next part --------------
A non-text attachment was scrubbed...
Name: hbi18nfn.prg
Type: application/octet-stream
Size: 2467 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081101/787cbc52/hbi18nfn.obj
-------------- next part --------------

From harbour.01 at syenar.hu  Sat Nov  1 18:29:17 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  1 18:29:24 2008
Subject: [Harbour] 2008-11-01 15:47 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <490CD442.7080406@fsgiudice.com>
References: <01c93c31$Blat.v2.6.2$fa41f360$184c795512d2@127.0.0.1>
	<490CD442.7080406@fsgiudice.com>
Message-ID: <4A394A66-CE1F-4132-80DA-6F6CF819A87E@syenar.hu>

>
Hi Francesco,

> actually hbdbgfx works with Windows and Linux if you use xhb (and in  
> particular hboutdbg.c that it is included in xhb lib).
> I wrongly said before that this lib works only under Windows because  
> I made it one year ago and I forgot that hb_outdebug() in xhb was  
> already made for windows and Linux.

xhb dependency is not a good solution for any
contribs.

> I have proposed to move hboutdgb.c to hbdbgfx lib because I think  
> that in xhb it is not used directly apart from hblog (that it is a  
> collection of debug functions/classes) and I think that also this  
> should be moved in hbdbgfx lib.

I strongly oppose this move, as I think it's the
wrong one in numerous ways (pls see my other mails).

Right now it seems hbdbgfx is separated to
not depend on xhb.lib, yet it still depends
on it for Linux. ?? I'm not sure I understand
the point of this.

Anyway I think lib should IMO be removed from the
repository, or moved inside xhb.lib.

Unfortunately no one of you told any actual
issues regarding usage of xhb.lib for dbg functions
(like unwanted parts pulled in to the final .exe),
so I'll stop guessing, but for sure, if there are
any issues those should be solved inside xhb.lib
by those who find this enough of a problem.

It's not a solution to let xhb parts pour in
various other libs, or start to be duplicated
as separate parts.

I'd propose to move these functions inside
xhb lib, in case someone wants to deal with
the details of this, if not, and there are no
better ideas, I'll remove this lib from the
repository.

Brgds,
Viktor

From druzus at acn.waw.pl  Sat Nov  1 19:25:15 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  1 19:24:42 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
Message-ID: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>

On Sat, 01 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> The other issue is that 2 dimensional array. Currently
> I'm changing it to 1 dimensional on load, and lookup
> is faster this way, and the whole translation array
> takes less space. Maybe it doesn't matter, I don't know.

With hash array the search can be done without function
call by simple

>
> BTW, I've now tested saved size with serialize as is
> (2 dimensional), and it's almost exactly the same as
> current __i18n_save(). This is pretty good. Then I've
> tested loading speed, and it's only the half for
> deserialize.
> _i18n_loadfrommemory() [1D]: 3.6s
> hb_deserialize() [2D]: 6.7s

Thanks for the tests.
The deserialization code makes always two passes.
1-st one is for checking if passed data can be deserialized
without any errors so some operations are doubled.
If we can "trust" that the data is valid then this pass can
be eliminated though I do not think it's good idea. Such
decoding can be done once and the overhead is rather small
so I prefer to validate the whole operation to avoid serious
problems like GPF or out of memory message when corrupted data
is passed.
The serialization code has also protection and support for
arrays and hashes with cyclic references. So it will not
GPF if you pass to serialize code array with cyclic reference.
It will be stored correctly and the cyclic references will
be restored correctly during deserialization. This protection
also cost a little bit. In summary it creates the speed difference.

> 1000 iterations with strings preloaded from disk,
> for 9200 string pairs (682KB file for both) on a P4HT 2.6.
> I've repeated the tests by using flattened 1 dimensional
> array, which made the serialized files smaller than i18n
> functions, and it also made the loading as below:
> hb_deserialize() [1D]: 3.95s
> Which is pretty good, so the most optimal would be to use
> hb_serialize/deserialize with a flat array, flattened
> on save. (saving is not speed or memory critical)
> I didn't explore hash, as I have zero experience with them.

The most important is the performance of accessing I18N data
at runtime. Hash arrays allows to access translated strings
without function call. They are also very easy to manage at
.prg level. F.e. this is customized version of hbi18n.c
(without RT errors) which can be written by any user if
we will use standard serialization code and hashes.

   FUNC __I18N_SAVE( cFile, hTrans )
      return hb_memoWrit( cFile, hb_serialize( hTrans ) )

   FUNC __I18N_LOAD( cFile )
      return hb_deserialize( hb_memoRead( cFile ) )

   FUNC __I18N_LOADFROMMEMORY( cData )
      return hb_deserialize( cData )

   FUNC __I18N_GETTEXT( cText, hTrans )
      if cText $ hTrans
         cText := hTrans[ cText ]
      endif
      return cText

   PROC __I18N_ADDTRANS( hTrans, cText, cTrans )
      hTrans[ cText ] := cTrans

   FUNC __I18N_INITTRANS()
      return hb_hSetAutoAdd( { => } )

Isn't simple?
For me such flexibility is very important.
Do you want to add domain support? Let's make changing few two functions:

   FUNC __I18N_GETTEXT( cText, hTrans, cDomain )
      local hDomain
      if cDomain == NIL
         cDomain := "[MAIN]"
      endif
      if cDomain $ hTrans
         hDomain := hTrans[ cDomain ]
         if cText $ hDomain
            cText := hDomain[ cText ]
         endif
      endif
      return cText

   PROC __I18N_ADDTRANS( hTrans, cText, cTrans, cDomain )
      if cDomain == NIL
         cDomain := "[MAIN]"
      endif
      if !cDomain $ hTrans
         hTrans[ cDomain ] := hb_hSetAutoAdd( { => } )
      endif
      hTrans[ cDomain, cText ] := cTrans


And now we only have to create new function __I18N_LOADPOT( cFile )
which will make something like:

   FUNC __I18N_LOADPOT( cFile )
      LOCAL hTrans := __I18N_INITTRANS()
      LOCAL cLine, cDomain, cText, cTrans

      FOR EACH cLine in hb_aTokens( memoread( cFile ), hb_osNewLine() )
         IF cLine = "msgctxt "
            cDomain := substr( cLine, 10, len( cLine ) - 10 )
         ELSEIF cLine = "msgid "
            cText := substr( cLine, 8, len( cLine ) - 8 )
         ELSEIF cLine = "msgstr "
            cTrans := substr( cLine, 9, len( cLine ) - 9 )
            IF !EMPTY( cText )
               IF EMPTY( cTrans )
                  cTrans := cText
               ENDIF
               __I18N_ADDTRANS( hTrans, cText, cTrans, cDomain )
               cText := cDomain := NIL
            ENDIF
         ENDIF
      NEXT
      RETURN hTrans

It's simplified version with only very basic functionality and without
error reporting for wrong .pot files. Nothing above is tested (just
written by finger) but should work. Of course .prg version is slower then
C code but it can be very easy written also in C. Important is easy to
manage format.
Of course it will be a little bit slower then dedicated format with
code optimized for it (BTW your code seems to be optimal, very nice
job) but the speed difference should not be noticeable in normal
applications.

best regards,
Przemek
From info at fsgiudice.com  Sat Nov  1 19:51:03 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  1 19:51:13 2008
Subject: [Harbour] 2008-11-01 15:47 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <4A394A66-CE1F-4132-80DA-6F6CF819A87E@syenar.hu>
References: <01c93c31$Blat.v2.6.2$fa41f360$184c795512d2@127.0.0.1>	<490CD442.7080406@fsgiudice.com>
	<4A394A66-CE1F-4132-80DA-6F6CF819A87E@syenar.hu>
Message-ID: <490CEB67.40103@fsgiudice.com>

Hi Viktor,

Il 01/11/2008 23.29, Szak?ts Viktor ha scritto:
>>
> Hi Francesco,
> 
> xhb dependency is not a good solution for any
> contribs.
>

I agree.

> I strongly oppose this move, as I think it's the
> wrong one in numerous ways (pls see my other mails).
>

ok, and I have already accepted it in previous mails. I have proposed 
the move because you told that you want to move hbdbgfx in hbwin because 
it works only in Windows env, as for my error in explaining, instead it 
works also in Linux, also if partially at this moment (see below).

> Right now it seems hbdbgfx is separated to
> not depend on xhb.lib, yet it still depends
> on it for Linux. ?? I'm not sure I understand
> the point of this.

Yes, because in Linux AFAIK does not exists equivalent of 
OutputDebugString() function, Giancarlo creates some code to emulate it.

After checked again both files I have remembered why I left lib so.
Because hb_outdebug() in xhb is defined at prg level instead I want to 
add it also for C level and unify it with mine functions.
The intention was, but left incomplete, to redirect last part of work of 
hb_ToOutDebug() (visualization after formatting) to hb_outdebug() either 
for PRG than C level.

The proposal of hb_ToOutDebug() function is to have exactly same 
function for C and PRG levels having same syntax to help to debug apps.

It works banally at PRG doing:

PROCEDURE HB_ToOutDebug( ... )
    IF s_lToOutDebug
       hb_OutDebug( hb_sprintf( ... ) )
    ENDIF
RETURN

and at C level is similar also if I have not already added hb_OutDebug 
equivalent for linux.
So now it works both in window and linux only from PRG level (using 
hboutdbg.c functions from xhb), instead at C level *actually* it works 
only for windows.

> Anyway I think lib should IMO be removed from the
> repository, or moved inside xhb.lib.
> 
> Unfortunately no one of you told any actual
> issues regarding usage of xhb.lib for dbg functions
> (like unwanted parts pulled in to the final .exe),
> so I'll stop guessing, but for sure, if there are
> any issues those should be solved inside xhb.lib
> by those who find this enough of a problem.
> 
> It's not a solution to let xhb parts pour in
> various other libs, or start to be duplicated
> as separate parts.
> 
> I'd propose to move these functions inside
> xhb lib, in case someone wants to deal with
> the details of this, if not, and there are no
> better ideas, I'll remove this lib from the
> repository.
> 

If you think that I can make above modifications (add C level call for 
them that alter code, also if just a little, from original xharbour 
file) I agree to move hbdbgfx into xhb.
Otherwise I will add above changes to hbdbgfx to make it complete.
Take your decision, I will follow it. If you want to delete hbdbgfx lib 
at all I will continue to have it in my repository as before.
I have added it because I thought it can be useful to someone.

Best regards

Francesco


From harbour.01 at syenar.hu  Sun Nov  2 01:34:53 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 01:34:50 2008
Subject: [Harbour] 2008-11-02 07:33 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93cb5$Blat.v2.6.2$1d4dd21a$e58da314b58@127.0.0.1>

2008-11-02 07:33 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbstdgen.ch
    - Removed HB_VERSION mistakenly left there.

  * include/hbextern.ch
  * source/rtl/version.c
    + Added HB_OSISWINNT()
    + Added HB_OSISWINCE()
      [TOMERGE 1.0]

  * include/hbver.ch
  * source/rtl/version.c
    + Added:
      hb_version( HB_VERSION_MT )          -> <logical>
      hb_version( HB_VERSION_UNIX_COMPAT ) -> <logical>
      hb_version( HB_VERSION_PLATFORM )    -> <string> (same as ending of __PLATFORM__* macros)
      This makes these functions/macros deprecated:
      - HB_MTVM()
      - __PLATFORM__* (not for all possible situations)
    ; TOFIX: Cleanup REVISION/SVN term usage in source.
    ; TOFIX: Remove HB_VER_* predefined macro usage on .prg level.
    ; TODO: Removed some deprecated by hb_version() functions/macros.

  * include/hbapi.h
  * source/vm/itemapi.c
  * source/common/hbstr.c
  * source/common/expropt2.c
  * source/rtl/chrasc.c
  * source/rtl/hbi18n.c
    * Minor formatting.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  2 01:43:55 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 01:43:51 2008
Subject: [Harbour] 2008-11-02 07:39 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93cb6$Blat.v2.6.2$6065fe82$3fc26c50bf6@127.0.0.1>

2008-11-02 07:39 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/version.c
    ! Added missing header from previous change.

  * source/vm/itemapi.c
    ! snprintf() -> hb_snprintf()
      This got incidentally reverted in previous commit by mistake.
--
Brgds,
Viktor

From bedipritpal at hotmail.com  Sun Nov  2 02:42:42 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  2 02:42:46 2008
Subject: [Harbour] 2008-11-02 00:40 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20287680.post@talk.nabble.com>


2008-11-02 00:40 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/gtwvg/gtwvg.h
  * harbour/contrib/gtwvg/hbgtwvg.ch
  * harbour/contrib/gtwvg/wvgpaint.prg

    ! Synchronized with GTWVT.

    + Added HB_GTI_* hb_gtInfo() constants:
         HB_GTI_PRESPARAMS  // provides mechanism to configure windows
appearance and behavior
         HB_GTI_ENABLE      // enables window to receive input focus with
specified GT
         HB_GTI_DISABLE     // disables window to accept input focus with
specified GT
         HB_GTI_SETFOCUS    // sets the input focus to specified GT

    + Added HB_GT_PP structure supporting design-time presentation
      parameters via HB_GTI_PRESPARAMS:
         HB_GTI_PP_EXSTYLE  // extended style of the window
         HB_GTI_PP_STYLE    // normal style of the window
         HB_GTI_PP_X        // left position by pixel | top position by row
         HB_GTI_PP_Y        // top position by pixel | left position by col
         HB_GTI_PP_WIDTH    // width of the window by pixel | number of rows
in window
         HB_GTI_PP_HEIGHT   // height of the window by pixel | number of
columns in window
         HB_GTI_PP_PARENT   // parent GT if window needs to be modal and/or
other usage
         HB_GTI_PP_VISIBLE  // flag to specify if the window is made visible
immediate after this call
         HB_GTI_PP_ROWCOLS  // flag to interpret X,Y,WIDTH,HEIGHT as
Top,Left,Rows,Cols
       
      ;IMPLEMENTS the behavioral changes to current GT window invoked 
                  either by hb_gtCreate() or hb_gtSelect() functions by
specifying
                  an array of 9 elements ( bound to increase in future ) via
                  hb_gtInfo( HB_GTI_PRESPARAMS, aPresParams ) where
<aPresParams>
                  contains elements described as above:
                     1. ExStyle                N   [D] 0
                     2. Style                  N       WS_OVERLAPPEDWINDOW
                     3. x[pxl] top[row]        N       0
                     4. y[pxl] left[col]       N       0
                     5. width[pxl]  rows[row]  N       CW_USEDEFAULT
                     6. height[pxl] cols[col]  N       CW_USEDEFAULT
                     7. Parent GT              P       NIL
                     8. Visibility             L       FALSE
                     9. RowCols                L       FALSE
              <aPresParams> must be passed with all 9 elements even if
              you want only few to be changed.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! Updated to demonstrate above concept to show up a modal dialog in the 
      same thread on top of a threaded window. Try to click on the parent
window.
      <Traditional><Browser><F3> will show up this modal dialog. 

    ;NOTE : Please do not use literals to define members, always use
            #defines from hbgtwvg.ch as it is a work in progress and is
possible
            that few of the definitions may change in future.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-02-00%3A40-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20287680p20287680.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dmacias at mail.udg.mx  Sun Nov  2 05:20:44 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  2 05:20:54 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490D7EFC.8080507@mail.udg.mx>

 >Looks that OpenWatcom for OS2 does not enable LONGLONG support
 >by default. I've just committed:
 >   2008-11-01 15:20 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >     * harbour/include/hbdefs.h
 >       + added #define INCL_LONGLONG to include native compiler LONGLONG
 >         definition. It's necessary for OpenWatcom. Please check how it
 >         will interact with other OS2 compilers (GCC)
 >
 >Please sync SVN repository and try to compile generating new log.

Thanks Przemek

Current Harbour code compile fine with gcc335 with just well known warnings

With OpenWatcom 1.7:
- Screen output
-----------------------
make[3]: *** [filesys.obj] Error 8
make[2]: *** [descend] Error 2
make[3]: *** [dynlibhb.obj] Error 8
make[2]: *** [descend] Error 2
make[3]: [hbrun.exe] Error 1 (ignored)
make[3]: [hbtest.exe] Error 1 (ignored)
make[3]: [hbdoc.exe] Error 1 (ignored)
make[3]: [hbmake.exe] Error 1 (ignored)
make[3]: *** [hbcrypt.obj] Error 8
make[2]: *** [descend] Error 2
-----------------------

. 33 libraries created
-----------------------
  2/11/08  3:30a        79,360      0 a---  hbcommon.lib
  2/11/08  3:30a       351,744      0 a---  hbpp.lib
  2/11/08  3:31a       438,272      0 a---  hbcplr.lib
  2/11/08  3:31a        87,040      0 a---  hbmacro.lib
  2/11/08  3:31a       124,928      0 a---  hbcpage.lib
  2/11/08  3:31a       299,520      0 a---  hblang.lib
  2/11/08  3:32a       314,880      0 a---  hbrdd.lib
  2/11/08  3:32a         6,144      0 a---  hbnulrdd.lib
  2/11/08  3:32a       105,472      0 a---  rddntx.lib
  2/11/08  3:33a       215,040      0 a---  rddcdx.lib
  2/11/08  3:33a        57,856      0 a---  rddfpt.lib
  2/11/08  3:33a        98,304      0 a---  hbsix.lib
  2/11/08  3:33a        24,576      0 a---  hbhsx.lib
  2/11/08  3:33a        86,528      0 a---  hbusrrdd.lib
  2/11/08  3:33a        69,632      0 a---  hbextern.lib
  2/11/08  3:33a       182,784      0 a---  hbpcre.lib
  2/11/08  3:33a        89,600      0 a---  hbzlib.lib
  2/11/08  3:34a       858,112      0 a---  hbdebug.lib
  2/11/08  4:03a       228,864      0 a---  hbbmcdx.lib
  2/11/08  4:03a        43,520      0 a---  hbbtree.lib
  2/11/08  4:03a        20,480      0 a---  hbclipsm.lib
  2/11/08  4:04a       359,936      0 a---  hbct.lib
  2/11/08  4:04a        23,552      0 a---  hbdbgfx.lib
  2/11/08  4:05a        69,632      0 a---  hbgfos2.lib
  2/11/08  4:05a        20,480      0 a---  hbgt.lib
  2/11/08  4:05a       102,912      0 a---  hbmisc.lib
  2/11/08  4:05a        64,512      0 a---  hbmzip.lib
  2/11/08  4:08a       851,456      0 a---  hbnf.lib
  2/11/08  4:09a       924,672      0 a---  hbtip.lib
  2/11/08  4:09a        44,544      0 a---  hbtpathy.lib
  2/11/08  4:10a       568,832      0 a---  hbvpdf.lib
  2/11/08  4:10a        27,648      0 a---  hbziparc.lib
  2/11/08  4:10a        84,480      0 a---  hbmsql.lib
        33 file(s)   6,925,312 bytes used
-----------------------

- 2 executables created: harbour.exe, hbpp.exe

- Many references to "unreachable code", for example:
-----------------------
  dbjoin.c(188): Warning! W013: col(18) unreachable code
-----------------------

- New make_ow.log
Sent

David Macias

From druzus at acn.waw.pl  Sun Nov  2 06:25:40 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  2 06:25:07 2008
Subject: [Harbour] 2008-11-02 12:25 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081102112540.GA2882@34-mo7-2.acn.waw.pl>

2008-11-02 12:25 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/vm/dynlibhb.c
    * forced casting in OS2 builds to eliminate problems with possible
      differences between compilers in 'char' type sign

  * harbour/source/rtl/filesys.c
    ! use _getcwd1() only in GCC OS2 builds - it's local GCC function
    * removed some header files from OS2 build - please test if it does
      not break GCC builds

best regards
Przemek
From druzus at acn.waw.pl  Sun Nov  2 06:34:58 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  2 06:34:23 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <490D7EFC.8080507@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490D7EFC.8080507@mail.udg.mx>
Message-ID: <20081102113458.GA4109@34-mo7-2.acn.waw.pl>

On Sun, 02 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> With OpenWatcom 1.7:
> - Screen output
> -----------------------
> make[3]: *** [filesys.obj] Error 8
> make[3]: *** [dynlibhb.obj] Error 8

Please test after:
   2008-11-02 12:25 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)

> - 2 executables created: harbour.exe, hbpp.exe

Fine. The 1-st step.

> - Many references to "unreachable code", for example:
> -----------------------
>  dbjoin.c(188): Warning! W013: col(18) unreachable code
> -----------------------

Side effect if -gc3 output. You can safely ignore them or use:
   set PRG_USR=-gc0

> - New make_ow.log
> Sent

Thanks,

> Warning! W1108: file E:\WATCOM/binp/wlink.lnk: line(3): system 286 defined more than once
[...]
Please try to remove from os2/owatcom.cf this line:
   echo @%watcom%/binp/wlink.lnk >> __link__.tmp
It's probably included by default and it causes repeated definitions.
Please also note that this line:
   Rem DAVID: echo LIB kernel32.lib, user32.lib, wsock32.lib, winspool.lib, oleaut32.lib, uuid.lib, comctl32.lib, mapi32.lib >> __link__.tmp
is written to .lnk file. Looks that linker ignores it but please try to
eliminate such situations - it make cause some unexpected results.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  2 07:12:05 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 07:12:14 2008
Subject: [Harbour] i18n high level functions #2
Message-ID: <3AE2889F-0222-438F-B4DF-902E5367A094@syenar.hu>

Hi all,

Pls find attached high level i18n_* functions.
Now, instead of a filename template, a translation
loader callback can be specified by the user, so
the actual source of the translation is completely
controllable from the user side. The block is getting
the language ID as a parameter. This layer uses
low level __i18n_loadfrommemory() (for default cases),
and __i18n_gettext().

hb_i18n_loadcallback( [<bNewCallback> | NIL ] ) -> <bOldCallback>
hb_i18n_baselang( [<cNewLangID>] ) -> <cOldLangID>
hb_i18n_activelang( [<cNewLangID>] ) -> <cOldLangID>
hb_i18n_gettext( <cText> ) -> <cTranslatedText>
hb_i18n_gettextlang( <cText> [, <cLangID> ] -> <cTranslatedText>

Comments are welcome.

Brgds,
Viktor

-------------- next part --------------
A non-text attachment was scrubbed...
Name: hbi18nfn.prg
Type: application/octet-stream
Size: 4720 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081102/aadb810a/hbi18nfn-0001.obj
From druzus at acn.waw.pl  Sun Nov  2 07:20:37 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  2 07:20:00 2008
Subject: [Harbour] i18n high level functions
In-Reply-To: <924B9927-7682-47E3-982C-B08AC7A87CD7@syenar.hu>
References: <924B9927-7682-47E3-982C-B08AC7A87CD7@syenar.hu>
Message-ID: <20081102122037.GA23831@34-mo7-2.acn.waw.pl>

On Sat, 01 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Pls find attached high level i18n_* functions. (untested)
> hb_i18n_fnametemplate( [<newtemplate>] ) -> <oldtemplate>
> hb_i18n_baselang( [<newlangid>] ) -> <oldlangid>
> hb_i18n_activelang( [<newlangid>] ) -> <oldlangid>
> hb_i18n_gettext( <cText> ) -> <cTranslatedText>
> hb_i18n_gettextlang( <cText> [, <langid> ] -> <cTranslatedText>
> Not strictly intended for the core as it has some
> parts I wouldn't like to be included there, f.e. the
> file template system. Maybe a callback block would
> be better to pull a specific trs table however the
> user wants it. Comments are welcome.

Looks fine but domain support is a must.
It has to be also updated for MT mode. Here we should define
what is global and what thread local.
Resources like translation tables should be global but
base lang/active lang should be thread local.
Please also remember that we have HB_SETLANGUAGE()/_SET_LANGUAGE.
It can be used instead of introducing new settings.
The MT access will have to be protected so we will have to define
what can be changed at runtime, f.e. do we allow manipulations on
translation table body? If yes then which ones?
The next problem which should be resolved is CP support.
I do not like to have copy of all translation tables for each CPs
just like we have msg* modules so we should think about adding
support for CP translation. To reduce RT overhead we can add function
to translate existing trnaslation table. I do not think it will be
big problem.
Finally if we want to introduce to Harbour core code full i18n support
then IMHO we should also add C API for it.
I think that some upper level functions like translation tools or .pot
files manipulations can be written as .prg code so user can easy extend
it. The low level functions and hb_i18n_gettext*() for RT performance
should be written in C.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  2 07:36:12 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  2 07:35:37 2008
Subject: [Harbour] 2008-11-02 13:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081102123612.GA27093@34-mo7-2.acn.waw.pl>

2008-11-02 13:36 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbexprb.c
    ! fixed possible GPF/internal memory corruption in code like:
         ? HB_I18N_GETTEXT_NOOP( "Ala ma kota" + " !!!" )
      Mindaugas, the fix is also the answer for the question you left
      in TODO.

best regards
Przemek
From harbour.01 at syenar.hu  Sun Nov  2 07:54:23 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 07:54:31 2008
Subject: [Harbour] i18n high level functions
In-Reply-To: <20081102122037.GA23831@34-mo7-2.acn.waw.pl>
References: <924B9927-7682-47E3-982C-B08AC7A87CD7@syenar.hu>
	<20081102122037.GA23831@34-mo7-2.acn.waw.pl>
Message-ID: <DF8F2E46-642B-451E-B7B3-B1B5AA87E401@syenar.hu>

>>
Hi Przemek,

>> Pls find attached high level i18n_* functions. (untested)
>> hb_i18n_fnametemplate( [<newtemplate>] ) -> <oldtemplate>
>> hb_i18n_baselang( [<newlangid>] ) -> <oldlangid>
>> hb_i18n_activelang( [<newlangid>] ) -> <oldlangid>
>> hb_i18n_gettext( <cText> ) -> <cTranslatedText>
>> hb_i18n_gettextlang( <cText> [, <langid> ] -> <cTranslatedText>
>> Not strictly intended for the core as it has some
>> parts I wouldn't like to be included there, f.e. the
>> file template system. Maybe a callback block would
>> be better to pull a specific trs table however the
>> user wants it. Comments are welcome.
>
> Looks fine but domain support is a must.
> It has to be also updated for MT mode. Here we should define
> what is global and what thread local.
> Resources like translation tables should be global but
> base lang/active lang should be thread local.

Yes. Possibly new threads should inherit from parent
threads.

Cache should naturally stay global, and this will
need mutex protection.

> Please also remember that we have HB_SETLANGUAGE()/_SET_LANGUAGE.
> It can be used instead of introducing new settings.

Okay. If so, we need to move this whole thing to C level.
This code is rather just a prototype anyway.

> The MT access will have to be protected so we will have to define
> what can be changed at runtime, f.e. do we allow manipulations on
> translation table body? If yes then which ones?

No, I think the only means to change a translation body
is to force a reload. We may add such cache flushing
(not very elegant), or forced loading (not elegant
either), or just passing a flag to the load function
to signal if the translation is already cached and let
the app decide what do to. Reload can be as easy as
refill internals with passed in-memory table, if someone
really needs dynamic stuff, but otherwise (in normal
app code) translations very rarely change at runtime.
So IMO, the design should allow it, but it shouldn't
be optimized around it. Optimization should aim quick
loading and quick text translation.

> The next problem which should be resolved is CP support.

Well yeah.

> I do not like to have copy of all translation tables for each CPs
> just like we have msg* modules so we should think about adding
> support for CP translation. To reduce RT overhead we can add function
> to translate existing trnaslation table. I do not think it will be
> big problem.

Dunno, I have my own conversion functions (slow, but they
do the job), and relevant cp translation strings get loaded
from the .lng files. This is not ideal, but does the job.
We need to keep in mind that a given app can handle several
languages at a time, f.e. while printing an invoice in English
in Slovakia, obviously the progress message will be English,
the rest Slovak (base lang HU). I didn't follow Harbour when
CP support got implemented, so I don't know where it stands
now, and if I could personally use it instead of local
solution, or how could we connect to it.

Anyhow it needs to be solved. I'm secretly hoping for
Unicode, so part of this nightmare can be resolved forever.
(part of because you still have parts of the world which
needs non-unicode, like direct printing, so we will not get
around the topic anytime soon).

> Finally if we want to introduce to Harbour core code full i18n support
> then IMHO we should also add C API for it.

True.

> I think that some upper level functions like translation tools or .pot
> files manipulations can be written as .prg code so user can easy  
> extend
> it. The low level functions and hb_i18n_gettext*() for RT performance
> should be written in C.

Yes, my C "fluency" is incomparable to yours, so maybe
I'm not the best candidate for this job :)

[ BTW, I'm currently very happy with the few low level
functions now rewritten plus my local support for this
area - in Clipper I was using a .dbf for translation -,
so any Harbour development is fully detached from
personal reasons, even the submitted code was made just
for Harbour. Of course I'd be happier to use the Harbour
parts as much as possible. ]

I'll check where codepage support stands currently.

See small attached test code for current state.

Brgds,
Viktor

-------------- next part --------------
A non-text attachment was scrubbed...
Name: testi18.prg
Type: application/octet-stream
Size: 909 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081102/97dd09c5/testi18.obj
-------------- next part --------------

From dmacias at mail.udg.mx  Sun Nov  2 08:03:55 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  2 08:03:53 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490DA53B.6010500@mail.udg.mx>

 >2008-11-02 12:25 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/source/vm/dynlibhb.c
 >    * forced casting in OS2 builds to eliminate problems with possible
 >      differences between compilers in 'char' type sign

 >  * harbour/source/rtl/filesys.c
 >    ! use _getcwd1() only in GCC OS2 builds - it's local GCC function
 >    * removed some header files from OS2 build - please test if it does
 >      not break GCC builds

Thanks Przemek

Current Harbour code compile fine with gcc335 with just well known warnings

 >Please test after:
 >   2008-11-02 12:25 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)

Done

 >Side effect if -gc3 output. You can safely ignore them or use:
 >   set PRG_USR=-gc0

Using:
  set PRG_USR=-gc0


 > Warning! W1108: file E:\WATCOM/binp/wlink.lnk: line(3): system 286 
 >defined more than once
 >[...]
 >Please try to remove from os2/owatcom.cf this line:
 >   echo @%watcom%/binp/wlink.lnk >> __link__.tmp
 >It's probably included by default and it causes repeated definitions.
 >Please also note that this line:
 >   Rem DAVID: echo LIB kernel32.lib, user32.lib, wsock32.lib, 
 >winspool.lib, oleaut32.lib, uuid.lib, comctl32.lib, mapi32.lib >> 
 >__link__.tmp
 >is written to .lnk file. Looks that linker ignores it but please try to
 >eliminate such situations - it make cause some unexpected results.

Removed both lines

With OpenWatcom 1.7:
- Screen output
-----------------------
make[3]: *** [hbmd5.obj] Error 8
make[2]: *** [descend] Error 2
make[3]: *** [thread.obj] Error 8
make[2]: *** [descend] Error 2
make[3]: [hbrun.exe] Error 1 (ignored)
make[3]: [hbtest.exe] Error 1 (ignored)
make[3]: [hbdoc.exe] Error 1 (ignored)
make[3]: [hbmake.exe] Error 1 (ignored)
make[3]: *** [hbcrypt.obj] Error 8
make[2]: *** [descend] Error 2
-----------------------

. 33 libraries created

- 2 executables created: harbour.exe, hbpp.exe

- New make_ow.log
Sent

David Macias


From harbour.01 at syenar.hu  Sun Nov  2 08:29:11 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 08:29:08 2008
Subject: [Harbour] 2008-11-02 14:28 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93cee$Blat.v2.6.2$fdd5fd74$1828510dc008@127.0.0.1>

2008-11-02 14:28 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
    ! Added all missing LANG and CODEPAGE modules.
      [TOMERGE 1.0]

  * ChangeLog
    - Removed duplicate entry of mine.

  * source/common/hbstr.c
  * source/rtl/version.c
  * source/rtl/filesys.c
    * Minor formatting.

  * source/codepage/cpcs852.c
  * source/codepage/cpsk852.c
  * source/codepage/cpcsiso.c
  * source/codepage/cpcswin.c
  * source/codepage/cpskiso.c
  * source/codepage/cpskwin.c
  * source/codepage/cpcskam.c
  * source/codepage/cpskkam.c
    * Removed unnecessary ending ';'
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  2 08:56:34 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 08:56:33 2008
Subject: [Harbour] 2008-11-02 14:56 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93cf2$Blat.v2.6.2$d11a5b8c$137c5615d79e@127.0.0.1>

2008-11-02 14:56 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
    ! Readded HB_LANG_EN.
--
Brgds,
Viktor

From bedipritpal at hotmail.com  Sun Nov  2 09:04:06 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  2 09:04:09 2008
Subject: [Harbour] MT - WorkAreas - A Feature Request
In-Reply-To: <20081101210056.GB15722@34-mo7-2.acn.waw.pl>
References: <20268713.post@talk.nabble.com>
	<20081101210056.GB15722@34-mo7-2.acn.waw.pl>
Message-ID: <20290030.post@talk.nabble.com>


Przemek

<<<
Probably I do not understand what you need. If you want to add unique
for all thread number which is you low level table ID into each open WA
then simply add it to your RDD local workarea structure and extract it:
   nTableNO := USRRDD_AREADATA( nWA )[ MYWA_TABLE ]
and use it instead of nWA directly.
>>>

I did not realize it before, thanks for guiding.
The relevant question:
What happens when a thread is finished - its thread id is reused ?
Or any new thread have unique ID? I did not experiment to check.

<<<
If you want to change the WA numbers allocating in Harbour RDD code
so they will be unique between threads then it's rather bad idea.
It will force blocking a lot of RDD code because we will need serialization
for everything what can allocate/release new WA. Many modifications,
bad performance/scalability overhead and new problems to resolve, f.e.
RT errors which can stop the thread with locked RDD internals.
>>>

I understand. I will change my methodology.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/MT---WorkAreas---A-Feature-Request-tp20268713p20290030.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  2 09:14:58 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  2 09:15:00 2008
Subject: [Harbour] MT - WorkAreas - A Feature Request
In-Reply-To: <20290030.post@talk.nabble.com>
References: <20268713.post@talk.nabble.com>
	<20081101210056.GB15722@34-mo7-2.acn.waw.pl>
	<20290030.post@talk.nabble.com>
Message-ID: <20290105.post@talk.nabble.com>


Hello

<<<
The relevant question:
What happens when a thread is finished - its thread id is reused ?
Or any new thread have unique ID? I did not experiment to check.
>>>

I was too fast. ThreadID() is always unique. This is good.
Now the question:
Ho can I generate a unique number given ThreadID() and nWA ?
Multplying both will clash for given two threads as nWA is reused
once table is closed.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/MT---WorkAreas---A-Feature-Request-tp20268713p20290105.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  2 09:22:52 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  2 09:22:56 2008
Subject: [Harbour] MT - WorkAreas - A Feature Request
In-Reply-To: <20290105.post@talk.nabble.com>
References: <20268713.post@talk.nabble.com>
	<20081101210056.GB15722@34-mo7-2.acn.waw.pl>
	<20290030.post@talk.nabble.com> <20290105.post@talk.nabble.com>
Message-ID: <20290173.post@talk.nabble.com>


Hi

<<<
Ho can I generate a unique number given ThreadID() and nWA ?
Multplying both will clash for given two threads as nWA is reused
once table is closed.
>>>

As maximum limit of workareas per thread is 65534, I can safely 
define macro as 
#define MYWORKAREA( nWA )   ( ThreadID() * nWA )
Am I right ?

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/MT---WorkAreas---A-Feature-Request-tp20268713p20290173.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sun Nov  2 10:34:21 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 10:34:17 2008
Subject: [Harbour] 2008-11-02 16:33 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93d00$Blat.v2.6.2$7a11f9a4$19ecd4760f66@127.0.0.1>

2008-11-02 16:33 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
  * common.mak
  * source/codepage/Makefile
  + source/codepage/cpro852.c
  + source/codepage/cprowin.c
    + Added Romanian codepages.
    ; TODO: Add ROISO variant.

  * source/codepage/uc1250.c
  * source/codepage/uc1251.c
  * source/codepage/uc1252.c
  * source/codepage/uc8859_5.c
  * source/codepage/uckam.c
    * Minor formatting.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  2 15:18:57 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 15:18:54 2008
Subject: [Harbour] 2008-11-02 21:15 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93d28$Blat.v2.6.2$3c28cba4$1b4073b1cd1e@127.0.0.1>

2008-11-02 21:15 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbapicdp.h
  * common.mak
  * source/codepage/Makefile
  + source/codepage/uc8859_3.c
  + source/codepage/uc8859_4.c
  + source/codepage/uc8859_6.c
  + source/codepage/uc8859_7.c
  + source/codepage/uc8859_8.c
  + source/codepage/uc8859_9.c
  + source/codepage/uc885910.c
  + source/codepage/uc885911.c
  + source/codepage/uc885913.c
  + source/codepage/uc885914.c
  + source/codepage/uc885915.c
  + source/codepage/uc885916.c
    + Added remaining 8859 codepages.
      0x00-0x1F chars are unstandard (following existing files).

  * source/codepage/uc8859_1.c
  * source/codepage/uc8859_2.c
    * Comments.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  2 16:12:42 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 16:13:04 2008
Subject: [Harbour] codepage question to Przemek
Message-ID: <3241E078-4C76-44A0-8A20-B8FE81A08803@syenar.hu>

Hi Przemek,

I'm converting a few remaining Unicode conversion tables
to the Harbour format, but I cannot decide based on the
existing ones, whether the correct behavior for non-defined
Unicode char positions should be zero or the normal ASCII
char itself?

F.e. 0x90 in uc1257.c is zero, while in uc1250 it's 0x09,
officially this position is UNDEFINED in both of these.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  2 16:24:57 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 16:34:54 2008
Subject: [Harbour] 2008-11-02 22:24 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93d31$Blat.v2.6.2$748cc366$1810933ee172@127.0.0.1>

2008-11-02 22:24 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/codepage/uc1250.c
  * source/codepage/uc1251.c
  * source/codepage/uc1252.c
  * source/codepage/uc1253.c
  * source/codepage/uc1254.c
  * source/codepage/uc1257.c
  * source/codepage/uc737.c
  * source/codepage/uc850.c
  * source/codepage/uc852.c
  * source/codepage/uc857.c
  * source/codepage/uc866.c
  * source/codepage/uc8859_1.c
  * source/codepage/uc8859_2.c
  * source/codepage/uc8859_3.c
  * source/codepage/uc8859_4.c
  * source/codepage/uc8859_5.c
  * source/codepage/uc8859_6.c
  * source/codepage/uc8859_7.c
  * source/codepage/uc8859_8.c
  * source/codepage/uc8859_9.c
  * source/codepage/uc885910.c
  * source/codepage/uc885911.c
  * source/codepage/uc885913.c
  * source/codepage/uc885914.c
  * source/codepage/uc885915.c
  * source/codepage/uc885916.c
  * source/codepage/uc88591b.c
  * source/codepage/uckam.c
  * source/codepage/uckoi8.c
  * source/codepage/uckoi8u.c
  * source/codepage/ucmaz.c
  * source/codepage/ucmik.c
    * Formatting.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  2 16:46:45 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 16:46:42 2008
Subject: [Harbour] 2008-11-02 22:45 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93d34$Blat.v2.6.2$802b570c$13a45882ee6c@127.0.0.1>

2008-11-02 22:45 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/codepage/uc1250.c
  * source/codepage/uc1251.c
  * source/codepage/uc1252.c
  * source/codepage/uc1253.c
  * source/codepage/uc1254.c
  * source/codepage/uc1257.c
  * source/codepage/uc737.c
  * source/codepage/uc850.c
  * source/codepage/uc852.c
  * source/codepage/uc857.c
  * source/codepage/uc866.c
  * source/codepage/uc8859_1.c
  * source/codepage/uc8859_2.c
  * source/codepage/uc8859_3.c
  * source/codepage/uc8859_4.c
  * source/codepage/uc8859_5.c
  * source/codepage/uc8859_6.c
  * source/codepage/uc8859_7.c
  * source/codepage/uc8859_8.c
  * source/codepage/uc8859_9.c
  * source/codepage/uc885910.c
  * source/codepage/uc885911.c
  * source/codepage/uc885913.c
  * source/codepage/uc885914.c
  * source/codepage/uc885915.c
  * source/codepage/uc885916.c
  * source/codepage/uc88591b.c
    * Formatting.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  2 16:49:52 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 16:49:57 2008
Subject: [Harbour] Re: codepage question to Przemek
In-Reply-To: <3241E078-4C76-44A0-8A20-B8FE81A08803@syenar.hu>
References: <3241E078-4C76-44A0-8A20-B8FE81A08803@syenar.hu>
Message-ID: <88739C83-9FE2-47F3-9C89-191D0968FBA1@syenar.hu>

Sorry, 1253 and 1254 are counter examples, but the
trend really looks like to leave these positions
0x0000.

Brgds,
Viktor

On 2008.11.02., at 22:12, Szak?ts Viktor wrote:

> Hi Przemek,
>
> I'm converting a few remaining Unicode conversion tables
> to the Harbour format, but I cannot decide based on the
> existing ones, whether the correct behavior for non-defined
> Unicode char positions should be zero or the normal ASCII
> char itself?
>
> F.e. 0x90 in uc1257.c is zero, while in uc1250 it's 0x09,
> officially this position is UNDEFINED in both of these.
>
> Brgds,
> Viktor
>

From harbour.01 at syenar.hu  Sun Nov  2 16:52:46 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 16:52:53 2008
Subject: [Harbour] Re: codepage question to Przemek
In-Reply-To: <88739C83-9FE2-47F3-9C89-191D0968FBA1@syenar.hu>
References: <3241E078-4C76-44A0-8A20-B8FE81A08803@syenar.hu>
	<88739C83-9FE2-47F3-9C89-191D0968FBA1@syenar.hu>
Message-ID: <C1B64252-9C7D-4430-8058-74C77EDF6DAE@syenar.hu>

and in some places 0xFFFD is used, which is "REPLACEMENT CHAR"

I think we should sync all the cps in this regard.

Brgds,
Viktor

On 2008.11.02., at 22:49, Szak?ts Viktor wrote:

> Sorry, 1253 and 1254 are counter examples, but the
> trend really looks like to leave these positions
> 0x0000.
>
> Brgds,
> Viktor
>
> On 2008.11.02., at 22:12, Szak?ts Viktor wrote:
>
>> Hi Przemek,
>>
>> I'm converting a few remaining Unicode conversion tables
>> to the Harbour format, but I cannot decide based on the
>> existing ones, whether the correct behavior for non-defined
>> Unicode char positions should be zero or the normal ASCII
>> char itself?
>>
>> F.e. 0x90 in uc1257.c is zero, while in uc1250 it's 0x09,
>> officially this position is UNDEFINED in both of these.
>>
>> Brgds,
>> Viktor
>>
>

From harbour.01 at syenar.hu  Sun Nov  2 17:11:47 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  2 17:11:43 2008
Subject: [Harbour] 2008-11-02 23:10 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93d37$Blat.v2.6.2$ff6bf7b2$1e88410406ca@127.0.0.1>

2008-11-02 23:10 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbapicdp.h
  * common.mak
  * source/codepage/Makefile
  + source/codepage/uc855.c
  + source/codepage/uc874.c
  + source/codepage/uc1256.c
  + source/codepage/uc1258.c
  + source/codepage/uc860.c
  + source/codepage/uc862.c
  + source/codepage/uc864.c
  + source/codepage/uc775.c
  + source/codepage/uc1255.c
  + source/codepage/uc861.c
  + source/codepage/uc863.c
  + source/codepage/uc865.c
  + source/codepage/uc869.c
    + Added missing IBM/Windows codepages.

  * source/rtl/cdpapi.c
    * Formatting.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  2 18:55:46 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  2 18:55:10 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <490DA53B.6010500@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490DA53B.6010500@mail.udg.mx>
Message-ID: <20081102235546.GA31731@34-mo7-2.acn.waw.pl>

On Sun, 02 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Current Harbour code compile fine with gcc335 with just well known warnings

Thanks,

> With OpenWatcom 1.7:
> - Screen output
> -----------------------
> make[3]: *** [hbmd5.obj] Error 8

../../hbmd5.c(328): Error! E473: col(22) function argument(s) do not match those in prototype
../../hbmd5.c(328): Note! N392: col(22) definition: 'unsigned long hb_fsReadLarge( int, char *, unsigned long )'

And we have a problem.
In OpenWatcom header files BYTE is defined as:
   typedef char            BYTE, *PBYTE, *NPBYTE;
By default in OpenWatcom 'char' is unsigned but looks that it does not
like such conversion. I hope that you haven't enabled -j OpenWatcom switch.
It will break final binaries. Unfortunately we are using BYTE as synonym
of 'unsigned char' in many places. I introduced UCHAR / SCHAR and
systematically update BYTE used in number context to UCHAR but there is
still a lot of code which have to be updated.
In this case it should not be a problem because it's buffer so I'll add
casting which will pacify the warnings/error message but we should keep
in mind that BYTE in some platforms can be signed and we should continue
code updating. The same is with pure 'char' casting. It can be signed or
unsigned type, it's platform/C compiler dependent so we always should
use 'unsigned char' (UCHAR) or 'signed char' (SCHAR) if sign is important.
But this I fixed few years ago and now it's only reminder for new code.

> make[3]: *** [thread.obj] Error 8

../../thread.c(1240): Error! E029: col(60) symbol '_gettid' has not been declared

_gettid() is GCC local function.
I do not see function which returns directly thread ID in OS2 API.
Probably it can be extracted from TIB structure returned by
DosGetInfoBlocks(). I cannot find simpler method. Maurilio can you help?

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  2 18:56:09 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  2 18:55:31 2008
Subject: [Harbour] 2008-11-03 00:56 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081102235609.GA30230@34-mo7-2.acn.waw.pl>

2008-11-03 00:56 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/vm/thread.c
    + added temporary workaround for non GCC OS2 ST builds

  * harbour/source/rtl/hbmd5.c
    * casting cleanup

best regards
Przemek
From dmacias at mail.udg.mx  Sun Nov  2 21:34:08 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  2 21:34:06 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490E6320.1040208@mail.udg.mx>

 > ../../hbmd5.c(328): Error! E473: col(22) function argument(s) do not
 > match those in prototype
 > ../../hbmd5.c(328): Note! N392: col(22) definition: 'unsigned long
 > hb_fsReadLarge( int, char *, unsigned long )'

 > And we have a problem.
 > In OpenWatcom header files BYTE is defined as:
 >    typedef char            BYTE, *PBYTE, *NPBYTE;
 > By default in OpenWatcom 'char' is unsigned but looks that it does not
 > like such conversion. I hope that you haven't enabled -j OpenWatcom
 > switch.

Not touched
Checked:
#CPPFLAGS = -j -w3 -d2 -5s -5r -fp5 -oxehtz -zq -zt0 -mf -bt=NT
CPPFLAGS = -w2 -d1 -zq -bt=OS2

 >It will break final binaries. Unfortunately we are using BYTE as synonym
 >of 'unsigned char' in many places. I introduced UCHAR / SCHAR and
 >systematically update BYTE used in number context to UCHAR but there is
 >still a lot of code which have to be updated.
 >In this case it should not be a problem because it's buffer so I'll add
 >casting which will pacify the warnings/error message but we should keep
 >in mind that BYTE in some platforms can be signed and we should continue
 >code updating. The same is with pure 'char' casting. It can be signed or
 >unsigned type, it's platform/C compiler dependent so we always should
 >use 'unsigned char' (UCHAR) or 'signed char' (SCHAR) if sign is 
 >important.
 >But this I fixed few years ago and now it's only reminder for new code.

As I see is a known problem, C compiler dependent, and work in progress 
to update code

 > make[3]: *** [thread.obj] Error 8

 >../../thread.c(1240): Error! E029: col(60) symbol '_gettid' has not been
 >declared

 >_gettid() is GCC local function.
 >I do not see function which returns directly thread ID in OS2 API.
 >Probably it can be extracted from TIB structure returned by
 >DosGetInfoBlocks(). I cannot find simpler method. Maurilio can you help?

OK

 >2008-11-03 00:56 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/source/vm/thread.c
 >    + added temporary workaround for non GCC OS2 ST builds

 >  * harbour/source/rtl/hbmd5.c
 >    * casting cleanup

Thanks Przemek

Current Harbour code compile fine with gcc335 with just well known warnings

With OpenWatcom 1.7:
- Screen output
-----------------------
make[3]: *** [hbinet.obj] Error 9
make[2]: *** [descend] Error 2
make[4]: *** [thread.obj] Error 8
make[3]: *** [descend] Error 2
make[2]: *** [first] Error 2
make[3]: [hbrun.exe] Error 1 (ignored)
make[3]: [hbtest.exe] Error 1 (ignored)
make[3]: [hbdoc.exe] Error 1 (ignored)
make[3]: [hbmake.exe] Error 1 (ignored)
make[3]: *** [hbcrypt.obj] Error 8
make[2]: *** [descend] Error 2
-----------------------

. 34 libraries created (one more)

- 2 executables created: harbour.exe, hbpp.exe

- New make_ow.log
Sent

David Macias


From harbour.01 at syenar.hu  Mon Nov  3 01:19:40 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 01:19:47 2008
Subject: [Harbour] codepage and RDD
Message-ID: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>

Hi Przemek and all,

Shouldn't we add a way to set the default
codepage for RDD operations?

Right now I could pass it to each RDD function
call (like dbCreate()) but that needs touching
all such possible calls (which is error prone),
moreover using a "dirty" parameter extension.
Also, usually the RDD CP is global to an app's
database.

Right now I'm using hb_setcodepage(), but this
may not be enough given that it could depend on
UI/app language, so it may be bit different than
db cp (which is not ideal, but may happen).

Brgds,
Viktor

From dmacias at mail.udg.mx  Mon Nov  3 02:47:48 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov  3 02:47:48 2008
Subject: [Harbour] Re: C53b vs Harbour and VBox shared folders
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490EACA4.6010008@mail.udg.mx>

[Lorenzo]
>I'm using Sun's VBox 2.0.4 under Ubuntu 8.04 with a Win2000Sp4 VM.
 >I use it to maintain C53b/FW16 apps and to build Harbour using
 >msys/mingw and I access datas that are in the host ( Ubuntu ) using
 >VBox's shared folders.
 >Now if I build the apps using C53b/Fw16 they work ( slowly ) while the
 >same apps ( with many #ifdef of course )  hang at start with Harbour.
 >If I copy the data in the VM C: drive they work of course.

 >I've tried to use gdb but it simply hang and often the entire VM need
 >to be closed.

 >Clearly it is not an Harbour problem but since C53b works it would be
 >nice to know where the "problem" can be so I could try to forward the
 >info to the Sun's developers.

[Przemek]
 >I also think that file locking is 1-st candidate.
 >Try to isolate the problem with small example which
 >creates/open DBF with indexes.

I have about six months using Mandriva 2008.1 - VirtualBox - WinXPPSP2, 
started with VBox 1.5.6 and now is 2.0.4

All this time I used Samba/shares to access NTFS/FAT32 partitions with 
WinXPPSP2 VM and everything work fine with Harbour and disk access

Now I replaced Samba/shares with "Shared Folders" and running same 
programs WinXPPSP2 reboot with screen "to protect itself" ( a text 
screen with a lot of info about drivers failures, ... and reboot to 
protect )

This failure happen using:
   nHandler := FOPEN( cDestino, FO_READWRITE+FO_SHARED )
and NOT using DBF/CDX files

Other program work fine using DBF/CDX files, not tested writing on file

As I can see there are a problem with Shared Folders / Harbour disk access

David Macias

From harbour.01 at syenar.hu  Mon Nov  3 02:58:33 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 02:58:28 2008
Subject: [Harbour] 2008-11-03 08:57 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93d89$Blat.v2.6.2$f7e5ef28$1124fa0d990a@127.0.0.1>

2008-11-03 08:57 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
  * source/codepage/Makefile
  + source/codepage/cproiso.c
  + source/codepage/cpfriso.c
  + source/codepage/cpfrwin.c
    + Added new CPs.

  - source/codepage/cphr1250.c
  + source/codepage/cphrwin.c
    * Renamed to follow the rest of the CPs.
      INCOMPATIBLE.

  * source/codepage/cpfr850.c
    ! Fixed uppercase chars.
      [TOMERGE 1.0]
--
Brgds,
Viktor

From dmacias at mail.udg.mx  Mon Nov  3 03:20:34 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov  3 03:20:30 2008
Subject: [Harbour] OT: Universal System
Message-ID: <490EB452.5050407@mail.udg.mx>

"A new model of systems development     :-)

Of course, Clipxnet is part of this model"

I used that words when I presented this work in September 2005
Now I have many systems working with this model and some of them do 
complex tasks easily across Internet

It is a powerful alternative   :-)

For me work very fine and for others must work too

The key is to replace Web-browsers with modified desktop systems in 
client side to interact with Clipxnet in server side

Now I update sample using Harbour 1.0.0

Example/doc/source are in sisremoto.zip

sisremoto.exe was created for local tests with Clipxnet installed

Review sisremeng.txt

Gracias,
David Macias


You can download from:
----------------------------------------------------------------------------
ftp://sbe4730:damac@ftp.ftp.itcgrupo.es/
----------------------------------------------------------------------------

Citlalli:
- Unpack file in any separate directory
- Run hcitxnet.exe to see samples
- Use cit_32.lib for Harbour, cit_32x.lib for xHarbour, and cit_16.lib 
for Clipper 5.3
Review hcitxnet.bat, xcitxnet.bat, citxnet.bat to see how to include 
libraries

Clipxnet:
- Unpack file in  \clipxnet ( /clipxnet )
- Review clipxnet.htm for configuration instructions, and clipeng.htm 
for English


You can suscribe to group to share information about Citlalli and Clipxnet

  http://mx.groups.yahoo.com/group/clipxnet_citlalli/


Any comments are welcome

Gracias,
David Macias


From maurilio.longo at libero.it  Mon Nov  3 03:36:25 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Mon Nov  3 03:36:32 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20081102235546.GA31731@34-mo7-2.acn.waw.pl>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>	<490DA53B.6010500@mail.udg.mx>
	<20081102235546.GA31731@34-mo7-2.acn.waw.pl>
Message-ID: <490EB809.8010705@libero.it>

Przemyslaw,

I've not tested this code, but something like this should give you the thread id.

unsigned long _gettid()
{
   PTIB   ptib = NULL;
   APIRET rc;

   rc = DosGetInfoBlocks(&ptib, NULL);

   return ptib->tib_ptib2->tib2_ultid;
}

Hope this help.

Maurilio.

Przemyslaw Czerpak wrote:
> On Sun, 02 Nov 2008, David Arturo Macias Corona wrote:
> 
> Hi David,
> 
>> Current Harbour code compile fine with gcc335 with just well known warnings
> 
> Thanks,
> 
>> With OpenWatcom 1.7:
>> - Screen output
>> -----------------------
>> make[3]: *** [hbmd5.obj] Error 8
> 
> ../../hbmd5.c(328): Error! E473: col(22) function argument(s) do not match those in prototype
> ../../hbmd5.c(328): Note! N392: col(22) definition: 'unsigned long hb_fsReadLarge( int, char *, unsigned long )'
> 
> And we have a problem.
> In OpenWatcom header files BYTE is defined as:
>    typedef char            BYTE, *PBYTE, *NPBYTE;
> By default in OpenWatcom 'char' is unsigned but looks that it does not
> like such conversion. I hope that you haven't enabled -j OpenWatcom switch.
> It will break final binaries. Unfortunately we are using BYTE as synonym
> of 'unsigned char' in many places. I introduced UCHAR / SCHAR and
> systematically update BYTE used in number context to UCHAR but there is
> still a lot of code which have to be updated.
> In this case it should not be a problem because it's buffer so I'll add
> casting which will pacify the warnings/error message but we should keep
> in mind that BYTE in some platforms can be signed and we should continue
> code updating. The same is with pure 'char' casting. It can be signed or
> unsigned type, it's platform/C compiler dependent so we always should
> use 'unsigned char' (UCHAR) or 'signed char' (SCHAR) if sign is important.
> But this I fixed few years ago and now it's only reminder for new code.
> 
>> make[3]: *** [thread.obj] Error 8
> 
> ../../thread.c(1240): Error! E029: col(60) symbol '_gettid' has not been declared
> 
> _gettid() is GCC local function.
> I do not see function which returns directly thread ID in OS2 API.
> Probably it can be extracted from TIB structure returned by
> DosGetInfoBlocks(). I cannot find simpler method. Maurilio can you help?
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From maurilio.longo at libero.it  Mon Nov  3 03:38:43 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Mon Nov  3 03:38:47 2008
Subject: [Harbour] Re: C53b vs Harbour and VBox shared folders
In-Reply-To: <490EACA4.6010008@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490EACA4.6010008@mail.udg.mx>
Message-ID: <490EB893.1040502@libero.it>

David,

you should send a bug report to sun, IMHO.

Best regards.

Maurilio.

David Arturo Macias Corona wrote:
> 
> Now I replaced Samba/shares with "Shared Folders" and running same
> programs WinXPPSP2 reboot with screen "to protect itself" ( a text
> screen with a lot of info about drivers failures, ... and reboot to
> protect )
> 
> This failure happen using:
>   nHandler := FOPEN( cDestino, FO_READWRITE+FO_SHARED )
> and NOT using DBF/CDX files
> 
> Other program work fine using DBF/CDX files, not tested writing on file
> 
> As I can see there are a problem with Shared Folders / Harbour disk access
> 
-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From M.Horodyski at pzuzycie.com.pl  Mon Nov  3 03:45:15 2008
From: M.Horodyski at pzuzycie.com.pl (Horodyski Marek (PZUZ))
Date: Mon Nov  3 03:45:49 2008
Subject: [Harbour] My test for mutex and Semafors.
In-Reply-To: <NLB01FEz2Mb1s7nlT2N0000eb88@gatein.pzuzycie.com.pl>
Message-ID: <FFAFD6EA63A3FC4784FBDA52BE7A7C9501842C2E@PINK.zycie.pzu>

Primo :
When i type :

hbmk_b32.bat -w2 -mt -gui mttest00.prg

then on screen i have :

C:\harbour\tests\mt>hbmk_b32.bat -w2 -mt -gui mttest00.prg
Error F0034  Bad command line option '.'

Syntax:  c:\Harbour\bin\harbour.exe <file[s][.prg]|@file> [options]
[...]

but exe without name is created :

?                       Name                        ?  Size   ?  Date  ?Time ?
?..                                                 ?<UP--DIR>?08-11-02?12:57?
?.exe                                               ?  549 888?08-11-02?12:57?
?.tds                                               ?  458 752?08-11-02?12:57?
?mttest00                                        exe?  572 928?08-11-02?12:57?
?mttest00                                        prg?      124?08-11-02?08:02?


Secudo :
I have write Mutex test :
>>>>>>>>>>>>>>>>>>>
#include "inkey.ch"
#ifdef __PLATFORM__WINDOWS
   REQUEST HB_GT_WVT_DEFAULT
   #define THREAD_GT hb_gtVersion()
#else
   REQUEST HB_GT_STD_DEFAULT
   #define THREAD_GT "XWC"
#endif

/* 2 x mutex to synchronize thteads*/
STATIC critical, flag
Function main()
   // s_mainThreadID := hb_threadSelf()
   Local aThreads := {}
   Local appName := { ;
         { 'app_01', '{||  1}'}, ;
         { 'app_02', '{||  2}'}, ;
         { 'app_03', '{||  3}'}, ;
         { 'app_04', '{||  4}'}, ;
         { 'app_05', '{||  5}'}, ;
         { 'app_06', '{||  6}'}, ;
         { 'app_07', '{||  7}'}, ;
         { 'app_08', '{||  8}'}, ;
         { 'app_09', '{||  9}'}, ;
         { 'app_10', '{|| 10}'}, ;
         { 'app_11', '{|| 11}'}, ;
         { 'app_12', '{|| 12}'}, ;
         { 'app_13', '{|| 13}'}, ;
         { 'app_14', '{|| 14}'}, ;
         { 'app_15', '{|| 15}'}, ;
         { 'app_16', '{|| 16}'}, ;
         { 'app_17', '{|| 17}'}, ;
         { 'app_18', '{|| 18}'}, ;
         { 'app_19', '{|| 19}'}, ;
         { 'app_20', '{|| 20}'}}
   Local n
   critical := hb_mutexCreate()
   flag     := hb_mutexCreate()
   ? "I'm Parent, to order have first generate window ... "
   For n := 1 to 5 * Len( appName)
       aadd( aThreads, hb_threadStart( @runApp(), appName[ hb_Random( 1, Len( appName))], Len( aThreads) + 1))
   Next
  ? "Waiting for threads"
  while inkey() != K_ESC
     if hb_threadWait( aThreads, .1, .t. ) == len( aThreads )
        // all threads ends
        wait 'W?tki wysz?y, konczymy test ...'
        exit
     endif
  enddo
Return Nil
*------------------
Function runApp( appName, count)
  STATIC appStorage := {}
  Local n, c := Upper( appName[1]), find := { |x| x[ 1] == c}, executeTime := 60
  // If hb_Random() > .2 ; hb_gtReload( THREAD_GT )
  // End
  hb_gtReload( THREAD_GT )
  ? "Here thread ", hb_threadSelf(), ". I mus run ", c
  hb_gtInfo( 26, Str( count, 3, 0) + ' - ' + c)
  InKey( hb_Random())
  If ( n := Ascan( appStorage, find)) != 0
     ? 'The app is in storage, I can run it - ', appStorage[ n, 2]:Eval()
     executeTime := 1
  Else
     While !Semaphore( c, 1) ; hb_idleSleep( .3)
     End
     If ( n := Ascan( appStorage, find)) != 0
        Semaphore( c, 0)
        hb_gtInfo( 26, 'Another process is win !!!')
        ? 'Another thread was compiled it. I can run it. ', appStorage[ n, 2]:Eval()
        executeTime := 5
     Else
        ? "I have first acces, I mus compile and next can run it! : ", appName[ 2]
        begin sequence
          hb_mutexLock( flag)
          AADD( appStorage, { c, &( appName[ 2])})
          n := Len( appStorage)
          appName[ 2] := 'error error error' // to generate error when another thread can acces to this element!
        always
          hb_mutexUnLock( flag)
          Semaphore( c, 0)
        end sequence
        ?? appStorage[ n, 2]:Eval()
     End
  End
  InKey( executeTime)
Return Nil
*------------------
Function Semaphore( semafor, action)
  Static semStor := {}
  Local succes := .t., n
  switch action
  case 0
   hb_mutexLock( flag)
   If (n := Ascan( semStor, semafor)) != 0 ; Adel( semStor, n) ; Asize( semStor, Len( semStor) - 1)
   End
   hb_mutexUnLock( flag)
   exit
  case 1 // default
   If   (n := Ascan( semStor, semafor)) != 0 ; succes := .f.
   Else
     hb_mutexLock( flag)
     If   (n := Ascan( semStor, semafor)) != 0 ; succes := .f.
     Else
          AADD( semStor, semafor)
     End
     hb_mutexUnLock( flag)
   End
  endswitch
Return succes
*------------------
<<<<<<<<<<<<<<<<<<<

All works ok., but I don't see window with string 'Another thread was compiled it. I can run it. '
To simulate ral life, I add Inkey( ... ) :


>>>>>>>>>
Function runApp( appName, count)
  STATIC appStorage := {}
  Local n, c := Upper( appName[1]), find := { |x| x[ 1] == c}, executeTime := 60
  // If hb_Random() > .2 ; hb_gtReload( THREAD_GT )
  // End
  hb_gtReload( THREAD_GT )
  ? "Here thread ", hb_threadSelf(), ". I mus run ", c
  hb_gtInfo( 26, Str( count, 3, 0) + ' - ' + c)
  InKey( hb_Random())
  If ( n := Ascan( appStorage, find)) != 0
     ? 'The app is in storage, I can run it - ', appStorage[ n, 2]:Eval()
     executeTime := 1
  Else
     While !Semaphore( c, 1) ; hb_idleSleep( .3)
     End
     If ( n := Ascan( appStorage, find)) != 0
        Semaphore( c, 0)
        hb_gtInfo( 26, 'Another process is win !!!')
        ? 'Another thread was compiled it. I can run it. ', appStorage[ n, 2]:Eval()
        executeTime := 5
     Else
        ? "I have first acces, I mus compile and next can run it! : ", appName[ 2]
        begin sequence
          hb_mutexLock( flag)
          AADD( appStorage, { c, &( appName[ 2])})

*>>>    HERE  !

          InKey( hb_Random()) // delay to compile big app

*<<<
          n := Len( appStorage)
          appName[ 2] := 'error error error' // to generate error when another thread can acces to this element!
        always
          hb_mutexUnLock( flag)
          Semaphore( c, 0)
        end sequence
        ?? appStorage[ n, 2]:Eval()
     End
  End
  InKey( executeTime)
Return Nil
<<<<<<<<<<<<<<<<<<<<<<<<<<<

AND IN THIS VERSION ALL THREADS ARE HANGS !!!!


When I change to to this version :

>>>>>>>>>>>>>>>>>>>>>>>
Function runApp( appName, count)
  STATIC appStorage := {}
  Local n, c := Upper( appName[1]), find := { |x| x[ 1] == c}, executeTime := 240, delay
  // If hb_Random() > .2 ; hb_gtReload( THREAD_GT )
  // End
  hb_gtReload( THREAD_GT )
  ? "Here thread ", hb_threadSelf(), ". I mus run ", c
  hb_gtInfo( 26, Str( count, 3, 0) + ' - ' + c)
  InKey( hb_Random())
  If ( n := Ascan( appStorage, find)) != 0
     ? 'The app is in storage, I can run it - ', appStorage[ n, 2]:Eval()
     executeTime := 1
  Else
     While !Semaphore( c, 1) ; hb_idleSleep( .3)
     End
     If ( n := Ascan( appStorage, find)) != 0
        Semaphore( c, 0)
        hb_gtInfo( 26, 'Another process is win !!!')
        ? 'Another thread was compiled it. I can run it. ', appStorage[ n, 2]:Eval()
        executeTime := 5
     Else
        ? "I have first acces, I mus compile and next can run it! : ", appName[ 2]
        begin sequence
          hb_mutexLock( flag)
          AADD( appStorage, { c, &( appName[ 2])})

*----------   HERE !!!!

          // InKey( hb_Random()) // delay to compile big app
          delay := Seconds() + 1
          While seconds() < delay
          End

*-----------
          n := Len( appStorage)
          appName[ 2] := 'error error error' // to generate error when another thread can acces to this element!
        always
          hb_mutexUnLock( flag)
          Semaphore( c, 0)
        end sequence
        ?? appStorage[ n, 2]:Eval()
     End
  End
  InKey( executeTime)
Return Nil
<<<<<<<<<<<<<<<<<<<<<<<

All apps was quickened, and many window has label "Another thread was compiled it. I can run it.", that inform about other winner process.
Mutex are PRETTY and make good job.

But my ask is :
 We don't can use InKey( ... ) when some kind mutex is locked ?

Regards,
Marek Horodyski
From dmacias at mail.udg.mx  Mon Nov  3 03:55:04 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov  3 03:55:03 2008
Subject: [Harbour] OT: New version of ClipNet-xNet Model
Message-ID: <490EBC68.702@mail.udg.mx>

Sorry for delay, I updated Clipxnet in September 16, 2008


I inform you about availability of new version of ClipNet-xNet Model

Summary of modifications:

Not translated, not included. Review in Spanish version
27.  August 2008: Enlargement of the ClipNet-xNet Model
       27a. Update based in (x)Harbour code
       27b. Nomenclature of Clipxnet files
       27c. ADORDD support
       27d. Example of ADS in SQL mode
       27e. Update of existing Clipxnet


- ClipNet-xNet Model
Clipper language interpreter using:
* command line
* Web Servers, for Web based systems

You can download from:
----------------------------------------------------------------------------
ftp://sbe4730:damac@ftp.ftp.itcgrupo.es/
----------------------------------------------------------------------------

- Extract file in directory \clipxnet ( /clipxnet )
- Review clipxeng.htm for configuration instructions,
  and new modifications in section:
    27.  August 2008: Enlargement of the ClipNet-xNet Model

You may suscribe to group for share information on Citlalli and Clipxnet:

  http://mx.groups.yahoo.com/group/clipxnet_citlalli/


Any comment are welcome

Gracias,
David Macias


From harbour.01 at syenar.hu  Mon Nov  3 03:56:43 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 03:56:39 2008
Subject: [Harbour] 2008-11-03 09:56 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93d92$Blat.v2.6.2$180dc066$1700363b1480@127.0.0.1>

2008-11-03 09:56 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/fileio.ch
    * Formatting.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov  3 04:02:20 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 04:02:27 2008
Subject: [Harbour] My test for mutex and Semafors.
In-Reply-To: <FFAFD6EA63A3FC4784FBDA52BE7A7C9501842C2E@PINK.zycie.pzu>
References: <FFAFD6EA63A3FC4784FBDA52BE7A7C9501842C2E@PINK.zycie.pzu>
Message-ID: <6D4A47FC-CBD2-4C4D-9728-87026E504B0E@syenar.hu>

>
Hi Marek,

> hbmk_b32.bat -w2 -mt -gui mttest00.prg
>
> then on screen i have :
>
> C:\harbour\tests\mt>hbmk_b32.bat -w2 -mt -gui mttest00.prg
> Error F0034  Bad command line option '.'

hbmk*.bat will only recognize -gui and -mt, and
they should precede the filename. (see more in the help
of hbmk.bat)

For anything more complicated, you should use PRG_USR
and the other envvars.

[ BTW such report was exactly the reason why I didn't
want to add any switches to hbmk*.bats, it creates
confusions and false expectations, and there is no
reasonable way to resolve these issues in a batch file. ]

Brgds,
Viktor

From jfl at mafact.com  Mon Nov  3 04:41:00 2008
From: jfl at mafact.com (J. Lefebvre)
Date: Mon Nov  3 04:41:53 2008
Subject: [Harbour] OT: New version of ClipNet-xNet Model
In-Reply-To: <490EBC68.702@mail.udg.mx>
Message-ID: <60750598.1c93d98.3216e23.29@mafact.com>

Bad link ...

The correct one is : ftp://sbe4730:damac@ftp.itcgrupo.es/

Regards,

-----Message d'origine-----
De?: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] De la part de David Arturo Macias Corona
Envoy??: lundi 3 novembre 2008 9:55
??: harbour@harbour-project.org
Objet?: [Harbour] OT: New version of ClipNet-xNet Model

Sorry for delay, I updated Clipxnet in September 16, 2008


I inform you about availability of new version of ClipNet-xNet Model

Summary of modifications:

Not translated, not included. Review in Spanish version
27.  August 2008: Enlargement of the ClipNet-xNet Model
       27a. Update based in (x)Harbour code
       27b. Nomenclature of Clipxnet files
       27c. ADORDD support
       27d. Example of ADS in SQL mode
       27e. Update of existing Clipxnet


- ClipNet-xNet Model
Clipper language interpreter using:
* command line
* Web Servers, for Web based systems

You can download from:
----------------------------------------------------------------------------
ftp://sbe4730:damac@ftp.ftp.itcgrupo.es/
----------------------------------------------------------------------------

- Extract file in directory \clipxnet ( /clipxnet )
- Review clipxeng.htm for configuration instructions,
  and new modifications in section:
    27.  August 2008: Enlargement of the ClipNet-xNet Model

You may suscribe to group for share information on Citlalli and Clipxnet:

  http://mx.groups.yahoo.com/group/clipxnet_citlalli/


Any comment are welcome

Gracias,
David Macias


_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Nov  3 05:01:11 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 05:01:30 2008
Subject: [Harbour] GPF in dbCloseAll()
Message-ID: <EBD25DE6-55B9-48B4-B5E1-3A75C1632FDD@syenar.hu>

Hi all,

This code will consistently GPF (tried in 1.0.1 BCC 5.5,
current 1.0.1dev with MSVC 2005, and a bit older 1.1.0dev with BCC 5.8)

---
PROC Main()
      USE nothere // This file should not exist, and a QUIT should be  
selected in the RTE alert.
      RETURN

EXIT PROCEDURE App_Exit()
      dbCloseAll()
      RETURN
---

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov  3 05:21:23 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 05:21:22 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>

2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
  * source/codepage/Makefile
  - source/codepage/cpesmwin.c
  + source/codepage/cpeswinm.c
  + source/codepage/cpesiso.c
  + source/codepage/cpesisom.c
    * Renamed cpesmwin -> cpeswinm (ESMWIN -> ESWINM) (INCOMPATIBLE)
    + Added Spanish ISO natsort modules. Besides their ID, 
      they are idendical with current ESWIN* natsorts, because 
      the WIN versions for some reason are using ISO-8859 CP 
      instead of Windows-*. This is IMO wrong, even if these CPs 
      are similar or identical for the Spanish language.
--
Brgds,
Viktor

From e.m.giordano at emagsoftware.it  Mon Nov  3 05:27:45 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Nov  3 05:27:50 2008
Subject: [Harbour] Errors in latest SVN
Message-ID: <9A1CC8CBF9834706800D51949176CE58@emag>

Error: Unresolved external '_HB_FUN_HB_CODEPAGE_ESMWIN' referenced from 
E:\HARBOUR CVS\HARBOUR\LIB\B32\HBEXTERN.LIB|hbextern
Error: Unresolved external '_HB_FUN_HB_CODEPAGE_HR1250' referenced from 
E:\HARBOUR CVS\HARBOUR\LIB\B32\HBEXTERN.LIB|hbextern

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Mon Nov  3 06:13:41 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 06:13:46 2008
Subject: [Harbour] 2008-11-03 12:13 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93da5$Blat.v2.6.2$3a5a6783$10f03d1236bc@127.0.0.1>

2008-11-03 12:13 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
    ! Synced codepage list with recent changes.
--
Brgds,
Viktor

From mbelgrano at deltain.it  Mon Nov  3 06:14:56 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov  3 06:15:50 2008
Subject: [Harbour] OT: New version of ClipNet-xNet Model
In-Reply-To: <60750598.1c93d98.3216e23.29@mafact.com>
References: <490EBC68.702@mail.udg.mx> <60750598.1c93d98.3216e23.29@mafact.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F129@SRV02.deltain.net>

What is on Citlalli and what Clipxnet?
Witch is new model of systems development     :-) , how Clipxnet is part of this model"?
Replace Web-browsers with modified desktop systems in client side to interact with Clipxnet in server side
What is modified desktop sistem?

>This "Universal System" consists of two parts:
>A) Client system
>   Usually is a Web navigator (web explorer)
>   In this case the navigator is replaced by a classic "desktop system"
Wich is "desktop system" in sisremoto ?
>B) Server system

Can you show same screenshot for better compression?
I have runned sisremoto but sorry, I don't understand
But I am intresting in idea of something like a web browser for web application
Can you help me?


-----Original Message-----
From: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] On Behalf Of J. Lefebvre
Sent: Monday, November 03, 2008 10:41 AM
To: 'Harbour Project Main Developer List.'
Subject: RE: [Harbour] OT: New version of ClipNet-xNet Model

Bad link ...

The correct one is : ftp://sbe4730:damac@ftp.itcgrupo.es/

Regards,

-----Message d'origine-----
De?: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] De la part de David Arturo Macias Corona
Envoy??: lundi 3 novembre 2008 9:55
??: harbour@harbour-project.org
Objet?: [Harbour] OT: New version of ClipNet-xNet Model

Sorry for delay, I updated Clipxnet in September 16, 2008


I inform you about availability of new version of ClipNet-xNet Model

Summary of modifications:

Not translated, not included. Review in Spanish version
27.  August 2008: Enlargement of the ClipNet-xNet Model
       27a. Update based in (x)Harbour code
       27b. Nomenclature of Clipxnet files
       27c. ADORDD support
       27d. Example of ADS in SQL mode
       27e. Update of existing Clipxnet


- ClipNet-xNet Model
Clipper language interpreter using:
* command line
* Web Servers, for Web based systems

You can download from:
----------------------------------------------------------------------------
ftp://sbe4730:damac@ftp.ftp.itcgrupo.es/
----------------------------------------------------------------------------

- Extract file in directory \clipxnet ( /clipxnet )
- Review clipxeng.htm for configuration instructions,
  and new modifications in section:
    27.  August 2008: Enlargement of the ClipNet-xNet Model

You may suscribe to group for share information on Citlalli and Clipxnet:

  http://mx.groups.yahoo.com/group/clipxnet_citlalli/


Any comment are welcome

Gracias,
David Macias


_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From mbelgrano at deltain.it  Mon Nov  3 06:34:12 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov  3 06:35:18 2008
Subject: [Harbour] 2008-11-03 12:13 UTC+0200 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <01c93da5$Blat.v2.6.2$3a5a6783$10f03d1236bc@127.0.0.1>
References: <01c93da5$Blat.v2.6.2$3a5a6783$10f03d1236bc@127.0.0.1>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F12A@SRV02.deltain.net>

What HB_SetCodePage() do?
Wich codepage are supported?
Wich relationship from having a codepage support in rdd and in gt?
Wich is status of support of unicode ?


-----Original Message-----
From: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] On Behalf Of Szak?ts Viktor
Sent: Monday, November 03, 2008 12:14 PM
To: harbour@harbour-project.org
Subject: [Harbour] 2008-11-03 12:13 UTC+0200 Viktor Szakats (harbour.01syenar hu)

2008-11-03 12:13 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
    ! Synced codepage list with recent changes.
--
Brgds,
Viktor

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From druzus at acn.waw.pl  Mon Nov  3 07:10:05 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 07:09:32 2008
Subject: [Harbour] GPF in dbCloseAll()
In-Reply-To: <EBD25DE6-55B9-48B4-B5E1-3A75C1632FDD@syenar.hu>
References: <EBD25DE6-55B9-48B4-B5E1-3A75C1632FDD@syenar.hu>
Message-ID: <20081103121005.GB31731@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> This code will consistently GPF (tried in 1.0.1 BCC 5.5,
> current 1.0.1dev with MSVC 2005, and a bit older 1.1.0dev with BCC 5.8)
> ---
> PROC Main()
>      USE nothere // This file should not exist, and a QUIT should be selected in the RTE alert.
>      RETURN
> EXIT PROCEDURE App_Exit()
>      dbCloseAll()
>      RETURN
> ---

Exactly and it's an example of the problem I was talking about when
user code closes open WA when some other code still operates on it.
EXIT procedures in ST mode are executed just after QUIT in RT error
before control returns to RDD. It's Clipper compatible behavior.
In MT mode I change it to execute EXIT procedures after leaving all
functions by all threads so this code will not exploit the problem
but it does not fix it. Such situation can be created also in other
ways too, f.e. custom error handler can close WA on which someone
operates. To resolve it we will need similar mechanism to the one I
added to GT code and each time WA pointer is accessed then it should
be later freed. In GT it's done by hb_gt_Base()/hb_gt_BaseFree() and
it will force many modifications in existing RDD code.
We can also try to create some partial solution but it will only
reduce the problem.
The effect of the above code depends on memory context. After
dbCloseAll() the RDD code will operate on freed memory where
WA were located. It may cause GPF or not but of course it serious
bug.

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov  3 07:17:22 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 07:16:43 2008
Subject: [Harbour] 2008-11-03 08:57 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c93d89$Blat.v2.6.2$f7e5ef28$1124fa0d990a@127.0.0.1>
References: <01c93d89$Blat.v2.6.2$f7e5ef28$1124fa0d990a@127.0.0.1>
Message-ID: <20081103121722.GC31731@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>   * source/codepage/cpfr850.c
>     ! Fixed uppercase chars.

Are you sure that this modification is correct. Such things should be
done by users who know and use given language. And of course it should
be checked with Clipper because it may break binary compatibility in
index files.
We should document which CPs are Clipper compatible and should not be
touched.

best regards,
Przemek
From e.m.giordano at emagsoftware.it  Mon Nov  3 07:30:12 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Nov  3 07:30:16 2008
Subject: [Harbour] 2008-11-03 12:13 UTC+0200 Viktor Szakats
	(harbour.01syenar hu)
References: <01c93da5$Blat.v2.6.2$3a5a6783$10f03d1236bc@127.0.0.1>
Message-ID: <CE2A158F39864AF7A5E64A4339E00245@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: <harbour@harbour-project.org>
Data invio: luned? 3 novembre 2008 12.13
Oggetto: [Harbour] 2008-11-03 12:13 UTC+0200 Viktor Szakats 
(harbour.01syenar hu)


> 2008-11-03 12:13 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>  * include/hbextern.ch
>    ! Synced codepage list with recent changes.

Thank you. It's ok now.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From druzus at acn.waw.pl  Mon Nov  3 07:33:27 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 07:32:50 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <490EB809.8010705@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490DA53B.6010500@mail.udg.mx>
	<20081102235546.GA31731@34-mo7-2.acn.waw.pl>
	<490EB809.8010705@libero.it>
Message-ID: <20081103123327.GD31731@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> I've not tested this code, but something like this should give you the thread id.
> unsigned long _gettid()
> {
>    PTIB   ptib = NULL;
>    APIRET rc;
> 
>    rc = DosGetInfoBlocks(&ptib, NULL);
> 
>    return ptib->tib_ptib2->tib2_ultid;
> }
> Hope this help.

Yes, thanks. I hoped that maybe there is simpler version then using
DosGetInfoBlocks() but we can also use this. Thank you very much.

best regards,
Przemek
From miguelangel at marchuet.net  Mon Nov  3 07:35:37 2008
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Mon Nov  3 07:33:17 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
Message-ID: <490EF019.9050104@marchuet.net>

If the intention was to break code on the whim of changing the name, you've accomplished.

If what you wanted was to create a ESISO, you can add only this, but do it well and not copying the codepage ESMWIN

ESMWIN codepage is a consensus among various programmers to make it compatible with the codepage "Modern_spanish" that Microsoft 
uses in its applications, and that is also compatible with all other languages "Latin" without characters above 256 (utf8).

for example this collation is compatible with french, portuguese, spanish, catalanish, galician and italian (COMPATIBLE)

This codepages are ansi collation codepages. And are not ISO, really is a merge of codepages to to use only one in countries
where are speaked more than on language as spain.

If is possible, please revert the name changed. And remove the new one copy.

What about backguard compatibilitie....

Best regards,
Miguel Angel Marchuet

Szak?ts Viktor escribi?:
> 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>   * common.mak
>   * source/codepage/Makefile
>   - source/codepage/cpesmwin.c
>   + source/codepage/cpeswinm.c
>   + source/codepage/cpesiso.c
>   + source/codepage/cpesisom.c
>     * Renamed cpesmwin -> cpeswinm (ESMWIN -> ESWINM) (INCOMPATIBLE)
>     + Added Spanish ISO natsort modules. Besides their ID, 
>       they are idendical with current ESWIN* natsorts, because 
>       the WIN versions for some reason are using ISO-8859 CP 
>       instead of Windows-*. This is IMO wrong, even if these CPs 
>       are similar or identical for the Spanish language.

SORRY BUT IS NOT AN ISO CODEPAGE

> --
> Brgds,
> Viktor
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> __________ Informaci?n de ESET NOD32 Antivirus, versi?n de la base de firmas de virus 3576 (20081102) __________
> 
> ESET NOD32 Antivirus ha comprobado este mensaje.
> http://www.eset.com
> 
> 
> 

From harbour.01 at syenar.hu  Mon Nov  3 07:36:14 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 07:36:24 2008
Subject: [Harbour] 2008-11-03 08:57 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081103121722.GC31731@34-mo7-2.acn.waw.pl>
References: <01c93d89$Blat.v2.6.2$f7e5ef28$1124fa0d990a@127.0.0.1>
	<20081103121722.GC31731@34-mo7-2.acn.waw.pl>
Message-ID: <BE5E50B2-E32E-4B27-8368-60A3FEAF777C@syenar.hu>

Hi Przemek,

I've been following the instructions in these files, which
say, the first string should be the exact same string as
the second, but in upper case. Now, in French these accented
chars are present in IBM850, so they should IMO be included.
Accented chars in French are also considered with the same
weight as unaccented versions (accented ones are not part
of the official alphabet per se).

Because there wasn't any indication of the strange previous
behavior in the file, I cannot tell the reason behind it.
Maybe it was Clipper compatibility.

I've found original Clipper ntxfre.obj and mdxfre.obj, and
for one thing (and on first binary spot) they seem to be
different from each other. And they are both different from
both the old Harbour version and also probably from the
current one. I'll do some tests ASAP.

You're right though that such Clipper compatibility
comments are useful, I've added such for all HU collations
long ago. Maybe we should keep simply name those collations
XXYYYC to indicate the fact. Regarding the future and
because collations have more implications than just
indexing, I'd vote to try to be as close to the official
(or practical) language standards as possible (while
keeping the Clipper compatible ones in parallel).

Brgds,
Viktor

On 2008.11.03., at 13:17, Przemyslaw Czerpak wrote:

> On Mon, 03 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
>>  * source/codepage/cpfr850.c
>>    ! Fixed uppercase chars.
>
> Are you sure that this modification is correct. Such things should be
> done by users who know and use given language. And of course it should
> be checked with Clipper because it may break binary compatibility in
> index files.
> We should document which CPs are Clipper compatible and should not be
> touched.
>
> best regards,
> Przemek

From harbour.01 at syenar.hu  Mon Nov  3 07:48:35 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 07:48:43 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <490EF019.9050104@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
Message-ID: <F6924479-8703-4AE1-8F93-8801B618D5CD@syenar.hu>

> If the intention was to break code on the whim of changing the name,  
> you've accomplished.

Miguel, keep out your comments of this kind of tone
from this list, if I may kindly ask you.

First of all it's not obligatory to participate (or even
to use Harbour), secondly you can have exactly one guess
about my intentions. That is, if you watched my activity
around Harbour, in say the last 9 years, but the last 3
would also make it.

[ But maybe you didn't and that's why my name is carefully
never mentioned when you transport modifications from here
to xhb. ]

Thank you.

> If what you wanted was to create a ESISO, you can add only this, but  
> do it well and not copying the codepage ESMWIN

"do it well" ??

> ESMWIN codepage is a consensus among various programmers to make it  
> compatible with the codepage "Modern_spanish" that Microsoft uses in  
> its applications, and that is also compatible with all other  
> languages "Latin" without characters above 256 (utf8).

I didn't touch the collation, just aligned the name to the followed
standard in this directory. If that's bothering, we can rename the
name of the codepage (but not the file).

> for example this collation is compatible with french, portuguese,  
> spanish, catalanish, galician and italian (COMPATIBLE)
> This codepages are ansi collation codepages. And are not ISO, really  
> is a merge of codepages to to use only one in countries
> where are speaked more than on language as spain.

Great, such information is good to be included in the comments inside
that file, otherwise neither the users nor anybody else can know about
it.

> If is possible, please revert the name changed. And remove the new  
> one copy.

Give me a good reason why not add ESISO as an _option_, or why could  
this
bother anyone, and why HBISO is inferior to ESWIN, and I'll instantly
remove it for you.

> What about backguard compatibilitie....

We're in 1.1, and if find something which isn't right, I'll modify
it and mark as such (see 'INCOMPATIBLE' texts in my entries).
 From time to time I revise the changes, and some of them will also
be implemented in the 1.0.x branch to ease switching between the
versions.

Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov  3 08:08:20 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 08:07:41 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <490E6320.1040208@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490E6320.1040208@mail.udg.mx>
Message-ID: <20081103130819.GA16835@34-mo7-2.acn.waw.pl>

On Sun, 02 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> With OpenWatcom 1.7:
> - Screen output
> -----------------------
> make[3]: *** [hbinet.obj] Error 9

It may be a little bit hard to fix it without seeing OS2 OpenWatcom
header files. I'll try to make it but if you can please compress your
E:\WATCOM\H\OS2\ directory and send to me?

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov  3 08:08:49 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 08:08:09 2008
Subject: [Harbour] 2008-11-03 14:08 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081103130849.GA29143@34-mo7-2.acn.waw.pl>

2008-11-03 14:08 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbthread.h
  * harbour/source/vm/thread.c
    + added ULONG _hb_gettid( void ) to OS2 builds - thanks to Maurilio

  * harbour/source/rtl/hbinet.c
    * changed a little bit the order of including header files in OS2 builds
      (blink fix for OpenWatcom OS2 builds).

best regards
Przemek
From harbour.01 at syenar.hu  Mon Nov  3 08:09:34 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 08:09:42 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <490EF019.9050104@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
Message-ID: <49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>

> If what you wanted was to create a ESISO, you can add only this, but  
> do it well and not copying the codepage ESMWIN

About doing it well.

Current eswin and eswinm (esmwin) is setup to use ISO-8859-1
CP internally. If this is right, they are in fact wrongly named
es_win_, and they should be named es_iso_. I assumed the
content is right, so I copied them to es_iso_, with exact same
content, this way the filename and internal CP are in sync.

Now, if the end result is not well, it can mean two things:

1) The CP marking in eswin is wrongly set, and should
be Windows-something. In this case eswin should be
corrected to use proper CP, and esiso should be converted
to use ISO-8859-1.

2) The CP marking in eswin is right, in this case the
content should be changed to be Windows-something CP,
and Windows CP strings, and new esiso files kept as correct
ones.

But having an ESWIN codepage internally using ISO-8859-1,
is completely misleading.

'SVWIN' BTW has a similar problem. Name 'win', internal CP ISO.

Brgds,
Viktor

>
>
> ESMWIN codepage is a consensus among various programmers to make it  
> compatible with the codepage "Modern_spanish" that Microsoft uses in  
> its applications, and that is also compatible with all other  
> languages "Latin" without characters above 256 (utf8).
>
> for example this collation is compatible with french, portuguese,  
> spanish, catalanish, galician and italian (COMPATIBLE)
>
> This codepages are ansi collation codepages. And are not ISO, really  
> is a merge of codepages to to use only one in countries
> where are speaked more than on language as spain.
>
> If is possible, please revert the name changed. And remove the new  
> one copy.
>
> What about backguard compatibilitie....
>
> Best regards,
> Miguel Angel Marchuet
>
> Szak?ts Viktor escribi?:
>> 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>>  * common.mak
>>  * source/codepage/Makefile
>>  - source/codepage/cpesmwin.c
>>  + source/codepage/cpeswinm.c
>>  + source/codepage/cpesiso.c
>>  + source/codepage/cpesisom.c
>>    * Renamed cpesmwin -> cpeswinm (ESMWIN -> ESWINM) (INCOMPATIBLE)
>>    + Added Spanish ISO natsort modules. Besides their ID,        
>> they are idendical with current ESWIN* natsorts, because       the  
>> WIN versions for some reason are using ISO-8859 CP       instead of  
>> Windows-*. This is IMO wrong, even if these CPs       are similar  
>> or identical for the Spanish language.
>
> SORRY BUT IS NOT AN ISO CODEPAGE
>
>> --
>> Brgds,
>> Viktor
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>> __________ Informaci?n de ESET NOD32 Antivirus, versi?n de la base  
>> de firmas de virus 3576 (20081102) __________
>> ESET NOD32 Antivirus ha comprobado este mensaje.
>> http://www.eset.com
>

From harbour.01 at syenar.hu  Mon Nov  3 08:13:50 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 08:13:56 2008
Subject: [Harbour] GPF in dbCloseAll()
In-Reply-To: <20081103121005.GB31731@34-mo7-2.acn.waw.pl>
References: <EBD25DE6-55B9-48B4-B5E1-3A75C1632FDD@syenar.hu>
	<20081103121005.GB31731@34-mo7-2.acn.waw.pl>
Message-ID: <90BD3B4D-0585-422B-8EFD-14C2E5782F91@syenar.hu>

Hi Przemek,

Okay, I now get what's happening. I didn't count with the
fact that this problem can be exploited by EXIT PROC and
not just rogue error handler, but yeah, EXIT will trigger
these just if they were part of the handler.

This is pretty grave...

Now I've simply removed this dbCloseAll() from this EXIT PROC,
since it's not crucial anyway.

Brgds,
Viktor

On 2008.11.03., at 13:10, Przemyslaw Czerpak wrote:

> On Mon, 03 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
>> This code will consistently GPF (tried in 1.0.1 BCC 5.5,
>> current 1.0.1dev with MSVC 2005, and a bit older 1.1.0dev with BCC  
>> 5.8)
>> ---
>> PROC Main()
>>     USE nothere // This file should not exist, and a QUIT should be  
>> selected in the RTE alert.
>>     RETURN
>> EXIT PROCEDURE App_Exit()
>>     dbCloseAll()
>>     RETURN
>> ---
>
> Exactly and it's an example of the problem I was talking about when
> user code closes open WA when some other code still operates on it.
> EXIT procedures in ST mode are executed just after QUIT in RT error
> before control returns to RDD. It's Clipper compatible behavior.
> In MT mode I change it to execute EXIT procedures after leaving all
> functions by all threads so this code will not exploit the problem
> but it does not fix it. Such situation can be created also in other
> ways too, f.e. custom error handler can close WA on which someone
> operates. To resolve it we will need similar mechanism to the one I
> added to GT code and each time WA pointer is accessed then it should
> be later freed. In GT it's done by hb_gt_Base()/hb_gt_BaseFree() and
> it will force many modifications in existing RDD code.
> We can also try to create some partial solution but it will only
> reduce the problem.
> The effect of the above code depends on memory context. After
> dbCloseAll() the RDD code will operate on freed memory where
> WA were located. It may cause GPF or not but of course it serious
> bug.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Nov  3 08:32:10 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 08:32:16 2008
Subject: [Harbour] 2008-11-03 14:31 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93db8$Blat.v2.6.2$92dda69b$1e6c3df94ba0@127.0.0.1>

2008-11-03 14:31 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
  * source/codepage/Makefile
  + source/codepage/cpsviso.c
    + Added SVISO, which is the same as SVWIN, except it's 
      internally using ISO-8859-1 CP in sync with its name.

  * source/codepage/cpsvwin.c
    ! Changed internal CP to Windows-1252 from ISO-8859-1, 
      so that it's in sync with its name.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov  3 08:56:32 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 08:55:53 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
Message-ID: <20081103135632.GB16835@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Shouldn't we add a way to set the default
> codepage for RDD operations?

It will be very danger option. The online CP translations
are not revertible and break binary data stored in DBF fields.
If someone does not use binary data then it's safe but if we
make it global (thread) option then it may cause unitnetional
data corruption.

> Right now I could pass it to each RDD function
> call (like dbCreate()) but that needs touching
> all such possible calls (which is error prone),
> moreover using a "dirty" parameter extension.
> Also, usually the RDD CP is global to an app's
> database.

I always set HVM codepage by HB_SETCODEPAGE() to my source code
encoding which is also encoding of my database files and use CODEPAGE
in RDD only when I want to import/export data with different then
default encoding.

> Right now I'm using hb_setcodepage(), but this
> may not be enough given that it could depend on
> UI/app language, so it may be bit different than
> db cp (which is not ideal, but may happen).

HVM codepage always have to be set if you want to have working
<, >, <=, >= operators and it should be the same as your source
code encoding if you have some literal strings with national
characters.
Then if you want to exchange data with any other external objects
like database files, input/output system or other socket connections
then you have to make necesary translations between HVM CP and forign
CP. Now we added support for automatic translations to native RDDs
and most of GT drivers (HB_SETTERMCP(), HB_SETDISPCP(), HB_SETKEYCP()).
We do not have any support yet for file name translations.
But please remember that these translations means different internal
operations. In indexing RDDs it's also collation order not only character
translation. DBF header has a field to store CP ID. It's enough for
character translation but does not give any valuable information for
national sorting so it's not usable for us. When application is executed
the character fields have to be translated to HVM CP so later they can
be compared using common rules. It's necessary to make SET FILTER and
other operations working correctly. When HVM CP and table CP is the same
then translation is skipped. The translation is usually not revertible
so it's not safe to enable it for tables holding binary data in character
fields. And to clarify. Using UNICODE does not resolve the problem. In
some cases it even introduce new ones much harder to manage and resolve
then in CP oriented applications. It helps in translations (as long as
you do not touch binary data) but does not give anything for collation
orders.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Nov  3 09:03:10 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 09:03:21 2008
Subject: [Harbour] 2008-11-03 08:57 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <BE5E50B2-E32E-4B27-8368-60A3FEAF777C@syenar.hu>
References: <01c93d89$Blat.v2.6.2$f7e5ef28$1124fa0d990a@127.0.0.1>
	<20081103121722.GC31731@34-mo7-2.acn.waw.pl>
	<BE5E50B2-E32E-4B27-8368-60A3FEAF777C@syenar.hu>
Message-ID: <B80FA5DF-20B2-4737-88E0-CC76EA234F9B@syenar.hu>

Hi Przemek and all,

Here are the results. (official C5.2e and C5.3b ones,
plus three unofficial HU ones).

To fully replicate these, we'd need to add the whole
tables (from 0-255) to our compatible collations.

I can do this if it seems useful.

Brgds,
Viktor

-------------- next part --------------
A non-text attachment was scrubbed...
Name: clipper_collation.zip
Type: application/zip
Size: 24790 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081103/10671e49/clipper_collation-0001.zip
-------------- next part --------------


On 2008.11.03., at 13:36, Szak?ts Viktor wrote:

> Hi Przemek,
>
> I've been following the instructions in these files, which
> say, the first string should be the exact same string as
> the second, but in upper case. Now, in French these accented
> chars are present in IBM850, so they should IMO be included.
> Accented chars in French are also considered with the same
> weight as unaccented versions (accented ones are not part
> of the official alphabet per se).
>
> Because there wasn't any indication of the strange previous
> behavior in the file, I cannot tell the reason behind it.
> Maybe it was Clipper compatibility.
>
> I've found original Clipper ntxfre.obj and mdxfre.obj, and
> for one thing (and on first binary spot) they seem to be
> different from each other. And they are both different from
> both the old Harbour version and also probably from the
> current one. I'll do some tests ASAP.
>
> You're right though that such Clipper compatibility
> comments are useful, I've added such for all HU collations
> long ago. Maybe we should keep simply name those collations
> XXYYYC to indicate the fact. Regarding the future and
> because collations have more implications than just
> indexing, I'd vote to try to be as close to the official
> (or practical) language standards as possible (while
> keeping the Clipper compatible ones in parallel).
>
> Brgds,
> Viktor
>
> On 2008.11.03., at 13:17, Przemyslaw Czerpak wrote:
>
>> On Mon, 03 Nov 2008, Szak?ts Viktor wrote:
>>
>> Hi Viktor,
>>
>>> * source/codepage/cpfr850.c
>>>   ! Fixed uppercase chars.
>>
>> Are you sure that this modification is correct. Such things should be
>> done by users who know and use given language. And of course it  
>> should
>> be checked with Clipper because it may break binary compatibility in
>> index files.
>> We should document which CPs are Clipper compatible and should not be
>> touched.
>>
>> best regards,
>> Przemek
>

From harbour.01 at syenar.hu  Mon Nov  3 09:17:01 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 09:17:13 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <20081103135632.GB16835@34-mo7-2.acn.waw.pl>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
Message-ID: <F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>

>>
Hi Przemek,

>> Shouldn't we add a way to set the default
>> codepage for RDD operations?
>
> It will be very danger option. The online CP translations
> are not revertible and break binary data stored in DBF fields.
> If someone does not use binary data then it's safe but if we
> make it global (thread) option then it may cause unitnetional
> data corruption.

Per thread of course. I think this is very important.
Right now we have multiple different things controlled
by this one setting, and I have to risk an index corruption
if I want to make an UPPER() call using a different CP.
Or, the CP has to be saved/set/restored when such thing
occurs, or the program has to be modified to force CP on
table opening. At least if I'm not missing anything.

>> Right now I could pass it to each RDD function
>> call (like dbCreate()) but that needs touching
>> all such possible calls (which is error prone),
>> moreover using a "dirty" parameter extension.
>> Also, usually the RDD CP is global to an app's
>> database.
>
> I always set HVM codepage by HB_SETCODEPAGE() to my source code
> encoding which is also encoding of my database files and use CODEPAGE
> in RDD only when I want to import/export data with different then
> default encoding.

This is good as long as your user don't want to switch
to a different UI language, and f.e. you want to use
an UPPER() call on a UI string. Or you have any other
program parts which temporarily needs a different CP.
If you mix those parts with db operations, this is real
trouble.

Most of these could IMO be solved with such defaulting
setting as 'hb_rddInfo( RDDI_CODEPAGE, "EN" )'.

> some cases it even introduce new ones much harder to manage and  
> resolve
> then in CP oriented applications. It helps in translations (as long as
> you do not touch binary data) but does not give anything for collation
> orders.

I see Unicode in a much brighter shade, but surely, not
everything is solved by it, but the more worrying thing
is that many devices, file formats (like .dbf) don't
support it (well), so you still need to convert.

Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov  3 09:26:32 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 09:25:54 2008
Subject: [Harbour] MT - WorkAreas - A Feature Request
In-Reply-To: <20290173.post@talk.nabble.com>
References: <20268713.post@talk.nabble.com>
	<20081101210056.GB15722@34-mo7-2.acn.waw.pl>
	<20290030.post@talk.nabble.com> <20290105.post@talk.nabble.com>
	<20290173.post@talk.nabble.com>
Message-ID: <20081103142632.GA18225@34-mo7-2.acn.waw.pl>

On Sun, 02 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> Ho can I generate a unique number given ThreadID() and nWA ?

Why don't you want to store such unique ID in WA structure and
then simply use it?
You are introducing solutions which at beginning creates limitations.
Have you thought what will happen when WA will be accessed by other
thread? What about hb_dbDeatach()/hb_dbRequest()?

> As maximum limit of workareas per thread is 65534, I can safely 
> define macro as 
> #define MYWORKAREA( nWA )   ( ThreadID() * nWA )
> Am I right ?

No. It should be:
   #define MYWORKAREA( nWA )  ( hreadID() * MAX_WA_NUM + nWA )
anyhow as I said it's bad idea.

best regards,
Przemek
From maurilio.longo at libero.it  Mon Nov  3 09:26:20 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Mon Nov  3 09:26:24 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20081103123327.GD31731@34-mo7-2.acn.waw.pl>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>	<490DA53B.6010500@mail.udg.mx>	<20081102235546.GA31731@34-mo7-2.acn.waw.pl>	<490EB809.8010705@libero.it>
	<20081103123327.GD31731@34-mo7-2.acn.waw.pl>
Message-ID: <490F0A0C.6060302@libero.it>

Przemyslaw,

I'm not aware of any other method.

Best regards.

Maurilio.


Przemyslaw Czerpak wrote:
> On Mon, 03 Nov 2008, Maurilio Longo wrote:
> 
> Hi Maurilio,
> 
>> I've not tested this code, but something like this should give you the thread id.
>> unsigned long _gettid()
>> {
>>    PTIB   ptib = NULL;
>>    APIRET rc;
>>
>>    rc = DosGetInfoBlocks(&ptib, NULL);
>>
>>    return ptib->tib_ptib2->tib2_ultid;
>> }
>> Hope this help.
> 
> Yes, thanks. I hoped that maybe there is simpler version then using
> DosGetInfoBlocks() but we can also use this. Thank you very much.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From rportnoff at spendmap.com  Mon Nov  3 09:30:08 2008
From: rportnoff at spendmap.com (Randy Portnoff)
Date: Mon Nov  3 09:28:36 2008
Subject: [Harbour] 2008-11-03 08:57 UTC+0200 Viktor Szakats
	(harbour.01 syenar hu)
In-Reply-To: <B80FA5DF-20B2-4737-88E0-CC76EA234F9B@syenar.hu>
References: <01c93d89$Blat.v2.6.2$f7e5ef28$1124fa0d990a@127.0.0.1>
	<20081103121722.GC31731@34-mo7-2.acn.waw.pl>
	<BE5E50B2-E32E-4B27-8368-60A3FEAF777C@syenar.hu>
	<B80FA5DF-20B2-4737-88E0-CC76EA234F9B@syenar.hu>
Message-ID: <B0084752975@ms1.3peaks.com>

Hi Viktor,

For backwards compatibility (especially with 
legacy systems) I think you need to also support Windows-1252 encoding.

Regards,
Randy.


At 09:03 AM 11/3/2008, you wrote:
>Hi Przemek and all,
>
>Here are the results. (official C5.2e and C5.3b ones,
>plus three unofficial HU ones).
>
>To fully replicate these, we'd need to add the whole
>tables (from 0-255) to our compatible collations.
>
>I can do this if it seems useful.
>
>Brgds,
>Viktor
>
>
>
>
>
>
>On 2008.11.03., at 13:36, Szak??ts Viktor wrote:
>
>>Hi Przemek,
>>
>>I've been following the instructions in these files, which
>>say, the first string should be the exact same string as
>>the second, but in upper case. Now, in French these accented
>>chars are present in IBM850, so they should IMO be included.
>>Accented chars in French are also considered with the same
>>weight as unaccented versions (accented ones are not part
>>of the official alphabet per se).
>>
>>Because there wasn't any indication of the strange previous
>>behavior in the file, I cannot tell the reason behind it.
>>Maybe it was Clipper compatibility.
>>
>>I've found original Clipper ntxfre.obj and mdxfre.obj, and
>>for one thing (and on first binary spot) they seem to be
>>different from each other. And they are both different from
>>both the old Harbour version and also probably from the
>>current one. I'll do some tests ASAP.
>>
>>You're right though that such Clipper compatibility
>>comments are useful, I've added such for all HU collations
>>long ago. Maybe we should keep simply name those collations
>>XXYYYC to indicate the fact. Regarding the future and
>>because collations have more implications than just
>>indexing, I'd vote to try to be as close to the official
>>(or practical) language standards as possible (while
>>keeping the Clipper compatible ones in parallel).
>>
>>Brgds,
>>Viktor
>>
>>On 2008.11.03., at 13:17, Przemyslaw Czerpak wrote:
>>
>>>On Mon, 03 Nov 2008, Szak???ts Viktor wrote:
>>>
>>>Hi Viktor,
>>>
>>>>* source/codepage/cpfr850.c
>>>>   ! Fixed uppercase chars.
>>>
>>>Are you sure that this modification is correct. Such things should be
>>>done by users who know and use given language. And of course it
>>>should
>>>be checked with Clipper because it may break binary compatibility in
>>>index files.
>>>We should document which CPs are Clipper compatible and should not be
>>>touched.
>>>
>>>best regards,
>>>Przemek
>
>
>
>_______________________________________________
>Harbour mailing list
>Harbour@harbour-project.org
>http://lists.harbour-project.org/mailman/listinfo/harbour


From druzus at acn.waw.pl  Mon Nov  3 09:54:35 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 09:53:59 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
Message-ID: <20081103145435.GA27285@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Per thread of course. I think this is very important.
> Right now we have multiple different things controlled
> by this one setting, and I have to risk an index corruption

I think that you still do not understand that _THEY_ always
will be controlled by this setting and you will only introduce
additional risk for data corruption by enabling unintentional
translation.

> if I want to make an UPPER() call using a different CP.

Nothing will be changed by adding default RDD CP because
all expressions will be still evaluated with HVM CP. You
will only enable possibly danger translation.

> Or, the CP has to be saved/set/restored when such thing
> occurs, or the program has to be modified to force CP on
> table opening. At least if I'm not missing anything.

You missed the most important thing that all expressions
have to be executed using current HVM CP because they can
use data with national characters or call UDFs which uses
data with national characters or even compare data with
different WAs which uses internally different encoding
and need to be unified before comparison. The CODEPAGE
clause makes only one thing here. It enables automatic translation
between HVM and table encoding when field is accessed/assign.
It can be used only between the same languages using the
same collation rules and only different encoding.

>> I always set HVM codepage by HB_SETCODEPAGE() to my source code
>> encoding which is also encoding of my database files and use CODEPAGE
>> in RDD only when I want to import/export data with different then
>> default encoding.
> This is good as long as your user don't want to switch
> to a different UI language, and f.e. you want to use
> an UPPER() call on a UI string. Or you have any other
> program parts which temporarily needs a different CP.

Set and restore HVM CP only for this operation and be sure
that other code will not be executed inside.
But it has nothing to default RDD CP. You will still have
the same problem.

> If you mix those parts with db operations, this is real
> trouble.
> Most of these could IMO be solved with such defaulting
> setting as 'hb_rddInfo( RDDI_CODEPAGE, "EN" )'.

It will not be solved.
In the moment when you are changing HVM CP you are changing
the behavior of string comparison operations what will effect
all existing RDD expressions when they will be evaluated.
Default RDD CP does not change anything here.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Nov  3 10:22:25 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 10:22:42 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <20081103145435.GA27285@34-mo7-2.acn.waw.pl>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
Message-ID: <38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>

>>
Hi Przemek,

>> Per thread of course. I think this is very important.
>> Right now we have multiple different things controlled
>> by this one setting, and I have to risk an index corruption
>
> I think that you still do not understand that _THEY_ always
> will be controlled by this setting and you will only introduce
> additional risk for data corruption by enabling unintentional
> translation.

Hm, I mean the RDD to be a different setting obviously.
One CP for HVM, one CP for RDD.

So this (BTW):
hb_setrddcp( "HU" )
hb_sethvmcp( "SK" )
dbAppend() ; FIELD->NAME := "?" // will be put in HU order
? Upper( "<slovak lower case char>" ) // -> <slovak uppercase char>

I suppose there already must be some sort of logic to
achieve this, as dbUseArea() has a CP parameter already.
All I'm trying to say, is that it would be useful to have
a setting controlling the _default_ of this parameter.

According to what you say, this parameter is pointless
and/or dangerous. So I'm not sure why we have it there, then.
(well, this I'm not sure anyway, since being a dirty extension,
but that's a different story).

>> if I want to make an UPPER() call using a different CP.
>
> Nothing will be changed by adding default RDD CP because
> all expressions will be still evaluated with HVM CP. You
> will only enable possibly danger translation.

Okay, we'd need a HVM CP context then, which we already
have AFAIK.

>> Or, the CP has to be saved/set/restored when such thing
>> occurs, or the program has to be modified to force CP on
>> table opening. At least if I'm not missing anything.
>
> You missed the most important thing that all expressions
> have to be executed using current HVM CP because they can
> use data with national characters or call UDFs which uses
> data with national characters or even compare data with
> different WAs which uses internally different encoding
> and need to be unified before comparison. The CODEPAGE
> clause makes only one thing here. It enables automatic translation
> between HVM and table encoding when field is accessed/assign.
> It can be used only between the same languages using the
> same collation rules and only different encoding.

Then what controls the behavior of UPPER() for example?
(in my tests it was hb_setcodepage())

BTW I understand the problem of index callbacks, but HVM/RDD
should make sure to execute these in the RDDs CP context.

If what you say is true, it's not possible to write a
multi language program, unless the language (CP) is fixed
at install time once and for all for both the UI and
the RDD (but lets forget about the high level problem).

Maybe I'm not seeing all the details that comes with it,
especially when it comes to implementation details, but
there must be some ways to ask Harbour to uppercase me a
simple string according to CP 'n', while using CP 'm'
for the RDDs.

In particular I don't understand why can we do this:
---
hb_setcodepage( "CP_ZZ" )
dbUseArea( ..., "CP_XX" )
dbUseArea( ..., "CP_XX" )

---
But we cannot do this:
---
hb_setcodepage( "CP_ZZ" )
hb_dbcodepage( "CP_XX" )
dbUseArea( ... )
dbUseArea( ... )
---

> Set and restore HVM CP only for this operation and be sure
> that other code will not be executed inside.
> But it has nothing to default RDD CP. You will still have
> the same problem.

That's exactly what I'd expect from the RDD, done automatically.
And the <codepage> option in dbUseArea() (and friends)
suggest this is already implemented.

>> If you mix those parts with db operations, this is real
>> trouble.
>> Most of these could IMO be solved with such defaulting
>> setting as 'hb_rddInfo( RDDI_CODEPAGE, "EN" )'.
>
> It will not be solved.
> In the moment when you are changing HVM CP you are changing
> the behavior of string comparison operations what will effect
> all existing RDD expressions when they will be evaluated.
> Default RDD CP does not change anything here.

You probably didn't understand me, I'm afraid, probably I
wasn't clear, or I'm missing something. Anyhow, I can continue
to use my own CP system and string manipulation, which solves
to problem adequately.

BTW, such similar 'CP context' methodology is implemented
in C#, where certain functions can have such a context
passed as an option, plus there are probably ways to control
the defaults, too, but don't ask me about the precise
details.

Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov  3 10:49:41 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 10:49:03 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
Message-ID: <20081103154941.GA15784@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szakts Viktor wrote:

Hi Viktor,

> BTW I understand the problem of index callbacks, but HVM/RDD
> should make sure to execute these in the RDDs CP context.

Which one?

? WA1->FIELD1 >= WA2->FIELD2

WA1 uses CP1, WA2 uses CP2
Please define RDD CP in this case?

best regards,
Przemek
From dmacias at mail.udg.mx  Mon Nov  3 11:13:51 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov  3 11:13:48 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490F233F.3090002@mail.udg.mx>

Przemek:

>It may be a little bit hard to fix it without seeing OS2 OpenWatcom
 >header files. I'll try to make it but if you can please compress your
 >E:\WATCOM\H\OS2\ directory and send to me?

Note order:
Documentation say to use:
   SET INCLUDE=%WATCOM%\H;%WATCOM%\H\OS2
but OW installer set:
   SET INCLUDE=%WATCOM%\H\OS2;%WATCOM%\H

so I applied value used by installer

I do not know if it can affect something so zip file include both

Sent e:\watcom\h which include os2\ and subdirs

David Macias


From harbour.01 at syenar.hu  Mon Nov  3 11:14:47 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 11:14:59 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <20081103154941.GA15784@34-mo7-2.acn.waw.pl>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
Message-ID: <FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>

>>
Hi Przemek,

>> BTW I understand the problem of index callbacks, but HVM/RDD
>> should make sure to execute these in the RDDs CP context.
>
> Which one?
>
> ? WA1->FIELD1 >= WA2->FIELD2
>
> WA1 uses CP1, WA2 uses CP2
> Please define RDD CP in this case?

In this case there is no RDD CP context involved in my
understanding, this is executed in the caller CP context.

Another more sophisticated solution could be that first
WA1->FIELD1 is converted to caller CP from WA1 CP, then
WA2->FIELD2 is also converted to caller CP from WA2 CP,
and then comparison is made using the caller CP context.

Back to prev mail for sec, can shade some light specifically
this issue:

Why can we do this now:
---
hb_setcodepage( "CP_ZZ" )
dbUseArea( ..., "CP_XX" )
dbUseArea( ..., "CP_XX" )
---
But not this:
---
hb_setcodepage( "CP_ZZ" )
hb_rdddefaultcodepage( "CP_XX" )
dbUseArea( ... )
dbUseArea( ... )
---

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov  3 11:25:29 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 11:25:44 2008
Subject: [Harbour] 2008-11-03 08:57 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <B0084752975@ms1.3peaks.com>
References: <01c93d89$Blat.v2.6.2$f7e5ef28$1124fa0d990a@127.0.0.1>
	<20081103121722.GC31731@34-mo7-2.acn.waw.pl>
	<BE5E50B2-E32E-4B27-8368-60A3FEAF777C@syenar.hu>
	<B80FA5DF-20B2-4737-88E0-CC76EA234F9B@syenar.hu>
	<B0084752975@ms1.3peaks.com>
Message-ID: <C36E7E44-A6F6-4379-9975-636181CF2F78@syenar.hu>

>
Hi Randy,

> Hi Viktor,
>
> For backwards compatibility (especially with legacy systems) I think  
> you need to also support Windows-1252 encoding.

In my understanding (which may be wrong), we have two categories:

- legacy
	Subcategory may be Clipper (multiple versions even, as 5.2 and 5.3
         isn't always compatible), and other products.
	The goal here is to replicate exact collation of these products,
	which also means the codepage involved should be whatever used in
         those legacy products.
	Original Clipper didn't use Windows-* codepages to my knowledge,
	but rather the IBM* (aka DOS*) range.
- non-legacy
	This can be anything, but to not make things overly complicated,
	it's best to stick with existing standards and implement them well.
	In this category we can implement Windows-*, ISO-8859-* and
	any other CPs (including IBM* but without bugs or any compatibility
	restrains).

Currently we have a little bit of both, *ISO and *WIN CPs are
probably all non-legacy, but it's at the moment difficult to tell
the exact status for the rest. While the goal of the rest is mostly
compatibility, not many of them were rigorously tested against
Clipper official and non-official legacy collations AFAICT.

Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov  3 11:29:32 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 11:29:03 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
Message-ID: <20081103162932.GA16061@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>> ? WA1->FIELD1 >= WA2->FIELD2
>> WA1 uses CP1, WA2 uses CP2
>> Please define RDD CP in this case?
> In this case there is no RDD CP context involved in my
> understanding, this is executed in the caller CP context.

And what if it's FOR or WHILE clause of some RDD commands
like INDEX ON ..., COUNT or SET FILTER?

> Another more sophisticated solution could be that first
> WA1->FIELD1 is converted to caller CP from WA1 CP, then
> WA2->FIELD2 is also converted to caller CP from WA2 CP,
> and then comparison is made using the caller CP context.

How do you want to find such information in more complicated expressions
like:
   WA1->(UDF1()) >= WA2->(UDF2())

FUNC UDF1
   return WA1->FIELD1+WA2->FIELD2
FUNC UDF2
   ...

???

> Back to prev mail for sec, can shade some light specifically
> this issue:
> Why can we do this now:
> ---
> hb_setcodepage( "CP_ZZ" )
> dbUseArea( ..., "CP_XX" )
> dbUseArea( ..., "CP_XX" )
> ---
> But not this:
> ---
> hb_setcodepage( "CP_ZZ" )
> hb_rdddefaultcodepage( "CP_XX" )
> dbUseArea( ... )
> dbUseArea( ... )
> ---

hb_rdddefaultcodepage( "CP_XX" )

Will enable translations for all open WAs even if user does not need any
translation and want to open table in raw form, f.e. to extract binary
so it will break existing code. The old problems will still exists and we
will have new one. User will have to add to existing code saving and
restoring hb_rdddefaultcodepage() to make it structural safe.

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov  3 11:49:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 11:49:09 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <490F233F.3090002@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490F233F.3090002@mail.udg.mx>
Message-ID: <20081103164947.GA27428@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Note order:
> Documentation say to use:
>   SET INCLUDE=%WATCOM%\H;%WATCOM%\H\OS2
> but OW installer set:
>   SET INCLUDE=%WATCOM%\H\OS2;%WATCOM%\H

And this seems to be correct because some files may exists in different
directories and I wanted to ask you about it.
Now seeing all header files in OS2 installation it looks much more clear.

> so I applied value used by installer

IMHO correct.

> I do not know if it can affect something so zip file include both
> Sent e:\watcom\h which include os2\ and subdirs

Thanks.
Looks that the modifications in hbinet.c I've made should be enough
to resolve this problem. Please try.

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov  3 11:49:51 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 11:49:12 2008
Subject: [Harbour] 2008-11-03 17:49 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081103164951.GA10276@34-mo7-2.acn.waw.pl>

2008-11-03 17:49 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbthread.h
    * include <process.h> in OpenWatcom OS2 builds

best regards
Przemek
From harbour.01 at syenar.hu  Mon Nov  3 11:48:41 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 11:49:58 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <20081103162932.GA16061@34-mo7-2.acn.waw.pl>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
Message-ID: <4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>

>>>
Hi Przemek,

>>> ? WA1->FIELD1 >= WA2->FIELD2
>>> WA1 uses CP1, WA2 uses CP2
>>> Please define RDD CP in this case?
>> In this case there is no RDD CP context involved in my
>> understanding, this is executed in the caller CP context.
>
> And what if it's FOR or WHILE clause of some RDD commands
> like INDEX ON ..., COUNT or SET FILTER?

I'd think INDEX ON expression is definitely RDD CP
context, just like FOR/WHILE and every other code
initiated by the RDD.

[ Honestly until you see or agree that my raised issue is
a valid one, I see no point in speculating on implementation
details. A possible answer could be that the issue is there,
but implementation is far-reaching or not possible because
of certain legacy constructs, or else, but first I think
we should identify the problem. Maybe my thinking is
completely wrong from start. ]

[ BTW the other problem is conversion from one CP to
another from .prg code. But that's really another topic. ]

>> Another more sophisticated solution could be that first
>> WA1->FIELD1 is converted to caller CP from WA1 CP, then
>> WA2->FIELD2 is also converted to caller CP from WA2 CP,
>> and then comparison is made using the caller CP context.
>
> How do you want to find such information in more complicated  
> expressions
> like:
>   WA1->(UDF1()) >= WA2->(UDF2())
>
> FUNC UDF1
>   return WA1->FIELD1+WA2->FIELD2
> FUNC UDF2
>   ...
>
> ???

I think the WA CP to caller CP conversion should be
done when evaluating the content of FIELDn. From this
point the context is of the caller's.

Another view of this is if we'd say that HVM is internally
Unicode, and we need to convert everything coming from outside
to it, and use a selected national collation when doing
these comparisons.

>> Back to prev mail for sec, can shade some light specifically
>> this issue:
>> Why can we do this now:
>> ---
>> hb_setcodepage( "CP_ZZ" )
>> dbUseArea( ..., "CP_XX" )
>> dbUseArea( ..., "CP_XX" )
>> ---
>> But not this:
>> ---
>> hb_setcodepage( "CP_ZZ" )
>> hb_rdddefaultcodepage( "CP_XX" )
>> dbUseArea( ... )
>> dbUseArea( ... )
>> ---
>
> hb_rdddefaultcodepage( "CP_XX" )
>
> Will enable translations for all open WAs even if user does not need  
> any

No, it should enable translations for _newly opened_ WAs.
(in the current thread possibly).

All it does is giving a default to the already existing
<codepage> parameter.

> translation and want to open table in raw form, f.e. to extract binary
> so it will break existing code. The old problems will still exists  
> and we
> will have new one. User will have to add to existing code saving and
> restoring hb_rdddefaultcodepage() to make it structural safe.

No existing code will be broken, as this is a new command,
and no defaults would be changed.

I still don't understand why isn't it a problem to support
<codepage> currently as a parameter. Can we say it's a broken
feature?

[ my battery going flat in a minute. See you later ]

Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov  3 12:58:19 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 12:57:42 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
	<4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
Message-ID: <20081103175818.GA18562@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>> And what if it's FOR or WHILE clause of some RDD commands
>> like INDEX ON ..., COUNT or SET FILTER?
> I'd think INDEX ON expression is definitely RDD CP
> context, just like FOR/WHILE and every other code
> initiated by the RDD.

What about situations when part of expression is taken
from your source code and other part from table?
   INDEX ON FOR MY_FIELD <= "[text with national character]"
If you begin to implement it and resolve all problems which will
appear then you will end with CDP pointer attached to each string
item (HB_IT_STRING) what in some cases may not be bed idea but you
will also have to define the behavior of + and - operations for strings
with two different encoding. Probably by simple using encoding of 1-st
nonempty string. Next it will be necessary to define the behavior of
<, <=, >, >=, =, ==, $ operators for strings with different encoding
and implement it in HVM. Without attaching CDP information to string
item you will not be able to realize above idea because when string
item is created the evaluation context may not be known yet.
So as long as we will not have such functionality we have to use simplified
version which translate all strings to one encoding used by application.
This encoding is set by HB_SETCODEPAGE() function and if user wants to change
it at run time then he should know that it may break string operations for
items already created because they will not be translated to new encoding.

> [ Honestly until you see or agree that my raised issue is
> a valid one, I see no point in speculating on implementation
> details.

I see because you still do not understand what is the problem.
I hoped to you begin to see it when I'll ask you about it.

> A possible answer could be that the issue is there,
> but implementation is far-reaching or not possible because
> of certain legacy constructs, or else, but first I think
> we should identify the problem. Maybe my thinking is
> completely wrong from start. ]
> [ BTW the other problem is conversion from one CP to
> another from .prg code. But that's really another topic. ]

No it's not different topic because you can have in one expression
string items created from .prg source code and string items created
from table. If you have
   INDEX ON ... FOR MY_FIELD1=="<string with national character>"
then MY_FIELD1 have to be created with the same encoding as item created
by "<string with national character>" or during '==' evaluation you will
have to make translation dynamically. To make it dynamically you will have
to attach to each string item information about CDP or use some arbitrary
CDP used for all comparisons.

> I think the WA CP to caller CP conversion should be
> done when evaluating the content of FIELDn. From this
> point the context is of the caller's.

So you have to attach to each string item CP information so later
can be used during evaluation string related operators.

> Another view of this is if we'd say that HVM is internally
> Unicode, and we need to convert everything coming from outside
> to it, and use a selected national collation when doing
> these comparisons.

Yes keeping internally string items in some type of unicode representation
and making the translations to/from this representation each time string is
passed to external resources resolves problems for text data. Of course we
will stil have to decide do with Clipper comaptibility. Should ASC() and CHR()
use ASCII or UNICODE values? What to do with functions like l2bin() and
other Clipper code which binary strings? What to do with FREAD()/FWRITE()?
If HVM will use internally Unicode strings then all such operations will
have to make translations to/from unicode. Also for binary data. It means
that for reverted translations you will still need information about CP
which should be used and you will still have the same problem. Should this
CP be stored in some SET or attached to each string item.

>> Will enable translations for all open WAs even if user does not need any
> No, it should enable translations for _newly opened_ WAs.
> (in the current thread possibly).

Eactly. So it will break any code which operates on binary data.

> All it does is giving a default to the already existing
> <codepage> parameter.

No. Because now the translation is enabled _only_ if I use explicitly
different CP passed to USE command and this CP is different then HVM
one set by HB_SETCODEPAGE().
With the above extension I will have to add to all code which may operates
on binary fields or text which should not be translated, f.e. read in raw
form from other files:

   cOldRddCP := hb_rddDefaultCP( hb_setcodepage() ) // disable any translations

   use table new
   copy to table2
   close

   hb_rddDefaultCP( cOldRddCP )

I can also update all existing code and add CODEPAGE clause to USE and
related commands/functions:
   use table new codepage hb_setcodepage()
   copy to table2 codepage hb_setcodepage()
What is exactly the same what you have do in new code when you want
to enable automatic translations.
There different is only that your proposition breaks backward
compatibility because existing Clipper code will have to be updated.

>> translation and want to open table in raw form, f.e. to extract binary
>> so it will break existing code. The old problems will still exists and we
>> will have new one. User will have to add to existing code saving and
>> restoring hb_rdddefaultcodepage() to make it structural safe.
> No existing code will be broken, as this is a new command,
> and no defaults would be changed.

See above. It will be yet another _SET_EXACT switch :-(

> I still don't understand why isn't it a problem to support
> <codepage> currently as a parameter. Can we say it's a broken
> feature?

Because it will begin to introduce translation unconditionally if
hb_rddDefaultCP() is different then hb_setcodepage() so I will
have to add protection against such situation to existing code.
Current solution is very far from being perfect and has only limited
usage but at least it does not effects existing Clipper code.

> [ my battery going flat in a minute. See you later ]

:-)

best regards,
Przemek
From rportnoff at spendmap.com  Mon Nov  3 12:59:34 2008
From: rportnoff at spendmap.com (Randy Portnoff)
Date: Mon Nov  3 12:58:03 2008
Subject: [Harbour] How does Harbour manage strings and memory?
In-Reply-To: <4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
	<4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
Message-ID: <B0084758493@ms1.3peaks.com>

Hi all,

If you have a string that will expand in size by concatenating to it, 
for example...

local cText := ""
cText += "Some text"
cText += "More text"
...
cText += "Even more text"

Is there any benefit in allocating the final size of the string first 
- For example...

local cText := Space( 2000 )
cText := ""
cText += "Some text"
...

Also, when reusing a string, does first setting it to NIL have any 
benefits to memory - For example...

local cText
cText := "Some text"
...
cText := nil  // Does this help memory usage at all?
cText := "New text"

TIA.

Regards,
Randy.


From druzus at acn.waw.pl  Mon Nov  3 13:20:33 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 13:19:55 2008
Subject: [Harbour] How does Harbour manage strings and memory?
In-Reply-To: <B0084758493@ms1.3peaks.com>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
	<4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
	<B0084758493@ms1.3peaks.com>
Message-ID: <20081103182033.GA2597@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Randy Portnoff wrote:

Hi Randy,

> If you have a string that will expand in size by concatenating to it, for 
> example...
> local cText := ""
> cText += "Some text"
> cText += "More text"
> ...
> cText += "Even more text"

Harbour detects such situation and preallocate buffer for next += operations
to increase the speed.

> Is there any benefit in allocating the final size of the string first - For 
> example...
> local cText := Space( 2000 )
> cText := ""
> cText += "Some text"
> ...

No though it may interact with OS behavior when you allocate big peace of
memory. But the results does not have to be repeatable.

> Also, when reusing a string, does first setting it to NIL have any benefits 
> to memory - For example...
> local cText
> cText := "Some text"
> ...
> cText := nil  // Does this help memory usage at all?
> cText := "New text"

No. The above only introducing few additional PCODEs so the code is slower
because "New text" does not allocate new memory. It's static string.
Anyhow if you are asking when memory is freed if cText is dynamic string
in cText := <neVal> operation then it's done after creating <newVal>
so cText := NIL frees it before and allows to reuse this memory. Anyhow
it does not have to give faster execution or reduce total memory consumption
because MM keeps some pool of memory ready for reuse immediately without and
low level OS calls. Such manyally optimizations usually gives slower and
bigger code because new PCODEs are added and badly interacts with memory
usage statistics dynamically created by memory manager use to reduce low
level OS calls for memory request/release.
In some situation when cText is very big string item allocating many
megabytes it may help if you release this item as soon as possible, f.e.
by assigning NIL to it so the memory will be returned to OS and can be
reused by other programs which may also need it but that's all.

best regards,
Przemek
From bedipritpal at hotmail.com  Mon Nov  3 14:40:31 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Mon Nov  3 14:40:35 2008
Subject: [Harbour] MT - WorkAreas - A Feature Request
In-Reply-To: <20081103142632.GA18225@34-mo7-2.acn.waw.pl>
References: <20268713.post@talk.nabble.com>
	<20081101210056.GB15722@34-mo7-2.acn.waw.pl>
	<20290030.post@talk.nabble.com> <20290105.post@talk.nabble.com>
	<20290173.post@talk.nabble.com>
	<20081103142632.GA18225@34-mo7-2.acn.waw.pl>
Message-ID: <20309266.post@talk.nabble.com>


Przemek

>>>
Why don't you want to store such unique ID in WA structure and
then simply use it?
<<<

I intend to keep the generated number from 
( ThreadID() * MAX_WA_NUM + nWA ) in 
MY_WADATAINIT() structure. My questions was 
how I am generating this number is ok or not.

OR

I can have a RDD wide static s_nWA and increase it whenever 
new table is opened, of cource guarded with mutexes, and store it in 
MY_WADATAINIT()[ MY_NWA ].

<<<
You are introducing solutions which at beginning creates limitations.
Have you thought what will happen when WA will be accessed by other
thread? What about hb_dbDeatach()/hb_dbRequest()?
>>>

I was aware of this fact and now it is spretty much easier to 
simulate the unique wa without compromizing the natural functionality.

Thanks for guidelines.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/MT---WorkAreas---A-Feature-Request-tp20268713p20309266.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Mon Nov  3 14:39:31 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 15:03:02 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <20081103175818.GA18562@34-mo7-2.acn.waw.pl>
References: <E99C63FD-BE1F-42B3-AD25-232500685229@syenar.hu>
	<20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
	<4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
	<20081103175818.GA18562@34-mo7-2.acn.waw.pl>
Message-ID: <FA683BD5-AE5B-4DEB-918A-3C74E9CEFF44@syenar.hu>

>
Hi Przemek,

> What about situations when part of expression is taken
> from your source code and other part from table?
>   INDEX ON FOR MY_FIELD <= "[text with national character]"
>
> If you begin to implement it and resolve all problems which will
> appear then you will end with CDP pointer attached to each string
> item (HB_IT_STRING) what in some cases may not be bed idea but you
> will also have to define the behavior of + and - operations for  
> strings
> with two different encoding. Probably by simple using encoding of 1-st
> nonempty string. Next it will be necessary to define the behavior of
> <, <=, >, >=, =, ==, $ operators for strings with different encoding
> and implement it in HVM. Without attaching CDP information to string
> item you will not be able to realize above idea because when string
> item is created the evaluation context may not be known yet.
> So as long as we will not have such functionality we have to use  
> simplified
> version which translate all strings to one encoding used by  
> application.

Yes, that's exactly what you say, the CP context
is not even process dependent, but string dependent.
This is the right solution. It's not a quick and easy
feature though unfortunately.

And here could come the advantage of being internally Unicode,
since in this case the CP doesn't need to be added next to
each string. And this is probably we should rather do, instead
of introducing CP information for each string. And just catch
the I/O points where such CP information is needed to know
how to interpret non-Unicode strings.

> No it's not different topic because you can have in one expression
> string items created from .prg source code and string items created
> from table. If you have
>   INDEX ON ... FOR MY_FIELD1=="<string with national character>"
> then MY_FIELD1 have to be created with the same encoding as item  
> created
> by "<string with national character>" or during '==' evaluation you  
> will
> have to make translation dynamically. To make it dynamically you  
> will have
> to attach to each string item information about CDP or use some  
> arbitrary
> CDP used for all comparisons.

Unfortunately this is currently not easily or generically
possible, by using explicit functions calls that is.

[ There was a problem report quite a while ago which targeted
this problem, and the solution was to sync a few collations
to make it suitable for such conversion. There is a lot to do
here overall. ]

>>> I can also update all existing code and add CODEPAGE clause to USE  
>>> and
> related commands/functions:
>   use table new codepage hb_setcodepage()
>   copy to table2 codepage hb_setcodepage()
> What is exactly the same what you have do in new code when you want
> to enable automatic translations.
> There different is only that your proposition breaks backward
> compatibility because existing Clipper code will have to be updated.
>
>>> translation and want to open table in raw form, f.e. to extract  
>>> binary
>>> so it will break existing code. The old problems will still exists  
>>> and we
>>> will have new one. User will have to add to existing code saving and
>>> restoring hb_rdddefaultcodepage() to make it structural safe.
>> No existing code will be broken, as this is a new command,
>> and no defaults would be changed.
>
> See above. It will be yet another _SET_EXACT switch :-(

Okay I now see your concern.

Anyhow the RDD codepage support seems also quite broken then,
and the final word is that currently Harbour doesn't really
support CPs, besides one per app selected for the RDDs plus
all the app string functions (comparison, UPPER()/LOWER()),
and there is a grade of support to convert strings to another
CP for GT output. Period.

This - even now - could cause all sort of problems, if a
3rd party lib tries to fiddle with hb_setcodepage().

>> [ my battery going flat in a minute. See you later ]
>
> :-)

Back on A/C power now :)

Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov  3 15:30:35 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 15:29:57 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <FA683BD5-AE5B-4DEB-918A-3C74E9CEFF44@syenar.hu>
References: <20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
	<4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
	<20081103175818.GA18562@34-mo7-2.acn.waw.pl>
	<FA683BD5-AE5B-4DEB-918A-3C74E9CEFF44@syenar.hu>
Message-ID: <20081103203035.GA14116@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> And here could come the advantage of being internally Unicode,
> since in this case the CP doesn't need to be added next to
> each string. And this is probably we should rather do, instead
> of introducing CP information for each string. And just catch
> the I/O points where such CP information is needed to know
> how to interpret non-Unicode strings.

But how do you plan plan to resolve the problem with binary data?
What to do with FREAD()/FWRITE() buffers?
Using internally UNICODE for all string items resolves one problem
but creates many new ones for code which have to operate on binary
data.

> Anyhow the RDD codepage support seems also quite broken then,
> and the final word is that currently Harbour doesn't really
> support CPs, besides one per app selected for the RDDs plus
> all the app string functions (comparison, UPPER()/LOWER()),
> and there is a grade of support to convert strings to another
> CP for GT output. Period.

Harbour support some limited automatic CP conversions in some
input/output operations and allows to dynamically switch collation
rules and ALPHAs, UPPERs, LOWER sets. Nothing more nothing less.
The translation in current native RDDs is in practice limited to
single country CPs. It allows to resolve problems introduced by many
historical CPs and I guess it was Alexander intention when he was
adding it. I'm finding it usable in my country where I have to leave
with ISO-8859-2, CP852, CP1250, Mazovia and few other CPs much more
seldom used.

> This - even now - could cause all sort of problems, if a
> 3rd party lib tries to fiddle with hb_setcodepage().

Yes of course. But the same you can say about most of other SETs.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Nov  3 16:55:07 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 17:05:18 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <20081103203035.GA14116@34-mo7-2.acn.waw.pl>
References: <20081103135632.GB16835@34-mo7-2.acn.waw.pl>
	<F981777C-297E-459B-B8A1-EEF649C0F7E6@syenar.hu>
	<20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
	<4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
	<20081103175818.GA18562@34-mo7-2.acn.waw.pl>
	<FA683BD5-AE5B-4DEB-918A-3C74E9CEFF44@syenar.hu>
	<20081103203035.GA14116@34-mo7-2.acn.waw.pl>
Message-ID: <103C48ED-7C9B-4B9F-846E-4E645867EB69@syenar.hu>

>>
Hi Przemek,

>> And here could come the advantage of being internally Unicode,
>> since in this case the CP doesn't need to be added next to
>> each string. And this is probably we should rather do, instead
>> of introducing CP information for each string. And just catch
>> the I/O points where such CP information is needed to know
>> how to interpret non-Unicode strings.
>
> But how do you plan plan to resolve the problem with binary data?
> What to do with FREAD()/FWRITE() buffers?
> Using internally UNICODE for all string items resolves one problem
> but creates many new ones for code which have to operate on binary
> data.

I'm probably not able to see all the implications of binary
data, but to me, binary data is just a bunch of 0x00-0xFF bytes
and that's it (sorry for my simplistic and ignorant POV).
Usually you don't sort binary data, and you don't do UPPER()
on it, if someone does, it his problem. Anyhow, FRead()/FWrite()
are exactly to such I/O points where CP conversion may occur,
and we'd need some ways to control CPs at this point, even if
we'd only handle text. If we allow setting up a CP, one such
special CP could be 'raw data', meaning, there is no need to
touch/convert it at all, handle it as is. I'm not sure if this
fact needs to be attached to the strings to be used at later
times.

That of course could also mean that special field type needs
to be reserved for such binary data in .dbf (or other) tables,
to help handling that problem. [ Reading "normal" text fields
will automatically converted between DB CP and internal Unicode,
while we need some convenient ways to prevent that for some
special - binary - data. ]

And that instantly explains the reason why BLOB fields were
born. In Clipper this looked like superfluous stuff, and not
really necessary, since every field is "BLOB", even a simple
memo will do. But in case of such Unicode trickery, it's
starting to have a point.

So, generically speaking all these I/O points needs to be
resolved, taking into account CP/binary-raw flagging. Just
like we do now with GTs.

Even if we've agreed on the internals, of course we'd also
need to solve to keep everything Clipper compatible.

>> Anyhow the RDD codepage support seems also quite broken then,
>> and the final word is that currently Harbour doesn't really
>> support CPs, besides one per app selected for the RDDs plus
>> all the app string functions (comparison, UPPER()/LOWER()),
>> and there is a grade of support to convert strings to another
>> CP for GT output. Period.
>
> Harbour support some limited automatic CP conversions in some
> input/output operations and allows to dynamically switch collation
> rules and ALPHAs, UPPERs, LOWER sets. Nothing more nothing less.

Yes, but that's attached to the RDD (== app) collation, which makes
it extremely dangerous to use unfortunately. Maybe we should
(or we may already do) have function to just do:
hb_strUpper/Lower( <string>, <CP> )
hb_strIsAlpha( <char>, <CP> )
[names tentative]

We seem to have the C level functions for these, but not the
.prg AFAIK.

[ And maybe I don't even need them, I'll reexamine my code
regarding these issues. I definitely need proper conversions
though (852 -> Win, Win -> 852, Win/852 -> utf8), it would be
much nicer to use Harbour for these tasks. ]

> The translation in current native RDDs is in practice limited to
> single country CPs. It allows to resolve problems introduced by many
> historical CPs and I guess it was Alexander intention when he was
> adding it. I'm finding it usable in my country where I have to leave
> with ISO-8859-2, CP852, CP1250, Mazovia and few other CPs much more
> seldom used.

Don't get me wrong, I'm not complaining about what we have
so far, and kudos for Alexander for all the work it took,
very nice job.

Just looking where to move forward, that's all.

>> This - even now - could cause all sort of problems, if a
>> 3rd party lib tries to fiddle with hb_setcodepage().
>
> Yes of course. But the same you can say about most of other SETs.

BTW, why isn't hb_setcodepage() a simple Set()? Shouldn't we
convert it to one? IMO we should. What do you think?

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov  3 17:34:58 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 17:35:14 2008
Subject: [Harbour] 2008-11-03 14:31 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93e04$Blat.v2.6.2$66e8129b$1b24c1d5058@127.0.0.1>

2008-11-03 14:31 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
  * source/codepage/Makefile
  + source/codepage/cpsviso.c
    + Added SVISO, which is the same as SVWIN, except it's 
      internally using ISO-8859-1 CP in sync with its name.

  * source/codepage/cpsvwin.c
    ! Changed internal CP to Windows-1252 from ISO-8859-1, 
      so that it's in sync with its name.
--
Brgds,
Viktor

From dmacias at mail.udg.mx  Mon Nov  3 17:53:02 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov  3 17:52:59 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490F80CE.2010502@mail.udg.mx>

 >2008-11-03 14:08 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/include/hbthread.h
 >  * harbour/source/vm/thread.c
 >    + added ULONG _hb_gettid( void ) to OS2 builds - thanks to Maurilio

 >  * harbour/source/rtl/hbinet.c
 >    * changed a little bit the order of including header files in OS2
 >      builds (blink fix for OpenWatcom OS2 builds).

 >2008-11-03 17:49 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/include/hbthread.h
 >    * include <process.h> in OpenWatcom OS2 builds


Thanks Przemek

Not checked
[ Current Harbour code compile fine with gcc335 with just well known 
warnings ]


With OpenWatcom 1.7:
- Screen output
-----------------------
make[3]: *** [hbinet.obj] Error 8
make[2]: *** [descend] Error 2
make[4]: *** [thread.obj] Error 8
make[3]: *** [descend] Error 2
make[2]: *** [first] Error 2
make[3]: [hbrun.exe] Error 1 (ignored)
make[3]: [hbtest.exe] Error 1 (ignored)
make[3]: [hbdoc.exe] Error 1 (ignored)
make[3]: [hbmake.exe] Error 1 (ignored)
make[3]: *** [hbcrypt.obj] Error 8
make[2]: *** [descend] Error 2
-----------------------

. 34 libraries created

- 2 executables created: harbour.exe, hbpp.exe

- New make_ow.log
Sent

In hbvm.lib creation appear:
--------------------
Warning! Duplicate symbol 'main_' ignored.
make[3]: Leaving directory `/harbour810/harbour/source/vm/os2/owatcom'
--------------------

David Macias


From harbour.01 at syenar.hu  Mon Nov  3 18:15:44 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 18:15:52 2008
Subject: [Harbour] 2008-11-04 00:15 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93e0a$Blat.v2.6.2$18d3ab41$1170f432b036@127.0.0.1>

2008-11-04 00:15 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
  * source/codepage/Makefile
  + source/codepage/cpitwin.c
    + Added ITWIN. Same as ITISO, with a different attached CP 
      and name.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov  3 18:27:32 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 18:26:54 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <103C48ED-7C9B-4B9F-846E-4E645867EB69@syenar.hu>
References: <20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
	<4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
	<20081103175818.GA18562@34-mo7-2.acn.waw.pl>
	<FA683BD5-AE5B-4DEB-918A-3C74E9CEFF44@syenar.hu>
	<20081103203035.GA14116@34-mo7-2.acn.waw.pl>
	<103C48ED-7C9B-4B9F-846E-4E645867EB69@syenar.hu>
Message-ID: <20081103232732.GA3587@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> I'm probably not able to see all the implications of binary
> data, but to me, binary data is just a bunch of 0x00-0xFF bytes
> and that's it (sorry for my simplistic and ignorant POV).
> Usually you don't sort binary data, and you don't do UPPER()
> on it, if someone does, it his problem. Anyhow, FRead()/FWrite()
> are exactly to such I/O points where CP conversion may occur,
> and we'd need some ways to control CPs at this point, even if
> we'd only handle text. If we allow setting up a CP, one such
> special CP could be 'raw data', meaning, there is no need to
> touch/convert it at all, handle it as is. I'm not sure if this
> fact needs to be attached to the strings to be used at later
> times.

We do not know how user used character items with FREAD()/FWRITE().
And this is only an example. There is much more similar functions.
I was thinking about this problem and the only one solution I can
see which will not break backward compatibility is introducing
two types of string items with byte and unicode representation
and functions to make conversions between both formats using
some given CP or when not specified default HVM CP. Otherwise
we will lost backward compatibility. It will have to be bound
with C API which will hide internal HVM representation for C code.

> That of course could also mean that special field type needs
> to be reserved for such binary data in .dbf (or other) tables,
> to help handling that problem. [ Reading "normal" text fields
> will automatically converted between DB CP and internal Unicode,
> while we need some convenient ways to prevent that for some
> special - binary - data. ]

DBF format already has one bit in each field definition stored
in DBF header used to mark it as binary. Unfortunatelly Clipper
does not fill correctly any fields which were not used by Clipper
DBF* RDDs directly and they are random in DBF files created by
Clipper. Anyhow we can resolve it by adding some additional
signature in DBF header so it will work at least for DBFs created
by Harbour (and VFP for which we already read extended field
attributes because such DBFs uses different signature so we
can easy recognize them).

> And that instantly explains the reason why BLOB fields were
> born. In Clipper this looked like superfluous stuff, and not
> really necessary, since every field is "BLOB", even a simple
> memo will do. But in case of such Unicode trickery, it's
> starting to have a point.

BLOB fields may imply also other things though usually it's
binary MEMO field.

> So, generically speaking all these I/O points needs to be
> resolved, taking into account CP/binary-raw flagging. Just
> like we do now with GTs.

Not only IO. What about functions like CHR() or ASC()?
Should they operate on Unicode values or CP indexes?
What about [IL]2BIN()? Should it return Unicode string or
byte string? What about LEN()? What it should return number
of bytes or characters?
Each time will change sth to unconditionally operate on Unicode
I can create example of existing Clipper code which will be broken.

> Even if we've agreed on the internals, of course we'd also
> need to solve to keep everything Clipper compatible.

And this is the most important problem. We are not creating
new language where we can define everything from scratch.
It means that we will have to introduce Unicode items as
and option so users can use them if their existing .prg code
is ready for such representation.

> Yes, but that's attached to the RDD (== app) collation, which makes
> it extremely dangerous to use unfortunately. Maybe we should
> (or we may already do) have function to just do:
> hb_strUpper/Lower( <string>, <CP> )
> hb_strIsAlpha( <char>, <CP> )
> [names tentative]

We do not have such .prg functions but we can add them.
They can be also written as .prg code, f.e.:

   func UpperCP( cVal, cCPID )
      local cOldCP := hb_setCodepage( cCPID ), cResult
      cResult := Upper( cVal )
      hb_setCodepage( cOldCP )
   return cResult

> We seem to have the C level functions for these, but not the
> .prg AFAIK.

Yes.

> [ And maybe I don't even need them, I'll reexamine my code
> regarding these issues. I definitely need proper conversions
> though (852 -> Win, Win -> 852, Win/852 -> utf8), it would be
> much nicer to use Harbour for these tasks. ]

If you are interested only in Hungarian national characters
then CODEPAGE in RDD will make such conversion for you. If you
want to make conversions for all other characters then we do
not have such functionality now. The UTF8 translations introduce
yet another problems for fixed size fields: variable string
length. So far non of our RDDs support it. I wanted to add
such translations but I will have to introduce meta Harbour CP
called UTF8 which can be used as CODEPAGE parameter so RDD can
recognize it and use it only for translation without touching
collation.
In general we have serious problem with naming convention.
Now we are using two letters country ID and then our own
identifier for CP. Probably we should unify it and use sth
like: <lang_ID>_<country_ID>.<encoding> - it's standard way
used by locale. It will help to eliminate repeated MSG* modules
with different encoding. We will need only one and all others
can be created dynamically by simple online translation. So
lang modules will use <lang_ID>_<country_ID> as identifier
and internal field <encoding> used for online translations.
The same we can introduce to i18n modules.

> BTW, why isn't hb_setcodepage() a simple Set()? Shouldn't we
> convert it to one? IMO we should. What do you think?

I've already added _SET_CODEPAGE with MT modifications:

   2008-09-13 18:49 UTC+0200 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
   [...]
     * harbour/include/set.ch
     * harbour/include/hbset.h
       + added _SET_CODEPAGE which works like _SET_LANGUAGE giving common
         interface

You can use SET( _SET_CODEPAGE [, <cNewVal> ] ) and
SET( _SET_LANGUAGE [, <cNewVal> ] ) instead of hb_setCodepage()/
hb_langSelect().

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov  3 19:04:24 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 19:03:44 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <490F80CE.2010502@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490F80CE.2010502@mail.udg.mx>
Message-ID: <20081104000424.GA24124@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> >2008-11-03 17:49 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
> >  * harbour/include/hbthread.h
> >    * include <process.h> in OpenWatcom OS2 builds

../../../thread.c(402): Error! E029: col(13) symbol '_beginthread' has not been declared
../../../thread.c(573): Error! E029: col(4) symbol '_endthread' has not been declared

Oops. My typo:
   #elif defined( HB_OS_WIN_OS2 )
instead of:
   #elif defined( HB_OS_OS2 )

I'll fix it in a while.

> With OpenWatcom 1.7:
> - Screen output
> -----------------------
> make[3]: *** [hbinet.obj] Error 8

It will be necessary to make some modifications in order of included
files. I'll make it.

> In hbvm.lib creation appear:
> --------------------
> Warning! Duplicate symbol 'main_' ignored.
> make[3]: Leaving directory `/harbour810/harbour/source/vm/os2/owatcom'
> --------------------

This problem exists also in GCC build but AR does not report it.
I do not know which main() function is used for final binaries.
Probably the 1-st one from mainstd.c not the one from mainpm.c.
I'll exclude mainpm.c from HVM library. Please test if it does
not break GCC builds. If mainpm.c is necessary then it should
be part of separated library just like mainwin in libmainwin
in MinGW builds.

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov  3 19:04:32 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 19:03:53 2008
Subject: [Harbour] 2008-11-04 01:04 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081104000432.GA20482@34-mo7-2.acn.waw.pl>

2008-11-04 01:04 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbthread.h
    ! fixed typo

  * harbour/source/vm/Makefile
    * excluded mainpm.c from OS2 builds

  * harbour/source/rtl/hbinet.c
    * changed the #include order for OS2 OpenWatcom builds and added some
      cleanups - please test other builds.

best regards
Przemek
From dmacias at mail.udg.mx  Mon Nov  3 19:33:12 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov  3 19:33:08 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490F9848.3020306@mail.udg.mx>

 >Oops. My typo:
 >   #elif defined( HB_OS_WIN_OS2 )
 >instead of:
 >   #elif defined( HB_OS_OS2 )

 >I'll fix it in a while.

You downgraded OS/2  :-)

 >> make[3]: *** [hbinet.obj] Error 8

 >It will be necessary to make some modifications in order of included
 >files. I'll make it.

 >This problem exists also in GCC build but AR does not report it.
 >I do not know which main() function is used for final binaries.
 >Probably the 1-st one from mainstd.c not the one from mainpm.c.
 >I'll exclude mainpm.c from HVM library. Please test if it does
 >not break GCC builds. If mainpm.c is necessary then it should
 >be part of separated library just like mainwin in libmainwin
 >in MinGW builds.

I will test with gcc later


 >2008-11-04 01:04 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/include/hbthread.h
 >    ! fixed typo

 >  * harbour/source/vm/Makefile
 >    * excluded mainpm.c from OS2 builds

 >  * harbour/source/rtl/hbinet.c
 >    * changed the #include order for OS2 OpenWatcom builds and added
 >       some cleanups - please test other builds.

Thanks Przemek

Not checked
[ Current Harbour code compile fine with gcc335 with just well known
warnings ]


With OpenWatcom 1.7:
- Screen output
-----------------------
make[3]: *** [seconds.obj] Error 8
make[2]: *** [descend] Error 2
make[4]: *** [thread.obj] Error 8
make[3]: *** [descend] Error 2
make[2]: *** [first] Error 2
make[3]: [hbrun.exe] Error 1 (ignored)
make[3]: [hbtest.exe] Error 1 (ignored)
make[3]: [hbdoc.exe] Error 1 (ignored)
make[3]: [hbmake.exe] Error 1 (ignored)
make[3]: *** [hbcrypt.obj] Error 8
make[2]: *** [descend] Error 2
-----------------------

. 34 libraries created

- 2 executables created: harbour.exe, hbpp.exe

- New make_ow.log
Sent

David Macias


From druzus at acn.waw.pl  Mon Nov  3 20:08:41 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 20:08:01 2008
Subject: [Harbour] 2008-11-04 02:08 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081104010841.GA16389@34-mo7-2.acn.waw.pl>

2008-11-04 02:08 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/vm/thread.c
    * removed casting to void* thread startup function passed
      as _beginthread() parameter in OS2 builds. It should be checked if
      it does not breaks GCC builds.

  * harbour/source/rtl/seconds.c
    * use getpid() instead of _getpid() in non GCC OS2 builds

best regards
Przemek
From druzus at acn.waw.pl  Mon Nov  3 20:12:10 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 20:11:30 2008
Subject: [Harbour] 2008-11-04 02:12 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081104011210.GA19063@34-mo7-2.acn.waw.pl>

2008-11-04 02:12 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rtl/seconds.c
    + added #include <process.h> to OpenWatcom OS2 builds.

best regards
Przemek
From druzus at acn.waw.pl  Mon Nov  3 20:13:45 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov  3 20:13:04 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <490F9848.3020306@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<490F9848.3020306@mail.udg.mx>
Message-ID: <20081104011345.GA1714@34-mo7-2.acn.waw.pl>

On Mon, 03 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> With OpenWatcom 1.7:
> - Screen output
> -----------------------
> make[3]: *** [seconds.obj] Error 8
> make[4]: *** [thread.obj] Error 8

Thanks for tests. This should be fixed. Please try after:
   2008-11-04 02:12 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Nov  3 20:41:10 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov  3 20:41:19 2008
Subject: [Harbour] codepage and RDD
In-Reply-To: <20081103232732.GA3587@34-mo7-2.acn.waw.pl>
References: <20081103145435.GA27285@34-mo7-2.acn.waw.pl>
	<38C0A87D-7141-4756-BF3F-97945E17EA0C@syenar.hu>
	<20081103154941.GA15784@34-mo7-2.acn.waw.pl>
	<FFCCEEFC-6FE3-4E47-B66A-94C3AB2DD2A5@syenar.hu>
	<20081103162932.GA16061@34-mo7-2.acn.waw.pl>
	<4726FDE5-4064-43A3-B7DF-9898B6718ED1@syenar.hu>
	<20081103175818.GA18562@34-mo7-2.acn.waw.pl>
	<FA683BD5-AE5B-4DEB-918A-3C74E9CEFF44@syenar.hu>
	<20081103203035.GA14116@34-mo7-2.acn.waw.pl>
	<103C48ED-7C9B-4B9F-846E-4E645867EB69@syenar.hu>
	<20081103232732.GA3587@34-mo7-2.acn.waw.pl>
Message-ID: <2649BAF1-3776-4C17-9A62-1F4A98A07DF6@syenar.hu>

>
Hi Przemek,

[ Well, sorry in advance if I may look like contradicting
myself along the line below. But along my answering I got
to understand your idea better, and this gets reflected
in reactions. Also, I didn't answer in "descending" order
in all cases. But it's too late now to restart the whole
mail. Brainstorm style. ]

> We do not know how user used character items with FREAD()/FWRITE().
> And this is only an example. There is much more similar functions.
> I was thinking about this problem and the only one solution I can
> see which will not break backward compatibility is introducing
> two types of string items with byte and unicode representation
> and functions to make conversions between both formats using
> some given CP or when not specified default HVM CP. Otherwise
> we will lost backward compatibility. It will have to be bound
> with C API which will hide internal HVM representation for C code.

Yes, this may be a solution, although it pushes IMO the
language to a less elegant style. It would be nice to
keep it simple and have only one kind of string type, if
there is any possibility of it. This way it would need
heavy code modifications to make it possible to actually
use Unicode. My feeling is that switching to Unicode cannot
be made fully two-way compatible anyway, this means that
programs will have to be modified in one way or another
to make use of it. These required modifications will most
probably make the given apps incompatible with Clipper
anyway. For this reason the question is rather how to
make the transition the less painful, more natural, and
the most transparent (easy to identify modifications,
with a clear "upgrade path").

I'd expect that f.e. CHR() to return - say - 14783 for
an accented char is okay, if the user has chosen to
enable Unicode, and it's easier to prepare the app for this
case, than changing all 'ValType( s ) == "C"' expressions
to 'ValType( s ) $ "CU"' (given that "U" is the type code
of a Unicode string). With two types the developer will
always have to keep in mind which string has which kind
from the first assignment. I'd think that a compiler
switch to enable Unicode for a given program is a nicer
way to deal with it, at least as far as the end result
goes. I know there are lots of issue, like macros, lib
code, mixed code, C legacy code. Probably the C API
will have to be duplicated in any case.

>> So, generically speaking all these I/O points needs to be
>> resolved, taking into account CP/binary-raw flagging. Just
>> like we do now with GTs.
>
> Not only IO. What about functions like CHR() or ASC()?
> Should they operate on Unicode values or CP indexes?
> What about [IL]2BIN()? Should it return Unicode string or
> byte string? What about LEN()? What it should return number
> of bytes or characters?

Chars definitely. At .prg level IMO the programmer is
the happiest if he doesn't even have to know what a byte
is for such a basic string function. BYTEs don't have
too much meaning as it can be 'n' if the internal
representation is UTF8 and 'm' if it's UTF16, but this
details should be fully abstracted on the .prg level.
[I|L]2BIN() is an interesting example, it could return
8 bytes, 4 chars in the 0x0000-0x00FF range and explicitly
ask for some kind of conversion when written to disk.
Or mark the string as binary (internally) and let the system
handle the issue automatically if that's possible. It's
important to consider that Clipper/Harbour is mainly aimed
for normal business app development, and as such, 99% of
string operations will be _real string operations_. The rest
is such exceptions as *2BIN()/BIN2*(), and IMO it's important
to handle them both in some ways, but we should first and
foremost help the mainstream usage rather than being too
much carried away with these exceptions. So we may even
think about a special set of API dealing with non-Unicode
chars (= raw bytes), to allow using such low-level constructs
as *2BIN and BIN2*. It will be much easier to rewrite the
low-level parts than having to review whole app code. We
may even introduce such binary API in advance to help
transition in time. The API could even be implemented as
a stub for Clipper, so two-way code transition stays
possible. At this point I may say the same as you, different
string types in practice, but I'd rather say we'd need
a new binary type (and using it in appropriate functions)
plus just convert existing string type to Unicode as is.

As for CHR()/ASC() I think they should access/return
a number between 0-65535 vs. a Unicode char.

> Each time will change sth to unconditionally operate on Unicode
> I can create example of existing Clipper code which will be broken.

If these points are clearly identifiable, and/or are
rather exceptions than the rule in normal app code, I
think we could just as well live with them. Unicode is
a brand new concept (just like MT), and a one push of
a button transition while keeping full compatibility
is a technical utopia anyway.

We may also introduce compatibility level command line
switch or #pragma to carefully let old concepts go,
and/or turn on new ones like this one, if these old
concepts are in the way of useful core additions.

In any case we need to identify as much problem
(compatibility) points in advance as possible. Maybe
we'll better see the good direction, and whether there
is one generic solution to solve them, or we need to
decide one by one.

>> Even if we've agreed on the internals, of course we'd also
>> need to solve to keep everything Clipper compatible.
>
> And this is the most important problem. We are not creating
> new language where we can define everything from scratch.
> It means that we will have to introduce Unicode items as
> and option so users can use them if their existing .prg code
> is ready for such representation.

Yes, or define new API in advance to lay a clear route to
prepare for transition and when Harbour is ready switch,
maybe a compiler switch will suffice to make the last
step for the developers.

>> Yes, but that's attached to the RDD (== app) collation, which makes
>> it extremely dangerous to use unfortunately. Maybe we should
>> (or we may already do) have function to just do:
>> hb_strUpper/Lower( <string>, <CP> )
>> hb_strIsAlpha( <char>, <CP> )
>> [names tentative]
>
> We do not have such .prg functions but we can add them.
> They can be also written as .prg code, f.e.:
>
>   func UpperCP( cVal, cCPID )
>      local cOldCP := hb_setCodepage( cCPID ), cResult
>      cResult := Upper( cVal )
>      hb_setCodepage( cOldCP )
>   return cResult

Good idea.

>> We seem to have the C level functions for these, but not the
>> .prg AFAIK.
>
> Yes.
>
>> [ And maybe I don't even need them, I'll reexamine my code
>> regarding these issues. I definitely need proper conversions
>> though (852 -> Win, Win -> 852, Win/852 -> utf8), it would be
>> much nicer to use Harbour for these tasks. ]
>
> If you are interested only in Hungarian national characters
> then CODEPAGE in RDD will make such conversion for you. If you
> want to make conversions for all other characters then we do
> not have such functionality now. The UTF8 translations introduce
> yet another problems for fixed size fields: variable string
> length. So far non of our RDDs support it. I wanted to add
> such translations but I will have to introduce meta Harbour CP
> called UTF8 which can be used as CODEPAGE parameter so RDD can
> recognize it and use it only for translation without touching
> collation.
> In general we have serious problem with naming convention.
> Now we are using two letters country ID and then our own
> identifier for CP. Probably we should unify it and use sth
> like: <lang_ID>_<country_ID>.<encoding> - it's standard way
> used by locale. It will help to eliminate repeated MSG* modules
> with different encoding. We will need only one and all others
> can be created dynamically by simple online translation. So
> lang modules will use <lang_ID>_<country_ID> as identifier
> and internal field <encoding> used for online translations.
> The same we can introduce to i18n modules.

I fully agree. Current system was largely the result
of 8.3 naming convention and keeping one unified ID
thorough the filename and internally. <encoding> should
also be standardized as we have quite same variations
above official standard names (WINM, "Clipper"). Also
"852" is officially "IBM852" (with some aliases, but
we should stick with some kind standard here, too,
this is IBM*, Windows-*, ISO-8859-* for most cases.).
Question how pedantic we want to be?

BTW I theoretically need not just HU CP and collation,
but I'll revise all these matters as things were already
very inflexible in Clipper times, so it looks it's
time to rethink the concept a bit and do a good balance
between features and manageability (and possibilities).

What do you think are the practical chance or possibility
to use an existing external lib - like iconv - to deal
with low-level CP issues? It's a quite ugly GNU monster,
I personally don't see too much.

>> BTW, why isn't hb_setcodepage() a simple Set()? Shouldn't we
>> convert it to one? IMO we should. What do you think?
>
> I've already added _SET_CODEPAGE with MT modifications:
>
>   2008-09-13 18:49 UTC+0200 Przemyslaw Czerpak (druzus/at/ 
> priv.onet.pl)
>   [...]
>     * harbour/include/set.ch
>     * harbour/include/hbset.h
>       + added _SET_CODEPAGE which works like _SET_LANGUAGE giving  
> common
>         interface
>
> You can use SET( _SET_CODEPAGE [, <cNewVal> ] ) and
> SET( _SET_LANGUAGE [, <cNewVal> ] ) instead of hb_setCodepage()/
> hb_langSelect().

Thanks a lot. Banging open doors, I missed that in the midst of
all the other things.

Brgds,
Viktor

From bedipritpal at hotmail.com  Mon Nov  3 21:32:46 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Mon Nov  3 21:32:49 2008
Subject: [Harbour] Higher Level Classes to Manage Consoles
Message-ID: <20315173.post@talk.nabble.com>


Hello All

I am about to introduce Active-X controls in GTWVG 
with EVENTS management. The first results are very encouraging.
The basic code is contributed by Andy Wos which I have tuned-up
a little to adopt to GTWVG/GTWVT. Our beloved console window
is now able to host any Active-X control like Internet Explorer,
Acrobat, Excel, Shell Explorer, etc. and has the capabilities to
respond to events fired by the control and manage its methods
and properties as usual Harbour objects.

Here is a executable and sources. Just copy files in the zip to
harbour/contrib/gtwvg/tests and run the demowvg.exe.
Click <Modeless Dialogs><Active-X ...>  prompts. Just do not 
give attention to screen refresh glitches. To close the window, 
press ESC. If ESC does not work, then click on taskbar to minimize
and then maximize then press ESC. Sometimes focus is not 
moved back to console even you click on the title bar.

http://www.vouch.info/downloads/demowvg_ax.zip

As these type of functionality is always a pain if done via
function calls only, I intend to introduce class framework
to manage these components properly. 

To begin with I have in mind a Dialog class and an Active-X class.
Dialog class will be a wrapper to existing pre called functions to 
configure a console window like:

[SEC 1]
   hb_gtReload( 'WVG' )
   hb_gtInfo( HB_GTI_PRESPARAMS, { , , 10, 10, 400, 400, , .F., .F. } )
   SetColor( 'N/W' )
   CLS
   SetMode( 30,60 )
   SetCursor( 0 )
   Wvt_ShowWindow( 1 )
   hb_gtInfo( HB_GTI_CLOSABLE, .F. )

after which the actual console code becomes eligible for rendering
[SEC 2]
   Alert( 'I am in the child window!' )

and then the cleanup ( if it is a window in same thread )
[SEC 3]
   pGT1 := NIL
   hb_gtSelect( pGT )
   hb_gtInfo( HB_GTI_ENABLE, pGT )
   hb_gtInfo( HB_GTI_SETFOCUS, pGT )

Now to the real point of discussion:

As this effort may lead to building a GUI framework, as I think positively, 
I want to start it on the firm grounds from the base itself. There are a 
lot many object modals are in usage in Harbour, or say, Clipper world, viz.,
FWH, XAILER, VXH, HWGUI, MINIGUI, etc., and XBASE++.
For me Xbase++ modal stands best of all and has a clear implementation 
details in place.

Now the namespace issue.
I propose to have all classes same names as Xbase++ and same 
number of parameter passing and same life cycle. The only difference
will be "Hb" as prefix instrad of "Xbp". thus
XbpActiveXControl() => HbActiveXControl(). 
Source file naming may also follow a standard rule.

I need your opinions on the topic before I start writing something.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/Higher-Level-Classes-to-Manage-Consoles-tp20315173p20315173.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dmacias at mail.udg.mx  Tue Nov  4 01:11:34 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov  4 01:11:31 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490FE796.6000609@mail.udg.mx>

 >2008-11-04 02:08 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/source/vm/thread.c
 >    * removed casting to void* thread startup function passed
 >      as _beginthread() parameter in OS2 builds. It should be checked if
 >      it does not breaks GCC builds.

 >  * harbour/source/rtl/seconds.c
 >    * use getpid() instead of _getpid() in non GCC OS2 builds
 >
 >2008-11-04 02:12 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/source/rtl/seconds.c
 >    + added #include <process.h> to OpenWatcom OS2 builds.
 >
 >Thanks for tests. This should be fixed. Please try after:
 >   2008-11-04 02:12 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)


Thanks Przemek

Checked
Current Harbour code compile fine with gcc335 with just well known
warnings
---------------
../../gtstd.c: In function `hb_gt_std_ReadKey':
../../gtstd.c:389: warning: unused variable `TODO'
---------------


With OpenWatcom 1.7:
- Screen output
-----------------------
make[3]: *** [hbcrypt.obj] Error 8
make[2]: *** [descend] Error 2
-----------------------

. 40 libraries created
   We are near, just remain one: xhb

- 6 executables created:
   harbour.exe, hbpp.exe, hbdoc.exe, hbmake.exe, hbrun.exe, hbtest.exe

- New make_ow.log
Sent

David Macias


From ssbbs at mail.zzz.com.tw  Tue Nov  4 01:27:12 2008
From: ssbbs at mail.zzz.com.tw (=?BIG5?B?Irr0vXu46rBUoUW5+aTls9MoVw==?= =?BIG5?B?ZW5TaGVuZyki?=)
Date: Tue Nov  4 01:27:26 2008
Subject: [Harbour] Higher Level Classes to Manage Consoles
In-Reply-To: <20315173.post@talk.nabble.com>
References: <20315173.post@talk.nabble.com>
Message-ID: <20081104142636.2DF4.84A669A0@mail.zzz.com.tw>

> 
> http://www.vouch.info/downloads/demowvg_ax.zip

Thank you, But I had get error:

Called from HB_AX_SETUPCONNECTIONPOINT(0)
Called from HB_ACTIVEX:ADVISEEVENTS(87)
Called from HB_ACTIVEX:NEW(79)
Called from EXEACTIVEX(2249) in demowvg.prg
Called from EXECUTEACTIVEX(2203) in demowvg.prg
Called from (b)EVAL(1352)
From bedipritpal at hotmail.com  Tue Nov  4 01:42:10 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov  4 01:42:14 2008
Subject: [Harbour] Higher Level Classes to Manage Consoles
In-Reply-To: <20081104142636.2DF4.84A669A0@mail.zzz.com.tw>
References: <20315173.post@talk.nabble.com>
	<20081104142636.2DF4.84A669A0@mail.zzz.com.tw>
Message-ID: <20316955.post@talk.nabble.com>


Hi

Still I have not updated GTWVG. For the time being just 
play with the exe. After deciding which OO modal we have to
follow I will update accordingly.

BTW how should I interpret your name ?

Regards
Pritpal Bedi


???{???T?E??????(WenSheng) wrote:
> 
>> 
>> http://www.vouch.info/downloads/demowvg_ax.zip
> 
> Thank you, But I had get error:
> 
> Called from HB_AX_SETUPCONNECTIONPOINT(0)
> Called from HB_ACTIVEX:ADVISEEVENTS(87)
> Called from HB_ACTIVEX:NEW(79)
> Called from EXEACTIVEX(2249) in demowvg.prg
> Called from EXECUTEACTIVEX(2203) in demowvg.prg
> Called from (b)EVAL(1352)
> 
> 

-- 
View this message in context: http://www.nabble.com/Higher-Level-Classes-to-Manage-Consoles-tp20315173p20316955.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dmacias at mail.udg.mx  Tue Nov  4 01:47:32 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov  4 01:47:37 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <490FF004.80607@mail.udg.mx>

Przemek, Maurilio:

Now that we have Harbour/gcc335 and allmost Harbour/OpenWatcom 1.7 I 
started to test them
Harbour 1.1.0dev (Rev. 9824)

harbour.exe, hbpp.exe, hbdoc.exe, hbmake.exe, hbrun.exe, hbtest.exe

gcc335
======
All executables run fine

OpenWatcom
==========
harbour.exe, hbpp.exe run fine
hbdoc.exe, hbmake.exe, hbrun.exe, hbtest.exe: fail with SYS1811

Example:
-------------------
[E:\harbour810\harbourow\bin]hbtest
SYS1811: The process has stopped.  The software diagnostic code
(trap number) is  000D.

[E:\harbour810\harbourow\bin]help 1811

SYS1811: The process has stopped.  The software diagnostic code
(trap number) is ***.

EXPLANATION: The program attempted to perform an instruction that the
system cannot perform.  The software diagnostic code allows
determination of what type of instruction was attempted.

ACTION: Correct the problem or try a different version of the program.
-------------------

In make_ow.log I found:

for hbvmmt:
../../../thread.c(402): Warning! W869: col(25) use of '_beginthread' 
requires build target to be multi-threaded

for hbvmmt:
Warning! Duplicate symbol 'main_' ignored.

For hbrun.exe:
Warning! W1023: no starting address found, using 0001:00000000
creating an OS/2 32-bit executable

For hbtest.exe
Warning! W1023: no starting address found, using 0001:00000000
creating an OS/2 32-bit executable

For hbdoc.exe
Warning! W1023: no starting address found, using 0001:00000000
creating an OS/2 32-bit executable

For hbmake.exe
Warning! W1023: no starting address found, using 0001:00000000
creating an OS/2 32-bit executable

As I remember these W1023 warnings appear in previous make_ow.log files 
but I deleted all these files except latest

David Macias


From dmacias at mail.udg.mx  Tue Nov  4 02:42:25 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov  4 02:42:24 2008
Subject: [Harbour] Re: OT: New version of ClipNet-xNet Model
Message-ID: <490FFCE1.2030506@mail.udg.mx>

 >Bad link ...

 >The correct one is : ftp://sbe4730:damac@ftp.itcgrupo.es/

You are right, thanks

David Macias


Sorry for delay, I updated Clipxnet in September 16, 2008


I inform you about availability of new version of ClipNet-xNet Model

Summary of modifications:

Not translated, not included. Review in Spanish version
27.  August 2008: Enlargement of the ClipNet-xNet Model
       27a. Update based in (x)Harbour code
       27b. Nomenclature of Clipxnet files
       27c. ADORDD support
       27d. Example of ADS in SQL mode
       27e. Update of existing Clipxnet


- ClipNet-xNet Model
Clipper language interpreter using:
* command line
* Web Servers, for Web based systems

You can download from:
----------------------------------------------------------------------------
ftp://sbe4730:damac@ftp.ftp.itcgrupo.es/
----------------------------------------------------------------------------

- Extract file in directory \clipxnet ( /clipxnet )
- Review clipxeng.htm for configuration instructions,
  and new modifications in section:
    27.  August 2008: Enlargement of the ClipNet-xNet Model

You may suscribe to group for share information on Citlalli and Clipxnet:

  http://mx.groups.yahoo.com/group/clipxnet_citlalli/


Any comment are welcome

Gracias,
David Macias



From druzus at acn.waw.pl  Tue Nov  4 03:40:32 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov  4 03:39:53 2008
Subject: [Harbour] 2008-11-04 09:40 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081104084032.GA24294@34-mo7-2.acn.waw.pl>

2008-11-04 09:40 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbgtcore.h
    ! added missing 'extern' in hb_gt_dos_keyCodeTranslate() declaration

  * harbour/source/rtl/gtstd/gtstd.c
  * harbour/source/rtl/gtpca/gtpca.c
    + added support for console input in OpenWatcom builds

  * harbour/source/vm/vmmt/Makefile
    ! removed mainpm.c

  * harbour/contrib/xhb/hbcrypt.c
    ! fixed casting

best regards
Przemek
From harbour.01 at syenar.hu  Tue Nov  4 03:47:20 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 03:47:24 2008
Subject: [Harbour] 2008-11-04 09:46 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93e59$Blat.v2.6.2$f2dcf74e$16242bf16b78@127.0.0.1>

2008-11-04 09:46 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
    + Added HB_CODEPAGE_SVISO.
--
Brgds,
Viktor

From dmacias at mail.udg.mx  Tue Nov  4 03:50:08 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov  4 03:50:06 2008
Subject: [Harbour] Re: OT: New version of ClipNet-xNet Model
Message-ID: <49100CC0.6050609@mail.udg.mx>

Massimo:

Too many questions in few lines

Did you read/understood messages/documentation/source code ?  :-)
Near all answers are in them

 >What is on Citlalli and what Clipxnet?
  Citlalli: Is perhaps the best graph library in "xBase world"
     Contain features not seen in other libraries and many of them are 
shown in samples/source code
  Clipxnet: explained in message

 >Witch is new model of systems development     :-),
  Well, you take very "old technologies" and combine them to build 
systems which work/perform as well as "new technologies"

 >how Clipxnet is part of this model"?
  Explained in sisremeng.txt

 >Replace Web-browsers with modified desktop systems in client side to
 >interact with Clipxnet in server side
 >What is modified desktop sistem?
  (?) A "desktop system" which is modified for any purpose ?
  "Desktop system" are the systems in older style, when LAN/WAN/Internet 
were not as available as now
  In your "PC:Personal Computer", maybe isolated or with a "weak" 
connection to other computer, you used to run your "desktop systems"
  ( It was just a silly and limited description of "desktop system" )

 >>This "Universal System" consists of two parts:
 >>A) Client system
 >>   Usually is a Web navigator (web explorer)
<>   In this case the navigator is replaced by a classic "desktop system"
 >Wich is "desktop system" in sisremoto ?
   In the example, sisremoto.exe IS the "desktop system" acting as 
client, and sisremoto.prg IS the source code
   Based on the concept, you take ANY of your old/recent "desktop 
systems" and modify it to replicate same kind of processes shown in 
sisremoto.exe/prg, or any other as complex as you want/can
   Sisremoto.prg is the basic guideline and sisremoto.exe is the 
physical/working part of example
   I choose (x)Harbour/FWH to show a working example to reviewers, and 
Citlalli just to enhance it
   Anybody can think immediatly: "my system can be modified to do that"

   In server side Clipxnet respond requests of client side

IS "remote system" because each side can be in any part of world

 >>B) Server system

 >Can you show same screenshot for better compression?
  If you install Citlalli you will be plenty of screens
   download/expand/run hcitxnet.exe
  If you install Clipxnet you will be plenty of screens
   download/expand/configure web server/copy files/(re)start web server

Then you can choose what you like for screenshots

Clipxnet itself is a good alternative for Web-based systems, but 
combined with "desktop systems" is a greater alternative
Easy, without cost, using existing knowledge/experience, ...

Sometimes I smile because current "Web based systems" try to reach the 
same level of development/perfomance/features contained in older 
"desktop systems" made 15-20 years ago, specially "in-line validation"
Some part of the problem is the "web browser/explorer" which is not 
under your control ?, replace it with an modified "desktop system"

 >I have runned sisremoto but sorry, I don't understand
  Message said:
"sisremoto.exe was created for local tests with Clipxnet installed"
  You must to install Clipxnet to test sisremoto locally
  Functions are pointing to:
    http://127.0.0.1/download.prg
    http://127.0.0.1/receive.prg
  You can change IP and recompile to use it in any part of world
  ... but for now start testing locally  :-)

  To install Clipxnet is very easy, just follow instructions in 
clipxnet.htm (clipxeng.htm) for Windows, OS/2, Linux, and Web Servers: 
Xitami (any platform), IIS, Apache (any platform)
Do not forget to copy download.prg, receive.prg to web pages dir

In Windows the quick way is Xitami Web Server (included in Clipxnet package)
In Linux the quick way is Apache

When you setup Web server/Clipxnet and are working, run sisremoto.exe 
and click proper buttons

 >But I am intresting in idea of something like a web browser for web 
 >application
 >Can you help me?
  Sure, the samples are there with help purpose

Citlalli and Clipxnet are full of examples, and "Remote system" have his 
own key example

David Macias
From miguelangel at marchuet.net  Tue Nov  4 04:00:26 2008
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Tue Nov  4 03:58:03 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
Message-ID: <49100F2A.5080804@marchuet.net>

the named code page ESMWIN is the correct to use at ansi spanish
applications. all other are invalids to work or only to read old buggy
indexes incorrect ordered.

ESMWIN is based on:

Windows locale:      Spanish (Modern Sort)
Locale ID:           0xC0A
Location designator: Modern_Spanish
Code page:           1252
Code page name:      windows-1252

you can read the next tables and see how incorrect is to use ISO-????.
CERTANLLY ESMWIN needs to change its code page name to windows-1252

ESWIN is a ansi copy of its oem version es850 compatible with old collation used in CL53
but incorrectly ordered an unusable in Spain for this reason.

I don't know enough Linux, but the next is the windows information:

1) first of all this files are not code page, are collations.

2) theorically DBF are created to contain oem code page. But actually the
    great part of windows applications save ansi code page at this files
    without problem or conflict.

3) there are different code page OEM, ANSI, UTF8( UNICODE ), ... all of
    them has its different collate.

Single-byte code pages are definitions of the characters mapped to each of the 256 bit patterns possible in a byte. Code pages 
define bit patterns for uppercase and lowercase characters, digits, symbols, and special characters such as !, @, #, or %. Each 
European language, such as German or Spanish, has its own single-byte code page. Although the bit patterns used to represent the 
Latin alphabet characters A through Z are the same for all the code pages, the bit patterns used to represent accented 
characters such as '?' and '?' vary from one code page to the next. If data is exchanged between computers running different 
code pages, all character data must be converted from the code page of the sending computer to the code page of the receiving 
computer. If the source data has extended characters that are not defined in the code page of the receiving computer, data is 
lost. When a database serves clients from many different countries/regions, it is difficult to pick a code page for the database 
that contains all the extended characters required by all the client computers. Also, there is a lot of processing time spent 
doing the constant conversions from one code page to another.

Code page Description
1258 Vietnamese
1257 Baltic
1256 Arabic
1255 Hebrew
1254 Turkish
1253 Greek
1252 Latin1 (ANSI)
1251 Cyrillic
1250 Central European
950 Chinese (Traditional)
949 Korean
936 Chinese (Simplified)
932 Japanese
874 Thai
850 Multilingual (MS-DOS Latin1)
437 MS-DOS U.S. English

'CodePage identifier and name     BrDisp   BrSave   MNDisp   MNSave   1-Byte   ReadOnly
'37     IBM037                    False    False    False    False    True     True
'437    IBM437                    False    False    False    False    True     True
'500    IBM500                    False    False    False    False    True     True
'708    ASMO-708                  True     True     False    False    True     True
'720    DOS-720                   True     True     False    False    True     True
'737    ibm737                    False    False    False    False    True     True
'775    ibm775                    False    False    False    False    True     True
'850    ibm850                    False    False    False    False    True     True
'852    ibm852                    True     True     False    False    True     True
'855    IBM855                    False    False    False    False    True     True
'857    ibm857                    False    False    False    False    True     True
'858    IBM00858                  False    False    False    False    True     True
'860    IBM860                    False    False    False    False    True     True
'861    ibm861                    False    False    False    False    True     True
'862    DOS-862                   True     True     False    False    True     True
'863    IBM863                    False    False    False    False    True     True
'864    IBM864                    False    False    False    False    True     True
'865    IBM865                    False    False    False    False    True     True
'866    cp866                     True     True     False    False    True     True
'869    ibm869                    False    False    False    False    True     True
'870    IBM870                    False    False    False    False    True     True
'874    windows-874               True     True     True     True     True     True
'875    cp875                     False    False    False    False    True     True
'932    shift_jis                 True     True     True     True     False    True
'936    gb2312                    True     True     True     True     False    True
'949    ks_c_5601-1987            True     True     True     True     False    True
'950    big5                      True     True     True     True     False    True
'1026   IBM1026                   False    False    False    False    True     True
'1047   IBM01047                  False    False    False    False    True     True
'1140   IBM01140                  False    False    False    False    True     True
'1141   IBM01141                  False    False    False    False    True     True
'1142   IBM01142                  False    False    False    False    True     True
'1143   IBM01143                  False    False    False    False    True     True
'1144   IBM01144                  False    False    False    False    True     True
'1145   IBM01145                  False    False    False    False    True     True
'1146   IBM01146                  False    False    False    False    True     True
'1147   IBM01147                  False    False    False    False    True     True
'1148   IBM01148                  False    False    False    False    True     True
'1149   IBM01149                  False    False    False    False    True     True
'1200   utf-16                    False    True     False    False    False    True
'1201   unicodeFFFE               False    False    False    False    False    True
'1250   windows-1250              True     True     True     True     True     True
'1251   windows-1251              True     True     True     True     True     True
'1252   Windows-1252              True     True     True     True     True     True
'1253   windows-1253              True     True     True     True     True     True
'1254   windows-1254              True     True     True     True     True     True
'1255   windows-1255              True     True     True     True     True     True
'1256   windows-1256              True     True     True     True     True     True
'1257   windows-1257              True     True     True     True     True     True
'1258   windows-1258              True     True     True     True     True     True
'1361   Johab                     False    False    False    False    False    True
'10000  macintosh                 False    False    False    False    True     True
'10001  x-mac-japanese            False    False    False    False    False    True
'10002  x-mac-chinesetrad         False    False    False    False    False    True
'10003  x-mac-korean              False    False    False    False    False    True
'10004  x-mac-arabic              False    False    False    False    True     True
'10005  x-mac-hebrew              False    False    False    False    True     True
'10006  x-mac-greek               False    False    False    False    True     True
'10007  x-mac-cyrillic            False    False    False    False    True     True
'10008  x-mac-chinesesimp         False    False    False    False    False    True
'10010  x-mac-romanian            False    False    False    False    True     True
'10017  x-mac-ukrainian           False    False    False    False    True     True
'10021  x-mac-thai                False    False    False    False    True     True
'10029  x-mac-ce                  False    False    False    False    True     True
'10079  x-mac-icelandic           False    False    False    False    True     True
'10081  x-mac-turkish             False    False    False    False    True     True
'10082  x-mac-croatian            False    False    False    False    True     True
'20000  x-Chinese-CNS             False    False    False    False    False    True
'20001  x-cp20001                 False    False    False    False    False    True
'20002  x-Chinese-Eten            False    False    False    False    False    True
'20003  x-cp20003                 False    False    False    False    False    True
'20004  x-cp20004                 False    False    False    False    False    True
'20005  x-cp20005                 False    False    False    False    False    True
'20105  x-IA5                     False    False    False    False    True     True
'20106  x-IA5-German              False    False    False    False    True     True
'20107  x-IA5-Swedish             False    False    False    False    True     True
'20108  x-IA5-Norwegian           False    False    False    False    True     True
'20127  us-ascii                  False    False    True     True     True     True
'20261  x-cp20261                 False    False    False    False    False    True
'20269  x-cp20269                 False    False    False    False    True     True
'20273  IBM273                    False    False    False    False    True     True
'20277  IBM277                    False    False    False    False    True     True
'20278  IBM278                    False    False    False    False    True     True
'20280  IBM280                    False    False    False    False    True     True
'20284  IBM284                    False    False    False    False    True     True
'20285  IBM285                    False    False    False    False    True     True
'20290  IBM290                    False    False    False    False    True     True
'20297  IBM297                    False    False    False    False    True     True
'20420  IBM420                    False    False    False    False    True     True
'20423  IBM423                    False    False    False    False    True     True
'20424  IBM424                    False    False    False    False    True     True
'20833  x-EBCDIC-KoreanExtended   False    False    False    False    True     True
'20838  IBM-Thai                  False    False    False    False    True     True
'20866  koi8-r                    True     True     True     True     True     True
'20871  IBM871                    False    False    False    False    True     True
'20880  IBM880                    False    False    False    False    True     True
'20905  IBM905                    False    False    False    False    True     True
'20924  IBM00924                  False    False    False    False    True     True
'20932  EUC-JP                    False    False    False    False    False    True
'20936  x-cp20936                 False    False    False    False    False    True
'20949  x-cp20949                 False    False    False    False    False    True
'21025  cp1025                    False    False    False    False    True     True
'21866  koi8-u                    True     True     True     True     True     True
'28591  iso-8859-1                True     True     True     True     True     True
'28592  iso-8859-2                True     True     True     True     True     True
'28593  iso-8859-3                False    False    True     True     True     True
'28594  iso-8859-4                True     True     True     True     True     True
'28595  iso-8859-5                True     True     True     True     True     True
'28596  iso-8859-6                True     True     True     True     True     True
'28597  iso-8859-7                True     True     True     True     True     True
'28598  iso-8859-8                True     True     False    False    True     True
'28599  iso-8859-9                True     True     True     True     True     True
'28603  iso-8859-13               False    False    False    False    True     True
'28605  iso-8859-15               False    True     True     True     True     True
'29001  x-Europa                  False    False    False    False    True     True
'38598  iso-8859-8-i              True     True     True     True     True     True
'50220  iso-2022-jp               False    False    True     True     False    True
'50221  csISO2022JP               False    True     True     True     False    True
'50222  iso-2022-jp               False    False    False    False    False    True
'50225  iso-2022-kr               False    False    True     False    False    True
'50227  x-cp50227                 False    False    False    False    False    True
'51932  euc-jp                    True     True     True     True     False    True
'51936  EUC-CN                    False    False    False    False    False    True
'51949  euc-kr                    False    False    True     True     False    True
'52936  hz-gb-2312                True     True     True     True     False    True
'54936  GB18030                   True     True     True     True     False    True
'57002  x-iscii-de                False    False    False    False    False    True
'57003  x-iscii-be                False    False    False    False    False    True
'57004  x-iscii-ta                False    False    False    False    False    True
'57005  x-iscii-te                False    False    False    False    False    True
'57006  x-iscii-as                False    False    False    False    False    True
'57007  x-iscii-or                False    False    False    False    False    True
'57008  x-iscii-ka                False    False    False    False    False    True
'57009  x-iscii-ma                False    False    False    False    False    True
'57010  x-iscii-gu                False    False    False    False    False    True
'57011  x-iscii-pa                False    False    False    False    False    True
'65000  utf-7                     False    False    True     True     False    True
'65001  utf-8                     True     True     True     True     False    True
'65005  utf-32                    False    False    False    False    False    True
'65006  utf-32BE                  False    False    False    False    False    True     '


Windows locale  LCID (locale ID) Collation designator Code page

Afrikaans 0xx436 Latin1_General 1252
Albanian 0x41C Albanian 1250
Arabic (Saudi Arabia) 0x401 Arabic 1256
Arabic (Iraq) 0x801 Arabic 1256
Arabic (Egypt) 0xC01 Arabic 1256
Arabic (Libya) 0x1001 Arabic 1256
Arabic (Algeria) 0x1401 Arabic 1256
Arabic (Morocco) 0x1801 Arabic 1256
Arabic (Tunisia) 0x1C01 Arabic 1256
Arabic (Oman) 0x2001 Arabic 1256
Arabic (Yemen) 0x2401 Arabic 1256
Arabic (Syria) 0x2801 Arabic 1256
Arabic (Jordan) 0x2C01 Arabic 1256
Arabic (Lebanon) 0x3001 Arabic 1256
Arabic (Kuwait) 0x3401 Arabic 1256
Arabic (United Arab Emirates) 0x3801 Arabic 1256
Arabic (Bahrain) 0x3C01 Arabic 1256
Arabic (Qatar) 0x4001 Arabic 1256
Basque 0x42D Latin1_General 1252
Byelorussian 0x423 Cyrillic_General 1251
Bulgarian 0x402 Cyrillic_General 1251
Catalan 0x403 Latin1_General 1252
Chinese (Taiwan) 0x30404 Chinese_Taiwan_Bopomofo 950
Chinese (Taiwan) 0x404 Chinese_Taiwan_Stroke 950
Chinese (People's Republic of China) 0x804 Chinese_PRC 936
Chinese (People's Republic of China) 0x20804 Chinese_PRC_Stroke 936
Chinese (Singapore) 0x1004 Chinese_PRC 936
Croatia 0x41a Croatian 1250
Czech 0x405 Czech 1250
Danish 0x406 Danish_Norwegian 1252
Dutch (Standard) 0x413 Latin1_General 1252
Dutch (Belgium) 0x813 Latin1_General 1252
English (United States) 0x409 Latin1_General 1252
English (Britain) 0x809 Latin1_General 1252
English (Canada) 0x1009 Latin1_General 1252
English (New Zealand) 0x1409 Latin1_General 1252
English (Australia) 0xC09 Latin1_General 1252
English (Ireland) 0x1809 Latin1_General 1252
English (South Africa) 0x1C09 Latin1_General 1252
English (Carribean) 0x2409 Latin1_General 1252
English (Jamaican) 0x2009 Latin1_General 1252
Estonian 0x425 Estonian 1257
Faeroese 0x0438 Latin1_General 1252
Farsi 0x429 Arabic 1256
Finnish 0x40B Finnish_Swedish 1252
French (Standard) 0x40C French 1252
French (Belgium) 0x80C French 1252
French (Switzerland) 0x100C French 1252
French (Canada) 0xC0C French 1252
French (Luxembourg) 0x140C French 1252
Georgian (Modern Sort) 0x10437 Georgian_Modern_Sort 1252
German (PhoneBook Sort) 0x10407 German_PhoneBook 1252
German (Standard) 0x407 Latin1_General 1252
German (Switzerland) 0x807 Latin1_General 1252
German (Austria) 0xC07 Latin1_General 1252
German (Luxembourg) 0x1007 Latin1_General 1252
German (Liechtenstein) 0x1407 Latin1_General 1252
Greek 0x408 Greek 1253
Hebrew 0x40D Hebrew 1255
Hindi 0x439 Hindi Unicode only
Hungarian 0x40E Hungarian 1250
Hungarian 0x104E Hungarian_Technical 1250
Icelandic 0x40F Icelandic 1252
Indonesian 0x421 Latin1_General 1252
Italian 0x410 Latin1_General 1252
Italian (Switzerland) 0x810 Latin1_General 1252
Japanese 0x411 Japanese 932
Japanese (Unicode) 0x10411 Japanese_Unicode 932
Korean (Extended Wansung) 0x412 Korean_Wansung 949
Korean 0x412 Korean_Wansung_Unicode 949
Latvian 0x426 Latvian 1257
Lithuanian 0x427 Lithuanian 1257
Lithuanian 0x827  Lithuanian_Classic 1257
Macedonian (Former Yugoslav Republic of Macedonia)  0x41C Cyrillic_General 1251
Norwegian (Bokm?l) 0x414 Danish_Norwegian 1252
Norwegian (Nynorsk) 0x814 Danish_Norwegian 1252
Polish 0x415 Polish 1250
Portuguese (Portugal) 0x816 Latin1_General 1252
Portuguese (Brazil) 0x416 Latin1_General 1252
Romanian 0x418 Romanian 1250
Russian 0x419 Cyrillic_General 1251
Serbian (Latin) 0x81A Cyrillic_General 1251
Serbian (Cyrillic) 0xC1A Cyrillic_General 1251
Slovak 0x41B Slovak 1250
Slovenian 0x424 Slovenian 1250
Spanish (Mexico) 0x80A Traditional_Spanish 1252
Spanish (Traditional Sort) 0x40A Traditional_Spanish 1252
Spanish (Modern Sort) 0xC0A Modern_Spanish 1252
Spanish (Guatemala) 0x100A Modern_Spanish 1252
Spanish (Costa Rica) 0x140A Modern_Spanish 1252
Spanish (Panama) 0x180A Modern_Spanish 1252
Spanish (Dominican Republic) 0x1C0A Modern_Spanish 1252
Spanish (Venezuela) 0x200A Modern_Spanish 1252
Spanish (Colombia) 0x240A Modern_Spanish 1252
Spanish (Peru) 0x280A Modern_Spanish 1252
Spanish (Argentina) 0x2C0A Modern_Spanish 1252
Spanish (Ecuador) 0x300A Modern_Spanish 1252
Spanish (Chile) 0x340A Modern_Spanish 1252
Spanish (Uruguay) 0x380A Modern_Spanish 1252
Spanish (Paraguay) 0x3C0A Modern_Spanish 1252
Spanish (Bolivia) 0x400A Modern_Spanish 1252
Swedish 0x41D Finnish_Swedish 1252
Thai 0x41E Thai 874
Turkish 0x41F Turkish 1254
Ukrainian 0x422 Ukrainian 1251
Urdu 0x420 Arabic 1256
Vietnamese 0x42A Vietnamese 1258

> 
> Current eswin and eswinm (esmwin) is setup to use ISO-8859-1
> CP internally. If this is right, they are in fact wrongly named
> es_win_, and they should be named es_iso_. I assumed the
> content is right, so I copied them to es_iso_, with exact same
> content, this way the filename and internal CP are in sync.
> 
> Now, if the end result is not well, it can mean two things:
> 
> 1) The CP marking in eswin is wrongly set, and should
> be Windows-something. In this case eswin should be
> corrected to use proper CP, and esiso should be converted
> to use ISO-8859-1.
> 
> 2) The CP marking in eswin is right, in this case the
> content should be changed to be Windows-something CP,
> and Windows CP strings, and new esiso files kept as correct
> ones.
> 
> But having an ESWIN codepage internally using ISO-8859-1,
> is completely misleading.
> 
> 'SVWIN' BTW has a similar problem. Name 'win', internal CP ISO.
> 
> Brgds,
> Viktor
> 
>>
>>
>> ESMWIN codepage is a consensus among various programmers to make it 
>> compatible with the codepage "Modern_spanish" that Microsoft uses in 
>> its applications, and that is also compatible with all other languages 
>> "Latin" without characters above 256 (utf8).
>>
>> for example this collation is compatible with french, portuguese, 
>> spanish, catalanish, galician and italian (COMPATIBLE)
>>
>> This codepages are ansi collation codepages. And are not ISO, really 
>> is a merge of codepages to to use only one in countries
>> where are speaked more than on language as spain.
>>
>> If is possible, please revert the name changed. And remove the new one 
>> copy.
>>
>> What about backguard compatibilitie....
>>
>> Best regards,
>> Miguel Angel Marchuet
>>
>> Szak?ts Viktor escribi?:
>>> 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>>>  * common.mak
>>>  * source/codepage/Makefile
>>>  - source/codepage/cpesmwin.c
>>>  + source/codepage/cpeswinm.c
>>>  + source/codepage/cpesiso.c
>>>  + source/codepage/cpesisom.c
>>>    * Renamed cpesmwin -> cpeswinm (ESMWIN -> ESWINM) (INCOMPATIBLE)
>>>    + Added Spanish ISO natsort modules. Besides their ID,       they 
>>> are idendical with current ESWIN* natsorts, because       the WIN 
>>> versions for some reason are using ISO-8859 CP       instead of 
>>> Windows-*. This is IMO wrong, even if these CPs       are similar or 
>>> identical for the Spanish language.
>>
>> SORRY BUT IS NOT AN ISO CODEPAGE
>>
>>> -- 
>>> Brgds,
>>> Viktor
>>> _______________________________________________
>>> Harbour mailing list
>>> Harbour@harbour-project.org
>>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>> __________ Informaci?n de ESET NOD32 Antivirus, versi?n de la base de 
>>> firmas de virus 3576 (20081102) __________
>>> ESET NOD32 Antivirus ha comprobado este mensaje.
>>> http://www.eset.com
>>
> 
> 
> __________ Informaci?n de ESET NOD32 Antivirus, versi?n de la base de 
> firmas de virus 3578 (20081103) __________
> 
> ESET NOD32 Antivirus ha comprobado este mensaje.
> http://www.eset.com
> 
> 
> 

From harbour.01 at syenar.hu  Tue Nov  4 04:53:05 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 04:53:16 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <49100F2A.5080804@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
Message-ID: <B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>

> the named code page ESMWIN is the correct to use at ansi spanish
> applications. all other are invalids to work or only to read old buggy
> indexes incorrect ordered.

"ANSI" means Windows in this context.

> ESMWIN is based on:
>
> Windows locale:      Spanish (Modern Sort)
> Locale ID:           0xC0A
> Location designator: Modern_Spanish
> Code page:           1252
> Code page name:      windows-1252
>
> you can read the next tables and see how incorrect is to use ISO-????.
> CERTANLLY ESMWIN needs to change its code page name to windows-1252

I'll correct the CP in those files then, thank you.
I still fail to see however, how cpesisom is any
worse than cpeswinm (or mwin), if their content is
exactly the same, just linked to the ISO CP (which
is again the same as Windows-1252 CP, except the name).
Please explain.

[ Update: I became clear later. ]

> ESWIN is a ansi copy of its oem version es850 compatible with old  
> collation used in CL53
> but incorrectly ordered an unusable in Spain for this reason.

Okay, so they probably need to be called ESWINC, ES850C and
ESISOC to say, these are indeed Clipper compatibility codepages,
and at the same time rename to rename 'Modern' ES*M to ESWIN,
ESISO, because these seem to be the correct Spanish collations,
which everyone like to use. Thanks for the clarification.

If that's the case, I'd opt to clear this up in the repo.

It may also be useful to add an ES850 according to the
'Modern' collation, so that Spanish users can still use
HB_TRANSLATE() to convert strings between "OEM" and "ANSI"
codepages.

> I don't know enough Linux, but the next is the windows information:
>
> 1) first of all this files are not code page, are collations.

Yes, I know, but they are using some sort of codepage anyway.
This codepage is indicated in various places in the files, plus
the collation strings are expected to be encoded in this CP.

> 2) theorically DBF are created to contain oem code page. But  
> actually the
>   great part of windows applications save ansi code page at this files
>   without problem or conflict.

I think the CP used in a given app is completely up to the
actual app / user. DBF itself can store any binary data,
even UTF16 or UTF8. The developers' job is to choose one
and use it consistently and sync the app settings to match
the used .dbfs.

> 3) there are different code page OEM, ANSI, UTF8( UNICODE ), ... all  
> of
>   them has its different collate.

Actually the collation (= ordering of national alphabet)
is one and only for a given language (at least theoretically).
Their internal representation (actual bytes used to represent
national chars) depends on the CP used. Notice that multiple
collations _may_ still exist for various reasons, the major
one being Clipper compatibility, or compatibility with other
products which weren't closely following the national standard.
(as discussed above). Another reason can be different "official"
and "unofficial" standards (and who knows what else).

It's important to keep the collation the exact same across
different CPs, otherwise HB_TRANSLATE() won't be able to
convert between them.

All in all, the above is the reason why we have multiple
cpes*.c files: same collation, different CP. Or, in case of
HU, there are two sets of collations (one Clipper compatible,
one Successware Six compatible), both with multiple CPs.
And this seems to be the case for Spanish, too.

Also, instead of "OEM" and "ANSI", - which are pretty vague,
Windows specific and non-standard terms - I'd suggest to use
'IBM/MS-DOS codepage' (~ "OEM") and 'Windows codepage' (~ "ANSI")
terms.

> Code page Description
> 1258 Vietnamese
> 1257 Baltic
> 1256 Arabic
> 1255 Hebrew
> 1254 Turkish
> 1253 Greek
> 1252 Latin1 (ANSI)
> 1251 Cyrillic
> 1250 Central European
> 950 Chinese (Traditional)
> 949 Korean
> 936 Chinese (Simplified)
> 932 Japanese
> 874 Thai
> 850 Multilingual (MS-DOS Latin1)
> 437 MS-DOS U.S. English

See these in uc*.c files. I've added support for
all of them except the 900 range (which doesn't
seem to fit in current Harbour).

> 'CodePage identifier and name     BrDisp   BrSave   MNDisp    
> MNSave   1-Byte   ReadOnly
> '65006  utf-32BE                  False    False    False     
> False    False    True     '

We should use the 'identifier and name', I'm not sure
though if they are all the correct ones in this list.
There is a 'main' name most of the time and lots of
aliases for the same CP, we should try to use the main
one.

> Windows locale  LCID (locale ID) Collation designator Code page

This falls outside of Harbour scope, as it's Windows-only.
But the list is good to get an idea on which Language uses
what CP.

Thanks for clarifying the ES issues.

To me it looks like we'd need to do three things:

1) Fix the internal CP in current ESWIN and ESWINM files.
    (I'll do this ASAP)
2) Rename Clipper compatibility ESWIN, ESISO, ES850 files
    to ESWINC, ESISOC, ES850C and add comment that these
    are 'legacy' or Clipper compatibility ones (someone
    should test which is true). Rename ESWINM and ESISOM
    to ESWIN, ESISO.
3) Add ES850 according to the 'modern' collation.
+1) Think about a way to 'map' old ESMWIN name to new ESWIN.

Brgds,
Viktor

From mbelgrano at deltain.it  Tue Nov  4 04:58:19 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Tue Nov  4 04:59:13 2008
Subject: [Harbour] Re: OT: New version of ClipNet-xNet Model
In-Reply-To: <49100CC0.6050609@mail.udg.mx>
References: <49100CC0.6050609@mail.udg.mx>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F136@SRV02.deltain.net>

Thanks for clarification

Have you a sample like sisremoto.prg without fivewin?


>Clipxnet itself is a good alternative for Web-based systems, but
combined with "desktop systems" is a greater alternative
>Easy, without cost, using existing knowledge/experience,

Have you documentation for better undestrand of made a web based
"desktop system" using existing knowledge/experience

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of David Arturo
Macias Corona
Sent: Tuesday, November 04, 2008 9:50 AM
To: harbour@harbour-project.org
Subject: [Harbour] Re: OT: New version of ClipNet-xNet Model

Massimo:

Too many questions in few lines

Did you read/understood messages/documentation/source code ?  :-)
Near all answers are in them

 >What is on Citlalli and what Clipxnet?
  Citlalli: Is perhaps the best graph library in "xBase world"
     Contain features not seen in other libraries and many of them are 
shown in samples/source code
  Clipxnet: explained in message

 >Witch is new model of systems development     :-),
  Well, you take very "old technologies" and combine them to build 
systems which work/perform as well as "new technologies"

 >how Clipxnet is part of this model"?
  Explained in sisremeng.txt

 >Replace Web-browsers with modified desktop systems in client side to
 >interact with Clipxnet in server side
 >What is modified desktop sistem?
  (?) A "desktop system" which is modified for any purpose ?
  "Desktop system" are the systems in older style, when LAN/WAN/Internet

were not as available as now
  In your "PC:Personal Computer", maybe isolated or with a "weak" 
connection to other computer, you used to run your "desktop systems"
  ( It was just a silly and limited description of "desktop system" )

 >>This "Universal System" consists of two parts:
 >>A) Client system
 >>   Usually is a Web navigator (web explorer)
<>   In this case the navigator is replaced by a classic "desktop
system"
 >Wich is "desktop system" in sisremoto ?
   In the example, sisremoto.exe IS the "desktop system" acting as 
client, and sisremoto.prg IS the source code
   Based on the concept, you take ANY of your old/recent "desktop 
systems" and modify it to replicate same kind of processes shown in 
sisremoto.exe/prg, or any other as complex as you want/can
   Sisremoto.prg is the basic guideline and sisremoto.exe is the 
physical/working part of example
   I choose (x)Harbour/FWH to show a working example to reviewers, and 
Citlalli just to enhance it
   Anybody can think immediatly: "my system can be modified to do that"

   In server side Clipxnet respond requests of client side

IS "remote system" because each side can be in any part of world

 >>B) Server system

 >Can you show same screenshot for better compression?
  If you install Citlalli you will be plenty of screens
   download/expand/run hcitxnet.exe
  If you install Clipxnet you will be plenty of screens
   download/expand/configure web server/copy files/(re)start web server

Then you can choose what you like for screenshots

Clipxnet itself is a good alternative for Web-based systems, but 
combined with "desktop systems" is a greater alternative
Easy, without cost, using existing knowledge/experience, ...

Sometimes I smile because current "Web based systems" try to reach the 
same level of development/perfomance/features contained in older 
"desktop systems" made 15-20 years ago, specially "in-line validation"
Some part of the problem is the "web browser/explorer" which is not 
under your control ?, replace it with an modified "desktop system"

 >I have runned sisremoto but sorry, I don't understand
  Message said:
"sisremoto.exe was created for local tests with Clipxnet installed"
  You must to install Clipxnet to test sisremoto locally
  Functions are pointing to:
    http://127.0.0.1/download.prg
    http://127.0.0.1/receive.prg
  You can change IP and recompile to use it in any part of world
  ... but for now start testing locally  :-)

  To install Clipxnet is very easy, just follow instructions in 
clipxnet.htm (clipxeng.htm) for Windows, OS/2, Linux, and Web Servers: 
Xitami (any platform), IIS, Apache (any platform)
Do not forget to copy download.prg, receive.prg to web pages dir

In Windows the quick way is Xitami Web Server (included in Clipxnet
package)
In Linux the quick way is Apache

When you setup Web server/Clipxnet and are working, run sisremoto.exe 
and click proper buttons

 >But I am intresting in idea of something like a web browser for web 
 >application
 >Can you help me?
  Sure, the samples are there with help purpose

Citlalli and Clipxnet are full of examples, and "Remote system" have his

own key example

David Macias
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From toninhofwi at yahoo.com.br  Tue Nov  4 06:46:11 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Tue Nov  4 05:43:13 2008
Subject: [Harbour] Higher Level Classes to Manage Consoles
In-Reply-To: <20316955.post@talk.nabble.com>
References: <20315173.post@talk.nabble.com>
	<20081104142636.2DF4.84A669A0@mail.zzz.com.tw>
	<20316955.post@talk.nabble.com>
Message-ID: <n6d0h41f87rrdnufodq2p28c9ueragd7h8@4ax.com>

Hi Pritpal,

Nice job!  I posted a message some days ago about this feature in
Harbour. Good to see that we will have it.

Best regards,

Toninho.


__________________________________________________
Faa ligaes para outros computadores com o novo Yahoo! Messenger 
http://br.beta.messenger.yahoo.com/ 
From dmacias at mail.udg.mx  Tue Nov  4 05:48:39 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov  4 05:48:36 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49102887.3070601@mail.udg.mx>

>2008-11-04 09:40 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/include/hbgtcore.h
 >    ! added missing 'extern' in hb_gt_dos_keyCodeTranslate() declaration
 >
 >  * harbour/source/rtl/gtstd/gtstd.c
 >  * harbour/source/rtl/gtpca/gtpca.c
 >    + added support for console input in OpenWatcom builds
 >
 >  * harbour/source/vm/vmmt/Makefile
 >    ! removed mainpm.c
 >
 >  * harbour/contrib/xhb/hbcrypt.c
 >    ! fixed casting

Thanks Przemek

Not checked
[ Current Harbour code compile fine with gcc335 with just well known
warnings ]


With OpenWatcom 1.7:
- Screen output
-----------------------
make[3]: *** [hbcrypt.obj] Error 8
make[2]: *** [descend] Error 2
-----------------------

. 40 libraries created

- 6 executables created:
   harbour.exe, hbpp.exe, hbdoc.exe, hbmake.exe, hbrun.exe, hbtest.exe

- New make_ow.log
Sent

OpenWatcom
==========
harbour.exe, hbpp.exe run fine
hbdoc.exe, hbmake.exe, hbrun.exe, hbtest.exe: fail with SYS1811

Example:
-------------------
[E:\harbour810\harbourow\bin]hbtest
SYS1811: The process has stopped.  The software diagnostic code
(trap number) is  000D.

[E:\harbour810\harbourow\bin]help 1811

SYS1811: The process has stopped.  The software diagnostic code
(trap number) is ***.

EXPLANATION: The program attempted to perform an instruction that the
system cannot perform.  The software diagnostic code allows
determination of what type of instruction was attempted.

ACTION: Correct the problem or try a different version of the program.
-------------------

In make_ow.log I found:

for hbvmmt:
../../../thread.c(402): Warning! W869: col(25) use of '_beginthread'
requires build target to be multi-threaded

For hbrun.exe:
Warning! W1023: no starting address found, using 0001:00000000
creating an OS/2 32-bit executable

For hbtest.exe
Warning! W1023: no starting address found, using 0001:00000000
creating an OS/2 32-bit executable

For hbdoc.exe
Warning! W1023: no starting address found, using 0001:00000000
creating an OS/2 32-bit executable

For hbmake.exe
Warning! W1023: no starting address found, using 0001:00000000
creating an OS/2 32-bit executable

David Macias


From miguelangel at marchuet.net  Tue Nov  4 06:23:44 2008
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Tue Nov  4 06:21:20 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
Message-ID: <491030C0.20206@marchuet.net>

> 
> To me it looks like we'd need to do three things:
> 
> 1) Fix the internal CP in current ESWIN and ESWINM files.
>    (I'll do this ASAP)
> 2) Rename Clipper compatibility ESWIN, ESISO, ES850 files
>    to ESWINC, ESISOC, ES850C and add comment that these
>    are 'legacy' or Clipper compatibility ones (someone
>    should test which is true). Rename ESWINM and ESISOM
>    to ESWIN, ESISO.
> 3) Add ES850 according to the 'modern' collation.
> +1) Think about a way to 'map' old ESMWIN name to new ESWIN.
> 

Ok, but for blackguard compatibilities will be needed alias ESMWIN.

Plus information:

"Code page name" are to "Char Set" as you see some times are confused by the alias name, any people can think incorrectly
that iso-8859-1 is the same than windows-1252 but are real different Char Set

EXAMPLE:

Spanish (Modern Sort) | Western European (Windows)
Collation :      Modern_Spanish  (order for ESMWIN)
Code page:       1252
family code page:1252
Code page name:  Windows-1252
Aliases:         ANSI_X3.4-1968, ANSI_X3.4-1986, ascii, cp367, cp819, csASCII, IBM367, ibm819, ISO_646.irv:1991, iso_8859-1, 

                  iso_8859-1:1987, ISO646-US, iso8859-1, iso-8859-1, iso-ir-100, iso-ir-6, latin1, us, us-ascii, x-ansi
Encoding:        ansi

is diferent than

Western European (ISO)
Collation :      ?
Code page:       28591
family code page:1252
Code page name:  iso-8859-1
Aliases:         cp819, csISO, Latin1, ibm819, iso_8859-1, iso_8859-1:1987, iso8859-1, iso-ir-100, l1, latin1

Western European (DOS)
Collation :      ?
Code page:       850
family code page:1252
Code page name:  ibm850
Aliases:
Encoding:        oem

Western European (Mac)
Collation :      ?
Code page:       10000
family code page:1252
Code page name:  mathintosh
Aliases:

Western European (IA5)
Collation :      ?
Code page:       20105
family code page:1252
Code page name:  x-IA5
Aliases:


Unicode (UTF-8)
Collation :      ?
Code page:       65001
family code page:1252
Code page name:  utf-8
Aliases:         unicode-1-1-utf-8, unicode-2-0-utf-8, x-unicode-2-0-utf-8
Encoding:        utf8

From harbour.01 at syenar.hu  Tue Nov  4 06:33:05 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 06:33:14 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <491030C0.20206@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
Message-ID: <2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>

>> 3) Add ES850 according to the 'modern' collation.
>> +1) Think about a way to 'map' old ESMWIN name to new ESWIN.
>
> Ok, but for blackguard compatibilities will be needed alias ESMWIN.

I'm not sure if there is a better way to do it, but
maybe I'll just add an additional file with a new
file and old content with the sole purpose of compatibility.
This CP won't be added to hbextern to not mess up things
more than absolutely needed (which won't affect app users BTW).

Spanish language users would probably want to use ESWIN
and ESISO from this point on.

> Plus information:
>
> "Code page name" are to "Char Set" as you see some times are  
> confused by the alias name, any people can think incorrectly
> that iso-8859-1 is the same than windows-1252 but are real different  
> Char Set

Yes, exactly. Very important that ISO-8859-1 is an official
standard, while Windows-1252 is not. They are similar, but
not the same. I'd think we should encourage everyone to use
the ISO standards for best portability.

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov  4 06:52:56 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 06:53:05 2008
Subject: [Harbour] 2008-11-04 12:52 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93e73$Blat.v2.6.2$e0b9a034$15107857098a@127.0.0.1>

2008-11-04 12:52 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * contrib/rddsql/mysqldd.c
    ! Excluded sizeof() in #ifdef to compile with MinGW.

  * contrib/hbhpdf/make_gcc.sh
    ! Fixed missing quote char.

  * contrib/mtpl_gcc.mak
    ! Fixed to create its own OBJ dir. Not the ultimate 
      solution, pls enhance if you think.

  * source/codepage/cpeswinm.c
  * source/codepage/cpeswin.c
    ! Fixed linked codepage to be Windows-1252 instead of 
      ISO-8859-1. For the ISO versions, pls see ESISO variants.

  * source/codepage/cpes850.c
  * source/codepage/cpesisom.c
    * Comments.

  * contrib/make_gcc_all.sh
    ! Fixed to not include externally dependent contribs, 
      when HB_CONTRIBLIBS is specified by user.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov  4 07:15:20 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 07:15:24 2008
Subject: [Harbour] 2008-11-04 13:06 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93e77$Blat.v2.6.2$0194256a$e94c001ce14@127.0.0.1>

2008-11-04 13:06 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
   * include/hbextern.ch
   * common.mak
   * source/codepage/Makefile
   * source/codepage/cpeswinm.c
   - source/codepage/cpes850.c
   + source/codepage/cpes850c.c
   * source/codepage/cpesiso.c
   + source/codepage/cpesisoc.c
   * source/codepage/cpeswin.c
   + source/codepage/cpeswinc.c
   * source/codepage/cpesisom.c
     * Spanish language support cleaned:
       Modern collation made the default, fixed 
       CP linkage in ESWIN collations, Clipper 
       compatibility versions renamed to have an 
       ending 'C'
       Now the following collations are supported:
       ES850C - Clipper compatibility CP: IBM850
       ESWINC - Clipper compatibility CP: Windows-1252
       ESISOC - Clipper compatibility CP: ISO-8859-1
       ESWIN  - Modern CP: Windows-1252
       ESISO  - Modern CP: ISO-8859-1
       ESMWIN - Compatibility with previous Harbour versions and xhb.
                (this collation has wrong linkage, so everyone is 
                encouraged to use ESWIN or ESISO instead.)
                Intentionally not added to hbextern.ch.
     ; TODO: Add ES850.
     ; TODO: Check whether Clipper compatibility is indeed true.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov  4 09:18:54 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 09:19:02 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
Message-ID: <B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>

Hi Przemek,

I've tested the hash version, and it seems equivalent
to the 1D array version in terms of disk size (in fact
it's _exactly_ the same size). The load time turned out
to be ~3 times (9.99s) the native 1D array load routine
(currently in SVN), and 2.5 times the 1D array loading
using deserialize.

Dunno if hash loading could be further optimized in any
ways.

Brgds,
Viktor

On 2008.11.02., at 0:25, Przemyslaw Czerpak wrote:

> On Sat, 01 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
>> The other issue is that 2 dimensional array. Currently
>> I'm changing it to 1 dimensional on load, and lookup
>> is faster this way, and the whole translation array
>> takes less space. Maybe it doesn't matter, I don't know.
>
> With hash array the search can be done without function
> call by simple
>
>>
>> BTW, I've now tested saved size with serialize as is
>> (2 dimensional), and it's almost exactly the same as
>> current __i18n_save(). This is pretty good. Then I've
>> tested loading speed, and it's only the half for
>> deserialize.
>> _i18n_loadfrommemory() [1D]: 3.6s
>> hb_deserialize() [2D]: 6.7s
>
> Thanks for the tests.
> The deserialization code makes always two passes.
> 1-st one is for checking if passed data can be deserialized
> without any errors so some operations are doubled.
> If we can "trust" that the data is valid then this pass can
> be eliminated though I do not think it's good idea. Such
> decoding can be done once and the overhead is rather small
> so I prefer to validate the whole operation to avoid serious
> problems like GPF or out of memory message when corrupted data
> is passed.
> The serialization code has also protection and support for
> arrays and hashes with cyclic references. So it will not
> GPF if you pass to serialize code array with cyclic reference.
> It will be stored correctly and the cyclic references will
> be restored correctly during deserialization. This protection
> also cost a little bit. In summary it creates the speed difference.
>
>> 1000 iterations with strings preloaded from disk,
>> for 9200 string pairs (682KB file for both) on a P4HT 2.6.
>> I've repeated the tests by using flattened 1 dimensional
>> array, which made the serialized files smaller than i18n
>> functions, and it also made the loading as below:
>> hb_deserialize() [1D]: 3.95s
>> Which is pretty good, so the most optimal would be to use
>> hb_serialize/deserialize with a flat array, flattened
>> on save. (saving is not speed or memory critical)
>> I didn't explore hash, as I have zero experience with them.
>
> The most important is the performance of accessing I18N data
> at runtime. Hash arrays allows to access translated strings
> without function call. They are also very easy to manage at
> .prg level. F.e. this is customized version of hbi18n.c
> (without RT errors) which can be written by any user if
> we will use standard serialization code and hashes.
>
>   FUNC __I18N_SAVE( cFile, hTrans )
>      return hb_memoWrit( cFile, hb_serialize( hTrans ) )
>
>   FUNC __I18N_LOAD( cFile )
>      return hb_deserialize( hb_memoRead( cFile ) )
>
>   FUNC __I18N_LOADFROMMEMORY( cData )
>      return hb_deserialize( cData )
>
>   FUNC __I18N_GETTEXT( cText, hTrans )
>      if cText $ hTrans
>         cText := hTrans[ cText ]
>      endif
>      return cText
>
>   PROC __I18N_ADDTRANS( hTrans, cText, cTrans )
>      hTrans[ cText ] := cTrans
>
>   FUNC __I18N_INITTRANS()
>      return hb_hSetAutoAdd( { => } )
>
> Isn't simple?
> For me such flexibility is very important.
> Do you want to add domain support? Let's make changing few two  
> functions:
>
>   FUNC __I18N_GETTEXT( cText, hTrans, cDomain )
>      local hDomain
>      if cDomain == NIL
>         cDomain := "[MAIN]"
>      endif
>      if cDomain $ hTrans
>         hDomain := hTrans[ cDomain ]
>         if cText $ hDomain
>            cText := hDomain[ cText ]
>         endif
>      endif
>      return cText
>
>   PROC __I18N_ADDTRANS( hTrans, cText, cTrans, cDomain )
>      if cDomain == NIL
>         cDomain := "[MAIN]"
>      endif
>      if !cDomain $ hTrans
>         hTrans[ cDomain ] := hb_hSetAutoAdd( { => } )
>      endif
>      hTrans[ cDomain, cText ] := cTrans
>
>
> And now we only have to create new function __I18N_LOADPOT( cFile )
> which will make something like:
>
>   FUNC __I18N_LOADPOT( cFile )
>      LOCAL hTrans := __I18N_INITTRANS()
>      LOCAL cLine, cDomain, cText, cTrans
>
>      FOR EACH cLine in hb_aTokens( memoread( cFile ), hb_osNewLine() )
>         IF cLine = "msgctxt "
>            cDomain := substr( cLine, 10, len( cLine ) - 10 )
>         ELSEIF cLine = "msgid "
>            cText := substr( cLine, 8, len( cLine ) - 8 )
>         ELSEIF cLine = "msgstr "
>            cTrans := substr( cLine, 9, len( cLine ) - 9 )
>            IF !EMPTY( cText )
>               IF EMPTY( cTrans )
>                  cTrans := cText
>               ENDIF
>               __I18N_ADDTRANS( hTrans, cText, cTrans, cDomain )
>               cText := cDomain := NIL
>            ENDIF
>         ENDIF
>      NEXT
>      RETURN hTrans
>
> It's simplified version with only very basic functionality and without
> error reporting for wrong .pot files. Nothing above is tested (just
> written by finger) but should work. Of course .prg version is slower  
> then
> C code but it can be very easy written also in C. Important is easy to
> manage format.
> Of course it will be a little bit slower then dedicated format with
> code optimized for it (BTW your code seems to be optimal, very nice
> job) but the speed difference should not be noticeable in normal
> applications.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From mbelgrano at deltain.it  Tue Nov  4 10:30:47 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Tue Nov  4 10:31:40 2008
Subject: [Harbour] Higher Level Classes to Manage Consoles
In-Reply-To: <20315173.post@talk.nabble.com>
References: <20315173.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F13B@SRV02.deltain.net>

Hello Pritpal

Very compliment!!!!!!!!!!!
Wich c Compiler/ Operative system  are supported by your active x
implementation?

Do you think that we will use also active x components like ComponentOne
Studio Enterprise grid, reporting, charting, scheduling, data
manipulation, user interface (easy get demo from
http://www.componentsource.com/features/activex-components/index.html)

Do you think write a gui framework that will be a little clone of
XbaseParts but portable?
Can be easy added a Command Compatibility for fivewin
Imo also Visual Fox Pro will have an clear and documented implementation
Xbase++,Fivewin,Foxbase have an userbase who can use harbour for porting
his application to open source and modern environment.

Best Regard
Belgrano Massimo
-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Tuesday, November 04, 2008 3:33 AM
To: harbour@harbour-project.org
Subject: [Harbour] Higher Level Classes to Manage Consoles


Hello All

I am about to introduce Active-X controls in GTWVG 
with EVENTS management. The first results are very encouraging.
The basic code is contributed by Andy Wos which I have tuned-up
a little to adopt to GTWVG/GTWVT. Our beloved console window
is now able to host any Active-X control like Internet Explorer,
Acrobat, Excel, Shell Explorer, etc. and has the capabilities to
respond to events fired by the control and manage its methods
and properties as usual Harbour objects.

Here is a executable and sources. Just copy files in the zip to
harbour/contrib/gtwvg/tests and run the demowvg.exe.
Click <Modeless Dialogs><Active-X ...>  prompts. Just do not 
give attention to screen refresh glitches. To close the window, 
press ESC. If ESC does not work, then click on taskbar to minimize
and then maximize then press ESC. Sometimes focus is not 
moved back to console even you click on the title bar.

http://www.vouch.info/downloads/demowvg_ax.zip

As these type of functionality is always a pain if done via
function calls only, I intend to introduce class framework
to manage these components properly. 

To begin with I have in mind a Dialog class and an Active-X class.
Dialog class will be a wrapper to existing pre called functions to 
configure a console window like:

[SEC 1]
   hb_gtReload( 'WVG' )
   hb_gtInfo( HB_GTI_PRESPARAMS, { , , 10, 10, 400, 400, , .F., .F. } )
   SetColor( 'N/W' )
   CLS
   SetMode( 30,60 )
   SetCursor( 0 )
   Wvt_ShowWindow( 1 )
   hb_gtInfo( HB_GTI_CLOSABLE, .F. )

after which the actual console code becomes eligible for rendering
[SEC 2]
   Alert( 'I am in the child window!' )

and then the cleanup ( if it is a window in same thread )
[SEC 3]
   pGT1 := NIL
   hb_gtSelect( pGT )
   hb_gtInfo( HB_GTI_ENABLE, pGT )
   hb_gtInfo( HB_GTI_SETFOCUS, pGT )

Now to the real point of discussion:

As this effort may lead to building a GUI framework, as I think
positively, 
I want to start it on the firm grounds from the base itself. There are a

lot many object modals are in usage in Harbour, or say, Clipper world,
viz.,
FWH, XAILER, VXH, HWGUI, MINIGUI, etc., and XBASE++.
For me Xbase++ modal stands best of all and has a clear implementation 
details in place.

Now the namespace issue.
I propose to have all classes same names as Xbase++ and same 
number of parameter passing and same life cycle. The only difference
will be "Hb" as prefix instrad of "Xbp". thus
XbpActiveXControl() => HbActiveXControl(). 
Source file naming may also follow a standard rule.

I need your opinions on the topic before I start writing something.

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/Higher-Level-Classes-to-Manage-Consoles-tp20315173
p20315173.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From bedipritpal at hotmail.com  Tue Nov  4 10:48:34 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov  4 10:48:38 2008
Subject: [Harbour] Higher Level Classes to Manage Consoles
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F13B@SRV02.deltain.net>
References: <20315173.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F13B@SRV02.deltain.net>
Message-ID: <20324906.post@talk.nabble.com>


Hello

>Wich c Compiler/ Operative system  are supported by your active x
>implementation?

I have BCC 5.8.2 and have tested only on it. After uploading to SVN 
others will be in a position to check for it.

>Do you think that we will use also active x components like ComponentOne
>Studio Enterprise grid, reporting, charting, scheduling, data
>manipulation, user interface (easy get demo from
>http://www.componentsource.com/features/activex-components/index.html)

Yes, of course. I have tested on Codejock components and it works fine.
So I see no reason why ComponentOne objects will fail. In fact any COM 
control should work, but I may be wrong.

>Do you think write a gui framework that will be a little clone of
>XbaseParts but portable?

This is what my intention is.

>Can be easy added a Command Compatibility for fivewin
>Imo also Visual Fox Pro will have an clear and documented implementation
>Fivewin,Foxbase have an userbase who can use harbour for porting
>his application to open source and modern environment.

I am not familiar with them so anybody interested will easily be in a 
position to write wrappers for them, IMO.

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/Higher-Level-Classes-to-Manage-Consoles-tp20315173p20324906.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Tue Nov  4 11:28:27 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov  4 11:27:49 2008
Subject: [Harbour] 2008-11-04 17:28 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081104162827.GA20877@34-mo7-2.acn.waw.pl>

2008-11-04 17:28 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/vm/hvm.c
  * harbour/source/vm/mainstd.c
    * force linking main() function in OpenWatcom OS2 builds

  * harbour/contrib/xhb/hbcrypt.c
    ! casting

best regards
Przemek
From druzus at acn.waw.pl  Tue Nov  4 11:37:19 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov  4 11:36:38 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49102887.3070601@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49102887.3070601@mail.udg.mx>
Message-ID: <20081104163719.GA20628@34-mo7-2.acn.waw.pl>

On Tue, 04 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> With OpenWatcom 1.7:
> make[3]: *** [hbcrypt.obj] Error 8
> For hbrun.exe:
> Warning! W1023: no starting address found, using 0001:00000000
> creating an OS/2 32-bit executable

Should be fixed. Please tray after:
   2008-11-04 17:28 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)

> ../../../thread.c(402): Warning! W869: col(25) use of '_beginthread'
> requires build target to be multi-threaded

add -bm to OpenWatcom switches (CPPFLAGS) in owatcom.cf

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Nov  4 13:33:26 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 13:33:31 2008
Subject: [Harbour] 2008-11-04 19:32 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93eab$Blat.v2.6.2$d369f59a$1c08a989348a@127.0.0.1>

2008-11-04 19:32 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
   * make_gcc.mak
   * contrib/mtpl_gcc.mak
     + Added '-march=i586' for Windows platform. 
       (Sync with other make systems.)

   * ChangeLog
     + Some changes marked as TOMERGE 1.0.

   * contrib/hbtip/base64x.c
     ! Fixed and ages old problem with BUILDUSERPASSSTRING() 
       function, which always returned an empty string thus 
       making "AUTH PLAIN" broken. I wonder how this went 
       unnoticed for this long.
       This also fixes unsafe strcpy() usage.
       [TOMERGE 1.0]
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov  4 14:01:08 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 14:02:48 2008
Subject: [Harbour] 2008-11-04 19:59 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93eaf$Blat.v2.6.2$b20d6af4$136031ffedee@127.0.0.1>

2008-11-04 19:59 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * contrib/hbnf/getenvrn.c
    - Removed some obsolete comments.

  * contrib/hbwhat/whtlv.c
    ! Fixed memory leak.
    ! Fixed to use hb_strncpy() instead of unsafe lstrcpy().
      TOFIX: The destination address isn't properly allocated and the 
             size of it is unknown, so this modification is not enough.
    ; TOFIX: Unicode conversion, buffer allocation for item.pszText.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Tue Nov  4 15:31:30 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov  4 15:30:50 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
Message-ID: <20081104203130.GA23534@34-mo7-2.acn.waw.pl>

On Tue, 04 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> I've tested the hash version, and it seems equivalent
> to the 1D array version in terms of disk size (in fact
> it's _exactly_ the same size). The load time turned out
> to be ~3 times (9.99s) the native 1D array load routine
> (currently in SVN), and 2.5 times the 1D array loading
> using deserialize.

Yes it's expected because during deserialization hash array
is build from scratch so it's sorted again.

> Dunno if hash loading could be further optimized in any
> ways.

I can improve the speed by reading hash items in raw form
but it may cause some bad side effects because hashes uses
national collating by default. IMHO it's wrong and I would
like to change it. The default should be binary collating
we optimized for speed. If user wants then he can enable
national sorting order by hb_hSetBinary( hValue, .F. ) or
hb_hSetCaseMatch( hValue, .F. ). Simple binary sorting
should give noticeable speed improvement. But in such case
I can try to trust that the order read from serialized data
is correct and eliminate hash array resorting.
As I can see it will be good to add support for storing hash
array flags in serialized data and hash default value if it's
set. I think that it will be also good to introduce internal
hash flag which will force resorting on 1-st access and
implement internal b-tree structure for hashes. It's waiting
for really long time. I'll try to make these modifications in
some spare time. Meanwhile I can hard code support for binary
sorted hashes to serialize procedure. It should give noticable
performance improvement so the results will be comparable to
current __I18N_LOADFROMMEMORY() function.
BTW I do not see in current __I18N_*() functions sth for binary
array sorting so they will not work correctly with national
characters if you will try to sort the array at Harbour level.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Nov  4 16:26:42 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 16:26:54 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081104203130.GA23534@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
Message-ID: <A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>

Hi Przemek,

>> I've tested the hash version, and it seems equivalent
>> to the 1D array version in terms of disk size (in fact
>> it's _exactly_ the same size). The load time turned out
>> to be ~3 times (9.99s) the native 1D array load routine
>> (currently in SVN), and 2.5 times the 1D array loading
>> using deserialize.
>
> Yes it's expected because during deserialization hash array
> is build from scratch so it's sorted again.
>> Dunno if hash loading could be further optimized in any
>> ways.
>
> I can improve the speed by reading hash items in raw form
> but it may cause some bad side effects because hashes uses
> national collating by default. IMHO it's wrong and I would
> like to change it. The default should be binary collating
> we optimized for speed. If user wants then he can enable

I agree completely.

> national sorting order by hb_hSetBinary( hValue, .F. ) or
> hb_hSetCaseMatch( hValue, .F. ). Simple binary sorting
> should give noticeable speed improvement. But in such case
> I can try to trust that the order read from serialized data
> is correct and eliminate hash array resorting.

That's exactly what I had in mind :)

> As I can see it will be good to add support for storing hash
> array flags in serialized data and hash default value if it's
> set. I think that it will be also good to introduce internal
> hash flag which will force resorting on 1-st access and
> implement internal b-tree structure for hashes. It's waiting
> for really long time. I'll try to make these modifications in
> some spare time. Meanwhile I can hard code support for binary
> sorted hashes to serialize procedure. It should give noticable
> performance improvement so the results will be comparable to
> current __I18N_LOADFROMMEMORY() function.
> BTW I do not see in current __I18N_*() functions sth for binary
> array sorting so they will not work correctly with national
> characters if you will try to sort the array at Harbour level.

Unless I don't use hb_setcodepage() I guess. For me it
gave proper results, but I indeed didn't try with extra
collations, which could really be a problem.

I did some more speed comparisons with __i18n_gettext()
vs. direct hash lookup, and hash lookup turned out to be
30% quicker. This is the most speed sensitive function,
so these results are very promising.

If you can implement the raw hash deserialization - besides
being great stuff by itself -, I think we will be able
to simply drop the current special i18n functions, since
we have everything we need using existing Harbour elements,
with similar or possibly better overall performance. The
only remaining part will be the "high-level" API, possibly
in .c, as we've discussed.

Brgds,
Viktor

From druzus at acn.waw.pl  Tue Nov  4 16:39:58 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov  4 16:39:17 2008
Subject: [Harbour] 2008-11-04 22:39 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081104213958.GA16264@34-mo7-2.acn.waw.pl>

2008-11-04 22:39 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbapi.h
  * harbour/source/vm/hashfunc.c
  * harbour/source/vm/hashes.c
    + added support for binary key order
    % enable binary internal key order by default for new hash arrays
    + added .prg function to enable/disable/retrive binary order in hash
      items:
         hb_hSetBinary( <hValue>, <lOnOff> ) => <hValue>
         hb_hBinary( <hValue> [, <lBinary> ] ) => <lBinary>
    + added support for hash array resorting. It's activated automatically
      on 1-st key access/assign after changing binary or casematch hash
      array flag
    + added .prg function hb_hSort( <hValue> ) => <hValue> which marks
      hash array for sorting

  * harbour/source/rtl/itemseri.c
    % improved performance of hash array deserialization
      TODO: add support for hash array flags and hash default value
            serialization

best regards
Przemek
From harbour.01 at syenar.hu  Tue Nov  4 16:51:55 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 16:52:13 2008
Subject: [Harbour] 2008-11-04 22:50 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93ec7$Blat.v2.6.2$8dc24d28$1c6c6f1eb540@127.0.0.1>

2008-11-04 22:50 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
  * common.mak
  * source/codepage/Makefile
  + source/codepage/cpes850.c
    + Added ES850 - Modern Spanish.

  * include/hbextern.ch
    ! Added ITWIN.

  * source/codepage/cpesisoc.c
  * source/codepage/cpsviso.c
  * source/codepage/cpesiso.c
  * source/codepage/cpitwin.c
    + Added my copyright.

  * ChangeLog
    ; Some TODO/TOFIXes marked as [DONE]
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov  4 16:53:38 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 16:53:44 2008
Subject: [Harbour] 2008-11-04 22:53 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93ec7$Blat.v2.6.2$cb1aeee6$10cc9554fbd8@127.0.0.1>

2008-11-04 22:53 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * include/hbextern.ch
    + Added new HB_H*() functions.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov  4 17:06:01 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 17:06:06 2008
Subject: [Harbour] 2008-11-04 23:03 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93ec9$Blat.v2.6.2$85f7bc66$1ad435474ae2@127.0.0.1>

2008-11-04 23:03 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
  * source/vm/Makefile
  * source/vm/vmmt/Makefile
  * source/vm/fm.c
  + source/vm/fmhb.c
  + source/vm/hbmem.c
    + Moved functions not depending on FM_STATISTICS setting, 
      to separate files.
    ; NOTE: MEMORY() function should IMO move to rtl, and 
            hb_xmem*() functions to common lib.
--
Brgds,
Viktor

From teo at windtelsoft.com  Tue Nov  4 16:55:28 2008
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Tue Nov  4 17:27:36 2008
Subject: [Harbour] 2008-11-04 23:03 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c93ec9$Blat.v2.6.2$85f7bc66$1ad435474ae2@127.0.0.1>
References: <01c93ec9$Blat.v2.6.2$85f7bc66$1ad435474ae2@127.0.0.1>
Message-ID: <200811041555.28380.teo@windtelsoft.com>

On Tuesday 04 November 2008 04:06:01 pm Szak?ts Viktor wrote:
> 2008-11-04 23:03 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>   * common.mak
>   * source/vm/Makefile
>   * source/vm/vmmt/Makefile
>   * source/vm/fm.c
>   + source/vm/fmhb.c
>   + source/vm/hbmem.c
>     + Moved functions not depending on FM_STATISTICS setting,
>       to separate files.
>     ; NOTE: MEMORY() function should IMO move to rtl, and
>             hb_xmem*() functions to common lib.

2008-11-04 15:53 UTC-0600 Teo Fonrouge (teo/at/windtelsoft/dot/com)
  * source/vm/fm.c
    * removed unneeded HB_FUNC( MEMORY ), now in fmhb.c


best regards,

Teo
From harbour.01 at syenar.hu  Tue Nov  4 17:31:46 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov  4 17:31:53 2008
Subject: [Harbour] 2008-11-04 23:03 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <200811041555.28380.teo@windtelsoft.com>
References: <01c93ec9$Blat.v2.6.2$85f7bc66$1ad435474ae2@127.0.0.1>
	<200811041555.28380.teo@windtelsoft.com>
Message-ID: <11D0AFD5-D88E-451B-907E-12D2EDF985CF@syenar.hu>

Many thanks Teo.

Brgds,
Viktor

On 2008.11.04., at 22:55, Teo Fonrouge wrote:

> On Tuesday 04 November 2008 04:06:01 pm Szak?ts Viktor wrote:
>> 2008-11-04 23:03 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>>  * common.mak
>>  * source/vm/Makefile
>>  * source/vm/vmmt/Makefile
>>  * source/vm/fm.c
>>  + source/vm/fmhb.c
>>  + source/vm/hbmem.c
>>    + Moved functions not depending on FM_STATISTICS setting,
>>      to separate files.
>>    ; NOTE: MEMORY() function should IMO move to rtl, and
>>            hb_xmem*() functions to common lib.
>
> 2008-11-04 15:53 UTC-0600 Teo Fonrouge (teo/at/windtelsoft/dot/com)
>  * source/vm/fm.c
>    * removed unneeded HB_FUNC( MEMORY ), now in fmhb.c
>
>
> best regards,
>
> Teo

From druzus at acn.waw.pl  Tue Nov  4 18:03:48 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov  4 18:03:09 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
Message-ID: <20081104230348.GA13492@34-mo7-2.acn.waw.pl>

On Tue, 04 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> If you can implement the raw hash deserialization - besides
> being great stuff by itself -, I think we will be able
> to simply drop the current special i18n functions, since
> we have everything we need using existing Harbour elements,
> with similar or possibly better overall performance. The
> only remaining part will be the "high-level" API, possibly
> in .c, as we've discussed.

Please try current code. Hash deserialization should be noticeable
faster.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov  4 21:02:02 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov  4 21:01:25 2008
Subject: [Harbour] 2008-11-05 03:01 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081105020202.GA7319@34-mo7-2.acn.waw.pl>

2008-11-05 03:01 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbapi.h
  * harbour/source/vm/hashes.c
  * harbour/source/vm/hashfunc.c
    * changed hb_hSort() to execute sorting when hash is marked as needed
      resorting instead of marking hash for resorting

  * harbour/source/vm/fm.c
    * formatting

  * harbour/contrib/hbdbgfx/dbgfxc.c
    ! fixed casting in ASCII build
    + added support for UNICODE builds

  * harbour/contrib/gtwvg/gtwvg.c
    * cover LWA_ALPHA usage by #if ( _WIN32_WINNT >= 0x0500 )
      to keep at least compile time compatibility with older systems

best regards
Przemek
From harbour.01 at syenar.hu  Wed Nov  5 02:09:18 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 02:09:26 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081104230348.GA13492@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
Message-ID: <0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>

Hi Przemek,

Loading became more than twice as fast now,
a now just a bit (18%) slower than current
__i18n_loadfrommemory(). Perfect results for
such generic function.

                           r9830  r9838
__i18n_loadfrommemory():   3.72   3.72
__i18n_gettext():          3.39   3.33
hb_deserialize():         10.26   4.41
hash lookup:               2.58   4.16

For some reason simple hash lookup became
a bit slower, and now 30% slower than
__i18n_gettext() (previously it was 30%
faster). Still pretty good though. I wonder
what may cause this.

Brgds,
Viktor

On 2008.11.05., at 0:03, Przemyslaw Czerpak wrote:

> On Tue, 04 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
>> If you can implement the raw hash deserialization - besides
>> being great stuff by itself -, I think we will be able
>> to simply drop the current special i18n functions, since
>> we have everything we need using existing Harbour elements,
>> with similar or possibly better overall performance. The
>> only remaining part will be the "high-level" API, possibly
>> in .c, as we've discussed.
>
> Please try current code. Hash deserialization should be noticeable
> faster.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From dmacias at mail.udg.mx  Wed Nov  5 02:57:24 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Wed Nov  5 02:57:21 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491151E4.6090204@mail.udg.mx>

 >Should be fixed. Please tray after:
 >   2008-11-04 17:28 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)

 >> ../../../thread.c(402): Warning! W869: col(25) use of '_beginthread'
 >> requires build target to be multi-threaded

 >add -bm to OpenWatcom switches (CPPFLAGS) in owatcom.cf

OW docs said on "bm":
-----------------
(Netware, OS/2, Win32 only) This option causes the compiler to emit into
the object file references to the appropriate multi-threaded library
name(s).  The macros _MT and __SW_BM will be predefined if "bm" is
selected.
-----------------

If "-bm" is added to owatcom.cf how it affect Harbour ST / MT ?
"appropriate multi-threaded library name(s)" refer to OW libraries ?

 >2008-11-04 17:28 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
 >  * harbour/source/vm/hvm.c
 >  * harbour/source/vm/mainstd.c
 >    * force linking main() function in OpenWatcom OS2 builds
 >
 >  * harbour/contrib/xhb/hbcrypt.c
 >    ! casting

Thanks Przemek, AND CONGRATULATIONS  :-)
For first time in Human history we have a build complete for current 
Harbour - OS/2 - OpenWatcom 1.7


Not checked
[ Current Harbour code compile fine with gcc335 with just well known
warnings ]


With OpenWatcom 1.7:
- Screen output   --> clean
-----------------------
-----------------------

. 41 libraries created ---> all

- 6 executables created:  ---> all
   harbour.exe, hbpp.exe, hbdoc.exe, hbmake.exe, hbrun.exe, hbtest.exe

- New make_ow.log
Sent

OpenWatcom
==========
harbour.exe, hbpp.exe run fine
hbdoc.exe, hbmake.exe, hbrun.exe, hbtest.exe: run fine

In make_ow.log I found:

for hbvmmt:
../../../thread.c(402): Warning! W869: col(25) use of '_beginthread'
requires build target to be multi-threaded

( not -bm added until confirmation )



hbtest.exe output included below

Can you add harbour\config\os2\owatcom.cf to SVN ?

-----------------
and for config\os2\owatcom.cf:

  >[19]: CPPFLAGS = -w2 -d1 -zq -bt=NT

-bt=OS2

  >[56]: echo @%watcom%/binnt/wlink.lnk >> __link__.tmp

For now is excluded

If included, should be used SYSTEM directive and which value ?

------------------------
For each executable file format that can be created using the Open Watcom
   Linker, a specific SYSTEM directive may be used.  The SYSTEM directive
selects a subset of the available directives necessary to create each
specific executable file format.

System
Description

[...]
os2
16-bit x86 OS/2 executable

os2_dll
16-bit x86 OS/2 Dynamic Link Library

os2_pm
16-bit x86 OS/2 Presentation Manager executable

os2v2
32-bit x86 OS/2 executable

os2v2_dll
32-bit x86 OS/2 Dynamic Link Library

os2v2_pm
32-bit x86 OS/2 Presentation Manager executable

[...]

windows
16-bit x86 Windows 3.x executable

windows_dll
16-bit x86 Windows 3.x Dynamic Link Library

win_vxd
32-bit x86 Windows 3.x or 9x Virtual Device Driver

win95
32-bit x86 Windows 9x executable

win95 dll
32-bit x86 Windows 9x Dynamic Link Library

nt
32-bit x86 Windows NT character-mode executable

nt_win
32-bit x86 Windows NT windowed executable

win32
synonym for "nt_win"

nt_dll
32-bit x86 Windows NT Dynamic Link Library

win386
32-bit x86 Open Watcom extended Windows 3.x executable or Dynamic Link
Library

The various systems that we have listed above are defined in special
linker directive files which are plain ASCII text files that you can
edit.  These files are called wlink.lnk and wlsystem.lnk.

The file wlink.lnk is a special linker directive file that is
automatically processed by the Open Watcom Linker before processing any
other directives.  On a DOS, OS/2, or Windows-hosted system, this file
must be located in one of the paths specified in the PATH environment
variable.  On a QNX-hosted system, this file should be located in the
/etc directory.  A default version of this file is located in the
\watcom\binw directory on DOS-hosted systems, the \watcom\binp directory
on OS/2-hosted systems, the /etc directory on QNX-hosted systems, and
the \watcom\binnt directory on Windows 95 or Windows NT-hosted systems.
   Note that the file wlink.lnk includes the file wlsystem.lnk which is
located in the \watcom\binw directory on DOS, OS/2, or Windows-hosted
systems and the /etc directory on QNX-hosted systems.

The files wlink.lnk and wlsystem.lnk reference the WATCOM environment
variable which must be set to the directory in which you installed your
software.

In the following sections, we show some of the typical directives that
you might use to create a particular executable file format.  The common
directives are described in the chapter entitled Linker Directives and
Options.  They are "common" in the sense that they may be used with any
executable format.  There are other, less general, directives that may
be specified for a particular executable format.  In each of the
following sections, we refer you to chapters in which you will find more
information on the directives available with the executable format used.

At this point, it should be noted that various systems have adopted
particular executable file formats.  For example, both the Tenberry
Software DOS/4G(W) and FlashTek DOS extenders support one of the OS/2
executable file formats.  It is for this reason that you may find that
we direct you to a chapter which would, at first glance, seem unrelated
to the executable file format in which you are interested.

To summarize, the steps that you should follow to learn about creating a
particular executable are:

   1.Look for a section in this chapter that describes the executable
format in which you are interested.

   2.See the chapter entitled Linker Directives and Options for a
description of the common directives.

   3.If you require additional information, see also the chapter to which
we have referred you.

   4.Also check the Open Watcom C/C++ Programmer's Guide or Open Watcom
FORTRAN 77 Programmer's Guide for more information on creating specific
types of applications.

------------------------


  >[57]: echo LIB kernel32.lib, user32.lib, wsock32.lib, winspool.lib,
  >oleaut32.lib, uuid.lib, comctl32.lib, mapi32.lib >> __link__.tmp

Excluded

  >[62]: LDFLAGS = debug all OP osn=NT OP stack=65536 OP CASEEXACT

osn excluded. OpenWatcom should define one based in platform

Rest of os2\owatcom.cf untouched

-----------------


David Macias


Harbour Regression Test Suite
Copyright (c) 1999-2008, http://www.harbour-project.org/
---------------------------------------------------------------------------
       Version: Harbour 1.1.0dev (Rev. 9832)
      Compiler: Open Watcom C++ 12.70.8 (32-bit)
            OS: OS/2 4.50
    Date, Time: 2008.11.05 01:50:46
        Output: (stdout)
Shortcut opt.: ON
      Switches:
===========================================================================
R No.  Line            TestCall()                               -> 
Result 
               | Expected 

---------------------------------------------------------------------------
!  600 MAIN_HVMA(0)    saArray[ 1000 ]
        Result: "E BASE 1132 Bound error array access A:2:A:{.[1].};N:1000 "
      Expected: "E BASE 1132 Bound error array access "
!  601 MAIN_HVMA(0)    saArray[ 1000 ] := 1
        Result: "E BASE 1133 Bound error array assign A:1:N:1000 "
      Expected: "E BASE 1133 Bound error array assign "
!  730 MAIN_HVMA(0)    RTSTR( 00000500000000000000 )
        Result: " 16  500000000000000"
      Expected: " 21       500000000000000"
!  731 MAIN_HVMA(0)    RTSTR( 0500000000000000 )
        Result: " 16  500000000000000"
      Expected: " 17   500000000000000"
! 1075 MAIN_MATH(0)    Str(1234567890 * 1234567890 )
        Result: " 1524157875019052100"
      Expected: " 1524157875019052000"
! 1470 MAIN_STR(0)     AllTrim( NIL )
        Result: "E BASE 2022 Argument error ALLTRIM A:1:U:NIL F:S"
      Expected: "E BASE 2022 Argument error ALLTRIM F:S"
! 1471 MAIN_STR(0)     AllTrim( 100 )
        Result: "E BASE 2022 Argument error ALLTRIM A:1:N:100 F:S"
      Expected: "E BASE 2022 Argument error ALLTRIM F:S"
! 1543 MAIN_STR(0)     StrTran( NIL )
        Result: "E BASE 1126 Argument error STRTRAN A:1:U:NIL F:S"
      Expected: "E BASE 1126 Argument error STRTRAN F:S"
! 1544 MAIN_STR(0)     StrTran( 100 )
        Result: "E BASE 1126 Argument error STRTRAN A:1:N:100 F:S"
      Expected: "E BASE 1126 Argument error STRTRAN F:S"
! 1545 MAIN_STR(0)     StrTran( "AA", 1 )
        Result: "E BASE 1126 Argument error STRTRAN A:2:C:AA;N:1 F:S"
      Expected: "E BASE 1126 Argument error STRTRAN F:S"
! 2832 MAIN_ARRAY(0)   AFill( NIL )
        Result: "E BASE 6004 Argument error AFILL A:1:U:NIL "
      Expected: "E BASE 6004 Argument error AFILL "
! 2876 MAIN_ARRAY(0)   ASize( NIL )
        Result: "E BASE 2023 Argument error ASIZE A:1:U:NIL "
      Expected: "E BASE 2023 Argument error ASIZE "
! 2877 MAIN_ARRAY(0)   ASize( {} )
        Result: "E BASE 2023 Argument error ASIZE A:1:A:{.[0].} "
      Expected: "E BASE 2023 Argument error ASIZE "
! 2878 MAIN_ARRAY(0)   ASize( ErrorNew() )
        Result: "E BASE 2023 Argument error ASIZE A:1:O:ERROR Object "
      Expected: "E BASE 2023 Argument error ASIZE "
! 2879 MAIN_ARRAY(0)   ASize( NIL, 0 )
        Result: "E BASE 2023 Argument error ASIZE A:2:U:NIL;N:0 "
      Expected: "E BASE 2023 Argument error ASIZE "
! 2880 MAIN_ARRAY(0)   ASize( NIL, 1 )
        Result: "E BASE 2023 Argument error ASIZE A:2:U:NIL;N:1 "
      Expected: "E BASE 2023 Argument error ASIZE "
! 2881 MAIN_ARRAY(0)   ASize( NIL, -1 )
        Result: "E BASE 2023 Argument error ASIZE A:2:U:NIL;N:-1 "
      Expected: "E BASE 2023 Argument error ASIZE "
! 2903 MAIN_ARRAY(0)   Array( -1 )
        Result: "E BASE 1131 Bound error array dimension A:1:N:-1 "
      Expected: "E BASE 1131 Bound error array dimension "
! 2904 MAIN_ARRAY(0)   Array( 1, 0, -10 )
        Result: "E BASE 1131 Bound error array dimension A:3:N:1;N:0;N:-10 "
      Expected: "E BASE 1131 Bound error array dimension "
! 3030 MAIN_ARRAY(0)   TAEVSM()
        Result: "N10N 9N 8N 7N 6         5"
      Expected: "N10N 9N 8N 7N 6N 5N 4N 3N 2N 1         0"
! 3031 MAIN_ARRAY(0)   TASOSM1()
        Result: "NN 5NN 4NN 3NN 2         1{ 3 }"
      Expected: "NN 5NN 4NN 3NN 2NN 1NN 0NN 0NN 0NN 0NN 0NN 0NN 0 
   0{  }"
! 3032 MAIN_ARRAY(0)   TASOSM2()
        Result: "NN 5NN 4NN 3NN 2         1{ 3 }"
      Expected: "NN 5NN 4NN 3NN 2NN 1NN 0NN 0NN 0NN 0NN 0         0{  }"
! 4709 MAIN_LAST(0)    __MRestore( "$NOTHERE.MEM", .F. )
        Result: "E BASE 2005 Open error $NOTHERE.MEM 
A:2:C:$NOTHERE.MEM;L:.F. F:DR"
      Expected: "E BASE 2005 Open error $NOTHERE.MEM F:DR"
! 4711 MAIN_LAST(0)    __MSave( BADFNAME(), "*", .T. )
        Result: "E BASE 2006 Create error *BADNAM*.MEM 
A:3:C:*BADNAM*.MEM;C:*;L:.T. F:DR"
      Expected: "E BASE 2006 Create error *BADNAM*.MEM F:DR"
===========================================================================
Test calls passed:       4687 ( 99.49 % )
Test calls failed:         24 ( 0.51 % )
                    ----------
             Total:       4711 ( Time elapsed: 0.17 seconds )

WARNING ! Failures detected



From mbelgrano at deltain.it  Wed Nov  5 03:48:21 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Nov  5 03:49:18 2008
Subject: [Harbour] somebody can give a reply on harbour user mailing list?
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F145@SRV02.deltain.net>

somebody can give a reply on harbour user mailing list?

-----Original Message-----
From: harbour-users-bounces@harbour-project.org
[mailto:harbour-users-bounces@harbour-project.org] On Behalf Of
harbour-users@harbour-project.org
Sent: Wednesday, November 05, 2008 1:16 AM
To: harbour-users@harbour-project.org
Subject: [Harbour-users] Docs on installation?

I am trying to use the mpkg_rpm_from_svn.sh script but it fails at this 
point after quite some time :-
(just the last few lines shown)

A    harbour/config/w32/mingw.cf
A    harbour/config/w32/pocc.cf
A    harbour/obj
 U   harbour
Checked out revision 9837.
"rpm -b" is deprecated, use "rpmbuild -b"
/usr/lib/rpm/rpmb_deprecated: line 3: exec: rpmbuild: not found
[baz@localhost ~]$

Any help would be appreciated.

System is Mandriva Linux 2008.1 running in VBox (under Mandriva Linux 
2009.0)

Massimo Belgrano

From harbour.01 at syenar.hu  Wed Nov  5 04:45:55 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 04:46:01 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
Message-ID: <4F60906D-6235-48FF-A7D9-9A68A71FF341@syenar.hu>

Hi Przemek,

I forgot about one thing, in order to implement
__i18n_gettext() with hashes, two hash lookups
are needed, but my tests were doing only one.

Is there a way to eliminate two hash lookups
in this expression:

// IN: text, hash
IF text $ hash
    text := hash[ text ]
ENDIF
// OUT: text

I'm thinking of something like hb_HGet(), but
to return the original key (or a passed default)
if it's not found in the hash table (instead of
generating an RTE).

Brgds,
Viktor

On 2008.11.05., at 8:09, Szak?ts Viktor wrote:

> Hi Przemek,
>
> Loading became more than twice as fast now,
> a now just a bit (18%) slower than current
> __i18n_loadfrommemory(). Perfect results for
> such generic function.
>
>                          r9830  r9838
> __i18n_loadfrommemory():   3.72   3.72
> __i18n_gettext():          3.39   3.33
> hb_deserialize():         10.26   4.41
> hash lookup:               2.58   4.16
>
> For some reason simple hash lookup became
> a bit slower, and now 30% slower than
> __i18n_gettext() (previously it was 30%
> faster). Still pretty good though. I wonder
> what may cause this.
>
> Brgds,
> Viktor
>
> On 2008.11.05., at 0:03, Przemyslaw Czerpak wrote:
>
>> On Tue, 04 Nov 2008, Szak?ts Viktor wrote:
>>
>> Hi Viktor,
>>
>>> If you can implement the raw hash deserialization - besides
>>> being great stuff by itself -, I think we will be able
>>> to simply drop the current special i18n functions, since
>>> we have everything we need using existing Harbour elements,
>>> with similar or possibly better overall performance. The
>>> only remaining part will be the "high-level" API, possibly
>>> in .c, as we've discussed.
>>
>> Please try current code. Hash deserialization should be noticeable
>> faster.
>>
>> best regards,
>> Przemek
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>

From dbtopas at dbtopas.lt  Wed Nov  5 06:34:40 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov  5 06:34:35 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <20081104203130.GA23534@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
Message-ID: <491184D0.2080905@dbtopas.lt>

> I can improve the speed by reading hash items in raw form
> but it may cause some bad side effects because hashes uses
> national collating by default. IMHO it's wrong and I would
> like to change it. The default should be binary collating
> we optimized for speed. If user wants then he can enable
> national sorting order by hb_hSetBinary( hValue, .F. ) or
> hb_hSetCaseMatch( hValue, .F. ). Simple binary sorting
> should give noticeable speed improvement. But in such case
> I can try to trust that the order read from serialized data
> is correct and eliminate hash array resorting.

Hi,


I see Przemek has already implemented national/binary hash ordering, so 
my remarks are too late, but I really do not understand a problem here.

 From my point of view hash is a way to obtain data value by key value 
(not by number like in array). The internal implementation of the hash 
it is hash's business.
Have we documented, that hash uses sorted array and binary search to 
find a key value? Have we documented that HB_HGETKEYS() should return 
string keys in ascending order? If we did it, then it's a documentation 
bug!!! I think hash is hash, and user code should not depend on hash 
internal implementation.

We can use any algorithm for sorting keys. We can also use the real 
hashing algorithm, i.e. generate some checksum of key, and try to find 
value using this checksum. In this case national/binary sorting is not 
used at all.

So, I do not understand at all, why do we need hb_hSetBinary() and 
hb_hBinary()?!It should be hash's internals and users should not care 
about it!


Best regards,
Mindaugas

From dbtopas at dbtopas.lt  Wed Nov  5 06:43:33 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov  5 06:43:27 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <4F60906D-6235-48FF-A7D9-9A68A71FF341@syenar.hu>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<4F60906D-6235-48FF-A7D9-9A68A71FF341@syenar.hu>
Message-ID: <491186E5.3020604@dbtopas.lt>

Szak?ts Viktor wrote:
> Hi Przemek,
> 
> I forgot about one thing, in order to implement
> __i18n_gettext() with hashes, two hash lookups
> are needed, but my tests were doing only one.
> 
> Is there a way to eliminate two hash lookups
> in this expression:
> 
> // IN: text, hash
> IF text $ hash
>    text := hash[ text ]
> ENDIF
> // OUT: text
> 
> I'm thinking of something like hb_HGet(), but
> to return the original key (or a passed default)
> if it's not found in the hash table (instead of
> generating an RTE).


Hi,


I see no problem here. It's simple to eliminate two lookups by using 
HB_HSCAN() and HB_HVALUEAT(), but this could not increase speed because 
of additional PCODE for function calls.

Implementation in C language by using hb_hashScan() and 
hb_hashGetValueAt() for sure will be best and will use a single hash lookup.


Best regards,
Mindaugas
From lorenzo.fiorini at gmail.com  Wed Nov  5 06:46:03 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Nov  5 06:46:06 2008
Subject: [Harbour] hb* scripts and dylibs path under Mac OS X
Message-ID: <9257026e0811050346p79edf97cn5444e7581038f5eb@mail.gmail.com>

I use standard gnu makefiles with hb* scripts but under Mac OS X I
can't find the right way to shared executables.

Everything gets built correctly using the same makefiles I use under
Win and Lin but at runtime the executable looks for libmylib.0.dylib
while my lib is libmylib.dylib.

If I change it using install_name_tool I can get it working but it's
not the best way.

Could it be that we need sth different in the hb-mkslib for darwin?

Any idea?

best regards,
Lorenzo
From dbtopas at dbtopas.lt  Wed Nov  5 06:58:09 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov  5 06:58:02 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <20081104203130.GA23534@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
Message-ID: <49118A51.6020908@dbtopas.lt>

> I think that it will be also good to introduce internal
> hash flag which will force resorting on 1-st access and
> implement internal b-tree structure for hashes. It's waiting
> for really long time. I'll try to make these modifications in
> some spare time.


Hi,


does b-tree have a big advantage over simple binary search in case all 
data is IN MEMORY. I see no advantage in data lookup. There is advantage 
in data insertion in case of large number of keys.


Best regards,
Mindaugas


P.S. b-tree is implemented in sqlmix. If there are more needs for this 
algorithm, we can create some "universal" module in hbvm library and use 
it in all cases (hashes, sqlmix, adsx, etc.), to avoid code duplication.





  Meanwhile I can hard code support for binary
> sorted hashes to serialize procedure. It should give noticable
> performance improvement so the results will be comparable to
> current __I18N_LOADFROMMEMORY() function.
> BTW I do not see in current __I18N_*() functions sth for binary
> array sorting so they will not work correctly with national
> characters if you will try to sort the array at Harbour level.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From dbtopas at dbtopas.lt  Wed Nov  5 07:04:15 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov  5 07:04:08 2008
Subject: [Harbour] 2008-11-02 13:36 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <20081102123612.GA27093@34-mo7-2.acn.waw.pl>
References: <20081102123612.GA27093@34-mo7-2.acn.waw.pl>
Message-ID: <49118BBF.3070501@dbtopas.lt>

Przemyslaw Czerpak wrote:
> 2008-11-02 13:36 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>   * harbour/include/hbexprb.c
>     ! fixed possible GPF/internal memory corruption in code like:
>          ? HB_I18N_GETTEXT_NOOP( "Ala ma kota" + " !!!" )
>       Mindaugas, the fix is also the answer for the question you left
>       in TODO.

Hi,


thanks. Great! It clear now. It seems I've copied some compiler code 
from another place, but could not understand all its logic. So, I left 
this comment. I hope it helped to find the bug.


Best regards,
Mindaugas

From harbour.01 at syenar.hu  Wed Nov  5 07:16:34 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 07:16:39 2008
Subject: [Harbour] 2008-11-05 13:15 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93f40$Blat.v2.6.2$583ac756$f688d250fc6@127.0.0.1>

2008-11-05 13:15 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * make_vc.mak
    * -GA option only used for HB_VISUALC_VER >= 70.
      Please update this if older versions also support it.

  * include/hbver.ch
  * source/common/hbver.c
    * Some more fiddling with version number terminology and 
      hb_version() values:
      HB_VERSION_MICRO          -> HB_VERSION_RELEASE
      HB_VERSION_BLD_DATE_STR   -> HB_VERSION_BUILD_DATE_STR
      HB_VERSION_BLD_DATE       -> HB_VERSION_BUILD_DATE
      HB_VERSION_BLD_TIME       -> HB_VERSION_BUILD_TIME
      HB_VERSION_CHANGELOG_REV  -> HB_VERSION_CHANGELOG_ID
      Third part of version number could also be: PATCH, MICRO, BUILD
      SVN revision could also be: BUILD
      BUILD is inherently connected with a physical binary, so 
      I dropped it, PATCH is limiting and negativ, MICRO is not 
      very common (otherwise good), so a finally opted for 
      RELEASE. REVISION kept as is.
    ; If there are no objections I'll HB_VER_REVISION macro to 
      HB_VER_RELEASE. This will be an INCOMPATIBLE change, but 
      I expect not too many ppl being affected.

  * TODO
    - Removed MT as a TODO. Thanks Przemek for the nice job.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov  5 07:24:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 07:24:06 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <491184D0.2080905@dbtopas.lt>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<491184D0.2080905@dbtopas.lt>
Message-ID: <20081105122447.GA18766@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> I see Przemek has already implemented national/binary hash ordering, so my 
> remarks are too late, but I really do not understand a problem here.
> From my point of view hash is a way to obtain data value by key value (not 
> by number like in array).

To be precise: hashes allows to operate non continuous on indexes.
These indexes does not have to be strings.
F.e. AFAIR you are using pointers.

> The internal implementation of the hash it is hash's business.
> Have we documented, that hash uses sorted array and binary search to find a 
> key value? Have we documented that HB_HGETKEYS() should return string keys 
> in ascending order? If we did it, then it's a documentation bug!!! I think 
> hash is hash, and user code should not depend on hash internal 
> implementation.
> We can use any algorithm for sorting keys. We can also use the real hashing 
> algorithm, i.e. generate some checksum of key, and try to find value using 
> this checksum. In this case national/binary sorting is not used at all.
> So, I do not understand at all, why do we need hb_hSetBinary() and 
> hb_hBinary()?!It should be hash's internals and users should not care about 
> it!

I fully agree. But I didn't want to discuss about it. I still remember from
my xHarbour days discussion about keeping build order in hashes for
replicating associated arrays class behavior.
If we can agree that we do not need backward internal order compatibility
then I'll be very happy in removing hb_hBinary().
But please do not forget about one thing. National sorting can cause
that two different keys will be equal in some languages. It's the same
problem like with CASEMATCH flag. So hb_hBinary() does not only change
the internal item order but also keys hashing method.

BTW in PHP hash value items are kept in build order and can be resorted by
    user manually and PHP authors documented it.

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Nov  5 07:31:18 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 07:31:26 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105122447.GA18766@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<491184D0.2080905@dbtopas.lt>
	<20081105122447.GA18766@34-mo7-2.acn.waw.pl>
Message-ID: <5578BBB6-9519-4D4D-9F1F-4A6BCCCBB423@syenar.hu>

Hi Przemek,

>> We can use any algorithm for sorting keys. We can also use the real  
>> hashing
>> algorithm, i.e. generate some checksum of key, and try to find  
>> value using
>> this checksum. In this case national/binary sorting is not used at  
>> all.
>> So, I do not understand at all, why do we need hb_hSetBinary() and
>> hb_hBinary()?!It should be hash's internals and users should not  
>> care about
>> it!
>
> I fully agree. But I didn't want to discuss about it. I still  
> remember from
> my xHarbour days discussion about keeping build order in hashes for
> replicating associated arrays class behavior.
> If we can agree that we do not need backward internal order  
> compatibility
> then I'll be very happy in removing hb_hBinary().

You have my vote for it.

> But please do not forget about one thing. National sorting can cause
> that two different keys will be equal in some languages. It's the same
> problem like with CASEMATCH flag. So hb_hBinary() does not only change
> the internal item order but also keys hashing method.

I think this just leads to possible misunderstandings.

IMO two different strings should be different regardless of
national settings. If we want 'sorted array' feature with
quick find support, that's a different thing and should be
discussed/implemented outside hashes.

Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov  5 08:23:58 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 08:23:17 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491151E4.6090204@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<491151E4.6090204@mail.udg.mx>
Message-ID: <20081105132358.GB18766@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> >Should be fixed. Please tray after:
> >   2008-11-04 17:28 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
> >> ../../../thread.c(402): Warning! W869: col(25) use of '_beginthread'
> >> requires build target to be multi-threaded
> >add -bm to OpenWatcom switches (CPPFLAGS) in owatcom.cf
> OW docs said on "bm":
> -----------------
> (Netware, OS/2, Win32 only) This option causes the compiler to emit into
> the object file references to the appropriate multi-threaded library
> name(s).  The macros _MT and __SW_BM will be predefined if "bm" is
> selected.
> -----------------
> If "-bm" is added to owatcom.cf how it affect Harbour ST / MT ?
> "appropriate multi-threaded library name(s)" refer to OW libraries ?

It will make what we want. The code will use MT safe functions from
OpenWatcom CRTL.

> Thanks Przemek, AND CONGRATULATIONS  :-)
> For first time in Human history we have a build complete for current 
> Harbour - OS/2 - OpenWatcom 1.7

:-) Fine and many thanks for your help.

> In make_ow.log I found:
> for hbvmmt:
> ../../../thread.c(402): Warning! W869: col(25) use of '_beginthread'
> requires build target to be multi-threaded
> ( not -bm added until confirmation )

-bm should pacify this warning and make other code which may call
CRTL functions ready to use in MT programs.

If possible please also make some tests with tests/mt/mttest*.prg
hbmk_os2.cmd should be updated to support also OpenWatcom builds.
You can take the code for OpenWatcom from hbmk.bat. If OS2 does
not have such small command line size limits like DOS and Windows
COMMAND.COM then instead of creating _hb_mk.tmp file for linker
you can pass all parameters to wlink directly.

> hbtest.exe output included below
> Can you add harbour\config\os2\owatcom.cf to SVN ?

yes sure but if possible please send me your current os2\owatcom.cf
to avoid stupid typos caused by modifications I cannot verify.

> -----------------
> and for config\os2\owatcom.cf:
>  >[19]: CPPFLAGS = -w2 -d1 -zq -bt=NT
> -bt=OS2
>  >[56]: echo @%watcom%/binnt/wlink.lnk >> __link__.tmp
> For now is excluded
> If included, should be used SYSTEM directive and which value ?

Probably in 32bit OS2 by default is set to: os2v2 or os2v2_pm.
This is necessary when you want to change the default to create different
binaries, f.e. for console or GUI mode, DLLs or you want to make cross
builds.

> Harbour Regression Test Suite
> Copyright (c) 1999-2008, http://www.harbour-project.org/
> ---------------------------------------------------------------------------
>       Version: Harbour 1.1.0dev (Rev. 9832)
>      Compiler: Open Watcom C++ 12.70.8 (32-bit)
>            OS: OS/2 4.50
>    Date, Time: 2008.11.05 01:50:46
>        Output: (stdout)
> Shortcut opt.: ON
>      Switches:
> ===========================================================================
[...]
> Test calls passed:       4687 ( 99.49 % )
> Test calls failed:         24 ( 0.51 % )

Fine, exactly the same results as on other platforms.

best regards,
Przemek
From mbelgrano at deltain.it  Wed Nov  5 08:56:27 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Nov  5 08:56:30 2008
Subject: [Harbour] one cent for todolist 
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F148@SRV02.deltain.net>

I dream reading some argument in todolist so compliment to Harbour that
have done a big amount of changes 

Can I suggest another point that will be useful for make an uniform
documentation of harbour
Define  a standard make system so each platform/c compiler  will use
similar instruction for compile a little sample, or a big project. so is
difficult document how harbour works
I suggest something like  build project.exe from
test1.prg,test2.prg,test.prg,hbvm.lib,hbmacro.lib,hbpp.lib,gtwvw.lib
This disuniformity add difficult at first steep with harbour  
Imo can be choice from 3 ways 
Hbmk.prg defined by Przemyslaw for make uniform
> If I'll find spare time to make some cleanups in hbmk.prg then I'll 
> commit it to SVN. It should give similar to hb* script functionality

 Pbmake by Phil Barnet  is a make engine for Clipper, Xbase++, C and ASM
written in clipper
     have Support conditional directives
     will performing actions just before/after the compile process
     Jump to Editor on Compile Failure
     We modification for be custom for harbour and multiplatform
 BrMake is a sub-project  of
https://sourceforge.net/projects/hrbtoolslibs/
     This project ts written in [x]harbour and will be driven by command
line or  project file
     Command line syntax
     Need modification for multiplatform

harbour have made a choice of high quality but make system is  not at
the same level of quality now


In my opinion pbmake and brmake are similar so I suggest Viktor and or
Przemyslaw verify if hbmk can be a good way or if the replacement for
hbmake can be phmake/brmake Either are written in PRG Either will a good
make system for compile either require modification for having same
project file on multiple architecture

Thanks in advance

>Assign to: <nobody>
>Detail...: UNICODE support.
>Status...: Open.
>Assign to: Przemek
>Detail...: Define multi platform platform API for GTs which can mix
>           graphics objects with standard text output. Now it's
>           possible in GTXWC, GTWVG and GTALLEG. This I will discuss
>           yet also with xHarbour developers.
>Status...: Open.
>Assign to: <nobody>
>Detail...: Add GTNET driver which will allow to run Harbour application
>           remotely. GTNET will be used on server side and on client
>           side any native GT driver.
>Status...: Open.
>Assign to: <nobody>
>Detail...: Add support for remotely controlled GUI objects so we will
>           be able to create GUI programs with GTNET.
>Status...: Open.
>Assign to: <nobody>
>Detail...: Add NETRDD - meta RDD which will allow transport layer
>           between client application and server application with any
>           other chosen RDD driver. Idea similar to GTNET but for RDD
>           drivers - it's sth like ADS does.
>Status...: Open.


Massimo Belgrano

From druzus at acn.waw.pl  Wed Nov  5 09:11:14 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 09:10:31 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <49118A51.6020908@dbtopas.lt>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<49118A51.6020908@dbtopas.lt>
Message-ID: <20081105141114.GC18766@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> does b-tree have a big advantage over simple binary search in case all data 
> is IN MEMORY. I see no advantage in data lookup. There is advantage in data 
> insertion in case of large number of keys.

Exactly and this is the only one reason. The question is if it's
important enough to invest time for it ;-)

Best regards,
Przemek
From dbtopas at dbtopas.lt  Wed Nov  5 09:37:28 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov  5 09:37:21 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105122447.GA18766@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>	<491184D0.2080905@dbtopas.lt>
	<20081105122447.GA18766@34-mo7-2.acn.waw.pl>
Message-ID: <4911AFA8.7060008@dbtopas.lt>

Hi,


>> From my point of view hash is a way to obtain data value by key value (not 
>> by number like in array).
> 
> To be precise: hashes allows to operate non continuous on indexes.
> These indexes does not have to be strings.
> F.e. AFAIR you are using pointers.

Yes, I know keys can be also numeric. Perhaps it's a lack of english 
knowledge to express the difference between a hash and array in a clear 
way. I'm using all type of hash keys, not only pointers.


>> So, I do not understand at all, why do we need hb_hSetBinary() and 
>> hb_hBinary()?!It should be hash's internals and users should not care about 
>> it!
> 
> I fully agree. But I didn't want to discuss about it. I still remember from
> my xHarbour days discussion about keeping build order in hashes for
> replicating associated arrays class behavior.
> If we can agree that we do not need backward internal order compatibility
> then I'll be very happy in removing hb_hBinary().

AFAIR, the problem with xHarbour was, that in the beginning it does not 
had a hash and TAssociativeArray() was used. Later hash implementation 
has changed it, and for backward compatibility some side effects was 
replicated in hashes. I believe we do not need to follow backward 
compatibility of xHarbour's TAssociativeArray(), I like solutions 
without side effects.


> But please do not forget about one thing. National sorting can cause
> that two different keys will be equal in some languages. It's the same
> problem like with CASEMATCH flag.

Well, I did not know such things. After such know knowledge I'll be 
afraid to use ==. Perhaps, I'll write my own string_[binary_]equal() :)

I really do not know what is the best solution in this case, but I see 
binary comparison most natural.


Best regards,
Mindaugas
From druzus at acn.waw.pl  Wed Nov  5 10:15:53 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 10:15:10 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <4911AFA8.7060008@dbtopas.lt>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<491184D0.2080905@dbtopas.lt>
	<20081105122447.GA18766@34-mo7-2.acn.waw.pl>
	<4911AFA8.7060008@dbtopas.lt>
Message-ID: <20081105151553.GA18601@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> Well, I did not know such things. After such know knowledge I'll be afraid 
> to use ==. Perhaps, I'll write my own string_[binary_]equal() :)

If you do not use CP which can introduce equal chars then you do not
have to think about such problem.
BTW I also do not like it and I changed original CDP code to never
return that strings are equal when == is used and strings are binary
different. So now we do not have such problem as long as my hack exists.

> I really do not know what is the best solution in this case, but I see 
> binary comparison most natural.

But it cannot be used for hashes when CASEMATCH is disabled.
In such situation we have to use use functions which operate on
national characters to check which values in binary data are
letters for given language what makes hash array internals
CDP dependent. We can reduce the problem by storing modified
(hashed) keys when CASEMATCH is enabled so at least internal
representation will be always the same. The side effect is
that we will not be able to return original key value, f.e.:
   h := hb_hSetCastMatch( {=>}, .F. )
   h[ "Mindaugas" ] := "Kavaliauskas"
   for each v in h
      ? v:__enumKey(), v
   next

will show:

   MINDAUGAS Kavaliauskas

but I think it's worth to pay. If other developers will agree
with me then I'll change internal hash representation so keys
will be hashed when added and then always sorted in binary form.

best regards,
Przemek
From dbtopas at dbtopas.lt  Wed Nov  5 10:28:53 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov  5 10:28:46 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <20081101203951.GA15722@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
Message-ID: <4911BBB5.9050607@dbtopas.lt>

> I think that using standard serialization method will increase
> functionality, f.e. users can easy change the place where they store
> i18n translation tables, f.e. they can use DBF with MEMO fields.
> I can update this code but if Mindaugas already has some working code
> then maybe we should not repeat the work.
> Mindaugas?

Hi,


my local i18n implementation is minimal. It has these functions:

// Set/Get language
PROC HB_i18nSetBaseLanguage( cLang, cTitle )
FUNC HB_i18nSetLanguage( cLang )
FUNC HB_i18nGetLanguage()

// Get translated string
FUNC HB_i18n_gettext( cId, cContext )

// Manage translation table
FUNC HB_i18ntable_create()
FUNC HB_i18ntable_add( aStrings, cId, cText, cContext )

// Save/Load table to/from binary (serialized hash) file
FUNC HB_i18ntable_save( aStrings, cFile )
FUNC HB_i18ntable_load( cFile )

// Save/Load table to/from text (.pot) file
FUNC HB_i18ntable_savetext( aStrings, cFile )
FUNC HB_i18ntable_loadtext( cFile )

// Load table. Windows only function! I always save translation tables 
in resource
FUNC HB_i18n_load( cLang )

It is a little different implementation, than Viktor's. For example I do 
not have hb_i18n_gettextlang( <cText> [, <langid> ] ), because all 
strings are extracted from loaded hash values (other languages are in 
file/resource). But I do support domain/context (in a minimalistic 
implementation: hash table key is "msgid$$$msgctxt"). I attach my i18n 
implementation at the end of the letter.


I general, I see translation tables implemented by hashes more flexible. 
Usage of serialization function allows to store language files in any 
media; file, memo field, etc. Harbour "native" hash functions allows a 
simple management of translation table, it's very easy to write utility 
for deleting, merging, editing translation tables (I'm using such 
utility with a simple browse editor instead of standard GNU gettext 
utilities). No special functions are needed, native hash functionality 
is enough.
Both hashes and Viktor's implementation of translation table uses a 
binary search, so I speed of table lookup should be almost the same. 
There is no need to duplicate hash lookup code. That's everything I can 
add to current discussion about i18n table implementation.


>> I think that some upper level functions like translation tools or .pot
>> files manipulations can be written as .prg code so user can easy extend
>> it. The low level functions and hb_i18n_gettext*() for RT performance
>> should be written in C.
> 
> Yes, my C "fluency" is incomparable to yours, so maybe
> I'm not the best candidate for this job :)

After we find the best solution I can help to do C implementation.


>  FUNC __I18N_GETTEXT( cText, hTrans, cDomain )
>       local hDomain
>       if cDomain == NIL
>          cDomain := "[MAIN]"
>       endif
>       if cDomain $ hTrans
>          hDomain := hTrans[ cDomain ]
>          if cText $ hDomain
>             cText := hDomain[ cText ]
>          endif
>       endif
>       return cText

This code forced me to test if NIL can by a hash key. It's a pity, but 
it's not :) We would be able to drop 3 lines of code, by removing 
default cDomain initialization to "[MAIN]".
What are opinions about NIL beeing a hash key (not from the point of 
view of this sample, but for hashes in general)?

Best regards,
Mindaugas




#define CONTEXT_SEPARATOR     "$$$"

STATIC s_aStrings := {=>}, s_cLang := "", s_cTitle := ""


PROC HB_i18nSetBaseLanguage( cLang, cTitle )
   s_cLang := cLang
   s_cTitle := cTitle
RETURN

FUNC HB_i18nSetLanguage( cLang )
LOCAL cDump, aStrings
   cDump := HB_i18n_Load( cLang )
   IF cDump != NIL
     aStrings := HB_DESERIALIZE( cDump )
     IF VALTYPE( aStrings ) == "H"
       s_aStrings := HB_DESERIALIZE( cDump )
       s_cLang := cLang
       RETURN .T.
     ENDIF
   ENDIF
RETURN .F.

FUNC HB_i18nGetLanguage()
RETURN s_cLang

FUNC HB_i18n_gettext( cId, cContext )
LOCAL cRet
   IF cContext != NIL
     cContext := cId + CONTEXT_SEPARATOR + cContext
   ELSE
     cContext := cId
   ENDIF
   IF HB_HHasKey( s_aStrings, cContext )
     cRet := s_aStrings[ cContext ]
     IF cRet != "";  RETURN cRet
     ENDIF
   ENDIF
RETURN cId


FUNC HB_i18ntable_create()
RETURN {=>}


FUNC HB_i18ntable_add( aStrings, cId, cText, cContext )
   IF cContext != NIL
     cContext := cId + CONTEXT_SEPARATOR + cContext
   ELSE
     cContext := cId
   ENDIF
   aStrings[ cContext ] := cText
RETURN aStrings


FUNC HB_i18ntable_save( aStrings, cFile )
LOCAL hFile, cDump
   IF ( hFile := FCREATE( cFile ) ) == -1;  RETURN .F.
   ENDIF
   cDump := HB_SERIALIZE( aStrings )
   FWRITE( hFile, cDump, LEN( cDump ) )
   FCLOSE( hFile )
RETURN .T.


FUNC HB_i18ntable_load( cFile )
LOCAL hFile, nLen, cDump, aStrings
   IF ( hFile := FOPEN( cFile ) ) == -1;  RETURN NIL
   ENDIF
   nLen := FSEEK( hFile, 0, 2 )
   FSEEK( hFile, 0, 0 )
   cDump := SPACE( nLen )
   FREAD( hFile, cDump, nLen )
   aStrings := HB_DESERIALIZE( cDump )
   FCLOSE( hFile )
RETURN aStrings


FUNC HB_i18ntable_savetext( aStrings, cFile )
LOCAL hFile, cValue, cKey, nI
   IF ( hFile := FCREATE( cFile ) ) == -1;  RETURN .F.
   ENDIF
   FWRITE( hFile, CHR(13) + CHR(10) )
   FOR EACH cValue IN aStrings
     cKey := cValue:__enumKey
     IF ( nI := RAT( CONTEXT_SEPARATOR, cKey ) ) > 0
       FWRITE( hFile, 'msgctxt "' + escapestring( SUBSTR( cKey, nI + 
LEN( CONTEXT_SEPARATOR ) ) ) + ;
                      '"' + CHR(13) + CHR(10) )
       FWRITE( hFile, 'msgid "' + escapestring( LEFT( cKey, nI - 1 ) ) + 
'"' + CHR(13) + CHR(10) )
     ELSE
       FWRITE( hFile, 'msgid "' + escapestring( cKey ) + '"' + CHR(13) + 
CHR(10) )
     ENDIF
     FWRITE( hFile, 'msgstr "' + escapestring( cValue ) + '"' + CHR(13) 
+ CHR(10) + CHR(13) + CHR(10) )
   NEXT
   FCLOSE( hFile )
RETURN .T.


FUNC HB_i18ntable_loadtext( cFile )
LOCAL hFile, nLen, cDump, aStrings, nI, nJ, cID, cStr, cCtx, cTxt, cLine

   IF ( hFile := FOPEN( cFile ) ) == -1;  RETURN NIL
   ENDIF
   nLen := FSEEK( hFile, 0, 2 )
   FSEEK( hFile, 0, 0 )
   cDump := SPACE( nLen )
   FREAD( hFile, cDump, nLen )
   FCLOSE( hFile )

   aStrings := {=>}
   cID := cStr := cCtx := NIL
   DO WHILE cDump != ""
     IF ( nI := AT( CHR(10), cDump ) ) > 0
       cLine := LEFT( cDump, nI - 1 )
       IF RIGHT( cLine, 1 ) == CHR(13);  cLine := LEFT( cLine, 
LEN(cLine) - 1 )
       ENDIF
       cDump := SUBSTR( cLine, nI + 1 )
     ELSE
       cLine := cDump
       cDump := ""
     ENDIF
     IF cLine == ""
       IF cID != NIL .AND. cStr != NIL
         IF cCtx != NIL;  cID += CONTEXT_SEPARATOR + cCtx
         ENDIF
         aStrings[ cID ] := cStr
         cID := cStr := cCtx := NIL
       ENDIF
     ELSE
       IF ( nI := AT( '"', cLine ) ) > 0 .AND. ( nJ := RAT( '"', cLine ) 
) > nI
         cTxt := unescapestring( SUBSTR( cLine, nI + 1, nJ - nI - 1 ) )
         IF LEFT( cLine, 8 ) == "msgctxt "
           cCtx := cTxt
         ELSEIF LEFT( cLine, 6 ) == "msgid "
           cID := cTxt
         ELSEIF LEFT( cLine, 7 ) == "msgstr "
           cStr := cTxt
         ENDIF
       ENDIF
     ENDIF
   ENDDO
   IF cID != NIL .AND. cStr != NIL
     IF cCtx != NIL;  cID += CONTEXT_SEPARATOR + cCtx
     ENDIF
     aStrings[ cID ] := cStr
   ENDIF
RETURN aStrings


STATIC FUNC escapestring( cString )
LOCAL cRet := "", cI, nI

   FOR nI := 1 TO LEN( cString )
     cI := SUBSTR( cString, nI, 1 )
     IF ASC( cI ) < 32
       IF ASC( cI ) == 9
         cI += "\t"
       ELSEIF ASC( cI ) == 10
         cI += "\n"
       ELSEIF ASC( cI ) == 13
         cI += "\r"
       ELSE
         cI += "\x" + HB_NUMTOHEX( ASC( cI ), 2 )
       ENDIF
     ELSEIF cI == '"'
       cRet += '\"'
     ELSEIF cI == '\'
       cRet += "\\"
     ELSE
       cRet += cI
     ENDIF
   NEXT
RETURN cRet


STATIC FUNC unescapestring( cString )
LOCAL cRet := "", cI, nI

   FOR nI := 1 TO LEN( cString )
     cI := SUBSTR( cString, nI, 1 )
     IF cI == "\"
       nI++
       IF nI <= LEN( cString )
         cI := SUBSTR( cString, nI, 1 )
         IF cI == "t"
           cRet += CHR(9)
         ELSEIF cI == "n"
           cRet += CHR(10)
         ELSEIF cI == "r"
           cRet += CHR(13)
         ELSEIF cI == "\"
           cRet += "\"
         ELSEIF cI == '"'
           cRet += '"'
         ELSEIF cI == "x"
           nI += 2
           IF nI <= LEN( cString )
             cI += ASC( HB_HEXTONUM( SUBSTR( cString, nI - 1, 2 ) ) )
           ENDIF
         ENDIF
       ENDIF
     ELSE
       cRet += cI
     ENDIF
   NEXT
RETURN cRet


#pragma begindump
#include "windows.h"
#include "hbapi.h"

HB_FUNC( HB_I18N_LOAD )
{
     HGLOBAL  hMem;
     HRSRC    hRes;
     DWORD    dwLen;
     void*    pMem;

     hRes = FindResource( NULL, hb_parc( 1 ), "I18N" );
     if ( ! hRes )
     {
        hb_ret();
        return;
     }

     dwLen = SizeofResource( NULL, hRes );
     hMem = LoadResource( NULL, hRes );
     if ( ! hMem )
     {
        hb_ret();
        return;
     }

     pMem = LockResource( hMem );
     if( ! pMem )
     {
        hb_ret();
        return;
     }

     hb_retclen( (char*) pMem, dwLen );
}

#pragma enddump

From druzus at acn.waw.pl  Wed Nov  5 10:57:25 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 10:57:01 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
Message-ID: <20081105155725.GA26428@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>                           r9830  r9838
> __i18n_loadfrommemory():   3.72   3.72
> __i18n_gettext():          3.39   3.33
> hb_deserialize():         10.26   4.41
> hash lookup:               2.58   4.16
> For some reason simple hash lookup became
> a bit slower, and now 30% slower than
> __i18n_gettext() (previously it was 30%
> faster). Still pretty good though. I wonder
> what may cause this.

Probably there are some different conditions in tests.
Binary search is noticeable faster then the previous one.
Below I'm attaching test code.
You asked about eliminating two scans in code like:
   if cText $ h
      cText := h[ cText ]
   endif
   return cText
And I see that Mindaugas gave perfect answer. If you rewrite
this code in C then it will use only one pass.
Anyhow here we can think about adding yet another feature to
hash arrays. We can introduce new hash flag that will indicate
that on access when variable with given key does not exists in
hash array then this key is return. In such case the above code
will look like:
   return h[ cText ]
We can also make the same functionality in different way and instead
of intorducing new flag we can add special syntax for such situation,
f.e.:
   return h[ @cText ]

this is only for perofrmance reasons. Using C we can easy write function
like:

   HB_FUNC( HB_HKEY )
   {
      PHB_ITEM pHash = hb_param( 1, HB_IT_HASH );
      PHB_ITEM pKey = hb_param( 2, HB_IT_HASHKEY );

      if( pHash && pKey )
      {
         ULONG ulPos;
         hb_hashScan( pHash, pKey, &ulPos );
         if( ulPos )
            pKey = hb_hashGetValueAt( pHash, ulPos );
         hb_itemReturn( pKey );
      }
      else
         hb_errRT_BASE( EG_BOUND, 1133, NULL, hb_langDGetErrorDesc( EG_ARRASSIGN ), 2, pHash, pKey );
   }

and in such case the above .prg code will look like:

   return hb_hKey( h, cText )

but I haven't check how big overhead will be caused by function
call in this case. You can try to compare:

   func f1(cText,h)
   if cText $ h
      cText := h[ cText ]
   endif
   return cText

with:

   func f2(cText,h)
   return hb_hKey( h, cText )

best regards,
Przemek


best regards,
Przemek


#define N_LOOP 10000
#define N_SIZE 1000

proc main()
   local h1, h2, aKeys, i, n, t, tn, x
   h1 := {=>}
   h2 := {=>}
   hb_hSetBinary(h2,.f.)
   aKeys := array(N_SIZE)
   for i:=1 to N_SIZE
      aKeys[i] := "[" + str( i, i%20+10 ) +"]"
      h1[ aKeys[i] ] := aKeys[i]
      h2[ aKeys[i] ] := aKeys[i]
   next

   t := secondsCPU()
   for n:=1 to N_LOOP
      for i:=1 to N_SIZE
         x := aKeys[i]
      next
   next
   tn := secondsCPU() - t
   ? "Other code overhead", tn, "sec."

   t := secondsCPU()
   for n:=1 to N_LOOP
      for i:=1 to N_SIZE
         x := h1[ aKeys[i] ]
      next
   next
   ? "Binary hash:", secondsCPU() - t - tn, "sec."

   t := secondsCPU()
   for n:=1 to N_LOOP
      for i:=1 to N_SIZE
         x := h2[ aKeys[i] ]
      next
   next
   ? "Binary hash:", secondsCPU() - t - tn, "sec."

return
From miguelangel at marchuet.net  Wed Nov  5 11:06:33 2008
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Wed Nov  5 11:04:11 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
Message-ID: <4911C489.3020507@marchuet.net>

ormation:
>>
>> "Code page name" are to "Char Set" as you see some times are confused 
>> by the alias name, any people can think incorrectly
>> that iso-8859-1 is the same than windows-1252 but are real different 
>> Char Set
> 
> Yes, exactly. Very important that ISO-8859-1 is an official
> standard, while Windows-1252 is not. They are similar, but
> not the same. I'd think we should encourage everyone to use
> the ISO standards for best portability.

read MSDN please

Windows-1252 is the standard used at windows application.

ISO-8859-1 is the standard used at Linux and html application,
but have a lot of synonyms on different Linux platform. I use it on
my php applications.



From druzus at acn.waw.pl  Wed Nov  5 11:17:49 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 11:17:08 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <4911C489.3020507@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
Message-ID: <20081105161749.GA24294@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Miguel Angel Marchuet wrote:

Hi Miguel,

> Windows-1252 is the standard used at windows application.

CP-1252 is local MS name. Nothing more.

> ISO-8859-1 is the standard used at Linux and html application,

ISO-8859-1 is standardized name and official standard encoding in
many countries.
In my country official encoding is ISO-8859-2.

> but have a lot of synonyms on different Linux platform. I use it on
> my php applications.

I do not know about any other local synonyms of ISO-8859-1
(maybe only MS CP-1252).
It's official name which has nothing to Linux. Linux only uses
official standards.

best regards,
Przemek
From M.Horodyski at pzuzycie.com.pl  Wed Nov  5 11:20:18 2008
From: M.Horodyski at pzuzycie.com.pl (Horodyski Marek (PZUZ))
Date: Wed Nov  5 11:20:33 2008
Subject: [Harbour] RE: Harbour Digest, Vol 25, Issue 24
In-Reply-To: <NLB01FEg9MvuHdPtnhv0001369e@gatein.pzuzycie.com.pl>
Message-ID: <FFAFD6EA63A3FC4784FBDA52BE7A7C95018ADF5D@PINK.zycie.pzu>

>Date: Wed, 5 Nov 2008 14:56:27 +0100
>From: "Massimo Belgrano" <mbelgrano@deltain.it>
>Subject: [Harbour] one cent for todolist 
>To: <Harbour@harbour-project.org>
>Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F148@SRV02.deltain.net>
>Content-Type: text/plain;	charset="us-ascii"
>
>I dream reading some argument in todolist so compliment to Harbour that
>have done a big amount of changes 
>
>Can I suggest another point that will be useful for make an uniform
>documentation of harbour
>Define  a standard make system so each platform/c compiler  will use
>similar instruction for compile a little sample, or a big 
>project. so is

Have you test xMate  :) ?


[ ... ]

>>Assign to: <nobody>
>>Detail...: Add NETRDD - meta RDD which will allow transport layer
>>           between client application and server application with any
>>           other chosen RDD driver. Idea similar to GTNET but for RDD
>>           drivers - it's sth like ADS does.
>>Status...: Open.
>
>

Massimo,

NETRDD -> LetoDB.

Who know about possibility LetoDB on madiacy TCP/IP ?

We need GTNET and wiedr access to sqldatabase (oracle, db2, mssql) and
class/tools to www/html hosting (in this order).

Regards,
Marek Horodyski
From miguelangel at marchuet.net  Wed Nov  5 11:39:35 2008
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Wed Nov  5 11:37:11 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081105161749.GA24294@34-mo7-2.acn.waw.pl>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>	<490EF019.9050104@marchuet.net>	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>	<49100F2A.5080804@marchuet.net>	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>	<491030C0.20206@marchuet.net>	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>	<4911C489.3020507@marchuet.net>
	<20081105161749.GA24294@34-mo7-2.acn.waw.pl>
Message-ID: <4911CC47.7010200@marchuet.net>

Please, STOP

this is part of MSDN documentation:

as can be possible read are different code page of the same family.
I'm not talking about of its aliases.....

Spanish (Modern Sort) | Western European (Windows)
Code page:       1252       <----------------------
family code page:1252
Code page name:  Windows-1252
Aliases:         ANSI_X3.4-1968, ANSI_X3.4-1986, ascii, cp367, cp819, csASCII, IBM367, ibm819, ISO_646.irv:1991, iso_8859-1,
                  iso_8859-1:1987, ISO646-US, iso8859-1, iso-8859-1, iso-ir-100, iso-ir-6, latin1, us, us-ascii, x-ansi

is different than

Western European (ISO)
Code page:       28591      <----------------------
family code page:1252
Code page name:  iso-8859-1
Aliases:         cp819, csISO, Latin1, ibm819, iso_8859-1, iso_8859-1:1987, iso8859-1, iso-ir-100, l1, latin1

Western European (DOS)
Code page:       850
family code page:1252
Code page name:  ibm850
Aliases:


Western European (Mac)
Code page:       10000
family code page:1252
Code page name:  mathintosh
Aliases:

Western European (IA5)
Code page:       20105
family code page:1252
Code page name:  x-IA5
Aliases:


Unicode (UTF-8)
Code page:       65001
family code page:1252
Code page name:  utf-8
Aliases:         unicode-1-1-utf-8, unicode-2-0-utf-8, x-unicode-2-0-utf-8




Przemyslaw Czerpak escribi?:
> On Wed, 05 Nov 2008, Miguel Angel Marchuet wrote:
> 
> Hi Miguel,
> 
>> Windows-1252 is the standard used at windows application.
> 
> CP-1252 is local MS name. Nothing more.
> 
>> ISO-8859-1 is the standard used at Linux and html application,
> 
> ISO-8859-1 is standardized name and official standard encoding in
> many countries.
> In my country official encoding is ISO-8859-2.
> 
>> but have a lot of synonyms on different Linux platform. I use it on
>> my php applications.
> 
> I do not know about any other local synonyms of ISO-8859-1
> (maybe only MS CP-1252).
> It's official name which has nothing to Linux. Linux only uses
> official standards.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> __________ Informaci?n de ESET NOD32 Antivirus, versi?n de la base de firmas de virus 3586 (20081105) __________
> 
> ESET NOD32 Antivirus ha comprobado este mensaje.
> http://www.eset.com
> 
> 
> 

From mbelgrano at deltain.it  Wed Nov  5 11:37:19 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Nov  5 11:38:14 2008
Subject: [Harbour] RE: Harbour Digest, Vol 25, Issue 24
In-Reply-To: <FFAFD6EA63A3FC4784FBDA52BE7A7C95018ADF5D@PINK.zycie.pzu>
References: <NLB01FEg9MvuHdPtnhv0001369e@gatein.pzuzycie.com.pl>
	<FFAFD6EA63A3FC4784FBDA52BE7A7C95018ADF5D@PINK.zycie.pzu>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F14B@SRV02.deltain.net>

-----Original Message-----
>Have you test xMate  :) ?
I use xmate 
Xmate give me high productivity as possible
The better choice in my opinion is made a make system compatible with
xmate project xhp


>>>Assign to: <nobody>
>>>Detail...: Add NETRDD - meta RDD which will allow transport layer
>>>           between client application and server application with any
>>>           other chosen RDD driver. Idea similar to GTNET but for RDD
>>>           drivers - it's sth like ADS does.
>>>Status...: Open.
>>
>>

>Massimo,
>NETRDD -> LetoDB.
>Who know about possibility LetoDB on madiacy TCP/IP ?
>We need GTNET and wiedr access to sqldatabase (oracle, db2, mssql) and
>class/tools to www/html hosting (in this order).

AFAIK NETRDD will be little different as implementation
NETRDD IS Przemyslaw idea reserved as name for future implementation
GTNET can be intresting now for everyone

In last year letodb project seem with low activity
What is madiacy TCPIP?

From druzus at acn.waw.pl  Wed Nov  5 12:00:21 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 11:59:38 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <4911CC47.7010200@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
	<20081105161749.GA24294@34-mo7-2.acn.waw.pl>
	<4911CC47.7010200@marchuet.net>
Message-ID: <20081105170021.GA28112@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Miguel Angel Marchuet wrote:

Hi Miguel,

> Please, STOP
> this is part of MSDN documentation:

MS documentsion does not creates any standards in my country
and I hope will never do but you can contact with my government
and try to change it ;-)


best regards,
Przemek
From harbour.01 at syenar.hu  Wed Nov  5 12:15:42 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 12:15:49 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <4911C489.3020507@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
Message-ID: <D4DC003A-C5DB-4333-8C3D-14F6363709A9@syenar.hu>

> ormation:
>>>
>>> "Code page name" are to "Char Set" as you see some times are  
>>> confused by the alias name, any people can think incorrectly
>>> that iso-8859-1 is the same than windows-1252 but are real  
>>> different Char Set
>> Yes, exactly. Very important that ISO-8859-1 is an official
>> standard, while Windows-1252 is not. They are similar, but
>> not the same. I'd think we should encourage everyone to use
>> the ISO standards for best portability.
>
> read MSDN please

I better like to get generic information from higher
level sources. I read MSDN when I'd like to know something
about the Windows API, MSVC, C#, you name it.

> Windows-1252 is the standard used at windows application.

Exactly, so it's not a standard by my definition.

In my terms "standard" means something standardized
by an official standardization organization, and the
standard being applied/applicable in a wide-range of
products from different vendors. Lacking this,
"Windows-1252" like above is nothing more than a convention
used by a specific product / company, Windows/Microsoft
in this case.

Harbour is multiplatform, so I suggest others to
endorse this kind of approach in context of this project.

[ For Windows-only projects (which this isn't), this
can be regarded as _the_ "standard" or "quasi-standard",
and above lamentation is academic. ]

[ BTW, this is one of the areas where Windows/MS did
a terrible disservice to the world by introducing / forcing
such hacked, proprietary "standards" on them. ]

> ISO-8859-1 is the standard used at Linux and html application,
> but have a lot of synonyms on different Linux platform. I use it on
> my php applications.

Being used by Linux and 'html applications' is a
consequence of being an official standard, as open
source vendors (but not just them) generally prefer
these over proprietary ones. It's by no means
a "Linux/html standard". It has been standardized
by ISO (as Organization), hence the name.

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov  5 12:25:08 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 12:25:24 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <4911CC47.7010200@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>	<490EF019.9050104@marchuet.net>	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>	<49100F2A.5080804@marchuet.net>	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>	<491030C0.20206@marchuet.net>	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>	<4911C489.3020507@marchuet.net>
	<20081105161749.GA24294@34-mo7-2.acn.waw.pl>
	<4911CC47.7010200@marchuet.net>
Message-ID: <1AFBA437-ED08-43D5-B648-2A3A90B5D4EA@syenar.hu>

Miguel, if you're using MSDN as the sole source of your
information, you shouldn't wonder it's centering the world
around Microsoft, since they are the authors.

Please read other facts. "Windows-1252" was derived from
ISO-8859-1 standard (by Microsoft) with added (non-standard)
features ("embrace and extend").

It has never been accepted by any official standardization
bodies.

Moreover Microsoft is wrong, as ISO-8859-1 could never be
an alias of Windows-1252 as they are not exactly identical.

Microsoft is also wrong in calling their Windows CPs "ANSI"
giving the impression these are official ANSI standards.
They are not unfortunately.

Also notice that "Windows-1252" _as a name_ is an officially
registered one by IANA.

Brgds,
Viktor

On 2008.11.05., at 17:39, Miguel Angel Marchuet wrote:

> Please, STOP
>
> this is part of MSDN documentation:
>
> as can be possible read are different code page of the same family.
> I'm not talking about of its aliases.....
>
> Spanish (Modern Sort) | Western European (Windows)
> Code page:       1252       <----------------------
> family code page:1252
> Code page name:  Windows-1252
> Aliases:         ANSI_X3.4-1968, ANSI_X3.4-1986, ascii, cp367,  
> cp819, csASCII, IBM367, ibm819, ISO_646.irv:1991, iso_8859-1,
>                 iso_8859-1:1987, ISO646-US, iso8859-1, iso-8859-1,  
> iso-ir-100, iso-ir-6, latin1, us, us-ascii, x-ansi
>
> is different than
>
> Western European (ISO)
> Code page:       28591      <----------------------
> family code page:1252
> Code page name:  iso-8859-1
> Aliases:         cp819, csISO, Latin1, ibm819, iso_8859-1,  
> iso_8859-1:1987, iso8859-1, iso-ir-100, l1, latin1
>
> Western European (DOS)
> Code page:       850
> family code page:1252
> Code page name:  ibm850
> Aliases:
>
>
> Western European (Mac)
> Code page:       10000
> family code page:1252
> Code page name:  mathintosh
> Aliases:
>
> Western European (IA5)
> Code page:       20105
> family code page:1252
> Code page name:  x-IA5
> Aliases:
>
>
> Unicode (UTF-8)
> Code page:       65001
> family code page:1252
> Code page name:  utf-8
> Aliases:         unicode-1-1-utf-8, unicode-2-0-utf-8, x-unicode-2-0- 
> utf-8
>
>
>
>
> Przemyslaw Czerpak escribi?:
>> On Wed, 05 Nov 2008, Miguel Angel Marchuet wrote:
>> Hi Miguel,
>>> Windows-1252 is the standard used at windows application.
>> CP-1252 is local MS name. Nothing more.
>>> ISO-8859-1 is the standard used at Linux and html application,
>> ISO-8859-1 is standardized name and official standard encoding in
>> many countries.
>> In my country official encoding is ISO-8859-2.
>>> but have a lot of synonyms on different Linux platform. I use it on
>>> my php applications.
>> I do not know about any other local synonyms of ISO-8859-1
>> (maybe only MS CP-1252).
>> It's official name which has nothing to Linux. Linux only uses
>> official standards.
>> best regards,
>> Przemek
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>> __________ Informaci?n de ESET NOD32 Antivirus, versi?n de la  
>> base de firmas de virus 3586 (20081105) __________
>> ESET NOD32 Antivirus ha comprobado este mensaje.
>> http://www.eset.com
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Wed Nov  5 12:26:49 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 12:26:58 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081105170021.GA28112@34-mo7-2.acn.waw.pl>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
	<20081105161749.GA24294@34-mo7-2.acn.waw.pl>
	<4911CC47.7010200@marchuet.net>
	<20081105170021.GA28112@34-mo7-2.acn.waw.pl>
Message-ID: <02572472-022D-4B47-857F-114FA9574132@syenar.hu>

Actually they managed to do this locally with their
office document standards a while ago :( I'm not sure
what was the deal with Poland, but MS did use dirty
tricks in several countries.

Brgds,
Viktor

On 2008.11.05., at 18:00, Przemyslaw Czerpak wrote:

> On Wed, 05 Nov 2008, Miguel Angel Marchuet wrote:
>
> Hi Miguel,
>
>> Please, STOP
>> this is part of MSDN documentation:
>
> MS documentsion does not creates any standards in my country
> and I hope will never do but you can contact with my government
> and try to change it ;-)
>
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From miguelangel at marchuet.net  Wed Nov  5 12:54:11 2008
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Wed Nov  5 12:51:47 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081105170021.GA28112@34-mo7-2.acn.waw.pl>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>	<490EF019.9050104@marchuet.net>	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>	<49100F2A.5080804@marchuet.net>	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>	<491030C0.20206@marchuet.net>	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>	<4911C489.3020507@marchuet.net>	<20081105161749.GA24294@34-mo7-2.acn.waw.pl>	<4911CC47.7010200@marchuet.net>
	<20081105170021.GA28112@34-mo7-2.acn.waw.pl>
Message-ID: <4911DDC3.6080907@marchuet.net>



Przemyslaw Czerpak escribi?:
> On Wed, 05 Nov 2008, Miguel Angel Marchuet wrote:
> 
> Hi Miguel,
> 
>> Please, STOP
>> this is part of MSDN documentation:
> 
> MS documentsion does not creates any standards in my country
> and I hope will never do but you can contact with my government
> and try to change it ;-)
> 

I don't love windows, but by the moment my customers buy windows
applications.

I don't want to change any standard.

But ISO-????? is not an standard, I as php developer found differences of
names on all linux servers, I don't found the same ISO-??? name.

is something horrible but true, and the only documentation more or less homogeneous
in this regard is the one that presents microsoft :(.

Sometimes Microsoft do good things !

But don't worry i understand you. Microsoft is as Virus !!!

;)
From harbour.01 at syenar.hu  Wed Nov  5 12:51:39 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 12:51:50 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105155725.GA26428@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
Message-ID: <3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>

Hi Przemek,

>> For some reason simple hash lookup became
>> a bit slower, and now 30% slower than
>> __i18n_gettext() (previously it was 30%
>> faster). Still pretty good though. I wonder
>> what may cause this.
>
> Probably there are some different conditions in tests.
> Binary search is noticeable faster then the previous one.

Dunno, my test is far from extensive, and several
optimally and less optimally placed strings should
have to be searched (or all), but that was the consistent
result for my example. (I tried to use a less-optimal
one, at the beginning of the sorted list, to better
highlight the differences). Anyhow, let's not be
blocked by this result, I believe you it's optimal.

Maybe dropping such features as discussed in other
thread (tweaking internal sort and other xhb
historic features), could further enhance speed.

> that on access when variable with given key does not exists in
> hash array then this key is return. In such case the above code
> will look like:
>   return h[ cText ]
> We can also make the same functionality in different way and instead
> of intorducing new flag we can add special syntax for such situation,
> f.e.:
>   return h[ @cText ]

Both excellent. I cannot see the consequences if implementation
and as a brand new hash user it's hard to tell which feels more
natural. Maybe the second one is more elegant. And/or we could
have an alternative hb_HGet???() function with same functionality.

> this is only for perofrmance reasons. Using C we can easy write  
> function
> like:
>
>   HB_FUNC( HB_HKEY )
>   {
>   }
>
> and in such case the above .prg code will look like:
>
>   return hb_hKey( h, cText )

See above :) I think we could have this also. But
for below reasons, the simple assignment above
is superior for this case.

func f2( cText, h )
    return h[ @cText ]

I'll do some tests a bit later.

Brgds,
Viktor

> but I haven't check how big overhead will be caused by function
> call in this case. You can try to compare:
>
>   func f1(cText,h)
>   if cText $ h
>      cText := h[ cText ]
>   endif
>   return cText
>
> with:
>
>   func f2(cText,h)
>   return hb_hKey( h, cText )
>
> #define N_LOOP 10000
> #define N_SIZE 1000
>
> proc main()
>   local h1, h2, aKeys, i, n, t, tn, x
>   h1 := {=>}
>   h2 := {=>}
>   hb_hSetBinary(h2,.f.)
...

From harbour.01 at syenar.hu  Wed Nov  5 12:52:37 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 12:52:43 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105151553.GA18601@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<491184D0.2080905@dbtopas.lt>
	<20081105122447.GA18766@34-mo7-2.acn.waw.pl>
	<4911AFA8.7060008@dbtopas.lt>
	<20081105151553.GA18601@34-mo7-2.acn.waw.pl>
Message-ID: <0C7BA94B-3BC2-4EDD-89D4-B29A7BDF0116@syenar.hu>


> will show:
>
>   MINDAUGAS Kavaliauskas
>
> but I think it's worth to pay. If other developers will agree
> with me then I'll change internal hash representation so keys
> will be hashed when added and then always sorted in binary form.

Fully agree.

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov  5 12:58:22 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 12:58:29 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <4911BBB5.9050607@dbtopas.lt>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<4911BBB5.9050607@dbtopas.lt>
Message-ID: <6FDC46FC-25F6-454A-816E-7195C40FC992@syenar.hu>

Hi Mindaugas,

The downside I see with 'context' implementation (while
it's pretty natural and straightforward), is that it
can make the language file quite fat for long context
strings. Easy to overcome by choosing a short one, in
my case context is a mere 2 chars, so it's not too bad.

As for NIL as a possible key value, I don't know how
it feels for hash users, but it could surely be useful
(maybe as part of some special syntax, or supported
in a function call as parameter).

Brgds,
Viktor

On 2008.11.05., at 16:28, Mindaugas Kavaliauskas wrote:

>> I think that using standard serialization method will increase
>> functionality, f.e. users can easy change the place where they store
>> i18n translation tables, f.e. they can use DBF with MEMO fields.
>> I can update this code but if Mindaugas already has some working code
>> then maybe we should not repeat the work.
>> Mindaugas?
>
> Hi,
>
>
> my local i18n implementation is minimal. It has these functions:
>
> // Set/Get language
> PROC HB_i18nSetBaseLanguage( cLang, cTitle )
> FUNC HB_i18nSetLanguage( cLang )
> FUNC HB_i18nGetLanguage()
>
> // Get translated string
> FUNC HB_i18n_gettext( cId, cContext )
>
> // Manage translation table
> FUNC HB_i18ntable_create()
> FUNC HB_i18ntable_add( aStrings, cId, cText, cContext )
>
> // Save/Load table to/from binary (serialized hash) file
> FUNC HB_i18ntable_save( aStrings, cFile )
> FUNC HB_i18ntable_load( cFile )
>
> // Save/Load table to/from text (.pot) file
> FUNC HB_i18ntable_savetext( aStrings, cFile )
> FUNC HB_i18ntable_loadtext( cFile )
>
> // Load table. Windows only function! I always save translation  
> tables in resource
> FUNC HB_i18n_load( cLang )
>
> It is a little different implementation, than Viktor's. For example  
> I do not have hb_i18n_gettextlang( <cText> [, <langid> ] ), because  
> all strings are extracted from loaded hash values (other languages  
> are in file/resource). But I do support domain/context (in a  
> minimalistic implementation: hash table key is "msgid$$$msgctxt"). I  
> attach my i18n implementation at the end of the letter.
>
>
> I general, I see translation tables implemented by hashes more  
> flexible. Usage of serialization function allows to store language  
> files in any media; file, memo field, etc. Harbour "native" hash  
> functions allows a simple management of translation table, it's very  
> easy to write utility for deleting, merging, editing translation  
> tables (I'm using such utility with a simple browse editor instead  
> of standard GNU gettext utilities). No special functions are needed,  
> native hash functionality is enough.
> Both hashes and Viktor's implementation of translation table uses a  
> binary search, so I speed of table lookup should be almost the same.  
> There is no need to duplicate hash lookup code. That's everything I  
> can add to current discussion about i18n table implementation.
>
>
>>> I think that some upper level functions like translation tools  
>>> or .pot
>>> files manipulations can be written as .prg code so user can easy  
>>> extend
>>> it. The low level functions and hb_i18n_gettext*() for RT  
>>> performance
>>> should be written in C.
>> Yes, my C "fluency" is incomparable to yours, so maybe
>> I'm not the best candidate for this job :)
>
> After we find the best solution I can help to do C implementation.
>
>
>> FUNC __I18N_GETTEXT( cText, hTrans, cDomain )
>>      local hDomain
>>      if cDomain == NIL
>>         cDomain := "[MAIN]"
>>      endif
>>      if cDomain $ hTrans
>>         hDomain := hTrans[ cDomain ]
>>         if cText $ hDomain
>>            cText := hDomain[ cText ]
>>         endif
>>      endif
>>      return cText
>
> This code forced me to test if NIL can by a hash key. It's a pity,  
> but it's not :) We would be able to drop 3 lines of code, by  
> removing default cDomain initialization to "[MAIN]".
> What are opinions about NIL beeing a hash key (not from the point of  
> view of this sample, but for hashes in general)?
>
> Best regards,
> Mindaugas
>
>
>
>
> #define CONTEXT_SEPARATOR     "$$$"
>
> STATIC s_aStrings := {=>}, s_cLang := "", s_cTitle := ""
>
>
> PROC HB_i18nSetBaseLanguage( cLang, cTitle )
>  s_cLang := cLang
>  s_cTitle := cTitle
> RETURN
>
> FUNC HB_i18nSetLanguage( cLang )
> LOCAL cDump, aStrings
>  cDump := HB_i18n_Load( cLang )
>  IF cDump != NIL
>    aStrings := HB_DESERIALIZE( cDump )
>    IF VALTYPE( aStrings ) == "H"
>      s_aStrings := HB_DESERIALIZE( cDump )
>      s_cLang := cLang
>      RETURN .T.
>    ENDIF
>  ENDIF
> RETURN .F.
>
> FUNC HB_i18nGetLanguage()
> RETURN s_cLang
>
> FUNC HB_i18n_gettext( cId, cContext )
> LOCAL cRet
>  IF cContext != NIL
>    cContext := cId + CONTEXT_SEPARATOR + cContext
>  ELSE
>    cContext := cId
>  ENDIF
>  IF HB_HHasKey( s_aStrings, cContext )
>    cRet := s_aStrings[ cContext ]
>    IF cRet != "";  RETURN cRet
>    ENDIF
>  ENDIF
> RETURN cId
>
>
> FUNC HB_i18ntable_create()
> RETURN {=>}
>
>
> FUNC HB_i18ntable_add( aStrings, cId, cText, cContext )
>  IF cContext != NIL
>    cContext := cId + CONTEXT_SEPARATOR + cContext
>  ELSE
>    cContext := cId
>  ENDIF
>  aStrings[ cContext ] := cText
> RETURN aStrings
>
>
> FUNC HB_i18ntable_save( aStrings, cFile )
> LOCAL hFile, cDump
>  IF ( hFile := FCREATE( cFile ) ) == -1;  RETURN .F.
>  ENDIF
>  cDump := HB_SERIALIZE( aStrings )
>  FWRITE( hFile, cDump, LEN( cDump ) )
>  FCLOSE( hFile )
> RETURN .T.
>
>
> FUNC HB_i18ntable_load( cFile )
> LOCAL hFile, nLen, cDump, aStrings
>  IF ( hFile := FOPEN( cFile ) ) == -1;  RETURN NIL
>  ENDIF
>  nLen := FSEEK( hFile, 0, 2 )
>  FSEEK( hFile, 0, 0 )
>  cDump := SPACE( nLen )
>  FREAD( hFile, cDump, nLen )
>  aStrings := HB_DESERIALIZE( cDump )
>  FCLOSE( hFile )
> RETURN aStrings
>
>
> FUNC HB_i18ntable_savetext( aStrings, cFile )
> LOCAL hFile, cValue, cKey, nI
>  IF ( hFile := FCREATE( cFile ) ) == -1;  RETURN .F.
>  ENDIF
>  FWRITE( hFile, CHR(13) + CHR(10) )
>  FOR EACH cValue IN aStrings
>    cKey := cValue:__enumKey
>    IF ( nI := RAT( CONTEXT_SEPARATOR, cKey ) ) > 0
>      FWRITE( hFile, 'msgctxt "' + escapestring( SUBSTR( cKey, nI +  
> LEN( CONTEXT_SEPARATOR ) ) ) + ;
>                     '"' + CHR(13) + CHR(10) )
>      FWRITE( hFile, 'msgid "' + escapestring( LEFT( cKey, nI - 1 ) )  
> + '"' + CHR(13) + CHR(10) )
>    ELSE
>      FWRITE( hFile, 'msgid "' + escapestring( cKey ) + '"' + CHR(13)  
> + CHR(10) )
>    ENDIF
>    FWRITE( hFile, 'msgstr "' + escapestring( cValue ) + '"' +  
> CHR(13) + CHR(10) + CHR(13) + CHR(10) )
>  NEXT
>  FCLOSE( hFile )
> RETURN .T.
>
>
> FUNC HB_i18ntable_loadtext( cFile )
> LOCAL hFile, nLen, cDump, aStrings, nI, nJ, cID, cStr, cCtx, cTxt,  
> cLine
>
>  IF ( hFile := FOPEN( cFile ) ) == -1;  RETURN NIL
>  ENDIF
>  nLen := FSEEK( hFile, 0, 2 )
>  FSEEK( hFile, 0, 0 )
>  cDump := SPACE( nLen )
>  FREAD( hFile, cDump, nLen )
>  FCLOSE( hFile )
>
>  aStrings := {=>}
>  cID := cStr := cCtx := NIL
>  DO WHILE cDump != ""
>    IF ( nI := AT( CHR(10), cDump ) ) > 0
>      cLine := LEFT( cDump, nI - 1 )
>      IF RIGHT( cLine, 1 ) == CHR(13);  cLine := LEFT( cLine,  
> LEN(cLine) - 1 )
>      ENDIF
>      cDump := SUBSTR( cLine, nI + 1 )
>    ELSE
>      cLine := cDump
>      cDump := ""
>    ENDIF
>    IF cLine == ""
>      IF cID != NIL .AND. cStr != NIL
>        IF cCtx != NIL;  cID += CONTEXT_SEPARATOR + cCtx
>        ENDIF
>        aStrings[ cID ] := cStr
>        cID := cStr := cCtx := NIL
>      ENDIF
>    ELSE
>      IF ( nI := AT( '"', cLine ) ) > 0 .AND. ( nJ := RAT( '"',  
> cLine ) ) > nI
>        cTxt := unescapestring( SUBSTR( cLine, nI + 1, nJ - nI - 1 ) )
>        IF LEFT( cLine, 8 ) == "msgctxt "
>          cCtx := cTxt
>        ELSEIF LEFT( cLine, 6 ) == "msgid "
>          cID := cTxt
>        ELSEIF LEFT( cLine, 7 ) == "msgstr "
>          cStr := cTxt
>        ENDIF
>      ENDIF
>    ENDIF
>  ENDDO
>  IF cID != NIL .AND. cStr != NIL
>    IF cCtx != NIL;  cID += CONTEXT_SEPARATOR + cCtx
>    ENDIF
>    aStrings[ cID ] := cStr
>  ENDIF
> RETURN aStrings
>
>
> STATIC FUNC escapestring( cString )
> LOCAL cRet := "", cI, nI
>
>  FOR nI := 1 TO LEN( cString )
>    cI := SUBSTR( cString, nI, 1 )
>    IF ASC( cI ) < 32
>      IF ASC( cI ) == 9
>        cI += "\t"
>      ELSEIF ASC( cI ) == 10
>        cI += "\n"
>      ELSEIF ASC( cI ) == 13
>        cI += "\r"
>      ELSE
>        cI += "\x" + HB_NUMTOHEX( ASC( cI ), 2 )
>      ENDIF
>    ELSEIF cI == '"'
>      cRet += '\"'
>    ELSEIF cI == '\'
>      cRet += "\\"
>    ELSE
>      cRet += cI
>    ENDIF
>  NEXT
> RETURN cRet
>
>
> STATIC FUNC unescapestring( cString )
> LOCAL cRet := "", cI, nI
>
>  FOR nI := 1 TO LEN( cString )
>    cI := SUBSTR( cString, nI, 1 )
>    IF cI == "\"
>      nI++
>      IF nI <= LEN( cString )
>        cI := SUBSTR( cString, nI, 1 )
>        IF cI == "t"
>          cRet += CHR(9)
>        ELSEIF cI == "n"
>          cRet += CHR(10)
>        ELSEIF cI == "r"
>          cRet += CHR(13)
>        ELSEIF cI == "\"
>          cRet += "\"
>        ELSEIF cI == '"'
>          cRet += '"'
>        ELSEIF cI == "x"
>          nI += 2
>          IF nI <= LEN( cString )
>            cI += ASC( HB_HEXTONUM( SUBSTR( cString, nI - 1, 2 ) ) )
>          ENDIF
>        ENDIF
>      ENDIF
>    ELSE
>      cRet += cI
>    ENDIF
>  NEXT
> RETURN cRet
>
>
> #pragma begindump
> #include "windows.h"
> #include "hbapi.h"
>
> HB_FUNC( HB_I18N_LOAD )
> {
>    HGLOBAL  hMem;
>    HRSRC    hRes;
>    DWORD    dwLen;
>    void*    pMem;
>
>    hRes = FindResource( NULL, hb_parc( 1 ), "I18N" );
>    if ( ! hRes )
>    {
>       hb_ret();
>       return;
>    }
>
>    dwLen = SizeofResource( NULL, hRes );
>    hMem = LoadResource( NULL, hRes );
>    if ( ! hMem )
>    {
>       hb_ret();
>       return;
>    }
>
>    pMem = LockResource( hMem );
>    if( ! pMem )
>    {
>       hb_ret();
>       return;
>    }
>
>    hb_retclen( (char*) pMem, dwLen );
> }
>
> #pragma enddump
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at acn.waw.pl  Wed Nov  5 13:01:24 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 13:00:40 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
References: <20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
Message-ID: <20081105180123.GA16461@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

[...]
> I'll do some tests a bit later.

Below is small test code I've just created.
Here I my results:

   __I18N_LOADFROMMEMORY:         5.93 sec.
   hb_deserialize:                6.63 sec.
   other code overhead:           2.28 sec.
   __I18N_GETTEXT:               16.11 sec.
   HB_HKEY:                      12.08 sec.
   Native hash .prg access:      20.03 sec.

Looks that function call overhead is not too big in this test.

best regards,
Przemek


#define N_LOOP 1000
#define N_SIZE 10000
proc main()
   local a, h, aMem, hMem, i, n, t, tn, cKey, aKeys

   ? "Building arrays..."
   h := {=>}
   hb_hAllocate( h, N_SIZE )
   a := array( N_SIZE )
   aKeys := array( N_SIZE )
   for i:=1 to N_SIZE
      cKey := repl("text.", 9) + "[" + str(i,10) + " ]" + ;
              repl( "*", i % 20 )
      aKeys[ i ] := cKey
      a[ i ] := { cKey, upper( cKey ) }
      h[ cKey ] := upper( cKey )
   next
   aSort( a,,, { |x,y| x[1] < y[1] } )
   ? "Saving arrays to files"
   __I18N_SAVE( "data.arr", a )
   hb_memowrit( "data.hsh", hb_serialize( h ) )

   aMem := memoread( "data.arr" )
   hMem := memoread( "data.hsh" )

   t := secondsCPU()
   for i := 1 TO N_LOOP
      a := __I18N_LOADFROMMEMORY( aMem )
   next
   ? "__I18N_LOADFROMMEMORY:", secondsCPU() - t, "sec."

   t := secondsCPU()
   for i := 1 TO N_LOOP
      h := hb_deserialize( hMem )
   next
   ? "hb_deserialize:", secondsCPU() - t, "sec."

   t := secondsCPU()
   for i := 1 TO N_LOOP
      for n := 1 to N_SIZE
         cKey := aKeys[ n ]
      next
   next
   ? "other code overhead:", tn := secondsCPU() - t, "sec."


   t := secondsCPU()
   for i := 1 TO N_LOOP
      for n := 1 to N_SIZE
         cKey := aKeys[ n ]
         cKey := __I18N_GETTEXT( cKey, a )
      next
   next
   ? "__I18N_GETTEXT:", secondsCPU() - t - tn, "sec."

   t := secondsCPU()
   for i := 1 TO N_LOOP
      for n := 1 to N_SIZE
         cKey := aKeys[ n ]
         cKey := HB_HKEY( h, cKey )
      next
   next
   ? "HB_HKEY:", secondsCPU() - t - tn, "sec."

   t := secondsCPU()
   for i := 1 TO N_LOOP
      for n := 1 to N_SIZE
         cKey := aKeys[ n ]
         if cKey $ h
            cKey := h[ cKey ]
         endif
      next
   next
   ? "Native hash .prg access:", secondsCPU() - t - tn, "sec."

return

#pragma begindump
#include "hbapi.h"
#include "hbapierr.h"

HB_FUNC( HB_HKEY )
{
   PHB_ITEM pHash = hb_param( 1, HB_IT_HASH );
   PHB_ITEM pKey = hb_param( 2, HB_IT_HASHKEY );

   if( pHash && pKey )
   {
      ULONG ulPos;
      hb_hashScan( pHash, pKey, &ulPos );
      if( ulPos )
         pKey = hb_hashGetValueAt( pHash, ulPos );
      hb_itemReturn( pKey );
   }
   else
      hb_errRT_BASE( EG_ARG, 1123, NULL, HB_ERR_FUNCNAME,
                     HB_ERR_ARGS_BASEPARAMS );
}
#pragma enddump
From harbour.01 at syenar.hu  Wed Nov  5 13:14:37 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 13:14:53 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105180123.GA16461@34-mo7-2.acn.waw.pl>
References: <20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
Message-ID: <E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>

Thanks for these tests.

Local results:

   __I18N_LOADFROMMEMORY:         9.86 sec.
   hb_deserialize:                9.02 sec.
   other code overhead:           4.95 sec.
   __I18N_GETTEXT:               18.84 sec.
   HB_HKEY:                      16.05 sec.
   Native hash .prg access:      24.36 sec.

Very good results here also.

And there is a cKey assignment which could
still be optimized out in the function call
loops.

Brgds,
Viktor

On 2008.11.05., at 19:01, Przemyslaw Czerpak wrote:

> On Wed, 05 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
> [...]
>> I'll do some tests a bit later.
>
> Below is small test code I've just created.
> Here I my results:
>
>   __I18N_LOADFROMMEMORY:         5.93 sec.
>   hb_deserialize:                6.63 sec.
>   other code overhead:           2.28 sec.
>   __I18N_GETTEXT:               16.11 sec.
>   HB_HKEY:                      12.08 sec.
>   Native hash .prg access:      20.03 sec.
>
> Looks that function call overhead is not too big in this test.
>
> best regards,
> Przemek
>
>
> #define N_LOOP 1000
> #define N_SIZE 10000
> proc main()
>   local a, h, aMem, hMem, i, n, t, tn, cKey, aKeys
>
>   ? "Building arrays..."
>   h := {=>}
>   hb_hAllocate( h, N_SIZE )
>   a := array( N_SIZE )
>   aKeys := array( N_SIZE )
>   for i:=1 to N_SIZE
>      cKey := repl("text.", 9) + "[" + str(i,10) + " ]" + ;
>              repl( "*", i % 20 )
>      aKeys[ i ] := cKey
>      a[ i ] := { cKey, upper( cKey ) }
>      h[ cKey ] := upper( cKey )
>   next
>   aSort( a,,, { |x,y| x[1] < y[1] } )
>   ? "Saving arrays to files"
>   __I18N_SAVE( "data.arr", a )
>   hb_memowrit( "data.hsh", hb_serialize( h ) )
>
>   aMem := memoread( "data.arr" )
>   hMem := memoread( "data.hsh" )
>
>   t := secondsCPU()
>   for i := 1 TO N_LOOP
>      a := __I18N_LOADFROMMEMORY( aMem )
>   next
>   ? "__I18N_LOADFROMMEMORY:", secondsCPU() - t, "sec."
>
>   t := secondsCPU()
>   for i := 1 TO N_LOOP
>      h := hb_deserialize( hMem )
>   next
>   ? "hb_deserialize:", secondsCPU() - t, "sec."
>
>   t := secondsCPU()
>   for i := 1 TO N_LOOP
>      for n := 1 to N_SIZE
>         cKey := aKeys[ n ]
>      next
>   next
>   ? "other code overhead:", tn := secondsCPU() - t, "sec."
>
>
>   t := secondsCPU()
>   for i := 1 TO N_LOOP
>      for n := 1 to N_SIZE
>         cKey := aKeys[ n ]
>         cKey := __I18N_GETTEXT( cKey, a )
>      next
>   next
>   ? "__I18N_GETTEXT:", secondsCPU() - t - tn, "sec."
>
>   t := secondsCPU()
>   for i := 1 TO N_LOOP
>      for n := 1 to N_SIZE
>         cKey := aKeys[ n ]
>         cKey := HB_HKEY( h, cKey )
>      next
>   next
>   ? "HB_HKEY:", secondsCPU() - t - tn, "sec."
>
>   t := secondsCPU()
>   for i := 1 TO N_LOOP
>      for n := 1 to N_SIZE
>         cKey := aKeys[ n ]
>         if cKey $ h
>            cKey := h[ cKey ]
>         endif
>      next
>   next
>   ? "Native hash .prg access:", secondsCPU() - t - tn, "sec."
>
> return
>
> #pragma begindump
> #include "hbapi.h"
> #include "hbapierr.h"
>
> HB_FUNC( HB_HKEY )
> {
>   PHB_ITEM pHash = hb_param( 1, HB_IT_HASH );
>   PHB_ITEM pKey = hb_param( 2, HB_IT_HASHKEY );
>
>   if( pHash && pKey )
>   {
>      ULONG ulPos;
>      hb_hashScan( pHash, pKey, &ulPos );
>      if( ulPos )
>         pKey = hb_hashGetValueAt( pHash, ulPos );
>      hb_itemReturn( pKey );
>   }
>   else
>      hb_errRT_BASE( EG_ARG, 1123, NULL, HB_ERR_FUNCNAME,
>                     HB_ERR_ARGS_BASEPARAMS );
> }
> #pragma enddump
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Wed Nov  5 13:19:12 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 13:19:22 2008
Subject: [Harbour] 2008-11-05 19:16 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93f73$Blat.v2.6.2$00d26b4e$e4437312f6@127.0.0.1>

2008-11-05 19:16 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * bin/hb-func.sh
  * include/hbstdgen.ch
  * include/hbver.h
  * contrib/examples/pp/pp.c
  * source/pp/ppcore.c
  * source/pp/hbpp.c
  * source/common/hbver.c
    * HB_VER_REVISION -> HB_VER_RELEASE.
      INCOMPATIBLE.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov  5 13:28:32 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 13:28:35 2008
Subject: [Harbour] 2008-11-05 19:26 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93f74$Blat.v2.6.2$4e9ba34e$1ed824eec22e@127.0.0.1>

2008-11-05 19:26 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * contrib/hbcurl/hbcurl.c
    % Removed two Harbour level functions not really 
      adding to functionality but forcing linkage of these 
      (otherwise unused) curl interfaces.
      CURL_SHARE_STRERROR()
      CURL_MULTI_STRERROR()
      INCOMPATIBLE (but I doubt even a single user would be affected)

  * source/rtl/version.c
    ! Fix to prev.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov  5 13:37:03 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 13:37:08 2008
Subject: [Harbour] 2008-11-05 19:36 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93f75$Blat.v2.6.2$7f326f28$1b78b25a30c4@127.0.0.1>

2008-11-05 19:36 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * contrib/examples/dbu/bld_b32.bat
  * contrib/examples/dbu/bld_vc.bat
  * utils/hbdoc/bld_b32.bat
  * utils/hbdoc/bld_vc.bat
  * utils/hbmake/bld_b32.bat
  * utils/hbmake/bld_vc.bat
    * Minor cleanups.
    ; NOTE: Win9x support for BCC files is now dropped.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov  5 13:49:11 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 13:48:28 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <4911BBB5.9050607@dbtopas.lt>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<4911BBB5.9050607@dbtopas.lt>
Message-ID: <20081105184911.GA25956@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> This code forced me to test if NIL can by a hash key. It's a pity, but it's 
> not :) We would be able to drop 3 lines of code, by removing default 
> cDomain initialization to "[MAIN]".

But it will not increase the final code speed because
I plan to keep pointer to "[MAIN]" hash in separate item
so we will have sth like:
   return iif( cDomain == NIL, hDefault[ cText ], hTrans[ cDomain, cText ]

To eliminate one hash lookup and easy default domain switching.

> What are opinions about NIL beeing a hash key (not from the point of view 
> of this sample, but for hashes in general)?

It can be very easy implement but because we do not have separate bits
for NIL value then HB_IT_HASHKEY will not be longer functional what will
force some additional code overhead in places which uses HB_I[ST]_HASHKEY
macro.

There is one related subject I wanted to talk about long ago.
Adding pointer items to hash keys introduced one side effect:
when pointer item is collectible item then it will never be freed
untill it exists as hash key. For some code it maybe interesting
feature because the address in memory will never be freed so new
pointer item with the same address should not appear but for some
other code it can cause problems when pointer item is still "alive"
as hash key and its detractor is not executed when all other instances
are out of scope. We can easy change it by translating collectible
pointer items to normal pointer items when they are stored as hash
keys. But I still do not know what is better so I would like to hear
other developers opinion.

Best regards,
Przemek
From druzus at acn.waw.pl  Wed Nov  5 15:11:05 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 15:10:27 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
References: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
Message-ID: <20081105201105.GA26241@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Szak?ts Viktor wrote:
[...]

Hi Viktor, Mindaugas and others,

I've just implemented support for 
   h[ cKey ] => cKey
when cKey does not exists in hash array and of course it gives
optimal speed.
It can be enabled by setting hash array flags by hb_hSet*()
function.
Now I only need good names for this function and hb_hKey()
I sent earlier and I can commit.
Probably they should use some similar core name because both are
bound with similar functionality.
hb_hKey() was a shortcut from hb_hashKey() because this functions
translates (hashes) given key value using hash array but it's probably
to cryptic for users.
Please propose some alternative names.
Maybe sth like:
   hb_hSetKeyHashing( <hValue>, <lOnOFff> )
   hb_hKeyHash( <hValue>, <xKey> )

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Nov  5 15:19:56 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 15:21:31 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105201105.GA26241@34-mo7-2.acn.waw.pl>
References: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
Message-ID: <8905568B-1D8F-42A0-AFBE-AA4DA6D11A27@syenar.hu>

> Hi Viktor, Mindaugas and others,
>
> I've just implemented support for
>   h[ cKey ] => cKey
> when cKey does not exists in hash array and of course it gives
> optimal speed.
> It can be enabled by setting hash array flags by hb_hSet*()
> function.

Great!

> Now I only need good names for this function and hb_hKey()
> I sent earlier and I can commit.
> Probably they should use some similar core name because both are
> bound with similar functionality.
> hb_hKey() was a shortcut from hb_hashKey() because this functions
> translates (hashes) given key value using hash array but it's probably
> to cryptic for users.
> Please propose some alternative names.
> Maybe sth like:
>   hb_hSetKeyHashing( <hValue>, <lOnOFff> )
>   hb_hKeyHash( <hValue>, <xKey> )

Maybe:
hb_HSetKeyAsDefault()
hb_HGetIfExists() or hb_HKeyIfExists()

Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov  5 15:23:29 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 15:22:49 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <0C7BA94B-3BC2-4EDD-89D4-B29A7BDF0116@syenar.hu>
References: <20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<491184D0.2080905@dbtopas.lt>
	<20081105122447.GA18766@34-mo7-2.acn.waw.pl>
	<4911AFA8.7060008@dbtopas.lt>
	<20081105151553.GA18601@34-mo7-2.acn.waw.pl>
	<0C7BA94B-3BC2-4EDD-89D4-B29A7BDF0116@syenar.hu>
Message-ID: <20081105202329.GA13039@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Szak?ts Viktor wrote:
>> will show:
>>   MINDAUGAS Kavaliauskas
>> but I think it's worth to pay. If other developers will agree
>> with me then I'll change internal hash representation so keys
>> will be hashed when added and then always sorted in binary form.
> Fully agree.

Thanks. Other opinions?
I possible I would like to join this hash modification with other
I've just created.

best regards,
Przemek
From bedipritpal at hotmail.com  Wed Nov  5 15:50:12 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov  5 15:50:16 2008
Subject: [Harbour] static BOOL hb_dbfIsLocked( DBFAREAP pArea, ULONG ulRecNo )
Message-ID: <20348888.post@talk.nabble.com>


Hello Przemek

dbf1.c

static BOOL hb_dbfIsLocked( DBFAREAP pArea, ULONG ulRecNo )

Can you guide me with which call this method is implemented?

IsLocked( nRecNo ) or something else. 
Also please tell me how it is routed via USRRDD.

Regards
Pritpal Bedi



-- 
View this message in context: http://www.nabble.com/static-BOOL-hb_dbfIsLocked%28-DBFAREAP-pArea%2C-ULONG-ulRecNo-%29-tp20348888p20348888.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From a.jurkiewicz at abix.info.pl  Wed Nov  5 16:12:56 2008
From: a.jurkiewicz at abix.info.pl (ABIX - Adam Jurkiewicz)
Date: Wed Nov  5 16:13:05 2008
Subject: [Harbour] somebody can give a reply on harbour user mailing list?
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F145@SRV02.deltain.net>
References: <AFB948164110ED43B5EB849E8DEEF03815F145@SRV02.deltain.net>
Message-ID: <200811052212.56297.a.jurkiewicz@abix.info.pl>

Dnia ?roda 05 listopad 2008, Massimo Belgrano napisa?:
> somebody can give a reply on harbour user mailing list?
I am subscribed to this list and already answered to it.

best regards,
Adam
-- 
ABIX - Linuksowe Systemy Wspomagania Biznesu www.abix.info.pl
Gadu-Gadu: 302315
Skype: abix_adamj 
Wsparcie aplikacji: http://groups-beta.google.com/group/abix-rcsoft?hl=pl
From druzus at acn.waw.pl  Wed Nov  5 16:29:28 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov  5 16:28:46 2008
Subject: [Harbour] static BOOL hb_dbfIsLocked( DBFAREAP pArea, ULONG
	ulRecNo )
In-Reply-To: <20348888.post@talk.nabble.com>
References: <20348888.post@talk.nabble.com>
Message-ID: <20081105212928.GA25377@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Pritpal Bedi wrote:
> Hello Przemek
> dbf1.c
> static BOOL hb_dbfIsLocked( DBFAREAP pArea, ULONG ulRecNo )
> Can you guide me with which call this method is implemented?

It's internal DBF RDD function used for few different things.

> IsLocked( nRecNo ) or something else. 

Probably you are asking about:
   dbRecordInfo( DBRI_LOCKED, nRecNo )

> Also please tell me how it is routed via USRRDD.

As I said hb_dbfIsLocked() is internal DBF RDD function.
But if you want to add support for:
   dbRecordInfo( DBRI_LOCKED, nRecNo )
to your RDD based on USRRDD library then you have to overload
RECINFO() method and add action for DBRI_LOCKED index.

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Nov  5 16:43:20 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 16:43:47 2008
Subject: [Harbour] one cent for todolist 
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F148@SRV02.deltain.net>
References: <AFB948164110ED43B5EB849E8DEEF03815F148@SRV02.deltain.net>
Message-ID: <1721EA73-19FC-48D0-AAEB-7F997E507ABD@syenar.hu>

I've taken a quick look at brmake source, and it looks
it would need some serious work to make it into Harbour
as multiplatform 'hbmk' implementation.

Some parts of it need to be translated to English, and
apparently the code is targeting the Windows world
exclusively (all filenames are in uppercase for a start).
The code also implements some features which need
intimate knowledge of 3rd party projects' properties,
and while this could be a good service for some users,
I'd think a generic make system should be as simple
(and generic obviously) as possible, and without such
dependencies.

The beauty of OSS is that this project can live on its
own merits, and I'm sure their developers would welcome
everyone wanting to enhance it in above or other ways.
It can also easily be used by any Harbour users even know,
and I'd encourage everyone to try it, if they seek an
hbmake alternative. It seems far better supported and
probably superior to hbmake in other ways, too.

I'd personally not invest more time (after hbmake) in
refactoring other heavy build tools. It'd be nice to
see Przemek's hbmk code to replace our current
light batch/script solutions, though.

Brgds,
Viktor

> Can I suggest another point that will be useful for make an uniform
> documentation of harbour
> Define  a standard make system so each platform/c compiler  will use
> similar instruction for compile a little sample, or a big project.  
> so is
> difficult document how harbour works
> I suggest something like  build project.exe from
> test1.prg,test2.prg,test.prg,hbvm.lib,hbmacro.lib,hbpp.lib,gtwvw.lib
> This disuniformity add difficult at first steep with harbour
> Imo can be choice from 3 ways
> Hbmk.prg defined by Przemyslaw for make uniform
>> If I'll find spare time to make some cleanups in hbmk.prg then I'll
>> commit it to SVN. It should give similar to hb* script functionality
>
> Pbmake by Phil Barnet  is a make engine for Clipper, Xbase++, C and  
> ASM
> written in clipper
>     have Support conditional directives
>     will performing actions just before/after the compile process
>     Jump to Editor on Compile Failure
>     We modification for be custom for harbour and multiplatform
> BrMake is a sub-project  of
> https://sourceforge.net/projects/hrbtoolslibs/
>     This project ts written in [x]harbour and will be driven by  
> command
> line or  project file
>     Command line syntax
>     Need modification for multiplatform
>
> harbour have made a choice of high quality but make system is  not at
> the same level of quality now
>
> In my opinion pbmake and brmake are similar so I suggest Viktor and or
> Przemyslaw verify if hbmk can be a good way or if the replacement for
> hbmake can be phmake/brmake Either are written in PRG Either will a  
> good
> make system for compile either require modification for having same
> project file on multiple architecture
>
> Thanks in advance


From harbour.01 at syenar.hu  Wed Nov  5 17:28:20 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov  5 17:28:28 2008
Subject: [Harbour] 2008-11-05 23:27 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93f95$Blat.v2.6.2$ce96e5c4$10b4cbd1c434@127.0.0.1>

2008-11-05 23:27 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * make_vc.bat
  * contrib/hbgt/doc/gendoc.bat
  * contrib/hbapollo/make_vc.bat
  * contrib/hbcurl/make_vc.bat
  * contrib/hbmisc/doc/gendoc.bat
    % Non-empty 'echo.' commands in batch files cleaned.
--
Brgds,
Viktor

From mbelgrano at deltain.it  Wed Nov  5 18:57:31 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Nov  5 18:58:26 2008
Subject: R: Re: [Harbour] one cent for todolist 
Message-ID: <001301c93fa2$620d47bd$0400a8c0@deltain.net>

Thanks for your effort
Si we wait hbmk.prg

----- Messaggio originale -----
Da: Szak?ts Viktor <harbour.01@syenar.hu>
Inviato: mercoled? 5 novembre 2008 22.44
A: Harbour Project Main Developer List. <harbour@harbour-project.org>
Oggetto: Re: [Harbour] one cent for todolist 

I've taken a quick look at brmake source, and it looks
it would need some serious work to make it into Harbour
as multiplatform 'hbmk' implementation.

Some parts of it need to be translated to English, and
apparently the code is targeting the Windows world
exclusively (all filenames are in uppercase for a start).
The code also implements some features which need
intimate knowledge of 3rd party projects' properties,
and while this could be a good service for some users,
I'd think a generic make system should be as simple
(and generic obviously) as possible, and without such
dependencies.

The beauty of OSS is that this project can live on its
own merits, and I'm sure their developers would welcome
everyone wanting to enhance it in above or other ways.
It can also easily be used by any Harbour users even know,
and I'd encourage everyone to try it, if they seek an
hbmake alternative. It seems far better supported and
probably superior to hbmake in other ways, too.

I'd personally not invest more time (after hbmake) in
refactoring other heavy build tools. It'd be nice to
see Przemek's hbmk code to replace our current
light batch/script solutions, though.

Brgds,
Viktor

> Can I suggest another point that will be useful for make an uniform
> documentation of harbour
> Define  a standard make system so each platform/c compiler  will use
> similar instruction for compile a little sample, or a big project.  
> so is
> difficult document how harbour works
> I suggest something like  build project.exe from
> test1.prg,test2.prg,test.prg,hbvm.lib,hbmacro.lib,hbpp.lib,gtwvw.lib
> This disuniformity add difficult at first steep with harbour
> Imo can be choice from 3 ways
> Hbmk.prg defined by Przemyslaw for make uniform
>> If I'll find spare time to make some cleanups in hbmk.prg then I'll
>> commit it to SVN. It should give similar to hb* script functionality
>
> Pbmake by Phil Barnet  is a make engine for Clipper, Xbase++, C and  
> ASM
> written in clipper
>     have Support conditional directives
>     will performing actions just before/after the compile process
>     Jump to Editor on Compile Failure
>     We modification for be custom for harbour and multiplatform
> BrMake is a sub-project  of
> https://sourceforge.net/projects/hrbtoolslibs/
>     This project ts written in [x]harbour and will be driven by  
> command
> line or  project file
>     Command line syntax
>     Need modification for multiplatform
>
> harbour have made a choice of high quality but make system is  not at
> the same level of quality now
>
> In my opinion pbmake and brmake are similar so I suggest Viktor and or
> Przemyslaw verify if hbmk can be a good way or if the replacement for
> hbmake can be phmake/brmake Either are written in PRG Either will a  
> good
> make system for compile either require modification for having same
> project file on multiple architecture
>
> Thanks in advance


_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From mbelgrano at deltain.it  Wed Nov  5 18:58:42 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Nov  5 18:59:36 2008
Subject: R: Re: [Harbour] somebody can give a reply on harbour user mailing
	list?
Message-ID: <001401c93fa2$8c5471d1$0400a8c0@deltain.net>

thanks

----- Messaggio originale -----
Da: ABIX - Adam Jurkiewicz <a.jurkiewicz@abix.info.pl>
Inviato: mercoledi 5 novembre 2008 22.13
A: Harbour Project Main Developer List. <harbour@harbour-project.org>
Oggetto: Re: [Harbour] somebody can give a reply on harbour user mailing list?

Dnia ?roda 05 listopad 2008, Massimo Belgrano napisa?:
> somebody can give a reply on harbour user mailing list?
I am subscribed to this list and already answered to it.

best regards,
Adam
-- 
ABIX - Linuksowe Systemy Wspomagania Biznesu www.abix.info.pl
Gadu-Gadu: 302315
Skype: abix_adamj 
Wsparcie aplikacji: http://groups-beta.google.com/group/abix-rcsoft?hl=pl
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From bedipritpal at hotmail.com  Wed Nov  5 19:46:42 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov  5 19:46:45 2008
Subject: [Harbour] static BOOL hb_dbfIsLocked( DBFAREAP pArea, ULONG
	ulRecNo )
In-Reply-To: <20081105212928.GA25377@34-mo7-2.acn.waw.pl>
References: <20348888.post@talk.nabble.com>
	<20081105212928.GA25377@34-mo7-2.acn.waw.pl>
Message-ID: <20353189.post@talk.nabble.com>


Thanks Przemek

>    dbRecordInfo( DBRI_LOCKED, nRecNo )

is what I was  looking for.

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/static-BOOL-hb_dbfIsLocked%28-DBFAREAP-pArea%2C-ULONG-ulRecNo-%29-tp20348888p20353189.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Wed Nov  5 23:02:53 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov  5 23:02:56 2008
Subject: [Harbour] Classes: Methods and Instance Variables with SAME Name
Message-ID: <20354744.post@talk.nabble.com>


Hello All

THE TOPIC IS BEING REVISITED
------------------------------

CLASS WvgWindow

   DATA lbClick
   
   METHOD Init()
   METHOD lbClick

   ENDCLASS

METHOD init() CLASS WvgWindow
   RETURN SELF

METHOD lbClick( bBlock ) CLASS WvgWindow
   hb_toOutDebug( 'WvgWindow:lbClick: ['+valtype( bBlock )+']' )
   RETURN SELF


FUNCTION Main()
   LOCAL oWnd

   oWnd := WvgWindow():New()

   /*  This outputs WvgWindow:lbClick: []   */
   oWnd:lbClick := {|| hb_toOutDebug( 'Hi, I am the instance variable!' ) }

   /*  This outputs WvgWindow:lbClick: []   */
   oWnd:lbClick()

   /*  This generates the runtime error : variable not found */
   Eval( oWnd:lbClick )

   Return nil

THE QUESTION
===========
Xbase++ provides this functionality. Do Harbour stands a chance to
have it? OR any workarounds you can suggest to simulate this behavior.

I am struck with Wvg* classes based on Xbase++ to draw a basic class
skelteton for CUI/GUI manipulation via objects.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/Classes%3A-Methods-and-Instance-Variables-with-SAME-Name-tp20354744p20354744.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Thu Nov  6 03:09:18 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 03:09:20 2008
Subject: [Harbour] 2008-11-06 09:07 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93fe6$Blat.v2.6.2$f78083f4$7bc42011c8e@127.0.0.1>

2008-11-06 09:07 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
  * source/vm/Makefile
  * source/vm/vmmt/Makefile
  * source/common/Makefile
  * source/rtl/Makefile
  - source/vm/fmhb.c
  + source/rtl/fmhb.c
  - source/vm/hbmem.c
  + source/common/hbmem.c
    * Moved hbfm (MEMORY() .prg function) from VM to RTL.
    * Moved hbmem (hb_xmem*() C functions) from VM to COMMON.

  - contrib/hbziparc/hbzipcpp.old
    - Removed.
--
Brgds,
Viktor

From e.m.giordano at emagsoftware.it  Thu Nov  6 03:19:46 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Thu Nov  6 03:20:06 2008
Subject: [Harbour] Errors in latest SVN
Message-ID: <F8BD74E24A8444AEB4AAB768BEC205E6@emag>

Error E2209 source\compiler\complex.c 58: Unable to open include file 
'harboury.h'
Error E2451 source\compiler\complex.c 111: Undefined symbol 'ALWAYS'
Error E2141 source\compiler\complex.c 111: Declaration syntax error
Error E2190 source\compiler\complex.c 111: Unexpected }
Error E2190 source\compiler\complex.c 111: Unexpected }
Error E2040 source\compiler\complex.c 111: Declaration terminated 
incorrectly
Error E2190 source\compiler\complex.c 164: Unexpected }
Error E2190 source\compiler\complex.c 164: Unexpected }
Error E2451 source\compiler\complex.c 179: Undefined symbol 'AS_ARRAY'
Error E2141 source\compiler\complex.c 188: Declaration syntax error
Error E2190 source\compiler\complex.c 188: Unexpected }
Error E2190 source\compiler\complex.c 188: Unexpected }
Error E2451 source\compiler\complex.c 193: Undefined symbol 'AS_ARRAY_ARRAY'
Error E2238 source\compiler\complex.c 202: Multiple declaration for 
'AS_ARRAY'
Error E2356 source\compiler\complex.c 202: Type mismatch in redeclaration of 
'AS_ARRAY'
Error E2141 source\compiler\complex.c 202: Declaration syntax error
Error E2190 source\compiler\complex.c 202: Unexpected }
Error E2190 source\compiler\complex.c 202: Unexpected }
Error E2109 source\compiler\complex.c 242: Not an allowed type in function 
hb_comp_keywordType
Error E2451 source\compiler\complex.c 260: Undefined symbol 'IDENTIFIER' in 
function hb_comp_keywordType
Error E2147 source\compiler\complex.c 274: 'YYSTYPE' cannot start a 
parameter declaration
Error E2288 source\compiler\complex.c 276: Pointer to structure required on 
left side of -> or ->* in function hb_comp_tokenString
Error E2288 source\compiler\complex.c 277: Pointer to structure required on 
left side of -> or ->* in function hb_comp_tokenString
Error E2288 source\compiler\complex.c 278: Pointer to structure required on 
left side of -> or ->* in function hb_comp_tokenString
Error E2288 source\compiler\complex.c 281: Pointer to structure required on 
left side of -> or ->* in function hb_comp_tokenString
Error E2228 source\compiler\complex.c 281: Too many error or warning 
messages in function hb_comp_tokenString

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Thu Nov  6 03:25:39 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 03:25:45 2008
Subject: [Harbour] .prg #if issue?
Message-ID: <4C51E5BA-BAC7-4EE8-920E-2AF47AD171A5@syenar.hu>

Hi folks,

I've run into this today:
---
#if defined(HELLO) .AND. HELLO >= 0x0100
	<code>
#endif
---

If HELLO is #defined, it works, if not, it shows this:
---
Error E0025  Error in #if expression
---

I've tried with this, too:
---
#if HELLO >= 0x0100
	<code>
#endif
---

But results are similar to above.

Brgds,
Viktor

From e.m.giordano at emagsoftware.it  Thu Nov  6 03:28:27 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Thu Nov  6 03:28:31 2008
Subject: [Harbour] .prg #if issue?
References: <4C51E5BA-BAC7-4EE8-920E-2AF47AD171A5@syenar.hu>
Message-ID: <713013BD5CC842D4BA00675C7C9F4040@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: gioved? 6 novembre 2008 9.25
Oggetto: [Harbour] .prg #if issue?


Did you tried

#if defined(HELLO)
    #if HELLO >= 0x0100
        <code>
    #endif
#endif

?

Not tested.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From e.m.giordano at emagsoftware.it  Thu Nov  6 03:30:55 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Thu Nov  6 03:30:58 2008
Subject: [Harbour] .prg #if issue?
References: <4C51E5BA-BAC7-4EE8-920E-2AF47AD171A5@syenar.hu>
	<713013BD5CC842D4BA00675C7C9F4040@emag>
Message-ID: <574ACA0AE92E4B2784D314BE58194DD6@emag>


-----Messaggio Originale----- 
Da: "Enrico Maria Giordano" <e.m.giordano@emagsoftware.it>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: gioved? 6 novembre 2008 9.28
Oggetto: Re: [Harbour] .prg #if issue?


> Did you tried

"Did you try". Sorry.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From M.Horodyski at pzuzycie.com.pl  Thu Nov  6 03:33:14 2008
From: M.Horodyski at pzuzycie.com.pl (Horodyski Marek (PZUZ))
Date: Thu Nov  6 03:33:22 2008
Subject: [Harbour] RE: Harbour Digest, Vol 25, Issue 26
In-Reply-To: <NLB01FEspH2q6DqaJY400013e32@gatein.pzuzycie.com.pl>
Message-ID: <FFAFD6EA63A3FC4784FBDA52BE7A7C95018AE014@PINK.zycie.pzu>

>From: "Massimo Belgrano" <mbelgrano@deltain.it>
>Subject: RE: [Harbour] RE: Harbour Digest, Vol 25, Issue 24

[ ... ]

>AFAIK NETRDD will be little different as implementation
>NETRDD IS Przemyslaw idea reserved as name for future implementation
>GTNET can be intresting now for everyone

Yes, but now we can use LetoDB as Remote DBF_DataBaseSerwer. I'm talk
about dilgence of requirement.

>In last year letodb project seem with low activity

Maby product is mature/adult ?

>What is madiacy TCPIP?

My english is poor/greedy.
TCP/IP is net protocol. For example, old versions ADS use (can work only
on) IPX/SPX protocol.
I have not experience with LetoDB.

Regards,
Marek Horodyski
From harbour.01 at syenar.hu  Thu Nov  6 03:35:46 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 03:35:48 2008
Subject: [Harbour] 2008-11-06 09:35 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c93fea$Blat.v2.6.2$aa0615f4$115419c2addc@127.0.0.1>

2008-11-06 09:35 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
    ! Fixed mistakes in previous commit.
    + Added NOTE about requirement that harboury stays at the top of 
      the obj list.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Thu Nov  6 03:37:18 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 03:37:24 2008
Subject: [Harbour] .prg #if issue?
In-Reply-To: <713013BD5CC842D4BA00675C7C9F4040@emag>
References: <4C51E5BA-BAC7-4EE8-920E-2AF47AD171A5@syenar.hu>
	<713013BD5CC842D4BA00675C7C9F4040@emag>
Message-ID: <D91A9519-E457-4C52-8F8C-707BDDB7DF16@syenar.hu>

Hi Enrico,

It doesn't work also. The problem
is not with the .AND. as it seems, but
rather that >= will just fail if the
macro doesn't exist.

Brgds,
Viktor

On 2008.11.06., at 9:28, Enrico Maria Giordano wrote:

>
> -----Messaggio Originale----- Da: "Szak?ts Viktor" <harbour.01@syenar.hu 
> >
> A: "Harbour Project Main Developer List." <harbour@harbour- 
> project.org>
> Data invio: gioved? 6 novembre 2008 9.25
> Oggetto: [Harbour] .prg #if issue?
>
>
> Did you tried
>
> #if defined(HELLO)
>   #if HELLO >= 0x0100
>       <code>
>   #endif
> #endif
>
> ?
>
> Not tested.
>
> EMG
>
> --
> EMAG Software Homepage:     http://www.emagsoftware.it
> The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
> The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
> The EMG Music page:         http://www.emagsoftware.it/emgmusic
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Thu Nov  6 04:33:36 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 04:33:44 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105184911.GA25956@34-mo7-2.acn.waw.pl>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<4911BBB5.9050607@dbtopas.lt>
	<20081105184911.GA25956@34-mo7-2.acn.waw.pl>
Message-ID: <2C14600B-4948-4155-AA62-C880A2D35CDE@syenar.hu>

Hello Przemek,

>> What are opinions about NIL beeing a hash key (not from the point  
>> of view
>> of this sample, but for hashes in general)?
>
> It can be very easy implement but because we do not have separate bits
> for NIL value then HB_IT_HASHKEY will not be longer functional what  
> will
> force some additional code overhead in places which uses  
> HB_I[ST]_HASHKEY
> macro.
>
> There is one related subject I wanted to talk about long ago.
> Adding pointer items to hash keys introduced one side effect:
> when pointer item is collectible item then it will never be freed
> untill it exists as hash key. For some code it maybe interesting
> feature because the address in memory will never be freed so new
> pointer item with the same address should not appear but for some
> other code it can cause problems when pointer item is still "alive"
> as hash key and its detractor is not executed when all other instances
> are out of scope. We can easy change it by translating collectible
> pointer items to normal pointer items when they are stored as hash
> keys. But I still do not know what is better so I would like to hear
> other developers opinion.

Current working looks natural and in line with the rest
of Harbour. If someone doesn't need the content of
a hash table (including collectible pointers), the hash
table should be destroyed. I can't see any disadvantage
with this.

The alternative solution looks a bit hackish to me,
f.e. what happens with these detached vars, and how the
destructor will ever be called for them (I guess
explicitly)?

In case this is an issue, maybe something like
hb_gcptr2ptr() (name tentative) function seems better,
so that user can make this conversion explicitly if needed.

Brgds,
Viktor

From harbour.01 at syenar.hu  Thu Nov  6 04:33:49 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 04:33:54 2008
Subject: [Harbour] Classes: Methods and Instance Variables with SAME Name
In-Reply-To: <20354744.post@talk.nabble.com>
References: <20354744.post@talk.nabble.com>
Message-ID: <993C102C-625F-4102-9D66-AEC334E88AFF@syenar.hu>

'METHOD lbClick( bBlock ) SETGET' is what you probably need.

Brgds,
Viktor

On 2008.11.06., at 5:02, Pritpal Bedi wrote:

>
> Hello All
>
> THE TOPIC IS BEING REVISITED
> ------------------------------
>
> CLASS WvgWindow
>
>   DATA lbClick
>
>   METHOD Init()
>   METHOD lbClick
>
>   ENDCLASS
>
> METHOD init() CLASS WvgWindow
>   RETURN SELF
>
> METHOD lbClick( bBlock ) CLASS WvgWindow
>   hb_toOutDebug( 'WvgWindow:lbClick: ['+valtype( bBlock )+']' )
>   RETURN SELF
>
>
> FUNCTION Main()
>   LOCAL oWnd
>
>   oWnd := WvgWindow():New()
>
>   /*  This outputs WvgWindow:lbClick: []   */
>   oWnd:lbClick := {|| hb_toOutDebug( 'Hi, I am the instance  
> variable!' ) }
>
>   /*  This outputs WvgWindow:lbClick: []   */
>   oWnd:lbClick()
>
>   /*  This generates the runtime error : variable not found */
>   Eval( oWnd:lbClick )
>
>   Return nil
>
> THE QUESTION
> ===========
> Xbase++ provides this functionality. Do Harbour stands a chance to
> have it? OR any workarounds you can suggest to simulate this behavior.
>
> I am struck with Wvg* classes based on Xbase++ to draw a basic class
> skelteton for CUI/GUI manipulation via objects.
>
> Regards
> Pritpal Bedi
>
> -- 
> View this message in context: http://www.nabble.com/Classes%3A-Methods-and-Instance-Variables-with-SAME-Name-tp20354744p20354744.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From sscc at mweb.co.za  Thu Nov  6 05:18:12 2008
From: sscc at mweb.co.za (Alex Strickland)
Date: Thu Nov  6 05:18:49 2008
Subject: [Harbour] RE: Harbour Digest, Vol 25, Issue 26
In-Reply-To: <FFAFD6EA63A3FC4784FBDA52BE7A7C95018AE014@PINK.zycie.pzu>
References: <FFAFD6EA63A3FC4784FBDA52BE7A7C95018AE014@PINK.zycie.pzu>
Message-ID: <4912C464.1060900@mweb.co.za>

Horodyski Marek (PZUZ) wrote:

> Yes, but now we can use LetoDB as Remote DBF_DataBaseSerwer. I'm talk
> about dilgence of requirement.
> 
>> In last year letodb project seem with low activity
> 
> Maby product is mature/adult ?

I installed it at a theme park in Germany. Unfortunately once or twice 
a day everything "hangs" and I have removed it. It is not easy code to 
debug, and the client side errors are not very informative. In local 
tests it is pretty solid. I am very worried about the site, and I 
would like to install ADS but they are resistant to its cost.

I have thought about trying to write a USRRDD based client and a 1.1.0 
MT based server all in Clipper using our socket classes, some 
homegrown RPC and hb_serialise/deserialise.

And then I stop thinking about it because of my current workload (and 
probably technical ability). Frankly it does not look like a big ask 
but nonetheless it is beyond me at the moment.

Regards
Alex
From e.m.giordano at emagsoftware.it  Thu Nov  6 05:27:02 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Thu Nov  6 05:27:05 2008
Subject: [Harbour] 2008-11-06 09:35 UTC+0200 Viktor Szakats
	(harbour.01syenar hu)
References: <01c93fea$Blat.v2.6.2$aa0615f4$115419c2addc@127.0.0.1>
Message-ID: <25C4645ACAD44B36BAEB5144857EF5B7@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: <harbour@harbour-project.org>
Data invio: gioved? 6 novembre 2008 9.35
Oggetto: [Harbour] 2008-11-06 09:35 UTC+0200 Viktor Szakats 
(harbour.01syenar hu)


> 2008-11-06 09:35 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>  * common.mak
>    ! Fixed mistakes in previous commit.
>    + Added NOTE about requirement that harboury stays at the top of
>      the obj list.

Thank you. It's ok now.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From e.m.giordano at emagsoftware.it  Thu Nov  6 05:29:42 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Thu Nov  6 05:29:44 2008
Subject: [Harbour] .prg #if issue?
References: <4C51E5BA-BAC7-4EE8-920E-2AF47AD171A5@syenar.hu><713013BD5CC842D4BA00675C7C9F4040@emag>
	<D91A9519-E457-4C52-8F8C-707BDDB7DF16@syenar.hu>
Message-ID: <1E3696400C91417695F52839F1437997@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: gioved? 6 novembre 2008 9.37
Oggetto: Re: [Harbour] .prg #if issue?


> Hi Enrico,
>
> It doesn't work also. The problem
> is not with the .AND. as it seems, but
> rather that >= will just fail if the
> macro doesn't exist.

And why not

FUNCTION MAIN()

    #if defined(HELLO)
        IF HELLO >= 0x0100
            ? HELLO
        ENDIF
    #endif

    RETURN NIL

?

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Thu Nov  6 05:39:19 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 05:39:25 2008
Subject: [Harbour] .prg #if issue?
In-Reply-To: <1E3696400C91417695F52839F1437997@emag>
References: <4C51E5BA-BAC7-4EE8-920E-2AF47AD171A5@syenar.hu><713013BD5CC842D4BA00675C7C9F4040@emag>
	<D91A9519-E457-4C52-8F8C-707BDDB7DF16@syenar.hu>
	<1E3696400C91417695F52839F1437997@emag>
Message-ID: <22DDA91D-1048-4127-AF94-C9855F65FEAF@syenar.hu>

>> Hi Enrico,
>>
>> It doesn't work also. The problem
>> is not with the .AND. as it seems, but
>> rather that >= will just fail if the
>> macro doesn't exist.
>
> And why not
>
> FUNCTION MAIN()
>
>   #if defined(HELLO)
>       IF HELLO >= 0x0100
>           ? HELLO
>       ENDIF
>   #endif

Because the protected code parts may use functions
that don't exist depending on the value of HELLO
(which happens to be an external library version
number). In my specific case where this popped up,
your solution could work, but it'd need to "blend"
the two branches together (LOCAL declarations f.e.),
which I'd like to avoid as one branch will soon be
dumped anyway. [ BTW, it would be very nice to be
able to have 'LOCAL/STATIC' keyword inside any code.
but that's a different topic. ]

So, I can solve this in other ways, and it's not a
showstopper, I was just expecting to work like in C.
Regardless of C resemblance however, the comparison
#if operators are a bit limited if there is no way to
handle the case of a missing macro. Maybe there is a
way to fix this it's not colliding with other
requirements.

Brgds,
Viktor

From dmacias at mail.udg.mx  Thu Nov  6 05:56:06 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Thu Nov  6 05:56:05 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4912CD46.70400@mail.udg.mx>

Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):

[E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_st.exe 
speedtst.prg

[ total application time: ]...................................104.00
[ total real time: ]..........................................103.51


Something changed in between with Harbour code and/or compilation  :-(
In compilation I added -bm

Tests with first complete Harbour-OW build showed around 55 seconds, 
near gcc335, now show allmost double

Przemek, any hint ?

David Macias



11/06/08 04:50:32 OS/2 4.50
Harbour 1.1.0dev (Rev. 9846) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 0
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.13
====================================================================
[ T001: x := L_C ]..............................................0.16
[ T002: x := L_N ]..............................................0.16
[ T003: x := L_D ]..............................................0.13
[ T004: x := S_C ]..............................................0.16
[ T005: x := S_N ]..............................................0.13
[ T006: x := S_D ]..............................................0.13
[ T007: x := M_C ]..............................................0.19
[ T008: x := M_N ]..............................................0.16
[ T009: x := M_D ]..............................................0.16
[ T010: x := P_C ]..............................................0.16
[ T011: x := P_N ]..............................................0.16
[ T012: x := P_D ]..............................................0.16
[ T013: x := F_C ]..............................................1.45
[ T014: x := F_N ]..............................................0.42
[ T015: x := F_D ]..............................................0.29
[ T016: x := o:GenCode ]........................................0.42
[ T017: x := o[8] ].............................................0.32
[ T018: round( i / 1000, 2 ) ]..................................0.52
[ T019: str( i / 1000 ) ].......................................2.13
[ T020: val( s ) ]..............................................0.48
[ T021: val( a [ i % 16 + 1 ] ) ]...............................0.97
[ T022: dtos( d - i % 10000 ) ].................................2.19
[ T023: eval( { || i % 16 } ) ].................................4.00
[ T024: eval( bc := { || i % 16 } ) ]...........................0.52
[ T025: eval( { |x| x % 16 }, i ) ].............................2.90
[ T026: eval( bc := { |x| x % 16 }, i ) ].......................0.55
[ T027: eval( { |x| f1( x ) }, i ) ]............................3.13
[ T028: eval( bc := { |x| f1( x ) }, i ) ]......................0.74
[ T029: x := &( "f1(" + str(i) + ")" ) ].......................17.97
[ T030: bc := &( "{|x|f1(x)}" ); eval( bc, i ) ]...............20.87
[ T031: x := valtype( x ) +  valtype( i ) ].....................2.03
[ T032: x := strzero( i % 100, 2 ) $ a[ i % 16 + 1 ] ]..........2.68
[ T033: x := a[ i % 16 + 1 ] == s ].............................0.71
[ T034: x := a[ i % 16 + 1 ] = s ]..............................0.74
[ T035: x := a[ i % 16 + 1 ] >= s ].............................0.74
[ T036: x := a[ i % 16 + 1 ] <= s ].............................0.74
[ T037: x := a[ i % 16 + 1 ] < s ]..............................0.74
[ T038: x := a[ i % 16 + 1 ] > s ]..............................0.74
[ T039: ascan( a, i % 16 ) ]....................................0.61
[ T040: ascan( a, { |x| x == i % 16 } ) ].......................9.26
[ T041: if i%1000==0;a:={};end; aadd(a,{i,1,.T.,s,s2,a2,bc ]....5.65
[ T042: x := a ]................................................0.19
[ T043: x := {} ]...............................................1.32
[ T044: f0() ]..................................................0.23
[ T045: f1( i ) ]...............................................0.39
[ T046: f2( c[1...8] ) ]........................................0.35
[ T047: f2( c[1...40000] ) ]....................................0.35
[ T048: f2( @c[1...40000] ) ]...................................0.32
[ T049: f2( @c[1...40000] ), c2 := c ]..........................0.48
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]....................0.94
[ T051: f2( a ) ]...............................................0.39
[ T052: x := f4() ].............................................2.06
[ T053: x := f5() ].............................................1.65
[ T054: f_prv( c ) ]............................................1.94
====================================================================
[ total application time: ]...................................104.00
[ total real time: ]..........................................103.51

From dmacias at mail.udg.mx  Thu Nov  6 06:17:18 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Thu Nov  6 06:17:12 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4912D23E.3070907@mail.udg.mx>

Przemek:

Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):

[E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_mt.exe 
speedtst.prg --scale

Using --scale cause this error:

--------------
11/06/08 05:08:24 OS/2 4.50
Harbour 1.1.0dev (Rev. 9846) (MT) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 1
N_LOOPS: 1000000
                                                         1 th.  1 th. 
factor
============================================================================
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
--------------

Tracing it happen trying to execute
          hb_threadStart( "thTestScale", mtxJobs, mtxResults )
in section:
--------
    if lScale
       mtxJobs := hb_mutexCreate()
       mtxResults := hb_mutexCreate()
       nTimeTotST := nTimeTotMT := 0
       for i:=1 to nMT
          hb_threadStart( "thTestScale", mtxJobs, mtxResults )
       next
--------

but never enter to hb_threadStart( )
Perhaps error is for values in parameters ?

David Macias

From druzus at acn.waw.pl  Thu Nov  6 06:26:40 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov  6 06:25:56 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4912CD46.70400@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4912CD46.70400@mail.udg.mx>
Message-ID: <20081106112640.GA16328@34-mo7-2.acn.waw.pl>

On Thu, 06 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):
> [E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_st.exe 
> speedtst.prg
> [ total application time: ]...................................104.00
> [ total real time: ]..........................................103.51
> Something changed in between with Harbour code and/or compilation  :-(
> In compilation I added -bm
> Tests with first complete Harbour-OW build showed around 55 seconds, near 
> gcc335, now show allmost double
> Przemek, any hint ?

Probably it's the cost of OpenWatcom MT safe CRTL. Harbour does not use
extensively CRTL. In practice the only one function which may have serious
performance impact is memory allocation. Maybe I will be able to say sth
more if I see all speedtst results for Harbour compiled with and without
-bm flag and check which tests are slower.

best regards,
Przemek
From druzus at acn.waw.pl  Thu Nov  6 06:29:38 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov  6 06:28:54 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4912D23E.3070907@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4912D23E.3070907@mail.udg.mx>
Message-ID: <20081106112938.GA28917@34-mo7-2.acn.waw.pl>

On Thu, 06 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):
> [E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_mt.exe 
> speedtst.prg --scale

Please try mttest*.prg 1st. It will be easier to locate basic problems.

best regards,
Przemek
From dmacias at mail.udg.mx  Thu Nov  6 06:44:26 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Thu Nov  6 06:44:22 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4912D89A.9000003@mail.udg.mx>

 >Probably it's the cost of OpenWatcom MT safe CRTL. Harbour does not use
 >extensively CRTL. In practice the only one function which may have
 >serious performance impact is memory allocation. Maybe I will be able to
 >say sth more if I see all speedtst results for Harbour compiled with and
 >without -bm flag and check which tests are slower.

Rebuilt without -bm flag
-----------------------
[ total application time: ]....................................55.61
[ total real time: ]...........................................55.45
-----------------------

So -bm cause a very serious performance decrease
Note: Previous (-bm) and this test were using hbrun ST

Below are without and with -bm flag results, both ST



With previous hbrun MT was:
-----------------------
[ total application time: ]...................................198.42
[ total real time: ]..........................................197.09
-----------------------

David Macias


Without -bm flag:

11/06/08 05:35:17 OS/2 4.50
Harbour 1.1.0dev (Rev. 9846) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 0
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.16
====================================================================
[ T001: x := L_C ]..............................................0.13
[ T002: x := L_N ]..............................................0.10
[ T003: x := L_D ]..............................................0.13
[ T004: x := S_C ]..............................................0.10
[ T005: x := S_N ]..............................................0.13
[ T006: x := S_D ]..............................................0.10
[ T007: x := M_C ]..............................................0.16
[ T008: x := M_N ]..............................................0.13
[ T009: x := M_D ]..............................................0.13
[ T010: x := P_C ]..............................................0.13
[ T011: x := P_N ]..............................................0.16
[ T012: x := P_D ]..............................................0.13
[ T013: x := F_C ]..............................................0.26
[ T014: x := F_N ]..............................................0.42
[ T015: x := F_D ]..............................................0.29
[ T016: x := o:GenCode ]........................................0.39
[ T017: x := o[8] ].............................................0.29
[ T018: round( i / 1000, 2 ) ]..................................0.48
[ T019: str( i / 1000 ) ].......................................1.03
[ T020: val( s ) ]..............................................0.48
[ T021: val( a [ i % 16 + 1 ] ) ]...............................0.97
[ T022: dtos( d - i % 10000 ) ].................................1.00
[ T023: eval( { || i % 16 } ) ].................................0.90
[ T024: eval( bc := { || i % 16 } ) ]...........................0.45
[ T025: eval( { |x| x % 16 }, i ) ].............................0.81
[ T026: eval( bc := { |x| x % 16 }, i ) ].......................0.52
[ T027: eval( { |x| f1( x ) }, i ) ]............................1.00
[ T028: eval( bc := { |x| f1( x ) }, i ) ]......................0.71
[ T029: x := &( "f1(" + str(i) + ")" ) ]........................6.16
[ T030: bc := &( "{|x|f1(x)}" ); eval( bc, i ) ]................6.10
[ T031: x := valtype( x ) +  valtype( i ) ].....................0.87
[ T032: x := strzero( i % 100, 2 ) $ a[ i % 16 + 1 ] ]..........1.65
[ T033: x := a[ i % 16 + 1 ] == s ].............................0.68
[ T034: x := a[ i % 16 + 1 ] = s ]..............................0.77
[ T035: x := a[ i % 16 + 1 ] >= s ].............................0.74
[ T036: x := a[ i % 16 + 1 ] <= s ].............................0.77
[ T037: x := a[ i % 16 + 1 ] < s ]..............................0.71
[ T038: x := a[ i % 16 + 1 ] > s ]..............................0.77
[ T039: ascan( a, i % 16 ) ]....................................0.65
[ T040: ascan( a, { |x| x == i % 16 } ) ].......................6.52
[ T041: if i%1000==0;a:={};end; aadd(a,{i,1,.T.,s,s2,a2,bc ]....2.87
[ T042: x := a ]................................................0.16
[ T043: x := {} ]...............................................0.29
[ T044: f0() ]..................................................0.23
[ T045: f1( i ) ]...............................................0.35
[ T046: f2( c[1...8] ) ]........................................0.29
[ T047: f2( c[1...40000] ) ]....................................0.32
[ T048: f2( @c[1...40000] ) ]...................................0.32
[ T049: f2( @c[1...40000] ), c2 := c ]..........................0.45
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]....................0.87
[ T051: f2( a ) ]...............................................0.32
[ T052: x := f4() ].............................................1.03
[ T053: x := f5() ].............................................0.58
[ T054: f_prv( c ) ]............................................0.84
====================================================================
[ total application time: ]....................................55.61
[ total real time: ]...........................................55.45


Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):

[E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_st.exe
speedtst.prg

[ total application time: ]...................................104.00
[ total real time: ]..........................................103.51


Something changed in between with Harbour code and/or compilation  :-(
In compilation I added -bm

Tests with first complete Harbour-OW build showed around 55 seconds,
near gcc335, now show allmost double

Przemek, any hint ?

David Macias

With -bm flag:

11/06/08 04:50:32 OS/2 4.50
Harbour 1.1.0dev (Rev. 9846) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 0
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.13
====================================================================
[ T001: x := L_C ]..............................................0.16
[ T002: x := L_N ]..............................................0.16
[ T003: x := L_D ]..............................................0.13
[ T004: x := S_C ]..............................................0.16
[ T005: x := S_N ]..............................................0.13
[ T006: x := S_D ]..............................................0.13
[ T007: x := M_C ]..............................................0.19
[ T008: x := M_N ]..............................................0.16
[ T009: x := M_D ]..............................................0.16
[ T010: x := P_C ]..............................................0.16
[ T011: x := P_N ]..............................................0.16
[ T012: x := P_D ]..............................................0.16
[ T013: x := F_C ]..............................................1.45
[ T014: x := F_N ]..............................................0.42
[ T015: x := F_D ]..............................................0.29
[ T016: x := o:GenCode ]........................................0.42
[ T017: x := o[8] ].............................................0.32
[ T018: round( i / 1000, 2 ) ]..................................0.52
[ T019: str( i / 1000 ) ].......................................2.13
[ T020: val( s ) ]..............................................0.48
[ T021: val( a [ i % 16 + 1 ] ) ]...............................0.97
[ T022: dtos( d - i % 10000 ) ].................................2.19
[ T023: eval( { || i % 16 } ) ].................................4.00
[ T024: eval( bc := { || i % 16 } ) ]...........................0.52
[ T025: eval( { |x| x % 16 }, i ) ].............................2.90
[ T026: eval( bc := { |x| x % 16 }, i ) ].......................0.55
[ T027: eval( { |x| f1( x ) }, i ) ]............................3.13
[ T028: eval( bc := { |x| f1( x ) }, i ) ]......................0.74
[ T029: x := &( "f1(" + str(i) + ")" ) ].......................17.97
[ T030: bc := &( "{|x|f1(x)}" ); eval( bc, i ) ]...............20.87
[ T031: x := valtype( x ) +  valtype( i ) ].....................2.03
[ T032: x := strzero( i % 100, 2 ) $ a[ i % 16 + 1 ] ]..........2.68
[ T033: x := a[ i % 16 + 1 ] == s ].............................0.71
[ T034: x := a[ i % 16 + 1 ] = s ]..............................0.74
[ T035: x := a[ i % 16 + 1 ] >= s ].............................0.74
[ T036: x := a[ i % 16 + 1 ] <= s ].............................0.74
[ T037: x := a[ i % 16 + 1 ] < s ]..............................0.74
[ T038: x := a[ i % 16 + 1 ] > s ]..............................0.74
[ T039: ascan( a, i % 16 ) ]....................................0.61
[ T040: ascan( a, { |x| x == i % 16 } ) ].......................9.26
[ T041: if i%1000==0;a:={};end; aadd(a,{i,1,.T.,s,s2,a2,bc ]....5.65
[ T042: x := a ]................................................0.19
[ T043: x := {} ]...............................................1.32
[ T044: f0() ]..................................................0.23
[ T045: f1( i ) ]...............................................0.39
[ T046: f2( c[1...8] ) ]........................................0.35
[ T047: f2( c[1...40000] ) ]....................................0.35
[ T048: f2( @c[1...40000] ) ]...................................0.32
[ T049: f2( @c[1...40000] ), c2 := c ]..........................0.48
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]....................0.94
[ T051: f2( a ) ]...............................................0.39
[ T052: x := f4() ].............................................2.06
[ T053: x := f5() ].............................................1.65
[ T054: f_prv( c ) ]............................................1.94
====================================================================
[ total application time: ]...................................104.00
[ total real time: ]..........................................103.51


From dmacias at mail.udg.mx  Thu Nov  6 07:07:40 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Thu Nov  6 07:07:36 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4912DE0C.1030903@mail.udg.mx>

 >Please try mttest*.prg 1st. It will be easier to locate basic problems.

It is impossible, all them fail with SYS1808 error

For example mttest01.prg
---------------------------
Harbour 1.1.0dev (Rev. 9846)SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
---------------------------

and it happen trying:
    ? "join:", hb_threadJoin( hb_threadStart( @thFunc() ), @xResult )

Same with and without -bm flag

David Macias



Przemek:

Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):

[E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_mt.exe
speedtst.prg --scale

Using --scale cause this error:

--------------
11/06/08 05:08:24 OS/2 4.50
Harbour 1.1.0dev (Rev. 9846) (MT) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 1
N_LOOPS: 1000000
                                                         1 th.  1 th.
factor
============================================================================
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
--------------

Tracing it happen trying to execute
          hb_threadStart( "thTestScale", mtxJobs, mtxResults )
in section:
--------
    if lScale
       mtxJobs := hb_mutexCreate()
       mtxResults := hb_mutexCreate()
       nTimeTotST := nTimeTotMT := 0
       for i:=1 to nMT
          hb_threadStart( "thTestScale", mtxJobs, mtxResults )
       next
--------

but never enter to hb_threadStart( )
Perhaps error is for values in parameters ?

David Macias


From dbtopas at dbtopas.lt  Thu Nov  6 07:49:06 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Thu Nov  6 07:49:00 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105201105.GA26241@34-mo7-2.acn.waw.pl>
References: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
Message-ID: <4912E7C2.6010801@dbtopas.lt>

Hi,


> I've just implemented support for 
>    h[ cKey ] => cKey
> when cKey does not exists in hash array and of course it gives
> optimal speed.
> It can be enabled by setting hash array flags by hb_hSet*()
> function.

Do you mean this? :
    h := hb_hSetReturnKeyIfKeyDoesNotExistInHash({=>}, .T.)
    ? h["aaa"]      // prints "aaa"
    h["aaa"] := "bbb"
    ? h["aaa"]      // prints "bbb"

I do not want to be stopper for new ideas, but I do not see this flag 
(and possibility to return key value, if hash does not contain this key) 
useful for general hash usage. Ok, it's good for i18n translation, but 
do we know any other places it could be usefull? We will need to write 
some i18n C code, this h[cKey] => cKey behaviour could be implemented in 
i18n_gettext() function.

Syntax h[ @cKey ] gives possibility to test if array index is passed by 
reference in virtual machine, but I think it's alien syntax. User can 
never guess that passing by reference imply default return of value cKey.

I see the only useful (natural, widely used) extension for hashes. It is 
HB_HGET() extension:
    HB_HGET( hHash, xKey [, xDefaultValue ] )
It could be used not only in i18n context: HB_HGET( hHash, cKey, cKey ), 
but also in other places. For example, if I store .ini file content in 
hash, and want to get some application settings:
    nPort := HB_HGET( hIni, "Port", 80 ),
    nW := HB_HGET( hIni, "DefaultScreenWidth", 1280 ),
etc.

Of cause, HB_HGET( hHash, cKey, cKey ) is not speed optimal (cKey 
parameters is passed twice), but if we want to chase for i18n string 
lookup speed, we will need to implement i18n_gettext() in C anyway. So, 
.prg level function HB_HGET() will not be used in implementation.


> The side effect is
> that we will not be able to return original key value, f.e.:
>    h := hb_hSetCastMatch( {=>}, .F. )
>    h[ "Mindaugas" ] := "Kavaliauskas"
>    for each v in h
>       ? v:__enumKey(), v
>    next
> 
> will show:
> 
>    MINDAUGAS Kavaliauskas
> 
> but I think it's worth to pay. If other developers will agree
> with me then I'll change internal hash representation so keys
> will be hashed when added and then always sorted in binary form.

I do not use case INsensitive hashes, but I think it's good idea! This 
way we will not hide internal key value, that is actually used for key 
comparison.

If I need case insensitive hash, I can always construct it using UPPER() 
function.
    h[UPPER(cKey)] := xValue
    ? h[UPPER(cKey)]
So, you proposal seems natural to me.


> There is one related subject I wanted to talk about long ago.
> Adding pointer items to hash keys introduced one side effect:
> when pointer item is collectible item then it will never be freed
> untill it exists as hash key. For some code it maybe interesting
> feature because the address in memory will never be freed so new
> pointer item with the same address should not appear but for some
> other code it can cause problems when pointer item is still "alive"
> as hash key and its detractor is not executed when all other instances
> are out of scope. We can easy change it by translating collectible
> pointer items to normal pointer items when they are stored as hash
> keys. But I still do not know what is better so I would like to hear
> other developers opinion.

The idea of collectible pointer is that Harbour internals tracks pointer 
count and frees resources if pointer is not used. So, user can use code:
   // aWndTitles is hash { window_collectable_pointer => title }
   FOREACH cTitle IN aWndTitles
      SetWindowText( cTitle:__enumKey, cTitle )
   NEXT
I think we should not allow to user avoid tracking of collectible 
pointers by default.

If user has a special needs and wants to avoid tracking of hash key 
pointer, a function could be written to convert collectible pointer to 
simple pointer. And hash could be created:
   aWndTitles[ HB_SIMPLEPOINTER( window ) ] := "Some title"

But this will also have a side effect, if we add some typed C pointers 
and support method calls for it. In this case usage of simple pointer 
does not allows to use:
   FOREACH cTitle IN aWndTitles
      cTitle:__enumKey:SetWindowText( cTitle )
   NEXT
So, I guess we should not convert collectible pointers to simple 
pointers by default.



Best regards,
Mindaugas

From harbour.01 at syenar.hu  Thu Nov  6 07:53:17 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 07:53:25 2008
Subject: [Harbour] BUG: GTWVT wrong initial positioning
Message-ID: <04AC0633-FFAB-4C63-8C7C-517BB68E2380@syenar.hu>

Hi all,

Latest Harbour - and it's difficult to tell from which
version - is wrongly positioning and resizing the window
if the default size cannot fit on screen. Wrongly means
that the screens upper left corner is out of the screen,
the title bar cannot be seen, and the bottom right corner
is somewhere inside the screen area.

---
ANNOUNCE HB_GTSYS
REQUEST HB_GT_WVT_DEFAULT

PROC MAIN()
    SetMode( 100, 150 ) // You milage may vary
    Alert( "Hello world!" )
    RETURN
---

This was surely working in r9760. Actually, back then
SetMode() didn't allow to set the resolution to something
that cannot fit, but at least the screen borders always
fell inside the visible area.

Can someone check this?

Brgds,
Viktor

From harbour.01 at syenar.hu  Thu Nov  6 08:00:23 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 08:00:31 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <4912E7C2.6010801@dbtopas.lt>
References: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
Message-ID: <10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>

Hi Mindaugas, Przemek,

> Do you mean this? :
>   h := hb_hSetReturnKeyIfKeyDoesNotExistInHash({=>}, .T.)
>   ? h["aaa"]      // prints "aaa"
>   h["aaa"] := "bbb"
>   ? h["aaa"]      // prints "bbb"
>
> I do not want to be stopper for new ideas, but I do not see this  
> flag (and possibility to return key value, if hash does not contain  
> this key) useful for general hash usage. Ok, it's good for i18n  
> translation, but do we know any other places it could be usefull? We  
> will need to write some i18n C code, this h[cKey] => cKey behaviour  
> could be implemented in i18n_gettext() function.
>
> Syntax h[ @cKey ] gives possibility to test if array index is passed  
> by reference in virtual machine, but I think it's alien syntax. User  
> can never guess that passing by reference imply default return of  
> value cKey.
>
> I see the only useful (natural, widely used) extension for hashes.  
> It is HB_HGET() extension:
>   HB_HGET( hHash, xKey [, xDefaultValue ] )

Nice. But do you mean that if xDefaultValue is passed, we
should change the RTE behavior of this function? It's okay-ish
with me, but it's a bit strange. For me it would be the
most natural if this function would simply return NIL in
case the key isn't found, or xDefaultValue, if passed. But
changing this function may cause compatibility concerns for
some users (I can't judge).

What was the reasoning behind adding an RTE for non-existing
key lookup, does anyone have any memories on that?

> It could be used not only in i18n context: HB_HGET( hHash, cKey,  
> cKey ), but also in other places. For example, if I store .ini file  
> content in hash, and want to get some application settings:
>   nPort := HB_HGET( hIni, "Port", 80 ),
>   nW := HB_HGET( hIni, "DefaultScreenWidth", 1280 ),
> etc.

Absolutely.

> Of cause, HB_HGET( hHash, cKey, cKey ) is not speed optimal (cKey  
> parameters is passed twice), but if we want to chase for i18n string  
> lookup speed, we will need to implement i18n_gettext() in C anyway.  
> So, .prg level function HB_HGET() will not be used in implementation.

I agree.

Brgds,
Viktor

From bedipritpal at hotmail.com  Thu Nov  6 09:54:52 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov  6 09:54:55 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
Message-ID: <20362591.post@talk.nabble.com>


Hi


Szak?ts Viktor wrote:
> 
> What was the reasoning behind adding an RTE for non-existing
> key lookup, does anyone have any memories on that?
> 

This is exactly which breaks my natural preception about hashes.
Also hb_hDel( aNonExistentKey ) generates RTE, should not be IMO.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/2008-11-01-21%3A13-UTC%2B0100-Przemyslaw-Czerpak-%28druzus-at-priv.onet.pl%29-tp20284056p20362591.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Thu Nov  6 10:03:36 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov  6 10:02:51 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4912D89A.9000003@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4912D89A.9000003@mail.udg.mx>
Message-ID: <20081106150336.GA2240@34-mo7-2.acn.waw.pl>

On Thu, 06 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> >Probably it's the cost of OpenWatcom MT safe CRTL. Harbour does not use
> >extensively CRTL. In practice the only one function which may have
> >serious performance impact is memory allocation. Maybe I will be able to
> >say sth more if I see all speedtst results for Harbour compiled with and
> >without -bm flag and check which tests are slower.
> Something changed in between with Harbour code and/or compilation  :-(
> In compilation I added -bm

Thanks for the detail results.
They clearly show that -bm does not have impact on generated code
speed and the whole slowness is only inside functions which
allocate/free memory. It means that OS2 OpenWatcom uses different
memory manager for MT and ST mode and the MT one is much slower
even if only one thread allocates/frees memory. The only one fix
in such case is using our own MM in OS2 OpenWatcom builds. For this
we will have to port DL malloc to OS2. We can also add our own mutex
protection inside fm.c though it will not resolve the problem with
CRTL functions which may call internally malloc()/free(). Harbour
uses only very limited number of such functions and in only very
specific situations (usually I/O). These are: fopen() and related
functions, INET functions, file functions which uses CRTL instead
of OS2 API (BTW it will be good to add support for HB_OS2_IO just
like we have HB_WIN32_IO and eliminate whole CRTL stuff), stat()
and directory scan functions (also to replace by HB_OS2_IO) and
maybe some others used locally. All of them can be cleaned but
it should be done by real OS2 users. It's hard for me making "blink"
modifications when I cannot test them and I do not have any practice
in OS2. The above is for all builds also for GCC.

> Tests with first complete Harbour-OW build showed around 55 seconds,
> near gcc335, now show allmost double

As I said it's caused by MT safe OpenWatcom memory manager.
Meanwhile you can simply disable -bm in OS2 builds for ST programs.
Now we should resolve the problem with creating new threads in OS2
OpenWatcom() looks that sth is wrong and the problem is not inside
Harbour but OpenWatcom MT CRTL. Or maybe it's a trivial problem with
calling convention and expected startup parameters. I can try to add
workaround and create new thread using only OS2 API but it would be
good if someone who knows C and uses OS2 will make some tests with
OS2 OpenWatcom small MT C programs to find real reason.

best regards,
Przemek
From alex_degarate at hotmail.com  Thu Nov  6 10:14:30 2008
From: alex_degarate at hotmail.com (Alejandro de Garate)
Date: Thu Nov  6 10:14:33 2008
Subject: [Harbour] multiplatform GUI
Message-ID: <BLU149-W10B52A725F2D35691A82C6851E0@phx.gbl>



Some time ago I made some basic test using the FOX toolkit and BCC 551 on win 98 /2000, 
the same code with GCC and DEBIAN and it works quite well.
 
The library is wrote in C++, all the source code is provided (GPL) and not require additional headers or libraries.
 
I never have time to investigate in depth but if someone want to give a look go to  www.fox-toolkit.org
 
Alejandro
_________________________________________________________________
News, entertainment and everything you care about at Live.com. Get it now!
http://www.live.com/getstarted.aspx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081106/04e53872/attachment.html
From harbour.01 at syenar.hu  Thu Nov  6 10:32:25 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 10:32:31 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20362591.post@talk.nabble.com>
References: <20081101201322.GA7703@34-mo7-2.acn.waw.pl>
	<47F038D6-C035-4309-B6FB-C16B542645E1@syenar.hu>
	<20081101203951.GA15722@34-mo7-2.acn.waw.pl>
	<F65F52EC-6E9A-46A8-B6F4-2805EE8299C0@syenar.hu>
	<20081101232515.GA24105@34-mo7-2.acn.waw.pl>
	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>
	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>
	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>
	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>
	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
	<20362591.post@talk.nabble.com>
Message-ID: <CFCE4F25-AE8B-40B0-91E6-30711F460D5F@syenar.hu>

So we might as well modify hb_HDel() to return
a boolean showing the success of the operation,
rather than an RTE. Makes more sense to me too,
and allows for quicker code, as there is no need
to explicitly check for such error situation.

RTE could be reserved for the case when the
first hash parameter is of the wrong type or
missing.

Brgds,
Viktor

On 2008.11.06., at 15:54, Pritpal Bedi wrote:

>
> Hi
>
>
> Szak?ts Viktor wrote:
>>
>> What was the reasoning behind adding an RTE for non-existing
>> key lookup, does anyone have any memories on that?
>>
>
> This is exactly which breaks my natural preception about hashes.
> Also hb_hDel( aNonExistentKey ) generates RTE, should not be IMO.
>
> Regards
> Pritpal Bedi
>
> -- 
> View this message in context: http://www.nabble.com/2008-11-01-21%3A13-UTC%2B0100-Przemyslaw-Czerpak-%28druzus-at-priv.onet.pl%29-tp20284056p20362591.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From dbtopas at dbtopas.lt  Thu Nov  6 11:05:37 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Thu Nov  6 11:05:29 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100
	Przemyslaw	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
References: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
Message-ID: <491315D1.7030303@dbtopas.lt>

Hi,


>> I see the only useful (natural, widely used) extension for hashes. It 
>> is HB_HGET() extension:
>>   HB_HGET( hHash, xKey [, xDefaultValue ] )
> 
> Nice. But do you mean that if xDefaultValue is passed, we
> should change the RTE behavior of this function? It's okay-ish
> with me, but it's a bit strange. For me it would be the
> most natural if this function would simply return NIL in
> case the key isn't found, or xDefaultValue, if passed. But
> changing this function may cause compatibility concerns for
> some users (I can't judge).
> 
> What was the reasoning behind adding an RTE for non-existing
> key lookup, does anyone have any memories on that?

I do not remember any discussion about RTE on non-existing key lookup, 
but I see this natural. HB_HGET( hHash, xKey ) is a king of synonym for 
hHash[ xKey ]. So, if Harbour generates runtime error for:
   aArray := {}
   ? aArray[ 1 ]
it should generate RTE for:
   hHash := {=>}
   ? hHash[ 1 ]  // or HB_HGET( hHash, 1 )

I'd like to catch hash access error, but not return NIL and mask it. If 
the user do not want generate RTE if key does non-exists, there are two 
possible solutions (both of them are from my real life app development):

1) if it's OK, that hash is extended (missing key added) and default 
value is always the same, developer can use auto-add feature. The 
missing key will be added to hash using hash's default value.
2) if hash should not be extended or default value is different for 
different keys, it had to write:
   IF HB_HHASKEY( hHash, xKey )
      xResult := hHash[ xKey ]
   ELSE
      xResult := xDefaultValue
   ENDIF
or
   SomeFunction( IF(HB_HHASKEY(hHash,Key), hHash[xKey], xDefaultValue) )

I have a dozen expressions like this in my code. About 40% of 
HB_HHASKEY() calls in my code are used exactly for this purpose, i.e. to 
test if key exists and return default value otherwise.
   hHash[ xKey ] expression can not be extended to indicate the default 
return value, but HB_HGET() function can easy be extended and I see this 
extension useful.

Yes, I would be extension of the existing function. I do not see a big 
problems about backward compatibility here. Code using two parameters 
version HB_HGET( hHash, xKey ) will be compatible. I don't think many 
people currently are using code:

   HB_HGET(hHash, xKey, "let's pass some extra params", "to make my own 
code", "incompatible with future extensions", .T., {|| __QUIT()}, 123, 
DATE())


Best regards,
Mindaugas
From harbour.01 at syenar.hu  Thu Nov  6 11:35:54 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 11:36:13 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100
	Przemyslaw	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <491315D1.7030303@dbtopas.lt>
References: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
	<491315D1.7030303@dbtopas.lt>
Message-ID: <6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>

>> What was the reasoning behind adding an RTE for non-existing
>> key lookup, does anyone have any memories on that?
>
> I do not remember any discussion about RTE on non-existing key  
> lookup, but I see this natural. HB_HGET( hHash, xKey ) is a king of  
> synonym for hHash[ xKey ]. So, if Harbour generates runtime error for:
>  aArray := {}
>  ? aArray[ 1 ]
> it should generate RTE for:
>  hHash := {=>}
>  ? hHash[ 1 ]  // or HB_HGET( hHash, 1 )

What's natural for the array operator is not necessarily
natural for a function call IMO. array operator has some
properties we all know and expect for hashes too, just
for arrays, but such thing don't exist for functions
in general. This could be a differentiating feature between
these two syntaxes, right now they are just duplicate syntax.

> I'd like to catch hash access error, but not return NIL and mask it.  
> If the user do not want generate RTE if key does non-exists, there  
> are two possible solutions (both of them are from my real life app  
> development):
>
> 1) if it's OK, that hash is extended (missing key added) and default  
> value is always the same, developer can use auto-add feature. The  
> missing key will be added to hash using hash's default value.

Hm, I find this extremely unnatural and even dangerous. In fact
I didn't understand the whole fuss about "autoadd" when lengthy
discussion were going on. Now I know what it was all about.
For me it'd be the last thing I want that my hash table
automatically extends with new members _on access_. Maybe this
is normal for other languages, I don't know.

For me autoadd on assign is normal, the rest is just another
way to make language semantics difficult to follow/ambiguous
and programs almost impossible to read.

> 2) if hash should not be extended or default value is different for  
> different keys, it had to write:
>  IF HB_HHASKEY( hHash, xKey )
>     xResult := hHash[ xKey ]
>  ELSE
>     xResult := xDefaultValue
>  ENDIF
> or
>  SomeFunction( IF(HB_HHASKEY(hHash,Key), hHash[xKey], xDefaultValue) )

And this needs two lookups, which gives it an unnecessary
overhead.
Moreover you need a distinct function just to check the
existence of a key. Ideally hb_HGet( h, k ) != NIL could do
this, and with the third parameter, this would be even better,
doing what you and probably most developers would expect.

> I have a dozen expressions like this in my code. About 40% of  
> HB_HHASKEY() calls in my code are used exactly for this purpose,  
> i.e. to test if key exists and return default value otherwise.
>  hHash[ xKey ] expression can not be extended to indicate the  
> default return value, but HB_HGET() function can easy be extended  
> and I see this extension useful.

I think that's not the question, but rather if we want to
keep the RTE in hb_HGet() at all.

xhb compatibility is not a concern BTW, because it uses
different function names anyway.

> Yes, I would be extension of the existing function. I do not see a  
> big problems about backward compatibility here. Code using two  
> parameters version HB_HGET( hHash, xKey ) will be compatible. I  
> don't think many people currently are using code:
>
>  HB_HGET(hHash, xKey, "let's pass some extra params", "to make my  
> own code", "incompatible with future extensions", .T., {||  
> __QUIT()}, 123, DATE())

No compatibility concern here. It's just strange to modify
RTE logic based on the existence of a parameter.
(except of course normal case when 'if( ! ISCHAR( 1 ) ) -> RTE')

For sure, Harbour's hash implementation details looks very messy
to me. Management of some xhb heritage is a real burden :(
(see also hb_AIns()/hb_ADel(), logging, .ini files, ...)

Brgds,
Viktor

From dbtopas at dbtopas.lt  Thu Nov  6 12:06:12 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Thu Nov  6 12:06:02 2008
Subject: [Harbour] 2008-11-01 21:13
	UTC+0100	Przemyslaw	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
References: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>	<4912E7C2.6010801@dbtopas.lt>	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>	<491315D1.7030303@dbtopas.lt>
	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
Message-ID: <49132404.3070802@dbtopas.lt>

Hi,


> Hm, I find this extremely unnatural and even dangerous. In fact
> I didn't understand the whole fuss about "autoadd" when lengthy
> discussion were going on. Now I know what it was all about.
> For me it'd be the last thing I want that my hash table
> automatically extends with new members _on access_. Maybe this
> is normal for other languages, I don't know.

Sometimes this autoadd is very useful:
    DBEVAL({|| hHash[ FIELD->CODE ] += FIELD->AMOUNT })


> Moreover you need a distinct function just to check the
> existence of a key. Ideally hb_HGet( h, k ) != NIL could do
> this, and with the third parameter, this would be even better,
> doing what you and probably most developers would expect.

No! HB_HGET( h, k ) == NIL, if hash HAS key k associated to value NIL.


> I think that's not the question, but rather if we want to
> keep the RTE in hb_HGet() at all.

I want to keep RTE.


> xhb compatibility is not a concern BTW, because it uses
> different function names anyway.

I do not know any xhb compatibility issues about hashes. It was written 
by Przemek from scratch, and all xhb compatibility (like hHash:method 
support) is in xhb.lib.


> For sure, Harbour's hash implementation details looks very messy
> to me. Management of some xhb heritage is a real burden :(
> (see also hb_AIns()/hb_ADel(), logging, .ini files, ...)

Yes, I remember all discussion about Clipper functions extension. 
Finally, I do not use HB_AINS()/HB_ADEL(), but use AINSS(), ADELS() 
which always adjust size of array (the last letter "S" of function name 
is abbrv. of "Size") and does not need the third parameter .T./.F. .

But not everything is xhb heritage. For example, yesterday my friend 
asked: do we have a function like RAT() with parameter nStartFrom. I do 
not know if xharbour has such extension, but it is much easier to do 
string parsing by passing nStartFrom instead of using LEFT() and 
modifying the string by cutting-off at the last separator in each loop. 
Harbour could not have such function by accepted "Clipper compatibility 
rules", or it will by one more Clipper function clone-extension like 
HB_RAT().



Best regards,
Mindaugas
From harbour.01 at syenar.hu  Thu Nov  6 12:19:15 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 12:19:22 2008
Subject: [Harbour] 2008-11-01 21:13
	UTC+0100	Przemyslaw	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <49132404.3070802@dbtopas.lt>
References: <20081101232515.GA24105@34-mo7-2.acn.waw.pl>	<B40407F5-8485-46D1-8C4F-1D7F53E836AA@syenar.hu>	<20081104203130.GA23534@34-mo7-2.acn.waw.pl>	<A1221DD1-1704-4275-B4C3-D084BED2BAB8@syenar.hu>	<20081104230348.GA13492@34-mo7-2.acn.waw.pl>	<0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>	<4912E7C2.6010801@dbtopas.lt>	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>	<491315D1.7030303@dbtopas.lt>
	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
	<49132404.3070802@dbtopas.lt>
Message-ID: <3B80EB2A-781E-44D4-A8CF-A115237E0674@syenar.hu>

>> Hm, I find this extremely unnatural and even dangerous. In fact
>> I didn't understand the whole fuss about "autoadd" when lengthy
>> discussion were going on. Now I know what it was all about.
>> For me it'd be the last thing I want that my hash table
>> automatically extends with new members _on access_. Maybe this
>> is normal for other languages, I don't know.
>
> Sometimes this autoadd is very useful:
>   DBEVAL({|| hHash[ FIELD->CODE ] += FIELD->AMOUNT })

Good example, thanks for it. BTW I don't want to dig
deeper in this issue, as the point is i18n, I assume
hashing is good and useful as it it, even if I find
some points confusing at first.

>> Moreover you need a distinct function just to check the
>> existence of a key. Ideally hb_HGet( h, k ) != NIL could do
>> this, and with the third parameter, this would be even better,
>> doing what you and probably most developers would expect.
>
> No! HB_HGET( h, k ) == NIL, if hash HAS key k associated to value NIL.

Okay, this point is also cleared then.

>> I think that's not the question, but rather if we want to
>> keep the RTE in hb_HGet() at all.
>
> I want to keep RTE.

And for the above reason it's even necessary.

>> xhb compatibility is not a concern BTW, because it uses
>> different function names anyway.
>
> I do not know any xhb compatibility issues about hashes. It was  
> written by Przemek from scratch, and all xhb compatibility (like  
> hHash:method support) is in xhb.lib.

I see, but some stuff got into it - obviously
not the above -, and I hope those can still be
cleaned (all discussed in other thread).

>> For sure, Harbour's hash implementation details looks very messy
>> to me. Management of some xhb heritage is a real burden :(
>> (see also hb_AIns()/hb_ADel(), logging, .ini files, ...)
>
> Yes, I remember all discussion about Clipper functions extension.  
> Finally, I do not use HB_AINS()/HB_ADEL(), but use AINSS(), ADELS()  
> which always adjust size of array (the last letter "S" of function  
> name is abbrv. of "Size") and does not need the third  
> parameter .T./.F. .
>
> But not everything is xhb heritage. For example, yesterday my friend  
> asked: do we have a function like RAT() with parameter nStartFrom. I  
> do not know if xharbour has such extension, but it is much easier to  
> do string parsing by passing nStartFrom instead of using LEFT() and  
> modifying the string by cutting-off at the last separator in each  
> loop. Harbour could not have such function by accepted "Clipper  
> compatibility rules", or it will by one more Clipper function clone- 
> extension like HB_RAT().

Yes, a very important difference IMO. The question most of
the time isn't about the feature itself, but the way it's
implemented.

I pretty much like that I exactly know which function calls
are coming from Harbour at a spot, and this doesn't slow me
down a bit, and I can use just as much extensions as xhb, if
I'd like to.

BTW, we could add HB_RAT(), we already have HB_AT().

Brgds,
Viktor

From druzus at acn.waw.pl  Thu Nov  6 12:22:14 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov  6 12:21:30 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
References: <0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
	<491315D1.7030303@dbtopas.lt>
	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
Message-ID: <20081106172214.GA9967@34-mo7-2.acn.waw.pl>

On Thu, 06 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor, Mindaugas and others,

> What's natural for the array operator is not necessarily
> natural for a function call IMO. array operator has some
> properties we all know and expect for hashes too, just
> for arrays, but such thing don't exist for functions
> in general. This could be a differentiating feature between
> these two syntaxes, right now they are just duplicate syntax.

Probably some RT errors from function call should be eliminated
for flexible usage. I never though about this problem so far
and when I was adding hashes to harbour I simply replicated
most of RT errors which exists in xHarbour.

> Hm, I find this extremely unnatural and even dangerous. In fact
> I didn't understand the whole fuss about "autoadd" when lengthy
> discussion were going on. Now I know what it was all about.
> For me it'd be the last thing I want that my hash table
> automatically extends with new members _on access_. Maybe this
> is normal for other languages, I don't know.

You've just accepted autoadd in assign because you have quite nice
example of these feature used for i18n translation tables and so
far you haven't created any code which can benefit from autoadd
in access and you still think about hash items like like about some
type of static storage.
This feature is usable when hash is used as backed to collect some
results.
F.e. I want to collect information about quantity of articles sold:

   hReport := { => }
   hb_hDefault( hReport, 0 )
   hb_hSetAutoAdd( hReport, .t. )
   dbGoTop()
   while !eof()
      hReport[ FIELD->ARTICLE ] += FIELD->QUANTITY
      dbSkip()
   enddo
   for each v in hReport
      ? v:__enumIndex(), v:__enumKey(), v
   next

It's possible to use complex items as default value too and this
complex item is _cloned_ when used as each new hash item value.
F.e. I want to create sales report with article code, quantity and
value grouped by articule code.

   hReport := { => }
   hb_hDefault( hReport, { 0, 0 } )
   dbGoTop()
   while !eof()
      aRec := hReport[ FIELD->ARTICLE ]
      aRec[ 1 ] += FIELD->QUANTITY
      aRec[ 1 ] += FIELD->QUANTITY * FIELD->PRICE
      dbSkip()
   enddo
   for each aRec in hReport
      ? aRec:__enumIndex(), aRec:__enumKey(), aRec[1], aRec[2]
   next

> For me autoadd on assign is normal, the rest is just another
> way to make language semantics difficult to follow/ambiguous
> and programs almost impossible to read.

In the usage like for i18n string translation or as some type of
strage for known elements then yes.
But it's not the only one situations when hashes are usable.
When hash item is used for translations like in i18n then it's
usable to have the feature which alows to return key when key
does not exists in the hash array. F.e. In the 1-st report above
I may want to group some type of articles together and rest
present individually. With this feature it's enough to change
the line with:
      hReport[ FIELD->ARTICLE ] += FIELD->QUANTITY
to:
      hReport[ hGroups[ FIELD->ARTICLE ] ] += FIELD->QUANTITY
but I can also use:
      hReport[ hb_hKey( hGroups, FIELD->ARTICLE ) ] += FIELD->QUANTITY
Instead of adding new attribute to hashes.

> Moreover you need a distinct function just to check the
> existence of a key. Ideally hb_HGet( h, k ) != NIL could do
> this, and with the third parameter, this would be even better,
> doing what you and probably most developers would expect.

It cannot because NIL is also valid hash item value so it will
not be usable in all cases. But of course it does not mean that
we cannot remove RT error from hb_hGet() and document it as expected
behavior. If someone prefers functions call instead of faster h[key]
then probably he has some special reasons for this. One of such reason
can be missing RT error.

> I think that's not the question, but rather if we want to
> keep the RTE in hb_HGet() at all.

Exactly.

> xhb compatibility is not a concern BTW, because it uses
> different function names anyway.

Because you asked to translate most of them. At the beginning
this implementation was using xHarbour compatible API. Anyhow
I do not think we have to be strictly compatible with RTE in
such functions.

best regards,
Przemek
From miguelangel at marchuet.net  Thu Nov  6 13:07:53 2008
From: miguelangel at marchuet.net (Miguel Angel Marchuet)
Date: Thu Nov  6 13:04:33 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <D4DC003A-C5DB-4333-8C3D-14F6363709A9@syenar.hu>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
	<D4DC003A-C5DB-4333-8C3D-14F6363709A9@syenar.hu>
Message-ID: <49133279.3010706@marchuet.net>

An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081106/8fa11515/attachment.html
From harbour.01 at syenar.hu  Thu Nov  6 13:14:49 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 13:14:57 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <49133279.3010706@marchuet.net>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
	<D4DC003A-C5DB-4333-8C3D-14F6363709A9@syenar.hu>
	<49133279.3010706@marchuet.net>
Message-ID: <7B599A17-EA44-4452-83CE-471BB3639341@syenar.hu>

Miguel,

IANA assigns _names_.

This only means that this object what is the non-official
codepage created by Microsoft, has a standard name
"Windows-1252" (and not "Win-1252", or "Win1252"). It
also assures that this name won't be assigned for other
purposes.

Such names can be used in certain internal protocol.

That's all. The underlying codepage itself, while
probably something everyone knows, still isn't an
officially accepted codepage.

[ BTW, I noted this fact in one of my messages. ]

Brgds,
Viktor

On 2008.11.06., at 19:07, Miguel Angel Marchuet wrote:

> Please read this page:
>
> http://en.wikipedia.org/wiki/Windows-1252
>
> seem Windows-1252 is aproved too by iana (Internet Assigned Numbers  
> Authority (IANA))
>
> What more do you need ?
>
> Best regards
> Miguel Angel Marchuet
>
> Szak?ts Viktor escribi?:
>>
>>> ormation:
>>>>>
>>>>> "Code page name" are to "Char Set" as you see some times are  
>>>>> confused by the alias name, any people can think incorrectly
>>>>> that iso-8859-1 is the same than windows-1252 but are real  
>>>>> different Char Set
>>>> Yes, exactly. Very important that ISO-8859-1 is an official
>>>> standard, while Windows-1252 is not. They are similar, but
>>>> not the same. I'd think we should encourage everyone to use
>>>> the ISO standards for best portability.
>>>
>>> read MSDN please
>>
>> I better like to get generic information from higher
>> level sources. I read MSDN when I'd like to know something
>> about the Windows API, MSVC, C#, you name it.
>>
>>> Windows-1252 is the standard used at windows application.
>>
>> Exactly, so it's not a standard by my definition.
>>
>> In my terms "standard" means something standardized
>> by an official standardization organization, and the
>> standard being applied/applicable in a wide-range of
>> products from different vendors. Lacking this,
>> "Windows-1252" like above is nothing more than a convention
>> used by a specific product / company, Windows/Microsoft
>> in this case.
>>
>> Harbour is multiplatform, so I suggest others to
>> endorse this kind of approach in context of this project.
>>
>> [ For Windows-only projects (which this isn't), this
>> can be regarded as _the_ "standard" or "quasi-standard",
>> and above lamentation is academic. ]
>>
>> [ BTW, this is one of the areas where Windows/MS did
>> a terrible disservice to the world by introducing / forcing
>> such hacked, proprietary "standards" on them. ]
>>
>>> ISO-8859-1 is the standard used at Linux and html application,
>>> but have a lot of synonyms on different Linux platform. I use it on
>>> my php applications.
>>
>> Being used by Linux and 'html applications' is a
>> consequence of being an official standard, as open
>> source vendors (but not just them) generally prefer
>> these over proprietary ones. It's by no means
>> a "Linux/html standard". It has been standardized
>> by ISO (as Organization), hence the name.
>>
>> Brgds,
>> Viktor
>>
>>
>> __________ Informaci?n de ESET Smart Security, versi?n de la base  
>> de firmas de virus 3591 (20081106) __________
>>
>> ESET Smart Security ha comprobado este mensaje.
>> http://www.eset.com
>>
>>
>>

From rportnoff at spendmap.com  Thu Nov  6 13:23:52 2008
From: rportnoff at spendmap.com (Randy Portnoff)
Date: Thu Nov  6 13:22:23 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats
	(harbour.01 syenar hu)
In-Reply-To: <7B599A17-EA44-4452-83CE-471BB3639341@syenar.hu>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
	<D4DC003A-C5DB-4333-8C3D-14F6363709A9@syenar.hu>
	<49133279.3010706@marchuet.net>
	<7B599A17-EA44-4452-83CE-471BB3639341@syenar.hu>
Message-ID: <B0084838268@ms1.3peaks.com>

Hi Viktor,

Sorry to jump in mid-stream, but my understanding 
is that the Windows-1252 codepage would be 
required for backwards DOS/Cl*pper compatibility - Is that not true?

Regards,
Randy

At 01:14 PM 11/6/2008, you wrote:
>Miguel,
>
>IANA assigns _names_.
>
>This only means that this object what is the non-official
>codepage created by Microsoft, has a standard name
>"Windows-1252" (and not "Win-1252", or "Win1252"). It
>also assures that this name won't be assigned for other
>purposes.
>
>Such names can be used in certain internal protocol.
>
>That's all. The underlying codepage itself, while
>probably something everyone knows, still isn't an
>officially accepted codepage.
>
>[ BTW, I noted this fact in one of my messages. ]
>
>Brgds,
>Viktor
>
>On 2008.11.06., at 19:07, Miguel Angel Marchuet wrote:
>
>>Please read this page:
>>
>>http://en.wikipedia.org/wiki/Windows-1252
>>
>>seem Windows-1252 is aproved too by iana (Internet Assigned Numbers
>>Authority (IANA))
>>
>>What more do you need ?
>>
>>Best regards
>>Miguel Angel Marchuet
>>
>>Szak?ts Viktor escribi?:
>>>
>>>>ormation:
>>>>>>
>>>>>>"Code page name" are to "Char Set" as you see some times are
>>>>>>confused by the alias name, any people can think incorrectly
>>>>>>that iso-8859-1 is the same than windows-1252 but are real
>>>>>>different Char Set
>>>>>Yes, exactly. Very important that ISO-8859-1 is an official
>>>>>standard, while Windows-1252 is not. They are similar, but
>>>>>not the same. I'd think we should encourage everyone to use
>>>>>the ISO standards for best portability.
>>>>
>>>>read MSDN please
>>>
>>>I better like to get generic information from higher
>>>level sources. I read MSDN when I'd like to know something
>>>about the Windows API, MSVC, C#, you name it.
>>>
>>>>Windows-1252 is the standard used at windows application.
>>>
>>>Exactly, so it's not a standard by my definition.
>>>
>>>In my terms "standard" means something standardized
>>>by an official standardization organization, and the
>>>standard being applied/applicable in a wide-range of
>>>products from different vendors. Lacking this,
>>>"Windows-1252" like above is nothing more than a convention
>>>used by a specific product / company, Windows/Microsoft
>>>in this case.
>>>
>>>Harbour is multiplatform, so I suggest others to
>>>endorse this kind of approach in context of this project.
>>>
>>>[ For Windows-only projects (which this isn't), this
>>>can be regarded as _the_ "standard" or "quasi-standard",
>>>and above lamentation is academic. ]
>>>
>>>[ BTW, this is one of the areas where Windows/MS did
>>>a terrible disservice to the world by introducing / forcing
>>>such hacked, proprietary "standards" on them. ]
>>>
>>>>ISO-8859-1 is the standard used at Linux and html application,
>>>>but have a lot of synonyms on different Linux platform. I use it on
>>>>my php applications.
>>>
>>>Being used by Linux and 'html applications' is a
>>>consequence of being an official standard, as open
>>>source vendors (but not just them) generally prefer
>>>these over proprietary ones. It's by no means
>>>a "Linux/html standard". It has been standardized
>>>by ISO (as Organization), hence the name.
>>>
>>>Brgds,
>>>Viktor
>>>
>>>
>>>__________ Informaci?n de ESET Smart Security, versi?n de la base
>>>de firmas de virus 3591 (20081106) __________
>>>
>>>ESET Smart Security ha comprobado este mensaje.
>>>http://www.eset.com
>>>
>>>
>
>_______________________________________________
>Harbour mailing list
>Harbour@harbour-project.org
>http://lists.harbour-project.org/mailman/listinfo/harbour


From harbour.01 at syenar.hu  Thu Nov  6 13:30:56 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 13:31:02 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <B0084838268@ms1.3peaks.com>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
	<D4DC003A-C5DB-4333-8C3D-14F6363709A9@syenar.hu>
	<49133279.3010706@marchuet.net>
	<7B599A17-EA44-4452-83CE-471BB3639341@syenar.hu>
	<B0084838268@ms1.3peaks.com>
Message-ID: <6A00B264-3600-4E8D-B534-FEF2D7B32D5E@syenar.hu>

Hi Randy,

> Hi Viktor,
>
> Sorry to jump in mid-stream, but my understanding is that the  
> Windows-1252 codepage would be required for backwards DOS/Cl*pper  
> compatibility - Is that not true?

No. DOS/Clipper used the 'IBM*' or DOS*/MS-DOS*
codepages, which are also covered in Harbour
(albeit not always with a fully Clipper compatible
collation).

There may be products which used/uses Windows
codepages and we'd like to be compatible with
(like XBase++), but solely for Clipper compatibility,
Windows codepage is not needed.

Nobody get me wrong, I have no problem at
all with Windows codepages being present in
Harbour, all I'm trying to say is that they
don't represent an official standard, and
generally speaking ISO equivalents are a
superior choice.

Brgds,
Viktor

From harbour.01 at syenar.hu  Thu Nov  6 13:59:55 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov  6 14:00:03 2008
Subject: [Harbour] 2008-11-03 11:20 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <7B599A17-EA44-4452-83CE-471BB3639341@syenar.hu>
References: <01c93d9d$Blat.v2.6.2$ebf5da0c$1d908c219382@127.0.0.1>
	<490EF019.9050104@marchuet.net>
	<49635323-0EEE-4D4E-B82E-7DE7FC78D92F@syenar.hu>
	<49100F2A.5080804@marchuet.net>
	<B8DB4989-7C07-4243-B046-9FB3DAE83CCF@syenar.hu>
	<491030C0.20206@marchuet.net>
	<2B111C44-EC1E-401E-95AA-9CF2C43872B0@syenar.hu>
	<4911C489.3020507@marchuet.net>
	<D4DC003A-C5DB-4333-8C3D-14F6363709A9@syenar.hu>
	<49133279.3010706@marchuet.net>
	<7B599A17-EA44-4452-83CE-471BB3639341@syenar.hu>
Message-ID: <68ADCA63-6E46-4694-877E-AAA7E24F5C39@syenar.hu>

To clarify with an analogy, it's the exact same
thing as if IANA granted Harbour exclusive use
for the _function name_ 'HARBOUR_PROJECT()'.
This would allow us to implement whatever
functionality behind it, but the name would be
ours. Similarly to domain names.

Brgds,
Viktor

On 2008.11.06., at 19:14, Szak?ts Viktor wrote:

> Miguel,
>
> IANA assigns _names_.
>
> This only means that this object what is the non-official
> codepage created by Microsoft, has a standard name
> "Windows-1252" (and not "Win-1252", or "Win1252"). It
> also assures that this name won't be assigned for other
> purposes.
>
> Such names can be used in certain internal protocol.
>
> That's all. The underlying codepage itself, while
> probably something everyone knows, still isn't an
> officially accepted codepage.
>
> [ BTW, I noted this fact in one of my messages. ]
>
> Brgds,
> Viktor
>
> On 2008.11.06., at 19:07, Miguel Angel Marchuet wrote:
>
>> Please read this page:
>>
>> http://en.wikipedia.org/wiki/Windows-1252
>>
>> seem Windows-1252 is aproved too by iana (Internet Assigned Numbers  
>> Authority (IANA))
>>
>> What more do you need ?
>>
>> Best regards
>> Miguel Angel Marchuet
>>
>> Szak?ts Viktor escribi?:
>>>
>>>> ormation:
>>>>>>
>>>>>> "Code page name" are to "Char Set" as you see some times are  
>>>>>> confused by the alias name, any people can think incorrectly
>>>>>> that iso-8859-1 is the same than windows-1252 but are real  
>>>>>> different Char Set
>>>>> Yes, exactly. Very important that ISO-8859-1 is an official
>>>>> standard, while Windows-1252 is not. They are similar, but
>>>>> not the same. I'd think we should encourage everyone to use
>>>>> the ISO standards for best portability.
>>>>
>>>> read MSDN please
>>>
>>> I better like to get generic information from higher
>>> level sources. I read MSDN when I'd like to know something
>>> about the Windows API, MSVC, C#, you name it.
>>>
>>>> Windows-1252 is the standard used at windows application.
>>>
>>> Exactly, so it's not a standard by my definition.
>>>
>>> In my terms "standard" means something standardized
>>> by an official standardization organization, and the
>>> standard being applied/applicable in a wide-range of
>>> products from different vendors. Lacking this,
>>> "Windows-1252" like above is nothing more than a convention
>>> used by a specific product / company, Windows/Microsoft
>>> in this case.
>>>
>>> Harbour is multiplatform, so I suggest others to
>>> endorse this kind of approach in context of this project.
>>>
>>> [ For Windows-only projects (which this isn't), this
>>> can be regarded as _the_ "standard" or "quasi-standard",
>>> and above lamentation is academic. ]
>>>
>>> [ BTW, this is one of the areas where Windows/MS did
>>> a terrible disservice to the world by introducing / forcing
>>> such hacked, proprietary "standards" on them. ]
>>>
>>>> ISO-8859-1 is the standard used at Linux and html application,
>>>> but have a lot of synonyms on different Linux platform. I use it on
>>>> my php applications.
>>>
>>> Being used by Linux and 'html applications' is a
>>> consequence of being an official standard, as open
>>> source vendors (but not just them) generally prefer
>>> these over proprietary ones. It's by no means
>>> a "Linux/html standard". It has been standardized
>>> by ISO (as Organization), hence the name.
>>>
>>> Brgds,
>>> Viktor
>>>
>>>
>>> __________ Informaci?n de ESET Smart Security, versi?n de la base  
>>> de firmas de virus 3591 (20081106) __________
>>>
>>> ESET Smart Security ha comprobado este mensaje.
>>> http://www.eset.com
>>>
>>>
>>>
>

From druzus at acn.waw.pl  Thu Nov  6 18:37:09 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov  6 18:36:24 2008
Subject: [Harbour] 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>

2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbwmain.c
    * pacified unused variable warning

  * harbour/include/hbpp.h
  * harbour/source/pp/ppcore.c
    ! do not report #if expression errors in #if PP directives when they are
      in codedis activated by parent #if[def]/#elif/#else. It allows
      to compiler code like:
         #ifdef DEFINE
            #if DEFINE >= 0x100
               ...
            #endif
         #endif
    + added logical expression reduction to not report #if expression errors
      in code like:
         #ifdef DEFINE && DEFINE >= 0x100
            ...
         #endif
    ! fixed possible division by 0error in #if exporessions like #if 1 / 0
      Now #if expression compiler error is generated
    ! restored some bit operators in #if directives wrongly disabled with
      xHarbour stuff

  * harbour/source/vm/hashfunc.c
    % removed unnecessary hb_itemUnRef()

best regards
Przemek
From druzus at acn.waw.pl  Thu Nov  6 18:40:04 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov  6 18:39:19 2008
Subject: [Harbour] 2008-11-07 00:39 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081106234004.GA1926@34-mo7-2.acn.waw.pl>

2008-11-07 00:39 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/ChangeLog
    ! fixed typo in previous ChangeLog entry. Instead of:
         #ifdef DEFINE && DEFINE >= 0x100
      should be:
         #if defined( DEFINE ) .and. DEFINE >= 0x100

best regards
Przemek
From druzus at acn.waw.pl  Thu Nov  6 19:09:11 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov  6 19:08:25 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20081106150336.GA2240@34-mo7-2.acn.waw.pl>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4912D89A.9000003@mail.udg.mx>
	<20081106150336.GA2240@34-mo7-2.acn.waw.pl>
Message-ID: <20081107000911.GA13103@34-mo7-2.acn.waw.pl>

On Thu, 06 Nov 2008, Przemyslaw Czerpak wrote:

Hi David,

> Now we should resolve the problem with creating new threads in OS2
> OpenWatcom() looks that sth is wrong and the problem is not inside
> Harbour but OpenWatcom MT CRTL. Or maybe it's a trivial problem with
> calling convention and expected startup parameters. I can try to add
> workaround and create new thread using only OS2 API but it would be
> good if someone who knows C and uses OS2 will make some tests with
> OS2 OpenWatcom small MT C programs to find real reason.

Please try to compile and link the code below using OS2-OpenWatcom
and send here the results. Maybe it will help us to locate what is
wrong.

best regards,
Przemek


/* ************************************************************ */
#define INCL_DOSSEMAPHORES
#define INCL_DOSPROCESS
#include "hbthread.h"

static HB_THREAD_STARTFUNC( thFunc )
{
   printf( "This is thread function [%p] !!!\n", Cargo );
   HB_THREAD_END
}

int main( void )
{
   HB_THREAD_ID th_id;
   void * Cargo = ( void * ) 0x12345678;

   printf( "Starting thread...\n" );
#if defined( HB_PTHREAD_API )
   if( pthread_create( &th_id, NULL, thFunc, Cargo ) != 0 )
      th_id = ( HB_THREAD_ID ) 0;
#else
   th_id = _beginthread( thFunc, NULL, 128 * 1024, Cargo );
#endif
   printf( "thread id = %p\n", ( void * ) th_id );

#if defined( HB_PTHREAD_API )
   pthread_join( th_id, NULL );
#else
   DosWaitThread( &th_id, DCWW_WAIT );
#endif
   printf( "Done\n" );
   return 0;
}
/* ************************************************************ */
From dmacias at mail.udg.mx  Thu Nov  6 20:17:11 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Thu Nov  6 20:17:06 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49139717.3070304@mail.udg.mx>

Przemek:

 >Please try to compile and link the code below using OS2-OpenWatcom
 >and send here the results. Maybe it will help us to locate what is
 >wrong.

But it seem to be C code and I do not know C and handle with OW  :-)

Well, trying based in make_ow.log, hbrun creation:

- Code saved as pba.c

- Compiling ( after some doc reading, make_ow.log and testing )
[E:\harbour810\harbour]wpp386 pba.c -fo=pba.obj -i=include -bm
Open Watcom C++32 Optimizing Compiler Version 1.7
Portions Copyright (c) 1989-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See http://www.openwatcom.org/ for details.
pba.c: 34 lines, included 20121, no warnings, no errors
Code size: 134

. Linking ( after make_ow.log and testing )
[E:\harbour810\harbour]wlink debug all OP stack=65536 OP CASEEXACT NAME 
pba.exe FILE pba.obj
Open Watcom Linker Version 1.7
Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See http://www.openwatcom.org/ for details.
loading object files
searching libraries
creating an OS/2 32-bit executable

- Running[E:\harbour810\harbour]pba.exe
Starting thread...
This is thread function [12345678] !!!
thread id = 00000002
Done

As I see I made history  :-)

David Macias


From druzus at acn.waw.pl  Thu Nov  6 21:00:18 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov  6 20:59:33 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49139717.3070304@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49139717.3070304@mail.udg.mx>
Message-ID: <20081107020018.GA29197@34-mo7-2.acn.waw.pl>

On Thu, 06 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> But it seem to be C code and I do not know C and handle with OW  :-)
> Well, trying based in make_ow.log, hbrun creation:
> [E:\harbour810\harbour]wpp386 pba.c -fo=pba.obj -i=include -bm
> [E:\harbour810\harbour]wlink debug all OP stack=65536 OP CASEEXACT NAME 
> pba.exe FILE pba.obj

Very good :-) and many thanks.

> - Running[E:\harbour810\harbour]pba.exe
> Starting thread...
> This is thread function [12345678] !!!
> thread id = 00000002
> Done
> As I see I made history  :-)

:-) So this is working correctly.
Now we will have to check where it fails.
I'm attaching modified thread.c file.
Please put it in harbour/source/vm/ directory and rebuild Harbour.
Then try to compile and execute this time .prg code:

   proc main()
      hb_threadJoin( hb_threadStart( @thFunc() ) )
   return
   proc thFunc()
   return
   announce HB_GTSYS
   request HB_GT_STD_DEFAULT

You should C on the screen sth like:

   1. HB_THREADSTART
   3. HB_THREADSTART
   1. hb_threadStartVM
   2. hb_threadStartVM
   3. hb_threadStartVM
   4. hb_threadStartVM
   6. hb_threadStartVM
   7. hb_threadStartVM

for clean execution. I guess it will be interrupted somewhere.

best regards,
Przemek
-------------- next part --------------
A non-text attachment was scrubbed...
Name: thread.c.gz
Type: application/x-gzip
Size: 9180 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081107/4c83ebf2/thread.c-0001.gz
From harbour.01 at syenar.hu  Fri Nov  7 03:27:11 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov  7 03:27:19 2008
Subject: [Harbour] 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
Message-ID: <3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>

Thanks a lot Przemek, I can confirm it works.

Shouldn't we also allow 'DEFINE >= 0x100' in case
DEFINE is not defined, and in this case returning
FALSE?

Brgds,
Viktor

On 2008.11.07., at 0:37, Przemyslaw Czerpak wrote:

> 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>  * harbour/include/hbwmain.c
>    * pacified unused variable warning
>
>  * harbour/include/hbpp.h
>  * harbour/source/pp/ppcore.c
>    ! do not report #if expression errors in #if PP directives when  
> they are
>      in codedis activated by parent #if[def]/#elif/#else. It allows
>      to compiler code like:
>         #ifdef DEFINE
>            #if DEFINE >= 0x100
>               ...
>            #endif
>         #endif
>    + added logical expression reduction to not report #if expression  
> errors
>      in code like:
>         #ifdef DEFINE && DEFINE >= 0x100
>            ...
>         #endif
>    ! fixed possible division by 0error in #if exporessions like #if  
> 1 / 0
>      Now #if expression compiler error is generated
>    ! restored some bit operators in #if directives wrongly disabled  
> with
>      xHarbour stuff
>
>  * harbour/source/vm/hashfunc.c
>    % removed unnecessary hb_itemUnRef()
>
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From dmacias at mail.udg.mx  Fri Nov  7 03:59:56 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Fri Nov  7 03:59:51 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4914038C.1040903@mail.udg.mx>

Przemek:

 >I'm attaching modified thread.c file.
 >Url : 
 >http://lists.harbour-project.org/pipermail/harbour/attachments/20081107/4c83ebf2/thread.c-0001.gz

Checked with WarpZip and Linux-Ark and both confirm: thread.c-0001.gz is 
empty

Can you send me thread.c in zip to my e-mail ?

David Macias


From labitas at gmail.com  Fri Nov  7 04:16:55 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Fri Nov  7 04:16:59 2008
Subject: [Harbour] 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
Message-ID: <2386af1b0811070116h5799c42dv1ed1cffb30cd4d39@mail.gmail.com>

>
> Shouldn't we also allow 'DEFINE >= 0x100' in case
> DEFINE is not defined, and in this case returning
> FALSE?
>

+1

Best regards,
Saulius
From druzus at acn.waw.pl  Fri Nov  7 05:16:43 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 05:15:57 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4914038C.1040903@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4914038C.1040903@mail.udg.mx>
Message-ID: <20081107101643.GA2247@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, David Arturo Macias Corona wrote:

Hi Daivd,

> >I'm attaching modified thread.c file.
> >Url : 
> >http://lists.harbour-project.org/pipermail/harbour/attachments/20081107/4c83ebf2/thread.c-0001.gz
> Checked with WarpZip and Linux-Ark and both confirm: thread.c-0001.gz is 
> empty

Use
   gzip -d thread.c-0001.gz
and
   change the name -0001 is suffix added by mailing list.

> Can you send me thread.c in zip to my e-mail ?

Yes sure,

best regards,
Przemek
From druzus at acn.waw.pl  Fri Nov  7 05:21:31 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 05:20:44 2008
Subject: [Harbour] 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
Message-ID: <20081107102131.GB2247@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Shouldn't we also allow 'DEFINE >= 0x100' in case
> DEFINE is not defined, and in this case returning
> FALSE?

Not all C compilers accept it.
It means that we have to use some arbitrary value for
all undefined identifiers. Usually 0. If it's OK for
you then it's enough to change line 4609 in ppcore.c:
   if( !HB_PP_TOKEN_ISEOC( pToken ) || fUndef )
to:
   if( !HB_PP_TOKEN_ISEOC( pToken ) )

best regards,
Przemek
From fmancera at viaopen.com  Fri Nov  7 05:29:09 2008
From: fmancera at viaopen.com (Fernando Mancera)
Date: Fri Nov  7 05:29:14 2008
Subject: [Harbour] Set.c add functions
In-Reply-To: <20081107102131.GB2247@34-mo7-2.acn.waw.pl>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
	<20081107102131.GB2247@34-mo7-2.acn.waw.pl>
Message-ID: <000001c940c3$accb8830$06629890$@com>

Hello Everybody,

Do we can add the following functions to Set.C?

 hb_setSetDecimals (), hb_setSetEpoch (), hb_setSetFixed () like there is the function Get / Set Century?

Regards,

Fernando Mancera
www.viaopen.com

 

__________ Information from ESET NOD32 Antivirus, version of virus signature database 3593 (20081107) __________

The message was checked by ESET NOD32 Antivirus.

http://www.eset.com
 

From druzus at acn.waw.pl  Fri Nov  7 06:21:22 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 06:20:36 2008
Subject: [Harbour] Set.c add functions
In-Reply-To: <000001c940c3$accb8830$06629890$@com>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
	<20081107102131.GB2247@34-mo7-2.acn.waw.pl>
	<000001c940c3$accb8830$06629890$@com>
Message-ID: <20081107112122.GA26027@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, Fernando Mancera wrote:

Hi Fernando,

> Do we can add the following functions to Set.C?
>  hb_setSetDecimals (), hb_setSetEpoch (), hb_setSetFixed () like there
> is the function Get / Set Century?

hb_setSetCentury() is specific function because it cannot be changed
by SET() function because there is no _SET_SETCENTURY so it needs
separate function to change its value.
_SET_DECIMALS, _SET_EPOCH, _SET_FIXED exist so they should be changed
by hb_setSetItem() function. Now only _SET_FIXED is supported by this
function and _SET_DECIMALS and _SET_EPOCH are marked as TODO. Just
like few others _SET_* values. I'll add support for both in a while.
Maybe someone can help in implementing rest?

         /* TODO */
         case HB_SET_AUTORDER:
         case HB_SET_AUTOSHARE:
         case HB_SET_COLOR:
         case HB_SET_CURSOR:
         case HB_SET_DATEFORMAT:
         case HB_SET_DEFAULT:
         case HB_SET_DELIMCHARS:
         case HB_SET_DEVICE:
         case HB_SET_EVENTMASK:
         case HB_SET_MARGIN:
         case HB_SET_MESSAGE:
         case HB_SET_PATH:
         case HB_SET_TYPEAHEAD:
         case HB_SET_VIDEOMODE:
         case HB_SET_LANGUAGE:
         case HB_SET_CODEPAGE:
         case HB_SET_FILECASE:
         case HB_SET_DIRCASE:
         case HB_SET_DIRSEPARATOR:
         case HB_SET_EOL:
         case HB_SET_HBOUTLOG:
         case HB_SET_HBOUTLOGINFO:

For:
         case HB_SET_ALTFILE:
         case HB_SET_EXTRAFILE:
         case HB_SET_PRINTFILE:
We will need hb_setSetItem2() because they need two parameters.
I'll add it.

When both functions will be ready we can change SET() function to use
internally hb_setSetItem[2]() and move its whole body to RTL.

best regards,
Przemek
From dmacias at mail.udg.mx  Fri Nov  7 06:25:13 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Fri Nov  7 06:25:07 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49142599.5030803@mail.udg.mx>

Przemek:

 >:-) So this is working correctly.
 >Now we will have to check where it fails.
 >I'm attaching modified thread.c file.
 >Please put it in harbour/source/vm/ directory and rebuild Harbour.
 >Then try to compile and execute this time .prg code:

 >   proc main()
 >      hb_threadJoin( hb_threadStart( @thFunc() ) )
 >   return
 >   proc thFunc()
 >   return
 >   announce HB_GTSYS
 >   request HB_GT_STD_DEFAULT

 >You should C on the screen sth like:

 >   1. HB_THREADSTART
 >   3. HB_THREADSTART
 >   1. hb_threadStartVM
 >   2. hb_threadStartVM
 >   3. hb_threadStartVM
 >   4. hb_threadStartVM
 >   6. hb_threadStartVM
 >   7. hb_threadStartVM

 >for clean execution. I guess it will be interrupted somewhere.

Using -bm flag and hbvmmt

-------------------
1. HB_THREADSTART
1. hb_threadStartVM
3. HB_THREADSTART
2. hb_threadStartVM
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-------------------

David Macias


From druzus at acn.waw.pl  Fri Nov  7 07:02:27 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 07:01:41 2008
Subject: [Harbour] 2008-11-07 13:01 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081107120227.GA23804@34-mo7-2.acn.waw.pl>

2008-11-07 13:01 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbset.h
  * harbour/source/vm/set.c
    + added hb_setSetItem2() C function for SETs which needs two parameters
    + added support for HB_SET_DECIMALS and HB_SET_EPOCH in hb_setSetItem()
      Still 22 SETs are marked as TODO
    + added internal function hb_setSetFile() for HB_SET_ALTFILE,
      HB_SET_EXTRAFILE, HB_SET_PRINTFILE - function body marked as TODO.
      I'll implement it later.

best regards
Przemek
From druzus at acn.waw.pl  Fri Nov  7 07:14:49 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 07:14:02 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49142599.5030803@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49142599.5030803@mail.udg.mx>
Message-ID: <20081107121449.GA25062@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Using -bm flag and hbvmmt
> -------------------
> 1. HB_THREADSTART
> 1. hb_threadStartVM
> 3. HB_THREADSTART
> 2. hb_threadStartVM
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> -------------------

Thank you. Looks that is fails not 1-st memory allocation or TLS
access.
So now next step. Please replace hb_stackInit() function
in source/vm/estack.c with this code:

void hb_stackInit( void )
{
   HB_TRACE(HB_TR_DEBUG, ("hb_stackInit()"));

   printf("1. hb_stackInit()\n");fflush(stdout);
#if defined( HB_MT_VM )
   hb_stack_alloc();
#endif
   printf("2. hb_stackInit()\n");fflush(stdout);
   {
      HB_STACK_TLS_PRELOAD
      printf("3. hb_stackInit()\n");fflush(stdout);
      printf("4. hb_stackInit(%p)\n", &hb_stack);fflush(stdout);
      hb_stack_init( &hb_stack );
      printf("5. hb_stackInit()\n");fflush(stdout);
   }
}

then rebuild Harbour (you do not need clean build) and the same .prg
code.

best regards,
Przemek
From druzus at acn.waw.pl  Fri Nov  7 07:26:32 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 07:25:46 2008
Subject: [Harbour] Set.c add functions
In-Reply-To: <000101c940cc$190edbc0$4b2c9340$@com>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
	<20081107102131.GB2247@34-mo7-2.acn.waw.pl>
	<000001c940c3$accb8830$06629890$@com>
	<20081107112122.GA26027@34-mo7-2.acn.waw.pl>
	<000101c940cc$190edbc0$4b2c9340$@com>
Message-ID: <20081107122632.GB25062@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, Fernando Mancera wrote:

Hi Fernando,

> I think is usefull have functions for change set values from C Source Code.
> HB_FUNC( CHANGESETVALUE )
> {
> 	Hb_setSetDateFormat( ( char * ) hb_parc( 1 ) )
> }
> Is possible ?? or we need use item api ??

It's possible (to be precise will be possible when missing 22 SETs in
hb_setSetItem() will be implemented by:
   hb_setSetItem( HB_SET_DATEFORMAT, hb_param( 1, HB_IT_ANY ) );

If someone will be interest then and implement:
   BOOL hb_setSetL( HB_set_enum, BOOL );
   BOOL hb_setSetNI( HB_set_enum, int );
   BOOL hb_setSetNL( HB_set_enum, LONG );
   BOOL hb_setSetCPtr( HB_set_enum, const char * );
then we can also add them to SVN.

best regards,
Przemek
From dmacias at mail.udg.mx  Fri Nov  7 07:32:54 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Fri Nov  7 07:33:00 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49143576.7090004@mail.udg.mx>

Przemek:

 >Thank you. Looks that is fails not 1-st memory allocation or TLS
 >access.
 >So now next step. Please replace hb_stackInit() function
 >in source/vm/estack.c with this code:

 >void hb_stackInit( void )
 >{
 >   HB_TRACE(HB_TR_DEBUG, ("hb_stackInit()"));
 >   printf("1. hb_stackInit()\n");fflush(stdout);
 >#if defined( HB_MT_VM )
 >   hb_stack_alloc();
 >#endif
 >   printf("2. hb_stackInit()\n");fflush(stdout);
 >   {
 >      HB_STACK_TLS_PRELOAD
 >      printf("3. hb_stackInit()\n");fflush(stdout);
 >      printf("4. hb_stackInit(%p)\n", &hb_stack);fflush(stdout);
 >      hb_stack_init( &hb_stack );
 >      printf("5. hb_stackInit()\n");fflush(stdout);
 >   }
 >}

 >then rebuild Harbour (you do not need clean build) and the same .prg
 >code.

Using -bm flag and hbvmmt

-------------------
1. hb_stackInit()
2. hb_stackInit()
3. hb_stackInit()
4. hb_stackInit(00130034)
5. hb_stackInit()
1. HB_THREADSTART
1. hb_threadStartVM
3. HB_THREADSTART
2. hb_threadStartVM
1. hb_stackInit()
                  2. hb_stackInit()
                                   3. hb_stackInit()
                                                    4. 
hb_stackInit(00170274)
 
      5. hb_stackInit()
              SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-------------------

David Macias



From mbelgrano at deltain.it  Fri Nov  7 07:53:24 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Fri Nov  7 07:54:22 2008
Subject: [Harbour] multiplatform GUI
In-Reply-To: <BLU149-W10B52A725F2D35691A82C6851E0@phx.gbl>
References: <BLU149-W10B52A725F2D35691A82C6851E0@phx.gbl>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F158@SRV02.deltain.net>

Intresting
Good look for application (particularly to be multiplatform) FOX looks much like Windows
FOX stands for Free Objects for X. It is a C++ based class library for building GUI. , developed for LINUX, but completely platform independent, 
One of sample is adie a  text editor written using the FOX Toolki

Have you worked with harbour?
Do you know if exist a language binding for harbour


From: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] On Behalf Of Alejandro de Garate
Sent: Thursday, November 06, 2008 4:15 PM
To: harbour@harbour-project.org
Subject: [Harbour] multiplatform GUI


Some time ago I made some basic test using the?FOX toolkit?and?BCC 551 on win 98 /2000, 
the same?code with GCC and DEBIAN?and it works quite well.
?
The library is wrote in C++, all the source code is provided (GPL)?and not require additional headers or libraries.
?
I never have time to investigate in depth but if?someone want to?give a look go to??www.fox-toolkit.org
?
Alejandro
________________________________________
Get news, entertainment and everything you care about at Live.com. Check it out!
From druzus at acn.waw.pl  Fri Nov  7 08:04:12 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 08:03:27 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49143576.7090004@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49143576.7090004@mail.udg.mx>
Message-ID: <20081107130412.GA626@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Using -bm flag and hbvmmt
> -------------------
> 1. hb_stackInit()
> 2. hb_stackInit()
> 3. hb_stackInit()
> 4. hb_stackInit(00130034)
> 5. hb_stackInit()
> 1. HB_THREADSTART
> 1. hb_threadStartVM
> 3. HB_THREADSTART
> 2. hb_threadStartVM
> 1. hb_stackInit()
>                  2. hb_stackInit()
>                                   3. hb_stackInit()
>                                                    4. 
> hb_stackInit(00170274)
>
>      5. hb_stackInit()
>              SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.

Thank you.
Memory allocation and TLS initialization is correct.
Please restore original estack.c and replace hb_vmThreadInit()
in hvm.c with the code below and repeat the test. My next
candidate is crash after:
   3. hb_vmThreadInit()

best regards,
Przemek


HB_EXPORT void hb_vmThreadInit( void * Cargo )
{
   PHB_THREADSTATE pState;

   HB_TRACE(HB_TR_DEBUG, ("hb_vmThreadInit(%p)", Cargo));

   pState = ( PHB_THREADSTATE ) Cargo;
   if( !pState )
      pState = hb_threadStateNew();

   printf( "1. hb_vmThreadInit()\n\r" );fflush(stdout);
   hb_vmStackInit( pState );  /* initialize HVM thread stack */
   {
      HB_STACK_TLS_PRELOAD

      printf( "2. hb_vmThreadInit()\n\r" );fflush(stdout);
      hb_cdpSelectID( pState->pszCDP );
      hb_langSelectID( pState->pszLang );

      if( pState->pSet )
      {
         /* TODO: add set sharing */
         memcpy( hb_stackSetStruct(), pState->pSet, sizeof( HB_SET_STRUCT ) );
         hb_xfree( pState->pSet );
         pState->pSet = NULL;
      }
      else
         hb_setInitialize( hb_stackSetStruct() );

      printf( "3. hb_vmThreadInit()\n\r" );fflush(stdout);
      hb_gtAttach( pState->hGT );
      pState->hGT = NULL;
      printf( "4. hb_vmThreadInit()\n\r" );fflush(stdout);

      if( pState->pszDefRDD )
         hb_stackRDD()->szDefaultRDD = pState->pszDefRDD;

      if( s_fHVMActive )
      {
         /* call CLIPINIT function to initialize GetList PUBLIC variables
          * ErrorBlock() and __SetHelpK()
          */
         hb_vmDoInitClip();
      }

      printf( "5. hb_vmThreadInit()\n\r" );fflush(stdout);
      if( pState->pMemvars )
      {
         hb_memvarRestoreFromArray( pState->pMemvars );
         hb_itemRelease( pState->pMemvars );
         pState->pMemvars = NULL;
      }
      printf( "6. hb_vmThreadInit()\n\r" );fflush(stdout);
   }
}
From druzus at acn.waw.pl  Fri Nov  7 08:20:01 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 08:19:14 2008
Subject: [Harbour] 2008-11-07 14:19 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081107132001.GA22851@34-mo7-2.acn.waw.pl>

2008-11-07 14:19 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/vm/set.c
    + finished hb_setSetFile() used internally for HB_SET_ALTFILE,
      HB_SET_EXTRAFILE, HB_SET_PRINTFILE

best regards
Przemek
From dmacias at mail.udg.mx  Fri Nov  7 08:35:17 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Fri Nov  7 08:35:11 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49144415.60500@mail.udg.mx>

Przemek:

 >Thank you.
 >Memory allocation and TLS initialization is correct.
 >Please restore original estack.c and replace hb_vmThreadInit()
 >in hvm.c with the code below and repeat the test. My next
 >candidate is crash after:
 >   3. hb_vmThreadInit()

Using -bm flag and hbvmmt

-------------------
1. HB_THREADSTART
1. hb_threadStartVM
3. HB_THREADSTART
2. hb_threadStartVM
1. hb_vmThreadInit()
2. hb_vmThreadInit()
3. hb_vmThreadInit()
4. hb_vmThreadInit()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-------------------

David Macias




From M.Horodyski at pzuzycie.com.pl  Fri Nov  7 08:59:25 2008
From: M.Horodyski at pzuzycie.com.pl (Horodyski Marek (PZUZ))
Date: Fri Nov  7 08:59:34 2008
Subject: [Harbour] Watcom and WIn32
In-Reply-To: <NLB01FEiu3fQtYdVzDp00016b20@gatein.pzuzycie.com.pl>
Message-ID: <FFAFD6EA63A3FC4784FBDA52BE7A7C95018AE511@PINK.zycie.pzu>

How I try make harbour with OpenWatcom 1.7 ?
In make_gnu.bat is call make.exe, but watcom has nMake.
With change name make program too not work.

Regards,
Marek Horodyski
From druzus at acn.waw.pl  Fri Nov  7 09:08:56 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 09:08:11 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49144415.60500@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49144415.60500@mail.udg.mx>
Message-ID: <20081107140856.GA478@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Using -bm flag and hbvmmt
> -------------------
> 1. HB_THREADSTART
> 1. hb_threadStartVM
> 3. HB_THREADSTART
> 2. hb_threadStartVM
> 1. hb_vmThreadInit()
> 2. hb_vmThreadInit()
> 3. hb_vmThreadInit()
> 4. hb_vmThreadInit()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.

Thanks. Next one is hb_vmDoInitClip() in hvm.c:
Please try.

best regards,
Przemek


static void hb_vmDoInitClip( void )
{
   PHB_DYNS pDynSym = hb_dynsymFind( "CLIPINIT" );

   printf( "1. hb_vmDoInitClip()\n\r" );fflush(stdout);
   if( pDynSym && pDynSym->pSymbol->value.pFunPtr )
   {
      hb_vmPushSymbol( pDynSym->pSymbol );
      hb_vmPushNil();
      printf( "2. hb_vmDoInitClip()\n\r" );fflush(stdout);
      hb_inkeyPoll();
      printf( "3. hb_vmDoInitClip()\n\r" );fflush(stdout);
      hb_vmDo( 0 );
      printf( "4. hb_vmDoInitClip()\n\r" );fflush(stdout);
   }
}
From dmacias at mail.udg.mx  Fri Nov  7 09:20:05 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Fri Nov  7 09:19:59 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49144E95.5080701@mail.udg.mx>

Przemek:

Take note: I changed C code myself   :-)

I added 4a, 4b, 4c, 4d:
----------------
       printf( "4. hb_vmThreadInit()\n\r" );fflush(stdout);

       if( pState->pszDefRDD )
          printf( "4a. hb_vmThreadInit()\n\r" );fflush(stdout);
          hb_stackRDD()->szDefaultRDD = pState->pszDefRDD;
          printf( "4b. hb_vmThreadInit()\n\r" );fflush(stdout);

       if( s_fHVMActive )
       {
          /* call CLIPINIT function to initialize GetList PUBLIC variables
           * ErrorBlock() and __SetHelpK()
           */
          printf( "4c. hb_vmThreadInit()\n\r" );fflush(stdout);
          hb_vmDoInitClip();
          printf( "4d. hb_vmThreadInit()\n\r" );fflush(stdout);
       }

       printf( "5. hb_vmThreadInit()\n\r" );fflush(stdout);
----------------

Using -bm flag and hbvmmt

-------------------
1. HB_THREADSTART
1. hb_threadStartVM
3. HB_THREADSTART
2. hb_threadStartVM
1. hb_vmThreadInit()
2. hb_vmThreadInit()
3. hb_vmThreadInit()
4. hb_vmThreadInit()
4b. hb_vmThreadInit()
4c. hb_vmThreadInit()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-------------------

Seem to be:
   hb_vmDoInitClip();

... and is some pass in hb_vmDo( 0 );

-----------------------
/* call CLIPINIT function to initialize ErrorBlock() and __SetHelpK() */
static void hb_vmDoInitClip( void )
{
    printf( "1. hb_vmDoInitClip()\n\r" );fflush(stdout);
    PHB_DYNS pDynSym = hb_dynsymFind( "CLIPINIT" );
    printf( "2. hb_vmDoInitClip()\n\r" );fflush(stdout);

    if( pDynSym && pDynSym->pSymbol->value.pFunPtr )
    {
       printf( "3. hb_vmDoInitClip()\n\r" );fflush(stdout);
       hb_vmPushSymbol( pDynSym->pSymbol );
       printf( "4. hb_vmDoInitClip()\n\r" );fflush(stdout);
       hb_vmPushNil();
       printf( "5. hb_vmDoInitClip()\n\r" );fflush(stdout);
       hb_vmDo( 0 );
       printf( "6. hb_vmDoInitClip()\n\r" );fflush(stdout);
    }
}
-----------------------

-------------------
1. hb_vmDoInitClip()
2. hb_vmDoInitClip()
3. hb_vmDoInitClip()
4. hb_vmDoInitClip()
5. hb_vmDoInitClip()
6. hb_vmDoInitClip()
1. HB_THREADSTART
1. hb_threadStartVM
2. hb_threadStartVM
1. hb_vmThreadInit()
2. hb_vmThreadInit()
3. hb_vmThreadInit()
4. hb_vmThreadInit()
4b. hb_vmThreadInit()
4c. hb_vmThreadInit()
1. hb_vmDoInitClip()
2. hb_vmDoInitClip()
3. hb_vmDoInitClip()
4. hb_vmDoInitClip()
5. hb_vmDoInitClip()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-------------------


... and is some pass in HB_VM_EXECUTE( pSym );

-------------------
HB_EXPORT void hb_vmDo( USHORT uiParams )
{
    printf( "1. hb_vmDo()\n\r" );fflush(stdout);
    HB_STACK_TLS_PRELOAD
    HB_STACK_STATE sStackState;
    printf( "2. hb_vmDo()\n\r" );fflush(stdout);
    PHB_SYMB pSym;
    printf( "3. hb_vmDo()\n\r" );fflush(stdout);
    PHB_ITEM pSelf;
    printf( "4. hb_vmDo()\n\r" );fflush(stdout);
#ifndef HB_NO_PROFILER
    ULONG ulClock = 0;
    BOOL bProfiler = hb_bProfiler; /* because profiler state may change */
    printf( "5. hb_vmDo()\n\r" );fflush(stdout);
#endif

    HB_TRACE(HB_TR_DEBUG, ("hb_vmDo(%hu)", uiParams));

#ifndef HB_NO_PROFILER
    if( bProfiler )
       ulClock = ( ULONG ) clock();
#endif

    /* Poll the console keyboard
    #if !defined( HB_GUI )
       hb_inkeyPoll();
    #endif
    */

    printf( "6. hb_vmDo()\n\r" );fflush(stdout);

    pSym = hb_stackNewFrame( &sStackState, uiParams )->item.asSymbol.value;
    pSelf = hb_stackSelfItem();   /* NIL, OBJECT or BLOCK */

    printf( "7. hb_vmDo()\n\r" );fflush(stdout);

    if( ! HB_IS_NIL( pSelf ) ) /* are we sending a message ? */
    {
       PHB_SYMB pExecSym;

       printf( "8. hb_vmDo()\n\r" );fflush(stdout);

       pExecSym = hb_objGetMethod( pSelf, pSym, &sStackState );

       printf( "9. hb_vmDo()\n\r" );fflush(stdout);

       if( pExecSym )
          printf( "10. hb_vmDo()\n\r" );fflush(stdout);
          HB_VM_FUNCUNREF( pExecSym );
          printf( "11. hb_vmDo()\n\r" );fflush(stdout);
       if( pExecSym && HB_VM_ISFUNC( pExecSym ) )
       {
          HB_TRACE_PRG(("Calling: %s:%s", hb_objGetClsName( pSelf ), 
pSym->szName));

          printf( "12. hb_vmDo()\n\r" );fflush(stdout);
          HB_VM_EXECUTE( pExecSym );

          printf( "13. hb_vmDo()\n\r" );fflush(stdout);

#ifndef HB_NO_PROFILER
          if( bProfiler )
             hb_mthAddTime( clock() - ulClock );
#endif
       }
       else if( pSym->szName[ 0 ] == '_' )
          hb_errRT_BASE_SubstR( EG_NOVARMETHOD, 1005, NULL, pSym->szName 
+ 1, HB_ERR_ARGS_SELFPARAMS );
       else
          hb_errRT_BASE_SubstR( EG_NOMETHOD, 1004, NULL, pSym->szName, 
HB_ERR_ARGS_SELFPARAMS );
    }
    else /* it is a function */
    {
       printf( "14. hb_vmDo()\n\r" );fflush(stdout);
       HB_VM_FUNCUNREF( pSym );
       printf( "15. hb_vmDo()\n\r" );fflush(stdout);
       if( HB_VM_ISFUNC( pSym ) )
       {
          HB_TRACE_PRG(("Calling: %s", pSym->szName));

#ifndef HB_NO_PROFILER
          if( bProfiler && pSym->pDynSym )
             pSym->pDynSym->ulRecurse++;
#endif

          printf( "16. hb_vmDo()\n\r" );fflush(stdout);
          HB_VM_EXECUTE( pSym );
          printf( "17. hb_vmDo()\n\r" );fflush(stdout);

#ifndef HB_NO_PROFILER
          if( bProfiler && pSym->pDynSym )
          {
             pSym->pDynSym->ulCalls++;                   /* profiler 
support */
             /* Time spent has to be added only inside topmost call of a 
recursive function */
             if( --pSym->pDynSym->ulRecurse == 0 )
                pSym->pDynSym->ulTime += clock() - ulClock; /* profiler 
support */
          }
#endif
       }
       else
          hb_errRT_BASE_SubstR( EG_NOFUNC, 1001, NULL, pSym->szName, 
HB_ERR_ARGS_BASEPARAMS );
    }

#ifndef HB_NO_DEBUG
    if( sStackState.fDebugging )
       hb_vmDebuggerEndProc();
#endif

    printf( "18. hb_vmDo()\n\r" );fflush(stdout);

    hb_stackOldFrame( &sStackState );
}
-------------------

------------------
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()
17. hb_vmDo()
18. hb_vmDo()
1. hb_vmDoInitClip()
2. hb_vmDoInitClip()
3. hb_vmDoInitClip()
4. hb_vmDoInitClip()
5. hb_vmDoInitClip()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()   <-- note 18 ?
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()
17. hb_vmDo()
18. hb_vmDo()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()   <-- note 18 ?
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()
17. hb_vmDo()   <-- note
18. hb_vmDo()
17. hb_vmDo()   <-- note
18. hb_vmDo()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()
17. hb_vmDo()   <-- note
18. hb_vmDo()
17. hb_vmDo()   <-- note
18. hb_vmDo()
6. hb_vmDoInitClip()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()
17. hb_vmDo()
18. hb_vmDo()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()
17. hb_vmDo()
18. hb_vmDo()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()
17. hb_vmDo()
18. hb_vmDo()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()
17. hb_vmDo()
18. hb_vmDo()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()   <-- note 18 ?
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()   <-- note 18 ?
1. HB_THREADSTART
1. hb_threadStartVM
2. hb_threadStartVM
1. hb_vmThreadInit()
2. hb_vmThreadInit()
3. hb_vmThreadInit()
4. hb_vmThreadInit()
4b. hb_vmThreadInit()
4c. hb_vmThreadInit()
1. hb_vmDoInitClip()
2. hb_vmDoInitClip()
3. hb_vmDoInitClip()
4. hb_vmDoInitClip()
5. hb_vmDoInitClip()
1. hb_vmDo()
2. hb_vmDo()
3. hb_vmDo()
4. hb_vmDo()
6. hb_vmDo()
7. hb_vmDo()
14. hb_vmDo()
15. hb_vmDo()
16. hb_vmDo()   <-- note 18 ?
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-------------------


David Macias


From dmacias at mail.udg.mx  Fri Nov  7 09:26:58 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Fri Nov  7 09:26:52 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49145032.6050202@mail.udg.mx>

Przemek:

Somebody tested Harbour / OpenWatcom 1.7 in Windows ?

Perhaps have the same problem of OS/2 and if so it will be very easy to 
test in your environment

David Macias


From druzus at acn.waw.pl  Fri Nov  7 09:47:35 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 09:46:49 2008
Subject: [Harbour] Watcom and WIn32
In-Reply-To: <FFAFD6EA63A3FC4784FBDA52BE7A7C95018AE511@PINK.zycie.pzu>
References: <NLB01FEiu3fQtYdVzDp00016b20@gatein.pzuzycie.com.pl>
	<FFAFD6EA63A3FC4784FBDA52BE7A7C95018AE511@PINK.zycie.pzu>
Message-ID: <20081107144735.GA9132@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, Horodyski Marek (PZUZ) wrote:

Hi Marek.

> How I try make harbour with OpenWatcom 1.7 ?
> In make_gnu.bat is call make.exe, but watcom has nMake.
> With change name make program too not work.

Install GNU make for Win32.

best regards,
Przemek
From druzus at acn.waw.pl  Fri Nov  7 10:19:33 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 10:18:46 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49145032.6050202@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49145032.6050202@mail.udg.mx>
Message-ID: <20081107151933.GA30209@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Somebody tested Harbour / OpenWatcom 1.7 in Windows ?

I'm build systematically MS-Windows OpenWatcom 1.2 binaries
in Linux using WINE and MT mode is working without any problems.

> Perhaps have the same problem of OS/2 and if so it will be very easy to 
> test in your environment

The Windows version is working correctly. At least for me using OW1.2
with Wine. Later I'll install new OW1.7 and check but I do not expect
problems. It's probably sth local to OS2 builds.

best regards,
Przemek
From M.Horodyski at pzuzycie.com.pl  Fri Nov  7 10:32:14 2008
From: M.Horodyski at pzuzycie.com.pl (Horodyski Marek (PZUZ))
Date: Fri Nov  7 10:32:22 2008
Subject: [Harbour] RE: Harbour Digest, Vol 25, Issue 37
In-Reply-To: <NLB01FEpJm8OtprR0E600016fe0@gatein.pzuzycie.com.pl>
Message-ID: <FFAFD6EA63A3FC4784FBDA52BE7A7C95018AE558@PINK.zycie.pzu>

>Date: Fri, 07 Nov 2008 08:26:58 -0600
>From: David Arturo Macias Corona <dmacias@mail.udg.mx>
>Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
>To: harbour@harbour-project.org
>Message-ID: <49145032.6050202@mail.udg.mx>
>Content-Type: text/plain; charset=windows-1252; format=flowed
>
>Przemek:
>
>Somebody tested Harbour / OpenWatcom 1.7 in Windows ?
>
>Perhaps have the same problem of OS/2 and if so it will be 
>very easy to test in your environment
>
>David Macias

I can. But now I have 7days holiday.

Regards,
Marek Horodyski
From druzus at acn.waw.pl  Fri Nov  7 10:45:30 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 10:44:42 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49144E95.5080701@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49144E95.5080701@mail.udg.mx>
Message-ID: <20081107154530.GB30209@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Take note: I changed C code myself   :-)

Thanks :-)

[...]
> 14. hb_vmDo()
> 15. hb_vmDo()
> 16. hb_vmDo()   <-- note 18 ?
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.

So it will crashes inside hb_vmExecute()
Please try to commenct line 1127 in hvm.c
         hb_inkeyPoll();
to eliminate yet another possibly danger place and make test.
Farther tracing using this methods will not be effective.
hb_vmExecute() operates on too many functions.
It will be necessary to use OpenWatcom debugger or enable
Harbour tracing. Please look at doc/tracing.txt.
It's not MT fully safe so some line numbers and/or file names
can be wrong but rest should be correct and enough of us. Of
course if fileio in MT safe in OpenWatcom.
Recompile Harbour using HB_TR_LEVEL_DEBUG macro. Make
   set C_USR=-DHB_TR_LEVEL_DEBUG
and rebuild Harbour and test code.
Then before you execute test application make:
  set HB_TR_LEVEL=HB_TR_DEBUG
  set HB_TR_FLUSH=1
  set HB_TR_OUTPUT=trace.log

It should generate trace.log file with called functions.
Please compress this file and send it to my private e-mail.

best regards,
Przemek
From harbour.01 at syenar.hu  Fri Nov  7 11:54:36 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov  7 11:54:37 2008
Subject: [Harbour] 2008-11-07 17:48 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c940f9$Blat.v2.6.2$83e032b4$15e0f715dce0@127.0.0.1>

2008-11-07 17:48 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * bin/hbmk.bat
    + Added support for 'owatcom' as HB_COMPILER.
    ; NOTE: If there are no objections I'll remove Harbour 
            support for 'watcom' HB_COMPILER, which was 
            used for old non-opensource version of this 
            compiler, but I guess it doesn't make too much 
            sense having them anymore.

  * source/common/hbverdsp.c
    * Minor change in /build output.

  * include/hbver.ch
  * source/rtl/version.c
    * Changed ordering of parameter constants to make more sense.

  * bin/hbmk.bat
  * config/w32/owatcom.cf
    * Removed 'debug all' linker option to make executable sizes 
      significantly smaller by default. If you need debug info, 
      use 'L_USR=debug all'.
    ; NOTE: I'd suggest doing the same for other platform supported 
            by owatcom. If there are no objections I can do this.

  * source/rtl/gtwvt/gtwvt.c
    * Typo, minor formatting.

--
Brgds,
Viktor

From druzus at acn.waw.pl  Fri Nov  7 12:44:21 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov  7 12:43:33 2008
Subject: [Harbour] 2008-11-07 17:48 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c940f9$Blat.v2.6.2$83e032b4$15e0f715dce0@127.0.0.1>
References: <01c940f9$Blat.v2.6.2$83e032b4$15e0f715dce0@127.0.0.1>
Message-ID: <20081107174421.GA30317@34-mo7-2.acn.waw.pl>

On Fri, 07 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>   * config/w32/owatcom.cf
>     * Removed 'debug all' linker option to make executable sizes 
>       significantly smaller by default. If you need debug info, 
>       use 'L_USR=debug all'.
>     ; NOTE: I'd suggest doing the same for other platform supported 
>             by owatcom. If there are no objections I can do this.

Removing debug information from final binaries can be done in any
moment by 'wstrip' so this is not a real problem for users. BTW support
for L_USR you should add to owatcom.cf because now it does not exists
because owatcom.cf define its own LD_RULE.
More important is debug information enabled during compilation. Some
compiler does not produce the same code when debug is enabled and does
not use all optimizations. AFAIK only GCC generates fully separated
debug information without any impact on generated code and it can be
fully and cleanly removed by strip.
To disable debug information in OpenWatcom build remove -d? (-d1) switch
from CPPFLAGS or change it to -d0. C_USR is working here.
I think that you can sync it with other platforms but do not forget
about adding L_USR support if LD_RULE is redefined.

best regards,
Przemek
From harbour.01 at syenar.hu  Fri Nov  7 12:57:12 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov  7 12:57:21 2008
Subject: [Harbour] 2008-11-07 17:48 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081107174421.GA30317@34-mo7-2.acn.waw.pl>
References: <01c940f9$Blat.v2.6.2$83e032b4$15e0f715dce0@127.0.0.1>
	<20081107174421.GA30317@34-mo7-2.acn.waw.pl>
Message-ID: <43D1B4DF-F1D6-45E5-AC0F-F9A564CB53CE@syenar.hu>

Hi Przemek,

>>  * config/w32/owatcom.cf
>>    * Removed 'debug all' linker option to make executable sizes
>>      significantly smaller by default. If you need debug info,
>>      use 'L_USR=debug all'.
>>    ; NOTE: I'd suggest doing the same for other platform supported
>>            by owatcom. If there are no objections I can do this.
>
> Removing debug information from final binaries can be done in any
> moment by 'wstrip' so this is not a real problem for users. BTW  
> support

It was a problem to solve for builders because special
logic was needed for the watcom make files to strip
debug info, which would be better to be avoided. Plus
we have debug off as default for other compilers. Didn't
know about wstrip, thanks for it, I've used GNU strip
which worked well on watcom executables.

If someone has the time for it, it would be certainly
nice to see HB_BUILD_DEBUG=yes (or equivalent) in GNU
make files, too.

> for L_USR you should add to owatcom.cf because now it does not exists
> because owatcom.cf define its own LD_RULE.

Okay.

> More important is debug information enabled during compilation. Some
> compiler does not produce the same code when debug is enabled and does
> not use all optimizations. AFAIK only GCC generates fully separated
> debug information without any impact on generated code and it can be
> fully and cleanly removed by strip.

Nice solution from GCC.

> To disable debug information in OpenWatcom build remove -d? (-d1)  
> switch
> from CPPFLAGS or change it to -d0. C_USR is working here.
> I think that you can sync it with other platforms but do not forget
> about adding L_USR support if LD_RULE is redefined.

Thanks for this info, I'll do it ASAP.

What's you opinion on removing old 'HB_COMPILER=watcom' support?

Brgds,
Viktor

From harbour.01 at syenar.hu  Fri Nov  7 13:03:42 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov  7 13:03:45 2008
Subject: [Harbour] 2008-11-07 19:02 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94103$Blat.v2.6.2$2b66a7a8$12e8ac4f422e@127.0.0.1>

2008-11-07 19:02 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/gtwvt/gtwvt.c
    * Formatting.

  * config/w32/owatcom.cf
    * Added support for L_USR in link options.
    * Removed debug switch -d2 from compiler command line.
      For debug builds 'C_USR=-d2' and 'L_USR=debug all' 
      should be added.

  ; Untested.
--
Brgds,
Viktor

From info at fsgiudice.com  Fri Nov  7 16:55:43 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Fri Nov  7 16:55:54 2008
Subject: [Harbour] 2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice (info
	fsgiudice com)
Message-ID: <4914B95F.8070207@fsgiudice.com>


2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice (info fsgiudice com)
   * contrib/xhb/hboutdbg.c
     + Added hb_OutDebug() and hb_OutDebugName() functions at
       C level


Hi Viktor,
I've updated also
contrib/hbdbgfx/dbgfxc.c
to use hb_OutDebug() function at C level so it is ready for Linux and 
Windows.
So now to complete this step I have to move all hbdbgfx files to xhb folder.
Only a question, where can I put this declaration that I have on top of 
   dbgfxc.c to make it available for other files ?

extern HB_EXPORT void hb_OutDebug( const char * szMsg, ULONG ulMsgLen );

Is it ok to add a hboutdbg.h file in xhb folder or we have any other 
header file to use for xhb ?

best regards

Francesco
From info at fsgiudice.com  Fri Nov  7 17:02:01 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Fri Nov  7 17:02:14 2008
Subject: [Harbour] 2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice
	(info	fsgiudice com)
In-Reply-To: <4914B95F.8070207@fsgiudice.com>
References: <4914B95F.8070207@fsgiudice.com>
Message-ID: <4914BAD9.4@fsgiudice.com>

Hi Viktor,

to be more precise, modified version of
contrib/hbdbgfx/dbgfxc.c
it is not uploaded to svn because it require xhb to work.

I have attached here for the moment.

best regards

Francesco

Il 07/11/2008 22.55, Francesco Saverio Giudice ha scritto:
> 
> 2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice (info fsgiudice com)
>   * contrib/xhb/hboutdbg.c
>     + Added hb_OutDebug() and hb_OutDebugName() functions at
>       C level
> 
> 
> Hi Viktor,
> I've updated also
> contrib/hbdbgfx/dbgfxc.c
> to use hb_OutDebug() function at C level so it is ready for Linux and 
> Windows.
> So now to complete this step I have to move all hbdbgfx files to xhb 
> folder.
> Only a question, where can I put this declaration that I have on top of 
>   dbgfxc.c to make it available for other files ?
> 
> extern HB_EXPORT void hb_OutDebug( const char * szMsg, ULONG ulMsgLen );
> 
> Is it ok to add a hboutdbg.h file in xhb folder or we have any other 
> header file to use for xhb ?
> 

-------------- next part --------------
/*
 * $Id: dbgfxc.c 9838 2008-11-05 02:01:15Z druzus $
 */

/*
 * Harbour Project source code:
 * Debug Functions
 *
 * Copyright 2007-2008 Francesco Saverio Giudice <info / at /fsgiudice.com>
 * www - http://www.harbour-project.org
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2, or (at your option)
 * any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this software; see the file COPYING.  If not, write to
 * the Free Software Foundation, Inc., 59 Temple Place, Suite 330,
 * Boston, MA 02111-1307 USA (or visit the web site http://www.gnu.org/).
 *
 * As a special exception, the Harbour Project gives permission for
 * additional uses of the text contained in its release of Harbour.
 *
 * The exception is that, if you link the Harbour libraries with other
 * files to produce an executable, this does not by itself cause the
 * resulting executable to be covered by the GNU General Public License.
 * Your use of that executable is in no way restricted on account of
 * linking the Harbour library code into it.
 *
 * This exception does not however invalidate any other reasons why
 * the executable file might be covered by the GNU General Public License.
 *
 * This exception applies only to the code released by the Harbour
 * Project under the name Harbour.  If you copy code from other
 * Harbour Project or Free Software Foundation releases into a copy of
 * Harbour, as the General Public License permits, the exception does
 * not apply to the code that you add in this way.  To avoid misleading
 * anyone as to the status of such modified files, you must delete
 * this exception notice from them.
 *
 * If you write modifications of your own for Harbour, it is your choice
 * whether to permit this exception to apply to your modifications.
 * If you do not wish that, delete this exception notice.
 *
 */

#define HB_OS_WIN_32_USED

#include "hbapi.h"
#include "hbapiitm.h"
#include "hbapifs.h"

static BOOL s_bToOutputDebug = TRUE;
static BOOL s_bToLogFile     = TRUE;

static BOOL s_bEmptyLogFile  = TRUE;

/* TODO: move to another include file */
extern HB_EXPORT void hb_OutDebug( const char * szMsg, ULONG ulMsgLen );

HB_EXPORT BOOL hb_ToOutDebugOnOff( BOOL bOnOff )
{
   BOOL bOld = s_bToOutputDebug;
   s_bToOutputDebug = bOnOff;
   return bOld;
}

HB_EXPORT void hb_ToOutDebug( const char * sTraceMsg, ... )
{
   if( sTraceMsg && s_bToOutputDebug )
   {
     char buffer[ 1024 ];
     va_list ap;

     va_start( ap, sTraceMsg );
     vsnprintf( buffer, sizeof( buffer ), sTraceMsg, ap );
     va_end( ap );

     hb_OutDebug( ( const char * ) buffer, strlen( buffer ) );
   }
}

HB_EXPORT BOOL hb_ToLogFileOnOff( BOOL bOnOff )
{
   BOOL bOld = s_bToLogFile;
   s_bToLogFile = bOnOff;
   return bOld;
}

HB_EXPORT BOOL hb_EmptyLogFile( BOOL bOnOff )
{
   BOOL bOld = s_bEmptyLogFile;
   s_bEmptyLogFile = bOnOff;
   return bOld;
}

HB_EXPORT void hb_ToLogFile( const char * sFile, const char * sTraceMsg, ... )
{
   if( s_bToLogFile )
   {
      FILE * hFile;

      if( sFile == NULL )
      {
         if( s_bEmptyLogFile )
         {
            s_bEmptyLogFile = FALSE;

            /* Empty the file if it exists. */
            hFile = hb_fopen( "logfile.log", "w" );
         }
         else
            hFile = hb_fopen( "logfile.log", "a" );
      }
      else
         hFile = hb_fopen( sFile, "a" );

      if( hFile )
      {
         va_list ap;

         va_start( ap, sTraceMsg );
         vfprintf( hFile, sTraceMsg, ap );
         va_end( ap );

         fclose( hFile );
      }
   }
}

From info at fsgiudice.com  Fri Nov  7 17:42:09 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Fri Nov  7 17:42:19 2008
Subject: [Harbour] 2008-11-07 23:39 UTC+0100 Francesco Saverio Giudice (info
	fsgiudice com)
Message-ID: <4914C441.7000603@fsgiudice.com>


2008-11-07 23:39 UTC+0100 Francesco Saverio Giudice (info fsgiudice com)
   * source/rdd/usrrdd/rdds/arrayrdd.prg
     * Changed AR_CREATE( nWA, aOpenInfo ) behaviour, now it not checks
       if a table exists in memory but act as dbCreate() does.
     + Added hb_FileArrayRDD() function to check existence of a table
       in memory.
     * Changed EraseArrayRDD() -> hb_EraseArrayRDD()
     * removed string lenght limit in case of a Memo field

best regards

Francesco
From harbour.01 at syenar.hu  Fri Nov  7 20:04:58 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov  7 20:05:06 2008
Subject: [Harbour] 2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice
	(info fsgiudice com)
In-Reply-To: <4914B95F.8070207@fsgiudice.com>
References: <4914B95F.8070207@fsgiudice.com>
Message-ID: <8B2E0809-A4D1-49A5-BBD9-3E52A26D54D4@syenar.hu>

Hi Francesco,

Maybe the best solution is to create an xhb.h file in
contrib/xhb, which we also add to the list of installed
headers (in Makefile and common.mak where we already
have xhb.ch and hbcompat.h/ch setup similarly).

BTW, I've just stumbled into an article about OutputDebugString(),
it may be interesting to you or other users:

http://www.unixwiz.net/techtips/outputdebugstring.html

Brgds,
Viktor

On 2008.11.07., at 22:55, Francesco Saverio Giudice wrote:

>
> 2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice (info fsgiudice  
> com)
>  * contrib/xhb/hboutdbg.c
>    + Added hb_OutDebug() and hb_OutDebugName() functions at
>      C level
>
>
> Hi Viktor,
> I've updated also
> contrib/hbdbgfx/dbgfxc.c
> to use hb_OutDebug() function at C level so it is ready for Linux  
> and Windows.
> So now to complete this step I have to move all hbdbgfx files to xhb  
> folder.
> Only a question, where can I put this declaration that I have on top  
> of   dbgfxc.c to make it available for other files ?
>
> extern HB_EXPORT void hb_OutDebug( const char * szMsg, ULONG  
> ulMsgLen );
>
> Is it ok to add a hboutdbg.h file in xhb folder or we have any other  
> header file to use for xhb ?
>
> best regards
>
> Francesco
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From dmacias at mail.udg.mx  Sat Nov  8 03:01:40 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 03:01:47 2008
Subject: [Harbour] Harbour under Win32 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49154764.2050408@mail.udg.mx>

Second try

- Windows XPPro SP2
- OpenWatcom 1.7a
- Make GNU for Win32
- Current Harbour


Adjusting values:

set PRG_USR=-gc0

harbour\config\w32\owatcom.cf

Remove:
   echo @%watcom%/binnt/wlink.lnk >> __link__.tmp
Add -bm in CPPFLAGS



Screen output:
--------------------
make[3]: *** [hboutdbg.obj] Error 8
make[2]: *** [descend] Error 2
--------------------


Summary of make_ow.log:

- Error:
../../hboutdbg.c(166): Error! E003: col(1) missing return value

- Warnings:
   None

David Macias





From dmacias at mail.udg.mx  Sat Nov  8 03:17:22 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 03:17:30 2008
Subject: [Harbour] Re: Harbour under Win32 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49154B12.6080209@mail.udg.mx>

- Windows XPPro SP2
- OpenWatcom 1.7a
- Make GNU for Win32
- Current Harbour


Przemek:

OpenWatcom in Windows does not fail with multithread


hbrun_st.exe speedtst.prg
--------------------------
[ total application time: ]....................................67.08
[ total real time: ]...........................................67.34

hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
--------------------------
[ total application time: ]...................................104.42
[ total real time: ]..........................................107.14


mttest01.prg
------------
Harbour 1.1.0dev (Rev. 9854)
join: .T.
result: Hello World!!! Hello World!!! Hello World!!!
static var type: B
      12345.678
      12346.678

mttest02.prg
------------
Harbour 1.1.0dev (Rev. 9854)
Main start
Thread ID: 00a26498
Thread begin
Parameters: A B C
t
===================
MttMtMt
Thread QUIT
Thread ALWAYS section
MMMMMMM
===================
Main QUIT
Main ALWAYS section

I'm EXIT procedure

mttest03.prg
------------
Harbour 1.1.0dev (Rev. 9854)
Main start
Thread ID:
Thread begin
Parameters: A B C
t 00a26498
===================
MttMttMttMttMt
Main QUIT
Main ALWAYS section

I'm EXIT procedure
Thread ALWAYS section

mttest04.prg
------------
Harbour 1.1.0dev (Rev. 9854)
Main start
Starting threads: <1><2><3><4><5>
Wait 5 seconds or hit any key...
Waiting for threads...
Threads joined
Sum of thread local counters:    1634479
Protected item result.......:    1634479 OK
Unprotected item result.....:    1634479 *
  * - can be different then local sum on real multi-CPU systems
End of main

mttest05.prg
------------
Harbour 1.1.0dev (Rev. 9854)
Starting threads: <1><2><3><4><5>
Waiting for threads...
Threads joined
Sum of results:    5000500
      should be:    5000500 OK

mttest06.prg
------------
Harbour 1.1.0dev (Rev. 9854)
Starting threads: <1><2><3><4><5>
Waiting for threads...
Threads joined
Sum of results:    5000500
      should be:    5000500 OK

mttest07.prg
------------
Harbour 1.1.0dev (Rev. 9854)
Main start
Starting threads: <1><2><3><4><5>
Sending jobs...
Sending terminate values...<1><2><3><4><5>
Collecting results...
Waiting for threads...
Threads joined
OK, final sum: 16698333.33
End of main

David Macias


hbrun_st.exe speedtst.prg
--------------------------

Warning !!! Memory statistic enabled.

11/08/08 02:02:11 Windows XP 5.1.2600 Service Pack 2
Harbour 1.1.0dev (Rev. 9854) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 0
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.13
====================================================================
[ T001: x := L_C ]..............................................0.16
[ T002: x := L_N ]..............................................0.14
[ T003: x := L_D ]..............................................0.14
[ T004: x := S_C ]..............................................0.16
[ T005: x := S_N ]..............................................0.14
[ T006: x := S_D ]..............................................0.14
[ T007: x := M_C ]..............................................0.16
[ T008: x := M_N ]..............................................0.14
[ T009: x := M_D ]..............................................0.14
[ T010: x := P_C ]..............................................0.16
[ T011: x := P_N ]..............................................0.14
[ T012: x := P_D ]..............................................0.16
[ T013: x := F_C ]..............................................0.66
[ T014: x := F_N ]..............................................0.42
[ T015: x := F_D ]..............................................0.27
[ T016: x := o:GenCode ]........................................0.41
[ T017: x := o[8] ].............................................0.31
[ T018: round( i / 1000, 2 ) ]..................................0.48
[ T019: str( i / 1000 ) ].......................................1.38
[ T020: val( s ) ]..............................................0.44
[ T021: val( a [ i % 16 + 1 ] ) ]...............................0.88
[ T022: dtos( d - i % 10000 ) ].................................1.36
[ T023: eval( { || i % 16 } ) ].................................1.89
[ T024: eval( bc := { || i % 16 } ) ]...........................0.50
[ T025: eval( { |x| x % 16 }, i ) ].............................1.48
[ T026: eval( bc := { |x| x % 16 }, i ) ].......................0.55
[ T027: eval( { |x| f1( x ) }, i ) ]............................1.69
[ T028: eval( bc := { |x| f1( x ) }, i ) ]......................0.77
[ T029: x := &( "f1(" + str(i) + ")" ) ]........................8.66
[ T030: bc := &( "{|x|f1(x)}" ); eval( bc, i ) ]................9.94
[ T031: x := valtype( x ) +  valtype( i ) ].....................1.34
[ T032: x := strzero( i % 100, 2 ) $ a[ i % 16 + 1 ] ]..........1.91
[ T033: x := a[ i % 16 + 1 ] == s ].............................0.70
[ T034: x := a[ i % 16 + 1 ] = s ]..............................0.73
[ T035: x := a[ i % 16 + 1 ] >= s ].............................0.70
[ T036: x := a[ i % 16 + 1 ] <= s ].............................0.72
[ T037: x := a[ i % 16 + 1 ] < s ]..............................0.73
[ T038: x := a[ i % 16 + 1 ] > s ]..............................0.73
[ T039: ascan( a, i % 16 ) ]....................................0.61
[ T040: ascan( a, { |x| x == i % 16 } ) ].......................6.69
[ T041: if i%1000==0;a:={};end; aadd(a,{i,1,.T.,s,s2,a2,bc ]....3.52
[ T042: x := a ]................................................0.17
[ T043: x := {} ]...............................................0.55
[ T044: f0() ]..................................................0.23
[ T045: f1( i ) ]...............................................0.38
[ T046: f2( c[1...8] ) ]........................................0.34
[ T047: f2( c[1...40000] ) ]....................................0.34
[ T048: f2( @c[1...40000] ) ]...................................0.33
[ T049: f2( @c[1...40000] ), c2 := c ]..........................0.47
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]....................0.92
[ T051: f2( a ) ]...............................................0.34
[ T052: x := f4() ].............................................1.73
[ T053: x := f5() ].............................................1.13
[ T054: f_prv( c ) ]............................................1.16
====================================================================
[ total application time: ]....................................67.08
[ total real time: ]...........................................67.34



hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
--------------------------

Warning !!! Memory statistic enabled.

11/08/08 02:03:37 Windows XP 5.1.2600 Service Pack 2
Harbour 1.1.0dev (Rev. 9854) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
excluded tests: 029 030 023 025 027 040 041 043 052 053 019 022 031 032 054
                                                         1 th.  2 th. 
factor
============================================================================
[ T001: x := L_C ]____________________________________  0.70   0.70 ->  1.00
[ T002: x := L_N ]____________________________________  0.63   0.64 ->  0.98
[ T003: x := L_D ]____________________________________  0.64   0.70 ->  0.91
[ T004: x := S_C ]____________________________________  0.70   0.67 ->  1.05
[ T005: x := S_N ]____________________________________  0.69   0.63 ->  1.10
[ T006: x := S_D ]____________________________________  0.63   0.61 ->  1.03
[ T007: x := M_C ]____________________________________  0.67   0.67 ->  1.00
[ T008: x := M_N ]____________________________________  0.61   0.66 ->  0.93
[ T009: x := M_D ]____________________________________  0.63   0.61 ->  1.02
[ T010: x := P_C ]____________________________________  0.66   0.73 ->  0.89
[ T011: x := P_N ]____________________________________  0.64   0.61 ->  1.05
[ T012: x := P_D ]____________________________________  1.33   0.64 ->  2.07
[ T013: x := F_C ]____________________________________  2.25   2.30 ->  0.98
[ T014: x := F_N ]____________________________________  1.30   1.28 ->  1.01
[ T015: x := F_D ]____________________________________  1.00   0.92 ->  1.08
[ T016: x := o:GenCode ]______________________________  1.38   1.38 ->  1.00
[ T017: x := o[8] ]___________________________________  1.08   1.06 ->  1.02
[ T018: round( i / 1000, 2 ) ]________________________  1.81   1.81 ->  1.00
[ T020: val( s ) ]____________________________________  1.50   1.45 ->  1.03
[ T021: val( a [ i % 16 + 1 ] ) ]_____________________  2.66   2.67 ->  0.99
[ T024: eval( bc := { || i % 16 } ) ]_________________  1.78   1.77 ->  1.01
[ T026: eval( bc := { |x| x % 16 }, i ) ]_____________  1.94   1.95 ->  0.99
[ T028: eval( bc := { |x| f1( x ) }, i ) ]____________  2.34   2.27 ->  1.03
[ T033: x := a[ i % 16 + 1 ] == s ]___________________  2.11   1.98 ->  1.06
[ T034: x := a[ i % 16 + 1 ] = s ]____________________  2.08   2.13 ->  0.98
[ T035: x := a[ i % 16 + 1 ] >= s ]___________________  2.19   2.11 ->  1.04
[ T036: x := a[ i % 16 + 1 ] <= s ]___________________  2.22   2.13 ->  1.04
[ T037: x := a[ i % 16 + 1 ] < s ]____________________  2.27   2.23 ->  1.01
[ T038: x := a[ i % 16 + 1 ] > s ]____________________  2.11   2.08 ->  1.01
[ T039: ascan( a, i % 16 ) ]__________________________  2.02   2.01 ->  1.00
[ T042: x := a ]______________________________________  0.72   0.72 ->  1.00
[ T044: f0() ]________________________________________  0.89   0.91 ->  0.98
[ T045: f1( i ) ]_____________________________________  1.22   1.22 ->  1.00
[ T046: f2( c[1...8] ) ]______________________________  1.19   1.16 ->  1.03
[ T047: f2( c[1...40000] ) ]__________________________  1.16   1.17 ->  0.99
[ T048: f2( @c[1...40000] ) ]_________________________  1.16   1.16 ->  1.00
[ T049: f2( @c[1...40000] ), c2 := c ]________________  1.47   1.45 ->  1.01
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]__________  2.56   2.59 ->  0.99
[ T051: f2( a ) ]_____________________________________  1.19   1.19 ->  1.00
============================================================================
[   TOTAL   ]_________________________________________ 54.08  52.97 ->  1.02
============================================================================
[ total application time: ]...................................104.42
[ total real time: ]..........................................107.14





From dmacias at mail.udg.mx  Sat Nov  8 03:25:28 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 03:25:31 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49154CF8.1050108@mail.udg.mx>

Przemek:

 >I'm build systematically MS-Windows OpenWatcom 1.2 binaries
 >in Linux using WINE and MT mode is working without any problems.

 >The Windows version is working correctly. At least for me using OW1.2
 >with Wine. Later I'll install new OW1.7 and check but I do not expect
 >problems. It's probably sth local to OS2 builds.

Note:
I am using OpenWatcom 1.7a

David Macias



From dmacias at mail.udg.mx  Sat Nov  8 03:28:55 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 03:28:59 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49154DC7.3040506@mail.udg.mx>

 >I can. But now I have 7days holiday.

and you are now in "disconnecting phase"  :-)

Thanks Marek
I am using OpenWatcom 1.7a

David Macias

From info at fsgiudice.com  Sat Nov  8 03:38:09 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  8 03:38:20 2008
Subject: [Harbour] 2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice
	(info fsgiudice com)
In-Reply-To: <8B2E0809-A4D1-49A5-BBD9-3E52A26D54D4@syenar.hu>
References: <4914B95F.8070207@fsgiudice.com>
	<8B2E0809-A4D1-49A5-BBD9-3E52A26D54D4@syenar.hu>
Message-ID: <49154FF1.10800@fsgiudice.com>

Hi Viktor,

Il 08/11/2008 2.04, Szak?ts Viktor ha scritto:
> Hi Francesco,
> 
> Maybe the best solution is to create an xhb.h file in
> contrib/xhb, which we also add to the list of installed
> headers (in Makefile and common.mak where we already
> have xhb.ch and hbcompat.h/ch setup similarly).
> 

Ok

A question about header files: what have I to modify in our makefile 
system (or in single make batch) to copy header files (*.h and *.ch) 
from a contrib folder to main include folder ?
I've seen that files likes hbwhat.ch or xhb.ch are copied but not other 
header files, so I'm missing where they are defined and what are the rules.

> BTW, I've just stumbled into an article about OutputDebugString(),
> it may be interesting to you or other users:
> 
> http://www.unixwiz.net/techtips/outputdebugstring.html
> 

very interesting, tnx

Best Regards

Francesco
From info at fsgiudice.com  Sat Nov  8 03:39:24 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  8 03:39:47 2008
Subject: [Harbour] test, pls ignore
Message-ID: <4915503C.4050305@fsgiudice.com>

Francesco
From harbour.01 at syenar.hu  Sat Nov  8 03:44:38 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 03:44:45 2008
Subject: [Harbour] 2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice
	(info fsgiudice com)
In-Reply-To: <49154FF1.10800@fsgiudice.com>
References: <4914B95F.8070207@fsgiudice.com>
	<8B2E0809-A4D1-49A5-BBD9-3E52A26D54D4@syenar.hu>
	<49154FF1.10800@fsgiudice.com>
Message-ID: <AEC2CDCD-04C0-4850-B97E-A009C1B1C9C0@syenar.hu>

Hi Francesco,

>> headers (in Makefile and common.mak where we already
>> have xhb.ch and hbcompat.h/ch setup similarly).
>
> Ok
>
> A question about header files: what have I to modify in our makefile  
> system (or in single make batch) to copy header files (*.h and *.ch)  
> from a contrib folder to main include folder ?
> I've seen that files likes hbwhat.ch or xhb.ch are copied but not  
> other header files, so I'm missing where they are defined and what  
> are the rules.

It's 'Makefile' and 'common.mak' in xhb dir. Look where
'hbcompat.h' is present in these files. You can add
'xhb.h' next to it in both files (note that you have
to use a tab for indentation in 'Makefile' - to make
GNU make happy -, and simple spaces in 'common.mak').

Brgds,
Viktor

From info at fsgiudice.com  Sat Nov  8 03:50:18 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  8 03:50:29 2008
Subject: [Harbour] 2008-11-07 22:45 UTC+0100 Francesco Saverio Giudice
	(info fsgiudice com)
In-Reply-To: <AEC2CDCD-04C0-4850-B97E-A009C1B1C9C0@syenar.hu>
References: <4914B95F.8070207@fsgiudice.com>	<8B2E0809-A4D1-49A5-BBD9-3E52A26D54D4@syenar.hu>	<49154FF1.10800@fsgiudice.com>
	<AEC2CDCD-04C0-4850-B97E-A009C1B1C9C0@syenar.hu>
Message-ID: <491552CA.3080201@fsgiudice.com>

Hi Viktor,

Il 08/11/2008 9.44, Szak?ts Viktor ha scritto:
> 
> It's 'Makefile' and 'common.mak' in xhb dir. Look where
> 'hbcompat.h' is present in these files. You can add
> 'xhb.h' next to it in both files (note that you have
> to use a tab for indentation in 'Makefile' - to make
> GNU make happy -, and simple spaces in 'common.mak').
> 

Thank you

Best Regards,

Francesco
From dmacias at mail.udg.mx  Sat Nov  8 03:56:40 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 03:56:44 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49155448.60703@mail.udg.mx>

 >So it will crashes inside hb_vmExecute()
 >Please try to commenct line 1127 in hvm.c
 >         hb_inkeyPoll();
 >to eliminate yet another possibly danger place and make test.

I commented in hvm.c two active
   hb_inkeyPoll();

and error has gone


Using -bm flag and hbvmmt

-----------------
1. HB_THREADSTART
1. hb_threadStartVM
3. HB_THREADSTART
2. hb_threadStartVM
3. hb_threadStartVM
4. hb_threadStartVM
6. hb_threadStartVM
7. hb_threadStartVM
-----------------

and your reference was:

 >You should C on the screen sth like:

 >   1. HB_THREADSTART
 >   3. HB_THREADSTART
 >   1. hb_threadStartVM
 >   2. hb_threadStartVM
 >   3. hb_threadStartVM
 >   4. hb_threadStartVM
 >   6. hb_threadStartVM
 >   7. hb_threadStartVM

 >for clean execution. I guess it will be interrupted somewhere.


Below are results with tracing labels in hvm.c

David Macias


1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDoInitClip()

2. hb_vmDoInitClip()

3. hb_vmDoInitClip()

4. hb_vmDoInitClip()

5. hb_vmDoInitClip()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

6. hb_vmDoInitClip()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

1. HB_THREADSTART

1. hb_threadStartVM

2. hb_threadStartVM

1. hb_vmThreadInit()

2. hb_vmThreadInit()

3. hb_vmThreadInit()

4. hb_vmThreadInit()

4b. hb_vmThreadInit()

4c. hb_vmThreadInit()

1. hb_vmDoInitClip()

2. hb_vmDoInitClip()

3. hb_vmDoInitClip()

4. hb_vmDoInitClip()

5. hb_vmDoInitClip()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

6. hb_vmDoInitClip()

4d. hb_vmThreadInit()

5. hb_vmThreadInit()

6. hb_vmThreadInit()

3. hb_threadStartVM

4. hb_threadStartVM

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

6. hb_threadStartVM

7. hb_threadStartVM

3. HB_THREADSTART

17. hb_vmDo()

18. hb_vmDo()

1. hb_vmDo()

2. hb_vmDo()

3. hb_vmDo()

4. hb_vmDo()

6. hb_vmDo()

7. hb_vmDo()

14. hb_vmDo()

15. hb_vmDo()

16. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()

17. hb_vmDo()

18. hb_vmDo()
From harbour.01 at syenar.hu  Sat Nov  8 04:40:35 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 04:40:34 2008
Subject: [Harbour] 2008-11-08 10:25 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94186$Blat.v2.6.2$0cfa84dc$3d0ab9288c6@127.0.0.1>

2008-11-08 10:25 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/vm/set.c
    + Implemented rest of hb_setSetItem() values.
    ; TODO: Please review.
    ! Fixed HB_SET_FILECASE and HB_SET_DIRCASE to not allow 
      invalid numeric values to be set.
    ! Added missing 'break;' to hb_setSetItem2();

  * source/rtl/gtwvt/gtwvt.c
    ! Fixed a few places where '+' operator was used 
      instead of '|'.
    * Minor opt/formatting.
    ; TOFIX: The window positioning bug is still to be solved.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sat Nov  8 06:32:38 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 06:31:48 2008
Subject: [Harbour] Re: Harbour under Win32 - OpenWatcom
In-Reply-To: <49154B12.6080209@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49154B12.6080209@mail.udg.mx>
Message-ID: <20081108113238.GA2878@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> OpenWatcom in Windows does not fail with multithread

I've also teststed 1.7a in Linux and WINE and it works correctly.
The native Linux build does not work due to missing functions and
some typos in header files. In spare time I'll try to collect my
local OW patches and send them to OW devel list.

> hbrun_st.exe speedtst.prg
> --------------------------
> [ total application time: ]....................................67.08
> [ total real time: ]...........................................67.34
>
> hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
> --------------------------
> [ total application time: ]...................................104.42
> [ total real time: ]..........................................107.14

Try to rebuild Harbour with HB_FM_DL_ALLOC and USE_DL_PREFIX macros, f.e.:
   set C_USR=-DHB_FM_DL_ALLOC -DUSE_DL_PREFIX

and recompile Harbour. Then compare speed results for both modes.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Nov  8 06:48:00 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 06:48:00 2008
Subject: [Harbour] 2008-11-08 12:46 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94197$Blat.v2.6.2$d9a1f2ca$17b4a6e8e43c@127.0.0.1>

2008-11-08 12:46 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/gtwvt/gtwvt.c
    * hb_gt_wvt_ResetWindowSize(): Not very good looking (or 
      overly efficient) solution added for the windows 
      resize/positioning problem in case the initally set size 
      cannot fit on the screen (Windows desktop).
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sat Nov  8 06:59:33 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 06:58:43 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49155448.60703@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49155448.60703@mail.udg.mx>
Message-ID: <20081108115933.GB2878@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> >So it will crashes inside hb_vmExecute()
> >Please try to commenct line 1127 in hvm.c
> >         hb_inkeyPoll();
> >to eliminate yet another possibly danger place and make test.
> I commented in hvm.c two active
>   hb_inkeyPoll();
> and error has gone

And we've got a reason. I expected that it will be exploited earlier
by hb_gtAttach() but I forgot that when GT is inherited attaching is
done without locks.
Looks that it fails inside _hb_gettid() when it's executed from non
main thread but I only guess now.
Please restore original hvm.c and thread.c code and then change in
thread.c function _hb_gettid() to the code below.

best regards,
Przemek


ULONG _hb_gettid( void )
{
   ULONG tid = 0;
   PTIB  ptib = NULL;

   if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )
   {
      if( ! ptib )
         { printf( "ptib is NULL\r\n" ); fflush(stdout); }
      else if( !ptib->tib_ptib2 )
         { printf( "ptib->tib_ptib2 is NULL\r\n" ); fflush(stdout); }
      else
         tid = ptib->tib_ptib2->tib2_ultid;
   }

   return tid;
}
From druzus at acn.waw.pl  Sat Nov  8 07:16:38 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 07:15:49 2008
Subject: [Harbour] 2008-11-08 10:25 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c94186$Blat.v2.6.2$0cfa84dc$3d0ab9288c6@127.0.0.1>
References: <01c94186$Blat.v2.6.2$0cfa84dc$3d0ab9288c6@127.0.0.1>
Message-ID: <20081108121637.GA1383@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> 2008-11-08 10:25 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>   * source/vm/set.c
>     + Implemented rest of hb_setSetItem() values.
>     ; TODO: Please review.

Thank you very much. Looks correct. I'll make some only some minor
modifications. We should also check the RT errors in SET() functions
for CL53 SETs like AUTORDER, AUTOPEN, AUTOSHARE, MESSAGE, ...
Looks that they were copied from other sets.

best regards,
Przemek
From druzus at acn.waw.pl  Sat Nov  8 07:22:45 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 07:21:54 2008
Subject: [Harbour] 2008-11-08 13:22 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081108122245.GA9739@34-mo7-2.acn.waw.pl>

2008-11-08 13:22 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/make_gcc.sh
  * harbour/make_gnu.bat
  * harbour/make_gnu.sh
  * harbour/config/lib.cf
  * harbour/config/bin.cf
    + added MK_USR to pass GNU MAKE flags

  * harbour/source/vm/set.c
    * minor cleanup and simplifications in hb_setSetItem().
    * grouped SETs with the same item type in hb_setSetItem() function
      together.

best regards
Przemek
From druzus at acn.waw.pl  Sat Nov  8 07:42:19 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 07:41:28 2008
Subject: [Harbour] 2008-11-08 12:46 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c94197$Blat.v2.6.2$d9a1f2ca$17b4a6e8e43c@127.0.0.1>
References: <01c94197$Blat.v2.6.2$d9a1f2ca$17b4a6e8e43c@127.0.0.1>
Message-ID: <20081108124219.GA17279@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> 2008-11-08 12:46 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>   * source/rtl/gtwvt/gtwvt.c
>     * hb_gt_wvt_ResetWindowSize(): Not very good looking (or 
>       overly efficient) solution added for the windows 
>       resize/positioning problem in case the initally set size 
>       cannot fit on the screen (Windows desktop).

All this stuff with font/window resizing broke WINCE support.
It will have to be changed.
Probably we should start by adding support for scrollable window
view area. At startup we should calculate maximum console window
size for default font and change screen buffer to this size. On small
screens like in PocketPC current code seems to end choosing font
to small for OS and application crashes. The internal code for
resizing should be changed because now the same operations are
repeated many times at startup and on each setmode() call.
Just simply the original code was not designed for some operations
which was added later in a little bit dirty way to make it working.
Now we have all conditions which we should support and the main
algorithm should be redesigned for them.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Nov  8 07:56:07 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 07:56:05 2008
Subject: [Harbour] 2008-11-08 13:55 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c941a1$Blat.v2.6.2$5db3cf58$11a46f03dcc6@127.0.0.1>

2008-11-08 13:55 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/vm/set.c
    ! _SET_EVENTMASK RTE removed to be Clipper compatible.
    ! _SET_VIDEOMODE RTE removed to be Clipper compatible.
    ! _SET_MBLOCKSIZE default value set to 64 (was 0) to be Clipper compatible.
      (pls correct me if this was intentionally wrong)

  * utils/hbtest/rt_misc.prg
    + Added one C5.2 SET()s for two simple tests.
    + Added all C5.3 SET()s for two simple tests each.
    ; NOFIX: _SET_VIDEOMODE has the type wrong.
    ; NOTE: It wouldn't be a bad idea to add some more comprehensive 
            tests for SET()s.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sat Nov  8 07:57:54 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 07:58:03 2008
Subject: [Harbour] 2008-11-08 12:46 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081108124219.GA17279@34-mo7-2.acn.waw.pl>
References: <01c94197$Blat.v2.6.2$d9a1f2ca$17b4a6e8e43c@127.0.0.1>
	<20081108124219.GA17279@34-mo7-2.acn.waw.pl>
Message-ID: <7EB4CD86-EF4E-4CC2-816A-809433F387AE@syenar.hu>

Hi Przemek,

I know there are problems, but this code is above
my Windows and/or C knowledge (I've already spent
many days in avoiding lots of strange issues introduced
by the resize code, tons of flicker and alignment problems,
and it's still far from perfect I know :( ). Scrollable
should IMO be an option, as on destktop it is rather
annoying, and simply setting the size smaller is friendlier.
One of the most annoying things in GTWIN is the scrollbars,
if the sizes are not properly setup (which they aren't
by default). Maybe the default for scrollable should be
TRUE for CE and FALSE for desktop. Of course GTWVT
should never crash because of too small chars. In this
case scrollable my be forced as a final fallback case.

Crappy as is, this patch solves this bad positioning
problem (which is also very disturbing for a normal
user), anything beyond this I just can hope you or
someone else can solve them once properly.

Another remaining issue is screen refresh problem, which
should probably put in a separate native thread as you've
suggested already. Maybe this would solve some bad refresh
problems in GTWVG, too.

Having run my app with GTXWC, this GT is apparently
resizing rows/cols by default, which can easily break
an app, so maybe it would be good to sync resize
behavior with GTWVT once in the future. But this is far
from being a priority (for me) as I don't have long
queues of Linux/OSX users in front of my door :) (yet :)

Brgds,
Viktor

On 2008.11.08., at 13:42, Przemyslaw Czerpak wrote:

> On Sat, 08 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
>> 2008-11-08 12:46 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
>>  * source/rtl/gtwvt/gtwvt.c
>>    * hb_gt_wvt_ResetWindowSize(): Not very good looking (or
>>      overly efficient) solution added for the windows
>>      resize/positioning problem in case the initally set size
>>      cannot fit on the screen (Windows desktop).
>
> All this stuff with font/window resizing broke WINCE support.
> It will have to be changed.
> Probably we should start by adding support for scrollable window
> view area. At startup we should calculate maximum console window
> size for default font and change screen buffer to this size. On small
> screens like in PocketPC current code seems to end choosing font
> to small for OS and application crashes. The internal code for
> resizing should be changed because now the same operations are
> repeated many times at startup and on each setmode() call.
> Just simply the original code was not designed for some operations
> which was added later in a little bit dirty way to make it working.
> Now we have all conditions which we should support and the main
> algorithm should be redesigned for them.
>
> best regards,
> Przemek

From harbour.01 at syenar.hu  Sat Nov  8 08:04:49 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 08:04:47 2008
Subject: [Harbour] 2008-11-08 14:03 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c941a2$Blat.v2.6.2$94e039c0$1720aa5d775c@127.0.0.1>

2008-11-08 14:03 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.bat
  * make_vc.bat
  * contrib/mtpl_b32.bat
  * contrib/mtpl_gcc.sh
  * contrib/mtpl_vc.bat
    * Sync with GNU make system:
      HB_MAKE_FLAGS -> MK_USR
    ; TOFIX: Maybe it's a good time now to resolve the missing HB_ 
             prefixes for C_USR, L_USR, A_USR, MK_USR.
             If there are no objections / better ideas I'd like 
             to make these changes:
             HB_USER_LIBS -> HB_USR_LIBS
             PRG_USR      -> HB_USR_PRG
             C_USR        -> HB_USR_C
             L_USR        -> HB_USR_LINK (or HB_USR_L ?)
             A_USR        -> HB_USR_LIB (or HB_USR_A ?)
             MK_USR       -> HB_USR_MAKE (or HB_USR_MAK ?)
             As an option we may keep the old names for 
             compatibility to give some transition time.
--
Brgds,
Viktor

From dmacias at mail.udg.mx  Sat Nov  8 08:07:24 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 08:07:27 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49158F0C.1020404@mail.udg.mx>

 >And we've got a reason. I expected that it will be exploited earlier
 >by hb_gtAttach() but I forgot that when GT is inherited attaching is
 >done without locks.
 >Looks that it fails inside _hb_gettid() when it's executed from non
 >main thread but I only guess now.
 >Please restore original hvm.c and thread.c code and then change in
 >thread.c function _hb_gettid() to the code below.

Error happen

To see something I added last tracing label

-------------------------
ULONG _hb_gettid( void )
{
    ULONG tid = 0;
    PTIB  ptib = NULL;

    if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )
    {
       if( ! ptib )
          { printf( "ptib is NULL\r\n" ); fflush(stdout); }
       else if( !ptib->tib_ptib2 )
          { printf( "ptib->tib_ptib2 is NULL\r\n" ); fflush(stdout); }
       else
          tid = ptib->tib_ptib2->tib2_ultid;
          printf( "ptib->tib_ptib2->tib2_ultid\r\n" ); fflush(stdout);
    }

    return tid;
}
-------------------------


Using -bm flag and hbvmmt

-----------------
ptib->tib_ptib2->tib2_ultid
ptib->tib_ptib2->tib2_ultid
ptib->tib_ptib2->tib2_ultid
ptib->tib_ptib2->tib2_ultid
ptib->tib_ptib2->tib2_ultid
ptib->tib_ptib2->tib2_ultid
ptib->tib_ptib2->tib2_ultid
ptib->tib_ptib2->tib2_ultid
ptib->tib_ptib2->tib2_ultid
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-----------------


And what alternative exist if this is .F., returning tid=0 ?

    if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )


David Macias
From harbour.01 at syenar.hu  Sat Nov  8 08:16:59 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 08:16:59 2008
Subject: [Harbour] 2008-11-08 14:15 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c941a4$Blat.v2.6.2$47f3d958$10b466f2b43a@127.0.0.1>

2008-11-08 14:15 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * bin/hbmk.bat
    + Added C_USR support for OpenWatcom.
    - Removed debug switches from OpenWatcom C compiler cmdline.

  * bin/hbmk_os2.cmd
    + Added OpenWatcom support. Pls update it, f.e. I don't know 
      what is the name of the compiler executable.
    ! Fixed HB_COMPILER branching. Looks like nobody uses this 
      file if this problem didn't show up so far, so I'd like to 
      propose again to remove this file completely, as there is 
      not much point spending time on maintaining stuff which 
      nobody uses or needs, is there?

  * bin/hbmk.bat
  - config/dos/watcom.cf
  - config/w32/watcom.cf
    - Removed rather obsolete Watcom support. Pls use OpenWatcom.
      Update you envvar HB_COMPILER from 'watcom' to 'owatcom'.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sat Nov  8 08:25:17 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 08:24:26 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49158F0C.1020404@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49158F0C.1020404@mail.udg.mx>
Message-ID: <20081108132517.GA22469@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> To see something I added last tracing label
> -------------------------
> ULONG _hb_gettid( void )
> {
>    ULONG tid = 0;
>    PTIB  ptib = NULL;
>
>    if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )
>    {
>       if( ! ptib )
>          { printf( "ptib is NULL\r\n" ); fflush(stdout); }
>       else if( !ptib->tib_ptib2 )
>          { printf( "ptib->tib_ptib2 is NULL\r\n" ); fflush(stdout); }
>       else
>          tid = ptib->tib_ptib2->tib2_ultid;
>          printf( "ptib->tib_ptib2->tib2_ultid\r\n" ); fflush(stdout);
>    }
>
>    return tid;
> }
> -------------------------
> Using -bm flag and hbvmmt
> -----------------
> ptib->tib_ptib2->tib2_ultid
> ptib->tib_ptib2->tib2_ultid
> ptib->tib_ptib2->tib2_ultid
> ptib->tib_ptib2->tib2_ultid
> ptib->tib_ptib2->tib2_ultid
> ptib->tib_ptib2->tib2_ultid
> ptib->tib_ptib2->tib2_ultid
> ptib->tib_ptib2->tib2_ultid
> ptib->tib_ptib2->tib2_ultid
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> -----------------

Please change it a little bit yet.

ULONG _hb_gettid( void )
{
   ULONG tid = 0;
   PTIB  ptib = NULL;

   printf( "_hb_gettid()\r\n", tid ); fflush(stdout);
   if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )
   {
      if( ! ptib )
         { printf( "ptib is NULL\r\n" ); fflush(stdout); }
      else if( !ptib->tib_ptib2 )
         { printf( "ptib->tib_ptib2 is NULL\r\n" ); fflush(stdout); }
      else
         tid = ptib->tib_ptib2->tib2_ultid;
   }
   printf( "TID=%lu\r\n", tid ); fflush(stdout);

   return tid;
}

> And what alternative exist if this is .F., returning tid=0 ?
>    if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )

We still do not know where it _exactly_ fails. When we will know
then we will look for workaround. The above test should show if it's
inside _hb_gettid() or in some different related function.

best regards,
Przemek
From druzus at acn.waw.pl  Sat Nov  8 08:36:12 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 08:35:23 2008
Subject: [Harbour] 2008-11-08 14:15 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c941a4$Blat.v2.6.2$47f3d958$10b466f2b43a@127.0.0.1>
References: <01c941a4$Blat.v2.6.2$47f3d958$10b466f2b43a@127.0.0.1>
Message-ID: <20081108133612.GB22469@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>   * bin/hbmk_os2.cmd
>     + Added OpenWatcom support. Pls update it, f.e. I don't know 
>       what is the name of the compiler executable.
>     ! Fixed HB_COMPILER branching. Looks like nobody uses this 
>       file if this problem didn't show up so far, so I'd like to 
>       propose again to remove this file completely, as there is 
>       not much point spending time on maintaining stuff which 
>       nobody uses or needs, is there?

I'd rather think that users have their own customized version
of old bld*.cmd and it's the reason why it was not tested so far.

>   - config/dos/watcom.cf
>   - config/w32/watcom.cf
>     - Removed rather obsolete Watcom support. Pls use OpenWatcom.
>       Update you envvar HB_COMPILER from 'watcom' to 'owatcom'.

Ups. Sorry I forgot to answer to your question earlier.
It's not very important but OpenWatcom does not cover all
platforms supported by Watcom. So keeping some pure Watcom C
make files may help people who will want to make such ports.
Anyhow there is a long time as I was making real Watcom C builds
so I cannot say if we do not have some extensions which will not
work with this compiler. AFAIR Ryszard also was using it and
he asked me to keep watcom.cf and add owatcom.cf with new switches/
extensions for OpenWatcom builds.

best regards,
Przemek
From dmacias at mail.udg.mx  Sat Nov  8 08:35:35 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 08:35:38 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491595A7.2010405@mail.udg.mx>

>Please change it a little bit yet.

 >ULONG _hb_gettid( void )
 >{
 >   ULONG tid = 0;
 >   PTIB  ptib = NULL;
 >
 >   printf( "_hb_gettid()\r\n", tid ); fflush(stdout);
 >   if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )
 >   {
 >      if( ! ptib )
 >         { printf( "ptib is NULL\r\n" ); fflush(stdout); }
 >      else if( !ptib->tib_ptib2 )
 >         { printf( "ptib->tib_ptib2 is NULL\r\n" ); fflush(stdout); }
 >      else
 >         tid = ptib->tib_ptib2->tib2_ultid;
 >   }
 >   printf( "TID=%lu\r\n", tid ); fflush(stdout);

 >   return tid;
 >}

 >We still do not know where it _exactly_ fails. When we will know
 >then we will look for workaround. The above test should show if it's
 >inside _hb_gettid() or in some different related function.

Error happen

Using -bm flag and hbvmmt

-----------------
_hb_gettid()
TID=1
_hb_gettid()
TID=1
_hb_gettid()
TID=1
_hb_gettid()
TID=1
_hb_gettid()
TID=1
_hb_gettid()
TID=1
_hb_gettid()
TID=1
_hb_gettid()
TID=2
_hb_gettid()
TID=2
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-----------------

David Macias

From harbour.01 at syenar.hu  Sat Nov  8 08:39:26 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 08:39:32 2008
Subject: [Harbour] 2008-11-01 15:47 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <490CEB67.40103@fsgiudice.com>
References: <01c93c31$Blat.v2.6.2$fa41f360$184c795512d2@127.0.0.1>	<490CD442.7080406@fsgiudice.com>
	<4A394A66-CE1F-4132-80DA-6F6CF819A87E@syenar.hu>
	<490CEB67.40103@fsgiudice.com>
Message-ID: <E704CF46-657E-4FBA-BC69-81712524885A@syenar.hu>

Hi Francesco,

>> and at C level is similar also if I have not already added  
>> hb_OutDebug equivalent for linux.
> So now it works both in window and linux only from PRG level (using  
> hboutdbg.c functions from xhb), instead at C level *actually* it  
> works only for windows.

The real problem here is that (besides the different
API implementation depending on platform), is that
also that some platform needs xhb, some not.

So, optimally there should be no difference between
either APIs and lib dependencies when jumping
platforms. Also xhb lib dependency is not very
welcome for any Harbour contribs, especially if the
goal is to present an enhanced version of an existing
xhb API.

>> I'd propose to move these functions inside
>> xhb lib, in case someone wants to deal with
>> the details of this, if not, and there are no
>> better ideas, I'll remove this lib from the
>> repository.
>
> If you think that I can make above modifications (add C level call  
> for them that alter code, also if just a little, from original  
> xharbour file) I agree to move hbdbgfx into xhb.

I think this would be the best. The purpose of xhb lib
in Harbour is to present extra xhb functionality for
Harbour users (and former xhb users). We don't have any
strict rules to stay 100.00% compatible with xhb. There
is also no rule that we couldn't _enhance_ or fix xhb
functions while staying fully/mainly compatible on
the API level. I think your work fits these descriptions.

> Otherwise I will add above changes to hbdbgfx to make it complete.
> Take your decision, I will follow it. If you want to delete hbdbgfx  
> lib at all I will continue to have it in my repository as before.
> I have added it because I thought it can be useful to someone.

My vote is to implement your solution inside xhb lib,
this way the already known xhb API will get a better
implementation, and everyone can just as well use it
by linking xhb lib.

[ Maybe it or its parts can once be made the default
Harbour logging facility (probably under different
API names). In my understanding though, logging should
be fully portable and solved using just the basic file
functions and possibly some prospects to make sure no
log entries are lost, even in case the target disk is
temporarily inaccessible). ]

Brgds,
Viktor

From druzus at acn.waw.pl  Sat Nov  8 08:46:18 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 08:45:28 2008
Subject: [Harbour] 2008-11-08 12:46 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <7EB4CD86-EF4E-4CC2-816A-809433F387AE@syenar.hu>
References: <01c94197$Blat.v2.6.2$d9a1f2ca$17b4a6e8e43c@127.0.0.1>
	<20081108124219.GA17279@34-mo7-2.acn.waw.pl>
	<7EB4CD86-EF4E-4CC2-816A-809433F387AE@syenar.hu>
Message-ID: <20081108134618.GA3399@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Crappy as is, this patch solves this bad positioning
> problem (which is also very disturbing for a normal
> user), anything beyond this I just can hope you or
> someone else can solve them once properly.

The main problem for me is that I do not use Windows
and I do not know well MS-Windows API and undocumented
behavior. Working on GTWVT I'm making tests with WINE
but I'm never sure when I want to check some detail
behavior which is not documented that I see real MS-Windows
results or only WINE emulation side effects.
Here to well redesign GTWVT internals I should make some
tests on real MS-Windows machine to be sure that I choose
correct implementation.

> Another remaining issue is screen refresh problem, which
> should probably put in a separate native thread as you've
> suggested already. Maybe this would solve some bad refresh
> problems in GTWVG, too.

I cannot promise but I'll try to find some time to implement it.

> Having run my app with GTXWC, this GT is apparently
> resizing rows/cols by default, which can easily break
> an app, so maybe it would be good to sync resize
> behavior with GTWVT once in the future. But this is far
> from being a priority (for me) as I don't have long
> queues of Linux/OSX users in front of my door :) (yet :)

Please remember that in some GTs we are not able to protect
against terminal resizing from Harbour application so such
situations will always happen and support for dynamic font
resizing is rather seldom and will exist only in GUI GTs.

best regards,
Przemek
From harbour.01 at syenar.hu  Sat Nov  8 08:47:30 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 08:47:36 2008
Subject: [Harbour] 2008-11-08 14:15 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081108133612.GB22469@34-mo7-2.acn.waw.pl>
References: <01c941a4$Blat.v2.6.2$47f3d958$10b466f2b43a@127.0.0.1>
	<20081108133612.GB22469@34-mo7-2.acn.waw.pl>
Message-ID: <5010C389-FD74-412A-8A98-D0275397CCFE@syenar.hu>

Bummer, I've removed them already (DOS and Windows platforms,
which have their OpenWatcom equivalents). BTW, watcom.cf was
almost the same as owatcom besides some / -> \ (or vice versa)
conversion trickery. So maybe even a common makefile would
be feasible, but definitely ideal.

Anyway, I'd now suggest to wait for some feedback from users
actually missing these. Watcom doesn't exist since 2003 and
the new version is free, so hopefully users will be able to
overcome the problem.

Maybe using 'watcom' instead of 'owatcom' would also be a
good move, since former is more generic, and could better
mean both version.

> I'd rather think that users have their own customized version
> of old bld*.cmd and it's the reason why it was not tested so far.

Could be, but if users are maintaing/keeping those locally,
there is also no point in having broken ones in the repository :(

This just gives a wrong notion, and once someone would like
to use them, they will stumble into stupid problems.

Brgds,
Viktor

From dmacias at mail.udg.mx  Sat Nov  8 08:48:21 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 08:48:24 2008
Subject: [Harbour] Re: 2008-11-08 14:15 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491598A5.6060501@mail.udg.mx>

Viktor:

> >   * bin/hbmk_os2.cmd
 >>     + Added OpenWatcom support. Pls update it, f.e. I don't know
 >>       what is the name of the compiler executable.
 >>     ! Fixed HB_COMPILER branching. Looks like nobody uses this
 >>       file if this problem didn't show up so far, so I'd like to
 >>       propose again to remove this file completely, as there is
 >>       not much point spending time on maintaining stuff which
 >>       nobody uses or needs, is there?

 >I'd rather think that users have their own customized version
 >of old bld*.cmd and it's the reason why it was not tested so far.

I am using my own .cmd file based in hbmk_o2.cmd which has two or three 
errors plus HB_COMPILER branching error
I fixed them and added OpenWatcom support based in hbmk.bat, which has 
some missing values for OpenWatcom too

I want to send my "hbmk_os2.cmd" file at end of OW tests

If this file is removed, a A_OS2 section must be added to hbmk.bat to 
handle OS/2 platform/compilers, as very old bld.bat does so it can be 
easy to copy as .cmd file for end users
Perhaps a note in hbmk.bat for this change is useful

David Macias

From druzus at acn.waw.pl  Sat Nov  8 08:52:21 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 08:51:30 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491595A7.2010405@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<491595A7.2010405@mail.udg.mx>
Message-ID: <20081108135221.GA11558@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:
> Error happen
> -----------------
> _hb_gettid()
> TID=1
> _hb_gettid()
> TID=1
> _hb_gettid()
> TID=1
> _hb_gettid()
> TID=1
> _hb_gettid()
> TID=1
> _hb_gettid()
> TID=1
> _hb_gettid()
> TID=1
> _hb_gettid()
> TID=2
> _hb_gettid()
> TID=2
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.

So it's not exactly inside _hb_gettid(). Good I was afraid that
we will have to look for workaround to this function.

Let's check the whole mutex lock function.
I added 2 printf() calls to this function.

best regards,
Przemek



BOOL hb_threadMutexLock( PHB_ITEM pItem )
{
   PHB_MUTEX pMutex = hb_mutexPtr( pItem );
   BOOL fResult = FALSE;

   printf("1. hb_threadMutexLock()\r\n");fflush(stdout);

   if( pMutex )
   {
      if( HB_THREAD_EQUAL( pMutex->owner, HB_THREAD_SELF() ) )
      {
         pMutex->lock_count++;
         fResult = TRUE;
      }
      else
      {
         hb_vmUnlock();

#if !defined( HB_MT_VM )
         pMutex->lock_count = 1;
         pMutex->owner = HB_THREAD_SELF();
         fResult = TRUE;
#else
         HB_CRITICAL_LOCK( pMutex->mutex );
         while( pMutex->lock_count != 0 )
         {
            pMutex->lockers++;
#if defined( HB_PTHREAD_API )
            pthread_cond_wait( &pMutex->cond_l, &pMutex->mutex );
#else
            HB_CRITICAL_UNLOCK( pMutex->mutex );
            ( void ) HB_COND_WAIT( pMutex->cond_l );
            HB_CRITICAL_LOCK( pMutex->mutex );
#endif
            pMutex->lockers--;
         }
         pMutex->lock_count = 1;
         pMutex->owner = HB_THREAD_SELF();
         HB_CRITICAL_UNLOCK( pMutex->mutex );
         fResult = TRUE;
#endif
         hb_vmLock();
      }
   }

   printf("2. hb_threadMutexLock()\r\n");fflush(stdout);

   return fResult;
}
From dmacias at mail.udg.mx  Sat Nov  8 09:01:17 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 09:01:20 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49159BAD.7070701@mail.udg.mx>

 >So it's not exactly inside _hb_gettid(). Good I was afraid that
 >we will have to look for workaround to this function.

 >Let's check the whole mutex lock function.
 >I added 2 printf() calls to this function.
[...]

Error happen

Using -bm flag and hbvmmt

-----------------
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-----------------

David Macias


From dmacias at mail.udg.mx  Sat Nov  8 09:23:43 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 09:23:47 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4915A0EF.2090902@mail.udg.mx>

I used:

HB_EXPORT void hb_inkeyPoll( void )
{
    PHB_GT pGT;

    HB_TRACE( HB_TR_DEBUG, ("hb_inkeyPoll()") );

    printf("1. hb_inkeyPoll()\r\n");fflush(stdout);
    pGT = hb_gt_Base();
    printf("2. hb_inkeyPoll()\r\n");fflush(stdout);
    if( pGT )
    {
       printf("3. hb_inkeyPoll()\r\n");fflush(stdout);
       HB_GTSELF_INKEYPOLL( pGT );
       printf("4. hb_inkeyPoll()\r\n");fflush(stdout);
       hb_gt_BaseFree( pGT );
       printf("5. hb_inkeyPoll()\r\n");fflush(stdout);
    }
    printf("6. hb_inkeyPoll()\r\n");fflush(stdout);
}

In some pass of:
    HB_GTSELF_INKEYPOLL( pGT );

Error happen

Using -bm flag and hbvmmt

-----------------
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-----------------

David Macias



From druzus at acn.waw.pl  Sat Nov  8 09:24:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 09:23:57 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49159BAD.7070701@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49159BAD.7070701@mail.udg.mx>
Message-ID: <20081108142447.GA16221@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> 1. hb_threadMutexLock()
> _hb_gettid()
> TID=2
> _hb_gettid()
> TID=2
> 2. hb_threadMutexLock()
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.

The mutex locking is correct.
Next candidate are GTOS2 internals.
BTW have you tried to enable tracing?
It would help us to locate the problem quite fast.

best regards,
Przemek
From druzus at acn.waw.pl  Sat Nov  8 09:29:50 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 09:29:00 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20081108142447.GA16221@34-mo7-2.acn.waw.pl>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49159BAD.7070701@mail.udg.mx>
	<20081108142447.GA16221@34-mo7-2.acn.waw.pl>
Message-ID: <20081108142950.GB16221@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, Przemyslaw Czerpak wrote:

Hi David,

> The mutex locking is correct.
> Next candidate are GTOS2 internals.
> BTW have you tried to enable tracing?
> It would help us to locate the problem quite fast.

If you will have problems with tracing then please tests
code below. It's rtl/gtos2/gtos2.c hb_gt_os2_ReadKey()
replacement.

best regards,
Przemek


static int hb_gt_os2_ReadKey( PHB_GT pGT, int iEventMask )
{
   int ch;              /* next char if any */

   HB_TRACE(HB_TR_DEBUG, ("hb_gt_os2_ReadKey(%p,%d)", pGT, iEventMask));

   printf("1. hb_gt_os2_ReadKey()\r\n");fflush(stdout);

   /* zero out keyboard event record */
   memset( s_key, 0, sizeof( KBDKEYINFO ) );

   printf("2. hb_gt_os2_ReadKey()\r\n");fflush(stdout);
   /* Get next character without wait */
   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk );

   printf("3. hb_gt_os2_ReadKey()\r\n");fflush(stdout);
   /* extended key codes have 00h or E0h as chChar */
   if( ( s_key->fbStatus & KBDTRF_EXTENDED_CODE ) &&
       ( s_key->chChar == 0x00 || s_key->chChar == 0xE0 ) )
   {
      /* It was an extended function key lead-in code, so read the actual function key and then offset it by 256,
         unless extended keyboard events are allowed, in which case offset it by 512 */
      if( ( s_key->chChar == 0xE0 ) && ( iEventMask & INKEY_RAW ) )
         ch = ( int ) s_key->chScan + 512;
      else
         ch = ( int ) s_key->chScan + 256;
   }
   else if ( s_key->fbStatus & KBDTRF_FINAL_CHAR_IN )
      ch = ( int ) s_key->chChar;
   else
      ch = 0;

   ch = hb_gt_dos_keyCodeTranslate( ch );

   printf("4. hb_gt_os2_ReadKey()\r\n");fflush(stdout);
   if( ch == 0 )
      ch = HB_GTSELF_MOUSEREADKEY( pGT, iEventMask );

   printf("5. hb_gt_os2_ReadKey()\r\n");fflush(stdout);

   return ch;
}
From druzus at acn.waw.pl  Sat Nov  8 09:37:30 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 09:36:39 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4915A0EF.2090902@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4915A0EF.2090902@mail.udg.mx>
Message-ID: <20081108143730.GA14898@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> 2. hb_threadMutexLock()
> 2. hb_inkeyPoll()
> 3. hb_inkeyPoll()
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.

Try to check hb_gt_os2_ReadKey().
In the .prg test code I sent was:

   announce HB_GTSYS
   request HB_GT_STD_DEFAULT

Do you have it in your test?
Can you runn this application with //info parameter so we can confirm
the GT type?
Can you check also:

   announce HB_GTSYS
   request HB_GT_CGI_DEFAULT

and:
   announce HB_GTSYS
   request HB_GT_OS2_DEFAULT

best regards,
Przemek
From dmacias at mail.udg.mx  Sat Nov  8 09:59:37 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 09:59:39 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4915A959.7090607@mail.udg.mx>

 >In some pass of:
 >   HB_GTSELF_INKEYPOLL( pGT );

We have:
#define HB_GTSELF_INKEYPOLL(g) 
(g)->pFuncTable->InkeyPoll(g)

 >The mutex locking is correct.
 >Next candidate are GTOS2 internals.
 >BTW have you tried to enable tracing?
 >It would help us to locate the problem quite fast.

Not yet with hope to find problem with these tests

 >If you will have problems with tracing then please tests
 >code below. It's rtl/gtos2/gtos2.c hb_gt_os2_ReadKey()
 >replacement.

I think error will happen with any gt
hbrun_mt.exe is gtos2 and current .prg for tests is gtstd

 >> 2. hb_threadMutexLock()
 >> 2. hb_inkeyPoll()
 >> 3. hb_inkeyPoll()
 >> The process has stopped.  The software diagnostic
 >> code (exception code) is  0001.

 >Try to check hb_gt_os2_ReadKey().
 >In the .prg test code I sent was:

 >   announce HB_GTSYS
 >   request HB_GT_STD_DEFAULT

 >Do you have it in your test?
 >Can you runn this application with //info parameter so we can confirm
 >the GT type?

pba.exe //info

Mixed with other output
-----------------
Harbour Terminal: Standard stream console
-----------------

 >Can you check also:

 >   announce HB_GTSYS
 >   request HB_GT_CGI_DEFAULT

Harbour Terminal: Raw stream console
Harbour 1.1.0dev (Rev. 9846)
OS/2 4.50
DS avail=1720920KB  OS avail=1720920KB  EMM avail=0KB  MemStat:Off  MT:On


====  DOES NOT FAIL  =====
Results at end of message


 >and:
 >   announce HB_GTSYS
 >   request HB_GT_OS2_DEFAULT

Not tested yet with your code replacement

Harbour Terminal: OS/2 console
Harbour 1.1.0dev (Rev. 9846)
OS/2 4.50
DS avail=1720464KB  OS avail=1720464KB  EMM avail=0KB  MemStat:Off  MT:On
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.

Fail exactly at same point as HB_GT_STD_DEFAULT

---------
[...]
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
---------

David Macias


Using HB_GT_CGI_DEFAULT
-----------------------

_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=2
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
_hb_gettid()
TID=2
_hb_gettid()
TID=2
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1

From druzus at acn.waw.pl  Sat Nov  8 10:10:40 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 10:09:50 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4915A959.7090607@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4915A959.7090607@mail.udg.mx>
Message-ID: <20081108151040.GA8112@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Not yet with hope to find problem with these tests

Now we are nearly in the place.

> I think error will happen with any gt
> hbrun_mt.exe is gtos2 and current .prg for tests is gtstd

As you can see with GTCGI it's related to GT.
Looks like it's caused by keyboard related functions when
executed from non main thread.

> >Can you check also:
> >   announce HB_GTSYS
> >   request HB_GT_CGI_DEFAULT
> ====  DOES NOT FAIL  =====
> Results at end of message

> >and:
> >   announce HB_GTSYS
> >   request HB_GT_OS2_DEFAULT
> Not tested yet with your code replacement

This modification should show where exactly it fails.

best regards,
Przemek
From dmacias at mail.udg.mx  Sat Nov  8 10:18:18 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 10:18:23 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4915ADBA.1030300@mail.udg.mx>

>If you will have problems with tracing then please tests
>code below. It's rtl/gtos2/gtos2.c hb_gt_os2_ReadKey()
>replacement.
[...]


 >As you can see with GTCGI it's related to GT.
 >Looks like it's caused by keyboard related functions when
 >executed from non main thread.

 >> Not tested yet with your code replacement
 >This modification should show where exactly it fails.

Wait, I was doing test


Did you see this info in gtos2.c about 16 bit ?
-------------
  * Copyright 2000 - 2001 Maurilio Longo <maurilio.longo@libero.it>
  *    hb_gt_DispBegin() / hb_gt_DispEnd()
  *    hb_gt_ScreenPtr() and hb_gt_xYYYY() functions and virtual screen 
support inside hb_gt_XXXX()s
  *    16 bit KBD subsystem use inside hb_gt_os2_ReadKey()
-------------


Using HB_GT_OS2_DEFAULT

Harbour Terminal: OS/2 console
Harbour 1.1.0dev (Rev. 9846)
OS/2 4.50
DS avail=1721512KB  OS avail=1721512KB  EMM avail=0KB  MemStat:Off  MT:On

It pass (5) label tracing without problems and fail at same point

---------------
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_os2_ReadKey()    <-------
2. hb_gt_os2_ReadKey()
3. hb_gt_os2_ReadKey()
4. hb_gt_os2_ReadKey()
5. hb_gt_os2_ReadKey()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.

---------------


David Macias

From harbour.01 at syenar.hu  Sat Nov  8 10:20:24 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 10:20:24 2008
Subject: [Harbour] 2008-11-08 16:18 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c941b5$Blat.v2.6.2$85a3a470$12a48f47ec50@127.0.0.1>

2008-11-08 16:18 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/version.c
    + Implemented:
      hb_version( HB_VERSION_BUILD_DATE )
      hb_version( HB_VERSION_BUILD_TIME )

  * source/rtl/gtwvt/gtwvt.c
    * Formatting.

  * source/rdd/hbsix/sxini.prg
  * source/rdd/hbsix/sxcompat.prg
  * source/rdd/hbsix/sxtrig.prg
    * Formatted to std Harbour. Generated pcode unchanged.

  * ChangeLog
    * Marked finished TODO/TOFIXes as [DONE].
--
Brgds,
Viktor

From dmacias at mail.udg.mx  Sat Nov  8 10:35:47 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 10:35:50 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4915B1D3.5020009@mail.udg.mx>

>If you will have problems with tracing then please tests
>code below. It's rtl/gtos2/gtos2.c hb_gt_os2_ReadKey()
>replacement.

Could affect something (gtos2.c) ?

#if defined(HB_OS_OS2_GCC)
    /* 25/03/2000 - maurilio.longo@libero.it
    OS/2 GCC hasn't got ToolKit headers available */
    #include <stdlib.h>
#else
    #include <bsedos.h>
    #ifndef KBDTRF_EXTENDED_CODE
       #define KBDTRF_EXTENDED_CODE 0x02
    #endif
#endif

David Macias


From harbour.01 at syenar.hu  Sat Nov  8 10:43:34 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov  8 10:43:34 2008
Subject: [Harbour] 2008-11-08 16:43 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c941b8$Blat.v2.6.2$c22731ca$b44dc3508f0@127.0.0.1>

2008-11-08 16:43 UTC+0200 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/version.c
    % Minor.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sat Nov  8 10:49:19 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 10:48:29 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4915ADBA.1030300@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4915ADBA.1030300@mail.udg.mx>
Message-ID: <20081108154919.GA25467@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David.

> Did you see this info in gtos2.c about 16 bit ?
> -------------
>  * Copyright 2000 - 2001 Maurilio Longo <maurilio.longo@libero.it>
>  *    hb_gt_DispBegin() / hb_gt_DispEnd()
>  *    hb_gt_ScreenPtr() and hb_gt_xYYYY() functions and virtual screen 
> support inside hb_gt_XXXX()s
>  *    16 bit KBD subsystem use inside hb_gt_os2_ReadKey()
> -------------

Yes, I've seen it but if I understand the OS2 API dependencies it should
not be the source of the problem. At least not directly.

> Using HB_GT_OS2_DEFAULT
> 1. hb_threadMutexLock()
> _hb_gettid()
> TID=2
> _hb_gettid()
> TID=2
> 2. hb_threadMutexLock()
> 2. hb_inkeyPoll()
> 3. hb_inkeyPoll()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.

So it fails before hb_gt_os2_ReadKey().
Let's check all steps.
HB_GTSELF_INKEYPOLL( pGT ) executes hb_gt_def_InkeyPoll() from
hbgtcore.c. Then hb_gt_def_InkeyPollDo() is called which calls
   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );

Please change hb_gt_def_InkeyPoll() and hb_gt_def_InkeyPollDo().

best regards,
Przemek


/* helper internal function */
static void hb_gt_def_InkeyPollDo( PHB_GT pGT )
{
   int iKey;

   HB_TRACE( HB_TR_DEBUG, ("hb_gt_def_InkeyPollDo(%p)", pGT) );

   printf("1. "hb_gt_def_InkeyPollDo()\r\n");fflush(stdout);
   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
   printf("2. "hb_gt_def_InkeyPollDo()\r\n");fflush(stdout);

   if( iKey )
   {
      switch( iKey )
      {
         case HB_BREAK_FLAG:           /* Check for Ctrl+Break */
         case K_ALT_C:                 /* Check for normal Alt+C */
            if( hb_setGetCancel() )
            {
               hb_vmRequestCancel();   /* Request cancellation */
               return;
            }
            break;
         case K_ALT_D:                 /* Check for Alt+D */
            if( hb_setGetDebug() )
            {
               hb_vmRequestDebug();    /* Request the debugger */
               return;
            }
      }
      printf("3. "hb_gt_def_InkeyPollDo()\r\n");fflush(stdout);
      HB_GTSELF_INKEYPUT( pGT, iKey );
      printf("4. "hb_gt_def_InkeyPollDo()\r\n");fflush(stdout);
   }
}

/* Poll the console keyboard to stuff the Harbour buffer */
static void hb_gt_def_InkeyPoll( PHB_GT pGT )
{
   HB_TRACE( HB_TR_DEBUG, ("hb_gt_def_InkeyPoll(%p)", pGT) );

   /*
    * Clipper 5.3 always poll events without respecting
    * _SET_TYPEAHEAD when CL5.2 only when it's non zero.
    * IMHO keeping CL5.2 behavior will be more accurate for xharbour
    * because it allow to control it by user what some times could be
    * necessary due to different low level GT behavior on some platforms
    */
   printf("1. "hb_gt_def_InkeyPoll()\r\n");fflush(stdout);
   if( hb_setGetTypeAhead() )
   {
      printf("2. "hb_gt_def_InkeyPoll()\r\n");fflush(stdout);
      hb_gt_def_InkeyPollDo( pGT );
      printf("3. "hb_gt_def_InkeyPoll()\r\n");fflush(stdout);
   }
}

From info at fsgiudice.com  Sat Nov  8 11:08:09 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  8 11:08:18 2008
Subject: [Harbour] C syntax question
Message-ID: <4915B969.5080703@fsgiudice.com>

Hi all,

is there an equivalent of syntax of:

HB_FUNC( AFUNCTION )
{
    HB_FUNC_EXEC( ANOTHERFUNCTION );
}

for pure C functions like

void XGUI_ToOutDebug( const char * sTraceMsg, ... )
{
     hb_ToOutDebug( const char * sTraceMsg, ... );

}

or the only way is to define an header file with

#define XGUI_ToOutDebug( const char * sTraceMsg, ... ) hb_ToOutDebug( 
const char * sTraceMsg, ... )

I have tried also

void XGUI_ToOutDebug( const char * sTraceMsg, ... )
{
     &hb_ToOutDebug();

}

but compiler tell me that there is a wrong number of parameters.

Best Regards

Francesco
From dmacias at mail.udg.mx  Sat Nov  8 11:13:58 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 11:14:03 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4915BAC6.10905@mail.udg.mx>

 >So it fails before hb_gt_os2_ReadKey().
 >Let's check all steps.
 >HB_GTSELF_INKEYPOLL( pGT ) executes hb_gt_def_InkeyPoll() from
 >hbgtcore.c. Then hb_gt_def_InkeyPollDo() is called which calls
 >   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );

 >Please change hb_gt_def_InkeyPoll() and hb_gt_def_InkeyPollDo().

I corrected your C code  :-)

Using HB_GT_OS2_DEFAULT

Some pass in:
    iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );

---------------
[...]
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
---------------


David Macias

From druzus at acn.waw.pl  Sat Nov  8 11:33:49 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 11:33:00 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4915BAC6.10905@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4915BAC6.10905@mail.udg.mx>
Message-ID: <20081108163349.GA10588@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> I corrected your C code  :-)

:-) I'm writing it by hand in this messages only using mouse for
copy and past and here I marked " in function name. It's possible
that sth like that will happen, sorry.

> Some pass in:
>    iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
> ---------------
> [...]
> 1. hb_inkeyPoll()
> 1. hb_threadMutexLock()
> _hb_gettid()
> TID=2
> _hb_gettid()
> TID=2
> 2. hb_threadMutexLock()
> 2. hb_inkeyPoll()
> 3. hb_inkeyPoll()
> 1. hb_gt_def_InkeyPoll()
> 2. hb_gt_def_InkeyPoll()
> 1. hb_gt_def_InkeyPollDo()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.

And here it should execute hb_gt_os2_ReadKey().
Strange that we do not see "1. hb_gt_os2_ReadKey()" on the screen.
Maybe the message is overloaded by sth?
Please add at the begining of hb_gt_os2_ReadKey() before:

   HB_TRACE(HB_TR_DEBUG, ("hb_gt_os2_ReadKey(%p,%d)", pGT, iEventMask));

this line:

   printf("0. hb_gt_os2_ReadKey(%p)\r\n", s_key);fflush(stdout);

best regards,
Przemek
From dmacias at mail.udg.mx  Sat Nov  8 11:40:27 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 11:40:30 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4915C0FB.1010501@mail.udg.mx>

>So it fails before hb_gt_os2_ReadKey().
>Let's check all steps.
>HB_GTSELF_INKEYPOLL( pGT ) executes hb_gt_def_InkeyPoll() from
>hbgtcore.c. Then hb_gt_def_InkeyPollDo() is called which calls
>   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );

>Please change hb_gt_def_InkeyPoll() and hb_gt_def_InkeyPollDo().


Some pass in:
    iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );

I put tracing in
  static int hb_gt_def_ReadKey( PHB_GT pGT, int iEventMask )
and
  static int hb_gt_def_MouseReadKey( PHB_GT pGT, int iEventMask )

but never are executed

---------------
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
---------------

and there are NOT defined ( hbgtcore.c ) :

#if defined( __GNUC__ ) && 0
static HB_GT_FUNCS s_gtCoreFunc =
{
    Lock                       : hb_gt_def_Lock                          ,
    Unlock                     : hb_gt_def_Unlock                        ,
    Init                       : hb_gt_def_Init                          ,
    Exit                       : hb_gt_def_Exit                          ,
    New                        : hb_gt_def_New                           ,
    Free                       : hb_gt_def_Free                          ,
    Resize                     : hb_gt_def_Resize                        ,
    SetMode                    : hb_gt_def_SetMode                       ,
    GetSize                    : hb_gt_def_GetSize                       ,
    SemiCold                   : hb_gt_def_SemiCold                      ,
    ColdArea                   : hb_gt_def_ColdArea                      ,
    ExposeArea                 : hb_gt_def_ExposeArea                    ,
    ScrollArea                 : hb_gt_def_ScrollArea                    ,
    TouchCell                  : hb_gt_def_TouchCell                     ,
    Redraw                     : hb_gt_def_Redraw                        ,
    Refresh                    : hb_gt_def_Refresh                       ,
    Flush                      : hb_gt_def_Flush                         ,
    MaxCol                     : hb_gt_def_MaxCol                        ,
    MaxRow                     : hb_gt_def_MaxRow                        ,
    CheckPos                   : hb_gt_def_CheckPos                      ,
    SetPos                     : hb_gt_def_SetPos                        ,
    GetPos                     : hb_gt_def_GetPos                        ,
    IsColor                    : hb_gt_def_IsColor                       ,
    GetColorStr                : hb_gt_def_GetColorStr                   ,
    SetColorStr                : hb_gt_def_SetColorStr                   ,
    ColorSelect                : hb_gt_def_ColorSelect                   ,
    GetColor                   : hb_gt_def_GetColor                      ,
    ColorNum                   : hb_gt_def_ColorNum                      ,
    ColorsToString             : hb_gt_def_ColorsToString                ,
    StringToColors             : hb_gt_def_StringToColors                ,
    GetColorData               : hb_gt_def_GetColorData                  ,
    GetClearColor              : hb_gt_def_GetClearColor                 ,
    SetClearColor              : hb_gt_def_SetClearColor                 ,
    GetClearChar               : hb_gt_def_GetClearChar                  ,
    SetClearChar               : hb_gt_def_SetClearChar                  ,
    GetCursorStyle             : hb_gt_def_GetCursorStyle                ,
    SetCursorStyle             : hb_gt_def_SetCursorStyle                ,
    GetScrCursor               : hb_gt_def_GetScrCursor                  ,
    GetScrChar                 : hb_gt_def_GetChar                       ,
    PutScrChar                 : hb_gt_def_PutChar                       ,
    DispBegin                  : hb_gt_def_DispBegin                     ,
    DispEnd                    : hb_gt_def_DispEnd                       ,
    DispCount                  : hb_gt_def_DispCount                     ,
    GetChar                    : hb_gt_def_GetChar                       ,
    PutChar                    : hb_gt_def_PutChar                       ,
    RectSize                   : hb_gt_def_RectSize                      ,
    Save                       : hb_gt_def_Save                          ,
    Rest                       : hb_gt_def_Rest                          ,
    PutText                    : hb_gt_def_PutText                       ,
    Replicate                  : hb_gt_def_Replicate                     ,
    WriteAt                    : hb_gt_def_WriteAt                       ,
    Write                      : hb_gt_def_Write                         ,
    WriteCon                   : hb_gt_def_WriteCon                      ,
    SetAttribute               : hb_gt_def_SetAttribute                  ,
    DrawShadow                 : hb_gt_def_DrawShadow                    ,
    Scroll                     : hb_gt_def_Scroll                        ,
    ScrollUp                   : hb_gt_def_ScrollUp                      ,
    Box                        : hb_gt_def_Box                           ,
    BoxD                       : hb_gt_def_BoxD                          ,
    BoxS                       : hb_gt_def_BoxS                          ,
    HorizLine                  : hb_gt_def_HorizLine                     ,
    VertLine                   : hb_gt_def_VertLine                      ,
    GetBlink                   : hb_gt_def_GetBlink                      ,
    SetBlink                   : hb_gt_def_SetBlink                      ,
    SetSnowFlag                : hb_gt_def_SetSnowFlag                   ,
    Version                    : hb_gt_def_Version                       ,
    Suspend                    : hb_gt_def_Suspend                       ,
    Resume                     : hb_gt_def_Resume                        ,
    PreExt                     : hb_gt_def_PreExt                        ,
    PostExt                    : hb_gt_def_PostExt                       ,
    OutStd                     : hb_gt_def_OutStd                        ,
    OutErr                     : hb_gt_def_OutErr                        ,
    Tone                       : hb_gt_def_Tone                          ,
    Bell                       : hb_gt_def_Bell                          ,
    Info                       : hb_gt_def_Info                          ,
    Alert                      : hb_gt_def_Alert                         ,
    SetFlag                    : hb_gt_def_SetFlag                       ,
    SetDispCP                  : hb_gt_def_SetDispCP                     ,
    SetKeyCP                   : hb_gt_def_SetKeyCP                      ,
    ReadKey                    : hb_gt_def_ReadKey                       ,
    InkeyGet                   : hb_gt_def_InkeyGet                      ,
    InkeyPut                   : hb_gt_def_InkeyPut                      ,
    InkeyIns                   : hb_gt_def_InkeyIns                      ,
    InkeyLast                  : hb_gt_def_InkeyLast                     ,
    InkeyNext                  : hb_gt_def_InkeyNext                     ,
    InkeyPoll                  : hb_gt_def_InkeyPoll                     ,
    InkeySetText               : hb_gt_def_InkeySetText                  ,
    InkeySetLast               : hb_gt_def_InkeySetLast                  ,
    InkeyReset                 : hb_gt_def_InkeyReset                    ,
    InkeyExit                  : hb_gt_def_InkeyExit                     ,
    MouseInit                  : hb_gt_def_MouseInit                     ,
    MouseExit                  : hb_gt_def_MouseExit                     ,
    MouseIsPresent             : hb_gt_def_MouseIsPresent                ,
    MouseShow                  : hb_gt_def_MouseShow                     ,
    MouseHide                  : hb_gt_def_MouseHide                     ,
    MouseGetCursor             : hb_gt_def_MouseGetCursor                ,
    MouseSetCursor             : hb_gt_def_MouseSetCursor                ,
    MouseCol                   : hb_gt_def_MouseCol                      ,
    MouseRow                   : hb_gt_def_MouseRow                      ,
    MouseGetPos                : hb_gt_def_MouseGetPos                   ,
    MouseSetPos                : hb_gt_def_MouseSetPos                   ,
    MouseSetBounds             : hb_gt_def_MouseSetBounds                ,
    MouseGetBounds             : hb_gt_def_MouseGetBounds                ,
    MouseStorageSize           : hb_gt_def_mouseStorageSize              ,
    MouseSaveState             : hb_gt_def_mouseSaveState                ,
    MouseRestoreState          : hb_gt_def_mouseRestoreState             ,
    MouseGetDoubleClickSpeed   : hb_gt_def_mouseGetDoubleClickSpeed      ,
    MouseSetDoubleClickSpeed   : hb_gt_def_mouseSetDoubleClickSpeed      ,
    MouseCountButton           : hb_gt_def_MouseCountButton              ,
    MouseButtonState           : hb_gt_def_MouseButtonState              ,
    MouseButtonPressed         : hb_gt_def_MouseButtonPressed            ,
    MouseButtonReleased        : hb_gt_def_MouseButtonReleased           ,
    MouseReadKey               : hb_gt_def_MouseReadKey                  ,
    GfxPrimitive               : hb_gt_def_GfxPrimitive                  ,
    GfxText                    : hb_gt_def_GfxText                       ,
    WhoCares                   : hb_gt_def_WhoCares
};
#else
static HB_GT_FUNCS s_gtCoreFunc =
{
    hb_gt_def_Lock                         ,
    hb_gt_def_Unlock                       ,
    hb_gt_def_Init                         ,
    hb_gt_def_Exit                         ,
    hb_gt_def_New                          ,
    hb_gt_def_Free                         ,
    hb_gt_def_Resize                       ,
    hb_gt_def_SetMode                      ,
    hb_gt_def_GetSize                      ,
    hb_gt_def_SemiCold                     ,
    hb_gt_def_ColdArea                     ,
    hb_gt_def_ExposeArea                   ,
    hb_gt_def_ScrollArea                   ,
    hb_gt_def_TouchCell                    ,
    hb_gt_def_Redraw                       ,
    hb_gt_def_Refresh                      ,
    hb_gt_def_Flush                        ,
    hb_gt_def_MaxCol                       ,
    hb_gt_def_MaxRow                       ,
    hb_gt_def_CheckPos                     ,
    hb_gt_def_SetPos                       ,
    hb_gt_def_GetPos                       ,
    hb_gt_def_IsColor                      ,
    hb_gt_def_GetColorStr                  ,
    hb_gt_def_SetColorStr                  ,
    hb_gt_def_ColorSelect                  ,
    hb_gt_def_GetColor                     ,
    hb_gt_def_ColorNum                     ,
    hb_gt_def_ColorsToString               ,
    hb_gt_def_StringToColors               ,
    hb_gt_def_GetColorData                 ,
    hb_gt_def_GetClearColor                ,
    hb_gt_def_SetClearColor                ,
    hb_gt_def_GetClearChar                 ,
    hb_gt_def_SetClearChar                 ,
    hb_gt_def_GetCursorStyle               ,
    hb_gt_def_SetCursorStyle               ,
    hb_gt_def_GetScrCursor                 ,
    hb_gt_def_GetChar                      , /* intentionally mapped to 
GetScrChar */
    hb_gt_def_PutChar                      , /* intentionally mapped to 
PutScrChar */
    hb_gt_def_DispBegin                    ,
    hb_gt_def_DispEnd                      ,
    hb_gt_def_DispCount                    ,
    hb_gt_def_GetChar                      ,
    hb_gt_def_PutChar                      ,
    hb_gt_def_RectSize                     ,
    hb_gt_def_Save                         ,
    hb_gt_def_Rest                         ,
    hb_gt_def_PutText                      ,
    hb_gt_def_Replicate                    ,
    hb_gt_def_WriteAt                      ,
    hb_gt_def_Write                        ,
    hb_gt_def_WriteCon                     ,
    hb_gt_def_SetAttribute                 ,
    hb_gt_def_DrawShadow                   ,
    hb_gt_def_Scroll                       ,
    hb_gt_def_ScrollUp                     ,
    hb_gt_def_Box                          ,
    hb_gt_def_BoxD                         ,
    hb_gt_def_BoxS                         ,
    hb_gt_def_HorizLine                    ,
    hb_gt_def_VertLine                     ,
    hb_gt_def_GetBlink                     ,
    hb_gt_def_SetBlink                     ,
    hb_gt_def_SetSnowFlag                  ,
    hb_gt_def_Version                      ,
    hb_gt_def_Suspend                      ,
    hb_gt_def_Resume                       ,
    hb_gt_def_PreExt                       ,
    hb_gt_def_PostExt                      ,
    hb_gt_def_OutStd                       ,
    hb_gt_def_OutErr                       ,
    hb_gt_def_Tone                         ,
    hb_gt_def_Bell                         ,
    hb_gt_def_Info                         ,
    hb_gt_def_Alert                        ,
    hb_gt_def_SetFlag                      ,
    hb_gt_def_SetDispCP                    ,
    hb_gt_def_SetKeyCP                     ,
    hb_gt_def_ReadKey                      ,
    hb_gt_def_InkeyGet                     ,
    hb_gt_def_InkeyPut                     ,
    hb_gt_def_InkeyIns                     ,
    hb_gt_def_InkeyLast                    ,
    hb_gt_def_InkeyNext                    ,
    hb_gt_def_InkeyPoll                    ,
    hb_gt_def_InkeySetText                 ,
    hb_gt_def_InkeySetLast                 ,
    hb_gt_def_InkeyReset                   ,
    hb_gt_def_InkeyExit                    ,
    hb_gt_def_MouseInit                    ,
    hb_gt_def_MouseExit                    ,
    hb_gt_def_MouseIsPresent               ,
    hb_gt_def_MouseShow                    ,
    hb_gt_def_MouseHide                    ,
    hb_gt_def_MouseGetCursor               ,
    hb_gt_def_MouseSetCursor               ,
    hb_gt_def_MouseCol                     ,
    hb_gt_def_MouseRow                     ,
    hb_gt_def_MouseGetPos                  ,
    hb_gt_def_MouseSetPos                  ,
    hb_gt_def_MouseSetBounds               ,
    hb_gt_def_MouseGetBounds               ,
    hb_gt_def_mouseStorageSize             ,
    hb_gt_def_mouseSaveState               ,
    hb_gt_def_mouseRestoreState            ,
    hb_gt_def_mouseGetDoubleClickSpeed     ,
    hb_gt_def_mouseSetDoubleClickSpeed     ,
    hb_gt_def_MouseCountButton             ,
    hb_gt_def_MouseButtonState             ,
    hb_gt_def_MouseButtonPressed           ,
    hb_gt_def_MouseButtonReleased          ,
    hb_gt_def_MouseReadKey                 ,
    hb_gt_def_GfxPrimitive                 ,
    hb_gt_def_GfxText                      ,
    hb_gt_def_WhoCares
};
#endif

David Macias


From info at fsgiudice.com  Sat Nov  8 11:43:53 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  8 11:44:00 2008
Subject: [Harbour] C syntax question
In-Reply-To: <4915B969.5080703@fsgiudice.com>
References: <4915B969.5080703@fsgiudice.com>
Message-ID: <4915C1C9.1070409@fsgiudice.com>

Hi All,

solved via header files.
(I think that is the right way)

Best regards

Francesco

Il 08/11/2008 17.08, Francesco Saverio Giudice ha scritto:
> Hi all,
> 
> is there an equivalent of syntax of:
> 
From druzus at acn.waw.pl  Sat Nov  8 12:00:32 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 11:59:41 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4915C0FB.1010501@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4915C0FB.1010501@mail.udg.mx>
Message-ID: <20081108170032.GA8165@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Some pass in:
>    iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
> I put tracing in
>  static int hb_gt_def_ReadKey( PHB_GT pGT, int iEventMask )
> and
>  static int hb_gt_def_MouseReadKey( PHB_GT pGT, int iEventMask )
> but never are executed

It's expected. They are overloaded by GT driver

> ---------------
> 2. hb_inkeyPoll()
> 3. hb_inkeyPoll()
> 1. hb_gt_def_InkeyPoll()
> 2. hb_gt_def_InkeyPoll()
> 1. hb_gt_def_InkeyPollDo()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> ---------------

> and there are NOT defined ( hbgtcore.c ) :

They are:
[...]
>    hb_gt_def_ReadKey                      ,
[...]
>    hb_gt_def_MouseReadKey                 ,

In hb_gt_def_InkeyPollDo():

   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );

in hb_gt_def_InkeyPollDo() executes low level GT driver READKEY()
method. In GTOS2 it's hb_gt_os2_ReadKey(). Please also note that
it works for 1-st thread and fails only for the second one so the
problem is bound with low level GT code. In GTCGI READKEY() does
nothing and only returns K_ENTER code:

   static int hb_gt_cgi_ReadKey( PHB_GT pGT, int iEventMask )
   {
      HB_TRACE(HB_TR_DEBUG, ("hb_gt_cgi_ReadKey(%p,%d)", pGT, iEventMask));

      HB_SYMBOL_UNUSED( pGT );
      HB_SYMBOL_UNUSED( iEventMask );

      return 13;
   }

In GTOS2 and GTSTD low level keyboard code is activated and it causes
that application fails.

best regards,
Przemek
From dmacias at mail.udg.mx  Sat Nov  8 12:04:20 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 12:04:24 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4915C694.7060305@mail.udg.mx>

 >And here it should execute hb_gt_os2_ReadKey().
 >Strange that we do not see "1. hb_gt_os2_ReadKey()" on the screen.
 >Maybe the message is overloaded by sth?
 >Please add at the begining of hb_gt_os2_ReadKey() before:

 >   HB_TRACE(HB_TR_DEBUG, ("hb_gt_os2_ReadKey(%p,%d)", pGT, iEventMask));

 >this line:

 >   printf("0. hb_gt_os2_ReadKey(%p)\r\n", s_key);fflush(stdout);

Clarification:

hb_gt_os2_ReadKey() is working fine, but it happen many steps before 
error. I marked it to you in tracing list (you skiped it, review it)

This is the part involved:
--------------------------
[...]
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_os2_ReadKey()    <-------
2. hb_gt_os2_ReadKey()
3. hb_gt_os2_ReadKey()
4. hb_gt_os2_ReadKey()
5. hb_gt_os2_ReadKey()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
[...]
--------------------------

David Macias



From druzus at acn.waw.pl  Sat Nov  8 12:28:19 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 12:27:28 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4915C694.7060305@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4915C694.7060305@mail.udg.mx>
Message-ID: <20081108172818.GA7350@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> hb_gt_os2_ReadKey() is working fine, but it happen many steps before error. 

Where did you found such information?

> I marked it to you in tracing list (you skiped it, review it)
> TID=1
> 2. hb_threadMutexLock()
> 2. hb_inkeyPoll()
> 3. hb_inkeyPoll()
> 1. hb_gt_os2_ReadKey()    <-------
> 2. hb_gt_os2_ReadKey()
> 3. hb_gt_os2_ReadKey()
> 4. hb_gt_os2_ReadKey()
> 5. hb_gt_os2_ReadKey()
> 4. hb_inkeyPoll()

It's 1-st thread. Everything works correctly for thread 1.
The problem is only with thread 2.

best regards,
Przemek
From info at fsgiudice.com  Sat Nov  8 12:41:46 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  8 12:41:56 2008
Subject: [Harbour] 2008-11-08 18:40 UTC+0100 Francesco Saverio Giudice (info
 fsgiudice com)
Message-ID: <4915CF5A.7060704@fsgiudice.com>

2008-11-08 18:40 UTC+0100 Francesco Saverio Giudice (info fsgiudice com)
   - contrib/hbdbgfx
   - contrib/hbdbgfx/common.mak
   - contrib/hbdbgfx/dbgfx.prg
   - contrib/hbdbgfx/dbgfxc.c
   - contrib/hbdbgfx/hbdbgfx.h
   - contrib/hbdbgfx/make_b32.bat
   - contrib/hbdbgfx/make_gcc.sh
   - contrib/hbdbgfx/make_vc.bat
   - contrib/hbdbgfx/Makefile
   - contrib/hbdbgfx/sprintf.prg
   + contrib/xhb/dbgfx.prg
   + contrib/xhb/dbgfxc.c
   + contrib/xhb/sprintf.prg
   + contrib/xhb/xhb.h
   * contrib/make_b32_all.bat
   * contrib/make_vc_all.bat
   * contrib/xhb/common.mak
   * contrib/xhb/Makefile
     * moved hbdbgfx to xhb folder


Best regards

Francesco

From info at fsgiudice.com  Sat Nov  8 12:51:18 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov  8 12:51:24 2008
Subject: [Harbour] 2008-11-01 15:47 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <E704CF46-657E-4FBA-BC69-81712524885A@syenar.hu>
References: <01c93c31$Blat.v2.6.2$fa41f360$184c795512d2@127.0.0.1>	<490CD442.7080406@fsgiudice.com>	<4A394A66-CE1F-4132-80DA-6F6CF819A87E@syenar.hu>	<490CEB67.40103@fsgiudice.com>
	<E704CF46-657E-4FBA-BC69-81712524885A@syenar.hu>
Message-ID: <4915D196.9010007@fsgiudice.com>

Hi Viktor,

Il 08/11/2008 14.39, Szak?ts Viktor ha scritto:
> Hi Francesco,
> 

> My vote is to implement your solution inside xhb lib,
> this way the already known xhb API will get a better
> implementation, and everyone can just as well use it
> by linking xhb lib.
>

Done

> [ Maybe it or its parts can once be made the default
> Harbour logging facility (probably under different
> API names). In my understanding though, logging should
> be fully portable and solved using just the basic file
> functions and possibly some prospects to make sure no
> log entries are lost, even in case the target disk is
> temporarily inaccessible). ]
> 

I'll review, some times ago I wrote a syslog server based on a sample 
from Giancarlo but with standard message of a syslog server, probably it 
could be a starting point.


Best regards

Francesco
From bedipritpal at hotmail.com  Sat Nov  8 13:31:28 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov  8 13:31:34 2008
Subject: [Harbour] 2008-11-08 10:23 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20398945.post@talk.nabble.com>


2008-11-08 10:23 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    ! Updated to match current GTWVT.

  * harbour/contrib/gtwvg/wvgutils.c
    + HB_FUNC( WIN_DESTROYWINDOW ) - Winapi compatible function.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-08-10%3A23-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20398945p20398945.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Sat Nov  8 13:53:31 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov  8 13:52:44 2008
Subject: [Harbour] 2008-11-08 19:53 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081108185331.GA4149@34-mo7-2.acn.waw.pl>

2008-11-08 19:53 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/make_gcc.mak
    ! corrected missing $(HARBOUR_EXE) dependence in .prg files rules
    ! replaced non indirect rules (::) which are strictly file base with
      indirect ones to not confuse dependence logic when parallel
      compilation is enabled
    ! marked harbour.c and cmdarg.c as dependent on pptable.c to fix
      compilation order - these files needs hbverbld.h which is generated
      together with pptable.c
    ! fixed HBTESTDLL_EXE dependencies - static library were used instead
      of harbour share library. BTW probably it will be good to create also
      HBRUNDLL_EXE

      With above modification parallel compilation can be enabled for
      make_gcc.sh (-j<N> GNU make option). It greatly improves compilation
      speed. Probably also make_{bcc,vc}.mak should be fixed even if they
      do not support parallel compilation.

best regards
Przemek
From bedipritpal at hotmail.com  Sat Nov  8 18:48:14 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov  8 18:48:18 2008
Subject: [Harbour] 2008-11-08 15:40 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20401804.post@talk.nabble.com>


2008-11-08 15:40 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/gtwvg/gtwvg.h
  * harbour/source/rtl/gtwvt/gtwvt.c
  * harbour/source/rtl/gtwvt/gtwvt.h
    
    + BOOL bResizing
    + BOOL bAlreadySizing
      To control unnecessary code execution while sizing operation is 
      being carried out. Now the flickering of console window should be
      greatly minimized, IMO, please test.

    ! Fixed behavior of some function not to recreate font if one is already
      created given other parameters are the same. SetMode() does nothing if
      nRows, nCols are the same as with console prior to calling this
function.
     
    ; NOTE: Please test extensively as this is one gray area of GTWVT we all
      are in a quest to fix.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-08-15%3A40-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20401804p20401804.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dmacias at mail.udg.mx  Sat Nov  8 20:06:36 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 20:06:40 2008
Subject: [Harbour] Re: Harbour under Win32 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4916379C.5030200@mail.udg.mx>

 > I've also teststed 1.7a in Linux and WINE and it works correctly.
 > The native Linux build does not work due to missing functions and
 > some typos in header files. In spare time I'll try to collect my
 > local OW patches and send them to OW devel list.

 >> hbrun_st.exe speedtst.prg
 >> --------------------------
 >> [ total application time: ]....................................67.08
 >> [ total real time: ]...........................................67.34
 >>
 >> hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
 >> --------------------------
<> [ total application time: ]...................................104.42
 >> [ total real time: ]..........................................107.14

 >Try to rebuild Harbour with HB_FM_DL_ALLOC and USE_DL_PREFIX macros, 
 >f.e.:
 >   set C_USR=-DHB_FM_DL_ALLOC -DUSE_DL_PREFIX
 >and recompile Harbour. Then compare speed results for both modes.

Not so much difference:

hbrun_st.exe speedtst.prg
--------------------------
[ total application time: ]....................................61.39
[ total real time: ]...........................................61.74

hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
--------------------------
[ total application time: ]...................................104.03
[ total real time: ]..........................................104.53

David Macias


hbrun_st.exe speedtst.prg
--------------------------

Warning !!! Memory statistic enabled.

11/08/08 18:49:55 Windows XP 5.1.2600 Service Pack 2
Harbour 1.1.0dev (Rev. 9854) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 0
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.16
====================================================================
[ T001: x := L_C ]..............................................0.13
[ T002: x := L_N ]..............................................0.13
[ T003: x := L_D ]..............................................0.13
[ T004: x := S_C ]..............................................0.11
[ T005: x := S_N ]..............................................0.11
[ T006: x := S_D ]..............................................0.09
[ T007: x := M_C ]..............................................0.13
[ T008: x := M_N ]..............................................0.13
[ T009: x := M_D ]..............................................0.11
[ T010: x := P_C ]..............................................0.11
[ T011: x := P_N ]..............................................0.09
[ T012: x := P_D ]..............................................0.11
[ T013: x := F_C ]..............................................0.47
[ T014: x := F_N ]..............................................0.38
[ T015: x := F_D ]..............................................0.25
[ T016: x := o:GenCode ]........................................0.39
[ T017: x := o[8] ].............................................0.27
[ T018: round( i / 1000, 2 ) ]..................................0.47
[ T019: str( i / 1000 ) ].......................................1.16
[ T020: val( s ) ]..............................................0.45
[ T021: val( a [ i % 16 + 1 ] ) ]...............................0.83
[ T022: dtos( d - i % 10000 ) ].................................1.19
[ T023: eval( { || i % 16 } ) ].................................1.39
[ T024: eval( bc := { || i % 16 } ) ]...........................0.45
[ T025: eval( { |x| x % 16 }, i ) ].............................1.11
[ T026: eval( bc := { |x| x % 16 }, i ) ].......................0.50
[ T027: eval( { |x| f1( x ) }, i ) ]............................1.31
[ T028: eval( bc := { |x| f1( x ) }, i ) ]......................0.70
[ T029: x := &( "f1(" + str(i) + ")" ) ]........................7.08
[ T030: bc := &( "{|x|f1(x)}" ); eval( bc, i ) ]................8.86
[ T031: x := valtype( x ) +  valtype( i ) ].....................1.06
[ T032: x := strzero( i % 100, 2 ) $ a[ i % 16 + 1 ] ]..........1.72
[ T033: x := a[ i % 16 + 1 ] == s ].............................0.66
[ T034: x := a[ i % 16 + 1 ] = s ]..............................0.72
[ T035: x := a[ i % 16 + 1 ] >= s ].............................0.72
[ T036: x := a[ i % 16 + 1 ] <= s ].............................0.75
[ T037: x := a[ i % 16 + 1 ] < s ]..............................0.70
[ T038: x := a[ i % 16 + 1 ] > s ]..............................0.73
[ T039: ascan( a, i % 16 ) ]....................................0.61
[ T040: ascan( a, { |x| x == i % 16 } ) ].......................6.44
[ T041: if i%1000==0;a:={};end; aadd(a,{i,1,.T.,s,s2,a2,bc ]....3.44
[ T042: x := a ]................................................0.16
[ T043: x := {} ]...............................................0.42
[ T044: f0() ]..................................................0.22
[ T045: f1( i ) ]...............................................0.34
[ T046: f2( c[1...8] ) ]........................................0.33
[ T047: f2( c[1...40000] ) ]....................................0.33
[ T048: f2( @c[1...40000] ) ]...................................0.31
[ T049: f2( @c[1...40000] ), c2 := c ]..........................0.44
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]....................0.91
[ T051: f2( a ) ]...............................................0.33
[ T052: x := f4() ].............................................1.23
[ T053: x := f5() ].............................................0.78
[ T054: f_prv( c ) ]............................................0.97
====================================================================
[ total application time: ]....................................61.39
[ total real time: ]...........................................61.74



hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
--------------------------

Warning !!! Memory statistic enabled.

11/08/08 18:51:51 Windows XP 5.1.2600 Service Pack 2
Harbour 1.1.0dev (Rev. 9854) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
excluded tests: 029 030 023 025 027 040 041 043 052 053 019 022 031 032 054
                                                         1 th.  2 th. 
factor
============================================================================
[ T001: x := L_C ]____________________________________  0.72   0.74 ->  0.98
[ T002: x := L_N ]____________________________________  0.66   0.66 ->  1.00
[ T003: x := L_D ]____________________________________  0.64   0.64 ->  1.00
[ T004: x := S_C ]____________________________________  0.69   0.73 ->  0.94
[ T005: x := S_N ]____________________________________  0.63   0.61 ->  1.02
[ T006: x := S_D ]____________________________________  0.59   0.61 ->  0.97
[ T007: x := M_C ]____________________________________  0.69   0.70 ->  0.98
[ T008: x := M_N ]____________________________________  0.64   0.63 ->  1.03
[ T009: x := M_D ]____________________________________  0.63   0.63 ->  1.00
[ T010: x := P_C ]____________________________________  0.67   0.66 ->  1.02
[ T011: x := P_N ]____________________________________  0.63   0.63 ->  1.00
[ T012: x := P_D ]____________________________________  0.63   0.63 ->  1.00
[ T013: x := F_C ]____________________________________  1.61   1.61 ->  1.00
[ T014: x := F_N ]____________________________________  1.14   1.14 ->  1.00
[ T015: x := F_D ]____________________________________  0.86   0.86 ->  1.00
[ T016: x := o:GenCode ]______________________________  1.30   1.31 ->  0.99
[ T017: x := o[8] ]___________________________________  1.05   1.05 ->  1.00
[ T018: round( i / 1000, 2 ) ]________________________  1.56   1.56 ->  1.00
[ T020: val( s ) ]____________________________________  1.47   1.49 ->  0.99
[ T021: val( a [ i % 16 + 1 ] ) ]_____________________  3.00   3.00 ->  1.00
[ T024: eval( bc := { || i % 16 } ) ]_________________  1.72   1.72 ->  1.00
[ T026: eval( bc := { |x| x % 16 }, i ) ]_____________  1.81   1.81 ->  1.00
[ T028: eval( bc := { |x| f1( x ) }, i ) ]____________  2.20   2.19 ->  1.01
[ T033: x := a[ i % 16 + 1 ] == s ]___________________  2.09   2.08 ->  1.01
[ T034: x := a[ i % 16 + 1 ] = s ]____________________  2.22   2.20 ->  1.01
[ T035: x := a[ i % 16 + 1 ] >= s ]___________________  2.22   2.20 ->  1.01
[ T036: x := a[ i % 16 + 1 ] <= s ]___________________  2.23   2.27 ->  0.99
[ T037: x := a[ i % 16 + 1 ] < s ]____________________  2.23   2.22 ->  1.01
[ T038: x := a[ i % 16 + 1 ] > s ]____________________  2.19   2.19 ->  1.00
[ T039: ascan( a, i % 16 ) ]__________________________  2.00   2.02 ->  0.99
[ T042: x := a ]______________________________________  0.75   0.73 ->  1.02
[ T044: f0() ]________________________________________  0.89   0.91 ->  0.98
[ T045: f1( i ) ]_____________________________________  1.20   1.20 ->  1.00
[ T046: f2( c[1...8] ) ]______________________________  1.14   1.14 ->  1.00
[ T047: f2( c[1...40000] ) ]__________________________  1.13   1.14 ->  0.99
[ T048: f2( @c[1...40000] ) ]_________________________  1.16   1.14 ->  1.01
[ T049: f2( @c[1...40000] ), c2 := c ]________________  1.47   1.47 ->  1.00
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]__________  2.59   2.58 ->  1.01
[ T051: f2( a ) ]_____________________________________  1.20   1.19 ->  1.01
============================================================================
[   TOTAL   ]_________________________________________ 52.23  52.25 ->  1.00
============================================================================
[ total application time: ]...................................104.03
[ total real time: ]..........................................104.53

From dmacias at mail.udg.mx  Sat Nov  8 21:07:30 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sat Nov  8 21:07:33 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491645E2.3000700@mail.udg.mx>

 >So it will crashes inside hb_vmExecute()
 >Please try to commenct line 1127 in hvm.c
 >         hb_inkeyPoll();
 >to eliminate yet another possibly danger place and make test.
 >
 >Farther tracing using this methods will not be effective.
 >hb_vmExecute() operates on too many functions.
 >It will be necessary to use OpenWatcom debugger or enable
 >Harbour tracing. Please look at doc/tracing.txt.
 >It's not MT fully safe so some line numbers and/or file names
 >can be wrong but rest should be correct and enough of us. Of
 >course if fileio in MT safe in OpenWatcom.
 >Recompile Harbour using HB_TR_LEVEL_DEBUG macro. Make
 >   set C_USR=-DHB_TR_LEVEL_DEBUG
 >and rebuild Harbour and test code.
 >Then before you execute test application make:
 >  set HB_TR_LEVEL=HB_TR_DEBUG
 >  set HB_TR_FLUSH=1
 >  set HB_TR_OUTPUT=trace.log

 >It should generate trace.log file with called functions.
 >Please compress this file and send it to my private e-mail.

Rebuilt Harbour with
   set C_USR=-DHB_FM_STATISTICS_OFF -DHB_TR_LEVEL_DEBUG

Before running new test application (pba.exe):
   set HB_TR_LEVEL=HB_TR_DEBUG
   set HB_TR_FLUSH=1
   set HB_TR_OUTPUT=trace.log

and results are:
----------------
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.
----------------

trace.log are never created
------------
dir /od
[...]
  8/11/08  7:21p         5,218      0 a---  mi_ow.cmd
  8/11/08  7:35p       254,571      0 a---  make_ow.log
  8/11/08  7:43p       972,753      0 a---  pba.exe
        53 file(s)   5,288,427 bytes used

------------
[E:\harbour810\harbour]dir ..\trace.log /s

The volume label in drive E is ECS.
The Volume Serial Number is A913:E015.

SYS0002: The system cannot find the file specified.
------------

Testing with hbvm.lib ( without MT ) work fine creating trace.log with 
2,970 lines
-----------
func main
  qout( "hello world" )
return nil
-----------

So Harbour tracing fails in MT / OW

David Macias


From harbour20082008 at hotmail.com  Sun Nov  9 00:51:36 2008
From: harbour20082008 at hotmail.com (Harbour 2008)
Date: Sun Nov  9 00:51:39 2008
Subject: [Harbour] Test
Message-ID: <BAY121-W5153E18408124FF62D1A42BE1B0@phx.gbl>


Just a test, sorry

_________________________________________________________________
Easily edit your photos like a pro with Photo Gallery.
http://get.live.com/photogallery/overview
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081109/d96d5fc0/attachment.html
From druzus at acn.waw.pl  Sun Nov  9 05:45:49 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 05:44:57 2008
Subject: [Harbour] 2008-11-09 11:45 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081109104549.GA22410@34-mo7-2.acn.waw.pl>

2008-11-09 11:45 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/make_gcc.mak
    ! declared non file helper rules as .PHONY ones.
    ! fixed bad typo in helper rules usage - strange that I haven't seen
      it before.
    * restored non indirect rules - now they should work as expected
      also in parallel builds.
      TODO: remove static libraries from HB_BUILD_TARGETS in common.mak
      if everything is correct then they should be created to satisfy
      hbrun and other tools dependencies. It's not necessary to explicitly
      duplicate it.

best regards
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 05:49:57 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 05:50:05 2008
Subject: [Harbour] 2008-11-08 15:40 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20401804.post@talk.nabble.com>
References: <20401804.post@talk.nabble.com>
Message-ID: <AF87AC27-A452-4B42-86EC-111361D58D1B@syenar.hu>

Hi Pritpal,

Please turn off UNICODE mode in you editor.

Brgds,
Viktor

On 2008.11.09., at 0:48, Pritpal Bedi wrote:

>
> 2008-11-08 15:40 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>  * harbour/contrib/gtwvg/gtwvg.c
>  * harbour/contrib/gtwvg/gtwvg.h
>  * harbour/source/rtl/gtwvt/gtwvt.c
>  * harbour/source/rtl/gtwvt/gtwvt.h
>
>    + BOOL bResizing
>    + BOOL bAlreadySizing
>      To control unnecessary code execution while sizing operation is
>      being carried out. Now the flickering of console window should be
>      greatly minimized, IMO, please test.
>
>    ! Fixed behavior of some function not to recreate font if one is  
> already
>      created given other parameters are the same. SetMode() does  
> nothing if
>      nRows, nCols are the same as with console prior to calling this
> function.
>
>    ; NOTE: Please test extensively as this is one gray area of GTWVT  
> we all
>      are in a quest to fix.
>
> Regards
> Pritpal Bedi
> -- 
> View this message in context: http://www.nabble.com/2008-11-08-15%3A40-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20401804p20401804.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at acn.waw.pl  Sun Nov  9 05:58:20 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 05:57:28 2008
Subject: [Harbour] Re: Harbour under Win32 - OpenWatcom
In-Reply-To: <4916379C.5030200@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4916379C.5030200@mail.udg.mx>
Message-ID: <20081109105820.GA23830@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> >Try to rebuild Harbour with HB_FM_DL_ALLOC and USE_DL_PREFIX macros, 
> >f.e.:
> >   set C_USR=-DHB_FM_DL_ALLOC -DUSE_DL_PREFIX
> >and recompile Harbour. Then compare speed results for both modes.
> Not so much difference:
> hbrun_st.exe speedtst.prg
> --------------------------
> [ total application time: ]....................................61.39
> [ total real time: ]...........................................61.74
> hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
> --------------------------
> [ total application time: ]...................................104.03
> [ total real time: ]..........................................104.53

Just a small question. What to you want to compare? :-)
You are running two different test for ST and MT mode.
They execute different code with different conditions.
It's not expected that above results will be equal or
similar.
I thought that you wanted to compare the difference between
harbour compiled for ST mode only without -bm and Harbour
compiled with -bm for MT and you are executed the same
test.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 06:00:26 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 06:00:32 2008
Subject: [Harbour] ChangeLog in Unicode mode
In-Reply-To: <20401804.post@talk.nabble.com>
References: <20401804.post@talk.nabble.com>
Message-ID: <07FA409B-C247-40D5-99D6-A213A1C0D769@syenar.hu>

Apologize Pritpal, it wasn't you.

Francesco, pls turn off UNICODE mode when editing
_any_ Harbour files.

I'd suggest this for anyone.

Brgds,
Viktor

On 2008.11.09., at 0:48, Pritpal Bedi wrote:

>
> 2008-11-08 15:40 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>  * harbour/contrib/gtwvg/gtwvg.c
>  * harbour/contrib/gtwvg/gtwvg.h
>  * harbour/source/rtl/gtwvt/gtwvt.c
>  * harbour/source/rtl/gtwvt/gtwvt.h
>
>    + BOOL bResizing
>    + BOOL bAlreadySizing
>      To control unnecessary code execution while sizing operation is
>      being carried out. Now the flickering of console window should be
>      greatly minimized, IMO, please test.
>
>    ! Fixed behavior of some function not to recreate font if one is  
> already
>      created given other parameters are the same. SetMode() does  
> nothing if
>      nRows, nCols are the same as with console prior to calling this
> function.
>
>    ; NOTE: Please test extensively as this is one gray area of GTWVT  
> we all
>      are in a quest to fix.
>
> Regards
> Pritpal Bedi
> -- 
> View this message in context: http://www.nabble.com/2008-11-08-15%3A40-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20401804p20401804.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Nov  9 06:15:17 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 06:15:14 2008
Subject: [Harbour] 2008-11-09 11:48 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9425c$Blat.v2.6.2$7214be1a$7ac669e8fa2@127.0.0.1>

2008-11-09 11:48 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * ChangeLog
    ! Restored last non-UNICODE version, and readded
      all entries and reapplied all changes since then.
    ; NOTE: Please never save any Harbour files in
            UNICODE mode. Thank you.

  * contrib/make_gcc_all.sh
  * contrib/Makefile
    - Removed hbdbgfx.

  * source/pp/hbpp.c
  * source/main/harbour.c
    * Excluded hbwmain for __POCC__ WinCE.
    ; TOFIX: Warning: Not proper fix.
             This way it won't link but at least it compiles.

  * source/compiler/gencc.c
    * Switched to hexadecimal format for high chars, because
      octal was tried to be converted to Windows codepage, by
      PellesC.

  * config/w32/poccce.cf
    - Removed -DSTRSAFE_NO_DEPRECATE switch.

  * config/w32/pocc.cf
    + Added -MT switch.

  * contrib/hbwin/win_prn2.c
  * contrib/hbwin/win_dll.c
  * source/rtl/hbhex.c
  * source/rdd/hbsix/sxcompat.prg
    * Minor formatting.
--
Brgds,
Viktor

From dmacias at mail.udg.mx  Sun Nov  9 06:17:20 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  9 06:17:22 2008
Subject: [Harbour] Re: Harbour under Win32 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4916C6C0.9070300@mail.udg.mx>

 >Just a small question. What to you want to compare? :-)
 >You are running two different test for ST and MT mode.
 >They execute different code with different conditions.
 >It's not expected that above results will be equal or
 >similar.
 >I thought that you wanted to compare the difference between
 >harbour compiled for ST mode only without -bm and Harbour
 >compiled with -bm for MT and you are executed the same
 >test.

I just did what you requested  :-)

 >> >Try to rebuild Harbour with HB_FM_DL_ALLOC and USE_DL_PREFIX macros,
 >> >f.e.:
 >> >   set C_USR=-DHB_FM_DL_ALLOC -DUSE_DL_PREFIX
 >> >and recompile Harbour. Then compare speed results for both modes.

Purpose is not compare ST vs MT, but ST vs ST and MT vs MT before and after:
   set C_USR=-DHB_FM_DL_ALLOC -DUSE_DL_PREFIX

and as result they show "Not so much difference"

-bm flag are set in both cases, and that is a pending review

David Macias


> I've also teststed 1.7a in Linux and WINE and it works correctly.
> The native Linux build does not work due to missing functions and
> some typos in header files. In spare time I'll try to collect my
> local OW patches and send them to OW devel list.

>> hbrun_st.exe speedtst.prg
>> --------------------------
>> [ total application time: ]....................................67.08
>> [ total real time: ]...........................................67.34
>>
>> hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
>> --------------------------
 >> [ total application time: ]...................................104.42
>> [ total real time: ]..........................................107.14

>Try to rebuild Harbour with HB_FM_DL_ALLOC and USE_DL_PREFIX macros, 
>f.e.:
>   set C_USR=-DHB_FM_DL_ALLOC -DUSE_DL_PREFIX
>and recompile Harbour. Then compare speed results for both modes.

Not so much difference:

hbrun_st.exe speedtst.prg
--------------------------
[ total application time: ]....................................61.39
[ total real time: ]...........................................61.74

hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
--------------------------
[ total application time: ]...................................104.03
[ total real time: ]..........................................104.53

David Macias


hbrun_st.exe speedtst.prg
--------------------------

Warning !!! Memory statistic enabled.

11/08/08 18:49:55 Windows XP 5.1.2600 Service Pack 2
Harbour 1.1.0dev (Rev. 9854) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 0
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.16
====================================================================
[ T001: x := L_C ]..............................................0.13
[ T002: x := L_N ]..............................................0.13
[ T003: x := L_D ]..............................................0.13
[ T004: x := S_C ]..............................................0.11
[ T005: x := S_N ]..............................................0.11
[ T006: x := S_D ]..............................................0.09
[ T007: x := M_C ]..............................................0.13
[ T008: x := M_N ]..............................................0.13
[ T009: x := M_D ]..............................................0.11
[ T010: x := P_C ]..............................................0.11
[ T011: x := P_N ]..............................................0.09
[ T012: x := P_D ]..............................................0.11
[ T013: x := F_C ]..............................................0.47
[ T014: x := F_N ]..............................................0.38
[ T015: x := F_D ]..............................................0.25
[ T016: x := o:GenCode ]........................................0.39
[ T017: x := o[8] ].............................................0.27
[ T018: round( i / 1000, 2 ) ]..................................0.47
[ T019: str( i / 1000 ) ].......................................1.16
[ T020: val( s ) ]..............................................0.45
[ T021: val( a [ i % 16 + 1 ] ) ]...............................0.83
[ T022: dtos( d - i % 10000 ) ].................................1.19
[ T023: eval( { || i % 16 } ) ].................................1.39
[ T024: eval( bc := { || i % 16 } ) ]...........................0.45
[ T025: eval( { |x| x % 16 }, i ) ].............................1.11
[ T026: eval( bc := { |x| x % 16 }, i ) ].......................0.50
[ T027: eval( { |x| f1( x ) }, i ) ]............................1.31
[ T028: eval( bc := { |x| f1( x ) }, i ) ]......................0.70
[ T029: x := &( "f1(" + str(i) + ")" ) ]........................7.08
[ T030: bc := &( "{|x|f1(x)}" ); eval( bc, i ) ]................8.86
[ T031: x := valtype( x ) +  valtype( i ) ].....................1.06
[ T032: x := strzero( i % 100, 2 ) $ a[ i % 16 + 1 ] ]..........1.72
[ T033: x := a[ i % 16 + 1 ] == s ].............................0.66
[ T034: x := a[ i % 16 + 1 ] = s ]..............................0.72
[ T035: x := a[ i % 16 + 1 ] >= s ].............................0.72
[ T036: x := a[ i % 16 + 1 ] <= s ].............................0.75
[ T037: x := a[ i % 16 + 1 ] < s ]..............................0.70
[ T038: x := a[ i % 16 + 1 ] > s ]..............................0.73
[ T039: ascan( a, i % 16 ) ]....................................0.61
[ T040: ascan( a, { |x| x == i % 16 } ) ].......................6.44
[ T041: if i%1000==0;a:={};end; aadd(a,{i,1,.T.,s,s2,a2,bc ]....3.44
[ T042: x := a ]................................................0.16
[ T043: x := {} ]...............................................0.42
[ T044: f0() ]..................................................0.22
[ T045: f1( i ) ]...............................................0.34
[ T046: f2( c[1...8] ) ]........................................0.33
[ T047: f2( c[1...40000] ) ]....................................0.33
[ T048: f2( @c[1...40000] ) ]...................................0.31
[ T049: f2( @c[1...40000] ), c2 := c ]..........................0.44
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]....................0.91
[ T051: f2( a ) ]...............................................0.33
[ T052: x := f4() ].............................................1.23
[ T053: x := f5() ].............................................0.78
[ T054: f_prv( c ) ]............................................0.97
====================================================================
[ total application time: ]....................................61.39
[ total real time: ]...........................................61.74



hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
--------------------------

Warning !!! Memory statistic enabled.

11/08/08 18:51:51 Windows XP 5.1.2600 Service Pack 2
Harbour 1.1.0dev (Rev. 9854) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
excluded tests: 029 030 023 025 027 040 041 043 052 053 019 022 031 032 054
                                                         1 th.  2 th.
factor
============================================================================
[ T001: x := L_C ]____________________________________  0.72   0.74 ->  0.98
[ T002: x := L_N ]____________________________________  0.66   0.66 ->  1.00
[ T003: x := L_D ]____________________________________  0.64   0.64 ->  1.00
[ T004: x := S_C ]____________________________________  0.69   0.73 ->  0.94
[ T005: x := S_N ]____________________________________  0.63   0.61 ->  1.02
[ T006: x := S_D ]____________________________________  0.59   0.61 ->  0.97
[ T007: x := M_C ]____________________________________  0.69   0.70 ->  0.98
[ T008: x := M_N ]____________________________________  0.64   0.63 ->  1.03
[ T009: x := M_D ]____________________________________  0.63   0.63 ->  1.00
[ T010: x := P_C ]____________________________________  0.67   0.66 ->  1.02
[ T011: x := P_N ]____________________________________  0.63   0.63 ->  1.00
[ T012: x := P_D ]____________________________________  0.63   0.63 ->  1.00
[ T013: x := F_C ]____________________________________  1.61   1.61 ->  1.00
[ T014: x := F_N ]____________________________________  1.14   1.14 ->  1.00
[ T015: x := F_D ]____________________________________  0.86   0.86 ->  1.00
[ T016: x := o:GenCode ]______________________________  1.30   1.31 ->  0.99
[ T017: x := o[8] ]___________________________________  1.05   1.05 ->  1.00
[ T018: round( i / 1000, 2 ) ]________________________  1.56   1.56 ->  1.00
[ T020: val( s ) ]____________________________________  1.47   1.49 ->  0.99
[ T021: val( a [ i % 16 + 1 ] ) ]_____________________  3.00   3.00 ->  1.00
[ T024: eval( bc := { || i % 16 } ) ]_________________  1.72   1.72 ->  1.00
[ T026: eval( bc := { |x| x % 16 }, i ) ]_____________  1.81   1.81 ->  1.00
[ T028: eval( bc := { |x| f1( x ) }, i ) ]____________  2.20   2.19 ->  1.01
[ T033: x := a[ i % 16 + 1 ] == s ]___________________  2.09   2.08 ->  1.01
[ T034: x := a[ i % 16 + 1 ] = s ]____________________  2.22   2.20 ->  1.01
[ T035: x := a[ i % 16 + 1 ] >= s ]___________________  2.22   2.20 ->  1.01
[ T036: x := a[ i % 16 + 1 ] <= s ]___________________  2.23   2.27 ->  0.99
[ T037: x := a[ i % 16 + 1 ] < s ]____________________  2.23   2.22 ->  1.01
[ T038: x := a[ i % 16 + 1 ] > s ]____________________  2.19   2.19 ->  1.00
[ T039: ascan( a, i % 16 ) ]__________________________  2.00   2.02 ->  0.99
[ T042: x := a ]______________________________________  0.75   0.73 ->  1.02
[ T044: f0() ]________________________________________  0.89   0.91 ->  0.98
[ T045: f1( i ) ]_____________________________________  1.20   1.20 ->  1.00
[ T046: f2( c[1...8] ) ]______________________________  1.14   1.14 ->  1.00
[ T047: f2( c[1...40000] ) ]__________________________  1.13   1.14 ->  0.99
[ T048: f2( @c[1...40000] ) ]_________________________  1.16   1.14 ->  1.01
[ T049: f2( @c[1...40000] ), c2 := c ]________________  1.47   1.47 ->  1.00
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]__________  2.59   2.58 ->  1.01
[ T051: f2( a ) ]_____________________________________  1.20   1.19 ->  1.01
============================================================================
[   TOTAL   ]_________________________________________ 52.23  52.25 ->  1.00
============================================================================
[ total application time: ]...................................104.03
[ total real time: ]..........................................104.53


From harbour.01 at syenar.hu  Sun Nov  9 06:32:37 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 06:32:35 2008
Subject: [Harbour] 2008-11-09 12:26 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9425e$Blat.v2.6.2$ddee9cb2$115c53c940f6@127.0.0.1>

2008-11-09 12:26 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * ChangeLog
    ! Fixed again the UNICODE problem (I've uploaded a wrong 
      version apparently).
    + Added my last entry which was lost due to above.
    ! Removed all ending whitespaces.
    ! Stripped all non-ASCII chars. Sorry to all who's names 
      were thus modified.
    ; NOTE: Please don't use any high chars in the future, 
            only 7-bit ASCII. Same goes for all Harbour source 
            comments BTW.
            This way everyone can read what the other are typing 
            and it's much easier to fix files if someone 
            accidentally saves with the wrong codepage.
    ; TOFIX: We should also possibly fix all high chars in 
             .prg and .c code _strings_.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 06:54:29 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 06:54:36 2008
Subject: [Harbour] 2008-11-09 11:45 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081109104549.GA22410@34-mo7-2.acn.waw.pl>
References: <20081109104549.GA22410@34-mo7-2.acn.waw.pl>
Message-ID: <7A4746B7-A51C-4557-BE64-C4F68F0828DA@syenar.hu>

Hi Przemek,

I've tried to add hbrun_dll, but I got all sort of
unresolved external (tested with BCC and MSVC). This
may be due to the fact that the symbols are declared
without HB_DYNLIB in hbcplr.lib, while we'd like to
link with harbour.lib where those are declared HB_DYNLIB.

A while ago some local tests showed that enabling
HB_DYNLIB by default is in fact causing bigger final
executables (tested with MSVC), so I didn't commit
anything in this regard finally. The generated code
looks the same, so speed doesn't seem to be affected,
and maybe there is a link switch to exclude the extra
information cause the size increase, I'm still looking
into this.

Brgds,
Viktor

On 2008.11.09., at 11:45, Przemyslaw Czerpak wrote:

> 2008-11-09 11:45 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>  * harbour/make_gcc.mak
>    ! declared non file helper rules as .PHONY ones.
>    ! fixed bad typo in helper rules usage - strange that I haven't  
> seen
>      it before.
>    * restored non indirect rules - now they should work as expected
>      also in parallel builds.
>      TODO: remove static libraries from HB_BUILD_TARGETS in common.mak
>      if everything is correct then they should be created to satisfy
>      hbrun and other tools dependencies. It's not necessary to  
> explicitly
>      duplicate it.
>
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From info at fsgiudice.com  Sun Nov  9 07:02:29 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sun Nov  9 07:02:37 2008
Subject: [Harbour] ChangeLog in Unicode mode
In-Reply-To: <07FA409B-C247-40D5-99D6-A213A1C0D769@syenar.hu>
References: <20401804.post@talk.nabble.com>
	<07FA409B-C247-40D5-99D6-A213A1C0D769@syenar.hu>
Message-ID: <4916D155.6080806@fsgiudice.com>

Sorry Viktor,
I apologize.

Best regards

Francesco

Il 09/11/2008 12.00, Szak?ts Viktor ha scritto:
> Apologize Pritpal, it wasn't you.
> 
> Francesco, pls turn off UNICODE mode when editing
> _any_ Harbour files.
> 
> I'd suggest this for anyone.
> 
From druzus at acn.waw.pl  Sun Nov  9 07:03:36 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 07:02:44 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491645E2.3000700@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<491645E2.3000700@mail.udg.mx>
Message-ID: <20081109120336.GB23830@34-mo7-2.acn.waw.pl>

On Sat, 08 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Rebuilt Harbour with
>   set C_USR=-DHB_FM_STATISTICS_OFF -DHB_TR_LEVEL_DEBUG
> Before running new test application (pba.exe):
>   set HB_TR_LEVEL=HB_TR_DEBUG
>   set HB_TR_FLUSH=1
>   set HB_TR_OUTPUT=trace.log
> and results are:
> ----------------
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0005.
> ----------------
> trace.log are never created
> ------------
> dir /od
> [...]
>  8/11/08  7:21p         5,218      0 a---  mi_ow.cmd
>  8/11/08  7:35p       254,571      0 a---  make_ow.log
>  8/11/08  7:43p       972,753      0 a---  pba.exe
>        53 file(s)   5,288,427 bytes used
> ------------
> [E:\harbour810\harbour]dir ..\trace.log /s
> The volume label in drive E is ECS.
> The Volume Serial Number is A913:E015.
> SYS0002: The system cannot find the file specified.
> ------------
> Testing with hbvm.lib ( without MT ) work fine creating trace.log with 
> 2,970 lines
> -----------
> func main
>  qout( "hello world" )
> return nil
> -----------
> So Harbour tracing fails in MT / OW

I do not know what is wrong in this build but there is no
difference between MT and ST mode in such tests. Both should
create tracelog. I've just tested it and it works. Though
I've found one problem. Some tracelog message in memvars.c can
cause GPF. I'll fix it but it does not change the fact that
it's working as expected and tracelog is created and contains
many entries before it reach memvars.c.
So sth has to be wrong in binaries you are creating.

BTW have you tried:
   printf("0. hb_gt_os2_ReadKey()\r\n");fflush(stdout);
before HB_TRACE() in gtos2.c?

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 07:03:36 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 07:03:35 2008
Subject: [Harbour] 2008-11-09 13:03 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94263$Blat.v2.6.2$3202a740$c48d587ed70@127.0.0.1>

2008-11-09 13:03 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * contrib/hbtip/utils.c
    ! Fixed static function also marked as HB_EXPORT.

  * contrib/xhb/dbgfx.prg
    * Minor formatting.
--
Brgds,
Viktor

From info at fsgiudice.com  Sun Nov  9 07:10:25 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sun Nov  9 07:10:35 2008
Subject: [Harbour] ChangeLog in Unicode mode
In-Reply-To: <07FA409B-C247-40D5-99D6-A213A1C0D769@syenar.hu>
References: <20401804.post@talk.nabble.com>
	<07FA409B-C247-40D5-99D6-A213A1C0D769@syenar.hu>
Message-ID: <4916D331.6020005@fsgiudice.com>

Viktor,
I'm checking difference from current (in my SVN) and online Changelog 
with TortoiseSVN but I cannot seen difference in chars. Where have I to 
see differences to understand ?
Could you past just few lines to show me ?

Sorry again but I'm using alway same tools (UltraEdit as editor) as in 
past and I never had any problems.

Best Regards

Francesco

Il 09/11/2008 12.00, Szak?ts Viktor ha scritto:
> Apologize Pritpal, it wasn't you.
> 
> Francesco, pls turn off UNICODE mode when editing
> _any_ Harbour files.
> 
> I'd suggest this for anyone.
> 
> Brgds,
> Viktor
> 
From druzus at acn.waw.pl  Sun Nov  9 07:14:04 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 07:13:12 2008
Subject: [Harbour] Re: Harbour under Win32 - OpenWatcom
In-Reply-To: <4916C6C0.9070300@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4916C6C0.9070300@mail.udg.mx>
Message-ID: <20081109121404.GA32339@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> I just did what you requested  :-)

Sorry it was my fault.
I thought you still compares -bm overhead. In Windows builds we can use
DL malloc so it can be eliminated. Of course if it exists.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  9 07:16:25 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 07:15:32 2008
Subject: [Harbour] 2008-11-09 13:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081109121625.GA8338@34-mo7-2.acn.waw.pl>

2008-11-09 13:16 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/vm/memvars.c
    ! fixed 3 tracelog messages

  * harbour/source/rtl/hbgtcore.c
    * declare core method table as const

  * harbour/source/compiler/gencc.c
    ! fixed accessing data out of buffer in string to hex conversion and
      logical expression used to divide strings

best regards
Przemek
From druzus at acn.waw.pl  Sun Nov  9 07:39:55 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 07:39:03 2008
Subject: [Harbour] 2008-11-09 11:45 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <7A4746B7-A51C-4557-BE64-C4F68F0828DA@syenar.hu>
References: <20081109104549.GA22410@34-mo7-2.acn.waw.pl>
	<7A4746B7-A51C-4557-BE64-C4F68F0828DA@syenar.hu>
Message-ID: <20081109123955.GA11809@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> I've tried to add hbrun_dll, but I got all sort of
> unresolved external (tested with BCC and MSVC). This
> may be due to the fact that the symbols are declared
> without HB_DYNLIB in hbcplr.lib, while we'd like to
> link with harbour.lib where those are declared HB_DYNLIB.

No. EXPORT attribute is necessary only for functions which
will be accessed externally by name (directly in source code
and bound by linker or indirectly by GetProcAddress() at runtime.
In this case non of symbol is accessed in such way.

> A while ago some local tests showed that enabling
> HB_DYNLIB by default is in fact causing bigger final
> executables (tested with MSVC), so I didn't commit
> anything in this regard finally. The generated code
> looks the same, so speed doesn't seem to be affected,
> and maybe there is a link switch to exclude the extra
> information cause the size increase, I'm still looking
> into this.

Exporting symbols causes that binaries contains table with
symbol name and its address. The size overhead is caused
by this table. It's possible that some tools can strip
this table from final binaries or some linkers have such
option. But it's not related to hbrun_dll problem. If
hbtest_dll works than hbrun_dll should work too. Probably
you not added COMPILER_LIB to library list. hbcplr is not
part of harbour shared library so static version have to
be used.

best regards,
Przemek
From dmacias at mail.udg.mx  Sun Nov  9 07:51:03 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  9 07:51:05 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4916DCB7.5070307@mail.udg.mx>

 >> So Harbour tracing fails in MT / OW

 >I do not know what is wrong in this build but there is no
 >difference between MT and ST mode in such tests. Both should
 >create tracelog. I've just tested it and it works. Though
 >I've found one problem. Some tracelog message in memvars.c can
 >cause GPF. I'll fix it but it does not change the fact that
 >it's working as expected and tracelog is created and contains
 >many entries before it reach memvars.c.
 >So sth has to be wrong in binaries you are creating.

I have not updated Harbour code from SVN trying to not introduce a 
different behaviour by some recent change

But perhaps is time to use a fresh checkout and recreate tests
I will do that

 >BTW have you tried:
 >   printf("0. hb_gt_os2_ReadKey()\r\n");fflush(stdout);
 >before HB_TRACE() in gtos2.c?

Yes, and same condition: Can not execute
   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
for second thread, and so does not enter hb_gt_os2_ReadKey() and 
printf("0. hb_gt_os2_ReadKey()\r\n");fflush(stdout); are never reached

 >In hb_gt_def_InkeyPollDo():

 >   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );

 >in hb_gt_def_InkeyPollDo() executes low level GT driver READKEY()
 >method. In GTOS2 it's hb_gt_os2_ReadKey(). Please also note that
 >it works for 1-st thread and fails only for the second one so the
 >problem is bound with low level GT code. In GTCGI READKEY() does
 >nothing and only returns K_ENTER code:

 >   static int hb_gt_cgi_ReadKey( PHB_GT pGT, int iEventMask )
 >   {
 >      HB_TRACE(HB_TR_DEBUG, ("hb_gt_cgi_ReadKey(%p,%d)", pGT, 
 >iEventMask));

 >      HB_SYMBOL_UNUSED( pGT );
 >      HB_SYMBOL_UNUSED( iEventMask );

 >      return 13;
 >   }

 >In GTOS2 and GTSTD low level keyboard code is activated and it causes
 >that application fails.

Based in your explanation, fails trying to execute
   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
    ---> hb_gt_os2_ReadKey()
but never execute it

Second thread can not access this "low level GT driver READKEY() method 
( GTOS2:hb_gt_os2_ReadKey() ) ?

David Macias



From harbour.01 at syenar.hu  Sun Nov  9 08:03:42 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:03:39 2008
Subject: [Harbour] 2008-11-09 14:02 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9426b$Blat.v2.6.2$9749e5ca$c981889f34e@127.0.0.1>

2008-11-09 14:02 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_vc.mak
    + Added /nxcompat linker flag for non-WinCE, non-DLL, 
      HB_VISUALC_VER >= 80 MSVC executables. 
      This should add extra safety.

  * include/hbextern.ch
  * source/rtl/rat.c
    + Added HB_RAT() which is similar to RAT(), but also accepts 
      <nStart> and <nEnd> optional paramaters, similarly to HB_AT().
    ; Please test.

  * source/rtl/at.c
    * Minor formatting.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  9 08:20:12 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 08:19:21 2008
Subject: [Harbour] 2008-11-09 14:20 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081109132012.GA27647@34-mo7-2.acn.waw.pl>

2008-11-09 14:20 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/common.mak
  * harbour/make_gcc.mak
    ! fixed hbtest-dll linking - the path to used harbour shared library
      was hardcoded in final binaries
    + added hbrun-dll. Please update make_b32.mak and make_vc.mak

best regards
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 08:20:26 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:20:32 2008
Subject: [Harbour] ChangeLog in Unicode mode
In-Reply-To: <4916D331.6020005@fsgiudice.com>
References: <20401804.post@talk.nabble.com>
	<07FA409B-C247-40D5-99D6-A213A1C0D769@syenar.hu>
	<4916D331.6020005@fsgiudice.com>
Message-ID: <981CC232-1319-40EF-9A6C-5FB112F5D8B6@syenar.hu>

Hi Francesco,

> I'm checking difference from current (in my SVN) and online  
> Changelog with TortoiseSVN but I cannot seen difference in chars.  
> Where have I to see differences to understand ?

The first three chars of ChangeLog were Unicode
marker bytes, which got removed, plus I've
stripped all high chars from entries which contained
them (these were converted to UTF-8 when saved
as Unicode). These kind of changes are not always
easy to spot using standard diff techniques,
as they may be masked by the diffing tools.

You can see the changes using these commands:
svn diff -c 9868
svn diff -c 9869

> Could you past just few lines to show me ?
>
> Sorry again but I'm using alway same tools (UltraEdit as editor) as  
> in past and I never had any problems.

No problem, and now that there is no high
chars anymore in the file, it won't be a big
deal to fix such problem (it used to happen
from time to time).

I'll check our full codebase for such chars
and remove them.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 08:26:06 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:26:03 2008
Subject: [Harbour] 2008-11-09 14:23 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9426e$Blat.v2.6.2$b8626824$16a89fa50346@127.0.0.1>

2008-11-09 14:23 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * tests/longstr.prg
  * contrib/hbole/oleauto.prg
  * contrib/hbole/ole2.c
  * contrib/gtwvg/wvgutils.c
  * contrib/gtwvg/wvgcore.c
  * contrib/hbgd/gdbarcod.prg
  * contrib/hbgd/gdbar.prg
  * contrib/hbwin/win_tole.prg
  * contrib/hbwin/win_ole.c
  * contrib/hbvpdf/hbvpdf.prg
  * contrib/examples/hbsqlit2/tests/hbsqlite.prg
  * contrib/examples/hbsqlit2/TODO.txt
  * contrib/examples/hbsqlit2/hbsqlit2.c
  * source/debug/dbgwa.prg
  * source/rtl/gtwin/gtwin.c
  * source/rtl/tget.prg
  * source/rtl/tgetint.prg
  * source/compiler/gencobj.c
    ! Removed high chars from comments. This usually means 
      copyright holders' names. I apologize for touching 
      them, I also have one in mine, but it's better to 
      not use them in source code to avoid encoding problems.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  9 08:30:25 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 08:29:32 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4916DCB7.5070307@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4916DCB7.5070307@mail.udg.mx>
Message-ID: <20081109133025.GA28042@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> I have not updated Harbour code from SVN trying to not introduce a 
> different behaviour by some recent change
> But perhaps is time to use a fresh checkout and recreate tests
> I will do that

It will resolve possible GPF during MT tracing but it will
have no effect on creating trace.log.
If it was not created in your builds then it means that sth is
wrong. Maybe you used different libraries which were compiler
without C_USR flag or test application was not recompiled.

> >BTW have you tried:
> >   printf("0. hb_gt_os2_ReadKey()\r\n");fflush(stdout);
> >before HB_TRACE() in gtos2.c?
> Yes, and same condition: Can not execute
>   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
> for second thread, and so does not enter hb_gt_os2_ReadKey() and printf("0. 
> hb_gt_os2_ReadKey()\r\n");fflush(stdout); are never reached

It's very strange. What is the whole output? Can you send it here?

> >In hb_gt_def_InkeyPollDo():
> >   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
> >in hb_gt_def_InkeyPollDo() executes low level GT driver READKEY()
> >method. In GTOS2 it's hb_gt_os2_ReadKey(). Please also note that
> >it works for 1-st thread and fails only for the second one so the
> >problem is bound with low level GT code. In GTCGI READKEY() does
> >nothing and only returns K_ENTER code:
> >   static int hb_gt_cgi_ReadKey( PHB_GT pGT, int iEventMask )
> >   {
> >      HB_TRACE(HB_TR_DEBUG, ("hb_gt_cgi_ReadKey(%p,%d)", pGT, iEventMask));
> >      HB_SYMBOL_UNUSED( pGT );
> >      HB_SYMBOL_UNUSED( iEventMask );
> >      return 13;
> >   }
> >In GTOS2 and GTSTD low level keyboard code is activated and it causes
> >that application fails.
> Based in your explanation, fails trying to execute
>   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
>    ---> hb_gt_os2_ReadKey()
> but never execute it
> Second thread can not access this "low level GT driver READKEY() method ( 
> GTOS2:hb_gt_os2_ReadKey() ) ?

What is very strange and should not happen.
I'd rather expect that there is sth wrong with tests we are making.
Can you add:
   printf("0. hb_gt_cgi_ReadKey()\r\n");fflush(stdout); are never reached
to GTCGI hb_gt_cgi_ReadKey() function and send the ouput for test program
linked with GTCGI together with GTOS2?

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 08:29:56 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:29:52 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>

2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
    + Added HBRUN_DLL.
    ; TOFIX: It doesn't work. Maybe more eyeballs will spot the 
             problem more easily.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 08:32:39 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:32:45 2008
Subject: [Harbour] 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081107102131.GB2247@34-mo7-2.acn.waw.pl>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
	<20081107102131.GB2247@34-mo7-2.acn.waw.pl>
Message-ID: <222A6854-3BCD-4C10-A694-33E364C5E63D@syenar.hu>

Thanks Przemek, I'm not sure to enable it, because in C
it's better practice to always check for existence,
otherwise some compilers will throw warnings.

Let's wait for more votes.

Brgds,
Viktor

On 2008.11.07., at 11:21, Przemyslaw Czerpak wrote:

> On Fri, 07 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
>> Shouldn't we also allow 'DEFINE >= 0x100' in case
>> DEFINE is not defined, and in this case returning
>> FALSE?
>
> Not all C compilers accept it.
> It means that we have to use some arbitrary value for
> all undefined identifiers. Usually 0. If it's OK for
> you then it's enough to change line 4609 in ppcore.c:
>   if( !HB_PP_TOKEN_ISEOC( pToken ) || fUndef )
> to:
>   if( !HB_PP_TOKEN_ISEOC( pToken ) )
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at acn.waw.pl  Sun Nov  9 08:34:20 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 08:33:27 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
Message-ID: <20081109133420.GA6177@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
>   * make_b32.mak
>   * make_vc.mak
>     + Added HBRUN_DLL.
>     ; TOFIX: It doesn't work. Maybe more eyeballs will spot the 
>              problem more easily.

What does it mean "It doesn't work" :-)
It cannot be linked or it's runtime problem?
What errors do you have?

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 08:33:42 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:33:49 2008
Subject: [Harbour] 2008-11-08 12:46 UTC+0200 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081108134618.GA3399@34-mo7-2.acn.waw.pl>
References: <01c94197$Blat.v2.6.2$d9a1f2ca$17b4a6e8e43c@127.0.0.1>
	<20081108124219.GA17279@34-mo7-2.acn.waw.pl>
	<7EB4CD86-EF4E-4CC2-816A-809433F387AE@syenar.hu>
	<20081108134618.GA3399@34-mo7-2.acn.waw.pl>
Message-ID: <3B6C1F11-0EF2-4939-9A84-1C84C6E552A2@syenar.hu>

Hi Przemek,

> The main problem for me is that I do not use Windows
> and I do not know well MS-Windows API and undocumented
> behavior. Working on GTWVT I'm making tests with WINE
> but I'm never sure when I want to check some detail
> behavior which is not documented that I see real MS-Windows
> results or only WINE emulation side effects.
> Here to well redesign GTWVT internals I should make some
> tests on real MS-Windows machine to be sure that I choose
> correct implementation.

I see, difficult to add anything smart to this,
native is always better than emulation. Dunno where
WINE stands these days really.

I know it's not ideal, but if you want I can give
you remote access to Windows (virtual) PC, if that may
help you in any ways. Just tell.

>> Another remaining issue is screen refresh problem, which
>> should probably put in a separate native thread as you've
>> suggested already. Maybe this would solve some bad refresh
>> problems in GTWVG, too.
>
> I cannot promise but I'll try to find some time to implement it.

Okay, that would be very nice.

>> from being a priority (for me) as I don't have long
>> queues of Linux/OSX users in front of my door :) (yet :)
>
> Please remember that in some GTs we are not able to protect
> against terminal resizing from Harbour application so such
> situations will always happen and support for dynamic font
> resizing is rather seldom and will exist only in GUI GTs.

Disabling resize is not really the problem, and it isn't
nice to do that with the users anyway. Rather, resizing can
either resize the screen dimension or the font size. Now GTXWC
is doing the former, while GTWVT does the latter (by default).
Latter is more natural for legacy CUI apps, former leads
to bad results without heavy app rewrite usually.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 08:37:42 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:37:38 2008
Subject: [Harbour] 2008-11-09 14:37 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94270$Blat.v2.6.2$573df67e$13a8e1ec97ca@127.0.0.1>

2008-11-09 14:37 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
    ! /P32 -> /P64
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 08:37:37 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:37:46 2008
Subject: [Harbour] 2008-11-09 11:45 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081109123955.GA11809@34-mo7-2.acn.waw.pl>
References: <20081109104549.GA22410@34-mo7-2.acn.waw.pl>
	<7A4746B7-A51C-4557-BE64-C4F68F0828DA@syenar.hu>
	<20081109123955.GA11809@34-mo7-2.acn.waw.pl>
Message-ID: <75B2AED5-C876-43BD-B355-55B505797675@syenar.hu>

>> information cause the size increase, I'm still looking
>> into this.
>
> Exporting symbols causes that binaries contains table with
> symbol name and its address. The size overhead is caused
> by this table. It's possible that some tools can strip
> this table from final binaries or some linkers have such
> option. But it's not related to hbrun_dll problem. If
> hbtest_dll works than hbrun_dll should work too. Probably
> you not added COMPILER_LIB to library list. hbcplr is not
> part of harbour shared library so static version have to
> be used.

I did add it, and I got lots of such errors still.
Maybe some basic mistake.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 08:40:33 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 08:40:41 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081109133420.GA6177@34-mo7-2.acn.waw.pl>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
	<20081109133420.GA6177@34-mo7-2.acn.waw.pl>
Message-ID: <4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>

>>    ; TOFIX: It doesn't work. Maybe more eyeballs will spot the
>>             problem more easily.
>
> What does it mean "It doesn't work" :-)
> It cannot be linked or it's runtime problem?
> What errors do you have?

You're too quick I was just preparing the details :)
(shortly: it doesn't link)

So here they are (first some new BCC warnings):
---
Warning W8080 source\vm\arrays.c 1473: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\asort.c 257: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\classes.c 4849: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\cmdarg.c 516: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\codebloc.c 310: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\debug.c 272: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\dynlibhb.c 194: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\dynsym.c 681: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\eval.c 572: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\evalhb.c 88: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\extend.c 1304: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\fm.c 1046: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\garbage.c 846: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\hashes.c 920: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\hashfunc.c 746: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\itemapi.c 2592: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\macro.c 1667: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\memvars.c 1635: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\pcount.c 64: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\proc.c 281: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\pvalue.c 72: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\runner.c 799: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\set.c 2504: 'hb_stack_ptr_from_tls()' is  
declared but never used
Warning W8080 source\vm\thread.c 1822: 'hb_stack_ptr_from_tls()' is  
declared but never used
---

And the linking problem (with BCC, MSVC looked pretty similar. Some  
lines stripped to fit in mail size limit):
---
	bin\b32\harbour.exe -n -iinclude -q0 -w3 -es2 -gc3 -km -l  -oobj\dll 
\b32\ utils\hbrun\hbrun.prg
	bcc32.exe  -c -q -d -Q -w -w-sig- -tWM -4 -O2 -OS -Ov -Oi -Oc - 
Iinclude -Iobj\b32 -DUNICODE -v -y -oobj\dll\b32\hbrun.obj obj\dll 
\b32\hbrun.c
obj\dll\b32\hbrun.c:
	ilink32.exe -Gn -C -ap -Tpe -Llib\b32 -Lbin\b32  @MAKE0036.@@@
Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland
Error: Unresolved external '_hb_compExprCBVarDel' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprDescription' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceIIF' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprListLen' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprParamListLen' referenced from  
C:\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceAT' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceCHR' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceLEN' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceEMPTY' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceASC' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceINT' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceSTOD' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceDTOS' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceCTOD' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceMIN' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceMAX' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceUPPER' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprAsLongNum' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceBitFunc' referenced from  
C:\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprParamListCheck' referenced  
from C:\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceOr' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceAnd' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceEQ' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceLT' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceGT' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceLE' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceGE' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceNE' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceIN' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReducePlus' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceMinus' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceMult' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceDiv' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceMod' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReducePower' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprDelOperator' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprReduceNegate' referenced from  
C:\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprNewVar' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprNewPlus' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprSetOperand' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprNewString' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprNewMacro' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprIsInteger' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_compExprListStrip' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
Error: Unresolved external '_hb_pp_new' referenced from C:\WORK\HARBOUR 
\HARBOUR\LIB\B32\HBCPLR.LIB|hbcomp
Error: Unresolved external '_hb_hashTableFind' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbident
Error: Unresolved external '_hb_hashTableAdd' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbident
Error: Unresolved external '_hb_hashTableCreate' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbident
Error: Unresolved external '_hb_hashTableKill' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbident
Error: Unresolved external '_hb_pp_tokenToString' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|complex
Error: Unresolved external '_hb_pp_tokenBlockString' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|complex
Error: Unresolved external '_hb_pp_tokenUpper' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|complex
Error: Unresolved external '_hb_pp_tokenNextExp' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|complex
Error: Unresolved external '_hb_pp_tokenGet' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|complex
Error: Unresolved external '_hb_pp_free' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbcomp
Error: Unresolved external '_hb_verHarbour' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbusage
Error: Unresolved external '_hb_pp_addSearchPath' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|cmdcheck
Error: Unresolved external '_hb_pp_addDefine' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|cmdcheck
Error: Unresolved external '_hb_pp_delDefine' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|cmdcheck
Error: Unresolved external '_hb_getenv' referenced from C:\WORK\HARBOUR 
\HARBOUR\LIB\B32\HBCPLR.LIB|cmdcheck
Error: Unresolved external '_hb_verBuildInfo' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain
Error: Unresolved external '_hb_pp_line' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|ppcomp
Error: Unresolved external '_hb_pp_fileName' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|ppcomp
Error: Unresolved external '_hb_pp_init' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|ppcomp
Error: Unresolved external '_hb_pp_setStdRules' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|ppcomp
Error: Unresolved external '_hb_pp_readRules' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|ppcomp
Error: Unresolved external '_hb_pp_initDynDefines' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|ppcomp
Error: Unresolved external '_hb_pp_setStdBase' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|ppcomp
Error: Unresolved external '_hb_compReservedName' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprNewDate' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprNewLong' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprNewDouble' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprNewLogical' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprNewSelf' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprNewArray' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
...
Error: Unresolved external '_hb_compExprNewRTVar' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprAsStringLen' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprIsLong' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprIsString' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprNewFunRef' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compExprAsSymbol' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_pp_eof' referenced from C:\WORK\HARBOUR 
\HARBOUR\LIB\B32\HBCPLR.LIB|harboury
Error: Unresolved external '_hb_compEncodeString' referenced from C: 
\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain
Error: Unresolved external '_hb_fopen' referenced from C:\WORK\HARBOUR 
\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain
Error: Unresolved external '_hb_verCompiler' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|genc
Error: Unresolved external '_hb_pp_inBuffer' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain
Error: Unresolved external '_hb_pp_lineTot' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain
Error: Unresolved external '_hb_pp_reset' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain
Error: Unresolved external '_hb_pp_inFile' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain
Error: Unresolved external '_hb_pp_traceFile' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain
Error: Unresolved external '_hb_pp_outFile' referenced from C:\WORK 
\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|hbmain

** error 2 ** deleting bin\b32\hbrun-dll.exe
---

Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  9 08:43:48 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 08:42:55 2008
Subject: [Harbour] 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <222A6854-3BCD-4C10-A694-33E364C5E63D@syenar.hu>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
	<20081107102131.GB2247@34-mo7-2.acn.waw.pl>
	<222A6854-3BCD-4C10-A694-33E364C5E63D@syenar.hu>
Message-ID: <20081109134348.GA10883@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Thanks Przemek, I'm not sure to enable it, because in C
> it's better practice to always check for existence,
> otherwise some compilers will throw warnings.
> Let's wait for more votes.

OK.

>> Not all C compilers accept it.
>> It means that we have to use some arbitrary value for
>> all undefined identifiers. Usually 0. If it's OK for
>> you then it's enough to change line 4609 in ppcore.c:
>>   if( !HB_PP_TOKEN_ISEOC( pToken ) || fUndef )
>> to:
>>   if( !HB_PP_TOKEN_ISEOC( pToken ) )

If we decide to change it then probably it will be better to
make sth like:

   if( fUndef )
      lValue = 0;
   else if( !HB_PP_TOKEN_ISEOC( pToken ) )
      fError = TRUE;

In such for code like:

   #if UNEXISTING_DEFINE == 0
      #stdout "UNEXISTING_DEFINE is 0"
   #endif

#stdout will not be compiled

best regards,
Przemek
From dmacias at mail.udg.mx  Sun Nov  9 08:54:38 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  9 08:54:41 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4916EB9E.1090102@mail.udg.mx>

I made a Harbour fresh checkout and build with
   set C_USR=-DHB_FM_STATISTICS_OFF -DHB_TR_LEVEL_DEBUG

Screen output (same as Win32:OW):
--------------------
make[3]: *** [hboutdbg.obj] Error 8
make[2]: *** [descend] Error 2
--------------------

Surprise: sqlite3 show a lot of warnings in gcc335, but no one in OW and 
hbsqlit3.lib build fine

Testing Harbour tracing with pba2.prg:
-----------
func main
  qout( "hello world" )
return nil
-----------

Before running new test application:
   set HB_TR_LEVEL=HB_TR_DEBUG
   set HB_TR_FLUSH=1
   set HB_TR_OUTPUT=trace.log

and results are:
[E:\harbour811\harbour]del trace.log
SYS0002: The system cannot find the file specified.

[E:\harbour811\harbour]bin\pbaos2.cmd pba2
Open Watcom Linker Version 1.7
Portions Copyright (c) 1985-2002 Sybase, Inc. All Right
Source code is available under the Sybase Open Watcom P
See http://www.openwatcom.org/ for details.
loading object files
searching libraries
creating an OS/2 32-bit executable
[E:\harbour811\harbour]pba2.exe

hello world
[E:\harbour811\harbour]dir trace.log

The volume label in drive E is ECS.
The Volume Serial Number is A913:E015.
Directory of E:\harbour811\harbour

  9/11/08  7:29a       143,326      0 a---  trace.log

[E:\harbour811\harbour]del trace.log

[E:\harbour811\harbour]bin\pbaos2.cmd -mt pba2
Open Watcom Linker Version 1.7
Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See http://www.openwatcom.org/ for details.
loading object files
searching libraries
creating an OS/2 32-bit executable
[E:\harbour811\harbour]pba2.exe
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.

[E:\harbour811\harbour]dir trace.log

The volume label in drive E is ECS.
The Volume Serial Number is A913:E015.
Directory of E:\harbour811\harbour

  9/11/08  7:33a        21,046      0 a---  trace.log


Now trace.log are created in MT with a size much smaller than ST

Was due to fresh checkout and/or other changes ?


And now for our target (pba.prg):
---------------
    proc main()
       hb_threadJoin( hb_threadStart( @thFunc() ) )
    return
    proc thFunc()
    return

    announce HB_GTSYS
    request HB_GT_OS2_DEFAULT
//   request HB_GT_CGI_DEFAULT
//   request HB_GT_STD_DEFAULT
---------------

[E:\harbour811\harbour]del trace.log

[E:\harbour811\harbour]bin\pbaos2.cmd pba
Open Watcom Linker Version 1.7
Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See http://www.openwatcom.org/ for details.
loading object files
searching libraries
creating an OS/2 32-bit executable
[E:\harbour811\harbour]pba.exe

Exception c0000005 at address 000afadf
                                        Called from HB_THREADJOIN(0)
 
Called from M
AIN(2) in pba.prg
                  SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.

[E:\harbour811\harbour]dir trace.log

The volume label in drive E is ECS.
The Volume Serial Number is A913:E015.
Directory of E:\harbour811\harbour

  9/11/08  7:42a       111,493      0 a---  trace.log

[E:\harbour811\harbour]bin\pbaos2.cmd -mt pba
Open Watcom Linker Version 1.7
Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See http://www.openwatcom.org/ for details.
loading object files
searching libraries
creating an OS/2 32-bit executable
[E:\harbour811\harbour]pba.exe
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.

[E:\harbour811\harbour]dir trace.log

The volume label in drive E is ECS.
The Volume Serial Number is A913:E015.
Directory of E:\harbour811\harbour

  9/11/08  7:43a        35,359      0 a---  trace.log

Again much smaller in MT

[E:\harbour811\harbour]dir *.log /od

The volume label in drive E is ECS.
The Volume Serial Number is A913:E015.
Directory of E:\harbour811\harbour

I saved each log file (may differ in order/time):

  9/11/08  7:17a       247,534      0 a---  make_ow.log
  9/11/08  7:33a        21,046      0 a---  tracepba2mt.log
  9/11/08  7:37a       143,315      0 a---  tracepba2st.log
  9/11/08  7:42a       111,493      0 a---  tracepbast.log
  9/11/08  7:43a        35,359      0 a---  tracepbamt.log

Sent traceow.zip containing these files

David Macias


From druzus at acn.waw.pl  Sun Nov  9 09:11:12 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 09:10:20 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
	<20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
Message-ID: <20081109141112.GA16174@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

>>>    ; TOFIX: It doesn't work. Maybe more eyeballs will spot the
>>>             problem more easily.
>>
>> What does it mean "It doesn't work" :-)
>> It cannot be linked or it's runtime problem?
>> What errors do you have?
>
> You're too quick I was just preparing the details :)
> (shortly: it doesn't link)
>
> So here they are (first some new BCC warnings):
> ---
> Warning W8080 source\vm\arrays.c 1473: 'hb_stack_ptr_from_tls()' is 
> declared but never used

BCC reports it for inline functions???
Interesting. I'll pacify it.

> And the linking problem (with BCC, MSVC looked pretty similar. Some lines 
> stripped to fit in mail size limit):
> ---
> 	bin\b32\harbour.exe -n -iinclude -q0 -w3 -es2 -gc3 -km -l  -oobj\dll\b32\ 
> utils\hbrun\hbrun.prg
> 	bcc32.exe  -c -q -d -Q -w -w-sig- -tWM -4 -O2 -OS -Ov -Oi -Oc -Iinclude 
> -Iobj\b32 -DUNICODE -v -y -oobj\dll\b32\hbrun.obj obj\dll\b32\hbrun.c
> obj\dll\b32\hbrun.c:
> 	ilink32.exe -Gn -C -ap -Tpe -Llib\b32 -Lbin\b32  @MAKE0036.@@@
> Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland
> Error: Unresolved external '_hb_compExprCBVarDel' referenced from 
> C:\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
> Error: Unresolved external '_hb_compExprDescription' referenced from 
> C:\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb

Ups. You were right. It's the problem with EXPORT attribute caused
by dividing compiler code into dll and static parts.
You will have to add also PP_LIB and COMMON_LIB.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  9 09:16:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 09:15:54 2008
Subject: [Harbour] 2008-11-09 15:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081109141647.GA9100@34-mo7-2.acn.waw.pl>

2008-11-09 15:16 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbstack.h
    * do not define hb_stack_ptr_from_tls() in BCC builds when
      HB_STACK_PRELOAD macro is not defined to pacify BCC warning

best regards
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 09:25:29 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 09:25:36 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081109141112.GA16174@34-mo7-2.acn.waw.pl>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
	<20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
	<20081109141112.GA16174@34-mo7-2.acn.waw.pl>
Message-ID: <A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>

>> Warning W8080 source\vm\arrays.c 1473: 'hb_stack_ptr_from_tls()' is
>> declared but never used
>
> BCC reports it for inline functions???
> Interesting. I'll pacify it.

Thanks.

>> Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland
>> Error: Unresolved external '_hb_compExprCBVarDel' referenced from
>> C:\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
>> Error: Unresolved external '_hb_compExprDescription' referenced from
>> C:\WORK\HARBOUR\HARBOUR\LIB\B32\HBCPLR.LIB|exproptb
>
> Ups. You were right. It's the problem with EXPORT attribute caused
> by dividing compiler code into dll and static parts.
> You will have to add also PP_LIB and COMMON_LIB.

Okay. I couldn't yet find a proper switch to exclude
exports from final executables, so maybe we should put
up with some size increase for BCC/MSVC executables.
At least until someone comes up with an idea.

What do you think in smoothing out the difference between
dll and non-dll code in non-GNU builds? (this means to
enable HB_DYNDLL for all compilations, thus making this
build switch unnecessary, and at the same time the whole
build process much quicker. This would also mean that
HB_BUILD_DLL=yes option is costless, so it can be made
a default non-option.)

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 09:28:15 2008
From: harbour.01 at syenar.hu (=?WINDOWS-1252?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 09:28:21 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4916EB9E.1090102@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4916EB9E.1090102@mail.udg.mx>
Message-ID: <0372F0AC-73BA-4ACE-A20C-B5F7E4C780E7@syenar.hu>

Hi David,

> Screen output (same as Win32:OW):
> --------------------
> make[3]: *** [hboutdbg.obj] Error 8
> make[2]: *** [descend] Error 2
> --------------------

What is the error message?

Brgds,
Viktor

From dmacias at mail.udg.mx  Sun Nov  9 09:28:58 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  9 09:29:01 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4916F3AA.4040404@mail.udg.mx>

 > It will resolve possible GPF during MT tracing but it will
 > have no effect on creating trace.log.
 > If it was not created in your builds then it means that sth is
 > wrong. Maybe you used different libraries which were compiler
 > without C_USR flag or test application was not recompiled.

Fresh build resolved MT:trace.log creation

 >> Yes, and same condition: Can not execute
 >>   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
 >> for second thread, and so does not enter hb_gt_os2_ReadKey() and 
printf("0.
 >> hb_gt_os2_ReadKey()\r\n");fflush(stdout); are never reached

 >It's very strange. What is the whole output? Can you send it here?

Original message is included below

As summary:

For first thread (how do you know is 1 ? ):
---------
[...]
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_os2_ReadKey()    <-------
2. hb_gt_os2_ReadKey()
3. hb_gt_os2_ReadKey()
4. hb_gt_os2_ReadKey()
5. hb_gt_os2_ReadKey()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
[...]
---------

For second thread (how do you know is 2 ? ):
---------
[...]
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
[...]
---------

Note: List does not contain
    0. hb_gt_os2_ReadKey()
It was added later and failed in same point:
trying to execute:
    iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );


 >> Based in your explanation, fails trying to execute
 >>   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
 >>    ---> hb_gt_os2_ReadKey()
 >> but never execute it
 >> Second thread can not access this "low level GT driver READKEY() 
 >>method (
 >> GTOS2:hb_gt_os2_ReadKey() ) ?

 >What is very strange and should not happen.
 >I'd rather expect that there is sth wrong with tests we are making.
 >Can you add:
 >   printf("0. hb_gt_cgi_ReadKey()\r\n");fflush(stdout);
 >to GTCGI hb_gt_cgi_ReadKey() function and send the ouput for test
 >program linked with GTCGI together with GTOS2?

Just wait for rebuild "older" Harbour without tracing

I suspect that trace*.log files review may change everything  :-)

David Macias



Previous message
================

>If you will have problems with tracing then please tests
>code below. It's rtl/gtos2/gtos2.c hb_gt_os2_ReadKey()
>replacement.
 >[...]

>As you can see with GTCGI it's related to GT.
>Looks like it's caused by keyboard related functions when
>executed from non main thread.

>> Not tested yet with your code replacement
>This modification should show where exactly it fails.

Wait, I was doing test


Did you see this info in gtos2.c about 16 bit ?
-------------
  * Copyright 2000 - 2001 Maurilio Longo <maurilio.longo@libero.it>
  *    hb_gt_DispBegin() / hb_gt_DispEnd()
  *    hb_gt_ScreenPtr() and hb_gt_xYYYY() functions and virtual screen
support inside hb_gt_XXXX()s
  *    16 bit KBD subsystem use inside hb_gt_os2_ReadKey()
-------------


Using HB_GT_OS2_DEFAULT

Harbour Terminal: OS/2 console
Harbour 1.1.0dev (Rev. 9846)
OS/2 4.50
DS avail=1721512KB  OS avail=1721512KB  EMM avail=0KB  MemStat:Off  MT:On

It pass (5) label tracing without problems and fail at same point

---------------
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_os2_ReadKey()    <-------
2. hb_gt_os2_ReadKey()
3. hb_gt_os2_ReadKey()
4. hb_gt_os2_ReadKey()
5. hb_gt_os2_ReadKey()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.

---------------


David Macias


From dmacias at mail.udg.mx  Sun Nov  9 09:36:32 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  9 09:36:34 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4916F570.9040006@mail.udg.mx>

Viktor:

 >> Screen output (same as Win32:OW):
 >> --------------------
 >> make[3]: *** [hboutdbg.obj] Error 8
 >> make[2]: *** [descend] Error 2
 >> --------------------

 >What is the error message?

wpp386   -DHB_FM_STATISTICS_OFF -DHB_TR_LEVEL_DEBUG  ../../hboutdbg.c 
-fo=hboutdbg.obj
../../hboutdbg.c(166): Error! E003: col(1) missing return value
make[3]: Leaving directory `/harbour811/harbour/contrib/xhb/os2/owatcom'

It is due a recent change of, Francesco ?

David Macias


From druzus at acn.waw.pl  Sun Nov  9 10:03:58 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 10:03:06 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4916EB9E.1090102@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4916EB9E.1090102@mail.udg.mx>
Message-ID: <20081109150358.GA13007@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> I made a Harbour fresh checkout and build with
>   set C_USR=-DHB_FM_STATISTICS_OFF -DHB_TR_LEVEL_DEBUG
> Screen output (same as Win32:OW):
> --------------------
> make[3]: *** [hboutdbg.obj] Error 8
> make[2]: *** [descend] Error 2
> --------------------
> Surprise: sqlite3 show a lot of warnings in gcc335, but no one in OW and 
> hbsqlit3.lib build fine
> Testing Harbour tracing with pba2.prg:
> -----------
> func main
>  qout( "hello world" )
> return nil
> -----------
> Before running new test application:
>   set HB_TR_LEVEL=HB_TR_DEBUG
>   set HB_TR_FLUSH=1
>   set HB_TR_OUTPUT=trace.log
> and results are:
> [E:\harbour811\harbour]del trace.log
> SYS0002: The system cannot find the file specified.

You set it too early. It will cause that harbour.exe will
also create trace.log :-)
It's not a problem because it will be overwritten by
test application.

> [E:\harbour811\harbour]bin\pbaos2.cmd pba2
> Open Watcom Linker Version 1.7
> Portions Copyright (c) 1985-2002 Sybase, Inc. All Right
> Source code is available under the Sybase Open Watcom P
> See http://www.openwatcom.org/ for details.
> loading object files
> searching libraries
> creating an OS/2 32-bit executable
> [E:\harbour811\harbour]pba2.exe
> hello world
> [E:\harbour811\harbour]dir trace.log
> The volume label in drive E is ECS.
> The Volume Serial Number is A913:E015.
> Directory of E:\harbour811\harbour
>  9/11/08  7:29a       143,326      0 a---  trace.log

And this is correct log from pba2.exe

> [E:\harbour811\harbour]del trace.log
> [E:\harbour811\harbour]bin\pbaos2.cmd -mt pba2
> Open Watcom Linker Version 1.7
> Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
> Source code is available under the Sybase Open Watcom Public License.
> See http://www.openwatcom.org/ for details.
> loading object files
> searching libraries
> creating an OS/2 32-bit executable
> [E:\harbour811\harbour]pba2.exe
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0005.
> [E:\harbour811\harbour]dir trace.log
> The volume label in drive E is ECS.
> The Volume Serial Number is A913:E015.
> Directory of E:\harbour811\harbour
>  9/11/08  7:33a        21,046      0 a---  trace.log
> Now trace.log are created in MT with a size much smaller than ST

Because it's not log from pba2.exe but from harbour.exe executed
before to compile pba2.prg
pba2.exe didn't created any logs what means that it was not linked
with the same libraries as for ST mode which were compiled with HB_TRACE
support. So you should check what -mt switch exactly does in pbaos2.cmd
and why it changes linked libraries. Maybe it can also explain strange
results you have with printf() outputs.

> [E:\harbour811\harbour]bin\pbaos2.cmd pba
> Open Watcom Linker Version 1.7
> Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
> Source code is available under the Sybase Open Watcom Public License.
> See http://www.openwatcom.org/ for details.
> loading object files
> searching libraries
> creating an OS/2 32-bit executable
> [E:\harbour811\harbour]pba.exe
> Exception c0000005 at address 000afadf
>                                        Called from HB_THREADJOIN(0)
> Called from M
> AIN(2) in pba.prg
>                  SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0005.

Yet another tracelog message which should be fixed but
it's not related to our problem.

Viktor HB_ERR_FUNCNAME defined as 1 is much more danger then
then previous version which was redirected to valid empty string
so it was safe to use this pointer in any context. Maybe we should
restore it.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 10:04:15 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 10:04:11 2008
Subject: [Harbour] 2008-11-09 16:00 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9427c$Blat.v2.6.2$6e7e1c4a$75c6dbab830@127.0.0.1>

2008-11-09 16:00 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
    ! Added hbpp.lib and hbcommon.lib to HBRUN_DLL liblist.

  * include/hbapi.h
  * source/vm/cmdarg.c
  * source/common/hbver.c
  * source/common/hbverdsp.c
  * source/rtl/console.c
  * source/rtl/setcolor.c
  * source/rtl/setcurs.c
    + Added HB_EXPORT to some functions to make it possible 
      to build hbrun-dll.exe.
      For other reasons, it only works if Harbour built with 
      set C_USR=-DHB_DYNLIB.
    ; TODO: Make HB_DYNLIB the default build mode, do gradual 
            steps to remove separate DLL building pass, and 
            finally to remove HB_BUILD_DLL option.
            The only drawback will be about 10-100K 
            (currently) overhead in final executable size due 
            to included export table for BCC and MSVC builds.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  9 10:21:53 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 10:21:01 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4916F3AA.4040404@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4916F3AA.4040404@mail.udg.mx>
Message-ID: <20081109152153.GB13007@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Original message is included below
>
> As summary:
>
> For first thread (how do you know is 1 ? ):
> ---------
> [...]
> 2. hb_threadMutexLock()
> 2. hb_inkeyPoll()
> 3. hb_inkeyPoll()
> 1. hb_gt_os2_ReadKey()    <-------
> 2. hb_gt_os2_ReadKey()
> 3. hb_gt_os2_ReadKey()
> 4. hb_gt_os2_ReadKey()
> 5. hb_gt_os2_ReadKey()
> 4. hb_inkeyPoll()
> _hb_gettid()
> TID=1
> 5. hb_inkeyPoll()
> 6. hb_inkeyPoll()
> [...]
> ---------
>
> For second thread (how do you know is 2 ? ):
> ---------
> [...]
> 2. hb_threadMutexLock()
> 2. hb_inkeyPoll()
> 3. hb_inkeyPoll()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> [...]
> ---------
>
> Note: List does not contain
>    0. hb_gt_os2_ReadKey()
> It was added later and failed in same point:
> trying to execute:
>    iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );

I've seen it. Thank you but because the results where strange
I asked you to repeat the test with "0. hb_gt_os2_ReadKey(%p)".

best regards,
Przemek
From e.m.giordano at emagsoftware.it  Sun Nov  9 10:26:03 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Sun Nov  9 10:26:08 2008
Subject: [Harbour] Strange entries in changelog
Message-ID: <E321A10F7BAC4DA5ADBB514AF333F5F4@emag>

I see exactly six times the following line in the very early entries (year 
1999):

- Added $Id: ChangeLog 9879 2008-11-09 15:04:03Z vszakats $ block at top

What do they mean?

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From druzus at acn.waw.pl  Sun Nov  9 10:29:15 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 10:28:22 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
	<20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
	<20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
Message-ID: <20081109152915.GC13007@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> What do you think in smoothing out the difference between
> dll and non-dll code in non-GNU builds? (this means to
> enable HB_DYNDLL for all compilations, thus making this
> build switch unnecessary, and at the same time the whole
> build process much quicker. This would also mean that
> HB_BUILD_DLL=yes option is costless, so it can be made
> a default non-option.)

LD in GCC for Windows has a feature which create export
table automatically for all public functions when non
of them is explicitly marked as exported and such symbol
table is necessary to link application so it's not necessary
because now non exported binaries can be used to create DLL.
BTW few weeks ago I added some missing HB_EXPORT to functions
used in -gc3 output and I intentionally made it only in
header files. Looks that it works for all supported compilers
so we can safely remove HB_EXPORT from .c files.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 10:30:47 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 10:30:53 2008
Subject: [Harbour] Strange entries in changelog
In-Reply-To: <E321A10F7BAC4DA5ADBB514AF333F5F4@emag>
References: <E321A10F7BAC4DA5ADBB514AF333F5F4@emag>
Message-ID: <537FFE74-FDBE-4008-A52D-4C4176D11315@syenar.hu>

'$Id' text was included in a ChangeLog entry, and
these always get replaced with the current SVN header.

This happens one each commit, since this entry was added
in 1999.

We can correct it, but it does no harm.

Brgds,
Viktor

On 2008.11.09., at 16:26, Enrico Maria Giordano wrote:

> I see exactly six times the following line in the very early entries  
> (year 1999):
>
> - Added $Id: ChangeLog 9879 2008-11-09 15:04:03Z vszakats $ block at  
> top
>
> What do they mean?
>
> EMG
>
> --
> EMAG Software Homepage:     http://www.emagsoftware.it
> The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
> The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
> The EMG Music page:         http://www.emagsoftware.it/emgmusic
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From dmacias at mail.udg.mx  Sun Nov  9 10:39:48 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  9 10:39:50 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49170444.7050209@mail.udg.mx>

>> Based in your explanation, fails trying to execute
>>   iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
>>    ---> hb_gt_os2_ReadKey()
>> but never execute it
>> Second thread can not access this "low level GT driver READKEY() 
>>method (
>> GTOS2:hb_gt_os2_ReadKey() ) ?

>What is very strange and should not happen.
>I'd rather expect that there is sth wrong with tests we are making.
>Can you add:
>   printf("0. hb_gt_cgi_ReadKey()\r\n");fflush(stdout);
>to GTCGI hb_gt_cgi_ReadKey() function and send the ouput for test
>program linked with GTCGI together with GTOS2?

Entire results for HB_GT_OS2_DEFAULT, HB_GT_CGI_DEFAULT, 
HB_GT_STD_DEFAULT are below

HB_GT_OS2_DEFAULT and HB_GT_STD_DEFAULT should fail equal, but STD does 
a step ahead  (??)

As summary:

HB_GT_OS2_DEFAULT
=================
... thread 2
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.

    printf("1. hb_gt_def_InkeyPollDo()\r\n");fflush(stdout);
    iKey = HB_GTSELF_READKEY( pGT, INKEY_ALL );
    printf("2. hb_gt_def_InkeyPollDo()\r\n");fflush(stdout);


HB_GT_CGI_DEFAULT
=================
... thread 2
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_cgi_ReadKey()        <-------
2. hb_gt_def_InkeyPollDo()
...

HB_GT_STD_DEFAULT
=================
... thread 2
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_std_ReadKey()        <-------  (???)
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.


These are code sections for OS2 and STD:

-------------------
static int hb_gt_os2_ReadKey( PHB_GT pGT, int iEventMask )
{
    int ch;              /* next char if any */

    printf("0. hb_gt_os2_ReadKey()\r\n");fflush(stdout);

    HB_TRACE(HB_TR_DEBUG, ("hb_gt_os2_ReadKey(%p,%d)", pGT, iEventMask));

    printf("1. hb_gt_os2_ReadKey()\r\n");fflush(stdout);

    /* zero out keyboard event record */
    memset( s_key, 0, sizeof( KBDKEYINFO ) );

    printf("2. hb_gt_os2_ReadKey()\r\n");fflush(stdout);
    /* Get next character without wait */
    KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk );


-------------------

static int hb_gt_std_ReadKey( PHB_GT pGT, int iEventMask )
{
    PHB_GTSTD pGTSTD;
    int ch = 0;

    printf("0. hb_gt_std_ReadKey()\r\n");fflush(stdout);

    HB_TRACE(HB_TR_DEBUG, ("hb_gt_std_ReadKey(%p,%d)", pGT, iEventMask));

    HB_SYMBOL_UNUSED( iEventMask );

    pGTSTD = HB_GTSTD_GET( pGT );

#if defined( HB_OS_UNIX_COMPATIBLE ) || defined( __DJGPP__ )
-------------------


David Macias


HB_GT_OS2_DEFAULT
=================
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_os2_ReadKey()        <--------
1. hb_gt_os2_ReadKey()
2. hb_gt_os2_ReadKey()
3. hb_gt_os2_ReadKey()
4. hb_gt_os2_ReadKey()
1. hb_gt_def_MouseReadKey()
2. hb_gt_def_MouseReadKey()
5. hb_gt_os2_ReadKey()
2. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.


HB_GT_CGI_DEFAULT
=================
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_cgi_ReadKey()      <------
2. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPollDo()
4. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_cgi_ReadKey()        <-------
2. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPollDo()
4. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=2
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
_hb_gettid()
TID=2
_hb_gettid()
TID=2
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1


HB_GT_STD_DEFAULT
=================
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_std_ReadKey()     <-------
2. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_std_ReadKey()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.


From harbour.01 at syenar.hu  Sun Nov  9 10:42:09 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 10:42:17 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081109152915.GC13007@34-mo7-2.acn.waw.pl>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
	<20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
	<20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
Message-ID: <4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>

Hi Przemek,

>> What do you think in smoothing out the difference between
>> dll and non-dll code in non-GNU builds? (this means to
>> enable HB_DYNDLL for all compilations, thus making this
>> build switch unnecessary, and at the same time the whole
>> build process much quicker. This would also mean that
>> HB_BUILD_DLL=yes option is costless, so it can be made
>> a default non-option.)
>
> LD in GCC for Windows has a feature which create export
> table automatically for all public functions when non
> of them is explicitly marked as exported and such symbol
> table is necessary to link application so it's not necessary
> because now non exported binaries can be used to create DLL.
> BTW few weeks ago I added some missing HB_EXPORT to functions
> used in -gc3 output and I intentionally made it only in
> header files. Looks that it works for all supported compilers
> so we can safely remove HB_EXPORT from .c files.

Thanks for clarifying this.
I'll remove them.

I don't understand the other part of your answer, maybe
my question wasn't very clear. This topic seems to only
affect BCC / MSVC, GCC is much cleaner probably.

So, currently BCC/MSVC does two passes, one for static
libs and executables using these static libs, plus
there is an additional pass, when certain object are
recompiled with functions marked as exported to build
harbour.dll. This second pass uses -DHB_DYNLIB and it
only kicks in if 'HB_BUILD_DLL=yes' (default is 'no').

'HB_BUILD_DLL=yes' makes whole process take almost
twice as much time (and disk space). Also, building
hbrun-dll won't work this way unless we create even more
complications.

So, it's time that we make HB_DYNLIB the default, which
instantly makes the second pass unnecessary, it also
fixes hbrun-dll build problem. This way building .dlls
has no significant drawbacks, and could be enabled
for default builds, making also HB_BUILD_DLL option
unnecessary (and closing the gap between GNU and
non-GNU makes somewhat).

The only perceivable drawback is some executable size
increase for BCC/MSVC (max 100K), plus the fact that
all Harbour executables will export certain (used)
Harbour functions.

I was wondering if you have any concerns going to this
direction?

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 10:52:25 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 10:52:21 2008
Subject: [Harbour] 2008-11-09 16:49 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94283$Blat.v2.6.2$29184458$1554768b1360@127.0.0.1>

2008-11-09 16:49 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * contrib/hbcurl/hbcurl.c
  * contrib/hbcurl/hbcurl.ch
    + Added libcurl 7.19.1 features.
    % Removed hashing calls from some parts which are 
      only compiled for libcurl versions which don't need 
      hashing anyway.

  * ChangeLog
    * Changed CVS ID tag name in some very old entries to 
      avoid them being replaced by versioning system.
--
Brgds,
Viktor

From e.m.giordano at emagsoftware.it  Sun Nov  9 10:57:00 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Sun Nov  9 10:57:05 2008
Subject: [Harbour] Strange entries in changelog
References: <E321A10F7BAC4DA5ADBB514AF333F5F4@emag>
	<537FFE74-FDBE-4008-A52D-4C4176D11315@syenar.hu>
Message-ID: <377727C518B644A69CB068987DDA5477@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: domenica 9 novembre 2008 16.30
Oggetto: Re: [Harbour] Strange entries in changelog


> '$Id' text was included in a ChangeLog entry, and
> these always get replaced with the current SVN header.
>
> This happens one each commit, since this entry was added
> in 1999.
>
> We can correct it, but it does no harm.

Ok, thank you. I did imagine something similar.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From dmacias at mail.udg.mx  Sun Nov  9 10:59:15 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  9 10:59:17 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491708D3.7010607@mail.udg.mx>

 >You set it too early. It will cause that harbour.exe will
 >also create trace.log :-)
 >It's not a problem because it will be overwritten by
 >test application.

You are right

 >>  9/11/08  7:29a       143,326      0 a---  trace.log

 >And this is correct log from pba2.exe

 >>  9/11/08  7:33a        21,046      0 a---  trace.log
 >> Now trace.log are created in MT with a size much smaller than ST

 >Because it's not log from pba2.exe but from harbour.exe executed
 >before to compile pba2.prg
 >pba2.exe didn't created any logs what means that it was not linked
 >with the same libraries as for ST mode which were compiled with HB_TRACE
 >support. So you should check what -mt switch exactly does in pbaos2.cmd
 >and why it changes linked libraries. Maybe it can also explain strange
 >results you have with printf() outputs.

pbaos2.cmd are based in hbmk.bat and hbmk_os2.cmd

Basically:
-------
if not "%1" == "-mt" goto NO_MT
    set _HB_MT=yes
    shift
    goto REPEAT
:NO_MT

set _HBVM_LIB=hbvm
if "%_HB_MT%" == "yes" set _HBVM_LIB=hbvmmt
-------
    set _HB_PRG_NAME=%1
-------

       wpp386 -j -w3 -d2 -5s -5r -fp5 -oxehtz -zq -zt0 -mf -bt=OS2 -bm 
%_HB_PRG_NAME%.c -fo=%_HB_PRG_NAME%.obj -I%HB_INC_INSTALL%
       echo debug all OP stack=65536 OP CASEEXACT NAME 
%_HB_PRG_NAME%.exe > _hb_mk.tmp
       echo FILE %_HB_PRG_NAME%.obj >> _hb_mk.tmp
       echo LIBPATH %HB_LIB_INSTALL% >> _hb_mk.tmp
       echo LIB hbcpage.lib >> _hb_mk.tmp
       echo LIB hbdebug.lib >> _hb_mk.tmp
       echo LIB %_HBVM_LIB%.lib >> _hb_mk.tmp
       echo LIB hbrtl.lib >> _hb_mk.tmp
       echo LIB gtos2.lib >> _hb_mk.tmp
       echo LIB gtcgi.lib >> _hb_mk.tmp
       echo LIB gtpca.lib >> _hb_mk.tmp
       echo LIB gtstd.lib >> _hb_mk.tmp
       echo LIB hblang.lib >> _hb_mk.tmp
       echo LIB hbmacro.lib >> _hb_mk.tmp
       echo LIB hbpp.lib >> _hb_mk.tmp
       echo LIB rddntx.lib >> _hb_mk.tmp
       echo LIB rddcdx.lib >> _hb_mk.tmp
       echo LIB rddfpt.lib >> _hb_mk.tmp
       echo LIB hbhsx.lib >> _hb_mk.tmp
       echo LIB hbsix.lib >> _hb_mk.tmp
       echo LIB hbrdd.lib >> _hb_mk.tmp
       echo LIB hbcommon.lib >> _hb_mk.tmp
       echo LIB hbpcre.lib >> _hb_mk.tmp
       echo LIB hbzlib.lib >> _hb_mk.tmp
       wlink @_hb_mk.tmp
       del _hb_mk.tmp
       goto CLEANUP

-------

I see just one %_HBVM_LIB% while gcc have two of them, but just one rtl too

I added LIBPATH

 >>                                        Called from HB_THREADJOIN(0)
 >> Called from M
 >> AIN(2) in pba.prg

 >Yet another tracelog message which should be fixed but
 >it's not related to our problem.

 >Viktor HB_ERR_FUNCNAME defined as 1 is much more danger then
 >then previous version which was redirected to valid empty string
 >so it was safe to use this pointer in any context. Maybe we should
 >restore it.


David Macias



From harbour.01 at syenar.hu  Sun Nov  9 11:06:48 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 11:06:45 2008
Subject: [Harbour] 2008-11-09 17:03 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94285$Blat.v2.6.2$2b82c4e6$16a09452d06a@127.0.0.1>

2008-11-09 17:03 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * contrib/gtwvg/wvgcore.c
  * contrib/gtwvg/wvgutils.c
  * contrib/hbwin/win_dll.c
  * contrib/hbwin/win_ole.c
  * contrib/xhb/cstructc.c
  * contrib/xhb/dbgfxc.c
  * source/common/hbarch.c
  * source/common/hbdate.c
  * source/common/hbfsapi.c
  * source/common/hbstr.c
  * source/common/hbver.c
  * source/common/hbverdsp.c
  * source/debug/dbgentry.c
  * source/main/harbour.c
  * source/rdd/dbf1.c
  * source/rdd/nulsys/nulsys.c
  * source/rdd/wacore.c
  * source/rdd/wafunc.c
  * source/rdd/workarea.c
  * source/rtl/cdpapi.c
  * source/rtl/console.c
  * source/rtl/dates.c
  * source/rtl/errorint.c
  * source/rtl/file.c
  * source/rtl/filesys.c
  * source/rtl/fscopy.c
  * source/rtl/fserror.c
  * source/rtl/fstemp.c
  * source/rtl/gtapi.c
  * source/rtl/gtapiu.c
  * source/rtl/hbadler.c
  * source/rtl/hbcrc.c
  * source/rtl/hbffind.c
  * source/rtl/hbgtcore.c
  * source/rtl/hbmd5.c
  * source/rtl/inkeyapi.c
  * source/rtl/isprint.c
  * source/rtl/math.c
  * source/rtl/mouseapi.c
  * source/rtl/seconds.c
  * source/rtl/setcolor.c
  * source/rtl/setcurs.c
  * source/rtl/strmatch.c
  * source/vm/hvm.c
    % Removed HB_EXPORT from function definitions.
      Placing it in declaration is enough.

  * source/debug/dbgentry.c
    * Formatting.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  9 11:10:08 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 11:09:16 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49170444.7050209@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49170444.7050209@mail.udg.mx>
Message-ID: <20081109161008.GA29031@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Entire results for HB_GT_OS2_DEFAULT, HB_GT_CGI_DEFAULT, HB_GT_STD_DEFAULT 
> are below
> HB_GT_OS2_DEFAULT and HB_GT_STD_DEFAULT should fail equal, but STD does a 
> step ahead  (??)

Thank you very much.
Maybe when GTOS2 is used then screen is not refreshed before crach.
Do you have the same results when you redirect application output
to file? f.e.:
   pba.exe > out.log

It looks that the problem is caused by reading keyboard input from
second threads. You can make test to confirm it by replacing
hb_gt_os2_ReadKey() body with code from hb_gt_cgi_ReadKey().
If final application linked with such GTOS2 will work correctly
then we will have to look closer on hb_gt_os2_ReadKey() internals.
In such case we should also check other GT functions. Probably
testing mttest*.prg files will be enough.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 11:17:05 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 11:17:02 2008
Subject: [Harbour] 2008-11-09 17:15 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94286$Blat.v2.6.2$9b3e5858$69418b3864e@127.0.0.1>

2008-11-09 17:15 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/vm/arrays.c
  * source/vm/classes.c
  * source/vm/cmdarg.c
  * source/vm/codebloc.c
  * source/vm/debug.c
  * source/vm/dynsym.c
  * source/vm/extend.c
  * source/vm/fm.c
  * source/vm/hashes.c
  * source/vm/hvm.c
  * source/vm/itemapi.c
  * source/vm/maindll.c
  * source/vm/maindllh.c
  * source/vm/maindllp.c
  * source/vm/mainstd.c
  * source/vm/mainwin.c
  * source/vm/set.c
  * source/vm/vm.c
    % Removed HB_EXPORT from remaining function definitions.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  9 11:26:31 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 11:25:39 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
	<20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
	<20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
Message-ID: <20081109162631.GA4009@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> I don't understand the other part of your answer, maybe
> my question wasn't very clear. This topic seems to only
> affect BCC / MSVC, GCC is much cleaner probably.
> So, currently BCC/MSVC does two passes, one for static
> libs and executables using these static libs, plus
> there is an additional pass, when certain object are
> recompiled with functions marked as exported to build
> harbour.dll. This second pass uses -DHB_DYNLIB and it
> only kicks in if 'HB_BUILD_DLL=yes' (default is 'no').

make_gcc.sh also compiles separately files for shared library.
It's necessary for some platforms because code for shared libraries
may need different switches so this functionality should not be
removed. If you want to eliminate separate compilation for shared
library in some builds then it will be enough to make DLL_OBJ_DIR
equal to OBJ_DIR, f.e.:
   DLL_OBJ_DIR=$(OBJ_DIR)
Of course if it's possible to use the same binaries.

> 'HB_BUILD_DLL=yes' makes whole process take almost
> twice as much time (and disk space). Also, building
> hbrun-dll won't work this way unless we create even more
> complications.

Sorry but I do not know what you think writing about problem
with hbrun-dll.

> So, it's time that we make HB_DYNLIB the default, which
> instantly makes the second pass unnecessary, it also
> fixes hbrun-dll build problem. This way building .dlls
> has no significant drawbacks, and could be enabled
> for default builds, making also HB_BUILD_DLL option
> unnecessary (and closing the gap between GNU and
> non-GNU makes somewhat).
> The only perceivable drawback is some executable size
> increase for BCC/MSVC (max 100K), plus the fact that
> all Harbour executables will export certain (used)
> Harbour functions.
> I was wondering if you have any concerns going to this
> direction?

For me it's not a problem but please remember that you should
not remove such functionality from make files because it may
be necessary in some situations. We should also remember about
builds for environments with restrictive memory amount, f.e.
for WinCE where probably also -gc3 should be replaced with -gc0
and in MinGWCE -O3 GCC switch replaced by -O2.

best regards,
Przemek
From bedipritpal at hotmail.com  Sun Nov  9 11:37:52 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 11:37:55 2008
Subject: [Harbour] GTWIN and new console window
Message-ID: <20408122.post@talk.nabble.com>


Hello All

After long I needed a pure console appln and built one with GTWIN.
The build environments and switches are the same as with GTWVT/GTWVG.
Everything works fine except that whenever I execute it from a 
DOS console in Windows, it opens up another another console 
with scrollbars. I precieve CONSOLE application to acquire the same 
console its working space and execute the appliction in the same box only.

I know I am missing something but what is that ?

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/GTWIN-and-new-console-window-tp20408122p20408122.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From abe.buch at att.net  Sun Nov  9 11:43:52 2008
From: abe.buch at att.net (Abeb)
Date: Sun Nov  9 11:43:55 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20081031110930.GB22253@34-mo7-2.acn.waw.pl>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
Message-ID: <20408175.post@talk.nabble.com>


was this issue attened?  I still can not run wcecon.exe on PocketPc. It won't
open any window.
Thanks,
abe


Przemyslaw Czerpak-2 wrote:
> 
> On Thu, 30 Oct 2008, Pritpal Bedi wrote:
> 
> Hi Pritpal
> 
>> I am looking into it but so far have not got any clue what went wrong.
> 
> Thank you.
> 
>> Yes. hb_gt_wvt_MouseEvent() has defined two statics. I will fix them in a
>> while.
>> But probably this is not the cause of WinCE failure.
> 
> For sure it's not the reason but it has to be fixed.
> 
>> I will be looking into multiple calls to CreateFontIndirect().
>> May be flickering is caused by this factor alone, I am not sure.
> 
> It can be caused also by drawing the window and then resizing and
> repositioning. All this operations should be grouped together.
> Unfortunately now I can make test only with WINE and I do not
> want to hardcode sth what will work correctly only with WINE
> due to some small difference in emulations. In next week I can
> make some tests with genuine MS-Windows computer so maybe I can
> help.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20408175.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Sun Nov  9 11:45:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 11:44:54 2008
Subject: [Harbour] GTWIN and new console window
In-Reply-To: <20408122.post@talk.nabble.com>
References: <20408122.post@talk.nabble.com>
Message-ID: <20081109164547.GA31108@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> After long I needed a pure console appln and built one with GTWIN.
> The build environments and switches are the same as with GTWVT/GTWVG.
> Everything works fine except that whenever I execute it from a 
> DOS console in Windows, it opens up another another console 
> with scrollbars. I precieve CONSOLE application to acquire the same 
> console its working space and execute the appliction in the same box only.
> I know I am missing something but what is that ?

In GUI programs console is not inherited from caller and GTWIN allocates
new console window.
Type of application (GUI/CUI) in MS-Windows builds is defined during
linking by some linker switches.
In BCC builds you have to remove -tW switch.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 11:45:37 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 11:45:34 2008
Subject: [Harbour] 2008-11-09 17:44 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9428a$Blat.v2.6.2$97a80ba4$159ccb09b532@127.0.0.1>

2008-11-09 17:44 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_vc.mak
  * config/rules.cf
  * config/w32/mingwce.cf
  * config/w32/poccce.cf
  * config/w32/msvcce.cf
    * Use Harbour option -gc0 for WinCE builds.
    * Use C option -O2 (instead of -O3) for MinGWCE builds.
    ; None of these were tested.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  9 11:47:21 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 11:46:28 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20408175.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
Message-ID: <20081109164721.GA2969@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Abeb wrote:

Hi,

> was this issue attened?  I still can not run wcecon.exe on PocketPc. It won't
> open any window.

You have to use older GTWVT untill current one will not be fixed.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 11:47:17 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 11:47:25 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081109162631.GA4009@34-mo7-2.acn.waw.pl>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
	<20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
	<20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
	<20081109162631.GA4009@34-mo7-2.acn.waw.pl>
Message-ID: <AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>

Hi Przemek,

> make_gcc.sh also compiles separately files for shared library.
> It's necessary for some platforms because code for shared libraries
> may need different switches so this functionality should not be
> removed. If you want to eliminate separate compilation for shared
> library in some builds then it will be enough to make DLL_OBJ_DIR
> equal to OBJ_DIR, f.e.:
>   DLL_OBJ_DIR=$(OBJ_DIR)
> Of course if it's possible to use the same binaries.

I see. Do you know which platforms are those?

>> 'HB_BUILD_DLL=yes' makes whole process take almost
>> twice as much time (and disk space). Also, building
>> hbrun-dll won't work this way unless we create even more
>> complications.
>
> Sorry but I do not know what you think writing about problem
> with hbrun-dll.

The same thing I've already posted. The only way
hbrun-dll.exe can be built now is to use
'set C_USR=-DHB_DYNLIB'

>> I was wondering if you have any concerns going to this
>> direction?
>
> For me it's not a problem but please remember that you should
> not remove such functionality from make files because it may
> be necessary in some situations. We should also remember about

Which can these be?

> builds for environments with restrictive memory amount, f.e.
> for WinCE where probably also -gc3 should be replaced with -gc0
> and in MinGWCE -O3 GCC switch replaced by -O2.

Committed, but not tested. (no WinCE capable compiler
around here. Except POCC which doesn't really work yet)

Do you think it's alright to remove the second pass for BCC/MSVC?

Brgds,
Viktor

From bedipritpal at hotmail.com  Sun Nov  9 11:55:02 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 11:55:05 2008
Subject: [Harbour] GTWIN and new console window
In-Reply-To: <20081109164547.GA31108@34-mo7-2.acn.waw.pl>
References: <20408122.post@talk.nabble.com>
	<20081109164547.GA31108@34-mo7-2.acn.waw.pl>
Message-ID: <20408275.post@talk.nabble.com>


Hello Przemek


Przemyslaw Czerpak-2 wrote:
> 
> In GUI programs console is not inherited from caller and GTWIN allocates
> new console window.
> Type of application (GUI/CUI) in MS-Windows builds is defined during
> linking by some linker switches.
> In BCC builds you have to remove -tW switch.
> 

I was suspecting the same, thanks for the clarification.
Do I need to build Harbour itself without -tW or only the appln will do ?

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/GTWIN-and-new-console-window-tp20408122p20408275.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 11:55:58 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 11:56:01 2008
Subject: [Harbour] GTWIN and new console window
In-Reply-To: <20408275.post@talk.nabble.com>
References: <20408122.post@talk.nabble.com>
	<20081109164547.GA31108@34-mo7-2.acn.waw.pl>
	<20408275.post@talk.nabble.com>
Message-ID: <20408287.post@talk.nabble.com>


Sorry for my ignorance. Harbour is never buit with -tW switch.


Pritpal Bedi wrote:
> 
> Hello Przemek
> 
> 
> Przemyslaw Czerpak-2 wrote:
>> 
>> In GUI programs console is not inherited from caller and GTWIN allocates
>> new console window.
>> Type of application (GUI/CUI) in MS-Windows builds is defined during
>> linking by some linker switches.
>> In BCC builds you have to remove -tW switch.
>> 
> 
> I was suspecting the same, thanks for the clarification.
> Do I need to build Harbour itself without -tW or only the appln will do ?
> 
> Regards
> Pritpal Bedi
> 
> 

-- 
View this message in context: http://www.nabble.com/GTWIN-and-new-console-window-tp20408122p20408287.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dmacias at mail.udg.mx  Sun Nov  9 11:57:46 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov  9 11:57:47 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4917168A.7020308@mail.udg.mx>

 >Thank you very much.
 >Maybe when GTOS2 is used then screen is not refreshed before crach.
 >Do you have the same results when you redirect application output
 >to file? f.e.:
 >   pba.exe > out.log

Results included in message were redirected to saleos2.txt, salecgi.txt, 
salestd.txt

In screen or redirected are same

 >It looks that the problem is caused by reading keyboard input from
 >second threads. You can make test to confirm it by replacing
 >hb_gt_os2_ReadKey() body with code from hb_gt_cgi_ReadKey().
 >If final application linked with such GTOS2 will work correctly
 >then we will have to look closer on hb_gt_os2_ReadKey() internals.
 >In such case we should also check other GT functions. Probably
 >testing mttest*.prg files will be enough.

Entire results are below

It work correctly using hb_gt_cgi_ReadKey() as hb_gt_os2_ReadKey()

I insist, it seem to fail trying to execute hb_gt_os2_ReadKey(), or 
maybe is executed but screen is not refreshed with tracing labels on it


I was catching and error DISAPPEAR applying in hb_gt_os2_ReadKey():
    /*   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk ); */

As you said, fail reading keyboard input except thread 1  :-)

... and screen/output is not updated ?


But in hb_gt_std_ReadKey() does not exist KbdCharIn() and fail

May be due platform/compilers cases  ?

#elif defined( __WATCOMC__ )
    if( pGTSTD->fStdinConsole )
    {
       if( kbhit() )
       {
          ch = getch();
          if( ( ch == 0 || ch == 224 ) && kbhit() )
          {
             /* It was a function key lead-in code, so read the actual
                function key and then offset it by 256 */
             ch = getch() + 256;
          }
          ch = hb_gt_dos_keyCodeTranslate( ch );
          if( ch > 0 && ch <= 255 )
             ch = pGTSTD->keyTransTbl[ ch ];
       }
    }
    else if( !eof( pGTSTD->hStdin ) )
    {
       BYTE bChar;
       if( read( pGTSTD->hStdin, &bChar, 1 ) == 1 )
          ch = pGTSTD->keyTransTbl[ bChar ];
    }
#else
    {
       int TODO; /* TODO: */
    }
#endif



David Macias


_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_cgi_ReadKey()        <-------
2. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPollDo()
4. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=1
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1
1. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
2. hb_inkeyPoll()
3. hb_inkeyPoll()
1. hb_gt_def_InkeyPoll()
2. hb_gt_def_InkeyPoll()
1. hb_gt_def_InkeyPollDo()
0. hb_gt_cgi_ReadKey()        <-------
2. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPollDo()
4. hb_gt_def_InkeyPollDo()
3. hb_gt_def_InkeyPoll()
4. hb_inkeyPoll()
_hb_gettid()
TID=2
5. hb_inkeyPoll()
6. hb_inkeyPoll()
1. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
2. hb_threadMutexLock()
_hb_gettid()
TID=2
_hb_gettid()
TID=2
_hb_gettid()
TID=2
_hb_gettid()
TID=2
1. hb_threadMutexLock()
_hb_gettid()
TID=1
_hb_gettid()
TID=1
2. hb_threadMutexLock()
_hb_gettid()
TID=1

From bedipritpal at hotmail.com  Sun Nov  9 11:59:51 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 11:59:54 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20408175.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
Message-ID: <20408327.post@talk.nabble.com>


Abeb


Abeb wrote:
> 
> was this issue attened?  I still can not run wcecon.exe on PocketPc. It
> won't open any window.
> Thanks,
> 

Place:

SetColor( 'N/W' )
CLS 

command at the begining of the Main(). 
Just check it and report back on the list if it helps.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20408327.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 12:18:40 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 12:18:43 2008
Subject: [Harbour] Classes: Methods and Instance Variables with SAME Name
In-Reply-To: <20354744.post@talk.nabble.com>
References: <20354744.post@talk.nabble.com>
Message-ID: <20408479.post@talk.nabble.com>


Hello

Just to be sure that I am doing right at the start
here is the code I am employing with methods and 
instance variables with the same name.

Please guide me if there is better and efficient way to 
accomplish the same.


CLASS WvgWindow 

   DATA lbClick 
    
   METHOD Init() 
   METHOD lbClick   SETGET

   ENDCLASS 

METHOD init() CLASS WvgWindow 
   RETURN SELF 

METHOD lbClick( xParam ) CLASS WvgCrt

   if hb_isNil( xParam ) .or. hb_isBlock( xParam )
      ::sl_lbClick := xParam
      RETURN NIL
   endif

   if hb_isArray( xParam ) .and. hb_isBlock( ::sl_lbClick )
      eval( ::sl_lbClick, xParam, NIL, Self )
   endif

   RETURN Self


As this way suggests that there will ever be parameter checking
when either executing or assigning, will not it affects the overall
performance given the fact that such code will be executed 
hundreds of time within short span of program execution.
This is only one method, there are more than a dozens like that.

All the help is appreciated.

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/Classes%3A-Methods-and-Instance-Variables-with-SAME-Name-tp20354744p20408479.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Sun Nov  9 12:22:17 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 12:21:25 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>
References: <01c9426f$Blat.v2.6.2$4174da70$1390797af7ee@127.0.0.1>
	<20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
	<20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
	<20081109162631.GA4009@34-mo7-2.acn.waw.pl>
	<AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>
Message-ID: <20081109172217.GB8360@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> I see. Do you know which platforms are those?

F.e. Linux. For shared binaries -fPIC or -fpic should be used in
most of architectures. It forces relocatable code but with the cost
of speed. Relocatable cost is a little bit less efficient. In x86@32
it's still possible to create Harbour shared library from binaries
compiled without -fPIC because we do not have any code which cannot
be converted and GCC does the conversion automatically when harbour.so
is created.
For 64bit -PIC is enabled automatically for all builds with the cost
of speed because GNU make does not support separated compilation for
shared and static libraries :-(
-fPIC is necessary in most of *nixes.

> The same thing I've already posted. The only way
> hbrun-dll.exe can be built now is to use
> 'set C_USR=-DHB_DYNLIB'

Why? What is the error?

>> For me it's not a problem but please remember that you should
>> not remove such functionality from make files because it may
>> be necessary in some situations. We should also remember about
> Which can these be?

most of *nixes. And to be precise in all platforms where C compiler
can make some additional optimizations for given CPU which cause that
the final code stop to be relocatable. Without separate compilation
for Harbour shared library these optimizations cannot be enabled.
(in GCC on some platforms they are enabled by default and have to
be diabled -fPIC or -fpic)
See GCC documentation for more information. Please look also at
-mno-shared. We do not use it yet.

>> builds for environments with restrictive memory amount, f.e.
>> for WinCE where probably also -gc3 should be replaced with -gc0
>> and in MinGWCE -O3 GCC switch replaced by -O2.
> Committed, but not tested. (no WinCE capable compiler
> around here. Except POCC which doesn't really work yet)
> Do you think it's alright to remove the second pass for BCC/MSVC?

AFAIK it should not have any other side effects then bigger binaries
and public access for exported Harbour functions.
But it's also possible that it will have some impact on optimizations
in these compiler. I do not know if they can create non position-independent
code to increase the speed.
But please make it by simple DLL_OBJ_DIR=$(OBJ_DIR) executed optionally
so people who want to tuned final Harbour binaries for optimal code
size can easy use current form.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 12:44:21 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 12:44:27 2008
Subject: [Harbour] Classes: Methods and Instance Variables with SAME Name
In-Reply-To: <20408479.post@talk.nabble.com>
References: <20354744.post@talk.nabble.com> <20408479.post@talk.nabble.com>
Message-ID: <8BF19C05-F2D6-4690-8A2B-D6854915930D@syenar.hu>

Hi Pritpal,

> METHOD lbClick( xParam ) CLASS WvgCrt
>
>   if hb_isNil( xParam ) .or. hb_isBlock( xParam )
>      ::sl_lbClick := xParam
>      RETURN NIL

Should be: RETURN ::sl_lbClick

>   endif
>
>   if hb_isArray( xParam ) .and. hb_isBlock( ::sl_lbClick )
>      eval( ::sl_lbClick, xParam, NIL, Self )
>   endif
>
>   RETURN Self

Should also be: RETURN ::sl_lbClick

> As this way suggests that there will ever be parameter checking
> when either executing or assigning, will not it affects the overall
> performance given the fact that such code will be executed
> hundreds of time within short span of program execution.
> This is only one method, there are more than a dozens like that.
>
> All the help is appreciated.

Pls explore source/tget.prg, there you can find examples
for both this method and ACCESS/ASSIGN method. Latter can
help on performance.

Brgds,
Viktor

From abe.buch at att.net  Sun Nov  9 12:54:04 2008
From: abe.buch at att.net (Abeb)
Date: Sun Nov  9 12:54:07 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20408327.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com> <20408327.post@talk.nabble.com>
Message-ID: <20408895.post@talk.nabble.com>


tried. same results.


Pritpal Bedi wrote:
> 
> Abeb
> 
> 
> Abeb wrote:
>> 
>> was this issue attened?  I still can not run wcecon.exe on PocketPc. It
>> won't open any window.
>> Thanks,
>> 
> 
> Place:
> 
> SetColor( 'N/W' )
> CLS 
> 
> command at the begining of the Main(). 
> Just check it and report back on the list if it helps.
> 
> Regards
> Pritpal Bedi
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20408895.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 12:55:44 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 12:55:47 2008
Subject: [Harbour] GTWIN and new console window
In-Reply-To: <20408287.post@talk.nabble.com>
References: <20408122.post@talk.nabble.com>
	<20081109164547.GA31108@34-mo7-2.acn.waw.pl>
	<20408275.post@talk.nabble.com> <20408287.post@talk.nabble.com>
Message-ID: <20408912.post@talk.nabble.com>


Hello All

This is the LINKER switch instead of COMILATION switch which
forces if the given appln is console or windows.

Link32.Exe -Gn -ap -Tpe -s @respfile
                     ^^
-ap switch is used for CONSOLE and -aa for WINDOWS target.

May it be of any help to others.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/GTWIN-and-new-console-window-tp20408122p20408912.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Sun Nov  9 13:09:45 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 13:08:52 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <490B6398-65B1-41D9-9C5F-9D9A9667EF3D@syenar.hu>
References: <20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
	<20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
	<20081109162631.GA4009@34-mo7-2.acn.waw.pl>
	<AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>
	<20081109172128.GA8360@34-mo7-2.acn.waw.pl>
	<490B6398-65B1-41D9-9C5F-9D9A9667EF3D@syenar.hu>
Message-ID: <20081109180945.GA26350@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>>> The same thing I've already posted. The only way
>>> hbrun-dll.exe can be built now is to use
>>> 'set C_USR=-DHB_DYNLIB'
>> Why? What is the error?
> I've posted it to the dev list, they were coming
> after those BCC warnings you've already fixed.
> Missing symbols when trying to link hbrun-dll.exe.

This should be fixed by adding PP and COMMON libs.
using global export flag will not help here in any way.

> Vista introduced a new feature which needs all executable
> to be relocatable to be able to load the .exe to any address
> to make unwanted code execution more complicated. This is
> called ASLR. It looks this is the direction Windows is heading.
> BTW, for reason above I've just enabled '/dynamicload /fixed:no'
> MSVC linker option in my local app, which makes a bigger final
> .exe with ASLR potential on Vista. BCC always adds relocation
> info.

Please remember that it may also reduce the speed. It's not only
additional information but also possibly different code.

> Do you think in Linux development there won't be similar
> direction in the future? IOW, does 'no-shared' have a
> bright future in Linux, or will it rather die out?

Hard to say but in Linux it does not have the same meaning as in
Windows. Please remember that Linux uses different memory blocks
for code and data. Code segments are readonly and data segments
does not have execution flag so it's not possible to add "unwanted
code" in the way as in Windows. The above explanation looks for me
like a pseudo security hack for missing basic protection present
in most of *nixes and it does not increase security because it's
still possible to write relocatable "unwanted code".

>> But please make it by simple DLL_OBJ_DIR=$(OBJ_DIR) executed optionally
>> so people who want to tuned final Harbour binaries for optimal code
>> size can easy use current form.
> That's what I did so far. I'm trying to keep everything
> we have, except HB_BUILD_DLL option, which I'd like to
> remove, but the internal logic should stay for the most
> part. So it basically comes down to removing this option
> and making building .dlls a must, regardless of the
> internal implementation for GCC, and a quicker one for
> BCC/MSVC.

It's fine for me.

> Now I have to change the build process to use HARBOURFLAGSLIB
> and HARBOURFLAGSEXE instead of current HARBOURFLAGS and
> HARBOURFLAGSDLL, the difference between them is -n1 option
> vs -n. Executables should use -n, libs (.dll and .lib)
> should use -n1.

It's enough to add support for MAIN() as default startup function
when non of functions is declared with HB_FS_FIRST and make all
builds with -n1.
We can also define that when MAIN() exists it's an application
entry point instead of symbol defined with HB_FS_FIRST. It will
have higher priority. In such case we can remove -n1 flag.
Choose what you prefer and I'll implement it.

best regards,
Przemek
From abe.buch at att.net  Sun Nov  9 13:19:52 2008
From: abe.buch at att.net (Abeb)
Date: Sun Nov  9 13:19:55 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20081109164721.GA2969@34-mo7-2.acn.waw.pl>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
Message-ID: <20409140.post@talk.nabble.com>


ok, after some more testing i see that in w32 it dosn't work either. i must
be doing somthing wrong.

here's my environment.

test.prg

proc main()
? "Test"
wait
quit


in Msys i do
$ hbmk ./test.prg

Harbour 1.1.0dev (Rev. 9846)
Copyright (c) 1999-2008, http://www.harbour-project.org/
Compiling './test.prg'...
Lines 4, Functions/Procedures 2
Generating C source output to 'test.c'... Done.


this will lanch test.exe, a process will be started, and hang around, and i
will get back the DOS prompt.
but test.exe process is still running... I will have to kill it in order to
stop it.
 


Przemyslaw Czerpak-2 wrote:
> 
> On Sun, 09 Nov 2008, Abeb wrote:
> 
> Hi,
> 
>> was this issue attened?  I still can not run wcecon.exe on PocketPc. It
>> won't
>> open any window.
> 
> You have to use older GTWVT untill current one will not be fixed.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20409140.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Sun Nov  9 13:20:50 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 13:19:59 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4917168A.7020308@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4917168A.7020308@mail.udg.mx>
Message-ID: <20081109182050.GB26350@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Results included in message were redirected to saleos2.txt, salecgi.txt, 
> salestd.txt
> In screen or redirected are same
> Entire results are below
> It work correctly using hb_gt_cgi_ReadKey() as hb_gt_os2_ReadKey()
> I insist, it seem to fail trying to execute hb_gt_os2_ReadKey(), or maybe 
> is executed but screen is not refreshed with tracing labels on it
> I was catching and error DISAPPEAR applying in hb_gt_os2_ReadKey():
>    /*   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk ); */
> As you said, fail reading keyboard input except thread 1  :-)

we will have to find why it happens. Maybe Maurilio can help.

> ... and screen/output is not updated ?

??? I do not understand. Do you want to say that only 1-st thread can
display data on the screen?

> But in hb_gt_std_ReadKey() does not exist KbdCharIn() and fail
> May be due platform/compilers cases  ?
> #elif defined( __WATCOMC__ )
>    if( pGTSTD->fStdinConsole )
>       if( kbhit() )
>          ch = getch();

Probably kbhit() internally call KbdCharIn() and it's exactly
the same problem.

If possible then I would like to check if other GTOS2 functions works
correctly for 2-nd thread and the problem is only with KbdCharIn().
F.e. try mttest02.prg with such modified GTOS2 so we can see if screen
output works.

best regards,
Przemek
From abe.buch at att.net  Sun Nov  9 13:20:55 2008
From: abe.buch at att.net (Abeb)
Date: Sun Nov  9 13:20:58 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20408327.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com> <20408327.post@talk.nabble.com>
Message-ID: <20409155.post@talk.nabble.com>


please see message i posted to Przemyslaw Czerpak. 


Pritpal Bedi wrote:
> 
> Abeb
> 
> 
> Abeb wrote:
>> 
>> was this issue attened?  I still can not run wcecon.exe on PocketPc. It
>> won't open any window.
>> Thanks,
>> 
> 
> Place:
> 
> SetColor( 'N/W' )
> CLS 
> 
> command at the begining of the Main(). 
> Just check it and report back on the list if it helps.
> 
> Regards
> Pritpal Bedi
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20409155.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 13:23:47 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 13:23:52 2008
Subject: [Harbour] Classes: Methods and Instance Variables with SAME Name
In-Reply-To: <8BF19C05-F2D6-4690-8A2B-D6854915930D@syenar.hu>
References: <20354744.post@talk.nabble.com> <20408479.post@talk.nabble.com>
	<8BF19C05-F2D6-4690-8A2B-D6854915930D@syenar.hu>
Message-ID: <20409191.post@talk.nabble.com>


Hello Viktor


Szak?ts Viktor wrote:
> 
> Pls explore source/tget.prg, there you can find examples
> for both this method and ACCESS/ASSIGN method. Latter can
> help on performance.
> 

Here is the code snippet from tget.prg


   METHOD block( bBlock ) SETGET

   ACCESS changed METHOD getChanged()
   ASSIGN changed METHOD setChanged( lChanged )


METHOD block( bBlock ) CLASS Get

   IF PCount() == 0 .OR. bBlock == NIL
      RETURN ::bBlock
   ENDIF

   ::bBlock   := bBlock
   ::xVarGet  := ::original
   ::cType    := ValType( ::xVarGet )

   RETURN bBlock


METHOD getChanged() CLASS Get
   RETURN ::lChanged

METHOD setChanged( lChanged ) CLASS Get

   IF ISLOGICAL( lChanged )
      RETURN iif( ::hasFocus, ::lChanged := lChanged, lChanged )
   ENDIF

   RETURN .F.


What I can see from above is that ACCESS/ASSIGN methods 
can not be overloaded in another class is inherited from the current one.

SETGET methods can be overloaded. This is a basic requirement to 
simulate Xbase++ class modal.

Am I right ?

Any ideas how to combine both strategies to speed up the opration ?

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/Classes%3A-Methods-and-Instance-Variables-with-SAME-Name-tp20354744p20409191.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 13:27:28 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 13:27:32 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20409140.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com>
Message-ID: <20409230.post@talk.nabble.com>


Abeb


Abeb wrote:
> 
> proc main()
> ? "Test"
> wait
> quit
> 

proc main()
SetColor( 'N/W' )
CLS
? "Test"
wait
return

Test with above code.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20409230.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 13:31:18 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 13:31:21 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20409230.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
Message-ID: <20409269.post@talk.nabble.com>


Show up your link script. 
I suspect you are are linking gtnul instead of gtwin.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20409269.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sun Nov  9 13:39:00 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 13:39:06 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081109180945.GA26350@34-mo7-2.acn.waw.pl>
References: <20081109133420.GA6177@34-mo7-2.acn.waw.pl>
	<4FFA4062-A32A-48DB-AEE4-D9B4A355FA68@syenar.hu>
	<20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
	<20081109162631.GA4009@34-mo7-2.acn.waw.pl>
	<AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>
	<20081109172128.GA8360@34-mo7-2.acn.waw.pl>
	<490B6398-65B1-41D9-9C5F-9D9A9667EF3D@syenar.hu>
	<20081109180945.GA26350@34-mo7-2.acn.waw.pl>
Message-ID: <204987F0-7862-43CB-9944-DF9ECB695167@syenar.hu>

Hi Przemek,

>> This should be fixed by adding PP and COMMON libs.
> using global export flag will not help here in any way.

You're right, now it seems okay. Too many variations
in short time, so I hope it will stay this way. It also
works with MSVC now.

>> Please remember that it may also reduce the speed. It's not only
> additional information but also possibly different code.

It's a link time option, the code seems to stay the same.
Maybe it affects .exe loading time, but it's not noticeable
for a 23MB .exe.

>>> Now I have to change the build process to use HARBOURFLAGSLIB
>> and HARBOURFLAGSEXE instead of current HARBOURFLAGS and
>> HARBOURFLAGSDLL, the difference between them is -n1 option
>> vs -n. Executables should use -n, libs (.dll and .lib)
>> should use -n1.
>
> It's enough to add support for MAIN() as default startup function
> when non of functions is declared with HB_FS_FIRST and make all
> builds with -n1.
> We can also define that when MAIN() exists it's an application
> entry point instead of symbol defined with HB_FS_FIRST. It will
> have higher priority. In such case we can remove -n1 flag.
> Choose what you prefer and I'll implement it.

I like the second one better, as it clears the ambiguity
and even the requirement to use -n switch when someone
defines MAIN(). So there would be one thing less to worry
about. First choice however is more Clipper compatible,
so IMO we should do it.

Other opinions are welcome, of course.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 13:46:32 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 13:46:39 2008
Subject: [Harbour] Classes: Methods and Instance Variables with SAME Name
In-Reply-To: <20409191.post@talk.nabble.com>
References: <20354744.post@talk.nabble.com> <20408479.post@talk.nabble.com>
	<8BF19C05-F2D6-4690-8A2B-D6854915930D@syenar.hu>
	<20409191.post@talk.nabble.com>
Message-ID: <5BDCD370-8DDE-4310-8AC4-5AECEAD7816B@syenar.hu>

Hi Pritpal,

> What I can see from above is that ACCESS/ASSIGN methods
> can not be overloaded in another class is inherited from the current  
> one.
>
> SETGET methods can be overloaded. This is a basic requirement to
> simulate Xbase++ class modal.
>
> Am I right ?

Sorry, I don't know if they can be overloaded.

[ If indeed not, we've paid some price when I've
lately changed TGET to be more Clipper compatible
by supporting the weird syntax cases. ]

> Any ideas how to combine both strategies to speed up the opration ?

IMO one extra PCOUNT() call won't overall cause
too much difference in speed. Especially since OOP
isn't a speed demon anyway.

Brgds,
Viktor

From abe.buch at att.net  Sun Nov  9 13:53:16 2008
From: abe.buch at att.net (Abeb)
Date: Sun Nov  9 13:53:19 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20409269.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
Message-ID: <20409496.post@talk.nabble.com>


i have no link script.
i just entered 

hbmk ./test.prg 

and test.exe was created.

Ok.
your right.

i just tried 

hbmak -gtwin ./test.prg
and it worked. looks like gtnul is being talen as the default.


but trying for wince by executing
hbcemk -gtwin ./test.prg 

i get the following errors

C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x2f4):
undefined reference to `GetNumberOfConsoleMouseButtons'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x424):
undefined reference to `GetNumberOfConsoleInputEvents'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x8c4):
undefined reference to `ReadConsoleInputW'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x10b4):
undefined reference to `GetLargestConsoleWindowSize'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x10e4):
undefined reference to `GetLargestConsoleWindowSize'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1110):
undefined reference to `GetConsoleTitleW'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1168):
undefined reference to `SetConsoleTitleW'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x12bc):
undefined reference to `SetConsoleCtrlHandler'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x12c8):
undefined reference to `SetConsoleCtrlHandler'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x12dc):
undefined reference to `SetConsoleMode'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x12f0):
undefined reference to `SetConsoleMode'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1330):
undefined reference to `GetConsoleScreenBufferInfo'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1448):
undefined reference to `ReadConsoleOutputW'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x16c4):
undefined reference to `SetConsoleCursorInfo'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x172c):
undefined reference to `SetConsoleCursorPosition'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x17d0):
undefined reference to `WriteConsoleOutputW'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x18a0):
undefined reference to `GetLargestConsoleWindowSize'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1904):
undefined reference to `SetConsoleScreenBufferSize'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1928):
undefined reference to `SetConsoleWindowInfo'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x193c):
undefined reference to `SetConsoleScreenBufferSize'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1950):
undefined reference to `SetConsoleWindowInfo'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x19c0):
undefined reference to `SetConsoleScreenBufferSize'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x19fc):
undefined reference to `SetConsoleWindowInfo'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1a10):
undefined reference to `SetConsoleCtrlHandler'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1b18):
undefined reference to `SetConsoleCtrlHandler'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1b44):
undefined reference to `AllocConsole'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1be4):
undefined reference to `GetConsoleScreenBufferInfo'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c3c):
undefined reference to `SetConsoleWindowInfo'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c50):
undefined reference to `SetConsoleScreenBufferSize'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c64):
undefined reference to `GetConsoleMode'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c70):
undefined reference to `GetConsoleMode'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c84):
undefined reference to `SetConsoleMode'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c88):
undefined reference to `FreeConsole'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1d74):
undefined reference to `SetConsoleCtrlHandler'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1d80):
undefined reference to `SetConsoleCtrlHandler'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1d90):
undefined reference to `SetConsoleMode'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1da0):
undefined reference to `SetConsoleMode'
C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/libgtwin.a(gtwin.o):gtwin.c:(.text+0x1df0):
undefined reference to `SetConsoleCursorInfo'
collect2: ld returned 1 exit status




Pritpal Bedi wrote:
> 
> Show up your link script. 
> I suspect you are are linking gtnul instead of gtwin.
> 
> Regards
> Pritpal Bedi
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20409496.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 14:03:46 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 14:03:50 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20409496.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com> <20409496.post@talk.nabble.com>
Message-ID: <20409609.post@talk.nabble.com>


Abeb


Abeb wrote:
> 
> hbmk ./test.prg 
> 
> hbmak -gtwin ./test.prg
> and it worked. looks like gtnul is being talen as the default.
> 
> 
> but trying for wince by executing
> hbcemk -gtwin ./test.prg 
> 

hbcemk -gtwvt ./test.prg 

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20409609.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From abe.buch at att.net  Sun Nov  9 14:10:04 2008
From: abe.buch at att.net (Abeb)
Date: Sun Nov  9 14:10:08 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20409609.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com> <20409496.post@talk.nabble.com>
	<20409609.post@talk.nabble.com>
Message-ID: <20409650.post@talk.nabble.com>


this will give no link error, test.exe will be created as a wince executable.
but on the device nothing will show up.


Pritpal Bedi wrote:
> 
> Abeb
> 
> 
> Abeb wrote:
>> 
>> hbmk ./test.prg 
>> 
>> hbmak -gtwin ./test.prg
>> and it worked. looks like gtnul is being talen as the default.
>> 
>> 
>> but trying for wince by executing
>> hbcemk -gtwin ./test.prg 
>> 
> 
> hbcemk -gtwvt ./test.prg 
> 
> Regards
> Pritpal Bedi
> 
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20409650.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sun Nov  9 14:37:07 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 14:37:19 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20409496.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com> <20409496.post@talk.nabble.com>
Message-ID: <516A8458-FD40-4E48-A342-67720BADC99C@syenar.hu>

gtwvt should be the default for all WinCE builds.

Brgds,
Viktor

On 2008.11.09., at 19:53, Abeb wrote:

>
> i have no link script.
> i just entered
>
> hbmk ./test.prg
>
> and test.exe was created.
>
> Ok.
> your right.
>
> i just tried
>
> hbmak -gtwin ./test.prg
> and it worked. looks like gtnul is being talen as the default.
>
>
> but trying for wince by executing
> hbcemk -gtwin ./test.prg
>
> i get the following errors
>
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x2f4):
> undefined reference to `GetNumberOfConsoleMouseButtons'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x424):
> undefined reference to `GetNumberOfConsoleInputEvents'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x8c4):
> undefined reference to `ReadConsoleInputW'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x10b4):
> undefined reference to `GetLargestConsoleWindowSize'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x10e4):
> undefined reference to `GetLargestConsoleWindowSize'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1110):
> undefined reference to `GetConsoleTitleW'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1168):
> undefined reference to `SetConsoleTitleW'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x12bc):
> undefined reference to `SetConsoleCtrlHandler'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x12c8):
> undefined reference to `SetConsoleCtrlHandler'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x12dc):
> undefined reference to `SetConsoleMode'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x12f0):
> undefined reference to `SetConsoleMode'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1330):
> undefined reference to `GetConsoleScreenBufferInfo'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1448):
> undefined reference to `ReadConsoleOutputW'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x16c4):
> undefined reference to `SetConsoleCursorInfo'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x172c):
> undefined reference to `SetConsoleCursorPosition'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x17d0):
> undefined reference to `WriteConsoleOutputW'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x18a0):
> undefined reference to `GetLargestConsoleWindowSize'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1904):
> undefined reference to `SetConsoleScreenBufferSize'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1928):
> undefined reference to `SetConsoleWindowInfo'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x193c):
> undefined reference to `SetConsoleScreenBufferSize'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1950):
> undefined reference to `SetConsoleWindowInfo'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x19c0):
> undefined reference to `SetConsoleScreenBufferSize'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x19fc):
> undefined reference to `SetConsoleWindowInfo'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1a10):
> undefined reference to `SetConsoleCtrlHandler'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1b18):
> undefined reference to `SetConsoleCtrlHandler'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1b44):
> undefined reference to `AllocConsole'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1be4):
> undefined reference to `GetConsoleScreenBufferInfo'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c3c):
> undefined reference to `SetConsoleWindowInfo'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c50):
> undefined reference to `SetConsoleScreenBufferSize'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c64):
> undefined reference to `GetConsoleMode'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c70):
> undefined reference to `GetConsoleMode'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c84):
> undefined reference to `SetConsoleMode'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1c88):
> undefined reference to `FreeConsole'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1d74):
> undefined reference to `SetConsoleCtrlHandler'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1d80):
> undefined reference to `SetConsoleCtrlHandler'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1d90):
> undefined reference to `SetConsoleMode'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1da0):
> undefined reference to `SetConsoleMode'
> C:/msys/1.0/local/arm-wince-mingwce-harbour/lib/ 
> libgtwin.a(gtwin.o):gtwin.c:(.text+0x1df0):
> undefined reference to `SetConsoleCursorInfo'
> collect2: ld returned 1 exit status
>
>
>
>
> Pritpal Bedi wrote:
>>
>> Show up your link script.
>> I suspect you are are linking gtnul instead of gtwin.
>>
>> Regards
>> Pritpal Bedi
>>
>>
>
> -- 
> View this message in context: http://www.nabble.com/wince-tp20236568p20409496.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sun Nov  9 14:37:32 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 14:37:28 2008
Subject: [Harbour] 2008-11-09 20:27 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c942a2$Blat.v2.6.2$9be4e7d8$7d01612a948@127.0.0.1>

2008-11-09 20:27 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  - contrib/examples/dbu/bld_b32.bat
  - contrib/examples/dbu/bld_vc.bat
  + contrib/examples/dbu/hbmk_b32.bat
  + contrib/examples/dbu/hbmk_vc.bat
  - contrib/examples/guestbk/bld_b32.bat
  - contrib/examples/guestbk/bld_vc.bat
  + contrib/examples/guestbk/hbmk_b32.bat
  + contrib/examples/guestbk/hbmk_vc.bat
  - contrib/examples/hbsqlit2/tests/bld_b32.bat
  - contrib/examples/hbsqlit2/tests/bld_vc.bat
  + contrib/examples/hbsqlit2/tests/hbmk_b32.bat
  + contrib/examples/hbsqlit2/tests/hbmk_vc.bat
  - contrib/examples/hscript/bld_b32.bat
  - contrib/examples/hscript/bld_vc.bat
  + contrib/examples/hscript/hbmk_b32.bat
  + contrib/examples/hscript/hbmk_vc.bat
  - contrib/examples/pe/bld_b32.bat
  - contrib/examples/pe/bld_vc.bat
  + contrib/examples/pe/hbmk_b32.bat
  + contrib/examples/pe/hbmk_vc.bat
  - contrib/examples/pp/bld_b32.bat
  - contrib/examples/pp/bld_vc.bat
  + contrib/examples/pp/hbmk_b32.bat
  + contrib/examples/pp/hbmk_vc.bat
  - contrib/gtwvg/tests/bld_b32.bat
  - contrib/gtwvg/tests/bld_vc.bat
  + contrib/gtwvg/tests/hbmk_b32.bat
  + contrib/gtwvg/tests/hbmk_vc.bat
  - contrib/hbapollo/tests/bld_b32.bat
  - contrib/hbapollo/tests/bld_vc.bat
  + contrib/hbapollo/tests/hbmk_b32.bat
  + contrib/hbapollo/tests/hbmk_vc.bat
  - contrib/hbbtree/tests/bld_b32.bat
  - contrib/hbbtree/tests/bld_djgp.bat
  - contrib/hbbtree/tests/bld_vc.bat
  + contrib/hbbtree/tests/hbmk_b32.bat
  + contrib/hbbtree/tests/hbmk_djg.bat
  + contrib/hbbtree/tests/hbmk_vc.bat
  - contrib/hbclipsm/tests/bld_b32.bat
  - contrib/hbclipsm/tests/bld_vc.bat
  + contrib/hbclipsm/tests/hbmk_b32.bat
  + contrib/hbclipsm/tests/hbmk_vc.bat
  - contrib/hbct/tests/bld_b32.bat
  - contrib/hbct/tests/bld_vc.bat
  + contrib/hbct/tests/hbmk_b32.bat
  + contrib/hbct/tests/hbmk_vc.bat
  - contrib/hbcurl/tests/bld_b32.bat
  - contrib/hbcurl/tests/bld_vc.bat
  + contrib/hbcurl/tests/hbmk_b32.bat
  + contrib/hbcurl/tests/hbmk_vc.bat
  - contrib/hbfbird/tests/bld_b32.bat
  - contrib/hbfbird/tests/bld_vc.bat
  + contrib/hbfbird/tests/hbmk_b32.bat
  + contrib/hbfbird/tests/hbmk_vc.bat
  - contrib/hbfimage/tests/bld_b32.bat
  - contrib/hbfimage/tests/bld_vc.bat
  + contrib/hbfimage/tests/hbmk_b32.bat
  + contrib/hbfimage/tests/hbmk_vc.bat
  - contrib/hbgd/tests/bld_b32.bat
  - contrib/hbgd/tests/bld_vc.bat
  + contrib/hbgd/tests/hbmk_b32.bat
  + contrib/hbgd/tests/hbmk_vc.bat
  - contrib/hbgf/tests/bld_b32.bat
  - contrib/hbgf/tests/bld_vc.bat
  + contrib/hbgf/tests/hbmk_b32.bat
  + contrib/hbgf/tests/hbmk_vc.bat
  - contrib/hbhpdf/tests/bld_b32.bat
  - contrib/hbhpdf/tests/bld_vc.bat
  + contrib/hbhpdf/tests/hbmk_b32.bat
  + contrib/hbhpdf/tests/hbmk_vc.bat
  - contrib/hbmisc/tests/bld_b32.bat
  - contrib/hbmisc/tests/bld_vc.bat
  + contrib/hbmisc/tests/hbmk_b32.bat
  + contrib/hbmisc/tests/hbmk_vc.bat
  - contrib/hbmysql/tests/bld_b32.bat
  - contrib/hbmysql/tests/bld_vc.bat
  + contrib/hbmysql/tests/hbmk_b32.bat
  + contrib/hbmysql/tests/hbmk_vc.bat
  - contrib/hbmzip/tests/bld_b32.bat
  - contrib/hbmzip/tests/bld_vc.bat
  + contrib/hbmzip/tests/hbmk_b32.bat
  + contrib/hbmzip/tests/hbmk_vc.bat
  - contrib/hbnf/tests/bld_b32.bat
  - contrib/hbnf/tests/bld_vc.bat
  + contrib/hbnf/tests/hbmk_b32.bat
  + contrib/hbnf/tests/hbmk_vc.bat
  - contrib/hbodbc/tests/bld_b32.bat
  - contrib/hbodbc/tests/bld_vc.bat
  + contrib/hbodbc/tests/hbmk_b32.bat
  + contrib/hbodbc/tests/hbmk_vc.bat
  - contrib/hbole/tests/bld_b32.bat
  - contrib/hbole/tests/bld_vc.bat
  + contrib/hbole/tests/hbmk_b32.bat
  + contrib/hbole/tests/hbmk_vc.bat
  - contrib/hbpgsql/tests/bld_b32.bat
  - contrib/hbpgsql/tests/bld_vc.bat
  + contrib/hbpgsql/tests/hbmk_b32.bat
  + contrib/hbpgsql/tests/hbmk_vc.bat
  - contrib/hbsqlit3/tests/bld_b32.bat
  - contrib/hbsqlit3/tests/bld_vc.bat
  + contrib/hbsqlit3/tests/hbmk_b32.bat
  + contrib/hbsqlit3/tests/hbmk_vc.bat
  - contrib/hbtip/tests/bld_b32.bat
  - contrib/hbtip/tests/bld_vc.bat
  + contrib/hbtip/tests/hbmk_b32.bat
  + contrib/hbtip/tests/hbmk_vc.bat
  - contrib/hbtpathy/tests/bld_b32.bat
  - contrib/hbtpathy/tests/bld_vc.bat
  + contrib/hbtpathy/tests/hbmk_b32.bat
  + contrib/hbtpathy/tests/hbmk_vc.bat
  - contrib/hbvpdf/tests/bld_b32.bat
  - contrib/hbvpdf/tests/bld_vc.bat
  + contrib/hbvpdf/tests/hbmk_b32.bat
  + contrib/hbvpdf/tests/hbmk_vc.bat
  - contrib/hbwhat/tests/bld_b32.bat
  - contrib/hbwhat/tests/bld_vc.bat
  + contrib/hbwhat/tests/hbmk_b32.bat
  + contrib/hbwhat/tests/hbmk_vc.bat
  - contrib/hbwin/tests/bld_b32.bat
  - contrib/hbwin/tests/bld_vc.bat
  + contrib/hbwin/tests/hbmk_b32.bat
  + contrib/hbwin/tests/hbmk_vc.bat
  - contrib/hbziparc/tests/bld_b32.bat
  - contrib/hbziparc/tests/bld_vc.bat
  + contrib/hbziparc/tests/hbmk_b32.bat
  + contrib/hbziparc/tests/hbmk_vc.bat
  - contrib/rddado/tests/bld_b32.bat
  - contrib/rddado/tests/bld_vc.bat
  + contrib/rddado/tests/hbmk_b32.bat
  + contrib/rddado/tests/hbmk_vc.bat
  - contrib/rddads/tests/bld_b32.bat
  - contrib/rddads/tests/bld_vc.bat
  + contrib/rddads/tests/hbmk_b32.bat
  + contrib/rddads/tests/hbmk_vc.bat
  - contrib/rddsql/tests/bld_b32.bat
  - contrib/rddsql/tests/bld_vc.bat
  + contrib/rddsql/tests/hbmk_b32.bat
  + contrib/rddsql/tests/hbmk_vc.bat
  - contrib/xhb/tests/bld_b32.bat
  - contrib/xhb/tests/bld_vc.bat
  + contrib/xhb/tests/hbmk_b32.bat
  + contrib/xhb/tests/hbmk_vc.bat
  - tests/bld_b32.bat
  - tests/bld_b32_dll.bat
  - tests/bld_gnu.bat
  - tests/bld_vc.bat
  + tests/hbmk_b32.bat
  + tests/hbmk_b32_dll.bat
  + tests/hbmk_gnu.bat
  + tests/hbmk_vc.bat
  - utils/hbdoc/bld_b32.bat
  - utils/hbdoc/bld_vc.bat
  + utils/hbdoc/hbmk_b32.bat
  + utils/hbdoc/hbmk_vc.bat
  - utils/hbmake/bld_b32.bat
  - utils/hbmake/bld_vc.bat
  + utils/hbmake/hbmk_b32.bat
  + utils/hbmake/hbmk_vc.bat
    * bld*.bat -> hbmk*.bat

  * contrib/mtpl_b32.mak
    * /P32 -> /P64

  + contrib/hbmsql/tests/hbmk_b32.bat
  + contrib/hbmsql/tests/hbmk_vc.bat
    + Added make files.

  - contrib/hbclip
    - Removed this contrib. It was incomplete and not 
      updated since 2001.
--
Brgds,
Viktor

From abe.buch at att.net  Sun Nov  9 14:49:53 2008
From: abe.buch at att.net (Abeb)
Date: Sun Nov  9 14:49:55 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20081109164721.GA2969@34-mo7-2.acn.waw.pl>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
Message-ID: <20410037.post@talk.nabble.com>


where can i get an older GTWVT?


Przemyslaw Czerpak-2 wrote:
> 
> On Sun, 09 Nov 2008, Abeb wrote:
> 
> Hi,
> 
>> was this issue attened?  I still can not run wcecon.exe on PocketPc. It
>> won't
>> open any window.
> 
> You have to use older GTWVT untill current one will not be fixed.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20410037.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sun Nov  9 14:50:41 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 14:50:38 2008
Subject: [Harbour] 2008-11-09 20:49 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c942a4$Blat.v2.6.2$722a5dfe$e307b45c492@127.0.0.1>

2008-11-09 20:49 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  - contrib/hbmysql/utils/bld_b32.bat
  - contrib/hbmysql/utils/bld_vc.bat
  + contrib/hbmysql/utils/hbmk_b32.bat
  + contrib/hbmysql/utils/hbmk_vc.bat
  - contrib/hbgd/tests/bld.sh
  + contrib/hbgd/tests/hbmk_gnu.sh
  * contrib/hbbtree/tests/hbmk_b32.bat
  * contrib/hbbtree/tests/hbmk_vc.bat
  * contrib/examples/pp/hbmk_b32.bat
  * contrib/examples/pp/hbmk_vc.bat
  * contrib/examples/guestbk/hbmk_b32.bat
  * contrib/examples/guestbk/hbmk_vc.bat
  * contrib/examples/pe/hbmk_b32.bat
  * contrib/examples/pe/hbmk_vc.bat
  * contrib/examples/hscript/hbmk_vc.bat
    * Some remaining renames.
    * Got rid of temp files in BCC batch files. Win9x is no longer 
      supported.
    * Some other minor cleanups.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 14:59:51 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 14:59:47 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>

2008-11-09 20:58 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * include/hbdefs.h
  * include/hbapigt.h
  * source/common/hbfsapi.c
  * source/rtl/console.c
  * source/rtl/fserror.c
  * source/rtl/fstemp.c
  * source/rtl/gtstd/gtstd.c
  * source/rtl/gtpca/gtpca.c
  * source/rtl/filesys.c
    * Macro rename:
      - HB_WIN32_IO_OFF -> HB_IO_WIN_OFF
      - HB_WIN32_IO     -> HB_IO_WIN
    ; NOTE: INCOMPATIBLE if someone happens to disable 
            Windows native IO. Users don't normally 
            needs this though.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Sun Nov  9 15:19:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 15:18:54 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20409269.post@talk.nabble.com>
References: <20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
Message-ID: <20081109201947.GA24098@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> Show up your link script. 
> I suspect you are are linking gtnul instead of gtwin.

Current GTWVT does not work in WinCE. I checked it.
It's probably caused by the code which force font resizing on startup.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  9 15:29:13 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 15:28:19 2008
Subject: [Harbour] Classes: Methods and Instance Variables with SAME Name
In-Reply-To: <5BDCD370-8DDE-4310-8AC4-5AECEAD7816B@syenar.hu>
References: <20354744.post@talk.nabble.com> <20408479.post@talk.nabble.com>
	<8BF19C05-F2D6-4690-8A2B-D6854915930D@syenar.hu>
	<20409191.post@talk.nabble.com>
	<5BDCD370-8DDE-4310-8AC4-5AECEAD7816B@syenar.hu>
Message-ID: <20081109202913.GB24098@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:
> Hi Pritpal,
>> What I can see from above is that ACCESS/ASSIGN methods
>> can not be overloaded in another class is inherited from the current one.
>> SETGET methods can be overloaded. This is a basic requirement to
>> simulate Xbase++ class modal.
>> Am I right ?
> Sorry, I don't know if they can be overloaded.

There is no difference between SETGET method and two ACCESS ASSIGN
methods redirected to the same function:
   METHOD mth SETGET
and:
   ACCESS mth METHOD mth
   ASSIGN mth METHOD mth

gives exactly the same class definition. Just like this code
which also gives the same class definition.
   MESSAGE msg METHOD mth
   MESSAGE _msg METHOD mth

ACCESS <msg> METHOD <mth> is the same as MESSAGE <msg> METHOD <mth>
and ASSIGN <msg> METHOD <mth> is the same as MESSAGE _<msg> METHOD <mth>

Each form allows overloading. There is no any limitation here.
Harbour also allows to pass SETGET (ACCESS/ASSIGN) methods by
reference just like real object variables:
   f( @o:msg )
but it does not work in xHarbour.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  9 15:40:44 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 15:39:50 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <204987F0-7862-43CB-9944-DF9ECB695167@syenar.hu>
References: <20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
	<20081109162631.GA4009@34-mo7-2.acn.waw.pl>
	<AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>
	<20081109172128.GA8360@34-mo7-2.acn.waw.pl>
	<490B6398-65B1-41D9-9C5F-9D9A9667EF3D@syenar.hu>
	<20081109180945.GA26350@34-mo7-2.acn.waw.pl>
	<204987F0-7862-43CB-9944-DF9ECB695167@syenar.hu>
Message-ID: <20081109204044.GB12100@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor.

> It's a link time option, the code seems to stay the same.

But it means that during compilation optimizations which will
create non position independent code cannot be done. I do not
know if BCC or VC have such feature.

best regards,
Przemek
From e.m.giordano at emagsoftware.it  Sun Nov  9 15:44:55 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Sun Nov  9 15:45:01 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
Message-ID: <7B765DE257F44F14918A60415D7D1C51@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: <harbour@harbour-project.org>
Data invio: domenica 9 novembre 2008 20.59
Oggetto: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats 
(harbour.01syenar hu)


> 2008-11-09 20:58 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
>  * include/hbdefs.h
>  * include/hbapigt.h
>  * source/common/hbfsapi.c
>  * source/rtl/console.c
>  * source/rtl/fserror.c
>  * source/rtl/fstemp.c
>  * source/rtl/gtstd/gtstd.c
>  * source/rtl/gtpca/gtpca.c
>  * source/rtl/filesys.c
>    * Macro rename:
>      - HB_WIN32_IO_OFF -> HB_IO_WIN_OFF
>      - HB_WIN32_IO     -> HB_IO_WIN
>    ; NOTE: INCOMPATIBLE if someone happens to disable
>            Windows native IO. Users don't normally
>            needs this though.

Let's see if I understood correctly. I want Windows native I/O. Used 
HB_WIN32_IO so far. Do I have to replace it with HB_IO_WIN?

By the way, what are the pros and cons of Window native I/O versus Harbour 
I/O?

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Sun Nov  9 15:49:30 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 15:49:37 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081109204044.GB12100@34-mo7-2.acn.waw.pl>
References: <20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
	<20081109162631.GA4009@34-mo7-2.acn.waw.pl>
	<AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>
	<20081109172128.GA8360@34-mo7-2.acn.waw.pl>
	<490B6398-65B1-41D9-9C5F-9D9A9667EF3D@syenar.hu>
	<20081109180945.GA26350@34-mo7-2.acn.waw.pl>
	<204987F0-7862-43CB-9944-DF9ECB695167@syenar.hu>
	<20081109204044.GB12100@34-mo7-2.acn.waw.pl>
Message-ID: <9D0BE7BE-06C0-4491-B2E8-664E60760223@syenar.hu>

Hi Przemek,

>>
>> It's a link time option, the code seems to stay the same.
>
> But it means that during compilation optimizations which will
> create non position independent code cannot be done. I do not
> know if BCC or VC have such feature.

I haven't found any. All MSDN docs (which is not much BTW),
indicated that /fixed linker option only tells whether to
add relocation info to the final binary, or not. There is
no mention that availability of /fixed would depend on any
compile time options, and there don't seem exist any compile
time options to do such optimization anyway. BTW, /fixed
is default for .exe and /fixed:no is default for .dlls.

Brgds,
Viktor
From bedipritpal at hotmail.com  Sun Nov  9 15:54:54 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 15:54:57 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20081109201947.GA24098@34-mo7-2.acn.waw.pl>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
Message-ID: <20410707.post@talk.nabble.com>


Przemek


Przemyslaw Czerpak-2 wrote:
> 
> Current GTWVT does not work in WinCE. I checked it.
> It's probably caused by the code which force font resizing on startup.
> 

Probably due to the way CreateWindow is executed on REFRESH method.
I suspect it more than font resizing issue which was carried out before
also.
Please think on these lines.

Also I find it difficult to manage if window is not created at startup.
For me HB_NOSTARTUPWINDOW methodology was perfect instead of
current one. At least window was available right after
hb_gtCreate()/hb_gtReload()
and it was possible to change behaviors before it was shown.
Now I have to explictly issue CLS to force it to be present.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20410707.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From info at fsgiudice.com  Sun Nov  9 16:00:57 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sun Nov  9 16:01:08 2008
Subject: [Harbour] ChangeLog in Unicode mode
In-Reply-To: <981CC232-1319-40EF-9A6C-5FB112F5D8B6@syenar.hu>
References: <20401804.post@talk.nabble.com>	<07FA409B-C247-40D5-99D6-A213A1C0D769@syenar.hu>	<4916D331.6020005@fsgiudice.com>
	<981CC232-1319-40EF-9A6C-5FB112F5D8B6@syenar.hu>
Message-ID: <49174F89.2010902@fsgiudice.com>

Hi Viktor,

Il 09/11/2008 14.20, Szak?ts Viktor ha scritto:
> Hi Francesco,
> 
> 
> No problem, and now that there is no high
> chars anymore in the file, it won't be a big
> deal to fix such problem (it used to happen
> from time to time).
> 
thank you

Best regards

Francesco
From bedipritpal at hotmail.com  Sun Nov  9 16:03:22 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 16:03:25 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20410707.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com>
Message-ID: <20410809.post@talk.nabble.com>


Hello Przemek


Pritpal Bedi wrote:
> 
> Also I find it difficult to manage if window is not created at startup.
> For me HB_NOSTARTUPWINDOW methodology was perfect instead of
> current one. At least window was available right after
> hb_gtCreate()/hb_gtReload()
> and it was possible to change behaviors before it was shown.
> Now I have to explictly issue CLS to force it to be present.
> 

OR
CreateWindow is executed at startup and ShowWindow at REFRESH method.
It will solve both issues.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20410809.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sun Nov  9 16:06:51 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 16:06:58 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <7B765DE257F44F14918A60415D7D1C51@emag>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
Message-ID: <70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>

Hi Enrico,

>> * include/hbdefs.h
>> * include/hbapigt.h
>> * source/common/hbfsapi.c
>> * source/rtl/console.c
>> * source/rtl/fserror.c
>> * source/rtl/fstemp.c
>> * source/rtl/gtstd/gtstd.c
>> * source/rtl/gtpca/gtpca.c
>> * source/rtl/filesys.c
>>   * Macro rename:
>>     - HB_WIN32_IO_OFF -> HB_IO_WIN_OFF
>>     - HB_WIN32_IO     -> HB_IO_WIN
>>   ; NOTE: INCOMPATIBLE if someone happens to disable
>>           Windows native IO. Users don't normally
>>           needs this though.
>
> Let's see if I understood correctly. I want Windows native I/O. Used  
> HB_WIN32_IO so far. Do I have to replace it with HB_IO_WIN?

This flag is the default setting for Harbour since a very
long time. Simply remove it, it's not needed.

For some reason many users still insist on having this flag :)
After recent cleanups (meaning the last half year) custom
flags are seldom needed to "tune" Harbour for best performance.
Defaults are pretty good.

To further tune Harbour performance vs. core features, below
flags can be used:
-DHB_FM_STATISTICS_OFF (for final all apps)
-DHB_NO_DEBUG (if you never intend to use the debugger)
-DHB_GUI (to build GUI apps exclusively)

You may also add CPU tuning, if you know your end-user
environments.

I hope we can convert HB_FM_STATISTICS_OFF option to a runtime
one in the future. Also, HB_NO_DEBUG shouldn't be needed,
but that needs more work on the core.

The goal is to not need any such build time tuning to get
an optimal Harbour.

> By the way, what are the pros and cons of Window native I/O versus  
> Harbour I/O?

I can't think of any normal situation where native
could have any downsides. In the early days of native
I/O implementation, some Clipper compatibility differences
existed for std I/O handles AFAIR. Native removes the CRTL
layer from all I/O operations, which means more consistent
behavior across different C compilers, better speed,
better access to OS I/O features and no CRTL posed limits
(like maximum number of files).

The only downside (which doesn't affect Harbour users) is that
Harbour source code becomes completely non-portable for these
code sections.

Brgds,
Viktor

From mbelgrano at deltain.it  Sun Nov  9 16:23:24 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Sun Nov  9 16:24:57 2008
Subject: [Harbour] gui framework portable clone of XbaseParts 
In-Reply-To: <20324906.post@talk.nabble.com>
References: <20315173.post@talk.nabble.com><AFB948164110ED43B5EB849E8DEEF03815F13B@SRV02.deltain.net>
	<20324906.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F15F@SRV02.deltain.net>

Hi Pritpal 
I am very interested by your project of adding to gtwvg 
A gui framework portable clone of XbaseParts that will named "harbour
Part" with Active X Capability
Can you give me other information and explain your idea?
Have you already written part of this?

-----Original Message-----
>>Do you think write a gui framework that will be a little clone of
>>XbaseParts but portable?
>This is what my intention is.
>Pritpal Bedi

Best regards
Massimo Belgrano
From harbour.01 at syenar.hu  Sun Nov  9 16:39:26 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 16:39:33 2008
Subject: [Harbour] 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081109134348.GA10883@34-mo7-2.acn.waw.pl>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
	<20081107102131.GB2247@34-mo7-2.acn.waw.pl>
	<222A6854-3BCD-4C10-A694-33E364C5E63D@syenar.hu>
	<20081109134348.GA10883@34-mo7-2.acn.waw.pl>
Message-ID: <BB4B742D-17C0-4AC6-BAD1-21AEC855B7F7@syenar.hu>

>>>  if( !HB_PP_TOKEN_ISEOC( pToken ) || fUndef )
>>> to:
>>>  if( !HB_PP_TOKEN_ISEOC( pToken ) )
>
> If we decide to change it then probably it will be better to
> make sth like:
>
>   if( fUndef )
>      lValue = 0;
>   else if( !HB_PP_TOKEN_ISEOC( pToken ) )
>      fError = TRUE;
>
> In such for code like:
>
>   #if UNEXISTING_DEFINE == 0
>      #stdout "UNEXISTING_DEFINE is 0"
>   #endif
>
> #stdout will not be compiled

Much better indeed.

So the question is:
- #if defined( HELLO ) .AND. HELLO > 100
vs.
- #if HELLO > 100

I tend to vote for the latter. Easier to write,
especially that ".AND." in a #define (which many
ppl will write as '&&' by mistake) can be avoided
this way.

Opinions from others?

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 17:16:25 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 17:16:33 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20410707.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com>
Message-ID: <09F8FE5F-940C-4A93-A7ED-0D90284059C6@syenar.hu>

> Probably due to the way CreateWindow is executed on REFRESH method.
> I suspect it more than font resizing issue which was carried out  
> before
> also.
> Please think on these lines.
>
> Also I find it difficult to manage if window is not created at  
> startup.
> For me HB_NOSTARTUPWINDOW methodology was perfect instead of
> current one. At least window was available right after
> hb_gtCreate()/hb_gtReload()
> and it was possible to change behaviors before it was shown.
> Now I have to explictly issue CLS to force it to be present.

Well, if there is no screen output there is not much
point in having a window, so this don't seem to be
big restriction. Most probably only a problem for the
few ones doing development and testing on GTWVT itself
(meaning 5 ppl in the world - worst case).

HB_NOSTARTUPWINDOW doesn't solve the flashing problem
while app code tries to setup GT parameters. Besides
being a very hack, solving a very narrow need in the
wrong (but easy) way.

So I'd suggest not to solve the WinCE problem by
reintroducing this horrible hack _and_ reintroducing
the flashing/slow startup window effect.

I'm sure there is a proper solution.

Brgds,
Viktor

From jfl at mafact.com  Sun Nov  9 17:18:00 2008
From: jfl at mafact.com (J. Lefebvre)
Date: Sun Nov  9 17:18:45 2008
Subject: [Harbour] Problem with TOleAuto class
In-Reply-To: <20081109141647.GA9100@34-mo7-2.acn.waw.pl>
Message-ID: <1a7b887a.1c942b9.5e8c057.29@mafact.com>

Hi,

I have a strange problem with the TOleAuto Class from contrib/hbwin

I can create an ole automation object without any problem,

I can Get a propertie, using the automatic Getproperty routing method (by onerror method), so this one is working fine

cFormula := oReport:RecordSelectionFormula

But doing this one does not work :

oReport:RecordSelectionFormula := '{FFAC.CODJOU} = "VEN"'

(Error 25926100/3  DISP_E_MEMBERNOTFOUND: _RECORDSELECTIONFORMULA)

Whilst this one is working :

oReport:Set("RecordSelectionFormula" , '{FFAC.CODJOU} = "VEN"' )

I checked win_ole.c sources, comparing HB_FUNC( TOLEAUTO_ONERROR ) and HB_FUNC( TOLEAUTO_SET )and I did no see any reason for those error.

Any Idea ?

JF,






From druzus at acn.waw.pl  Sun Nov  9 18:05:28 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 18:04:35 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <7B765DE257F44F14918A60415D7D1C51@emag>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
Message-ID: <20081109230528.GA12076@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Enrico Maria Giordano wrote:

Hi Enrico,

> Let's see if I understood correctly. I want Windows native I/O. Used 
> HB_WIN32_IO so far. Do I have to replace it with HB_IO_WIN?

No you do not have to use it. You haven't to HB_WIN32_IO so far
and many times in the past we were writing that it's not necessary.
Native WIN32 IO is and was default and I do not understand why
it's such hard for you to understand it ;-)

> By the way, what are the pros and cons of Window native I/O versus Harbour 
> I/O?

There is no Harbour IO and never was.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  9 18:10:35 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 18:09:41 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20410707.post@talk.nabble.com>
References: <20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com>
Message-ID: <20081109231035.GB12076@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> Probably due to the way CreateWindow is executed on REFRESH method.
> I suspect it more than font resizing issue which was carried out before
> also.

No it's not more. It even eliminated one font resizing which existed
before. Just simply take older version from SVN and make tests.

WINCE builds stop to work before this feature was added.

> Please think on these lines.
> Also I find it difficult to manage if window is not created at startup.
> For me HB_NOSTARTUPWINDOW methodology was perfect instead of
> current one. At least window was available right after
> hb_gtCreate()/hb_gtReload()
> and it was possible to change behaviors before it was shown.
> Now I have to explictly issue CLS to force it to be present.

Where did you found such information that you have to call CLS?
You do not have to. At least in GTWVT. Any screen output activates
window. F.e.

   proc main()
      ? "."
      inkey(0)
   return

If it does not work in real MS-Windows (I tested it only with WINE)
then please inform me.

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  9 18:11:26 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 18:10:32 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20410809.post@talk.nabble.com>
References: <20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com> <20410809.post@talk.nabble.com>
Message-ID: <20081109231125.GC12076@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> OR
> CreateWindow is executed at startup and ShowWindow at REFRESH method.
> It will solve both issues.

Can you tell me what issues?

best regards,
Przemek
From druzus at acn.waw.pl  Sun Nov  9 18:21:16 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 18:20:22 2008
Subject: [Harbour] 2008-11-10 00:20 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081109232116.GA27832@34-mo7-2.acn.waw.pl>

2008-11-10 00:20 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/config/rules.cf
    ! fixed recursive HB_FLAGS declaration

  * harbour/include/hbdefs.h
  * harbour/include/hbsetup.h
  * harbour/include/hbtrace.h
    * declared hb_tr_trace() parameters as printf() compatible in GCC
      builds. It enabled format string with parameters validation

  * harbour/source/rtl/errorapi.c
    ! fixed GPF caused by HB_ERR_FUNCNAME which is not longer valid
      string

  * harbour/source/vm/itemapi.c
  * harbour/source/vm/hvm.c
  * harbour/source/vm/arrays.c
  * harbour/source/vm/memvars.c
  * harbour/source/vm/eval.c
  * harbour/source/vm/extend.c
  * harbour/source/vm/set.c
  * harbour/source/debug/dbgentry.c
  * harbour/source/rtl/gtwin/gtwin.c
  * harbour/source/rtl/gtxwc/gtxwc.c
  * harbour/source/rtl/hbgtcore.c
  * harbour/source/rtl/gtcrs/gtcrs.c
  * harbour/source/rtl/gtstd/gtstd.c
  * harbour/source/rtl/gtsln/gtsln.c
  * harbour/source/rtl/gttrm/gttrm.c
  * harbour/source/rtl/gtpca/gtpca.c
  * harbour/source/rtl/gtcgi/gtcgi.c
  * harbour/source/rtl/gtwvt/gtwvt.c
  * harbour/source/rtl/filesys.c
  * harbour/source/rdd/dbf1.c
  * harbour/source/rdd/dbffpt/dbffpt1.c
  * harbour/contrib/gtalleg/gtalleg.c
  * harbour/contrib/xhb/freadlin.c
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/rddads/adsfunc.c
  * harbour/contrib/rddads/ads1.c
  * harbour/contrib/hbwin/win_ole.c
  * harbour/utils/hbdoc/hbdfrdln.c
  * harbour/utils/hbmake/hbmfrdln.c
    ! fixed bugs in HB_TRACE massages reported in GCC builds

best regards
Przemek
From bedipritpal at hotmail.com  Sun Nov  9 18:21:20 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 18:21:23 2008
Subject: [Harbour] gui framework portable clone of XbaseParts
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F15F@SRV02.deltain.net>
References: <20315173.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F13B@SRV02.deltain.net>
	<20324906.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F15F@SRV02.deltain.net>
Message-ID: <20412142.post@talk.nabble.com>


Hi Massimo


Massimo Belgrano-3 wrote:
> 
> I am very interested by your project of adding to gtwvg 
> A gui framework portable clone of XbaseParts that will named "harbour
> Part" with Active X Capability
> Can you give me other information and explain your idea?
> Have you already written part of this?
> 

I am on way to structure class framework exactly on lines with
Xbase++. A rough skelton of 
XbpWindow(), XbpPartHandler(), XbpCrt() 
is already in place with a starting example implemented in demowvg.prg.

May be I post in today or tomorrow.
Stay tuned.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/Higher-Level-Classes-to-Manage-Consoles-tp20315173p20412142.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 18:24:40 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 18:24:43 2008
Subject: [Harbour] 2008-11-07 00:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <BB4B742D-17C0-4AC6-BAD1-21AEC855B7F7@syenar.hu>
References: <20081106233709.GA32101@34-mo7-2.acn.waw.pl>
	<3A16AF5A-9E25-46BF-AD2A-C2781A5E86CE@syenar.hu>
	<20081107102131.GB2247@34-mo7-2.acn.waw.pl>
	<222A6854-3BCD-4C10-A694-33E364C5E63D@syenar.hu>
	<20081109134348.GA10883@34-mo7-2.acn.waw.pl>
	<BB4B742D-17C0-4AC6-BAD1-21AEC855B7F7@syenar.hu>
Message-ID: <20412173.post@talk.nabble.com>


Hi


Szak?ts Viktor wrote:
> 
> So the question is:
> - #if defined( HELLO ) .AND. HELLO > 100
> vs.
> - #if HELLO > 100
> 
> I tend to vote for the latter. Easier to write,
> especially that ".AND." in a #define (which many
> ppl will write as '&&' by mistake) can be avoided
> this way.
> 
> Opinions from others?
> 

> #if HELLO > 100

+1

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/2008-11-07-00%3A36-UTC%2B0100-Przemyslaw-Czerpak-%28druzus-at-priv.onet.pl%29-tp20372027p20412173.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 18:40:11 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 18:40:14 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20081109231125.GC12076@34-mo7-2.acn.waw.pl>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com> <20410809.post@talk.nabble.com>
	<20081109231125.GC12076@34-mo7-2.acn.waw.pl>
Message-ID: <20412329.post@talk.nabble.com>


Hello Przemek


Przemyslaw Czerpak-2 wrote:
> 
>> OR
>> CreateWindow is executed at startup and ShowWindow at REFRESH method.
>> It will solve both issues.
> 
> Can you tell me what issues?
> 

1) There will never be a need for HB_STARTUPWINDOW.
2) All other parameters will take effect after hb_gtReload()/hb_gtSelect()
    is called and some screen output command like [ ? '.' ] is issued.

This will guarantee thar hWnd is always there right at the begining 
and only its display behavior is changed according to needs of the hour.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20412329.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov  9 18:45:40 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 18:45:44 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <09F8FE5F-940C-4A93-A7ED-0D90284059C6@syenar.hu>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com>
	<09F8FE5F-940C-4A93-A7ED-0D90284059C6@syenar.hu>
Message-ID: <20412393.post@talk.nabble.com>


Viktor


Szak?ts Viktor wrote:
> 
> HB_NOSTARTUPWINDOW doesn't solve the flashing problem
> while app code tries to setup GT parameters. Besides
> being a very hack, solving a very narrow need in the
> wrong (but easy) way.
> 
> So I'd suggest not to solve the WinCE problem by
> reintroducing this horrible hack _and_ reintroducing
> the flashing/slow startup window effect.
> 

I have heard since long that HB_NOSTARTUPWINDOW is a 
__dirty__|__horrible__|__etc__ hack.
May be due to my little understanding of other compilers etc. o
due to lack of sufficient programming knowledge, I have never
been able to understand the rationale behind it. I could never
grasp why a call to find a dynsym makes the code hacky.

I am persuing to reintroduce it any way.

Can you please enlighten me why you consider it so?

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20412393.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From mbelgrano at deltain.it  Sun Nov  9 18:52:51 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Sun Nov  9 18:53:50 2008
Subject: [Harbour] gui framework portable clone of XbaseParts
In-Reply-To: <20412142.post@talk.nabble.com>
References: <20315173.post@talk.nabble.com><AFB948164110ED43B5EB849E8DEEF03815F13B@SRV02.deltain.net><20324906.post@talk.nabble.com><AFB948164110ED43B5EB849E8DEEF03815F15F@SRV02.deltain.net>
	<20412142.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F160@SRV02.deltain.net>

After XbpWindow , XbpPartHandler, XbpCrt Do you think continue with
follow function?
Xbp3State XbpBitmap XbpBrowse XbpCellGroup XbpCheckBox XbpClipBoard
XbpColumn XbpCombobox XbpDialog XbpFileDev XbpFileDialog XbpFont
XbpFontDialog XbpHelp XbpHelpLabel XbpIWindow XbpListBox XbpMenu
XbpMenuBar XbpMetaFile XbpMLE XbpMultiCellGroup XbpPresSpace XbpPrinter
XbpPushButton XbpQuickBrowse XbpRadioButton XbpScrollBar XbpSetting
XbpSLE XbpSpinButton XbpStatic XbpSysWindowXbpTabPage XbpTreeView
XbpTreeViewItem 


-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Monday, November 10, 2008 12:21 AM
To: harbour@harbour-project.org
Subject: Re: [Harbour] gui framework portable clone of XbaseParts


Hi Massimo


Massimo Belgrano-3 wrote:
> 
> I am very interested by your project of adding to gtwvg 
> A gui framework portable clone of XbaseParts that will named "harbour
> Part" with Active X Capability
> Can you give me other information and explain your idea?
> Have you already written part of this?
> 

I am on way to structure class framework exactly on lines with
Xbase++. A rough skelton of 
XbpWindow(), XbpPartHandler(), XbpCrt() 
is already in place with a starting example implemented in demowvg.prg.

May be I post in today or tomorrow.
Stay tuned.

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/Higher-Level-Classes-to-Manage-Consoles-tp20315173
p20412142.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From druzus at acn.waw.pl  Sun Nov  9 18:58:46 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 18:57:52 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20412329.post@talk.nabble.com>
References: <20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com> <20410809.post@talk.nabble.com>
	<20081109231125.GC12076@34-mo7-2.acn.waw.pl>
	<20412329.post@talk.nabble.com>
Message-ID: <20081109235845.GA20278@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> > Can you tell me what issues?
> 1) There will never be a need for HB_STARTUPWINDOW.

What is HB_STARTUPWINDOW and what it does?

> 2) All other parameters will take effect after hb_gtReload()/hb_gtSelect()
>     is called and some screen output command like [ ? '.' ] is issued.

All parameters which operate directly on MS-Windows API without
registering their state in GT structures by definition are not
portable to GTNET so for me it's a feature that current code
forces different implementation.

> This will guarantee thar hWnd is always there right at the begining 

And will allow to write code which will not work when window have to
be recreated, f.e. on client machine after crash. We should not have
such code in GTWVT.

> and only its display behavior is changed according to needs of the hour.

I do not understand above.

best regards,
Przemek
From toninhofwi at yahoo.com.br  Sun Nov  9 20:02:52 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Sun Nov  9 19:02:51 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
Message-ID: <lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>

>To further tune Harbour performance vs. core features, below
>flags can be used:
>-DHB_FM_STATISTICS_OFF (for final all apps)
>-DHB_NO_DEBUG (if you never intend to use the debugger)
>-DHB_GUI (to build GUI apps exclusively)

Hi,

I use -DHB_HASH_MSG_ITEMS and -DHB_FM_STD_ALLOC too,

In windows vista my tests display bad results if we use DL_ALLOC,

Regards,

Toninho.


		
_______________________________________________________ 
Yahoo! Mail - Sempre a melhor opo para voc! 
Experimente j e veja as novidades. 
http://br.yahoo.com/mailbeta/tudonovo/
 

From druzus at acn.waw.pl  Sun Nov  9 19:12:28 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov  9 19:11:35 2008
Subject: [Harbour] Problem with TOleAuto class
In-Reply-To: <1a7b887a.1c942b9.5e8c057.29@mafact.com>
References: <20081109141647.GA9100@34-mo7-2.acn.waw.pl>
	<1a7b887a.1c942b9.5e8c057.29@mafact.com>
Message-ID: <20081110001228.GB20278@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, J. Lefebvre wrote:

Hi,

> I have a strange problem with the TOleAuto Class from contrib/hbwin
> I can create an ole automation object without any problem,
> I can Get a propertie, using the automatic Getproperty routing method (by onerror method), so this one is working fine
> cFormula := oReport:RecordSelectionFormula
> But doing this one does not work :
> oReport:RecordSelectionFormula := '{FFAC.CODJOU} = "VEN"'
> (Error 25926100/3  DISP_E_MEMBERNOTFOUND: _RECORDSELECTIONFORMULA)
> Whilst this one is working :
> oReport:Set("RecordSelectionFormula" , '{FFAC.CODJOU} = "VEN"' )
> I checked win_ole.c sources, comparing HB_FUNC( TOLEAUTO_ONERROR ) and
> HB_FUNC( TOLEAUTO_SET )and I did no see any reason for those error.
> Any Idea ?

Messages are in upper case and maybe this is the source of problem.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov  9 19:25:07 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 19:25:03 2008
Subject: [Harbour] 2008-11-10 01:24 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c942ca$Blat.v2.6.2$c8b8e11a$12bcd2dfbdd0@127.0.0.1>

2008-11-10 01:24 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/hbzlib/zconf.h
    * Removed commented Harbour additions.

  * config/w32/mingwce.cf
  * config/w32/poccce.cf
  * config/w32/msvcce.cf
    ! Fixed typo in previous today's commit.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 19:49:24 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 19:49:30 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20412393.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com>
	<09F8FE5F-940C-4A93-A7ED-0D90284059C6@syenar.hu>
	<20412393.post@talk.nabble.com>
Message-ID: <23C3E24B-92F0-45A8-9813-EB612DBEF12D@syenar.hu>

> I have heard since long that HB_NOSTARTUPWINDOW is a
> __dirty__|__horrible__|__etc__ hack.
> May be due to my little understanding of other compilers etc. o
> due to lack of sufficient programming knowledge, I have never
> been able to understand the rationale behind it. I could never
> grasp why a call to find a dynsym makes the code hacky.
>
> I am persuing to reintroduce it any way.
>
> Can you please enlighten me why you consider it so?

Pritpal,

Your solution is a bad shortcut, which targets to
solve your sole personal need inside core Harbour,
executed in the "rope and glue" kind of way, sorry
to say that. The solution is largely inelegant, and
it just adds yet another complication while not
giving too much to the general "feature set".

Harbour tries to be a well thought out and a well
executed language, and this hack simply doesn't fit
the picture.

I've told my reasons several times BTW, but you
still couldn't tell even one reason while current
system is any bad, or why isn't it good enough to
add this hack to GTWVG, where such hacks are
accepted if you really need it. [ If it's there
already, I simply cannot imagine why do you want
to force it to core also. ]

So pls everyone try to think of the bigger picture
when trying to solve some personal needs. It's
certainly not a solution to add a distinct switch
for every such occasion, as we'd probably already
have several hundreds of command line options, function
variations and probably also a thousand build-time,
compile-time, link-time, runtime and dynsym switches.
Imagine anyone trying to use, debug or support such
a system.

In case of HB_NOSTARTUPWINDOW, we have a clearly
superior solution now, so we should try to solve
any possible problems with it, rather than trying
to go back in time and destroy what we have.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 19:58:33 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 19:58:38 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
Message-ID: <A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>

Hi Toninho,

> I use -DHB_HASH_MSG_ITEMS and -DHB_FM_STD_ALLOC too,

Yes, there is more, I was just listing the performance
related ones.

> In windows vista my tests display bad results if we use DL_ALLOC,

Can you tell some more about this? What does
"bad results" mean? It'd be important to know about
such problems before we settle with our default.

BTW, if Vista seems to be the problem, theoretically
all compilers are affected (not just BCC, which IIRC
you use).

Brgds,
Viktor

From bedipritpal at hotmail.com  Sun Nov  9 20:33:29 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov  9 20:33:33 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20081109235845.GA20278@34-mo7-2.acn.waw.pl>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20410707.post@talk.nabble.com> <20410809.post@talk.nabble.com>
	<20081109231125.GC12076@34-mo7-2.acn.waw.pl>
	<20412329.post@talk.nabble.com>
	<20081109235845.GA20278@34-mo7-2.acn.waw.pl>
Message-ID: <20413146.post@talk.nabble.com>


Przemek

>What is HB_STARTUPWINDOW and what it does?

Sorry, I meant HB_NOSTARTUPWINDOW.

<<<
All parameters which operate directly on MS-Windows API without
registering their state in GT structures by definition are not
portable to GTNET so for me it's a feature that current code
forces different implementation.
>>>

If GTNET is in mind, then your viewpoint is correct.

<<<
> This will guarantee thar hWnd is always there right at the begining 

And will allow to write code which will not work when window have to
be recreated, f.e. on client machine after crash. We should not have
such code in GTWVT.
>>>

This is a very small issue and I have already resoved it with me.
Surely I am anxious to take active part in GTNET, rather excited.

Let us keep the current functionality as is. Just resolve WINCE builds.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20413146.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sun Nov  9 20:35:17 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 20:35:14 2008
Subject: [Harbour] 2008-11-10 02:14 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c942d4$Blat.v2.6.2$95fe70f0$1784c2b97ff8@127.0.0.1>

2008-11-10 02:14 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * config/w32/poccce.cf
    + Added -D_WINCE to C compiler options.

  * source/pp/hbpp.c
  * source/main/harbour.c
    ! Reenabled hbwmain.c for __POCC__.

  * source/pp/hbpp.c
    * WinCE cleanup. (__MINGW32CE__ is always defined 
      when HB_WINCE is, so checking for HB_WINCE seems enough)
    % Removed #include <windows.h>.
    ; Please verify me.

  ; TOFIX: Pelles C 5.0 WinCE build results so far:

--- ERRORS
POLINK: error: Unresolved external symbol 'RegOpenKeyExA'.
POLINK: fatal error: 1 unresolved external(s).
../../harbour.c(56): fatal error #1035: Can't find include file "hbverbld.h".
../../math.c(652): error #3120: [asm] Symbol 'inf' is undefined.
../../cmdarg.c(61): fatal error #1035: Can't find include file "hbverbld.h".
POLINK: fatal error: File not found: 'hbvm.lib'.
contrib\gtwvg\gtwvg.h(78): fatal error #1035: Can't find include file <olectl.h>.
../../ctmath2.c(324): error #3120: [asm] Symbol 'inf' is undefined.
../../winapi.c(70): error #2048: Undeclared identifier 'CS_OWNDC'.
../../winapi.c(75): error #2048: Undeclared identifier 'IDI_APPLICATION'.
../../winapi.c(75): error #2140: Type error in argument 2 to 'LoadIconA'; found 'int', expected 'const char *'.
../../winapi.c(181): error #2048: Undeclared identifier 'MFS_DISABLED'.
../../getenvrn.c(177): error #2168: Operands of = have incompatible types 'char *' and 'int'.
../../odbc.c(94): fatal error #1035: Can't find include file <sql.h>.
contrib\hbsqlit3\sqlite3\sqlite3.c(9936): error #2168: Operands of = have incompatible types '(incomplete) struct tm *' and 'int'.
contrib\hbsqlit3\sqlite3\sqlite3.c(9937): error #2152: Unknown field 'tm_year' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(9938): error #2152: Unknown field 'tm_mon' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(9939): error #2152: Unknown field 'tm_mday' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(9940): error #2152: Unknown field 'tm_hour' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(9941): error #2152: Unknown field 'tm_min' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(9942): error #2152: Unknown field 'tm_sec' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22136): error #2120: Redeclaration of 'localtime' previously declared at contrib\hbsqlit3\sqlite3\sqlite3.c(9936): found '(incomplete) struct tm * __cdecl function(const unsigned long int *)', expected 'int __cdecl function()'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22137): error #2149: Undefined size for 'y' with type '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22137): error #2149: Undefined size for 'y' with type '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22147): error #2152: Unknown field 'tm_year' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22148): error #2152: Unknown field 'tm_mon' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22149): error #2152: Unknown field 'tm_wday' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22150): error #2152: Unknown field 'tm_mday' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22151): error #2152: Unknown field 'tm_hour' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22152): error #2152: Unknown field 'tm_min' of '(incomplete) struct tm'.
contrib\hbsqlit3\sqlite3\sqlite3.c(22153): error #2152: Unknown field 'tm_sec' of '(incomplete) struct tm'.
../../win_ole.c(77): fatal error #1035: Can't find include file <olectl.h>.
../../wincorec.c(150): error #2048: Undeclared identifier 'WS_MAXIMIZE'.
../../wincorec.c(166): error #2168: Operands of = have incompatible types 'HWND' and 'int'.
../../hbsyslog.c(31): error #2140: Type error in argument 2 to 'RegisterEventSourceW'; found 'const char *', expected 'const wchar_t *'.
../../hbsyslog.c(97): error #2140: Type error in argument 8 to 'ReportEventW'; found 'const char * *', expected 'const wchar_t * *'.
C:\devl\allegro-4.2.2\include\allegro\platform\almsvc.h(23): fatal error #1035: Can't find include file <malloc.h>.
../../firebird.c(456): error #2149: Undefined size for 'times' with type '(incomplete) struct tm'.
../../firebird.c(487): error #2152: Unknown field 'tm_year' of '(incomplete) struct tm'.
../../firebird.c(488): error #2152: Unknown field 'tm_mon' of '(incomplete) struct tm'.
../../firebird.c(489): error #2152: Unknown field 'tm_mday' of '(incomplete) struct tm'.
../../firebird.c(490): error #2152: Unknown field 'tm_hour' of '(incomplete) struct tm'.
../../firebird.c(491): error #2152: Unknown field 'tm_min' of '(incomplete) struct tm'.
../../firebird.c(492): error #2152: Unknown field 'tm_sec' of '(incomplete) struct tm'.
../../firebird.c(501): error #2152: Unknown field 'tm_year' of '(incomplete) struct tm'.
../../firebird.c(501): error #2152: Unknown field 'tm_mon' of '(incomplete) struct tm'.
../../firebird.c(501): error #2152: Unknown field 'tm_mday' of '(incomplete) struct tm'.
../../firebird.c(510): error #2152: Unknown field 'tm_hour' of '(incomplete) struct tm'.
../../firebird.c(511): error #2152: Unknown field 'tm_min' of '(incomplete) struct tm'.
../../firebird.c(512): error #2152: Unknown field 'tm_sec' of '(incomplete) struct tm'.
../../fi_winfu.c(98): error #2048: Undeclared identifier 'CBM_INIT'.
../../fi_winfu.c(99): error #2168: Operands of = have incompatible types 'HBITMAP' and 'int'.
C:\devl\mysql-5.0.67\include\mysql_com.h(183): error #2001: Syntax error: expected '}' but found 'SOCKET'.
C:\devl\mysql-5.0.67\include\mysql_com.h(222): error #2156: Unrecognized declaration.
C:\devl\mysql-5.0.67\include\mysql_com.h(335): error #2001: [ LOTS MORE ]

--- WARNINGS
../../winapi.c(194): warning #2027: Missing prototype for 'InsertMenuItem'.
../../winapi.c(219): warning #2027: Missing prototype for 'SetMenu'.
../../getenvrn.c(177): warning #2027: Missing prototype for 'GetEnvironmentStrings'.
../../getenvrn.c(246): warning #2027: Missing prototype for 'FreeEnvironmentStrings'.
contrib\hbsqlit3\sqlite3\sqlite3.c(9936): warning #2027: Missing prototype for 'localtime'.
../../tpwin32.c(75): warning #2027: Missing prototype for 'BuildCommDCB'.
../../wincorec.c(164): warning #2027: Missing prototype for 'CreateMDIWindow'.
C:\devl\PellesC-501\include\wince\ws2tcpip.h(381): warning #2115: Local 'dwMsgLen' is initialized but never used.
C:\devl\PellesC-501\include\wince\ws2tcpip.h(392): warning #2115: Local 'dwMsgLen' is initialized but never used.
../../fi_winfu.c(97): warning #2027: Missing prototype for 'CreateDIBitmap'.
../../fi_winfu.c(147): warning #2027: Missing prototype for 'GetDIBits'.
C:\devl\mysql-5.0.67\include\mysql_com.h(222): warning #2099: Missing type specifier.
C:\devl\mysql-5.0.67\include\mysql.h(275): error #2011: Declared parameter 'warning_count' is missing.
../../sqlbase.c(509): warning #2130: Result of unsigned comparison is constant.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 20:47:49 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 20:47:56 2008
Subject: [Harbour] new HB_ARCHITECTURE=wince ?
Message-ID: <42D7670C-26FE-447F-B86F-F9DE2BF84C12@syenar.hu>

Hi everyone,

I'd like to ask opinions whether to introduce wince
as a distinct architecture in the GNU-make system.

This would replace current w32/mingwce, w32/msvcce,
w32/poccce builds with wince/mingw, wince/msvc,
wince/pocc.

It would be useful because it would make it easier
to enable/disable contribs for this platform.

As of now, following contribs should have been
disabled for WinCE builds: hbwhat, hbole, hbmysql,
gtalleg, hbtpathy, hbfimage.

[ Some of these could probably be fixed to compile
under WinCE, but some definitely not. ]

It would also allow to better sync non-GNU make
with GNU make by changing HB_BUILD_WINCE=yes to
HB_ARCHITECTURE=wince.

Opinions?

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 21:06:31 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 21:06:29 2008
Subject: [Harbour] 2008-11-10 02:56 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c942d8$Blat.v2.6.2$f30f38c0$14a0611c77d0@127.0.0.1>

2008-11-10 02:56 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * config/w32/poccce.cf
    ! Added -DUNICODE switch.

  ; TOFIX: (important ones only)

    --- ERRORS
    ../../math.c(652): error #3120: [asm] Symbol 'inf' is undefined.
    contrib\gtwvg\gtwvg.h(78): fatal error #1035: Can't find include file <olectl.h>.
    ../../ctmath2.c(324): error #3120: [asm] Symbol 'inf' is undefined.
    ../../getenvrn.c(177): error #2168: Operands of = have incompatible types 'wchar_t *' and 'int'.

    --- WARNINGS
    source\vm\dlmalloc.c(2486): warning #2027: Missing prototype for 'abort'.
    source\vm\dlmalloc.c(3253): warning #2027: [ LOTS MORE ]
    ../../getenvrn.c(177): warning #2027: Missing prototype for 'GetEnvironmentStrings'.
    ../../getenvrn.c(246): warning #2027: Missing prototype for 'FreeEnvironmentStrings'.
    contrib\hbsqlit3\sqlite3\sqlite3.c(9936): warning #2027: Missing prototype for 'localtime'.
--
Brgds,
Viktor

From mbelgrano at deltain.it  Sun Nov  9 21:05:57 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Sun Nov  9 21:08:28 2008
Subject: R: [Harbour] wince (wcecon not ruuning on PocketPc)
References: <20236568.post@talk.nabble.com><20081029221836.GA20510@34-mo7-2.acn.waw.pl><20251189.post@talk.nabble.com><20081031014729.GB24870@34-mo7-2.acn.waw.pl><20259457.post@talk.nabble.com><20081031110930.GB22253@34-mo7-2.acn.waw.pl><20408175.post@talk.nabble.com><20081109164721.GA2969@34-mo7-2.acn.waw.pl><20409140.post@talk.nabble.com>
	<20409230.post@talk.nabble.com><20409269.post@talk.nabble.com><20081109201947.GA24098@34-mo7-2.acn.waw.pl><20410707.post@talk.nabble.com>
	<20410809.post@talk.nabble.com><20081109231125.GC12076@34-mo7-2.acn.waw.pl><20412329.post@talk.nabble.com><20081109235845.GA20278@34-mo7-2.acn.waw.pl>
	<20413146.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF038037616@SRV02.deltain.net>

What will be GTNET?
An harbour application run on server but is used on client? 

Massimo Belgrano



-----Messaggio originale-----
Da: harbour-bounces@harbour-project.org per conto di Pritpal Bedi
Inviato: lun 10/11/2008 2.33
A: harbour@harbour-project.org
Oggetto: Re: [Harbour] wince (wcecon not ruuning on PocketPc)
 

Przemek

>What is HB_STARTUPWINDOW and what it does?

Sorry, I meant HB_NOSTARTUPWINDOW.

<<<
All parameters which operate directly on MS-Windows API without
registering their state in GT structures by definition are not
portable to GTNET so for me it's a feature that current code
forces different implementation.
>>>

If GTNET is in mind, then your viewpoint is correct.

<<<
> This will guarantee thar hWnd is always there right at the begining 

And will allow to write code which will not work when window have to
be recreated, f.e. on client machine after crash. We should not have
such code in GTWVT.
>>>

This is a very small issue and I have already resoved it with me.
Surely I am anxious to take active part in GTNET, rather excited.

Let us keep the current functionality as is. Just resolve WINCE builds.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20413146.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/ms-tnef
Size: 4116 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081110/4f1af659/attachment-0001.bin
From harbour.01 at syenar.hu  Sun Nov  9 21:27:05 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 21:27:01 2008
Subject: [Harbour] 2008-11-10 03:15 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c942db$Blat.v2.6.2$d29e3728$131c81b93030@127.0.0.1>

2008-11-10 03:15 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * config/w32/poccce.cf
    ! Added -DHB_NO_WIN_CONSOLE.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov  9 21:37:04 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov  9 21:37:01 2008
Subject: [Harbour] 2008-11-10 03:35 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c942dd$Blat.v2.6.2$379f359a$1538298fa1b8@127.0.0.1>

2008-11-10 03:35 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/vm/fm.c
    ! Fixed missing abort() on WinCE. (for Pelles C only, but 
      the fix should work for any WinCE compilers).
    ; TOFIX: Now the only remaining showstopper for PellesC5 WinCE 
             support is:
             ../../math.c(652): error #3120: [asm] Symbol 'inf' is undefined.
--
Brgds,
Viktor

From gvarona at ec-red.com  Sun Nov  9 22:09:31 2008
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Sun Nov  9 22:09:36 2008
Subject: [Harbour] Printer list
Message-ID: <4917A5EB.10608@ec-red.com>

Hi
Is there any role that I return the printer list (names and ports they 
use)?
and the default printer

I use: WinXP SP3 + Harbour + MinGW

Best Regards.

GVS
From dmacias at mail.udg.mx  Mon Nov 10 00:21:31 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov 10 00:21:33 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4917C4DB.2000502@mail.udg.mx>

 >> is executed but screen is not refreshed with tracing labels on it
 >> I was catching and error DISAPPEAR applying in hb_gt_os2_ReadKey():
 >>    /*   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk ); */
 >> As you said, fail reading keyboard input except thread 1  :-)

 >we will have to find why it happens. Maybe Maurilio can help.

Maurilio, help !

 >> ... and screen/output is not updated ?

 >??? I do not understand. Do you want to say that only 1-st thread can
 >display data on the screen?

Good question but I am not tested that

What I say is: using gtos2, at least in these tests, screen/output is 
not refreshed and tracing labels existent in body of fuction where error 
happen are not shown
You will see more samples below

 >>       if( kbhit() )
 >>          ch = getch();

 >Probably kbhit() internally call KbdCharIn() and it's exactly
 >the same problem.
Maybe

 >If possible then I would like to check if other GTOS2 functions works
 >correctly for 2-nd thread and the problem is only with KbdCharIn().
 >F.e. try mttest02.prg with such modified GTOS2 so we can see if screen
 >output works.

I was trying with mttest02.prg and we got many results
Note: I am not testing if "screen output works" with 2nd thread but 
entire execution of program

For now we have in gtos2.c
    /*   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk ); */

and mttest02.exe results:
----------------
1. hb_gt_def_InkeyPollDo()
0. hb_gt_os2_ReadKey()
1. hb_gt_os2_ReadKey()
2. hb_gt_os2_ReadKey()
3. hb_gt_os2_ReadKey()
4. hb_gt_os2_ReadKey()
1. hb_gt_def_MouseReadKey()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
----------------

Using replacement for HB_GTSELF_MOUSEISPRESENT( pGT ):

    printf("1. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
    /* if( HB_GTSELF_MOUSEISPRESENT( pGT ) ) */
    if( hb_gt_def_MouseIsPresent( pGT ) )

and mttest02.exe results:
----------------
4. hb_gt_os2_ReadKey()
1. hb_gt_def_MouseReadKey()
10. hb_gt_def_MouseReadKey()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
----------------

so error happen trying HB_GTSELF_MOUSEISPRESENT( pGT )

Using
    printf("1. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
    if( HB_GTSELF_MOUSEISPRESENT( pGT ) )
    /* if( hb_gt_def_MouseIsPresent( pGT ) ) */

and

static BOOL hb_gt_os2_mouse_IsPresent( PHB_GT pGT )
{
    printf("1. hb_gt_os2_mouse_IsPresent()\r\n");fflush(stdout);
    HB_SYMBOL_UNUSED( pGT );
    printf("2. hb_gt_os2_mouse_IsPresent()\r\n");fflush(stdout);
    return s_uMouHandle != 0;
}

and mttest02.exe results:
----------------
4. hb_gt_os2_ReadKey()
1. hb_gt_def_MouseReadKey()
1. hb_gt_os2_mouse_IsPresent()
2. hb_gt_os2_mouse_IsPresent()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
----------------

so hb_gt_os2_mouse_IsPresent( ) is working fine

Using in hb_gt_def_MouseReadKey( )

       /* if( iEventMask & INKEY_LDOWN && HB_GTSELF_MOUSEBUTTONPRESSED( 
pGT, 0, &iRow, &iCol ) ) */
       if( iEventMask & INKEY_LDOWN && hb_gt_def_MouseButtonPressed( 
pGT, 0, &iRow, &iCol ) )

and mttest02.exe results:
----------------
1. hb_gt_os2_mouse_IsPresent()
2. hb_gt_os2_mouse_IsPresent()
8. hb_gt_def_MouseReadKey()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
----------------

which belong to:

          printf("8. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
          HB_GTSELF_MOUSEGETPOS( pGT, &iRow, &iCol );
          printf("9. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);

and HB_GTSELF_MOUSEGETPOS() should be checked later and is pending

Reusing:
       /* if( iEventMask & INKEY_LDOWN && hb_gt_def_MouseButtonPressed( 
pGT, 0, &iRow, &iCol ) ) */
       if( iEventMask & INKEY_LDOWN && HB_GTSELF_MOUSEBUTTONPRESSED( 
pGT, 0, &iRow, &iCol ) )


and


static BOOL hb_gt_os2_mouse_ButtonPressed( PHB_GT pGT, int iButton, int 
* piRow, int * piCol )
{
    HB_SYMBOL_UNUSED( pGT );
    printf("1. hb_gt_os2_mouse_ButtonPressed()\r\n");fflush(stdout);
    hb_gt_os2_mouse_ReadMouseState();
    printf("2. hb_gt_os2_mouse_ButtonPressed()\r\n");fflush(stdout);

and mttest02.exe results:
----------------
4. hb_gt_os2_ReadKey()
1. hb_gt_def_MouseReadKey()
1. hb_gt_os2_mouse_IsPresent()
2. hb_gt_os2_mouse_IsPresent()
1. hb_gt_os2_mouse_ButtonPressed()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
................

and using a trick to ignore MouReadEventQue( )

    printf("1. hb_gt_os2_mouse_ReadMouseState()\r\n");fflush(stdout);
    if( s_uMouHandle )
    {
       USHORT WaitOption = 0;  /* 1 = wait until mouse event exist, 0 = 
don't */
       MOUEVENTINFO MouEvent;
       printf("2. hb_gt_os2_mouse_ReadMouseState()\r\n");fflush(stdout);
/*
       if( MouReadEventQue( &MouEvent, &WaitOption, s_uMouHandle ) == 
NO_ERROR )
       {
*/
       if( s_ButtonState[ 1 ].fDown )
       {

and mttest02.exe results:
----------------
1. hb_gt_def_MouseReadKey()
1. hb_gt_os2_mouse_IsPresent()
2. hb_gt_os2_mouse_IsPresent()
1. hb_gt_os2_mouse_ButtonPressed()
1. hb_gt_os2_mouse_ReadMouseState()
2. hb_gt_os2_mouse_ReadMouseState()
3. hb_gt_os2_mouse_ReadMouseState()
4. hb_gt_os2_mouse_ReadMouseState()
2. hb_gt_os2_mouse_ButtonPressed()
8. hb_gt_def_MouseReadKey()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
...............

As we see it fail with MouReadEventQue() and dows not fail without it

This lead us to the pending:

          printf("8. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
          HB_GTSELF_MOUSEGETPOS( pGT, &iRow, &iCol );

and using

          printf("8. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
/*         HB_GTSELF_MOUSEGETPOS( pGT, &iRow, &iCol ); */
          printf("9. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);

does not fail
So fail happen within
          HB_GTSELF_MOUSEGETPOS( pGT, &iRow, &iCol );

and using:

    printf("1. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
    if( s_uMouHandle )
    {
       PTRLOC pos;
       printf("2. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
       MouGetPtrPos( &pos, s_uMouHandle );
       *row = ( int ) pos.row;
       *col = ( int ) pos.col;
       printf("3. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
    }

and mttest02.exe results:
----------------
4. hb_gt_os2_mouse_ReadMouseState()
2. hb_gt_os2_mouse_ButtonPressed()
8. hb_gt_def_MouseReadKey()
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
................

As you see in this and other cases, fail within hb_gt_os2_mouse_GetPos() 
but screen/output is not refreshed to show at least
    printf("1. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
    printf("2. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);

This behaviour confuse us because last info seem to be fail in the 
calling function, while fail occur in called function which does not 
refressh their own printf( )
I do not know if this is a normal behaviour for printf( )

Obviously using

       printf("2. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
       /* MouGetPtrPos( &pos, s_uMouHandle ); */

everything work fine


As summary there are problems in "reading devices" except for thread 1

Now we have catched at least three points which cause fails:
   KbdCharIn( )
   MouReadEventQue( )
   MouGetPtrPos( )

and they are NOT Harbour functions/procedures

Except for calling, KbdCharIn reference exist only in:

--------------------
  * $Id: gtkeycod.c 8193 2007-12-22 10:28:28Z druzus $
  */

/*
  * Harbour Project source code:
  *    hb_gt_dos_keyCodeTranslate()
  *          function used by DOS, WIN and OS2 ports of few GTs which use
  *          getkey()/getch()/_read_kbd()/KbdCharIn() or similar function
  *          for keyboard input
  *    based on hb_gt_ReadKey() from GTDOS code by:
  *          Copyright 1999 David G. Holm <dholm@jsd-llc.com>
--------------------


so KbdCharIn( ), MouReadEventQue( ), MouGetPtrPos( ) should belong to C 
compiler or OS/2


\watcom\h\os2\bsesub.h show for KbdCharIn:

/*
  *  bsesub.h    OS/2 Base subsystems include file for 32-bit development.

#define KbdCharIn        KBD16CHARIN
#define KR_KBDCHARIN       0x0001
USHORT APIENTRY16 KbdCharIn(PKBDKEYINFO,USHORT,HKBD);


and for MouReadEventQue

#define MouReadEventQue    MOU16READEVENTQUE
#define MR_MOUREADEVENTQUE  0x00000010
USHORT APIENTRY16 MouReadEventQue(PMOUEVENTINFO,PUSHORT,HMOU);


and for MouGetPtrPos

#define MouGetPtrPos       MOU16GETPTRPOS
#define MR_MOUGETPTRPOS     0x00020000
USHORT APIENTRY16 MouGetPtrPos(PPTRLOC,HMOU);


KBD16CHARIN exist only in:
#define Kbd16CharIn      KBD16CHARIN
#define KbdCharIn        KBD16CHARIN

  \watcom\lib386\os2\clib3r.lib
  \watcom\lib386\os2\clib3s.lib
  \watcom\lib386\os2\os2386.lib


and in \watcom\h\os21x\bsesub.h show for KbdCharIn:

/*
  *  bsesub.h    OS/2 Base subsystems include file for 16-bit development.

#define KR_KBDCHARIN       0x00000001
USHORT APIENTRY KbdCharIn(PKBDKEYINFO CharData, USHORT IOWait, HKBD 
KbdHandle);

I suppose that os21x is for OS/2 1.x


and for gcc335 we have

\usr\include\os2emx.h

/* os2emx.h,v 1.19 2004/09/14 22:27:35 bird Exp */

#define KR_KBDCHARIN			0x00000001
USHORT APIENTRY KbdCharIn (PKBDKEYINFO pkbci, USHORT fWait, HKBD hkbd);

#define MR_MOUREADEVENTQUE		0x00000010
USHORT APIENTRY MouReadEventQue (PMOUEVENTINFO pmouevEvent, PUSHORT 
pfWait, HMOU hmou);

#define MR_MOUGETPTRPOS			0x00020000
USHORT APIENTRY MouGetPtrPos (PPTRLOC pmouLoc, HMOU hmou);


I do not know which differences exist between APIENTRY16 (OW) and 
APIENTRY (OW os21x, gcc335) but they show differences between C 
compilers where at last may reside problem with threads except thread 1


As you see, I was changing C code myself  :-)

David Macias

From bedipritpal at hotmail.com  Mon Nov 10 00:40:00 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Mon Nov 10 00:40:03 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) - Feature
	Request
Message-ID: <20414605.post@talk.nabble.com>


Hello Przemek

Can we have hb_gtInfoEx() function accepting 
<pGT> as its first parameter and then the rest parameters.
It will help me to control GT behavior from other threads .

Also can we retrieve <pGT> for current context, i.e., 
pGT := hb_gtCurrent() or like ?

hb_gtReload() returns TRUE/FALSE. How can I retreive its <pGT>.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20414605.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Mon Nov 10 03:56:53 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 03:56:59 2008
Subject: [Harbour] 2008-11-10 09:50 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94312$Blat.v2.6.2$46f62f82$ecc7a558d0c@127.0.0.1>

2008-11-10 09:50 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * include/hbmath.h
    ! Fixed Pelles C 5.00 not having an 'inf' (HUGE_VAL) symbol 
      when in -Tarm-coff (~WinCE) mode. Pelles C bug (?).

    ; NOTE: Now core fully compiles in WinCE mode. So we have 
            a new port.

    ; TOFIX: (this is a complete list of all Pelles C WinCE problems)
             [except hbmysql errors]

      --- WARNINGS
      POLINK: warning: Multiple '.rdata' sections found with different flags (0x40000040 and 0xc0000040).
      POLINK: warning: Multiple '.rdata' sections found with different flags (0x40000040 and 0xc0000040).
      ../../ctnet.c(119): warning #2027: Missing prototype for 'WNetGetLastError'.
      ../../ctnet.c(167): warning #2027: Missing prototype for 'WNetCancelConnection'.
      ../../ctnet.c(208): warning #2027: Missing prototype for 'WNetAddConnection'.
      ../../ctnet.c(210): warning #2027: Missing prototype for 'WNetAddConnection'.
      ../../ctnet.c(251): warning #2027: Missing prototype for 'WNetGetProviderName'.
      ../../ctnet.c(271): warning #2027: Missing prototype for 'WNetGetProviderName'.
      ../../disk.c(127): warning #2027: Missing prototype for 'GetDriveType'.
      ../../disk.c(244): warning #2027: Missing prototype for 'SetVolumeLabel'.
      ../../disk.c(270): warning #2027: Missing prototype for 'GetVolumeInformation'.
      ../../disk.c(307): warning #2027: Missing prototype for 'GetVolumeInformation'.
      ../../disk.c(337): warning #2027: Missing prototype for 'GetFullPathName'.
      ../../winapi.c(194): warning #2027: Missing prototype for 'InsertMenuItem'.
      ../../winapi.c(219): warning #2027: Missing prototype for 'SetMenu'.
      ../../getenvrn.c(177): warning #2027: Missing prototype for 'GetEnvironmentStrings'.
      ../../getenvrn.c(246): warning #2027: Missing prototype for 'FreeEnvironmentStrings'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(9936): warning #2027: Missing prototype for 'localtime'.
      ../../tpwin32.c(75): warning #2027: Missing prototype for 'BuildCommDCB'.
      ../../wincorec.c(164): warning #2027: Missing prototype for 'CreateMDIWindow'.
      ../../fi_winfu.c(97): warning #2027: Missing prototype for 'CreateDIBitmap'.
      ../../fi_winfu.c(147): warning #2027: Missing prototype for 'GetDIBits'.
      ../../sqlbase.c(509): warning #2130: Result of unsigned comparison is constant.

      --- ERRORS
      contrib\gtwvg\gtwvg.h(78): fatal error #1035: Can't find include file <olectl.h>.
      ../../ctnet.c(119): warning #2027: Missing prototype for 'WNetGetLastError'.
      ../../disk.c(129): error #2048: Undeclared identifier 'DRIVE_RAMDISK'.
      ../../disk.c(129): error #2045: Case label must be a constant integer expression.
      ../../disk.c(132): error #2048: Undeclared identifier 'DRIVE_REMOVABLE'.
      ../../disk.c(132): error #2045: Case label must be a constant integer expression.
      ../../disk.c(135): error #2048: Undeclared identifier 'DRIVE_FIXED'.
      ../../disk.c(135): error #2045: Case label must be a constant integer expression.
      ../../disk.c(138): error #2048: Undeclared identifier 'DRIVE_CDROM'.
      ../../disk.c(138): error #2045: Case label must be a constant integer expression.
      ../../disk.c(141): error #2048: Undeclared identifier 'DRIVE_REMOTE'.
      ../../disk.c(141): error #2045: Case label must be a constant integer expression.
      ../../winapi.c(70): error #2048: Undeclared identifier 'CS_OWNDC'.
      ../../winapi.c(75): error #2048: Undeclared identifier 'IDI_APPLICATION'.
      ../../winapi.c(75): error #2140: Type error in argument 2 to 'LoadIconW'; found 'int', expected 'const wchar_t *'.
      ../../winapi.c(181): error #2048: Undeclared identifier 'MFS_DISABLED'.
      ../../getenvrn.c(177): error #2168: Operands of = have incompatible types 'wchar_t *' and 'int'.
      ../../odbc.c(94): fatal error #1035: Can't find include file <sql.h>.
      contrib\hbsqlit3\sqlite3\sqlite3.c(9936): error #2168: Operands of = have incompatible types '(incomplete) struct tm *' and 'int'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(9937): error #2152: Unknown field 'tm_year' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(9938): error #2152: Unknown field 'tm_mon' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(9939): error #2152: Unknown field 'tm_mday' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(9940): error #2152: Unknown field 'tm_hour' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(9941): error #2152: Unknown field 'tm_min' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(9942): error #2152: Unknown field 'tm_sec' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22136): error #2120: Redeclaration of 'localtime' previously declared at contrib\hbsqlit3\sqlite3\sqlite3.c(9936): found '(incomplete) struct tm * __cdecl function(const unsigned long int *)', expected 'int __cdecl function()'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22137): error #2149: Undefined size for 'y' with type '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22137): error #2149: Undefined size for 'y' with type '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22147): error #2152: Unknown field 'tm_year' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22148): error #2152: Unknown field 'tm_mon' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22149): error #2152: Unknown field 'tm_wday' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22150): error #2152: Unknown field 'tm_mday' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22151): error #2152: Unknown field 'tm_hour' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22152): error #2152: Unknown field 'tm_min' of '(incomplete) struct tm'.
      contrib\hbsqlit3\sqlite3\sqlite3.c(22153): error #2152: Unknown field 'tm_sec' of '(incomplete) struct tm'.
      ../../win_ole.c(77): fatal error #1035: Can't find include file <olectl.h>.
      ../../wincorec.c(150): error #2048: Undeclared identifier 'WS_MAXIMIZE'.
      ../../wincorec.c(166): error #2168: Operands of = have incompatible types 'HWND' and 'int'.
      C:\devl\allegro-4.2.2\include\allegro\platform\almsvc.h(23): fatal error #1035: Can't find include file <malloc.h>.
      ../../firebird.c(456): error #2149: Undefined size for 'times' with type '(incomplete) struct tm'.
      ../../firebird.c(487): error #2152: Unknown field 'tm_year' of '(incomplete) struct tm'.
      ../../firebird.c(488): error #2152: Unknown field 'tm_mon' of '(incomplete) struct tm'.
      ../../firebird.c(489): error #2152: Unknown field 'tm_mday' of '(incomplete) struct tm'.
      ../../firebird.c(490): error #2152: Unknown field 'tm_hour' of '(incomplete) struct tm'.
      ../../firebird.c(491): error #2152: Unknown field 'tm_min' of '(incomplete) struct tm'.
      ../../firebird.c(492): error #2152: Unknown field 'tm_sec' of '(incomplete) struct tm'.
      ../../firebird.c(501): error #2152: Unknown field 'tm_year' of '(incomplete) struct tm'.
      ../../firebird.c(501): error #2152: Unknown field 'tm_mon' of '(incomplete) struct tm'.
      ../../firebird.c(501): error #2152: Unknown field 'tm_mday' of '(incomplete) struct tm'.
      ../../firebird.c(510): error #2152: Unknown field 'tm_hour' of '(incomplete) struct tm'.
      ../../firebird.c(511): error #2152: Unknown field 'tm_min' of '(incomplete) struct tm'.
      ../../firebird.c(512): error #2152: Unknown field 'tm_sec' of '(incomplete) struct tm'.
      ../../fi_winfu.c(98): error #2048: Undeclared identifier 'CBM_INIT'.
      ../../fi_winfu.c(99): error #2168: Operands of = have incompatible types 'HBITMAP' and 'int'.
--
Brgds,
Viktor

From jfl at mafact.com  Mon Nov 10 04:51:00 2008
From: jfl at mafact.com (J. Lefebvre)
Date: Mon Nov 10 04:51:23 2008
Subject: [Harbour] Problem with TOleAuto class
In-Reply-To: <20081110001228.GB20278@34-mo7-2.acn.waw.pl>
Message-ID: <e11d27bc.1c94319.e680c.29@mafact.com>

Hi Przemek,

I already tryed that.

oReport:Set("RECORDSELECTIONFORMULA" , '{FFAC.CODJOU} = "VEN"' )

is also working...

in win_ole.c

I checked the result of 

  OleGetID( pDisp, hb_itemGetSymbol( hb_stackBaseItem() )->szName, &DispID, &bSetFirst )

Wich succeded and correctly set bSetFirst to True.

It is only the assignation wich failed ...

 OleSetProperty( pDisp, DispID, &DispParams )

Regards,

JF

-----Message d'origine-----
De?: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] De la part de Przemyslaw Czerpak
Envoy??: lundi 10 novembre 2008 1:12
??: Harbour Project Main Developer List.
Objet?: Re: [Harbour] Problem with TOleAuto class

On Sun, 09 Nov 2008, J. Lefebvre wrote:

Hi,

> I have a strange problem with the TOleAuto Class from contrib/hbwin
> I can create an ole automation object without any problem,
> I can Get a propertie, using the automatic Getproperty routing method (by onerror method), so this one is working fine
> cFormula := oReport:RecordSelectionFormula
> But doing this one does not work :
> oReport:RecordSelectionFormula := '{FFAC.CODJOU} = "VEN"'
> (Error 25926100/3  DISP_E_MEMBERNOTFOUND: _RECORDSELECTIONFORMULA)
> Whilst this one is working :
> oReport:Set("RecordSelectionFormula" , '{FFAC.CODJOU} = "VEN"' )
> I checked win_ole.c sources, comparing HB_FUNC( TOLEAUTO_ONERROR ) and
> HB_FUNC( TOLEAUTO_SET )and I did no see any reason for those error.
> Any Idea ?

Messages are in upper case and maybe this is the source of problem.

best regards,
Przemek
_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour


From dmacias at mail.udg.mx  Mon Nov 10 04:51:27 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov 10 04:51:28 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <4918041F.4030404@mail.udg.mx>

[Przemek]
 > ../../thread.c(1240): Error! E029: col(60) symbol '_gettid' has not 
been declared
 >
 > _gettid() is GCC local function.
 > I do not see function which returns directly thread ID in OS2 API.
 > Probably it can be extracted from TIB structure returned by
 > DosGetInfoBlocks(). I cannot find simpler method. Maurilio can you help?
 >

[Maurilio]
 > I've not tested this code, but something like this should give you 
the thread id.
 > unsigned long _gettid()
 > {
 >    PTIB   ptib = NULL;
 >    APIRET rc;
 >
 >    rc = DosGetInfoBlocks(&ptib, NULL);
 >
 >    return ptib->tib_ptib2->tib2_ultid;
 > }
 > Hope this help.

[Przemek]
 >Yes, thanks. I hoped that maybe there is simpler version then using
 >DosGetInfoBlocks() but we can also use this. Thank you very much.

Przemek, Maurilio:

I do not know if it is what you are looking for
I found in different places of documentation included in OW
---------
  The macro _threadid can be used to determine the current thread 
identifier.
---------

The _threadid macro can be used to determine the current thread 
identifier.  It is defined as follows.


      int *__threadid(void);
      #define _threadid (__threadid())

The header file stddef.h contains the definition of the _threadid macro.
---------

_threadid
Prototype in <stddef.h>.

This variable/function may be used to obtain the id of the current 
thread which is an int.  In the 32-bit libraries,  _threadid is a 
function that returns a pointer to an int.  In the 16-bit libraries, 
_threadid is a far pointer to an int.  Note that the value stored where 
  _threadid points does not necessarily change when a thread context 
switch occurs (so do not make a copy of the pointer ...  it may change). 
  To obtain the current thread identifier, simply code:

      int tid = *_threadid;
-------------


So I tried in source\vm\thread.c

---------------
#if defined( HB_OS_OS2 )

#include <stddef.h>       <---- David was here !

ULONG _hb_gettid( void )
{
    ULONG tid = 0;
    PTIB  ptib = NULL;

    printf( "_hb_gettid()\r\n", tid ); fflush(stdout);
/*       <---- David was here !
    if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )
    {
       if( ! ptib )
          { printf( "ptib is NULL\r\n" ); fflush(stdout); }
       else if( !ptib->tib_ptib2 )
          { printf( "ptib->tib_ptib2 is NULL\r\n" ); fflush(stdout); }
       else
          tid = ptib->tib_ptib2->tib2_ultid;
    }
*/

    tid = *_threadid;         <---- David was here !

    printf( "TID=%lu\r\n", tid ); fflush(stdout);

    return tid;
}
#endif
---------------

and mttest02.exe result with values TID=1, 2
---------------
[...]
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=2
[...]
---------------

So if _threadid is useful giving same value as GCC _gettid(), then 
_hb_gettid() can be discarded and use in harbour\include\hbthread.h:

-----------
//discard
    extern ULONG _hb_gettid( void );

#  if defined( __GNUC__ )
#     define HB_THREAD_SELF()    ( ( TID ) _gettid() )

#  else

// case for OpenWatcom
//   Use something like
   #include <stddef.h>       <---- David was here !
    tid = *_threadid;         <---- David was here !

int vs ULONG ?
In the 32-bit libraries,  _threadid is a function that returns a pointer 
to an int

#  else

//discard
#     define HB_THREAD_SELF()    ( ( TID ) _hb_gettid() )
#  endif
-----------


And in this case ( thread ID ) what is happening/using in Windows 
OpenWatcom ? It can be used in OS/2 Watcom ?

David Macias


From toninhofwi at yahoo.com.br  Mon Nov 10 06:03:26 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Mon Nov 10 05:00:06 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
Message-ID: <er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>

>> In windows vista my tests display bad results if we use DL_ALLOC,
>
>Can you tell some more about this? What does
>"bad results" mean? It'd be important to know about
>such problems before we settle with our default.

Hi Viktor, sorry for delay. I don?t have windows vista in my home, so
I was waiting to do another test in my office.

I did two posts here in the past, about this because I thought this
issue important.

In Windows Vista, my application doesn?t run smooth with dlalloc, it
pauses with a short delay in some circunstancies.

To reproduce this problem, run tests\memtst.prg. In last test with
standard bcc memory manager memtst run smooth and fast, but with
dlalloc it pause in each test.

---cut---
a := {}
for i := 1 to N_LOOPS
   aadd( a, {} )
   if i%1000 == 0
      ?? i
   endif
next
---cut---

With windowsXP both MM works fine.


Regards,

Toninho.

__________________________________________________
Fa?a liga??es para outros computadores com o novo Yahoo! Messenger 
http://br.beta.messenger.yahoo.com/ 
From dmacias at mail.udg.mx  Mon Nov 10 05:07:25 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Mon Nov 10 05:07:26 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491807DD.5060504@mail.udg.mx>

I found in documentation included in OW a sample for multithreading

Entirely page is below
Przemek, can you check page ?

They talk about DosEnterCritSec() and DosExitCritSec() to prevent 
collisions between threads

I tested using
   wcl386 -bt=os2 -bm -l=os2v2 mthread

and results are:
------------
Initial thread id = 1
Hi from thread 5
Hi from thread 4
Hi from thread 3
Hi from thread 2
------------

There are this info in doc too

------------
There is a limit to the number of threads an application can create 
under 16-bit OS/2.  The default limit is 32.  This limit can be adjusted 
by statically initializing the unsigned global variable __MaxThreads.

Under 32-bit OS/2, there is no limit to the number of threads an 
application can create.  However, due to the way in which multiple 
threads are supported in the Open Watcom libraries, there is a small 
performance penalty once the number of threads exceeds the default limit 
of 32 (this number includes the initial thread).  If you are creating 
more than 32 threads and wish to avoid this performance penalty, you can 
redefine the threshold value of 32.  You can statically initialize the 
global variable __MaxThreads.

By adding the following line to your multi-threaded application, the new 
threshold value will be set to 48.


      unsigned __MaxThreads = { 48 };
------------

David Macias



Let us create a simple multi-threaded application.  The source code for 
this example can be found in \watcom\samples\os2.


      #include <process.h>
      #include <stdio.h>
      #include <stddef.h>
      #define INCL_DOS
      #include <os2.h>

      static  volatile int    NumThreads;
      static  volatile int    HoldThreads;

      #define NUM_THREADS     5
      #define STACK_SIZE      32768

      static void a_thread( void *arglist )
      /***********************************/
      {
          while( HoldThreads ) {
              DosSleep( 1 );
          }
          printf( "Hi from thread %d\n", *_threadid );
          DosEnterCritSec();
          --NumThreads;
          DosExitCritSec();
          _endthread();
      }

      int main( void )
      /**************/
      {
          int         i;

          printf( "Initial thread id = %d\n", *_threadid );
          NumThreads = 0;
          HoldThreads = 1;
          /* initial thread counts as 1 */
          for( i = 2; i <= NUM_THREADS; ++i ) {
              if( _beginthread( a_thread, NULL, STACK_SIZE, NULL ) == -1 
)
              {
                  printf( "creation of thread %d failed\n", i );
              } else {
                  ++NumThreads;
              }
          }

          HoldThreads = 0;
          while( NumThreads != 0 ) {
              DosSleep( 1 );
          }
          return( 0 );
      }

Note:

  1.In the function a_thread, DosEnterCritSec and DosExitCritSec are 
called when we modify the variable NumThreads.  This ensures that the 
action of extracting the value of NumThreads from memory, incrementing 
the value, and storing the new result into memory, occurs without 
interruption.  If these functions were not called, it would be possible 
for two threads to extract the value of NumThreads from memory before an 
update occurred.

Let us assume that the file mthread.c contains the above example. 
Before compiling the file, make sure that the WATCOM environment 
variable is set to the directory in which you installed Open Watcom 
C/C++.  Also, the INCLUDE environment variable must include the 
\watcom\h\os2 and \watcom\h directories ("\WATCOM" is the directory in 
which Open Watcom C/C++ was installed).

We can now compile and link the application by issuing the following 
command.


      [C:\]wcl386 -bt=os2 -bm -l=os2v2 mthread

The "bm" option must be specified since we are creating a multi-threaded 
application.  If your multi-threaded application contains more than one 
module, each module must be compiled using the "bm" switch.

The "l" option specifies the target system for which the application is 
to be linked.  The system name os2v2 is defined in the file wlsystem.lnk 
which is located in the "BINW" subdirectory of the directory in which 
you installed Open Watcom C/C++.

The multi-threaded application is now ready to be run.

From harbour.01 at syenar.hu  Mon Nov 10 05:43:45 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 05:43:53 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
Message-ID: <BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>

Hi Toninho,

Could you post the details of your Harbour build
switches and C compiler type/version, Harbour revision?
Did you do your tests in MT or ST mode?

Maybe also Vista version/SP level, CPU type and
physical memory could also help.

Experience from Vista users would also be great to
hear.

Brgds,
Viktor

On 2008.11.10., at 12:03, Toninho@fwi wrote:

>>> In windows vista my tests display bad results if we use DL_ALLOC,
>>
>> Can you tell some more about this? What does
>> "bad results" mean? It'd be important to know about
>> such problems before we settle with our default.
>
> Hi Viktor, sorry for delay. I don?t have windows vista in my home, so
> I was waiting to do another test in my office.
>
> I did two posts here in the past, about this because I thought this
> issue important.
>
> In Windows Vista, my application doesn?t run smooth with dlalloc, it
> pauses with a short delay in some circunstancies.
>
> To reproduce this problem, run tests\memtst.prg. In last test with
> standard bcc memory manager memtst run smooth and fast, but with
> dlalloc it pause in each test.
>
> ---cut---
> a := {}
> for i := 1 to N_LOOPS
>   aadd( a, {} )
>   if i%1000 == 0
>      ?? i
>   endif
> next
> ---cut---
>
> With windowsXP both MM works fine.
>
>
> Regards,
>
> Toninho.
>
> __________________________________________________
> Fa?a liga??es para outros computadores com o novo Yahoo! Messenger
> http://br.beta.messenger.yahoo.com/
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Nov 10 05:59:27 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 05:59:47 2008
Subject: [Harbour] Printer list
In-Reply-To: <4917A5EB.10608@ec-red.com>
References: <4917A5EB.10608@ec-red.com>
Message-ID: <7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>

Hi,

Check GETPRINTERS() in hbwin.lib.

Brgds,
Viktor

On 2008.11.10., at 4:09, Guillermo Varona Silup? wrote:

> Hi
> Is there any role that I return the printer list (names and ports  
> they use)?
> and the default printer
>
> I use: WinXP SP3 + Harbour + MinGW
>
> Best Regards.
>
> GVS
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From toninhofwi at yahoo.com.br  Mon Nov 10 07:04:27 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Mon Nov 10 06:01:07 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
Message-ID: <n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>

>Could you post the details of your Harbour build
>switches and C compiler type/version, Harbour revision?
>Did you do your tests in MT or ST mode?

---cut---
SET C_USR=-DHB_GUI -DHB_FM_STATISTICS_OFF -DHB_NO_PROFILER
-DADS_LIB_VERSION=700 -DHB_HASH_MSG_ITEMS -DHB_FM_STD_ALLOC
-DHB_NO_DEBUG
---cut---

---cut bcc32.cfg---
-IE:\bcc55\include;E:\bcc55\include\dinkumware
-LE:\bcc55\lib
-O2
-d
-5
-6
-a8
-WC
-w-inl-
---cut bcc32.cfg---

Path is called bcc55, but I?m using bcc6.10.


To compile test\memtst.prg I set:

---cut---
set HB_ARCHITECTURE=w32
set HB_COMPILER=bcc32
rem set HB_USER_LIBS=rddads.lib,ace32.li
set HB_BIN_INSTALL=e:\harbour\bin\b32
set HB_LIB_INSTALL=e:\harbour\lib\b32
set HB_INC_INSTALL=e:\harbour\include
COPY e:\bcc32.cfg e:\harbour\tests
---cut---

and call from tests dir: 

..\bin\hbmk memtst


>Maybe also Vista version/SP level, CPU type and
>physical memory could also help.
Windows Vista Ultimate, Intel Pentium 4 CPU 3.06 GHz, RAM 1Mb

>Experience from Vista users would also be great to
>hear.
With the same environment and Windows XP I see no problem with dlalloc


Best regards,

Toninho.

__________________________________________________
Fa?a liga??es para outros computadores com o novo Yahoo! Messenger 
http://br.beta.messenger.yahoo.com/ 
From harbour.01 at syenar.hu  Mon Nov 10 06:29:02 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 06:29:11 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081106172214.GA9967@34-mo7-2.acn.waw.pl>
References: <0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>
	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
	<491315D1.7030303@dbtopas.lt>
	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
	<20081106172214.GA9967@34-mo7-2.acn.waw.pl>
Message-ID: <73053F79-CFDE-4E5C-A7A7-5CA21E5131DE@syenar.hu>

Hi Przemek,

> Probably some RT errors from function call should be eliminated
> for flexible usage. I never though about this problem so far
> and when I was adding hashes to harbour I simply replicated
> most of RT errors which exists in xHarbour.

What I've suspected.

>> You've just accepted autoadd in assign because you have quite nice
> example of these feature used for i18n translation tables and so
> far you haven't created any code which can benefit from autoadd
> in access and you still think about hash items like like about some
> type of static storage.
> This feature is usable when hash is used as backed to collect some
> results.
> F.e. I want to collect information about quantity of articles sold:

Thanks for these hashing examples. In this sense they are
basically a small in-memory database table with a unique key.

Nice!

>> does not exists in the hash array. F.e. In the 1-st report above
> I may want to group some type of articles together and rest
> present individually. With this feature it's enough to change
> the line with:
>      hReport[ FIELD->ARTICLE ] += FIELD->QUANTITY
> to:
>      hReport[ hGroups[ FIELD->ARTICLE ] ] += FIELD->QUANTITY
> but I can also use:
>      hReport[ hb_hKey( hGroups, FIELD->ARTICLE ) ] += FIELD->QUANTITY
> Instead of adding new attribute to hashes.

This is a bit mind bending at first, but I get the idea :)
More elegant / compact than using arrays, for sure.

>>
> It cannot because NIL is also valid hash item value so it will
> not be usable in all cases. But of course it does not mean that
> we cannot remove RT error from hb_hGet() and document it as expected
> behavior. If someone prefers functions call instead of faster h[key]
> then probably he has some special reasons for this. One of such reason
> can be missing RT error.

Experienced hash users should say the final word.

[ As a non-experienced one, I'd vote to drop similar
RTEs from functions. ]

>> xhb compatibility is not a concern BTW, because it uses
>> different function names anyway.
>
> Because you asked to translate most of them. At the beginning
> this implementation was using xHarbour compatible API. Anyhow
> I do not think we have to be strictly compatible with RTE in
> such functions.

It was not a complaint. Renaming has a nice side effect that
Harbour functionality is easy to detach from any xhb
heritage (meaning we're not restricted by xhb). If we happen
to bend any hash functions too far, we can just add the old
version to xhb.lib with the fully compliant functionality
and without any extra mapping tricks. xhb users should decide
what counts as "too far", and they'll most probably let us know.

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Mon Nov 10 07:17:42 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Nov 10 07:17:45 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <73053F79-CFDE-4E5C-A7A7-5CA21E5131DE@syenar.hu>
References: <0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
	<491315D1.7030303@dbtopas.lt>
	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
	<20081106172214.GA9967@34-mo7-2.acn.waw.pl>
	<73053F79-CFDE-4E5C-A7A7-5CA21E5131DE@syenar.hu>
Message-ID: <9257026e0811100417h48e2e313u9dbacf17e1905943@mail.gmail.com>

On Mon, Nov 10, 2008 at 12:29 PM, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> Experienced hash users should say the final word.

We use hashes extensively and the RTE is useful to avoid mispelled
keys exactly like arrays gets RTE if accessed out of bounds.

When it's expected we use:

#xtranslate GETKEYORDEFAULT( <h>, <k>, <v> ) => iif( hHasKey( <h>, <k>
), hGet( <h>, <k> ), <v> )

or

#xtranslate GETKEYOREMPTY( <h>, <k> ) => iif( hHasKey( <h>, <k> ),
hGet( <h>, <k> ), "" )

best regards,
Lorenzo
From druzus at acn.waw.pl  Mon Nov 10 08:09:34 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 08:08:40 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4917C4DB.2000502@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4917C4DB.2000502@mail.udg.mx>
Message-ID: <20081110130934.GA27840@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Good question but I am not tested that
> What I say is: using gtos2, at least in these tests, screen/output is not 
> refreshed and tracing labels existent in body of fuction where error happen 
> are not shown
> You will see more samples below

So it's general problem with accessing console from other threads.

> >>       if( kbhit() )
> >>          ch = getch();
> >Probably kbhit() internally call KbdCharIn() and it's exactly
> >the same problem.
> Maybe

To be precise it's KbdPeek() and kbhit() is probably simple wrapper to it.
It means that OW internals are also effected by this problem.
The question is if it can be resolved or not. Is it OW bug or problem
with OS2 API. In GCC it seems to be resolved. The question is how.

> >If possible then I would like to check if other GTOS2 functions works
> >correctly for 2-nd thread and the problem is only with KbdCharIn().
> >F.e. try mttest02.prg with such modified GTOS2 so we can see if screen
> >output works.
> I was trying with mttest02.prg and we got many results
> Note: I am not testing if "screen output works" with 2nd thread but entire 
> execution of program
> For now we have in gtos2.c
>    /*   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk ); */

[...]

Please also disable mouse polling and comment this code:
   if( ch == 0 )
      ch = HB_GTSELF_MOUSEREADKEY( pGT, iEventMask );

> As you see in this and other cases, fail within hb_gt_os2_mouse_GetPos() 
> but screen/output is not refreshed to show at least
>    printf("1. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
>    printf("2. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
> This behaviour confuse us because last info seem to be fail in the calling 
> function, while fail occur in called function which does not refressh their 
> own printf( )
> I do not know if this is a normal behaviour for printf( )

It does not have to be printf() behavior. 1-st it's always better to
redirect output to file to eliminate possible overwriting. The
second problem can be caused by possible compile time optimizations
which can change the order of executed instructions. In such case is
always good to pass to printf() some pointers to variables which are
used in function you want to trace to disable such optimization.
It's the reason why I added s_key pointer to "0. hb_gt_os2_ReadKey(%p)"
though in this case seems that it wasn't help though I'm not sure
you replicated it.

> As summary there are problems in "reading devices" except for thread 1
> Now we have catched at least three points which cause fails:
>   KbdCharIn( )
>   MouReadEventQue( )
>   MouGetPtrPos( )
> and they are NOT Harbour functions/procedures

Many thanks for detail tests. We know the problem and now we will have
to find workaround for it. We can make it in simple way and disable
input for non main thread. BTW can you check if keyboard input works
correctly in GCC builds for all threads, f.e. inm code like:

   proc main()
   hb_threadJoin( hb_threadStart( @thFunc() ) )
   return
   proc thFunc()
   local k
      while (k:=inkey(0)) != 27
         ? k
      enddo
   return

OS2 KBD API has functions KbdGetFocus() and KbdFreeFocus(). It's possible
that they will resolve the problem for keyboard input.
Finally we can simply check in GCC source what exactly it does to resolve
the problem. Seeing Maurilio comment in gtos2.c I guess that GCC for OS2
has its own KbdCharIn() instead of direct mapping:
   #define KbdCharIn          KBD16CHARIN
and inside this function the problem is resolved. But I only guess.
I haven't ever seen this compiler.
For someone who has some experience with OS2 API the problem should
be easy to resolve or find workaround or give us an answer if it can work.

> As you see, I was changing C code myself  :-)

With very good results. Many thanks for your help.

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov 10 08:31:53 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 08:30:59 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <9257026e0811100417h48e2e313u9dbacf17e1905943@mail.gmail.com>
References: <20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
	<491315D1.7030303@dbtopas.lt>
	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
	<20081106172214.GA9967@34-mo7-2.acn.waw.pl>
	<73053F79-CFDE-4E5C-A7A7-5CA21E5131DE@syenar.hu>
	<9257026e0811100417h48e2e313u9dbacf17e1905943@mail.gmail.com>
Message-ID: <20081110133153.GA21486@34-mo7-2.acn.waw.pl>

On Mon, 10 Nov 2008, Lorenzo Fiorini wrote:

Hi Lorenzo,

> On Mon, Nov 10, 2008 at 12:29 PM, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
> > Experienced hash users should say the final word.
> We use hashes extensively and the RTE is useful to avoid mispelled
> keys exactly like arrays gets RTE if accessed out of bounds.
> When it's expected we use:
> #xtranslate GETKEYORDEFAULT( <h>, <k>, <v> ) => iif( hHasKey( <h>, <k>
> ), hGet( <h>, <k> ), <v> )
> or
> #xtranslate GETKEYOREMPTY( <h>, <k> ) => iif( hHasKey( <h>, <k> ),
> hGet( <h>, <k> ), "" )

To avoid confusion.
In practice we are talking about two functions where we can remove
RT errors: hb_hGet() and hb_hDel(). We do not want to touch RT errors
in direct hash access. Removing RT errors from hb_hDel() will make their
behavior similar to aDel() function which does not generate RT error
in code like aDel( {}, 2 ). With hb_hGet() it's a problem with returning
value when key does not exists because hash can hold any values.
So we can leave it as is and reduce the problem to:
   hb_hDel( {=>}, "key" )
Should it generate RT error or not.

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov 10 08:38:00 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 08:37:05 2008
Subject: [Harbour] hb* scripts and dylibs path under Mac OS X
In-Reply-To: <9257026e0811050346p79edf97cn5444e7581038f5eb@mail.gmail.com>
References: <9257026e0811050346p79edf97cn5444e7581038f5eb@mail.gmail.com>
Message-ID: <20081110133800.GB21486@34-mo7-2.acn.waw.pl>

On Wed, 05 Nov 2008, Lorenzo Fiorini wrote:

Hi Lorenzo,

> I use standard gnu makefiles with hb* scripts but under Mac OS X I
> can't find the right way to shared executables.
> Everything gets built correctly using the same makefiles I use under
> Win and Lin but at runtime the executable looks for libmylib.0.dylib
> while my lib is libmylib.dylib.
> If I change it using install_name_tool I can get it working but it's
> not the best way.
> Could it be that we need sth different in the hb-mkslib for darwin?
> Any idea?

In hb-mkslib.sh we have:

    FULLNAME="${BASE}.${VERSION}${SLIB_EXT}"
    ${CCPREFIX}libtool -dynamic -install_name "${BASE}.${MAJOR}${SLIB_EXT}" \
        -compatibility_version ${MAJOR}.${MINOR} -current_version ${VERSION} \
        -flat_namespace -undefined warning -multiply_defined suppress -single_module \
        -o "${DSTDIR}/${FULLNAME}" "$@" && \
    ln -sf "${FULLNAME}" "${DSTDIR}${BASE}.${MAJOR}${SLIB_EXT}" && \
    ln -sf "${FULLNAME}" "${DSTDIR}${BASE}${SLIB_EXT}"

change -install_name parameter to:
    ${CCPREFIX}libtool -dynamic -install_name "${BASE}${SLIB_EXT}" \

Check if everything works correctly. If yes then please commit it.

best regards,
Przemek
From druzus at acn.waw.pl  Mon Nov 10 08:41:46 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 08:40:51 2008
Subject: [Harbour] 2008-11-10 14:41 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081110134146.GA14360@34-mo7-2.acn.waw.pl>

2008-11-10 14:41 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbapi.h
  * harbour/source/common/hbstr.c
    + added hb_numToStr()

  * harbour/source/vm/estack.c
  * harbour/source/compiler/genc.c
  * harbour/source/compiler/gencc.c
    * use hb_numToStr() for integer number conversions

  * harbour/source/vm/dlmalloc.c
    * disable #pragma warning ... in MinGW builds. If some newer MinGW
      versions support it and it's useful then it can be enabled after
      checking MinGW version

best regards
Przemek
From maurilio.longo at libero.it  Mon Nov 10 08:50:34 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Mon Nov 10 08:50:41 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4917C4DB.2000502@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4917C4DB.2000502@mail.udg.mx>
Message-ID: <49183C2A.9080503@libero.it>

David, Przemyslaw,

I'm sorry, I was not monitoring this list lately because of lack of spare
time, anyway, can I do to help?

It seems you did focus on mouse code, I've never dealt with it, but I'd say it
has to do with openwatcom, because with GCC mttest*.* work ok.

If I'm not wrong, openwatcom development, at least for os/2, has been stopped.
Why are you trying to use it?

Maurilio.

David Arturo Macias Corona wrote:
>>> is executed but screen is not refreshed with tracing labels on it
>>> I was catching and error DISAPPEAR applying in hb_gt_os2_ReadKey():
>>>    /*   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk ); */
>>> As you said, fail reading keyboard input except thread 1  :-)
> 
>>we will have to find why it happens. Maybe Maurilio can help.
> 
> Maurilio, help !
> 
>>> ... and screen/output is not updated ?
> 
>>??? I do not understand. Do you want to say that only 1-st thread can
>>display data on the screen?
> 
> Good question but I am not tested that
> 
> What I say is: using gtos2, at least in these tests, screen/output is
> not refreshed and tracing labels existent in body of fuction where error
> happen are not shown
> You will see more samples below
> 
>>>       if( kbhit() )
>>>          ch = getch();
> 
>>Probably kbhit() internally call KbdCharIn() and it's exactly
>>the same problem.
> Maybe
> 
>>If possible then I would like to check if other GTOS2 functions works
>>correctly for 2-nd thread and the problem is only with KbdCharIn().
>>F.e. try mttest02.prg with such modified GTOS2 so we can see if screen
>>output works.
> 
> I was trying with mttest02.prg and we got many results
> Note: I am not testing if "screen output works" with 2nd thread but
> entire execution of program
> 
> For now we have in gtos2.c
>    /*   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk ); */
> 
> and mttest02.exe results:
> ----------------
> 1. hb_gt_def_InkeyPollDo()
> 0. hb_gt_os2_ReadKey()
> 1. hb_gt_os2_ReadKey()
> 2. hb_gt_os2_ReadKey()
> 3. hb_gt_os2_ReadKey()
> 4. hb_gt_os2_ReadKey()
> 1. hb_gt_def_MouseReadKey()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> ----------------
> 
> Using replacement for HB_GTSELF_MOUSEISPRESENT( pGT ):
> 
>    printf("1. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
>    /* if( HB_GTSELF_MOUSEISPRESENT( pGT ) ) */
>    if( hb_gt_def_MouseIsPresent( pGT ) )
> 
> and mttest02.exe results:
> ----------------
> 4. hb_gt_os2_ReadKey()
> 1. hb_gt_def_MouseReadKey()
> 10. hb_gt_def_MouseReadKey()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> ----------------
> 
> so error happen trying HB_GTSELF_MOUSEISPRESENT( pGT )
> 
> Using
>    printf("1. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
>    if( HB_GTSELF_MOUSEISPRESENT( pGT ) )
>    /* if( hb_gt_def_MouseIsPresent( pGT ) ) */
> 
> and
> 
> static BOOL hb_gt_os2_mouse_IsPresent( PHB_GT pGT )
> {
>    printf("1. hb_gt_os2_mouse_IsPresent()\r\n");fflush(stdout);
>    HB_SYMBOL_UNUSED( pGT );
>    printf("2. hb_gt_os2_mouse_IsPresent()\r\n");fflush(stdout);
>    return s_uMouHandle != 0;
> }
> 
> and mttest02.exe results:
> ----------------
> 4. hb_gt_os2_ReadKey()
> 1. hb_gt_def_MouseReadKey()
> 1. hb_gt_os2_mouse_IsPresent()
> 2. hb_gt_os2_mouse_IsPresent()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> ----------------
> 
> so hb_gt_os2_mouse_IsPresent( ) is working fine
> 
> Using in hb_gt_def_MouseReadKey( )
> 
>       /* if( iEventMask & INKEY_LDOWN && HB_GTSELF_MOUSEBUTTONPRESSED(
> pGT, 0, &iRow, &iCol ) ) */
>       if( iEventMask & INKEY_LDOWN && hb_gt_def_MouseButtonPressed( pGT,
> 0, &iRow, &iCol ) )
> 
> and mttest02.exe results:
> ----------------
> 1. hb_gt_os2_mouse_IsPresent()
> 2. hb_gt_os2_mouse_IsPresent()
> 8. hb_gt_def_MouseReadKey()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> ----------------
> 
> which belong to:
> 
>          printf("8. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
>          HB_GTSELF_MOUSEGETPOS( pGT, &iRow, &iCol );
>          printf("9. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
> 
> and HB_GTSELF_MOUSEGETPOS() should be checked later and is pending
> 
> Reusing:
>       /* if( iEventMask & INKEY_LDOWN && hb_gt_def_MouseButtonPressed(
> pGT, 0, &iRow, &iCol ) ) */
>       if( iEventMask & INKEY_LDOWN && HB_GTSELF_MOUSEBUTTONPRESSED( pGT,
> 0, &iRow, &iCol ) )
> 
> 
> and
> 
> 
> static BOOL hb_gt_os2_mouse_ButtonPressed( PHB_GT pGT, int iButton, int
> * piRow, int * piCol )
> {
>    HB_SYMBOL_UNUSED( pGT );
>    printf("1. hb_gt_os2_mouse_ButtonPressed()\r\n");fflush(stdout);
>    hb_gt_os2_mouse_ReadMouseState();
>    printf("2. hb_gt_os2_mouse_ButtonPressed()\r\n");fflush(stdout);
> 
> and mttest02.exe results:
> ----------------
> 4. hb_gt_os2_ReadKey()
> 1. hb_gt_def_MouseReadKey()
> 1. hb_gt_os2_mouse_IsPresent()
> 2. hb_gt_os2_mouse_IsPresent()
> 1. hb_gt_os2_mouse_ButtonPressed()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> ................
> 
> and using a trick to ignore MouReadEventQue( )
> 
>    printf("1. hb_gt_os2_mouse_ReadMouseState()\r\n");fflush(stdout);
>    if( s_uMouHandle )
>    {
>       USHORT WaitOption = 0;  /* 1 = wait until mouse event exist, 0 =
> don't */
>       MOUEVENTINFO MouEvent;
>       printf("2. hb_gt_os2_mouse_ReadMouseState()\r\n");fflush(stdout);
> /*
>       if( MouReadEventQue( &MouEvent, &WaitOption, s_uMouHandle ) ==
> NO_ERROR )
>       {
> */
>       if( s_ButtonState[ 1 ].fDown )
>       {
> 
> and mttest02.exe results:
> ----------------
> 1. hb_gt_def_MouseReadKey()
> 1. hb_gt_os2_mouse_IsPresent()
> 2. hb_gt_os2_mouse_IsPresent()
> 1. hb_gt_os2_mouse_ButtonPressed()
> 1. hb_gt_os2_mouse_ReadMouseState()
> 2. hb_gt_os2_mouse_ReadMouseState()
> 3. hb_gt_os2_mouse_ReadMouseState()
> 4. hb_gt_os2_mouse_ReadMouseState()
> 2. hb_gt_os2_mouse_ButtonPressed()
> 8. hb_gt_def_MouseReadKey()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> ...............
> 
> As we see it fail with MouReadEventQue() and dows not fail without it
> 
> This lead us to the pending:
> 
>          printf("8. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
>          HB_GTSELF_MOUSEGETPOS( pGT, &iRow, &iCol );
> 
> and using
> 
>          printf("8. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
> /*         HB_GTSELF_MOUSEGETPOS( pGT, &iRow, &iCol ); */
>          printf("9. hb_gt_def_MouseReadKey()\r\n");fflush(stdout);
> 
> does not fail
> So fail happen within
>          HB_GTSELF_MOUSEGETPOS( pGT, &iRow, &iCol );
> 
> and using:
> 
>    printf("1. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
>    if( s_uMouHandle )
>    {
>       PTRLOC pos;
>       printf("2. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
>       MouGetPtrPos( &pos, s_uMouHandle );
>       *row = ( int ) pos.row;
>       *col = ( int ) pos.col;
>       printf("3. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
>    }
> 
> and mttest02.exe results:
> ----------------
> 4. hb_gt_os2_mouse_ReadMouseState()
> 2. hb_gt_os2_mouse_ButtonPressed()
> 8. hb_gt_def_MouseReadKey()
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> ................
> 
> As you see in this and other cases, fail within hb_gt_os2_mouse_GetPos()
> but screen/output is not refreshed to show at least
>    printf("1. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
>    printf("2. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
> 
> This behaviour confuse us because last info seem to be fail in the
> calling function, while fail occur in called function which does not
> refressh their own printf( )
> I do not know if this is a normal behaviour for printf( )
> 
> Obviously using
> 
>       printf("2. hb_gt_os2_mouse_GetPos()\r\n");fflush(stdout);
>       /* MouGetPtrPos( &pos, s_uMouHandle ); */
> 
> everything work fine
> 
> 
> As summary there are problems in "reading devices" except for thread 1
> 
> Now we have catched at least three points which cause fails:
>   KbdCharIn( )
>   MouReadEventQue( )
>   MouGetPtrPos( )
> 
> and they are NOT Harbour functions/procedures
> 
> Except for calling, KbdCharIn reference exist only in:
> 
> --------------------
>  * $Id: gtkeycod.c 8193 2007-12-22 10:28:28Z druzus $
>  */
> 
> /*
>  * Harbour Project source code:
>  *    hb_gt_dos_keyCodeTranslate()
>  *          function used by DOS, WIN and OS2 ports of few GTs which use
>  *          getkey()/getch()/_read_kbd()/KbdCharIn() or similar function
>  *          for keyboard input
>  *    based on hb_gt_ReadKey() from GTDOS code by:
>  *          Copyright 1999 David G. Holm <dholm@jsd-llc.com>
> --------------------
> 
> 
> so KbdCharIn( ), MouReadEventQue( ), MouGetPtrPos( ) should belong to C
> compiler or OS/2
> 
> 
> \watcom\h\os2\bsesub.h show for KbdCharIn:
> 
> /*
>  *  bsesub.h    OS/2 Base subsystems include file for 32-bit development.
> 
> #define KbdCharIn        KBD16CHARIN
> #define KR_KBDCHARIN       0x0001
> USHORT APIENTRY16 KbdCharIn(PKBDKEYINFO,USHORT,HKBD);
> 
> 
> and for MouReadEventQue
> 
> #define MouReadEventQue    MOU16READEVENTQUE
> #define MR_MOUREADEVENTQUE  0x00000010
> USHORT APIENTRY16 MouReadEventQue(PMOUEVENTINFO,PUSHORT,HMOU);
> 
> 
> and for MouGetPtrPos
> 
> #define MouGetPtrPos       MOU16GETPTRPOS
> #define MR_MOUGETPTRPOS     0x00020000
> USHORT APIENTRY16 MouGetPtrPos(PPTRLOC,HMOU);
> 
> 
> KBD16CHARIN exist only in:
> #define Kbd16CharIn      KBD16CHARIN
> #define KbdCharIn        KBD16CHARIN
> 
>  \watcom\lib386\os2\clib3r.lib
>  \watcom\lib386\os2\clib3s.lib
>  \watcom\lib386\os2\os2386.lib
> 
> 
> and in \watcom\h\os21x\bsesub.h show for KbdCharIn:
> 
> /*
>  *  bsesub.h    OS/2 Base subsystems include file for 16-bit development.
> 
> #define KR_KBDCHARIN       0x00000001
> USHORT APIENTRY KbdCharIn(PKBDKEYINFO CharData, USHORT IOWait, HKBD
> KbdHandle);
> 
> I suppose that os21x is for OS/2 1.x
> 
> 
> and for gcc335 we have
> 
> \usr\include\os2emx.h
> 
> /* os2emx.h,v 1.19 2004/09/14 22:27:35 bird Exp */
> 
> #define KR_KBDCHARIN            0x00000001
> USHORT APIENTRY KbdCharIn (PKBDKEYINFO pkbci, USHORT fWait, HKBD hkbd);
> 
> #define MR_MOUREADEVENTQUE        0x00000010
> USHORT APIENTRY MouReadEventQue (PMOUEVENTINFO pmouevEvent, PUSHORT
> pfWait, HMOU hmou);
> 
> #define MR_MOUGETPTRPOS            0x00020000
> USHORT APIENTRY MouGetPtrPos (PPTRLOC pmouLoc, HMOU hmou);
> 
> 
> I do not know which differences exist between APIENTRY16 (OW) and
> APIENTRY (OW os21x, gcc335) but they show differences between C
> compilers where at last may reside problem with threads except thread 1
> 
> 
> As you see, I was changing C code myself  :-)
> 
> David Macias
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From druzus at acn.waw.pl  Mon Nov 10 09:07:39 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 09:06:44 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <204987F0-7862-43CB-9944-DF9ECB695167@syenar.hu>
References: <20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
	<20081109162631.GA4009@34-mo7-2.acn.waw.pl>
	<AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>
	<20081109172128.GA8360@34-mo7-2.acn.waw.pl>
	<490B6398-65B1-41D9-9C5F-9D9A9667EF3D@syenar.hu>
	<20081109180945.GA26350@34-mo7-2.acn.waw.pl>
	<204987F0-7862-43CB-9944-DF9ECB695167@syenar.hu>
Message-ID: <20081110140739.GA20375@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> I like the second one better, as it clears the ambiguity
> and even the requirement to use -n switch when someone
> defines MAIN(). So there would be one thing less to worry
> about. First choice however is more Clipper compatible,
> so IMO we should do it.

Please remember that current support for startup function
is a hack which works only with few C compilers and even
for them does not work correctly in all cases and we had
to add yet another hack: -n1 switch which disable it for
DLLs because DLL functions where registered before normal
functions and 1-st dll function was used as startup one.
Now we have two different behaviors which may cause portability
problems for Harbour code and this is probably even bigger
problem then strict Clipper compatibility.
This problem cannot be resolved at compile time. To make it
well we need linker wrapper which will extract first Harbour
function from linked modules and mark it as startup one.
I added such functionality to hb* scripts and this is the
only one method which works in all conditions and does not
dependent on the order of init code execution.
Anyhow it works only for GCC. For backward compatibility
with older Harbour code I gave main() higher priority then
1-st linked function but it can be removed. This feature
exists for many years and works well. So far no one reported
that it's a problem. I think it should be default for all
platforms/C compilers.
BTW If we want to keep -n1 then it should be changed to -n2
and simply -n1 should be the same as -n and -n0 should work
like -n- to make it compatible with other switches.

best regards,
Przemek
From dbtopas at dbtopas.lt  Mon Nov 10 09:06:50 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Nov 10 09:08:52 2008
Subject: [Harbour] Bug: :__enumKey context is lost for codeblocks
Message-ID: <49183FFA.1040809@dbtopas.lt>

Hi,

PROC main()
LOCAL aCountry, aI
    aCountry := {"LTU"=>"Lithuania", "ZWE"=>"Zimbabwe"}
    FOR EACH aI in aCountry
      QOUT(aI:__enumKey)              // OK
      EVAL({|| QOUT(aI:__enumKey)})   // RTE
    NEXT
RETURN

Best regards,
Mindaugas
From harbour.01 at syenar.hu  Mon Nov 10 09:13:53 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 09:14:03 2008
Subject: [Harbour] 2008-11-09 14:29 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20081110140739.GA20375@34-mo7-2.acn.waw.pl>
References: <20081109141112.GA16174@34-mo7-2.acn.waw.pl>
	<A2E91D0E-74D7-4F9A-86CF-FC38446730A6@syenar.hu>
	<20081109152915.GC13007@34-mo7-2.acn.waw.pl>
	<4118032D-9CF8-4B37-A0B3-D78AEA555516@syenar.hu>
	<20081109162631.GA4009@34-mo7-2.acn.waw.pl>
	<AE11803A-3B5B-4B65-A474-8549F30D6B40@syenar.hu>
	<20081109172128.GA8360@34-mo7-2.acn.waw.pl>
	<490B6398-65B1-41D9-9C5F-9D9A9667EF3D@syenar.hu>
	<20081109180945.GA26350@34-mo7-2.acn.waw.pl>
	<204987F0-7862-43CB-9944-DF9ECB695167@syenar.hu>
	<20081110140739.GA20375@34-mo7-2.acn.waw.pl>
Message-ID: <A2626828-3026-4AAB-BC98-81730612CEAC@syenar.hu>

Hi Przemek,

>> I like the second one better, as it clears the ambiguity
>> and even the requirement to use -n switch when someone
>> defines MAIN(). So there would be one thing less to worry
>> about. First choice however is more Clipper compatible,
>> so IMO we should do it.
>
> Please remember that current support for startup function
> is a hack which works only with few C compilers and even
> for them does not work correctly in all cases and we had
> to add yet another hack: -n1 switch which disable it for
> DLLs because DLL functions where registered before normal
> functions and 1-st dll function was used as startup one.
> Now we have two different behaviors which may cause portability
> problems for Harbour code and this is probably even bigger
> problem then strict Clipper compatibility.

Yes, I've even got such support question privately :(

> This problem cannot be resolved at compile time. To make it
> well we need linker wrapper which will extract first Harbour
> function from linked modules and mark it as startup one.
> I added such functionality to hb* scripts and this is the
> only one method which works in all conditions and does not
> dependent on the order of init code execution.
> Anyhow it works only for GCC. For backward compatibility
> with older Harbour code I gave main() higher priority then
> 1-st linked function but it can be removed. This feature
> exists for many years and works well. So far no one reported
> that it's a problem. I think it should be default for all
> platforms/C compilers.

Okay with me. Any solution which closes platform,
compiler, build-system differences is superior. It
would be also nice to remove the hb* script hack if
possible.

[ Some developers seem to use _APPMAIN() as an entry
point probably to achieve that. ]

> BTW If we want to keep -n1 then it should be changed to -n2
> and simply -n1 should be the same as -n and -n0 should work
> like -n- to make it compatible with other switches.

No, if possible let's please remove -n1 and keep only -n/-n-.

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 09:19:06 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 09:19:10 2008
Subject: [Harbour] 2008-11-10 15:17 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9433f$Blat.v2.6.2$4a4ea72c$10788015295c@127.0.0.1>

2008-11-10 15:17 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * contrib/hbcurl/common.mak
  * contrib/hbcurl/Makefile
  * contrib/hbcurl/hbcurl.c
  + contrib/hbcurl/hbcurlm.c
    + Some disabled (not mainstream) functions moved to 
      a separate file.

  * contrib/hbwin/win_prn2.c
    * Minor fix in comment.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 09:26:45 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 09:26:52 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
	<n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
Message-ID: <95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>

Thanks Toninho.

You could further help by sending speedtst and
memtst results for both DLALLOC and STDALLOC
builds, run on Vista and XP.

As a last resort we may want to disable DLALLOC
for BCC >= 6.0 if this seems to be best from the
results.

Brgds,
Viktor

On 2008.11.10., at 13:04, Toninho@fwi wrote:

>> Could you post the details of your Harbour build
>> switches and C compiler type/version, Harbour revision?
>> Did you do your tests in MT or ST mode?
>
> ---cut---
> SET C_USR=-DHB_GUI -DHB_FM_STATISTICS_OFF -DHB_NO_PROFILER
> -DADS_LIB_VERSION=700 -DHB_HASH_MSG_ITEMS -DHB_FM_STD_ALLOC
> -DHB_NO_DEBUG
> ---cut---
>
> ---cut bcc32.cfg---
> -IE:\bcc55\include;E:\bcc55\include\dinkumware
> -LE:\bcc55\lib
> -O2
> -d
> -5
> -6
> -a8
> -WC
> -w-inl-
> ---cut bcc32.cfg---
>
> Path is called bcc55, but I?m using bcc6.10.
>
>
> To compile test\memtst.prg I set:
>
> ---cut---
> set HB_ARCHITECTURE=w32
> set HB_COMPILER=bcc32
> rem set HB_USER_LIBS=rddads.lib,ace32.li
> set HB_BIN_INSTALL=e:\harbour\bin\b32
> set HB_LIB_INSTALL=e:\harbour\lib\b32
> set HB_INC_INSTALL=e:\harbour\include
> COPY e:\bcc32.cfg e:\harbour\tests
> ---cut---
>
> and call from tests dir:
>
> ..\bin\hbmk memtst
>
>
>> Maybe also Vista version/SP level, CPU type and
>> physical memory could also help.
> Windows Vista Ultimate, Intel Pentium 4 CPU 3.06 GHz, RAM 1Mb
>
>> Experience from Vista users would also be great to
>> hear.
> With the same environment and Windows XP I see no problem with dlalloc
>
>
> Best regards,
>
> Toninho.
>
> __________________________________________________
> Fa?a liga??es para outros computadores com o novo Yahoo! Messenger
> http://br.beta.messenger.yahoo.com/
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at acn.waw.pl  Mon Nov 10 10:04:35 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 10:03:40 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49183C2A.9080503@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4917C4DB.2000502@mail.udg.mx> <49183C2A.9080503@libero.it>
Message-ID: <20081110150435.GA30209@34-mo7-2.acn.waw.pl>

On Mon, 10 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> It seems you did focus on mouse code, I've never dealt with it, but I'd say it
> has to do with openwatcom, because with GCC mttest*.* work ok.

To be precise the problem is with any console input and it's inside pure
OS2 API functions. It means that we probably using them in wrong way.
It may works for GCC because it may use some wrappers which resolve the
problem or hide it. I would be good to find what exactly it does because
it's a risk that the problem will be exploited also in some GCC builds.
First we should check keyboard input and disable mouse code. It should
give some answers which probably will also help to resolve problem with
mouse. We can easy disable mouse code for tests by removing:
   if( ch == 0 )
      ch = HB_GTSELF_MOUSEREADKEY( pGT, iEventMask );
from hb_gt_os2_ReadKey().
Now when 2-nd thread calls:

   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk );

it fails with internal error. In OW this call is directly translated by:

   #define KbdCharIn          KBD16CHARIN

inside bsesub.h.
Why does it fail?
Why we have s_hk which is only low memory block initialized to NULL?
This code efectively works like:
   KbdCharIn( s_key, IO_NOWAIT, NULL );
so why we have s_hk variable if it does nothing?
OS2 API contains KbdGetFocus() and KbdFreeFocus(). If we begin to use
them to protect  can it help us?

You left this comment in gtos2.c:
   #if defined(HB_OS_OS2_GCC)
      /* 25/03/2000 - maurilio.longo@libero.it
      OS/2 GCC hasn't got ToolKit headers available */
      #include <stdlib.h>
   #else
      #include <bsedos.h>
      #ifndef KBDTRF_EXTENDED_CODE
         #define KBDTRF_EXTENDED_CODE 0x02
      #endif
   #endif

It suggests me that in GCC builds KbdCharIn() is not directly translated
to KBD16CHARIN() but it's a wrapper function. Can you check its body and
what it exactly does? If the problem is not solved by some external setting
then the answer should be here.

> If I'm not wrong, openwatcom development, at least for os/2, has been stopped.

OS2 OW builds are still release. OW17a is the newest release.
AFAIK incoming 1.8 will also be released for OS2.

> Why are you trying to use it?

It allows to locate GCC only code and clean it.
It's C++ compiler so it allows to easy locate code which is not C++
compatible though here include G++ builds like in Linux should
also be solution.
It should allow to create cross binaries and I will want to add
support for it.
It should allow to make OS2 build test also for developers which
do not have OS2 what should greatly help us when we have to touch
code which is compiled conditionally only in OS2 builds.

best regards and many thanks for you help.
Przemek
From toninhofwi at yahoo.com.br  Mon Nov 10 11:10:32 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Mon Nov 10 10:07:11 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
	<n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
	<95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
Message-ID: <65ngh4hp4tvh855mq95gsjk6g6qq327aub@4ax.com>

>Thanks Toninho.
>
>You could further help by sending speedtst and
>memtst results for both DLALLOC and STDALLOC
>builds, run on Vista and XP.

Hi Viktor, thank you, but please, wait until tonight. In my home I
have windows XP. I?ll collect all results and post here.

Regards,

Toninho.

__________________________________________________
Fa?a liga??es para outros computadores com o novo Yahoo! Messenger 
http://br.beta.messenger.yahoo.com/ 
From druzus at acn.waw.pl  Mon Nov 10 10:17:44 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 10:16:49 2008
Subject: [Harbour] Bug: :__enumKey context is lost for codeblocks
In-Reply-To: <49183FFA.1040809@dbtopas.lt>
References: <49183FFA.1040809@dbtopas.lt>
Message-ID: <20081110151744.GB30209@34-mo7-2.acn.waw.pl>

On Mon, 10 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> PROC main()
> LOCAL aCountry, aI
>    aCountry := {"LTU"=>"Lithuania", "ZWE"=>"Zimbabwe"}
>    FOR EACH aI in aCountry
>      QOUT(aI:__enumKey)              // OK
>      EVAL({|| QOUT(aI:__enumKey)})   // RTE
>    NEXT
> RETURN

It's expected and correct behavior. Variables stored in codeblocks
are detached. During detaching enumerators becomes simple references
to iterated items which is not later changed.
It allows to create code like:

   proc main()
      local aCountry, aBlocks, aI, aB
      aCountry := {"LTU"=>"Lithuania", "ZWE"=>"Zimbabwe"}
      aBlocks := array( len( aCountry ) )
      FOR EACH aI, aB in aCountry, aBlocks
         aB := {|x| iif( pcount()==0, aI, aI := x ) }
      NEXT
      ? eval( aBlocks[ 1 ] )
      ? eval( aBlocks[ 1 ], "XXXXX" )
      ? eval( aBlocks[ 1 ] )
      ? eval( aBlocks[ 2 ] )
      ? eval( aBlocks[ 2 ], "YYYYY" )
      ? eval( aBlocks[ 2 ] )
   return

As you can see this code does not fail when codeblocks are
evaluated autside FOR EACH loop and in each codeblocks aI
referes to separated aCountry item which were valid when
codeblock was created.

best regards,
Przemek
From toninhofwi at yahoo.com.br  Mon Nov 10 11:35:07 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Mon Nov 10 10:31:46 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
	<n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
	<95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
Message-ID: <p7ogh4ds0ovjpjnes4prf89kt435sua6vk@4ax.com>

>As a last resort we may want to disable DLALLOC
>for BCC >= 6.0 if this seems to be best from the
>results.

Hi Viktor,

Here is the results for Windows Vista 6.0.6000. Strange that DL-Alloc
wins pratically in all parts except in last part of memtst. Maybe is
possible do an optmization in this process?  Why in memtst.prg we have
this warning: "Warning!!! some compilers may badly fail here"

memtst WITH DL

testing single large memory blocks allocation and freeing...
 CPU time:          0.84 sec.
real time:          0.84 sec.

testing many large memory blocks allocation and freeing...
 CPU time:          5.08 sec.
real time:          5.09 sec.

testing large memory block reallocation with intermediate
allocations...
Warning!!! some compilers may badly fail here      1000      2000
3000      4000      5000      6000      7000      8000      9000
10000     11000     12000     13000     14000     15000     16000
17000     18000     19000     20000     21000     22000     23000
24000     25000     26000     27000     28000     29000     30000
31000     32000     33000     34000     35000     36000     37000
38000     39000     40000     41000     42000     43000     44000
45000     46000     47000     48000     49000     50000     51000
52000     53000     54000     55000     56000     57000     58000
59000     60000     61000     62000     63000     64000     65000
66000     67000     68000     69000     70000     71000     72000
73000     74000     75000     76000     77000     78000     79000
80000     81000     82000     83000     84000     85000     86000
87000     88000     89000     90000     91000     92000     93000
94000     95000     96000     97000     98000     99000    100000
 CPU time:          5.27 sec.
real time:          5.30 sec.


memtst WITHOUT DL

testing single large memory blocks allocation and freeing...
 CPU time:          0.86 sec.
real time:          0.86 sec.

testing many large memory blocks allocation and freeing...
 CPU time:          8.36 sec.
real time:          8.36 sec.

testing large memory block reallocation with intermediate
allocations...
Warning!!! some compilers may badly fail here      1000      2000
3000      4000      5000      6000      7000      8000      9000
10000     11000     12000     13000     14000     15000     16000
17000     18000     19000     20000     21000     22000     23000
24000     25000     26000     27000     28000     29000     30000
31000     32000     33000     34000     35000     36000     37000
38000     39000     40000     41000     42000     43000     44000
45000     46000     47000     48000     49000     50000     51000
52000     53000     54000     55000     56000     57000     58000
59000     60000     61000     62000     63000     64000     65000
66000     67000     68000     69000     70000     71000     72000
73000     74000     75000     76000     77000     78000     79000
80000     81000     82000     83000     84000     85000     86000
87000     88000     89000     90000     91000     92000     93000
94000     95000     96000     97000     98000     99000    100000
 CPU time:          1.39 sec.
real time:          1.41 sec.



speedtst

11/10/08 13:15:19 Windows Vista 6.0.6000
Harbour 1.1.0dev (Rev. 9888) CodeGear C++ 6.1 (32-bit)
THREADS: 0
N_LOOPS: 1000000

.......................................................DLA ...WIN
[ T000: empty loop overhead ].........................0.09 ..0.09
=============================================
[ T001: x := L_C ]....................................0.13 ..0.13
[ T002: x := L_N ]....................................0.14 ..0.14
[ T003: x := L_D ]....................................0.13 ..0.11
[ T004: x := S_C ]....................................0.13 ..0.13
[ T005: x := S_N ]....................................0.22 ..0.14
[ T006: x := S_D ]....................................0.13 ..0.11
[ T007: x := M_C ]....................................0.14 ..0.13
[ T008: x := M_N ]....................................0.11 ..0.27
[ T009: x := M_D ]....................................0.11 ..0.13
[ T010: x := P_C ]....................................0.13 ..0.14
[ T011: x := P_N ]....................................0.14 ..0.11
[ T012: x := P_D ]....................................0.22 ..0.13
[ T013: x := F_C ]....................................0.48 ..0.69
[ T014: x := F_N ]....................................0.41 ..0.64
[ T015: x := F_D ]....................................0.19 ..0.27
[ T016: x := o:GenCode ]..............................0.39 ..0.36
[ T017: x := o[8] ]...................................0.25 ..0.44
[ T018: round( i / 1000, 2 ) ]........................0.45 ..0.50
[ T019: str( i / 1000 ) ].............................3.28 ..3.50
[ T020: val( s ) ]....................................0.45 ..0.45
[ T021: val( a [ i % 16 + 1 ] ) ].....................1.31 ..1.33
[ T022: dtos( d - i % 10000 ) ].......................0.94 ..1.14
[ T023: eval( { || i % 16 } ) ].......................0.63 ..0.98
[ T024: eval( bc := { || i % 16 } ) ].................0.44 ..0.45
[ T025: eval( { |x| x % 16 }, i ) ]...................0.50 ..0.69
[ T026: eval( bc := { |x| x % 16 }, i ) ].............0.42 ..0.44
[ T027: eval( { |x| f1( x ) }, i ) ]..................0.64 ..0.83
[ T028: eval( bc := { |x| f1( x ) }, i ) ]............0.58 ..0.56
[ T029: x := &( "f1(" + str(i) + ")" ) ]..............5.11 ..7.05
[ T030: bc := &( "{|x|f1(x)}" ); eval( bc, i ) ]......7.88 ..9.09
[ T031: x := valtype( x ) +  valtype( i ) ]...........0.64 ..0.88
[ T032: x := strzero( i % 100, 2 ) $ a[ i % 16 + 1 ]..2.95 ..3.23
[ T033: x := a[ i % 16 + 1 ] == s ]...................0.77 ..0.78
[ T034: x := a[ i % 16 + 1 ] = s ]....................0.80 ..0.83
[ T035: x := a[ i % 16 + 1 ] >= s ]...................0.81 ..0.81
[ T036: x := a[ i % 16 + 1 ] <= s ]...................0.80 ..0.81
[ T037: x := a[ i % 16 + 1 ] < s ]....................0.83 ..0.83
[ T038: x := a[ i % 16 + 1 ] > s ]....................0.80 ..0.81
[ T039: ascan( a, i % 16 ) ]..........................0.48 ..0.52
[ T040: ascan( a, { |x| x == i % 16 } ) ].............5.08 ..5.59
[ T041: if i%1000==0;a:={};end; aadd(a,{i,1,.T.,s,s2..2.00 ..3.58
[ T042: x := a ]......................................0.13 ..0.14
[ T043: x := {} ].....................................0.19 ..0.41
[ T044: f0() ]........................................0.16 ..0.13
[ T045: f1( i ) ].....................................0.25 ..0.25
[ T046: f2( c[1...8] ) ]..............................0.22 ..0.22
[ T047: f2( c[1...40000] ) ]..........................0.23 ..0.22
[ T048: f2( @c[1...40000] ) ].........................0.23 ..0.23
[ T049: f2( @c[1...40000] ), c2 := c ]................0.31 ..0.33
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]..........0.86 ..0.88
[ T051: f2( a ) ].....................................0.25 ..0.23
[ T052: x := f4() ]...................................1.19 ..1.28
[ T053: x := f5() ]...................................0.42 ..0.61
[ T054: f_prv( c ) ]..................................0.61 ..0.83
==========================================
[ total application time: ]..........................52.16 .60.55




Regards,

Toninho.


		
_______________________________________________________ 
Yahoo! Mail - Sempre a melhor opo para voc! 
Experimente j e veja as novidades. 
http://br.yahoo.com/mailbeta/tudonovo/
 

From gvarona at ec-red.com  Mon Nov 10 10:39:43 2008
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Mon Nov 10 10:39:47 2008
Subject: [Harbour] Printer list
In-Reply-To: <7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>
References: <4917A5EB.10608@ec-red.com>
	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>
Message-ID: <491855BF.3080503@ec-red.com>

Szak?ts Viktor escribi?:
> Hi,
> Check GETPRINTERS() in hbwin.lib.
Hi Viktor,

ENV: WinXP+Harbour from SVN+MinGW

I have this version of Harbor:
--------------------------------------------------------------
C:\HarbourMinGW\bin>harbour
Harbour 1.0.1dev Intl. (Rev. 9229)
Copyright (c) 1999-2008, http://www.harbour-project.org/
--------------------------------------------------------------
and here is not hbwin, What is equivalent to hbwin in this version?

Well, I've built a version from the current SVN and I get these messages:
--------------------------------------------------------------
D:\harbour>make_gnu
c:\mingw\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: 
cannot find -lhbmainstd
collect2: ld returned 1 exit status
make[3]: *** [hbrun.exe] Error 1
make[2]: *** [descend] Error 2
c:\mingw\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: 
cannot find -lhbmainstd
collect2: ld returned 1 exit status
make[3]: *** [hbtest.exe] Error 1
make[2]: *** [descend] Error 2
c:\mingw\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: 
cannot find -lhbmainstd
collect2: ld returned 1 exit status
make[3]: *** [hbdoc.exe] Error 1
make[2]: *** [descend] Error 2
c:\mingw\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: 
cannot find -lhbmainstd
collect2: ld returned 1 exit status
make[3]: *** [hbmake.exe] Error 1
make[2]: *** [descend] Error 2
make[1]: *** [first] Error 2
D:\harbour>c:
--------------------------------------------------------------
What do these messages?
Can I use the build?
But if I generate in Harbour.exe and LIBS (including hbwin.a).

When compiling my PRG, which has only this:
--------------------------------------------------------------
function main ()
    aPrn: GETPRINTERS = ()
    wait
    RETURN NIL
--------------------------------------------------------------
I get these messages:
--------------------------------------------------------------
Proyecto: tst_CT, Entorno: H_SVN_MinGW:
[1]:Harbour.Exe tst_Prn.prg  /m /w0 /es2 /a /b /iC:\HRBSVN~1\Include 
/oObj\tst_Prn.c
Harbour 1.1.0dev (Rev. 9894)
Copyright (c) 1999-2008, http://www.harbour-project.org/
Compiling 'tst_Prn.prg'...
Lines 99, Functions/Procedures 2
Generating C source output to 'Obj\tst_Prn.c'... Done.
[1]:gcc.Exe -IC:\HRBSVN~1\Include -mno-cygwin -Wall -c tst_Prn.c -otst_Prn.o
[1]:gcc.Exe -otst_CT.Exe -Wall -mno-cygwin  -mconsole tst_CT.gcl
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x10f): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x171): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x1e6): 
undefined reference to `OpenPrinterA@12'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x1f8): 
undefined reference to `ClosePrinter@4'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x408): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x485): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x5c2): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x61b): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x813): 
undefined reference to `OpenPrinterA@12'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x867): 
undefined reference to `StartDocPrinterA@12'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x880): 
undefined reference to `StartPagePrinter@4'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x965): 
undefined reference to `WritePrinter@16'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x9a2): 
undefined reference to `EndPagePrinter@4'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x9bf): 
undefined reference to `EndDocPrinter@4'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x9dc): 
undefined reference to `ClosePrinter@4'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0xbf1): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0xc53): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0xd0c): 
undefined reference to `OpenPrinterA@12'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0xd41): 
undefined reference to `GetPrinterA@20'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0xdbb): 
undefined reference to `GetPrinterA@20'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0xf42): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0xfa4): 
undefined reference to `EnumPrintersA@28'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x1058): 
undefined reference to `OpenPrinterA@12'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x108d): 
undefined reference to `GetPrinterA@20'
C:\HrbSVNMinGW\Lib/libhbwin.a(win_prn2.o):win_prn2.c:(.text+0x1107): 
undefined reference to `GetPrinterA@20'
collect2: ld returned 1 exit status
--------------------------------------------------------------

Any help?

TIA

Best Regards
GVS
From druzus at acn.waw.pl  Mon Nov 10 10:58:02 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 10:57:06 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <p7ogh4ds0ovjpjnes4prf89kt435sua6vk@4ax.com>
References: <01c942a5$Blat.v2.6.2$b9f8f04a$db48dda8db2@127.0.0.1>
	<7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
	<n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
	<95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
	<p7ogh4ds0ovjpjnes4prf89kt435sua6vk@4ax.com>
Message-ID: <20081110155802.GA20136@34-mo7-2.acn.waw.pl>

On Mon, 10 Nov 2008, Toninho@fwi wrote:

Hi Toninho,

> Here is the results for Windows Vista 6.0.6000. Strange that DL-Alloc
> wins pratically in all parts except in last part of memtst. Maybe is
> possible do an optmization in this process?

You can make some experiments with DEFAULT_GRANULARITY, f.e.:
   set C_USR=-DDEFAULT_GRANULARITY=0x100000

there are also other settings like:
   set C_USR=-DDEFAULT_MMAP_THRESHOLD=0x100000
You can use them together.
Such switches are used to balance between memory usage and speed.
Make some tests and chose optimal values for your application.

> Why in memtst.prg we have
> this warning: "Warning!!! some compilers may badly fail here"

Try it with default BCC5.5 memory manager.

best regards,
Przemek
From dbtopas at dbtopas.lt  Mon Nov 10 11:19:43 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Nov 10 11:21:44 2008
Subject: [Harbour] Bug: :__enumKey context is lost for codeblocks
In-Reply-To: <20081110151744.GB30209@34-mo7-2.acn.waw.pl>
References: <49183FFA.1040809@dbtopas.lt>
	<20081110151744.GB30209@34-mo7-2.acn.waw.pl>
Message-ID: <49185F1F.1030909@dbtopas.lt>

Hi,


>> PROC main()
>> LOCAL aCountry, aI
>>    aCountry := {"LTU"=>"Lithuania", "ZWE"=>"Zimbabwe"}
>>    FOR EACH aI in aCountry
>>      QOUT(aI:__enumKey)              // OK
>>      EVAL({|| QOUT(aI:__enumKey)})   // RTE
>>    NEXT
>> RETURN
> 
> It's expected and correct behavior. Variables stored in codeblocks
> are detached. During detaching enumerators becomes simple references
> to iterated items which is not later changed.

I'm just trying to made my understand about an answer to two questions:

1) is it good that enumerators are detached to references to iterated 
items (or is it better to remain it enumerators in the codeblocks)?
2) can it remain an enumerator in codeblocks? Can we implement it 
technically? Or this is not possible because of current enumerators 
implementation or some other side effects.


> It allows to create code like:
> 
>    proc main()
>       local aCountry, aBlocks, aI, aB
>       aCountry := {"LTU"=>"Lithuania", "ZWE"=>"Zimbabwe"}
>       aBlocks := array( len( aCountry ) )
>       FOR EACH aI, aB in aCountry, aBlocks
>          aB := {|x| iif( pcount()==0, aI, aI := x ) }
>       NEXT
>       ? eval( aBlocks[ 1 ] )
>       ? eval( aBlocks[ 1 ], "XXXXX" )
>       ? eval( aBlocks[ 1 ] )
>       ? eval( aBlocks[ 2 ] )
>       ? eval( aBlocks[ 2 ], "YYYYY" )
>       ? eval( aBlocks[ 2 ] )
>    return
> 
> As you can see this code does not fail when codeblocks are
> evaluated autside FOR EACH loop and in each codeblocks aI
> referes to separated aCountry item which were valid when
> codeblock was created.

PROC main()
LOCAL aCountry, aI, aJ, nI

    aCountry := {"LTU", "ZWE"}
    aJ := {}
    FOR nI := 1 TO LEN(aCountry)
      aI := aCountry[nI]
      AADD(aJ, {|| aI})
    NEXT
    FOR nI := 1 TO LEN(aCountry)
      ? EVAL(aJ[nI])
    NEXT
RETURN

But in this sample aI is not detached to current aI value, and sample 
prints:
ZWE
ZWE

How can I easy understand/remember the difference between this behavior 
and enumerators behavior?


Best regards,
Mindaugas


From harbour.01 at syenar.hu  Mon Nov 10 12:42:14 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 12:42:25 2008
Subject: [Harbour] Printer list
In-Reply-To: <491855BF.3080503@ec-red.com>
References: <4917A5EB.10608@ec-red.com>
	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>
	<491855BF.3080503@ec-red.com>
Message-ID: <54B0827F-91CE-44CF-857F-F0DFBC5342ED@syenar.hu>

Hi Guillermo,

> I have this version of Harbor:
> --------------------------------------------------------------
> C:\HarbourMinGW\bin>harbour
> Harbour 1.0.1dev Intl. (Rev. 9229)
> Copyright (c) 1999-2008, http://www.harbour-project.org/
> --------------------------------------------------------------
> and here is not hbwin, What is equivalent to hbwin in this version?

It was called hbw32 lib in <= 1.0.1.

> Well, I've built a version from the current SVN and I get these  
> messages:
> --------------------------------------------------------------
> D:\harbour>make_gnu
> c:\mingw\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin 
> \ld.exe: cannot find -lhbmainstd

Difficult to tell. I'd recommend starting with a
clean Harbour source tree, and to try with this command
after putting msys, then mingw bin dirs in your PATH:

'sh make_gnu.sh install'

This works here with 4.1.2, but should also with 3.4.5.

> When compiling my PRG, which has only this:
> --------------------------------------------------------------
> function main ()
>   aPrn: GETPRINTERS = ()
>   wait
>   RETURN NIL
> --------------------------------------------------------------
> I get these messages:
> --------------------------------------------------------------
> Proyecto: tst_CT, Entorno: H_SVN_MinGW:
> [1]:Harbour.Exe tst_Prn.prg  /m /w0 /es2 /a /b /iC: 
> \HRBSVN~1\Include /oObj\tst_Prn.c
> Harbour 1.1.0dev (Rev. 9894)
> Copyright (c) 1999-2008, http://www.harbour-project.org/
> Compiling 'tst_Prn.prg'...
> Lines 99, Functions/Procedures 2
> Generating C source output to 'Obj\tst_Prn.c'... Done.
> [1]:gcc.Exe -IC:\HRBSVN~1\Include -mno-cygwin -Wall -c tst_Prn.c - 
> otst_Prn.o
> [1]:gcc.Exe -otst_CT.Exe -Wall -mno-cygwin  -mconsole tst_CT.gcl

You'll need to add Windows winspool lib to your liblist
in order to use these functions in hbwin lib.

Brgds,
Viktor

From druzus at acn.waw.pl  Mon Nov 10 13:05:18 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 10 13:04:24 2008
Subject: [Harbour] Bug: :__enumKey context is lost for codeblocks
In-Reply-To: <49185F1F.1030909@dbtopas.lt>
References: <49183FFA.1040809@dbtopas.lt>
	<20081110151744.GB30209@34-mo7-2.acn.waw.pl>
	<49185F1F.1030909@dbtopas.lt>
Message-ID: <20081110180518.GA19013@34-mo7-2.acn.waw.pl>

On Mon, 10 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> I'm just trying to made my understand about an answer to two questions:
> 1) is it good that enumerators are detached to references to iterated items 
> (or is it better to remain it enumerators in the codeblocks)?

If we left them as enumerator they will be updated by farther iterations
and it will not be possible to detach given item.

> 2) can it remain an enumerator in codeblocks? Can we implement it 
> technically? Or this is not possible because of current enumerators 
> implementation or some other side effects.

We do not have such functionality now but it can be implemented.
We will have to add support for reference counter to enumerators
and unblock their copping but it's possible. The question is if
we want to have such functionality.

> PROC main()
> LOCAL aCountry, aI, aJ, nI
>
>    aCountry := {"LTU", "ZWE"}
>    aJ := {}
>    FOR nI := 1 TO LEN(aCountry)
>      aI := aCountry[nI]
>      AADD(aJ, {|| aI})
>    NEXT
>    FOR nI := 1 TO LEN(aCountry)
>      ? EVAL(aJ[nI])
>    NEXT
> RETURN
> But in this sample aI is not detached to current aI value, and sample 
> prints:
> ZWE
> ZWE
> How can I easy understand/remember the difference between this behavior and 
> enumerators behavior?

Just like now you have to remember that:
   FOR EACH aI IN aCountry
      aI := NIL
   NEXT

will set NIL to all aCountry items. FOR and FOR EACH are different
things. In FOR EACH iterator is reference to item. When this reference
is detached it's not longer updated by next iterations. For me it's
correct behavior.

The only one problem I see here is the fact that comp;iler does
not generate compile time warning for the code you send. It should.
It's caused by side effect of simple codeblock implementation.
When expressions are created compiler does not know that they are
part of codeblock which is not allocated yet and finds aI as iterator
in parent function. For extended codeblocks and simple aI:__enum*()
usage warning message is correctly generated. F.e.:

   PROC main()
   LOCAL aCountry, aI, bc
      aCountry := {"LTU"=>"Lithuania", "ZWE"=>"Zimbabwe"}
      FOR EACH aI in aCountry
        QOUT(aI:__enumKey)              // OK
        EVAL({|| QOUT(aI:__enumKey), asd asd})   // RTE
        bc:={||; return aI:__enumKey; } // WARNING
      NEXT
      QOUT(aI:__enumKey) // WARNING
   RETURN

It should be fixed. To make it well we should change the method
of codeblock creating in compiler but it's to small problem for
me to invest time for it now. I'll make it in the future with some
other modifications but now I can simply add new variable to FUNCTION
structure to indicate that we are in simple codeblock context.
I'll commit this modification in a while.

Meanwhile you may think about expected behavior for other FOR EACH
related contexts. F.e. please also remember that after leaving FOR EACH
original enumerator value is restored, f.e.:

   aI := 1234.567
   FOR EACH aI IN aCountry
      aI := NIL
   NEXT
   ? aI  // 1234.567

It's original behavior implemented by Ryszard we still keep.
If we begin to detach enumerators then after leaving FOR EACH
detached enumerators should also point to original value (1234.567
in above example).
Other method is declaring temporary local variables for enumerators
and forbid using normal MEMVAR/STAATIC/LOCAL variables so the code
will look like:

   proc p( aCountry )
      for each aI in aCountry  // aI is temporary local variable
                               // allocated automatically by compiler
         ? aI
      next
   return

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Mon Nov 10 13:30:12 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Nov 10 13:30:16 2008
Subject: [Harbour] hb* scripts and dylibs path under Mac OS X
In-Reply-To: <20081110133800.GB21486@34-mo7-2.acn.waw.pl>
References: <9257026e0811050346p79edf97cn5444e7581038f5eb@mail.gmail.com>
	<20081110133800.GB21486@34-mo7-2.acn.waw.pl>
Message-ID: <9257026e0811101030q7bb43f2fl30ee62083706b50f@mail.gmail.com>

On Mon, Nov 10, 2008 at 2:38 PM, Przemyslaw Czerpak <druzus@acn.waw.pl> wrote:

> change -install_name parameter to:
>    ${CCPREFIX}libtool -dynamic -install_name "${BASE}${SLIB_EXT}" \
>
> Check if everything works correctly. If yes then please commit it.

Thanks it was it :)

Since today Mac OS X is a first class citizen in our company.

Many thanks to all.

best regards,
Lorenzo
From cvc at oohg.org  Mon Nov 10 13:49:53 2008
From: cvc at oohg.org (Ciro Vargas Clemow)
Date: Mon Nov 10 13:50:00 2008
Subject: [Harbour] abour EJECT in CLASS TREPORT
Message-ID: <49188251.3020800@oohg.org>



HI all:

I found a little thing that I don't undesrtand.

in TREPORT.prg

I found this

    IF lPrinter                   // To the printer
       ::lFormFeeds := .T.
    ELSE
       ::lFormFeeds := .F.
    ENDIF


in other words if  I send the report to a file the EJECTS are not triggered.

and if I normally send first to a file and later copy this file to print port, 
then my report will not have EJECTS.

I not agree with this point.

it's not clipper compatible.

best regards
Ciro



-- 
http://sistemascvc.tripod.com  (la casa del clip2win y nodosimp / the no2imp and 
clip2win home )

http://www.oohg.org ( Object Oriented Harbour GUI, more simple, more powerfull )


From labitas at gmail.com  Mon Nov 10 14:07:41 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Mon Nov 10 14:07:44 2008
Subject: [Harbour] DBFCDX + HB_CDX_DBGCODE_EXT
Message-ID: <2386af1b0811101107y46b39fc7yb1120c03345e6668@mail.gmail.com>

Hello Przemek,

Creating database with cdx index on field with binary data,
then appending records seems successful.

Then recompiling dbfcdx1.c with HB_CDX_DBGCODE_EXT defined,
program ends with message:

inserting, iSize=29, childs[i]->iFree=30
iKeys=102, iMaxReq=3
Unrecoverable error 9201: hb_cdxPageGetChild: index corrupted.
Called from DBGOTOP(0)

Is there bug covered or only some inaccuracy in debugging code
and can be ignored?

Test sample is quite simple, but data appended over thousand records
and unable to reduce.

Best regards,
Saulius
From gvarona at ec-red.com  Mon Nov 10 15:50:41 2008
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Mon Nov 10 15:50:39 2008
Subject: [Harbour] Printer list
In-Reply-To: <54B0827F-91CE-44CF-857F-F0DFBC5342ED@syenar.hu>
References: <4917A5EB.10608@ec-red.com>	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>	<491855BF.3080503@ec-red.com>
	<54B0827F-91CE-44CF-857F-F0DFBC5342ED@syenar.hu>
Message-ID: <49189EA1.80202@ec-red.com>

Szak?ts Viktor escribi?:
> Hi Guillermo,
>> I have this version of Harbor:
>> --------------------------------------------------------------
>> C:\HarbourMinGW\bin>harbour
>> Harbour 1.0.1dev Intl. (Rev. 9229)
>> Copyright (c) 1999-2008, http://www.harbour-project.org/
>> --------------------------------------------------------------
>> and here is not hbwin, What is equivalent to hbwin in this version?
>
> It was called hbw32 lib in <= 1.0.1.
Thanks Viktor, Solved!!!, add LIB "libwinspool.a".
>> --------------------------------------------------------------
>> D:\harbour>make_gnu
>> c:\mingw\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: 
>> cannot find -lhbmainstd
> Well, I've built a version from the current SVN and I get these messages:
>
> Difficult to tell. I'd recommend starting with a
> clean Harbour source tree, and to try with this command
> after putting msys, then mingw bin dirs in your PATH:
>
> 'sh make_gnu.sh install'
>
> This works here with 4.1.2, but should also with 3.4.5.

But I am using Windows XP + Harbour (SVN) + MinGW, and this, ('sh 
make_gnu.sh install' ), is for Linux.
What would it be for WinXP?

TIA

Best Regards
GVS
From myorg63 at mail.ru  Mon Nov 10 16:05:09 2008
From: myorg63 at mail.ru (Petr Chornyj)
Date: Mon Nov 10 16:05:15 2008
Subject: [Harbour] 2008-11-05 03:01 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081105020202.GA7319@34-mo7-2.acn.waw.pl>
References: <20081105020202.GA7319@34-mo7-2.acn.waw.pl>
Message-ID: <20427623.post@talk.nabble.com>




Przemyslaw Czerpak-2 wrote:
> 
> 2008-11-05 03:01 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
> ..
>   * harbour/contrib/gtwvg/gtwvg.c
>     * cover LWA_ALPHA usage by #if ( _WIN32_WINNT >= 0x0500 )
>       to keep at least compile time compatibility with older systems
> 
> 

I think is it should be as

#if ( _WIN32_WINNT >= 0x0500 )
                     SetWindowLong( pWVT->hWnd,
                                    GWL_EXSTYLE,
                                    GetWindowLong( pWVT->hWnd, GWL_EXSTYLE )
| WS_EX_LAYERED );

                     pWVT->pfnLayered( pWVT->hWnd,
                                       RGB( 255,255,255 ),
                                       hb_itemGetNI( pInfo->pNewVal2 ),
                                       /*LWA_COLORKEY|*/ LWA_ALPHA );
#endif

because we can see in winuser.h 

#if(_WIN32_WINNT >= 0x0500)
#define WS_EX_LAYERED           0x00080000
#ifdef

BR,
Petr
-- 
View this message in context: http://www.nabble.com/2008-11-05-03%3A01-UTC%2B0100-Przemyslaw-Czerpak-%28druzus-at-priv.onet.pl%29-tp20335131p20427623.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Mon Nov 10 16:57:40 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 16:57:48 2008
Subject: [Harbour] Bug: :__enumKey context is lost for codeblocks
In-Reply-To: <20081110180518.GA19013@34-mo7-2.acn.waw.pl>
References: <49183FFA.1040809@dbtopas.lt>
	<20081110151744.GB30209@34-mo7-2.acn.waw.pl>
	<49185F1F.1030909@dbtopas.lt>
	<20081110180518.GA19013@34-mo7-2.acn.waw.pl>
Message-ID: <C3ED0C51-A68C-46A9-9471-874FD6DC9176@syenar.hu>

> Other method is declaring temporary local variables for enumerators
> and forbid using normal MEMVAR/STAATIC/LOCAL variables so the code
> will look like:
>
>   proc p( aCountry )
>      for each aI in aCountry  // aI is temporary local variable
>                               // allocated automatically by compiler
>         ? aI
>      next
>   return

I think it's better to have it declared manually.

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 17:04:05 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 17:04:12 2008
Subject: [Harbour] abour EJECT in CLASS TREPORT
In-Reply-To: <49188251.3020800@oohg.org>
References: <49188251.3020800@oohg.org>
Message-ID: <5D4B42ED-B04C-4F5B-A0B0-F374A1AE4F79@syenar.hu>

Hi Ciro,

>   IF lPrinter                   // To the printer
>      ::lFormFeeds := .T.
>   ELSE
>      ::lFormFeeds := .F.
>   ENDIF
>
>
> in other words if  I send the report to a file the EJECTS are not  
> triggered.
>
> and if I normally send first to a file and later copy this file to  
> print port, then my report will not have EJECTS.
>
> I not agree with this point.
>
> it's not clipper compatible.

It is compatible with C5.2e and also C5.3b.

If you can create a small example to show the
difference, of course we should fix it though,
maybe there's indeed a problem elsewhere.

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 17:07:45 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 17:07:52 2008
Subject: [Harbour] Printer list
In-Reply-To: <49189EA1.80202@ec-red.com>
References: <4917A5EB.10608@ec-red.com>	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>	<491855BF.3080503@ec-red.com>
	<54B0827F-91CE-44CF-857F-F0DFBC5342ED@syenar.hu>
	<49189EA1.80202@ec-red.com>
Message-ID: <13AE2F46-07B0-42C2-A1EB-4A266B5D945A@syenar.hu>

>> 'sh make_gnu.sh install'
>>
>> This works here with 4.1.2, but should also with 3.4.5.
>
> But I am using Windows XP + Harbour (SVN) + MinGW, and this, ('sh  
> make_gnu.sh install' ), is for Linux.
> What would it be for WinXP?

It is for XP, just try. 'sh' is part of msys.

[ Despite some drawbacks (you have to use forward
slash dir seps and no drive name in your HB_*_INSTALL
and HB_INC_* macros), this method looks much more
solid (and even quicker) than command.com forced
version. It also works without additional environment
hacks. ]

Brgds,
Viktor

From joe_bernardes at yahoo.com.br  Mon Nov 10 17:16:32 2008
From: joe_bernardes at yahoo.com.br (Joel YAHOO)
Date: Mon Nov 10 17:17:06 2008
Subject: [Harbour] Compiler source code SVN
Message-ID: <003301c94382$0db9f530$1001a8c0@jad>

Hello  

Starting from one it tree new of the msys.

I am also having problems to compile the harbour (SVN+MingW+Msys).  
They are 2 errors.

1-

sh make_gnu.sh
config/global.cf:44: config/w32/mingw32.cf: No such file or directory
make: *** No rule to make target `config/w32/mingw32.cf'.  Stop.

I copied mingw.cf for mingw32.cf

--=========================================================================
2-


c:\MinGW\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: cannot find -lhbmainstd
collect2: ld returned 1 exit status
make[3]: *** [hbdoc.exe] Error 1
make[3]: Leaving directory `/harbour/utils/hbdoc/w32/mingw32'
make[2]: *** [descend] Error 2
make[2]: Leaving directory `/harbour/utils/hbdoc'
make[2]: Entering directory `/harbour/utils/hbmake'
make[3]: Entering directory `/harbour/utils/hbmake/w32/mingw32'
gcc -Wall -W -O3 -march=i586 -ohbmake.exe hbmfrdln.o hbmgauge.o hbmlang.o hbmake.o    -L../../../../lib/w32/mingw32 -Wl,--start-group    -lhbdebug  -lhbvm  -lhbrtl  -lhbnulrdd  -lhbrtl  -lhbvm  -lhbmacro  -lhbcommon  -lrddntx  -lrddcdx  -lrddfpt  -lhbsix  -lhbhsx  -lhbusrrdd -lhbmainstd  -lgtcgi  -lgtpca  -lgtstd  -lgtwin  -lgtwvt  -lgtgui -Wl,--end-group -luser32 -lgdi32 -lwsock32 -lwinspool -lcomctl32 -lcomdlg32 -lole32 -loleaut32 -luuid -lmpr -lws2_32 -lmapi32
c:\MinGW\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe: cannot find -lhbmainstd
collect2: ld returned 1 exit status
make[3]: *** [hbmake.exe] Error 1
make[3]: Leaving directory `/harbour/utils/hbmake/w32/mingw32'
make[2]: *** [descend] Error 2
make[2]: Leaving directory `/harbour/utils/hbmake'
make[1]: *** [install] Error 2

How can I solve that?

Many thank?s
{}s
Joel Bernardes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081110/eab5827a/attachment.html
From harbour.01 at syenar.hu  Mon Nov 10 17:58:12 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 17:58:19 2008
Subject: [Harbour] Compiler source code SVN
In-Reply-To: <003301c94382$0db9f530$1001a8c0@jad>
References: <003301c94382$0db9f530$1001a8c0@jad>
Message-ID: <2D168F74-7C8E-4B04-A21B-BBEDD41BFB32@syenar.hu>

Hi Joel,

> sh make_gnu.sh
> config/global.cf:44: config/w32/mingw32.cf: No such file or directory
> make: *** No rule to make target `config/w32/mingw32.cf'.  Stop.
> I copied mingw.cf for mingw32.cf

Instead you should use 'set HB_COMPILER=mingw' or even
better just drop this setting completely and let it be
autodetected by make_gnu.sh.

> gcc -Wall -W -O3 -march=i586 -ohbmake.exe hbmfrdln.o hbmgauge.o  
> hbmlang.o hbmake.o    -L../../../../lib/w32/mingw32 -Wl,--start- 
> group    -lhbdebug  -lhbvm  -lhbrtl  -lhbnulrdd  -lhbrtl  -lhbvm  - 
> lhbmacro  -lhbcommon  -lrddntx  -lrddcdx  -lrddfpt  -lhbsix  - 
> lhbhsx  -lhbusrrdd -lhbmainstd  -lgtcgi  -lgtpca  -lgtstd  -lgtwin  - 
> lgtwvt  -lgtgui -Wl,--end-group -luser32 -lgdi32 -lwsock32 - 
> lwinspool -lcomctl32 -lcomdlg32 -lole32 -loleaut32 -luuid -lmpr - 
> lws2_32 -lmapi32
> c:\MinGW\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin 
> \ld.exe: cannot find -lhbmainstd

The real question is why hbmainstd is not created.
Please check your log for warnings or errors before
this point, around hbmainstd creation.

BTW, it works here without any such problems also
with 3.4.5.

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 18:06:25 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 18:06:32 2008
Subject: [Harbour] Compiler source code SVN
In-Reply-To: <003301c94382$0db9f530$1001a8c0@jad>
References: <003301c94382$0db9f530$1001a8c0@jad>
Message-ID: <BB5F70DB-15BF-48A9-AC95-A6FCCFBCE350@syenar.hu>

Joel, could you please post your C_USR, L_USR and
other extra build settings?

Brgds,
Viktor

On 2008.11.10., at 23:16, Joel YAHOO wrote:

> Hello
>
> Starting from one it tree new of the msys.
>
> I am also having problems to compile the harbour (SVN+MingW+Msys).
> They are 2 errors.
>
> 1-
> sh make_gnu.sh
> config/global.cf:44: config/w32/mingw32.cf: No such file or directory
> make: *** No rule to make target `config/w32/mingw32.cf'.  Stop.
> I copied mingw.cf for mingw32.cf
>
> -- 
> = 
> = 
> = 
> ======================================================================
> 2-
>
>
> c:\MinGW\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin 
> \ld.exe: cannot find -lhbmainstd
> collect2: ld returned 1 exit status
> make[3]: *** [hbdoc.exe] Error 1
> make[3]: Leaving directory `/harbour/utils/hbdoc/w32/mingw32'
> make[2]: *** [descend] Error 2
> make[2]: Leaving directory `/harbour/utils/hbdoc'
> make[2]: Entering directory `/harbour/utils/hbmake'
> make[3]: Entering directory `/harbour/utils/hbmake/w32/mingw32'
> gcc -Wall -W -O3 -march=i586 -ohbmake.exe hbmfrdln.o hbmgauge.o  
> hbmlang.o hbmake.o    -L../../../../lib/w32/mingw32 -Wl,--start- 
> group    -lhbdebug  -lhbvm  -lhbrtl  -lhbnulrdd  -lhbrtl  -lhbvm  - 
> lhbmacro  -lhbcommon  -lrddntx  -lrddcdx  -lrddfpt  -lhbsix  - 
> lhbhsx  -lhbusrrdd -lhbmainstd  -lgtcgi  -lgtpca  -lgtstd  -lgtwin  - 
> lgtwvt  -lgtgui -Wl,--end-group -luser32 -lgdi32 -lwsock32 - 
> lwinspool -lcomctl32 -lcomdlg32 -lole32 -loleaut32 -luuid -lmpr - 
> lws2_32 -lmapi32
> c:\MinGW\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin 
> \ld.exe: cannot find -lhbmainstd
> collect2: ld returned 1 exit status
> make[3]: *** [hbmake.exe] Error 1
> make[3]: Leaving directory `/harbour/utils/hbmake/w32/mingw32'
> make[2]: *** [descend] Error 2
> make[2]: Leaving directory `/harbour/utils/hbmake'
> make[1]: *** [install] Error 2
>
> How can I solve that?
>
> Many thank?s
> {}s
> Joel Bernardes
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Nov 10 18:44:20 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 18:44:25 2008
Subject: [Harbour] 2008-11-11 00:39 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9438e$Blat.v2.6.2$40b372fc$15601616d26e@127.0.0.1>

2008-11-11 00:39 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
    ! Fixed linking hbtest-dll.exe with tracing enabled.

  * bin/hbmk.bat
    + Added '-shared' option.
    ; TOFIX: - '-shared' won't work in binary installations.
             - '-shared' cannot create MT apps.
             - '-shared' only works for BCC32 yet.

  - tests/hbmk_b32_dll.bat
    - Removed. Use 'hbmk_b32 -shared' instead.

  * source/rtl/treport.prg
    * Minor formatting.

  * make_b32.bat
  * make_vc.bat
  * common.mak
    * Changed default of HB_BUILD_DLL to 'yes'.
--
Brgds,
Viktor

From cvc at oohg.org  Mon Nov 10 18:48:48 2008
From: cvc at oohg.org (Ciro Vargas Clemow)
Date: Mon Nov 10 18:48:54 2008
Subject: [Harbour] abour EJECT in CLASS TREPORT
In-Reply-To: <5D4B42ED-B04C-4F5B-A0B0-F374A1AE4F79@syenar.hu>
References: <49188251.3020800@oohg.org>
	<5D4B42ED-B04C-4F5B-A0B0-F374A1AE4F79@syenar.hu>
Message-ID: <4918C860.7030903@oohg.org>



Hi Victor:

i'm not sure if the problem is the Treport.prg

but the next code... in clipper  generate FF chr(12) chars after each page
in harbour the FF chars not appear in list.txt

best regards
Ciro

local i
local aDbf := {}
AADD(aDbf, { "Name", "C", 10, 0 })
AADD(aDbf, { "Address", "C", 20, 0 })
AADD(aDbf, { "Phone", "N", 13, 0 })
//
DBCREATE("People", aDbf)
Use People
for i:= 1 to 200
   append blank
   replace  name with str(i)
   replace address with str(i+1)
   replace phone with i+2
next i
set printer to list.txt
report form cvc to print
set printer to
******************//////   (3 columns name 10, address 20  phone 13 )






-- 
http://sistemascvc.tripod.com  (la casa del clip2win y nodosimp / the no2imp and 
clip2win home )

http://www.oohg.org ( Object Oriented Harbour GUI, more simple, more powerfull )


From harbour.01 at syenar.hu  Mon Nov 10 19:40:56 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 19:41:01 2008
Subject: [Harbour] 2008-11-11 01:39 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94396$Blat.v2.6.2$2905fe06$13e4c42ee612@127.0.0.1>

2008-11-11 01:39 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  + config/w32/pocc64.cf
    + Added Pelles C x64 GNU-make file.

  * config/w32/pocc.cf
    * Minor cleanup.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 20:36:22 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 20:36:27 2008
Subject: [Harbour] 2008-11-11 02:35 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9439d$Blat.v2.6.2$e73db63c$ee0cbcbd4de@127.0.0.1>

2008-11-11 02:35 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
  * make_gcc.mak
    + Added -DHB_TR_LEVEL_DEBUG C compiler option when 
      HB_BUILD_DEBUG=yes.

  * source/rtl/hbinet.c
    * Minor formatting.
--
Brgds,
Viktor

From bedipritpal at hotmail.com  Mon Nov 10 20:47:06 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Mon Nov 10 20:47:09 2008
Subject: [Harbour] SET PRINTER TO ( cPrinter ) - Bug
Message-ID: <20431996.post@talk.nabble.com>


Hello All

Here is the code:

   cPrinter := 'Kyocera FS-1000 (KPDL-2)'

   SET PRINT ON
   SET CONSOLE OFF
   SET PRINTER TO ( cPrinter )

   ? 'Ok, I am printing'
   eject

   SET PRINTER TO
   SET PRINT OFF
   SET CONSOLE ON

The code above correctly prints on the specified printer in xHarbour
but fails in Harbour. In Harbour it creates a disk file  with .prn suffix:
Kyocera FS-1000 (KPDL-2).prn

xharbour/source/rtl/set.c :

      case HB_SET_PRINTER    :
         hb_retl( hb_set.HB_SET_PRINTER );
         if( args > 1 )
         {
            hb_set.HB_SET_PRINTER = set_logical( pArg2,
hb_set.HB_SET_PRINTER );

            if( hb_set.HB_SET_PRINTER )
            {
               hb_set_SetPrinterStart();
            }
            else
            {
               hb_set_SetPrinterStop();
            }
         }
         break;

harbour/source/vm/set.c :

      case HB_SET_PRINTER:
         hb_retl( pSet->HB_SET_PRINTER );
         if( args > 1 )
            pSet->HB_SET_PRINTER = set_logical( pArg2, pSet->HB_SET_PRINTER
);
         break;

Which compiles has the correct behavior?

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/SET-PRINTER-TO-%28-cPrinter-%29---Bug-tp20431996p20431996.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Mon Nov 10 20:48:01 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 20:48:08 2008
Subject: [Harbour] 2008-11-11 02:44 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9439f$Blat.v2.6.2$87dbe108$ce4d6e9a890@127.0.0.1>

2008-11-11 02:44 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * bin/hbmk.bat
    + Added '-shared' support for MSVC.
    ! Fixed to cleanup mainstd.obj and mainwin.obj.

  * ChangeLog
    * Some TODO/TOFIX marked as [DONE]. One [DONE] marked 
      as [DONE - REOPENED].
--
Brgds,
Viktor

From bedipritpal at hotmail.com  Mon Nov 10 21:14:45 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Mon Nov 10 21:14:47 2008
Subject: [Harbour] How to implement remote printing in Harbour
Message-ID: <20432275.post@talk.nabble.com>


Hello All

How can I implement remote printing at the client terminal.

I am using TCP/IP protocol, I mean hb_INet* functions to have 
my own terminal. ( anybody interested can download
http://www.vouch.info/downloads/vouchclient.zip 
  user1/user1 ~ user9/user9  userid/password )

I need something to feed as <cPrinter> to SET PRINTER TO ( cPrinter )
command.
Server knows the client's IP address. OR any other alternative.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/How-to-implement-remote-printing-in-Harbour-tp20432275p20432275.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Mon Nov 10 21:15:15 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 21:15:20 2008
Subject: [Harbour] 2008-11-11 03:13 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c943a3$Blat.v2.6.2$55e4558c$15a08f4aef46@127.0.0.1>

2008-11-11 03:13 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  + contrib/examples/rl
  + contrib/examples/rl/Makefile
  + contrib/examples/rl/hbmk_b32.bat
  + contrib/examples/rl/hbmk_vc.bat
  + contrib/examples/rl/readme.txt
    + Added build files for Clipper RL utility.
      (if someone remembers :)

  * contrib/examples/guestbk/hbmk_vc.bat
  * contrib/examples/pp/hbmk_vc.bat
  * contrib/examples/pe/hbmk_vc.bat
  * contrib/examples/dbu/hbmk_b32.bat
  * contrib/examples/dbu/hbmk_vc.bat
  * contrib/examples/hscript/hbmk_vc.bat
  * utils/hbdoc/hbmk_b32.bat
  * utils/hbdoc/hbmk_vc.bat
  * utils/hbmake/hbmk_b32.bat
  * utils/hbmake/hbmk_vc.bat
    % Removed winspool.lib from liblists.
    % Removed '/subsystem:console' from MSVC commandlines.
    + Added gtwvt.lib + gdi32.lib to liblists.
      (work in progress)

  * contrib/examples/dbu/readme.txt
    * Minor.

  * contrib/examples/pe/editorhi.prg
    ! Fixed stupid s&r error which broke compilation.
      [TOMERGE 1.0]
--
Brgds,
Viktor

From bedipritpal at hotmail.com  Mon Nov 10 21:16:14 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Mon Nov 10 21:16:17 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <20414605.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com>
Message-ID: <20432291.post@talk.nabble.com>


To keep it alive !


Pritpal Bedi wrote:
> 
> Hello Przemek
> 
> Can we have hb_gtInfoEx() function accepting 
> <pGT> as its first parameter and then the rest parameters.
> It will help me to control GT behavior from other threads .
> 
> Also can we retrieve <pGT> for current context, i.e., 
> pGT := hb_gtCurrent() or like ?
> 
> hb_gtReload() returns TRUE/FALSE. How can I retreive its <pGT>.
> 
> Regards
> Pritpal Bedi
> 

-- 
View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20432291.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Mon Nov 10 21:25:01 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 21:25:08 2008
Subject: [Harbour] abour EJECT in CLASS TREPORT
In-Reply-To: <4918C860.7030903@oohg.org>
References: <49188251.3020800@oohg.org>
	<5D4B42ED-B04C-4F5B-A0B0-F374A1AE4F79@syenar.hu>
	<4918C860.7030903@oohg.org>
Message-ID: <89097FBE-EAFE-4B21-9A3A-5DE28F9695B3@syenar.hu>

Hi Ciro,

Can you send the .frm, too?

Brgds,
Viktor

On 2008.11.11., at 0:48, Ciro Vargas Clemow wrote:

>
>
> Hi Victor:
>
> i'm not sure if the problem is the Treport.prg
>
> but the next code... in clipper  generate FF chr(12) chars after  
> each page
> in harbour the FF chars not appear in list.txt
>
> best regards
> Ciro
>
> local i
> local aDbf := {}
> AADD(aDbf, { "Name", "C", 10, 0 })
> AADD(aDbf, { "Address", "C", 20, 0 })
> AADD(aDbf, { "Phone", "N", 13, 0 })
> //
> DBCREATE("People", aDbf)
> Use People
> for i:= 1 to 200
>  append blank
>  replace  name with str(i)
>  replace address with str(i+1)
>  replace phone with i+2
> next i
> set printer to list.txt
> report form cvc to print
> set printer to
> ******************//////   (3 columns name 10, address 20  phone 13 )
>
>
>
>
>
>
> -- 
> http://sistemascvc.tripod.com  (la casa del clip2win y nodosimp /  
> the no2imp and clip2win home )
>
> http://www.oohg.org ( Object Oriented Harbour GUI, more simple, more  
> powerfull )
>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Nov 10 21:31:27 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 21:31:34 2008
Subject: [Harbour] Clipper RL compilation problem
Message-ID: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>

Hi all,

RL will crash when compiled with Harbour.

The problem is that it's using 10 chars longer
PRIVATE vars, then saves them to a .mem file
and restores them before doing anything.

Now, .mem files can only store var names up to
10 chars, so when the vars are restored their
names are truncated and not found at runtime
using the longer names used in the source.

Any suggestion how to solve this Clipper
compatibility problem the most efficient way?

I had thought that we could limit PRIVATE/
PUBLIC var names to ten chars at runtime for
compatibility. PRIVATE/PUBLIC is not something
users want to use for new code, yet, above
situation can very easily break old apps.

Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 21:53:27 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 21:53:34 2008
Subject: [Harbour] SET PRINTER TO ( cPrinter ) - Bug
In-Reply-To: <20431996.post@talk.nabble.com>
References: <20431996.post@talk.nabble.com>
Message-ID: <6139A806-0A98-448A-AC0A-A723F7FBF705@syenar.hu>

First of turn _SET_DEFEXTENSIONS to .F.,
after that in Harbour you'll need to convert
the Windows printer name to a port, share
name, or filename in order to print to it using
SET PRINTER TO.

Harbour core doesn't support any Windows
printers natively, so you'll need to use
hbwin.lib for some name to port conversion
and getting Windows printer name list.

IOW, in Harbour 'SET PRINTER TO' always need
to point to a filename, or any name that
can be opened using FOpen().

Brgds,
Viktor

On 2008.11.11., at 2:47, Pritpal Bedi wrote:

>
> Hello All
>
> Here is the code:
>
>   cPrinter := 'Kyocera FS-1000 (KPDL-2)'
>
>   SET PRINT ON
>   SET CONSOLE OFF
>   SET PRINTER TO ( cPrinter )
>
>   ? 'Ok, I am printing'
>   eject
>
>   SET PRINTER TO
>   SET PRINT OFF
>   SET CONSOLE ON
>
> The code above correctly prints on the specified printer in xHarbour
> but fails in Harbour. In Harbour it creates a disk file  with .prn  
> suffix:
> Kyocera FS-1000 (KPDL-2).prn
>
> xharbour/source/rtl/set.c :
>
>      case HB_SET_PRINTER    :
>         hb_retl( hb_set.HB_SET_PRINTER );
>         if( args > 1 )
>         {
>            hb_set.HB_SET_PRINTER = set_logical( pArg2,
> hb_set.HB_SET_PRINTER );
>
>            if( hb_set.HB_SET_PRINTER )
>            {
>               hb_set_SetPrinterStart();
>            }
>            else
>            {
>               hb_set_SetPrinterStop();
>            }
>         }
>         break;
>
> harbour/source/vm/set.c :
>
>      case HB_SET_PRINTER:
>         hb_retl( pSet->HB_SET_PRINTER );
>         if( args > 1 )
>            pSet->HB_SET_PRINTER = set_logical( pArg2, pSet- 
> >HB_SET_PRINTER
> );
>         break;
>
> Which compiles has the correct behavior?
>
> Regards
> Pritpal Bedi
>
> -- 
> View this message in context: http://www.nabble.com/SET-PRINTER-TO-%28-cPrinter-%29---Bug-tp20431996p20431996.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Mon Nov 10 21:58:17 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 21:58:23 2008
Subject: [Harbour] 2008-11-11 03:56 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c943a9$Blat.v2.6.2$58e4a6e6$14e898e6f4cc@127.0.0.1>

2008-11-11 03:56 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
  * make_gcc.mak
  * common.mak
    + Added generation of hbmainstd and hbmainwin libs.

  * bin/hbmk.bat
    + Changed to use above libs. This also means that '-shared' 
      can now be used in Harbour binary distributions, too.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 22:22:58 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 22:23:02 2008
Subject: [Harbour] 2008-11-11 04:22 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c943ac$Blat.v2.6.2$cb8b79e2$1568bd4d5a40@127.0.0.1>

2008-11-11 04:22 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
  * make_gcc.mak
  * common.mak
    * Changed dll and mt obj locations to reside inside the platform dir:
      obj/dll/* -> obj/*/dll
      obj/*_mt -> obj/*/mt
    + Added provisions for new obj location:
      obj/*/mt_dll
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 10 23:35:37 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 10 23:35:41 2008
Subject: [Harbour] 2008-11-11 05:34 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c943b6$Blat.v2.6.2$f1b3b508$1508ba4c3ae4@127.0.0.1>

2008-11-11 05:34 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
  * common.mak
  * bin/hbmk.bat
    + Added generation of MT harbour .dlls for BCC and MSVC.
    ; TOFIX: 'hbmk -shared -mt' doesn't seem to work, resulting 
             app simply exists for both BCC and MSVC.
    ; TODO: Please update make_gcc.mak.
--
Brgds,
Viktor

From cvc at oohg.org  Mon Nov 10 23:39:56 2008
From: cvc at oohg.org (Ciro Vargas Clemow)
Date: Mon Nov 10 23:40:03 2008
Subject: [Harbour] the FRM
Message-ID: <49190C9C.2000305@oohg.org>


hi Victor:

the Frm goes to you

best regards
Ciro

-- 
http://sistemascvc.tripod.com  (la casa del clip2win y nodosimp / the no2imp and
clip2win home )

http://www.oohg.org ( Object Oriented Harbour GUI, more simple, more powerfull )



-------------- next part --------------
A non-text attachment was scrubbed...
Name: cvc.frm
Type: application/octet-stream
Size: 1990 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081110/b5cd2d7e/cvc-0001.obj
From niki at synel.co.il  Tue Nov 11 02:32:32 2008
From: niki at synel.co.il (Chen Kedem)
Date: Tue Nov 11 02:34:18 2008
Subject: [Harbour] SF bugtracker#1672301: Charset Mapping CP437 or CP850 (not
 documentated ?)
Message-ID: <1A07FEDC778C3E4AA417F089511F859C03333A41CD@Mail-yoq.SYNEL-COMPANY.LTD>

This is more than a year old report / feature request about locale maping.
After reading the recent codepage discussion here on the list, I put this as a reminder
that might help users porting thier DOS application to *nix world.

http://sourceforge.net/tracker/index.php?func=detail&aid=1672301&group_id=681&atid=100681


  Chen.

[I was away for a while and just finished reading more that 100 digest (!) posts from this list]
From e.m.giordano at emagsoftware.it  Tue Nov 11 03:22:56 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Tue Nov 11 03:23:01 2008
Subject: [Harbour] Clipper RL compilation problem
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>
Message-ID: <2632CA93BDBD4352965490C9F327835D@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: marted? 11 novembre 2008 3.31
Oggetto: [Harbour] Clipper RL compilation problem


> I had thought that we could limit PRIVATE/
> PUBLIC var names to ten chars at runtime for
> compatibility. PRIVATE/PUBLIC is not something
> users want to use for new code,

Why? I agree that PRIVATE/PUBLIC should not be used at all but, 
pragmatically speaking, they are very powerful tools sometimes.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Tue Nov 11 04:06:28 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 04:06:36 2008
Subject: [Harbour] Clipper RL compilation problem
In-Reply-To: <2632CA93BDBD4352965490C9F327835D@emag>
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>
	<2632CA93BDBD4352965490C9F327835D@emag>
Message-ID: <ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>

>> I had thought that we could limit PRIVATE/
>> PUBLIC var names to ten chars at runtime for
>> compatibility. PRIVATE/PUBLIC is not something
>> users want to use for new code,
>
> Why? I agree that PRIVATE/PUBLIC should not be used at all but,  
> pragmatically speaking, they are very powerful tools sometimes.

Ask yourself why you don't use them :)

[ BTW I still use a few PUBLICs, but changing them
to something else is on the TODO list. ]

It's a Clipper '87 heritage and much slower than
LOCAL/STATIC, it can make programs very difficult
to understand/read/modify/maintain, even more so in
MT programs, and they both can be replaced by better
alternatives since a very long time.

Probably a compiler switch could be the solution,
which would tell it to trim all such names. The
default of this switch is something we can decide.

[ Unless there is any other obvious/existing solution
for the problem of course. Heavily editing RL sources
doesn't count. ]

Brgds,
Viktor

From druzus at acn.waw.pl  Tue Nov 11 05:01:15 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 05:00:18 2008
Subject: [Harbour] Clipper RL compilation problem
In-Reply-To: <ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>
	<2632CA93BDBD4352965490C9F327835D@emag>
	<ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
Message-ID: <20081111100115.GA19736@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> It's a Clipper '87 heritage and much slower than
> LOCAL/STATIC, it can make programs very difficult

Have you checked it?
You'll be very surprised if you will make some tests.
In tests/speedtst.prg tests 1-15 checks the speed of
local, static, public, privates and fields.
Do you see noticeable speed difference between first
four variable types?

> to understand/read/modify/maintain, even more so in
> MT programs, and they both can be replaced by better
> alternatives since a very long time.

What is the alternative for variables in macros?

> Probably a compiler switch could be the solution,
> which would tell it to trim all such names. The
> default of this switch is something we can decide.

It will help only for variables used explicitly in source
code but will not for macros. It will have to be also
runtime HVM switch.

> [ Unless there is any other obvious/existing solution
> for the problem of course. Heavily editing RL sources
> doesn't count. ]

I do not know the RL tool and it's internal format used
in .frm but for .mem files we can introduce new format
which will allow to store memvars with unlimited variable
name size.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 05:09:19 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 05:08:22 2008
Subject: [Harbour] DBFCDX + HB_CDX_DBGCODE_EXT
In-Reply-To: <2386af1b0811101107y46b39fc7yb1120c03345e6668@mail.gmail.com>
References: <2386af1b0811101107y46b39fc7yb1120c03345e6668@mail.gmail.com>
Message-ID: <20081111100919.GB19736@34-mo7-2.acn.waw.pl>

On Mon, 10 Nov 2008, Saulius Zrelskis wrote:

Hi Saulius,

> Creating database with cdx index on field with binary data,
> then appending records seems successful.
> Then recompiling dbfcdx1.c with HB_CDX_DBGCODE_EXT defined,
> program ends with message:
> inserting, iSize=29, childs[i]->iFree=30
> iKeys=102, iMaxReq=3
> Unrecoverable error 9201: hb_cdxPageGetChild: index corrupted.
> Called from DBGOTOP(0)
> Is there bug covered or only some inaccuracy in debugging code
> and can be ignored?

In few cases such situation can appear for DBGCODE_EXT and
can be ignored. These are debug messages for me to check some
internal conditions.
To say sth more about this particular case I will have to
see exact code and index structure.

> Test sample is quite simple, but data appended over thousand records
> and unable to reduce.

If you are interested in more information then you can send it.
In some spare time I'll check the exact conditions for above
message.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 05:16:06 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 05:15:09 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <20414605.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com>
Message-ID: <20081111101606.GC19736@34-mo7-2.acn.waw.pl>

On Sun, 09 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> Can we have hb_gtInfoEx() function accepting 
> <pGT> as its first parameter and then the rest parameters.
> It will help me to control GT behavior from other threads .

   function hb_gtInfoEx( pGT, ... )
      local pCurrGT := hb_gtSelect( pGT ), xResult
      xResult := hb_gtInfo( pGT, ... )
      hb_gtSelect( pCurrGT )
      return xResult

> Also can we retrieve <pGT> for current context, i.e., 
> pGT := hb_gtCurrent() or like ?

   function hb_gtCurrent()
      return hb_gtSelect()

best regards,
Przemek
From dmacias at mail.udg.mx  Tue Nov 11 05:15:17 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov 11 05:15:20 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49195B35.1090303@mail.udg.mx>

Przemek:

Do you have answer about this ?

David Macias


[Przemek]
> ../../thread.c(1240): Error! E029: col(60) symbol '_gettid' has not 
been declared
>
> _gettid() is GCC local function.
> I do not see function which returns directly thread ID in OS2 API.
> Probably it can be extracted from TIB structure returned by
> DosGetInfoBlocks(). I cannot find simpler method. Maurilio can you help?
>

[Maurilio]
> I've not tested this code, but something like this should give you 
the thread id.
> unsigned long _gettid()
> {
>    PTIB   ptib = NULL;
>    APIRET rc;
>
>    rc = DosGetInfoBlocks(&ptib, NULL);
>
>    return ptib->tib_ptib2->tib2_ultid;
> }
> Hope this help.

[Przemek]
>Yes, thanks. I hoped that maybe there is simpler version then using
>DosGetInfoBlocks() but we can also use this. Thank you very much.

Przemek, Maurilio:

I do not know if it is what you are looking for
I found in different places of documentation included in OW
---------
  The macro _threadid can be used to determine the current thread
identifier.
---------

The _threadid macro can be used to determine the current thread
identifier.  It is defined as follows.


      int *__threadid(void);
      #define _threadid (__threadid())

The header file stddef.h contains the definition of the _threadid macro.
---------

_threadid
Prototype in <stddef.h>.

This variable/function may be used to obtain the id of the current
thread which is an int.  In the 32-bit libraries,  _threadid is a
function that returns a pointer to an int.  In the 16-bit libraries,
_threadid is a far pointer to an int.  Note that the value stored where
  _threadid points does not necessarily change when a thread context
switch occurs (so do not make a copy of the pointer ...  it may change).
  To obtain the current thread identifier, simply code:

      int tid = *_threadid;
-------------


So I tried in source\vm\thread.c

---------------
#if defined( HB_OS_OS2 )

#include <stddef.h>       <---- David was here !

ULONG _hb_gettid( void )
{
    ULONG tid = 0;
    PTIB  ptib = NULL;

    printf( "_hb_gettid()\r\n", tid ); fflush(stdout);
/*       <---- David was here !
    if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )
    {
       if( ! ptib )
          { printf( "ptib is NULL\r\n" ); fflush(stdout); }
       else if( !ptib->tib_ptib2 )
          { printf( "ptib->tib_ptib2 is NULL\r\n" ); fflush(stdout); }
       else
          tid = ptib->tib_ptib2->tib2_ultid;
    }
*/

    tid = *_threadid;         <---- David was here !

    printf( "TID=%lu\r\n", tid ); fflush(stdout);

    return tid;
}
#endif
---------------

and mttest02.exe result with values TID=1, 2
---------------
[...]
_hb_gettid()
TID=1
1. hb_threadMutexLock()
_hb_gettid()
TID=2
[...]
---------------

So if _threadid is useful giving same value as GCC _gettid(), then
_hb_gettid() can be discarded and use in harbour\include\hbthread.h:

-----------
//discard
    extern ULONG _hb_gettid( void );

#  if defined( __GNUC__ )
#     define HB_THREAD_SELF()    ( ( TID ) _gettid() )

#  else

// case for OpenWatcom
//   Use something like
   #include <stddef.h>       <---- David was here !
    tid = *_threadid;         <---- David was here !

int vs ULONG ?
In the 32-bit libraries,  _threadid is a function that returns a pointer
to an int

#  else

//discard
#     define HB_THREAD_SELF()    ( ( TID ) _hb_gettid() )
#  endif
-----------


And in this case ( thread ID ) what is happening/using in Windows
OpenWatcom ? It can be used in OS/2 Watcom ?

David Macias



From dmacias at mail.udg.mx  Tue Nov 11 05:15:46 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov 11 05:15:45 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49195B52.9020905@mail.udg.mx>

Przemek:

any comments ?

David Macias


I found in documentation included in OW a sample for multithreading

Entirely page is below
Przemek, can you check page ?

They talk about DosEnterCritSec() and DosExitCritSec() to prevent
collisions between threads

I tested using
   wcl386 -bt=os2 -bm -l=os2v2 mthread

and results are:
------------
Initial thread id = 1
Hi from thread 5
Hi from thread 4
Hi from thread 3
Hi from thread 2
------------

There are this info in doc too

------------
There is a limit to the number of threads an application can create
under 16-bit OS/2.  The default limit is 32.  This limit can be adjusted
by statically initializing the unsigned global variable __MaxThreads.

Under 32-bit OS/2, there is no limit to the number of threads an
application can create.  However, due to the way in which multiple
threads are supported in the Open Watcom libraries, there is a small
performance penalty once the number of threads exceeds the default limit
of 32 (this number includes the initial thread).  If you are creating
more than 32 threads and wish to avoid this performance penalty, you can
redefine the threshold value of 32.  You can statically initialize the
global variable __MaxThreads.

By adding the following line to your multi-threaded application, the new
threshold value will be set to 48.


      unsigned __MaxThreads = { 48 };
------------

David Macias



Let us create a simple multi-threaded application.  The source code for
this example can be found in \watcom\samples\os2.


      #include <process.h>
      #include <stdio.h>
      #include <stddef.h>
      #define INCL_DOS
      #include <os2.h>

      static  volatile int    NumThreads;
      static  volatile int    HoldThreads;

      #define NUM_THREADS     5
      #define STACK_SIZE      32768

      static void a_thread( void *arglist )
      /***********************************/
      {
          while( HoldThreads ) {
              DosSleep( 1 );
          }
          printf( "Hi from thread %d\n", *_threadid );
          DosEnterCritSec();
          --NumThreads;
          DosExitCritSec();
          _endthread();
      }

      int main( void )
      /**************/
      {
          int         i;

          printf( "Initial thread id = %d\n", *_threadid );
          NumThreads = 0;
          HoldThreads = 1;
          /* initial thread counts as 1 */
          for( i = 2; i <= NUM_THREADS; ++i ) {
              if( _beginthread( a_thread, NULL, STACK_SIZE, NULL ) == -1
)
              {
                  printf( "creation of thread %d failed\n", i );
              } else {
                  ++NumThreads;
              }
          }

          HoldThreads = 0;
          while( NumThreads != 0 ) {
              DosSleep( 1 );
          }
          return( 0 );
      }

Note:

  1.In the function a_thread, DosEnterCritSec and DosExitCritSec are
called when we modify the variable NumThreads.  This ensures that the
action of extracting the value of NumThreads from memory, incrementing
the value, and storing the new result into memory, occurs without
interruption.  If these functions were not called, it would be possible
for two threads to extract the value of NumThreads from memory before an
update occurred.

Let us assume that the file mthread.c contains the above example.
Before compiling the file, make sure that the WATCOM environment
variable is set to the directory in which you installed Open Watcom
C/C++.  Also, the INCLUDE environment variable must include the
\watcom\h\os2 and \watcom\h directories ("\WATCOM" is the directory in
which Open Watcom C/C++ was installed).

We can now compile and link the application by issuing the following
command.


      [C:\]wcl386 -bt=os2 -bm -l=os2v2 mthread

The "bm" option must be specified since we are creating a multi-threaded
application.  If your multi-threaded application contains more than one
module, each module must be compiled using the "bm" switch.

The "l" option specifies the target system for which the application is
to be linked.  The system name os2v2 is defined in the file wlsystem.lnk
which is located in the "BINW" subdirectory of the directory in which
you installed Open Watcom C/C++.

The multi-threaded application is now ready to be run.


From druzus at acn.waw.pl  Tue Nov 11 05:21:41 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 05:20:45 2008
Subject: [Harbour] 2008-11-05 03:01 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20427623.post@talk.nabble.com>
References: <20081105020202.GA7319@34-mo7-2.acn.waw.pl>
	<20427623.post@talk.nabble.com>
Message-ID: <20081111102140.GD19736@34-mo7-2.acn.waw.pl>

On Mon, 10 Nov 2008, Petr Chornyj wrote:

Hi Peter,

> Przemyslaw Czerpak-2 wrote:
> > 2008-11-05 03:01 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
> > ..
> >   * harbour/contrib/gtwvg/gtwvg.c
> >     * cover LWA_ALPHA usage by #if ( _WIN32_WINNT >= 0x0500 )
> >       to keep at least compile time compatibility with older systems
> I think is it should be as
> #if ( _WIN32_WINNT >= 0x0500 )
>                      SetWindowLong( pWVT->hWnd,
>                                     GWL_EXSTYLE,
>                                     GetWindowLong( pWVT->hWnd, GWL_EXSTYLE ) | WS_EX_LAYERED );
> 
>                      pWVT->pfnLayered( pWVT->hWnd,
>                                        RGB( 255,255,255 ),
>                                        hb_itemGetNI( pInfo->pNewVal2 ),
>                                        /*LWA_COLORKEY|*/ LWA_ALPHA );
> #endif
> because we can see in winuser.h 
> 
> #if(_WIN32_WINNT >= 0x0500)
> #define WS_EX_LAYERED           0x00080000
> #ifdef

Probably yes but I'm leaving such modifications to authors.
I made the above only to fix compilation process in some C
compilers not to change/fix GTWVG. I do not even know if older
windows versions are supported by this GT.

best regards,
Przemek
From e.m.giordano at emagsoftware.it  Tue Nov 11 05:31:21 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Tue Nov 11 05:31:25 2008
Subject: [Harbour] Clipper RL compilation problem
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu><2632CA93BDBD4352965490C9F327835D@emag>
	<ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
Message-ID: <8EE3B757339649DE8EB1BA86E3742DA2@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: marted? 11 novembre 2008 10.06
Oggetto: Re: [Harbour] Clipper RL compilation problem


> > Why? I agree that PRIVATE/PUBLIC should not be used at all but, 
> > pragmatically speaking, they are very powerful tools sometimes.
>
> Ask yourself why you don't use them :)

I use them sometimes. LOCALs/STATICs don't cover all the uses of 
PRIVATEs/PUBLICs.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From harbour.01 at syenar.hu  Tue Nov 11 05:37:41 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 05:37:47 2008
Subject: [Harbour] Clipper RL compilation problem
In-Reply-To: <20081111100115.GA19736@34-mo7-2.acn.waw.pl>
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>
	<2632CA93BDBD4352965490C9F327835D@emag>
	<ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
	<20081111100115.GA19736@34-mo7-2.acn.waw.pl>
Message-ID: <2BA4D0D3-C721-4816-BFA5-53DA259CC19B@syenar.hu>

Hi Przemek and all,

The point of this e-mail was to solve the RL problem
(with one possible way to solve it) and not debating
PUBLIC/PRIVATE matter in general or even considering
removing them and such, let's please focus on the point.

>> [ Unless there is any other obvious/existing solution
>> for the problem of course. Heavily editing RL sources
>> doesn't count. ]
>
> I do not know the RL tool and it's internal format used
> in .frm but for .mem files we can introduce new format
> which will allow to store memvars with unlimited variable
> name size.

Of course, but how would you solve two way compatibility
for these .mem files?

[ IMO still some cmdline/pragma PRIVATE/PUBLIC var length
limit seems the most reasonable. ]

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 11 05:43:37 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 05:43:43 2008
Subject: [Harbour] Clipper RL compilation problem
In-Reply-To: <8EE3B757339649DE8EB1BA86E3742DA2@emag>
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu><2632CA93BDBD4352965490C9F327835D@emag>
	<ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
	<8EE3B757339649DE8EB1BA86E3742DA2@emag>
Message-ID: <D46EA56B-F56C-45AF-A08B-F27F5D5B03C8@syenar.hu>

Pls see my other mail, no one said we should remove them.

Let's focus on RL and Clipper compatibility.

Brgds,
Viktor

On 2008.11.11., at 11:31, Enrico Maria Giordano wrote:

>
> -----Messaggio Originale----- Da: "Szak?ts Viktor" <harbour.01@syenar.hu 
> >
> A: "Harbour Project Main Developer List." <harbour@harbour- 
> project.org>
> Data invio: marted? 11 novembre 2008 10.06
> Oggetto: Re: [Harbour] Clipper RL compilation problem
>
>
>> > Why? I agree that PRIVATE/PUBLIC should not be used at all but, >  
>> pragmatically speaking, they are very powerful tools sometimes.
>>
>> Ask yourself why you don't use them :)
>
> I use them sometimes. LOCALs/STATICs don't cover all the uses of  
> PRIVATEs/PUBLICs.
>
> EMG
>
> --
> EMAG Software Homepage:     http://www.emagsoftware.it
> The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
> The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
> The EMG Music page:         http://www.emagsoftware.it/emgmusic
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From e.m.giordano at emagsoftware.it  Tue Nov 11 05:51:54 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Tue Nov 11 05:51:58 2008
Subject: [Harbour] Clipper RL compilation problem
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu><2632CA93BDBD4352965490C9F327835D@emag><ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu><8EE3B757339649DE8EB1BA86E3742DA2@emag>
	<D46EA56B-F56C-45AF-A08B-F27F5D5B03C8@syenar.hu>
Message-ID: <BCF663EF6D514C9BA1729741D279FD3E@emag>


-----Messaggio Originale----- 
Da: "Szak?ts Viktor" <harbour.01@syenar.hu>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: marted? 11 novembre 2008 11.43
Oggetto: Re: [Harbour] Clipper RL compilation problem


> > I use them sometimes. LOCALs/STATICs don't cover all the uses of
> > PRIVATEs/PUBLICs.
>
> Pls see my other mail, no one said we should remove them.

Agreed. But you stated:

> I had thought that we could limit PRIVATE/
> PUBLIC var names to ten chars at runtime for
> compatibility. PRIVATE/PUBLIC is not something
> users want to use for new code,

and I was simply thinking why don't keep long names for PRIVATE/PUBLIC.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From toninhofwi at yahoo.com.br  Tue Nov 11 07:07:58 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Tue Nov 11 06:04:29 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <20081110155802.GA20136@34-mo7-2.acn.waw.pl>
References: <7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
	<n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
	<95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
	<p7ogh4ds0ovjpjnes4prf89kt435sua6vk@4ax.com>
	<20081110155802.GA20136@34-mo7-2.acn.waw.pl>
Message-ID: <gvsih4dg55i5rk7k738md3ukbqpdr3ijdu@4ax.com>

>Hi Toninho,
>
>You can make some experiments with DEFAULT_GRANULARITY, f.e.:
>   set C_USR=-DDEFAULT_GRANULARITY=0x100000

Hi Przemek thanks for your hint, 

I see that the best value for windows vista is about 10000. Thinking
in this I made 3 functions to change this dlmalloc values without need
recompile harbour.

 Where is the best place to save it? 

---cut---
int mallopt( int parameter_number, int parameter_value );

#define M_TRIM_THRESHOLD     (-1)
#define M_GRANULARITY        (-2)
#define M_MMAP_THRESHOLD     (-3)

HB_FUNC( MALLOCSETGRANULARITY )
{
   mallopt( M_GRANULARITY, hb_parnl( 1 ) );
}

HB_FUNC( MALLOCSETTRIMTHRESHOLD )
{
   mallopt( M_TRIM_THRESHOLD, hb_parnl( 1 ) );
}

HB_FUNC( MALLOCSETMMAPTHRESHOLD )
{
   mallopt( M_MMAP_THRESHOLD, hb_parnl( 1 ) );
}
---cut---


Thanks and best regards,

Toninho.

__________________________________________________
Faa ligaes para outros computadores com o novo Yahoo! Messenger 
http://br.beta.messenger.yahoo.com/ 
From harbour.01 at syenar.hu  Tue Nov 11 06:09:34 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 06:09:48 2008
Subject: [Harbour] 2008-11-11 12:08 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c943ed$Blat.v2.6.2$fa7d36f0$1680f39d8d1a@127.0.0.1>

2008-11-11 12:08 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/console.c
    ! Fixed __EJECT() writing an EJECT only if output device 
      was "PRINTER". This fixes problem reported by Ciro, and 
      also a very old TOFIX which was removed very long ago 
      by mistake. (see thread "Bug: __EJECT() (David)" on 2000-07-27)
      [TOMERGE 1.0]

  * source/rtl/treport.prg
    ! Fixed some linefeed differences.
      [TOMERGE 1.0]

  * source/vm/set.c
    * Minor formatting.
--
Brgds,
Viktor

From mbelgrano at deltain.it  Tue Nov 11 06:20:26 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Tue Nov 11 06:21:22 2008
Subject: [Harbour] How to implement remote printing in Harbour
In-Reply-To: <20432275.post@talk.nabble.com>
References: <20432275.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F173@SRV02.deltain.net>

You can reference to printer with two way
Reference vy  Publicip\privateip\port of printer (only Ethernet printer)
Server machine can enumerate aivable remote printer and made aivable to
client like in terminal server session
Set device to remote/local/either will switch how getprinters works

Please Can you give me with is correct  username a password


-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Tuesday, November 11, 2008 3:15 AM
To: harbour@harbour-project.org
Subject: [Harbour] How to implement remote printing in Harbour


Hello All

How can I implement remote printing at the client terminal.

I am using TCP/IP protocol, I mean hb_INet* functions to have 
my own terminal. ( anybody interested can download
http://www.vouch.info/downloads/vouchclient.zip 
  user1/user1 ~ user9/user9  userid/password )

I need something to feed as <cPrinter> to SET PRINTER TO ( cPrinter )
command.
Server knows the client's IP address. OR any other alternative.

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/How-to-implement-remote-printing-in-Harbour-tp2043
2275p20432275.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From dmacias at mail.udg.mx  Tue Nov 11 06:26:38 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov 11 06:26:38 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49196BEE.6030306@mail.udg.mx>

Przemek:

 >So it's general problem with accessing console from other threads.

 >To be precise it's KbdPeek() and kbhit() is probably simple wrapper to 
 >it.
 >It means that OW internals are also effected by this problem.
 >The question is if it can be resolved or not. Is it OW bug or problem
 >with OS2 API. In GCC it seems to be resolved. The question is how.

 >It does not have to be printf() behavior. 1-st it's always better to
 >redirect output to file to eliminate possible overwriting. The
 >second problem can be caused by possible compile time optimizations
 >which can change the order of executed instructions. In such case is
 >always good to pass to printf() some pointers to variables which are
 >used in function you want to trace to disable such optimization.
 >It's the reason why I added s_key pointer to "0. hb_gt_os2_ReadKey(%p)"
 >though in this case seems that it wasn't help though I'm not sure
 >you replicated it.

In all these tests I use outputs to screen and file and they do not show 
differences in these cases
I was not aware of "optimization" and/or "to pass to printf() some 
pointers" so at last it was not replicated

 >Many thanks for detail tests. We know the problem and now we will have
 >to find workaround for it. We can make it in simple way and disable
 >input for non main thread. BTW can you check if keyboard input works
 >correctly in GCC builds for all threads, f.e. inm code like:

Using this code with current Harbour
-------------
    proc main()
    hb_threadJoin( hb_threadStart( @thFunc() ) )
    return
    proc thFunc()
    local k
       while (k:=inkey(0)) != 27
          ? k
       enddo
    return
-------------

the results are:

gcc335
======
--------------------
[E:\harbour811\harbour] bld_os2.cmd pba3 mt
Harbour 1.1.0dev (Rev. 9903)
Copyright (c) 1999-2008, http://www.harbour-project.org/
Compiling 'pba3.prg'...
Lines 10, Functions/Procedures 2
Generating C source output to 'pba3.c'... Done.

[E:\harbour811\harbour]pba3.exe

         97
        115
        100
        102
        103
        104
--------------------

OpenWatcom 1.7a
===============
--------------------
[E:\harbour811\harbour]bin\pbaos2.cmd -mt pba3
Open Watcom Linker Version 1.7
Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See http://www.openwatcom.org/ for details.
loading object files
searching libraries
creating an OS/2 32-bit executable
[E:\harbour811\harbour]pba3.exe
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
--------------------


 >OS2 KBD API has functions KbdGetFocus() and KbdFreeFocus(). It's possible
 >that they will resolve the problem for keyboard input.
 >Finally we can simply check in GCC source what exactly it does to
 >resolve the problem. Seeing Maurilio comment in gtos2.c I guess that GCC
 > for OS2 has its own KbdCharIn() instead of direct mapping:
 >   #define KbdCharIn          KBD16CHARIN
 >and inside this function the problem is resolved. But I only guess.
 >I haven't ever seen this compiler.
 >For someone who has some experience with OS2 API the problem should
 >be easy to resolve or find workaround or give us an answer if it can 
 >work.

I do not know what is KbdCharIn and KBD16CHARIN but two seem to be 
funtions/procedures
  KbdCharIn is in list of OS/2 API anywhere
  KBD16CHARIN, searching in Google/Lycos/HotBot/... appears few times 
and never explain what is and/or where is

David Macias

From druzus at acn.waw.pl  Tue Nov 11 06:35:20 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 06:34:25 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49195B35.1090303@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49195B35.1090303@mail.udg.mx>
Message-ID: <20081111113520.GA22015@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Do you have answer about this ?

But was it the question?

> I do not know if it is what you are looking for
> I found in different places of documentation included in OW
> ---------
>  The macro _threadid can be used to determine the current thread
> identifier.
> ---------
> The _threadid macro can be used to determine the current thread
> identifier.  It is defined as follows.
>      int *__threadid(void);
>      #define _threadid (__threadid())
> The header file stddef.h contains the definition of the _threadid macro.
> ---------
> _threadid
> Prototype in <stddef.h>.
>
> This variable/function may be used to obtain the id of the current
> thread which is an int.  In the 32-bit libraries,  _threadid is a
> function that returns a pointer to an int.  In the 16-bit libraries,
> _threadid is a far pointer to an int.  Note that the value stored where
>  _threadid points does not necessarily change when a thread context
> switch occurs (so do not make a copy of the pointer ...  it may change).
>  To obtain the current thread identifier, simply code:
>      int tid = *_threadid;
> -------------
> So I tried in source\vm\thread.c
> ---------------
> #if defined( HB_OS_OS2 )
> #include <stddef.h>       <---- David was here !
> ULONG _hb_gettid( void )
> {
>    ULONG tid = 0;
>    PTIB  ptib = NULL;
>
>    printf( "_hb_gettid()\r\n", tid ); fflush(stdout);
> /*       <---- David was here !
>    if( DosGetInfoBlocks( &ptib, NULL ) == NO_ERROR )
>    {
>       if( ! ptib )
>          { printf( "ptib is NULL\r\n" ); fflush(stdout); }
>       else if( !ptib->tib_ptib2 )
>          { printf( "ptib->tib_ptib2 is NULL\r\n" ); fflush(stdout); }
>       else
>          tid = ptib->tib_ptib2->tib2_ultid;
>    }
> */
>
>    tid = *_threadid;         <---- David was here !
>
>    printf( "TID=%lu\r\n", tid ); fflush(stdout);
>
>    return tid;
> }
> #endif
> ---------------
> and mttest02.exe result with values TID=1, 2
> ---------------
> [...]
> _hb_gettid()
> TID=1
> 1. hb_threadMutexLock()
> _hb_gettid()
> TID=2
> [...]
> ---------------
> So if _threadid is useful giving same value as GCC _gettid(), then
> _hb_gettid() can be discarded and use in harbour\include\hbthread.h:

Yes, thanks for information. We can use it but it will not change
too much for us with the exception that it will force using _beginthread()
because __threadid() in OW returns pointer to member of structure
initialized inside _beginthread().
I was asking about OS2 API call to not introduce such dependencies.

> #  if defined( __GNUC__ )
> #     define HB_THREAD_SELF()    ( ( TID ) _gettid() )
> #  else
> // case for OpenWatcom
> //   Use something like
>   #include <stddef.h>       <---- David was here !
>    tid = *_threadid;         <---- David was here !
> int vs ULONG ?
> In the 32-bit libraries,  _threadid is a function that returns a pointer
> to an int
> #  else
> //discard
> #     define HB_THREAD_SELF()    ( ( TID ) _hb_gettid() )
> #  endif
> -----------
> And in this case ( thread ID ) what is happening/using in Windows
> OpenWatcom ? It can be used in OS/2 Watcom ?

Yes. If you want to use it it's enough to make:

#  if defined( __GNUC__ )
#     define HB_THREAD_SELF()    ( ( TID ) _gettid() )
#  elif defined( __WATCOMC__ )
#     define HB_THREAD_SELF()    ( ( TID ) ( * _threadid ) )
#  else
#     define HB_THREAD_SELF()    ( ( TID ) _hb_gettid() )
#  endif

I do not know the cost of calling DosGetInfoBlocks() in OS2.
It's highly possible that using OW _threadid will be much
more faster. In such case we should commit above modification.
Anyhow we should also keep _hb_gettid() because it may be usable
in the future if we will want to eliminate CRTL in thread API.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 06:50:24 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 06:49:26 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49195B52.9020905@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49195B52.9020905@mail.udg.mx>
Message-ID: <20081111115024.GB22015@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Przemek:
> any comments ?

Thanks for the example but it does not help us in the problem we have.

> I found in documentation included in OW a sample for multithreading
> Entirely page is below
> Przemek, can you check page ?
> They talk about DosEnterCritSec() and DosExitCritSec() to prevent
> collisions between threads

They are used to protect access to static variable used in this example
but it's not related to OW thread creation code.
BTW Using DosEnterCritSec() for such protection is not good idea.
This function in OS2 makes different thing then in EnterCriticalSection()
in Windows. It stops _ALL_ other threads. So it can be used in such
example but it's not good synchronization method for MT programs if
you do not want to kill scalability. Anyhow it's not bound with
the KBD problem.

>      [C:\]wcl386 -bt=os2 -bm -l=os2v2 mthread

You can make some experiments with -bt swich and use explicitly
os2v2 or os2v2_pm.
I do not know the exact internal dependencies between above and
using OS2 API in 16bit subsytems like keyboard drivers.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Nov 11 06:53:04 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 06:53:11 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <gvsih4dg55i5rk7k738md3ukbqpdr3ijdu@4ax.com>
References: <7B765DE257F44F14918A60415D7D1C51@emag>
	<70A3D876-D85B-4EBC-B62F-8DA4EA01C218@syenar.hu>
	<lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
	<n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
	<95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
	<p7ogh4ds0ovjpjnes4prf89kt435sua6vk@4ax.com>
	<20081110155802.GA20136@34-mo7-2.acn.waw.pl>
	<gvsih4dg55i5rk7k738md3ukbqpdr3ijdu@4ax.com>
Message-ID: <F4D2F75A-2DCA-4082-833B-A4934DAB2F64@syenar.hu>

Hi Toninho,

IMO, these values should be preconfigured by Harbour (at
compile time or runtime) for best values decided by the
development team's (our) best judgement and at most offered
as overrides for defaults in the form of build-time tuning
or internal cmdline options (but I'd even avoid that, too).

It's IMO not the final users job to decide on such internal
details on the .prg level.

Moreover it's specific to one of our possible MM choices,
so it cannot be made a generic Harbour setting. We should
also remember that we may want to switch MMs in the future.

Questions are:
- Which value of the three should be 10000?
- Does it enhance performance for both XP and Vista, or just Vista?
- Did you get your results using a specific app or our
   speed testing tools?
- If it was an app, was it a GUI, and with which GUI framework?

Brgds,
Viktor

On 2008.11.11., at 13:07, Toninho@fwi wrote:

>> Hi Toninho,
>>
>> You can make some experiments with DEFAULT_GRANULARITY, f.e.:
>>  set C_USR=-DDEFAULT_GRANULARITY=0x100000
>
> Hi Przemek thanks for your hint,
>
> I see that the best value for windows vista is about 10000. Thinking
> in this I made 3 functions to change this dlmalloc values without need
> recompile harbour.
>
> Where is the best place to save it?
>
> ---cut---
> int mallopt( int parameter_number, int parameter_value );
>
> #define M_TRIM_THRESHOLD     (-1)
> #define M_GRANULARITY        (-2)
> #define M_MMAP_THRESHOLD     (-3)
>
> HB_FUNC( MALLOCSETGRANULARITY )
> {
>   mallopt( M_GRANULARITY, hb_parnl( 1 ) );
> }
>
> HB_FUNC( MALLOCSETTRIMTHRESHOLD )
> {
>   mallopt( M_TRIM_THRESHOLD, hb_parnl( 1 ) );
> }
>
> HB_FUNC( MALLOCSETMMAPTHRESHOLD )
> {
>   mallopt( M_MMAP_THRESHOLD, hb_parnl( 1 ) );
> }
> ---cut---
>
>
> Thanks and best regards,
>
> Toninho.
>
> __________________________________________________
> Fa?a liga??es para outros computadores com o novo Yahoo! Messenger
> http://br.beta.messenger.yahoo.com/
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Tue Nov 11 07:18:49 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 07:18:53 2008
Subject: [Harbour] 2008-11-11 13:16 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c943f7$Blat.v2.6.2$a70d8416$12a0c2705ac0@127.0.0.1>

2008-11-11 13:16 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
  * ChangeLog
    ! Fixed MT mode .dll not starting up properly. IOW now 
      'hbmk -shared -mt' works. Relevant entries marked as 
      [DONE]

  * bin/hbmk.bat
    + Added '-debug' switch. Currently supported in BCC and MSVC.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 11 07:57:45 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 07:57:49 2008
Subject: [Harbour] 2008-11-11 13:30 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c943fd$Blat.v2.6.2$17660f62$6303c1ab16c@127.0.0.1>

2008-11-11 13:30 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
    + hbmk.bat and hbmk_*.bat will now be installed on 'make*.bat install'
--
Brgds,
Viktor

From cvc at oohg.org  Tue Nov 11 08:03:29 2008
From: cvc at oohg.org (Ciro Vargas Clemow)
Date: Tue Nov 11 08:03:40 2008
Subject: [Harbour] 2008-11-11 12:08 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c943ed$Blat.v2.6.2$fa7d36f0$1680f39d8d1a@127.0.0.1>
References: <01c943ed$Blat.v2.6.2$fa7d36f0$1680f39d8d1a@127.0.0.1>
Message-ID: <491982A1.1030200@oohg.org>

Szak?ts Viktor escribi?:
> 2008-11-11 12:08 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
>   * source/rtl/console.c
>     ! Fixed __EJECT() writing an EJECT only if output device 
>       was "PRINTER". This fixes problem reported by Ciro, and 
>       also a very old TOFIX which was removed very long ago 
>       by mistake. (see thread "Bug: __EJECT() (David)" on 2000-07-27)
>       [TOMERGE 1.0]


Very Thanks Victor, this problem make me crazy for many weeks in a production 
environment aplication.

best regards
Ciro

> 
>   * source/rtl/treport.prg
>     ! Fixed some linefeed differences.
>       [TOMERGE 1.0]
> 
>   * source/vm/set.c
>     * Minor formatting.
> --
> Brgds,
> Viktor
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 


-- 
http://sistemascvc.tripod.com  (la casa del clip2win y nodosimp / the no2imp and 
clip2win home )

http://www.oohg.org ( Object Oriented Harbour GUI, more simple, more powerfull )


From harbour.01 at syenar.hu  Tue Nov 11 08:09:44 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 08:09:50 2008
Subject: [Harbour] SF bugtracker#1672301: Charset Mapping CP437 or CP850
	(not documentated ?)
In-Reply-To: <1A07FEDC778C3E4AA417F089511F859C03333A41CD@Mail-yoq.SYNEL-COMPANY.LTD>
References: <1A07FEDC778C3E4AA417F089511F859C03333A41CD@Mail-yoq.SYNEL-COMPANY.LTD>
Message-ID: <54189D5F-ED14-45AD-BCF5-3A90F38F705F@syenar.hu>

Hi Chen,

Welcome back and hats off for digging through all these
messages :)

I don't know the answer to this problem, but I've also
found the codepage a problem in terminals (and also
keyboard handling), so I use GTXWC and GTWVT, which are
better at solving these. Moreover I'll switch my apps
to standard codepages (ISO-8859-*) as soon as the
Windows transition period is over and DOS backward
compatibility is no more a concern. This will be quite
a feat (database/settings/interfaces also need to be
converted), but IMO there is no better/cleaner portable
option.

Brgds,
Viktor

On 2008.11.11., at 8:32, Chen Kedem wrote:

> This is more than a year old report / feature request about locale  
> maping.
> After reading the recent codepage discussion here on the list, I put  
> this as a reminder
> that might help users porting thier DOS application to *nix world.
>
> http://sourceforge.net/tracker/index.php?func=detail&aid=1672301&group_id=681&atid=100681
>
>
>  Chen.
>
> [I was away for a while and just finished reading more that 100  
> digest (!) posts from this list]
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From maurilio.longo at libero.it  Tue Nov 11 08:24:59 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Tue Nov 11 08:26:48 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20081110150435.GA30209@34-mo7-2.acn.waw.pl>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>	<4917C4DB.2000502@mail.udg.mx>
	<49183C2A.9080503@libero.it>
	<20081110150435.GA30209@34-mo7-2.acn.waw.pl>
Message-ID: <491987AB.5080301@libero.it>

Przemyslaw,

> To be precise the problem is with any console input and it's inside pure
> OS2 API functions. It means that we probably using them in wrong way.

I attach here kbCharIn docs

---------8<--------------
Reads a character data record from the keyboard.


#define INCL_KBD
#include <os2.h>

PKBDKEYINFO    CharData;  /*  Pointer to character data. */
ULONG          Wait;      /*  Wait Flag. */
HKBD           hkbd;      /*  Reserved.  Must be 0. */
APIRET         rc;        /*  Return code. */

rc = KbdCharIn(CharData, Wait, hkbd);


CharData (PKBDKEYINFO) - output
Pointer to character data.

A pointer to a KBDKEYINFO structure in which the character data is returned.

Wait (ULONG) - input
Wait Flag.


0 IO_WAIT
Wait for a keystroke if one is not available. The keystroke returned is
removed from the queue.
1 IO_NOWAIT
Return immediately, with or without a keystroke. If a keystroke is returned,
remove it from the queue.
2 IO_PEEK
Return immediately, with or without a keystroke. Do not remove the keystroke
from the queue.
3 IO_PEEKWAIT
Wait for a keystroke if one is not available. Return the keystroke but do not
remove it from the queue.

hkbd (HKBD) - input
Reserved. Must be 0.

rc (APIRET) - returns
Return code.

KbdCharIn returns one of the following values:

0 NO_ERROR
375 ERROR_KBD_INVALID_IOWAIT
445 ERROR_KBD_FOCUS_REQUIRED
447 ERROR_KBD_KEYBOARD_BUSY
504 ERROR_KBD_EXTENDED_SG

Note: KbdCharIn returns a complete keystroke. This behavior is unlike the OS/2
1.3 version, which returned only a single byte. This affects only double-byte
character set (DBCS) characters.


If bit 0 of fbStatus is set, the character returned is either 0 or 0xe0. The
Unicode character contains the virtual key.

For valid characters, the character in the current code page is returned, and
the Unicode character contains the Unicode encoding of the character.

On an enhanced keyboard, the secondary enter key returns the normal character
0DH and a scan code of E0H.

Extended ASCII codes are identified by bit 1 of the status byte being set to
on, and the ASCII character code being either 00H or E0H. Both conditions must
be satisfied for the character to be an extended keystroke. For extended ASCII
codes, the scan-code byte returned is the second code (extended code).
Usually, the extended ASCII code is the scan code of the primary key that was
pressed.

A thread in the foreground session that repeatedly polls the keyboard with
KbdCharIn (with no wait), can prevent all regular priority-class threads from
executing. If polling must be used, and a minimal amount of other processing
is being performed, the thread should periodically yield to the CPU by issuing
a DosSleep call for an interval of at least 5 milliseconds.

---------8<--------------

> It may works for GCC because it may use some wrappers which resolve the
> problem or hide it. I would be good to find what exactly it does because
> it's a risk that the problem will be exploited also in some GCC builds.
> First we should check keyboard input and disable mouse code. It should
> give some answers which probably will also help to resolve problem with
> mouse. We can easy disable mouse code for tests by removing:
>    if( ch == 0 )
>       ch = HB_GTSELF_MOUSEREADKEY( pGT, iEventMask );
> from hb_gt_os2_ReadKey().
> Now when 2-nd thread calls:
> 
>    KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk );
> 
> it fails with internal error. In OW this call is directly translated by:
> 
>    #define KbdCharIn          KBD16CHARIN
> 
> inside bsesub.h.

I don't think GCC does this, it has kbdCharIn in two .h files:

1)  os2tk.h (i read it as os2toolkit) which has a

#define KBD16CHARIN             KbdCharIn

2) os2emx.h which has

USHORT APIENTRY KbdCharIn (PKBDKEYINFO pkbci, USHORT fWait, HKBD hkbd);

No other references are to be found.

> Why does it fail?

I don't know, but I remember that I started working on harbour for OS/2
exactly for the same problem, sometimes it was GPFing without reason and I
traced that reason to two things:

1) KBD code not using tiled memory
2) gtos2.c code calling video functions (VioXXX) and not using tiled memory.

You need to use tiled memory because OS/2 drivers are 16 bit protected memory
code and I think that, maybe, OW code does not respect this requirement.

BTW, when I started hacking harbour code, back in year 2000, harbour was being
built using ICC (IBM C Set compiler) which is long gone. You can see those
first changes inside current changelog and that comment of mine was about this
fact (OS/2 ToolKit was ICC OS/2 specific bindings).

20000330-23:04 GMT+1 Maurilio Longo <maurilio.longo@libero.it>

        * include/hbvmpub.h
          ! with OS/2 GCC pragma pack(8) is not valid
        * source/rtl/gtos2/gtos2.c
          * with OS/2 GCC kbhit() is not available (it's a ToolKit function)

2001-02-26 22:59 GMT+1 Maurilio Longo <maurilio.longo@libero.it>
   * source/rtl/gtos2/gtos2.c
     ! hb_gt_ReadKey() uses KBD subsystem of OS/2 instead of any compiler
runtime function to fetch characters from keyboard this way I can be sure that
used memory is tileable.


> Why we have s_hk which is only low memory block initialized to NULL?
> This code efectively works like:
>    KbdCharIn( s_key, IO_NOWAIT, NULL );

Uhm, I'm not sure, but I think that since it has to receive a pointer to a
tiled memory area, this was to be sure that the memory was really tiled.

> so why we have s_hk variable if it does nothing?
> OS2 API contains KbdGetFocus() and KbdFreeFocus(). If we begin to use
> them to protect  can it help us?
> 

I think they're old, deprecated functions from the 1.x times, my docs don't
have them listed.

> You left this comment in gtos2.c:
>    #if defined(HB_OS_OS2_GCC)
>       /* 25/03/2000 - maurilio.longo@libero.it
>       OS/2 GCC hasn't got ToolKit headers available */
>       #include <stdlib.h>
>    #else
>       #include <bsedos.h>
>       #ifndef KBDTRF_EXTENDED_CODE
>          #define KBDTRF_EXTENDED_CODE 0x02
>       #endif
>    #endif
> 
> It suggests me that in GCC builds KbdCharIn() is not directly translated
> to KBD16CHARIN() but it's a wrapper function. Can you check its body and
> what it exactly does? If the problem is not solved by some external setting
> then the answer should be here.
> 

I'll have a look at gcc code and let you know.

Anyway, this code works ok when built using GCC:

function main()
   hb_threadStart( @t() )
   inkey(100)
return

function t()
    local n := 10
    while n-- > 0
      inkey( 1 )
    enddo
return

Just an ugly test, anyway no GPF.

Best regards.

Maurilio.

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.



From gvarona at ec-red.com  Tue Nov 11 09:02:06 2008
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Tue Nov 11 09:02:06 2008
Subject: [Harbour] Printer list
In-Reply-To: <13AE2F46-07B0-42C2-A1EB-4A266B5D945A@syenar.hu>
References: <4917A5EB.10608@ec-red.com>	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>	<491855BF.3080503@ec-red.com>	<54B0827F-91CE-44CF-857F-F0DFBC5342ED@syenar.hu>	<49189EA1.80202@ec-red.com>
	<13AE2F46-07B0-42C2-A1EB-4A266B5D945A@syenar.hu>
Message-ID: <4919905E.20305@ec-red.com>

Szak?ts Viktor escribi?:
>>> 'sh make_gnu.sh install'
>>>
>>> This works here with 4.1.2, but should also with 3.4.5.
>>
>> But I am using Windows XP + Harbour (SVN) + MinGW, and this, ('sh 
>> make_gnu.sh install' ), is for Linux.
>> What would it be for WinXP?
>
> It is for XP, just try. 'sh' is part of msys.
But I do not use MSYS, at least not what I've been using.
Well, I installed and investigated.

> [ Despite some drawbacks (you have to use forward
> slash dir seps and no drive name in your HB_*_INSTALL
> and HB_INC_* macros), this method looks much more
> solid (and even quicker) than command.com forced
> version. It also works without additional environment
> hacks. ]
Well, we also look into this.

Thank very much

Best Regards
GVS
From druzus at acn.waw.pl  Tue Nov 11 09:56:44 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 09:55:56 2008
Subject: [Harbour] 2008-11-11 15:56 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081111145644.GA3148@34-mo7-2.acn.waw.pl>

2008-11-11 15:56 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbcompdf.h
  * harbour/source/compiler/harbour.yyc
  * harbour/source/compiler/harbour.y
    ! fixed compile time warnings for __enum* messages used in
      simpled code block variables inside FOR EACH statement,

best regards
Przemek
From mbelgrano at deltain.it  Tue Nov 11 10:19:58 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Tue Nov 11 10:27:38 2008
Subject: [Harbour] FreeBSD harbour port maintainer 
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F177@SRV02.deltain.net>

Follow from harbour user mailing list
>P.S.  If anyone here is the FreeBSD harbour port maintainer or has
contact with him/her, the version of Harbour in the FreeBSD
> ports tree is 0.44.0. 
>It looks like it might be time for an update.

Massimo Belgrano

From toninhofwi at yahoo.com.br  Tue Nov 11 11:43:35 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Tue Nov 11 10:40:06 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <F4D2F75A-2DCA-4082-833B-A4934DAB2F64@syenar.hu>
References: <lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
	<n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
	<95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
	<p7ogh4ds0ovjpjnes4prf89kt435sua6vk@4ax.com>
	<20081110155802.GA20136@34-mo7-2.acn.waw.pl>
	<gvsih4dg55i5rk7k738md3ukbqpdr3ijdu@4ax.com>
	<F4D2F75A-2DCA-4082-833B-A4934DAB2F64@syenar.hu>
Message-ID: <41cjh4dr9to7k3nqq5c7kdak0996q89t9l@4ax.com>

>Hi Toninho,
>
>IMO, these values should be preconfigured by Harbour (at
>compile time or runtime) for best values decided by the
>development team's (our) best judgement and at most offered
>as overrides for defaults in the form of build-time tuning
>or internal cmdline options (but I'd even avoid that, too).
Hi Viktor, I agree

>It's IMO not the final users job to decide on such internal
>details on the .prg level.
Of course not, but I?m my intention is have a way to easy test what is
the best value, without recompile Harbour each time. 

>Moreover it's specific to one of our possible MM choices,
>so it cannot be made a generic Harbour setting. We should
>also remember that we may want to switch MMs in the future.
I know, are there a way to detect if we are using dlmalloc ?  If yes,
we can accept arguments from memtst.prg like:
memtest 10000

>Questions are:
>- Which value of the three should be 10000?
Need be tested, my functions made such tests easy.

>- Does it enhance performance for both XP and Vista, or just Vista?
Both, but bcc6.10 memory manager continues win in memtst. I need to
more accurate test to tell how is the best.

>- Did you get your results using a specific app or our
>   speed testing tools?
Only memtst. But I see in my final app that using dlmalloc it is more
slow than native bcc 6.10 mm.

>- If it was an app, was it a GUI, and with which GUI framework?
I use FWH only.


Thanks and best regards,

Toninho.
]

__________________________________________________
Fa?a liga??es para outros computadores com o novo Yahoo! Messenger 
http://br.beta.messenger.yahoo.com/ 
From maurilio.longo at libero.it  Tue Nov 11 11:19:06 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Tue Nov 11 11:19:15 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <49196BEE.6030306@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49196BEE.6030306@mail.udg.mx>
Message-ID: <4919B07A.1060106@libero.it>

David,

what do you use to build harbour with watcom?

On my pc, simply trying to build a single .c file from the ide gives a trap
inside OS2KRNL, so I fear it is not SMP ready.

Maurilio.

David Arturo Macias Corona wrote:
> Przemek:
> 
>>So it's general problem with accessing console from other threads.
> 
>>To be precise it's KbdPeek() and kbhit() is probably simple wrapper to
>>it.
>>It means that OW internals are also effected by this problem.
>>The question is if it can be resolved or not. Is it OW bug or problem
>>with OS2 API. In GCC it seems to be resolved. The question is how.
> 
>>It does not have to be printf() behavior. 1-st it's always better to
>>redirect output to file to eliminate possible overwriting. The
>>second problem can be caused by possible compile time optimizations
>>which can change the order of executed instructions. In such case is
>>always good to pass to printf() some pointers to variables which are
>>used in function you want to trace to disable such optimization.
>>It's the reason why I added s_key pointer to "0. hb_gt_os2_ReadKey(%p)"
>>though in this case seems that it wasn't help though I'm not sure
>>you replicated it.
> 
> In all these tests I use outputs to screen and file and they do not show
> differences in these cases
> I was not aware of "optimization" and/or "to pass to printf() some
> pointers" so at last it was not replicated
> 
>>Many thanks for detail tests. We know the problem and now we will have
>>to find workaround for it. We can make it in simple way and disable
>>input for non main thread. BTW can you check if keyboard input works
>>correctly in GCC builds for all threads, f.e. inm code like:
> 
> Using this code with current Harbour
> -------------
>    proc main()
>    hb_threadJoin( hb_threadStart( @thFunc() ) )
>    return
>    proc thFunc()
>    local k
>       while (k:=inkey(0)) != 27
>          ? k
>       enddo
>    return
> -------------
> 
> the results are:
> 
> gcc335
> ======
> --------------------
> [E:\harbour811\harbour] bld_os2.cmd pba3 mt
> Harbour 1.1.0dev (Rev. 9903)
> Copyright (c) 1999-2008, http://www.harbour-project.org/
> Compiling 'pba3.prg'...
> Lines 10, Functions/Procedures 2
> Generating C source output to 'pba3.c'... Done.
> 
> [E:\harbour811\harbour]pba3.exe
> 
>         97
>        115
>        100
>        102
>        103
>        104
> --------------------
> 
> OpenWatcom 1.7a
> ===============
> --------------------
> [E:\harbour811\harbour]bin\pbaos2.cmd -mt pba3
> Open Watcom Linker Version 1.7
> Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
> Source code is available under the Sybase Open Watcom Public License.
> See http://www.openwatcom.org/ for details.
> loading object files
> searching libraries
> creating an OS/2 32-bit executable
> [E:\harbour811\harbour]pba3.exe
> SYS1808:
> The process has stopped.  The software diagnostic
> code (exception code) is  0001.
> --------------------
> 
> 
>>OS2 KBD API has functions KbdGetFocus() and KbdFreeFocus(). It's possible
>>that they will resolve the problem for keyboard input.
>>Finally we can simply check in GCC source what exactly it does to
>>resolve the problem. Seeing Maurilio comment in gtos2.c I guess that GCC
>> for OS2 has its own KbdCharIn() instead of direct mapping:
>>   #define KbdCharIn          KBD16CHARIN
>>and inside this function the problem is resolved. But I only guess.
>>I haven't ever seen this compiler.
>>For someone who has some experience with OS2 API the problem should
>>be easy to resolve or find workaround or give us an answer if it can
>>work.
> 
> I do not know what is KbdCharIn and KBD16CHARIN but two seem to be
> funtions/procedures
>  KbdCharIn is in list of OS/2 API anywhere
>  KBD16CHARIN, searching in Google/Lycos/HotBot/... appears few times and
> never explain what is and/or where is
> 
> David Macias
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From joe_bernardes at yahoo.com.br  Tue Nov 11 11:35:46 2008
From: joe_bernardes at yahoo.com.br (Joel M Bernardes)
Date: Tue Nov 11 11:35:50 2008
Subject: [Harbour] Compiler source code SVN
In-Reply-To: <2D168F74-7C8E-4B04-A21B-BBEDD41BFB32@syenar.hu>
Message-ID: <149781.86055.qm@web51905.mail.re2.yahoo.com>

Hi? Viktor
Thank you for the help.? 
? 
I got to compile the sources in Linux (Centos-5.2) and also in WinXP-(Msys+MingW).? 
I don't get to generate executable in Linux or Win32., that gives same error below.
Does it can me to help with more this?

*****************************************************************************
ERROR.

Harbour Make 1.1.0dev (Rev. 9710)
Copyright (c) 2000-2008, http://www.harbour-project.org/


Program had errors, check a.log
[root@mail temp]#
****************************************************************************
Brgds,
Joel Bernardes

--- Em seg, 10/11/08, Szak?ts Viktor <harbour.01@syenar.hu> escreveu:
De: Szak?ts Viktor <harbour.01@syenar.hu>
Assunto: Re: [Harbour] Compiler source code SVN
Para: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data: Segunda-feira, 10 de Novembro de 2008, 20:58

Hi Joel,

> sh make_gnu.sh
> config/global.cf:44: config/w32/mingw32.cf: No such file or directory
> make: *** No rule to make target `config/w32/mingw32.cf'.  Stop.
> I copied mingw.cf for mingw32.cf

Instead you should use 'set HB_COMPILER=mingw' or even
better just drop this setting completely and let it be
autodetected by make_gnu.sh.

> gcc -Wall -W -O3 -march=i586 -ohbmake.exe hbmfrdln.o hbmgauge.o hbmlang.o
hbmake.o    -L../../../../lib/w32/mingw32 -Wl,--start-group    -lhbdebug  -lhbvm
 -lhbrtl  -lhbnulrdd  -lhbrtl  -lhbvm  -lhbmacro  -lhbcommon  -lrddntx  -lrddcdx
 -lrddfpt  -lhbsix  -lhbhsx  -lhbusrrdd -lhbmainstd  -lgtcgi  -lgtpca  -lgtstd 
-lgtwin  -lgtwvt  -lgtgui -Wl,--end-group -luser32 -lgdi32 -lwsock32 -lwinspool
-lcomctl32 -lcomdlg32 -lole32 -loleaut32 -luuid -lmpr -lws2_32 -lmapi32
>
c:\MinGW\bin\..\lib\gcc\mingw32\3.4.5\..\..\..\..\mingw32\bin\ld.exe:
cannot find -lhbmainstd

The real question is why hbmainstd is not created.
Please check your log for warnings or errors before
this point, around hbmainstd creation.

BTW, it works here without any such problems also
with 3.4.5.

Brgds,
Viktor

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour



      Novos endere?os, o Yahoo! que voc? conhece. Crie um email novo com a sua cara @ymail.com ou @rocketmail.com.
http://br.new.mail.yahoo.com/addresses
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081111/e652a7b3/attachment.html
From gvarona at ec-red.com  Tue Nov 11 12:04:01 2008
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Tue Nov 11 12:03:57 2008
Subject: [Harbour] Printer list
In-Reply-To: <7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>
References: <4917A5EB.10608@ec-red.com>
	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>
Message-ID: <4919BB01.1020705@ec-red.com>

Szak?ts Viktor escribi?:
> Hi,
>
> Check GETPRINTERS() in hbwin.lib.
In this PRG:
-----------------------------------------------------------------
function main()
   setmode(25,80)
   aPrn := GETPRINTERS()
   cPrn := GetDefaultPrinter()
   aPor := PRINTERPORTTONAME()
   ? aPrn
   wait
   return nil
-----------------------------------------------------------------
I have identified the following functions:
aPrn := GETPRINTERS(), give me this:
APRN[1] "\\Estudio0393\Epson FX-2180"
APRN[2] "\\Estudios0596\HP DesignJet 1055CM by HP"
APRN[3] "Xerox Phaser 3420 PCL 6"
APRN[4] "PDFCreator"
APRN[5] "Microsoft Office Document Image Writer"
APRN[6] "Adobe PDF"

cPrn := GetDefaultPrinter(), give me this:
"Xerox Phaser 3420 PCL 6"

aPor := PRINTERPORTTONAME(), give me this:
""
What does this function?

How can I obtain a list of ports used by printers (aPrn)?

TIA

Best Regards
GVS
From labitas at gmail.com  Tue Nov 11 12:06:04 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Tue Nov 11 12:06:09 2008
Subject: [Harbour] DBFCDX + HB_CDX_DBGCODE_EXT
In-Reply-To: <20081111100919.GB19736@34-mo7-2.acn.waw.pl>
References: <2386af1b0811101107y46b39fc7yb1120c03345e6668@mail.gmail.com>
	<20081111100919.GB19736@34-mo7-2.acn.waw.pl>
Message-ID: <2386af1b0811110906p47eb2c1bt5452d48a5154cdb0@mail.gmail.com>

Hi Przemek,

> If you are interested in more information then you can send it.
> In some spare time I'll check the exact conditions for above
> message.

I send it to your mailbox.
Thank you for your costly time

Best regards,
Saulius
From labitas at gmail.com  Tue Nov 11 12:52:14 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Tue Nov 11 12:52:19 2008
Subject: [Harbour] Re: Delivery Status Notification (Failure)
In-Reply-To: <000e0cd246c6e16f21045b6d73f0@googlemail.com>
References: <2386af1b0811110945h4a361fd5i7576a5267a2031a2@mail.gmail.com>
	<000e0cd246c6e16f21045b6d73f0@googlemail.com>
Message-ID: <2386af1b0811110952yfc27d1cp5a387af881b97137@mail.gmail.com>

My message was rejected by the recipient domain.
So trying to put it there

Best regards,
Saulius
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dbg_ext.tar.gz
Type: application/x-gzip
Size: 7053 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081111/812fa3e5/dbg_ext.tar.gz
From info at fsgiudice.com  Tue Nov 11 13:04:08 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Tue Nov 11 13:04:15 2008
Subject: [Harbour] Printer list
In-Reply-To: <4919BB01.1020705@ec-red.com>
References: <4917A5EB.10608@ec-red.com>	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>
	<4919BB01.1020705@ec-red.com>
Message-ID: <4919C918.1040808@fsgiudice.com>

Hi Guillermo,

Use:

lFullDetails   := TRUE
lLocalPrinters := FALSE
aPrinters      := GETPRINTERS( lFullDetails, lLocalPrinters )

in aPrinters you will find:

{ ;
   { "Printer Full Name 1", "Port Name", "LOCAL" | "NETWORK", "Driver 
Name } ,;
....
}

Best Regards

Francesco


Il 11/11/2008 18.04, Guillermo Varona Silup? ha scritto:
> Szak?ts Viktor escribi?:
>> Hi,
>>
>> Check GETPRINTERS() in hbwin.lib.
> In this PRG:
> -----------------------------------------------------------------
> function main()
>   setmode(25,80)
>   aPrn := GETPRINTERS()
>   cPrn := GetDefaultPrinter()
>   aPor := PRINTERPORTTONAME()
>   ? aPrn
>   wait
>   return nil
> -----------------------------------------------------------------
> I have identified the following functions:
> aPrn := GETPRINTERS(), give me this:
> APRN[1] "\\Estudio0393\Epson FX-2180"
> APRN[2] "\\Estudios0596\HP DesignJet 1055CM by HP"
> APRN[3] "Xerox Phaser 3420 PCL 6"
> APRN[4] "PDFCreator"
> APRN[5] "Microsoft Office Document Image Writer"
> APRN[6] "Adobe PDF"
> 
> cPrn := GetDefaultPrinter(), give me this:
> "Xerox Phaser 3420 PCL 6"
> 
> aPor := PRINTERPORTTONAME(), give me this:
> ""
> What does this function?
> 
> How can I obtain a list of ports used by printers (aPrn)?
> 
> TIA
> 
> Best Regards
> GVS
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
From maurilio.longo at libero.it  Tue Nov 11 13:07:12 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Tue Nov 11 13:07:22 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20081110150435.GA30209@34-mo7-2.acn.waw.pl>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>	<4917C4DB.2000502@mail.udg.mx>
	<49183C2A.9080503@libero.it>
	<20081110150435.GA30209@34-mo7-2.acn.waw.pl>
Message-ID: <4919C9D0.60408@libero.it>

Przemyslaw,

GCC has this code inside libos2 which is linked with every program:

-----------8<--------------------
/* kbd4.c */

#define INCL_KBD
#include <os2.h>

USHORT _THUNK_FUNCTION (Kbd16CharIn) ();

USHORT KbdCharIn (PKBDKEYINFO pkbci, USHORT fWait, HKBD hkbd)
{
  return ((USHORT)
          (_THUNK_PROLOG (4+2+2);
           _THUNK_FLAT (pkbci);
           _THUNK_SHORT (fWait);
           _THUNK_SHORT (hkbd);
           _THUNK_CALL (Kbd16CharIn)));
}
----------->8--------------------

__THUNK defines are inside os2thunk.h which I attach, I don't grasp completely
what it does.

Does this shed some light?

Maurilio.

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


-------------- next part --------------
/* os2thunk.h,v 1.4 2004/09/14 22:27:35 bird Exp */
/** @file
 * EMX
 */

#ifndef _OS2THUNK_H
#define _OS2THUNK_H

#include <sys/cdefs.h>

__BEGIN_DECLS

typedef unsigned long _far16ptr;

_far16ptr _libc_32to16 (void *ptr);
void *_libc_16to32 (_far16ptr ptr);

typedef union _thunk_u
{
    void *pv;
    unsigned short *pus;
    unsigned long *pul;
} _thunk_t;

unsigned long _libc_thunk1 (void *args, void *fun);

#define _THUNK_PASCAL_PROLOG(SIZE) \
  __extension__ ({ char _tb[(SIZE)+4]; _thunk_t _tu; _tu.pv  = _tb + sizeof (_tb); \
       *(unsigned long *)_tb = (SIZE);
#define _THUNK_PASCAL_CHAR(ARG)     _THUNK_PASCAL_SHORT (ARG)
#define _THUNK_PASCAL_SHORT(ARG)    (*--_tu.pus = (ARG))
#define _THUNK_PASCAL_LONG(ARG)     (*--_tu.pul = (ARG))
#define _THUNK_PASCAL_FLAT(ARG)     _THUNK_PASCAL_LONG (_libc_32to16 (ARG))
#define _THUNK_PASCAL_FAR16(ARG)    _THUNK_PASCAL_LONG (ARG)
#define _THUNK_PASCAL_FUNCTION(FUN) APIENTRY _16_##FUN
#define _THUNK_PASCAL_CALL(FUN)     _libc_thunk1 (_tb, (void *)(_16_##FUN)); })
#define _THUNK_PASCAL_CALLI(FUN)    _libc_thunk1 (_tb, (void *)(FUN)); })

#define _THUNK_C_PROLOG(SIZE) \
  __extension__ ({ char _tb[(SIZE)+4]; _thunk_t _tu; _tu.pv = _tb + sizeof (unsigned long); \
       *(unsigned long *)_tb = (SIZE);
#define _THUNK_C_CHAR(ARG)     _THUNK_C_SHORT (ARG)
#define _THUNK_C_SHORT(ARG)    (*_tu.pus++ = (ARG))
#define _THUNK_C_LONG(ARG)     (*_tu.pul++ = (ARG))
#define _THUNK_C_FLAT(ARG)     _THUNK_C_LONG (_libc_32to16 (ARG))
#define _THUNK_C_FAR16(ARG)    _THUNK_C_LONG (ARG)
#define _THUNK_C_FUNCTION(FUN) _16__##FUN
#define _THUNK_C_CALL(FUN)     _libc_thunk1 (_tb, (void *)(_16__##FUN)); })
#define _THUNK_C_CALLI(FUN)    _libc_thunk1 (_tb, (void *)(FUN)); })

#define _THUNK_PROLOG(SIZE)  _THUNK_PASCAL_PROLOG (SIZE)
#define _THUNK_CHAR(ARG)     _THUNK_PASCAL_CHAR (ARG)
#define _THUNK_SHORT(ARG)    _THUNK_PASCAL_SHORT (ARG)
#define _THUNK_LONG(ARG)     _THUNK_PASCAL_LONG (ARG)
#define _THUNK_FLAT(ARG)     _THUNK_PASCAL_FLAT (ARG)
#define _THUNK_FAR16(ARG)    _THUNK_PASCAL_FAR16 (ARG)
#define _THUNK_FUNCTION(FUN) _THUNK_PASCAL_FUNCTION (FUN)
#define _THUNK_CALL(FUN)     _THUNK_PASCAL_CALL (FUN)
#define _THUNK_CALLI(FUN)    _THUNK_PASCAL_CALLI (FUN)

#define MAKE16P(sel,off)   ((_far16ptr)((sel) << 16 | (off)))
#define MAKEP(sel,off)     _libc_16to32 (MAKE16P (sel, off))
#define SELECTOROF(farptr) ((SEL)((farptr) >> 16))
#define OFFSETOF(farptr)   ((USHORT)(farptr))

/* Return true iff the block of SIZE bytes at PTR does not cross a
   64Kbyte boundary. */

#define _THUNK_PTR_SIZE_OK(ptr,size) \
  (((ULONG)(ptr) & ~0xffff) == (((ULONG)(ptr) + (size) - 1) & ~0xffff))

/* Return true iff the structure pointed to by PTR does not cross a
   64KByte boundary. */

#define _THUNK_PTR_STRUCT_OK(ptr) _THUNK_PTR_SIZE_OK ((ptr), sizeof (*(ptr)))

__END_DECLS

#endif /* not _OS2THUNK_H */
From jose.luis at iaicom.com  Tue Nov 11 13:16:54 2008
From: jose.luis at iaicom.com (=?iso-8859-1?Q?Jos=E9_Luis_Capel_?=)
Date: Tue Nov 11 13:13:14 2008
Subject: [Harbour] new HB_ARCHITECTURE=wince ?
In-Reply-To: <42D7670C-26FE-447F-B86F-F9DE2BF84C12@syenar.hu>
References: <42D7670C-26FE-447F-B86F-F9DE2BF84C12@syenar.hu>
Message-ID: <006101c94429$ad8cbf00$08a63d00$@luis@iaicom.com>

Viktor,


JLC>
JLC>Hi everyone,
JLC>
JLC>I'd like to ask opinions whether to introduce wince
JLC>as a distinct architecture in the GNU-make system.
JLC>
JLC>This would replace current w32/mingwce, w32/msvcce,
JLC>w32/poccce builds with wince/mingw, wince/msvc,
JLC>wince/pocc.
JLC>
JLC>It would be useful because it would make it easier
JLC>to enable/disable contribs for this platform.
JLC>
JLC>As of now, following contribs should have been
JLC>disabled for WinCE builds: hbwhat, hbole, hbmysql,
JLC>gtalleg, hbtpathy, hbfimage.
JLC>
JLC>[ Some of these could probably be fixed to compile
JLC>under WinCE, but some definitely not. ]
JLC>
JLC>It would also allow to better sync non-GNU make
JLC>with GNU make by changing HB_BUILD_WINCE=yes to
JLC>HB_ARCHITECTURE=wince.
JLC>
JLC>Opinions?
JLC>

Great!  Go ahead.

Regards,
Jos? lUis Capel

From harbour.01 at syenar.hu  Tue Nov 11 13:32:23 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 13:32:29 2008
Subject: [Harbour] 2008-11-09 20:58 UTC+0100 Viktor Szakats
	(harbour.01syenar hu)
In-Reply-To: <41cjh4dr9to7k3nqq5c7kdak0996q89t9l@4ax.com>
References: <lt1fh41f11e73hb28ruklpgq1p9la6bcj0@4ax.com>
	<A24124A6-0CB8-4910-8651-B69ABA612241@syenar.hu>
	<er3gh49i573e9pkr2vs26icqcuj9qt2i74@4ax.com>
	<BB6D77A8-BD8D-4F3E-8EB8-0867255E8AA9@syenar.hu>
	<n18gh4hb4e2f6dv511v6hvesgc9iuvq3hb@4ax.com>
	<95270A77-E6AB-4DC3-95E6-CB6FEE97F852@syenar.hu>
	<p7ogh4ds0ovjpjnes4prf89kt435sua6vk@4ax.com>
	<20081110155802.GA20136@34-mo7-2.acn.waw.pl>
	<gvsih4dg55i5rk7k738md3ukbqpdr3ijdu@4ax.com>
	<F4D2F75A-2DCA-4082-833B-A4934DAB2F64@syenar.hu>
	<41cjh4dr9to7k3nqq5c7kdak0996q89t9l@4ax.com>
Message-ID: <C16C0D6A-FE0B-4F3D-9D1A-D50E0BBDE5B4@syenar.hu>

>> It's IMO not the final users job to decide on such internal
>> details on the .prg level.
> Of course not, but I?m my intention is have a way to easy test what is
> the best value, without recompile Harbour each time.

Okay and sorry, in this case just put the C code inside
#pragma BEGINDUMP/ENDDUMP and include it in your test code.

>> Moreover it's specific to one of our possible MM choices,
>> so it cannot be made a generic Harbour setting. We should
>> also remember that we may want to switch MMs in the future.
> I know, are there a way to detect if we are using dlmalloc ?  If yes,
> we can accept arguments from memtst.prg like:
> memtest 10000

I guess that would mean too deep internal dependencies.
Przemek probably knows better.

>> Questions are:
>> - Which value of the three should be 10000?
> Need be tested, my functions made such tests easy.
>
>> - Does it enhance performance for both XP and Vista, or just Vista?
> Both, but bcc6.10 memory manager continues win in memtst. I need to
> more accurate test to tell how is the best.
>
>> - Did you get your results using a specific app or our
>>  speed testing tools?
> Only memtst. But I see in my final app that using dlmalloc it is more
> slow than native bcc 6.10 mm.
>
>> - If it was an app, was it a GUI, and with which GUI framework?
> I use FWH only.

Thanks, and inform us about your further results.

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 11 13:37:36 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 13:37:42 2008
Subject: [Harbour] Compiler source code SVN
In-Reply-To: <149781.86055.qm@web51905.mail.re2.yahoo.com>
References: <149781.86055.qm@web51905.mail.re2.yahoo.com>
Message-ID: <1977E230-1701-41FC-A754-BC625CAEE8DA@syenar.hu>

Hi Joel,

> Hi  Viktor
> Thank you for the help.
>
> I got to compile the sources in Linux (Centos-5.2) and also in WinXP- 
> (Msys+MingW).
> I don't get to generate executable in Linux or Win32., that gives  
> same error below.
> Does it can me to help with more this?
>
> *****************************************************************************
> ERROR.
>
> Harbour Make 1.1.0dev (Rev. 9710)
> Copyright (c) 2000-2008, http://www.harbour-project.org/
>
>
> Program had errors, check a.log
> [root@mail temp]#
> ****************************************************************************

Not much idea here (never seen such error). Anyone?

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 11 13:41:16 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 13:41:23 2008
Subject: [Harbour] Printer list
In-Reply-To: <4919BB01.1020705@ec-red.com>
References: <4917A5EB.10608@ec-red.com>
	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>
	<4919BB01.1020705@ec-red.com>
Message-ID: <B72AD32C-1D02-4308-ADDC-73F5594B0E88@syenar.hu>

Hi Guillermo,

For sure there is a function to convert Windows
printer name to port name, but you'll have to check
the exact function name in win_prn*.* files, it
was something like printertofile() AFAIR.

For more, I'm afraid you'll have to dig into hbwin
lib a bit deeper, or maybe someone else can help,
as I've never used these functions.

If that helps they are largely compatible with xhb
ones, maybe you can find it in xhb docs.

Brgds,
Viktor

On 2008.11.11., at 18:04, Guillermo Varona Silup? wrote:

> Szak?ts Viktor escribi?:
>> Hi,
>>
>> Check GETPRINTERS() in hbwin.lib.
> In this PRG:
> -----------------------------------------------------------------
> function main()
>  setmode(25,80)
>  aPrn := GETPRINTERS()
>  cPrn := GetDefaultPrinter()
>  aPor := PRINTERPORTTONAME()
>  ? aPrn
>  wait
>  return nil
> -----------------------------------------------------------------
> I have identified the following functions:
> aPrn := GETPRINTERS(), give me this:
> APRN[1] "\\Estudio0393\Epson FX-2180"
> APRN[2] "\\Estudios0596\HP DesignJet 1055CM by HP"
> APRN[3] "Xerox Phaser 3420 PCL 6"
> APRN[4] "PDFCreator"
> APRN[5] "Microsoft Office Document Image Writer"
> APRN[6] "Adobe PDF"
>
> cPrn := GetDefaultPrinter(), give me this:
> "Xerox Phaser 3420 PCL 6"
>
> aPor := PRINTERPORTTONAME(), give me this:
> ""
> What does this function?
>
> How can I obtain a list of ports used by printers (aPrn)?
>
> TIA
>
> Best Regards
> GVS
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From bedipritpal at hotmail.com  Tue Nov 11 13:51:18 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 11 13:51:22 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <20081111101606.GC19736@34-mo7-2.acn.waw.pl>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
Message-ID: <20445886.post@talk.nabble.com>


Hello Przemek

<<<
   function hb_gtInfoEx( pGT, ... )
      local pCurrGT := hb_gtSelect( pGT ), xResult
      xResult := hb_gtInfo( pGT, ... )
      hb_gtSelect( pCurrGT )
      return xResult
>>>

<<<
   function hb_gtCurrent()
      return hb_gtSelect()
>>>

FUNCTION Main()
   LOCAL pGT

   pGT := hb_gtSelect()   //  gives me current GT pointer, right ?

   ? pGT // displays 012850AC   

   ? hb_gtInfo( HB_GTI_WINTITLE ) // return windows title => OK

   ? hb_gtInfo( pGT, HB_GTI_WINTITLE ) // appln disappears

   RETURN NIL


source/rtl/gtfunc.c

HB_FUNC( HB_GTINFO )
{
   if( ISNUM( 1 ) )
   {
      HB_GT_INFO gtInfo;

      gtInfo.pNewVal  = hb_param( 2, HB_IT_ANY );
      gtInfo.pNewVal2 = hb_param( 3, HB_IT_ANY );
      gtInfo.pResult  = NULL;

      hb_gtInfo( hb_parni( 1 ), &gtInfo );
      if( gtInfo.pResult )
         hb_itemReturnRelease( gtInfo.pResult );
   }
   else
      hb_errRT_BASE_SubstR( EG_ARG, 3012, NULL, HB_ERR_FUNCNAME,
HB_ERR_ARGS_BASEPARAMS );
}

May be I am missing something, I suppose 
xResult := hb_gtInfo( pGT, ... )
functionality is not implemented yet. Right ?

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20445886.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From gvarona at ec-red.com  Tue Nov 11 13:54:12 2008
From: gvarona at ec-red.com (=?ISO-8859-1?Q?Guillermo_Varona_Silup=FA?=)
Date: Tue Nov 11 13:54:11 2008
Subject: [Harbour] Printer list
In-Reply-To: <4919C918.1040808@fsgiudice.com>
References: <4917A5EB.10608@ec-red.com>	<7E294456-9CF3-4EC4-B83C-F65E7A1661D7@syenar.hu>	<4919BB01.1020705@ec-red.com>
	<4919C918.1040808@fsgiudice.com>
Message-ID: <4919D4D4.9030700@ec-red.com>

Thank very much Francesco, That's what I needed!

Best Regards
GVS

Francesco Saverio Giudice escribi?:
> Hi Guillermo,
>
> Use:
>
> lFullDetails   := TRUE
> lLocalPrinters := FALSE
> aPrinters      := GETPRINTERS( lFullDetails, lLocalPrinters )
>
> in aPrinters you will find:
>
> { ;
>   { "Printer Full Name 1", "Port Name", "LOCAL" | "NETWORK", "Driver 
> Name } ,;
> ....
> }
>
> Best Regards
>
> Francesco
>
>
> Il 11/11/2008 18.04, Guillermo Varona Silup? ha scritto:
>> Szak?ts Viktor escribi?:
>>> Hi,
>>>
>>> Check GETPRINTERS() in hbwin.lib.
>> In this PRG:
>> -----------------------------------------------------------------
>> function main()
>>   setmode(25,80)
>>   aPrn := GETPRINTERS()
>>   cPrn := GetDefaultPrinter()
>>   aPor := PRINTERPORTTONAME()
>>   ? aPrn
>>   wait
>>   return nil
>> -----------------------------------------------------------------
>> I have identified the following functions:
>> aPrn := GETPRINTERS(), give me this:
>> APRN[1] "\\Estudio0393\Epson FX-2180"
>> APRN[2] "\\Estudios0596\HP DesignJet 1055CM by HP"
>> APRN[3] "Xerox Phaser 3420 PCL 6"
>> APRN[4] "PDFCreator"
>> APRN[5] "Microsoft Office Document Image Writer"
>> APRN[6] "Adobe PDF"
>>
>> cPrn := GetDefaultPrinter(), give me this:
>> "Xerox Phaser 3420 PCL 6"
>>
>> aPor := PRINTERPORTTONAME(), give me this:
>> ""
>> What does this function?
>>
>> How can I obtain a list of ports used by printers (aPrn)?
>>
>> TIA
>>
>> Best Regards
>> GVS
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
>
>

From cvc at oohg.org  Tue Nov 11 14:53:02 2008
From: cvc at oohg.org (Ciro Vargas Clemow)
Date: Tue Nov 11 14:53:09 2008
Subject: [Harbour] big window in gtwvg
Message-ID: <4919E29E.2040400@oohg.org>


Hi all:

how can I resize my gtwvg window to the max size by CODE (program), not by 
resize with mouse.

regards
Ciro


-- 
http://sistemascvc.tripod.com  (la casa del clip2win y nodosimp / the no2imp and 
clip2win home )

http://www.oohg.org ( Object Oriented Harbour GUI, more simple, more powerfull )


From harbour.01 at syenar.hu  Tue Nov 11 15:03:24 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 15:03:31 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue,
	xValue2 ) - Feature Request
In-Reply-To: <20445886.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
Message-ID: <08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>

Hi Pritpal,

> <<<
>   function hb_gtInfoEx( pGT, ... )
>      local pCurrGT := hb_gtSelect( pGT ), xResult
>      xResult := hb_gtInfo( pGT, ... )

I guess Przemek meant: 'xResult := hb_gtInfo( ... )'
It was a simple typo.

Brgds,
Viktor

From Jose.Luis at iaicom.com  Tue Nov 11 15:06:35 2008
From: Jose.Luis at iaicom.com (Jose Luis Capel)
Date: Tue Nov 11 15:10:07 2008
Subject: [Harbour] Wince and PellesC
Message-ID: <10C28C4554DFE54EB20321B9CB8931C2283104@servidor01.AGSoft.local>

Hi all,

I would know if it is possible to build libs for wince using PellesC.  

Is it possible ?

Thanks and regards,
Jos? Luis Capel


From bedipritpal at hotmail.com  Tue Nov 11 15:12:30 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 11 15:12:34 2008
Subject: [Harbour] SET PRINTER TO ( cPrinter ) - Bug
In-Reply-To: <6139A806-0A98-448A-AC0A-A723F7FBF705@syenar.hu>
References: <20431996.post@talk.nabble.com>
	<6139A806-0A98-448A-AC0A-A723F7FBF705@syenar.hu>
Message-ID: <20447188.post@talk.nabble.com>


Hello Viktor

<<<
First of turn _SET_DEFEXTENSIONS to .F.,
after that in Harbour you'll need to convert
the Windows printer name to a port, share
name, or filename in order to print to it using
SET PRINTER TO.
>>>

I tried both.

Printername =  "Kyocera FS-1000 (KPDL-2)"
Portname    =  "IP_10.0.40.30"
Attribute     =  LOCAL

set( _SET_DEFEXTENSIONS, .f. )

// creates disk file Kyocera FS-1000 (KPDL-2)"
// before it was Kyocera FS-1000 (KPDL-2).prn" 
SET PRINTER TO ( Printername ) 

// creates disk file 'IP_10.0.40.30' 
// before it was 'IP_10.0.40.30.prn'
SET PRINTER TO ( Portname ) 

<<<
Harbour core doesn't support any Windows
printers natively, so you'll need to use
hbwin.lib for some name to port conversion
and getting Windows printer name list.
>>>

I fetched above info with GetPrinters()* functions only.

<<<
IOW, in Harbour 'SET PRINTER TO' always need
to point to a filename, or any name that
can be opened using FOpen().
>>>

Does it implies that Harbour either prints to a "file" ( disk file )
or any standard port like 'LPT1:~LPT4:   COM1:~COM4' ?

It will be heartening to see 
SET PRINTER TO ( cPrinterNameOrPort ) based on the OS in use.

Any ideas how can I direct SET PRINTER TO ... to behave as in xHarbour
as the basic code is implemented in set.c itself.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/SET-PRINTER-TO-%28-cPrinter-%29---Bug-tp20431996p20447188.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Tue Nov 11 16:00:14 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 11 16:00:17 2008
Subject: [Harbour] big window in gtwvg
In-Reply-To: <4919E29E.2040400@oohg.org>
References: <4919E29E.2040400@oohg.org>
Message-ID: <20448271.post@talk.nabble.com>


Hi


Ciro Vargas Clemow wrote:
> 
> how can I resize my gtwvg window to the max size by CODE (program), not by 
> resize with mouse.
> 

I am about to implement it and few more options.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/big-window-in-gtwvg-tp20448159p20448271.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Tue Nov 11 16:03:43 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 16:03:47 2008
Subject: [Harbour] 2008-11-11 21:57 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94440$Blat.v2.6.2$faa43fd6$bf0c466a982@127.0.0.1>

2008-11-11 21:57 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/common/hbverdsp.c
    * Streamlined the /build information screen. It's now 
      more compact and now show if tracing is enabled. Max 
      symbol length got removed, ANSI C startup also, because 
      it needs a custom C flag anyway.

  * include/hbvmpub.h
  * include/hbsetup.h
    * HB_SYMBOL_NAME_LEN moved away from custom setup.
      This isn't an option users should normally tinker.

  * tests/run_prg.bat
    * Minor.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 11 16:42:31 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 16:42:46 2008
Subject: [Harbour] SET PRINTER TO ( cPrinter ) - Bug
In-Reply-To: <20447188.post@talk.nabble.com>
References: <20431996.post@talk.nabble.com>
	<6139A806-0A98-448A-AC0A-A723F7FBF705@syenar.hu>
	<20447188.post@talk.nabble.com>
Message-ID: <51224AE3-DD7C-44DB-A30E-865F0B4DF619@syenar.hu>

> // creates disk file Kyocera FS-1000 (KPDL-2)"
> // before it was Kyocera FS-1000 (KPDL-2).prn"
> SET PRINTER TO ( Printername )

This won't work either way, it's Windows printer name.

> // creates disk file 'IP_10.0.40.30'
> // before it was 'IP_10.0.40.30.prn'
> SET PRINTER TO ( Portname )

This also won't work, because it's a printer port
name not a printer _share name_.

[ I'm not sure what hbwin printing is capable of
and which terminology it uses, sorry. ]

> Does it implies that Harbour either prints to a "file" ( disk file )
> or any standard port like 'LPT1:~LPT4:   COM1:~COM4' ?

No. You can open lots more than just disk files
and LPT/COM using FOPEN() (thus SET PRINTER), most
importantly a printer share name which usually
looks like this:

\\server\hp4600
\\192.168.3.100\myprinter

On other platforms you can similarly use real and
virtual port names, but probably someone more familiar
with these other systems could tell you more.

> It will be heartening to see
> SET PRINTER TO ( cPrinterNameOrPort ) based on the OS in use.

Notice what you want is line/direct printing.
Windows printers are not line printers, but GDI ones.
Not all Windows printer support direct printing,
so it would be totally misleading for Harbour core
to suggest that this could reliably work.

[ Unless Harbour would offer a total HP PCL, IBM
PPDS or ESP/P[2] emulation on these ports and convert
them to graphics and route them to the platform
dependent "GDI" printer. But that's very much off
topic for Harbour, even if it would be a cool feature. ]

So, line (or raw, or direct) printing and graphic printing
are two different things, Harbour supports the former,
latter is - like GUI - very much platform dependent, and
Harbour support for Windows is implemented in hbwin lib.

> Any ideas how can I direct SET PRINTER TO ... to behave as in xHarbour
> as the basic code is implemented in set.c itself.

See above, I don't think we should implement this the
xhb way, as it can create all sorts of problems, like
breaking compatibility in the first place. What if
f.e. if user wants to print to a file named "hello", but
he happens to have a Windows printer named "hello"?

See Francesco's recent mail, just get the list of

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 11 16:53:38 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 16:53:45 2008
Subject: [Harbour] Wince and PellesC
In-Reply-To: <10C28C4554DFE54EB20321B9CB8931C2283104@servidor01.AGSoft.local>
References: <10C28C4554DFE54EB20321B9CB8931C2283104@servidor01.AGSoft.local>
Message-ID: <3D2D0ADC-1F3F-4557-B887-3AED70C7B348@syenar.hu>

> I would know if it is possible to build libs for wince using PellesC.
>
> Is it possible ?

Yes, it's possible.

Since yesterday it's even possible to build
Harbour for WinCE using Pelles C 5.0.

Note1: Certain contribs needs further fixing
to compile cleanly.

Note2: I don't have WinCE devices around, and
no one confirmed Harbour PellesC build to
actually run okay on such device, yet.

Brgds,
Viktor

From bedipritpal at hotmail.com  Tue Nov 11 17:31:45 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 11 17:31:48 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
Message-ID: <20449893.post@talk.nabble.com>


Hello


Szak?ts Viktor wrote:
> 
>>   function hb_gtInfoEx( pGT, ... )
>>      local pCurrGT := hb_gtSelect( pGT ), xResult
>>      xResult := hb_gtInfo( pGT, ... )
> 
> I guess Przemek meant: 'xResult := hb_gtInfo( ... )'
> It was a simple typo.
> 

May be. 

But see my question. I explicitly need a function which 
I call with pGT as first parameter. 

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20449893.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Tue Nov 11 17:38:10 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 11 17:38:13 2008
Subject: [Harbour] MemoEdit() - Bug if cUDF == YES and EditMode == NO
Message-ID: <20450013.post@talk.nabble.com>


Hello All

Here is weired behavior

#include 'memoedit.ch'
#include 'setcurs.ch'
#include 'inkey.ch'

Function Main()
   Local cText := 'This is initial text'
   Local lEditMode := .F.
 
   DO WHILE .T.
      cText := MEMOEDIT( cText, 3,6,20,76, lEditMode, "EditFunc", 50 )
      if lastkey() == 27
         exit
      endif
   ENDDO

   Return nil
//----------------------------------------------------------------------//
Function EditFunc( nMode, nRow, nCol )
   Local nKey := Lastkey()

   STATIC nLoop := 0

   DO CASE
   CASE nMode == ME_INIT
      nLoop++
uiDebug( nLoop )
      DO CASE
      CASE nLoop == 1                         // Set insert mode
         SetCursor( SC_SPECIAL1 )
         RETURN K_INS

      CASE nLoop == 2                      // End initialization
         RETURN ME_DEFAULT

      ENDCASE

   CASE nMode == ME_IDLE

   OTHERWISE
      IF nKey == K_INS
         IF ReadInsert()
            SetCursor(SC_NORMAL)
         ELSE
            SetCursor(SC_SPECIAL1)
         ENDIF

      ENDIF

   ENDCASE

   RETURN ME_DEFAULT
//----------------------------------------------------------------------//

Application just disappears. Disappearance is caused by repeated calls to
cUDF.
ME_INIT is called only once but it must been called more than once in above
code.

If lEditMode == .T. it works fine.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/MemoEdit%28%29---Bug-if-cUDF-%3D%3D-YES-and-EditMode-%3D%3D-NO-tp20450013p20450013.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Tue Nov 11 18:33:51 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 11 18:34:00 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue,
	xValue2 ) - Feature Request
In-Reply-To: <20449893.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
Message-ID: <1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>

>>>
>>>  function hb_gtInfoEx( pGT, ... )
>>>     local pCurrGT := hb_gtSelect( pGT ), xResult
>>>     xResult := hb_gtInfo( pGT, ... )
>>
>> I guess Przemek meant: 'xResult := hb_gtInfo( ... )'
>> It was a simple typo.
>>
>
> May be.
>
> But see my question. I explicitly need a function which
> I call with pGT as first parameter.

And the above was exactly it.

Brgds,
Viktor

From toninhofwi at yahoo.com.br  Tue Nov 11 20:14:53 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Tue Nov 11 19:14:49 2008
Subject: [Harbour] Error compiling latest SVN
Message-ID: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>

Hi friends,

I have this error compiling harbour with latest SVN, BCC 6.10 and this
flags:

SET C_USR=-DHB_GUI -DHB_FM_STATISTICS_OFF -DHB_NO_PROFILER
-DADS_LIB_VERSION=700 -DHB_HASH_MSG_ITEMS -DHB_FM_STD_ALLOC
-DHB_NO_DEBUG

source\vm\maindllh.c:
	ilink32.exe -Gn -C -aa -Tpd -Gi -Llib\b32  @MAKE0036.@@@
Turbo Incremental Link 5.95 Copyright (c) 1997-2008 CodeGear
Fatal: Unable to open file 'C0D32.OBJ'

** error 2 ** deleting bin\b32\harbour-11-b32.dll


Best regards,

Toninho.

__________________________________________________
Faa ligaes para outros computadores com o novo Yahoo! Messenger 
http://br.beta.messenger.yahoo.com/ 
From druzus at acn.waw.pl  Tue Nov 11 19:48:59 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 19:48:00 2008
Subject: [Harbour] 2008-11-12 01:48 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081112004859.GA11865@34-mo7-2.acn.waw.pl>

2008-11-12 01:48 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rdd/dbfcdx/dbfcdx1.c
    ! fixed bug in joined leaf pages size calculation which activated
      error massage enabled by HB_CDX_DBGCODE_EXT macro.
      Thanks to Saulius for reporting the problem.

best regards
Przemek
From dmacias at mail.udg.mx  Tue Nov 11 19:50:58 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov 11 19:50:58 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491A2872.1070001@mail.udg.mx>

Maurilio:

 >Anyway, this code works ok when built using GCC:

 >function main()
 >   hb_threadStart( @t() )
 >   inkey(100)
 >return

 >function t()
 >    local n := 10
 >    while n-- > 0
 >      inkey( 1 )
 >    enddo
 >return

That code work fine with gcc335 here

With OpenWatcom
-----------------------
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
-----------------------


 >David,
 >what do you use to build harbour with watcom?
 >On my pc, simply trying to build a single .c file from the ide gives a 
 >trap
 >inside OS2KRNL, so I fear it is not SMP ready.

I have not used the IDE, all my tests has been in command line

I do not remember if it is optional, but OW installer make some changes 
in CONFIG.sys
I removed that changes and made separate cmd file to set values required 
for OW, to avoid conflicts with other compilers

I sent to your e-mail a zip with:
- owset.cmd: Used to set separate environment for OW
- harbour\config\os2\owatcom.cf
   Based in Przemek guidelines and win32\owatcom.cf, just use 4 changes
- mi_ow.cmd: Used to build Harbour
- bin\pbaos2.cmd: Use to build separate .prg
     bin\pbaos2.cmd [-mt] prgfile

Just change my directories to your directories

I used to test with separate .prg (pbaos2.cmd -mt) and hbrun_mt.exe made 
for mt

You can test OW before to apply to Harbour
- Use command line   :-)
- Use owset.cmd to set OW environment
- Change to \watcom\samples\os2\mthread.c
- wcl386 -bt=os2 -bm -l=os2v2 mthread
- run mthread.exe

David Macias


From bedipritpal at hotmail.com  Tue Nov 11 20:08:41 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 11 20:08:44 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
	<1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
Message-ID: <20452073.post@talk.nabble.com>


Hi


Szak?ts Viktor wrote:
> 
>> But see my question. I explicitly need a function which
>> I call with pGT as first parameter.
> 
> And the above was exactly it.
> 
> 

No, not exactly. 

So to check if above protocol works I did some tests.
hb_gtSelect( pGT ) swaps the current GT with pGT and this is 
what I do not want. I just need to set/get a parameter of
another window ( GT ) from another threaded window ( GT ) and
when I issue hb_gtSelect() appln simply hangs.

I knew this side effect and hence this is why I had reqested
another way to manage different GTs from different threads.
Hope I am clear now.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20452073.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Tue Nov 11 21:06:07 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 21:05:09 2008
Subject: [Harbour] Clipper RL compilation problem
In-Reply-To: <2BA4D0D3-C721-4816-BFA5-53DA259CC19B@syenar.hu>
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>
	<2632CA93BDBD4352965490C9F327835D@emag>
	<ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
	<20081111100115.GA19736@34-mo7-2.acn.waw.pl>
	<2BA4D0D3-C721-4816-BFA5-53DA259CC19B@syenar.hu>
Message-ID: <20081112020607.GA21198@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>> I do not know the RL tool and it's internal format used
>> in .frm but for .mem files we can introduce new format
>> which will allow to store memvars with unlimited variable
>> name size.
> Of course, but how would you solve two way compatibility
> for these .mem files?

I do not plan to implement it. Few years ago I looked at this
problem and it should be possible to create format which will
be accepted by Clipper but it will skip Harbour extensions.
But to be sure I will have to make some tests with Clipper.
Clipper .mem format does not support also other things which
exists in Harbour, f.e. strings longer then 64KB so variable
name length it's not the only one problem.

> [ IMO still some cmdline/pragma PRIVATE/PUBLIC var length
> limit seems the most reasonable. ]

It has to be runtime switch. Compiler switch is not enough.
Why don't you want to make the same for other symbols?
The most often reported problem by Clipper programmers
porting their code to [x]Harbour is more then 10 significant
characters in function names. It's exactly the same problem.
We had Harbour compile time support for 10 character symbols
which you removed. The reason was using in core code functions
which needs more then 10 significant characters. The same
problem will happen if someone will want to link code which
uses such memvar variables with a code which needs longer
variables. I can understand that we may want reactivate support
for 10 character symbols updating core code if necessary because
it's a real problem for some Clipper users but introducing such
hack only for one type of symbols is a not good idea for me.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 21:13:12 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 21:12:14 2008
Subject: [Harbour] DBFCDX + HB_CDX_DBGCODE_EXT
In-Reply-To: <2386af1b0811110906p47eb2c1bt5452d48a5154cdb0@mail.gmail.com>
References: <2386af1b0811101107y46b39fc7yb1120c03345e6668@mail.gmail.com>
	<20081111100919.GB19736@34-mo7-2.acn.waw.pl>
	<2386af1b0811110906p47eb2c1bt5452d48a5154cdb0@mail.gmail.com>
Message-ID: <20081112021312.GB21198@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Saulius Zrelskis wrote:

Hi Saulius,

> > If you are interested in more information then you can send it.
> > In some spare time I'll check the exact conditions for above
> > message.
> I send it to your mailbox.
> Thank you for your costly time

It should be fixed now.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 21:17:19 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 21:16:20 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4919B07A.1060106@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49196BEE.6030306@mail.udg.mx> <4919B07A.1060106@libero.it>
Message-ID: <20081112021719.GC21198@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> what do you use to build harbour with watcom?
> On my pc, simply trying to build a single .c file from the ide gives a trap
> inside OS2KRNL, so I fear it is not SMP ready.

I do not know if the IDE is SMP ready but it's not a problem for
us if rest is correct. Try to build Harbour using owatcom.cf which
David sent you and make some tests using GTCGI.
Probably all tests/mttest*.prg will work correctly.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 21:25:29 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 21:24:30 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <4919C9D0.60408@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4917C4DB.2000502@mail.udg.mx> <49183C2A.9080503@libero.it>
	<20081110150435.GA30209@34-mo7-2.acn.waw.pl>
	<4919C9D0.60408@libero.it>
Message-ID: <20081112022529.GD21198@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> GCC has this code inside libos2 which is linked with every program:
> -----------8<--------------------
> /* kbd4.c */
> #define INCL_KBD
> #include <os2.h>
> USHORT _THUNK_FUNCTION (Kbd16CharIn) ();
> USHORT KbdCharIn (PKBDKEYINFO pkbci, USHORT fWait, HKBD hkbd)
> {
>   return ((USHORT)
>           (_THUNK_PROLOG (4+2+2);
>            _THUNK_FLAT (pkbci);
>            _THUNK_SHORT (fWait);
>            _THUNK_SHORT (hkbd);
>            _THUNK_CALL (Kbd16CharIn)));
> }
> ----------->8--------------------
> __THUNK defines are inside os2thunk.h which I attach, I don't grasp completely
> what it does.

These are macros to pass parameters using some strictly defined
calling convention.

> Does this shed some light?

This function does not make anything more then calls 16bit OS2 API
function. OS2 needs special calling convention. But because it works
for 1-st thread then probably it's correctly called also by OWC so
the problem can be resolved externally to KbdCharIn().

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 21:37:07 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 21:36:08 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491987AB.5080301@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<4917C4DB.2000502@mail.udg.mx> <49183C2A.9080503@libero.it>
	<20081110150435.GA30209@34-mo7-2.acn.waw.pl>
	<491987AB.5080301@libero.it>
Message-ID: <20081112023707.GE21198@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> I don't know, but I remember that I started working on harbour for OS/2
> exactly for the same problem, sometimes it was GPFing without reason and I
> traced that reason to two things:
> 1) KBD code not using tiled memory
> 2) gtos2.c code calling video functions (VioXXX) and not using tiled memory.
> You need to use tiled memory because OS/2 drivers are 16 bit protected memory
> code and I think that, maybe, OW code does not respect this requirement.

Do not forget that it works for 1-st thread. Only other threads cannot
executr KbdCharIn().

> > Why we have s_hk which is only low memory block initialized to NULL?
> > This code efectively works like:
> >    KbdCharIn( s_key, IO_NOWAIT, NULL );
> Uhm, I'm not sure, but I think that since it has to receive a pointer to a
> tiled memory area, this was to be sure that the memory was really tiled.

OK I understand the reasons why it was introduced but inside s_hk we have
NULL pointer so '( HKBD ) * s_hk' extracts NULL and this NULL value is
passed as 3-rd parameter of KbdCharIn():
   KbdCharIn( s_key, IO_NOWAIT, ( HKBD ) * s_hk );
It means that s_hk does nothing in all OS2 builds and can be eliminated.
Maybe allocating some keyboard handler (KbdOpen()) and assigning it to this
variable can resolve the problem with calling KbdCharIn() by non 1-st thread.
BTW. In Harbour access to GT is mutual exclusive so we do not have to worry
about executing this function by more then one thread simultaneously.

Thank you for your help.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 21:38:58 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 21:38:00 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
Message-ID: <20081112023858.GA29888@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>>   function hb_gtInfoEx( pGT, ... )
>>      local pCurrGT := hb_gtSelect( pGT ), xResult
>>      xResult := hb_gtInfo( pGT, ... )
> I guess Przemek meant: 'xResult := hb_gtInfo( ... )'
> It was a simple typo.

Exactly. Thanks.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 11 21:49:15 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 11 21:48:16 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <20452073.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
	<1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
	<20452073.post@talk.nabble.com>
Message-ID: <20081112024915.GB29888@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> No, not exactly. 
> So to check if above protocol works I did some tests.
> hb_gtSelect( pGT ) swaps the current GT with pGT and this is 
> what I do not want. I just need to set/get a parameter of
> another window ( GT ) from another threaded window ( GT ) and
> when I issue hb_gtSelect() appln simply hangs.

Then you have a problem with your code or with GTWVG which should
be fixed. Swapping GT does not hang Harbour code.

> I knew this side effect and hence this is why I had reqested
> another way to manage different GTs from different threads.
> Hope I am clear now.

I do not think that separate function which will not swap GT
will help you in any way. If your application hangs then it's
probably caused by sending some blocking messages (directly
on indirectly in other Win API functions) to windows assigned
to different thread.
Swapping GT is fully done at Harbour level and does not touch
low level GT code at all so it should be invisible for your
code and you should look for the problem in different place.
BTW introducing .prg code like pNotifierBlock to low level GT
internals forces GT swapping because it's necessary to set valid
GT context so without it .prg code will not know on which GT
it should operate. It's yet another problem caused by this
extension.

best regards,
Przemek
From philb at philb.us  Tue Nov 11 23:35:43 2008
From: philb at philb.us (Phil Barnett)
Date: Tue Nov 11 23:35:48 2008
Subject: [Harbour] Clipper RL compilation problem
In-Reply-To: <20081111100115.GA19736@34-mo7-2.acn.waw.pl>
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>
	<ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
	<20081111100115.GA19736@34-mo7-2.acn.waw.pl>
Message-ID: <200811112335.43586.philb@philb.us>

On Tuesday 11 November 2008 05:01:15 am Przemyslaw Czerpak wrote:
> Have you checked it?
> You'll be very surprised if you will make some tests.
> In tests/speedtst.prg tests 1-15 checks the speed of
> local, static, public, privates and fields.
> Do you see noticeable speed difference between first
> four variable types?

The difference is likely to be more pronounced when there are hundreds of 
variables that are public, vs hundreds of locals scattered throughout the 
software.

Perhaps the test could be modified to show this problem of many publics.

Anyway that's how it was with Clipper. Not sure of Harbour.

-- 
"Ninety percent of politicians give the other 10 percent a bad name." -- Henry 
Kissinger
From bedipritpal at hotmail.com  Wed Nov 12 01:40:49 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov 12 01:40:52 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <20081112024915.GB29888@34-mo7-2.acn.waw.pl>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
	<1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
	<20452073.post@talk.nabble.com>
	<20081112024915.GB29888@34-mo7-2.acn.waw.pl>
Message-ID: <20455052.post@talk.nabble.com>


Przemek

May be I could not present my case properly.

I understand your implementation of new GT and also 
how it is behaving. My request is based on the new OBJECT 
modal I am building on lines with Xbase++ where I needed 
such functionality. 

I only need GTINFO manipulation is such way nothing else.

Below is my proposed changes to bring this feature:

hbapigt.h [#146]
-------------

typedef struct
{
   PHB_ITEM pNewVal;
   PHB_ITEM pResult;
   PHB_ITEM pNewVal2;
   PHB_ITEM pGT;               // New Member
} HB_GT_INFO, * PHB_GT_INFO;



hbgtcore.c [#1614]
------------------

gtInfo.pNewVal = gtInfo.pNewVal2 = gtInfo.pResult = gtInfo.pGT = NULL;   //
new members




gtfunc.c [#116]
---------------

HB_FUNC( HB_GTINFOEX )         // New Function
{
   if( ISPOINTER( 1 ) && ISNUM( 2 ) )
   {
      HB_GT_INFO gtInfo;

      gtInfo.pGT      = hb_param( 1, HB_IT_ANY );
      gtInfo.pNewVal  = hb_param( 3, HB_IT_ANY );
      gtInfo.pNewVal2 = hb_param( 4, HB_IT_ANY );
      gtInfo.pResult  = NULL;

      hb_gtInfo( hb_parni( 2 ), &gtInfo );
      if( gtInfo.pResult )
         hb_itemReturnRelease( gtInfo.pResult );
   }
   else
      hb_errRT_BASE_SubstR( EG_ARG, 3012, NULL, HB_ERR_FUNCNAME,
HB_ERR_ARGS_BASEPARAMS );
}



gtwvg.c [#2397]
---------------

static BOOL hb_gt_wvt_Info( PHB_GT pGTx, int iType, PHB_GT_INFO pInfo )  //
initial change
{
   PHB_GT pGT = NULL;
   PHB_GTWVT pWVT;
   int iVal;

   HB_TRACE( HB_TR_DEBUG, ( "hb_gt_wvt_Info(%p,%d,%p)", pGT, iType, pInfo )
);

   if( pInfo->pGT && hb_itemType( pInfo->pGT ) & HB_IT_POINTER )
   {
      pGT = hb_gt_ItemBase( pInfo->pGT );
      if( pGT )
         hb_gt_BaseFree( pGT );
      else
         pGT = pGTx;
   }
   if( !pGT )
   {
      pGT = pGTx;
   }

   ....
   ....


Above changes does not disturb current GT implementation. I 
have tested extensively with both GTWVT and GTWVG. Instead 
it empowers me to manipulate GTs running in different threads
from current thread. I have some interesting usage in place 
and hopefully by ths weekend I be able to upload partial but
working xbase++ cmpatible class structure in GTWVG, pure console.

If agreed let me know if I can commit above changes.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20455052.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From labitas at gmail.com  Wed Nov 12 02:37:15 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Wed Nov 12 02:37:19 2008
Subject: [Harbour] DBFCDX + HB_CDX_DBGCODE_EXT
In-Reply-To: <20081112021312.GB21198@34-mo7-2.acn.waw.pl>
References: <2386af1b0811101107y46b39fc7yb1120c03345e6668@mail.gmail.com>
	<20081111100919.GB19736@34-mo7-2.acn.waw.pl>
	<2386af1b0811110906p47eb2c1bt5452d48a5154cdb0@mail.gmail.com>
	<20081112021312.GB21198@34-mo7-2.acn.waw.pl>
Message-ID: <2386af1b0811112337i4367724dr88705a42bc56600@mail.gmail.com>

Hi Przemek,

> It should be fixed now.

That is true :)
Thank you.

Best regards,
Saulius
From jose.luis at iaicom.com  Wed Nov 12 03:19:25 2008
From: jose.luis at iaicom.com (=?iso-8859-1?Q?Jos=E9_Luis_Capel_?=)
Date: Wed Nov 12 03:16:07 2008
Subject: [Harbour] Wince and PellesC
In-Reply-To: <3D2D0ADC-1F3F-4557-B887-3AED70C7B348@syenar.hu>
References: <10C28C4554DFE54EB20321B9CB8931C2283104@servidor01.AGSoft.local>
	<3D2D0ADC-1F3F-4557-B887-3AED70C7B348@syenar.hu>
Message-ID: <005f01c9449f$605100e0$20f302a0$@luis@iaicom.com>

Viktor,

JLC>> I would know if it is possible to build libs for wince using
JLC>PellesC.
JLC>>
JLC>> Is it possible ?
JLC>
JLC>Yes, it's possible.

Great!!  


JLC>
JLC>Since yesterday it's even possible to build
JLC>Harbour for WinCE using Pelles C 5.0.
JLC>

Yesterday I updated trunk and could not see specific make for wince-Pelles.
Which one can I use?

JLC>Note1: Certain contribs needs further fixing
JLC>to compile cleanly.
JLC>
JLC>Note2: I don't have WinCE devices around, and
JLC>no one confirmed Harbour PellesC build to
JLC>actually run okay on such device, yet.
JLC>

As soon I build libs I'll make some tests.

Thanks and regards,
Jos? Luis Capel

From harbour.01 at syenar.hu  Wed Nov 12 03:49:52 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 03:50:00 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue,
	xValue2 ) - Feature Request
In-Reply-To: <20455052.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
	<1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
	<20452073.post@talk.nabble.com>
	<20081112024915.GB29888@34-mo7-2.acn.waw.pl>
	<20455052.post@talk.nabble.com>
Message-ID: <20E04167-2478-4693-A982-AB610FCC18B9@syenar.hu>

I'd suggest to try to solve this problem using
existing facilities. Pouring new variations into
the core seems not the best idea when we have
already quite some open problems around this area.

Brgds,
Viktor

On 2008.11.12., at 7:40, Pritpal Bedi wrote:

>
> Przemek
>
> May be I could not present my case properly.
>
> I understand your implementation of new GT and also
> how it is behaving. My request is based on the new OBJECT
> modal I am building on lines with Xbase++ where I needed
> such functionality.
>
> I only need GTINFO manipulation is such way nothing else.
>
> Below is my proposed changes to bring this feature:
>
> hbapigt.h [#146]
> -------------
>
> typedef struct
> {
>   PHB_ITEM pNewVal;
>   PHB_ITEM pResult;
>   PHB_ITEM pNewVal2;
>   PHB_ITEM pGT;               // New Member
> } HB_GT_INFO, * PHB_GT_INFO;
>
>
>
> hbgtcore.c [#1614]
> ------------------
>
> gtInfo.pNewVal = gtInfo.pNewVal2 = gtInfo.pResult = gtInfo.pGT =  
> NULL;   //
> new members
>
>
>
>
> gtfunc.c [#116]
> ---------------
>
> HB_FUNC( HB_GTINFOEX )         // New Function
> {
>   if( ISPOINTER( 1 ) && ISNUM( 2 ) )
>   {
>      HB_GT_INFO gtInfo;
>
>      gtInfo.pGT      = hb_param( 1, HB_IT_ANY );
>      gtInfo.pNewVal  = hb_param( 3, HB_IT_ANY );
>      gtInfo.pNewVal2 = hb_param( 4, HB_IT_ANY );
>      gtInfo.pResult  = NULL;
>
>      hb_gtInfo( hb_parni( 2 ), &gtInfo );
>      if( gtInfo.pResult )
>         hb_itemReturnRelease( gtInfo.pResult );
>   }
>   else
>      hb_errRT_BASE_SubstR( EG_ARG, 3012, NULL, HB_ERR_FUNCNAME,
> HB_ERR_ARGS_BASEPARAMS );
> }
>
>
>
> gtwvg.c [#2397]
> ---------------
>
> static BOOL hb_gt_wvt_Info( PHB_GT pGTx, int iType, PHB_GT_INFO  
> pInfo )  //
> initial change
> {
>   PHB_GT pGT = NULL;
>   PHB_GTWVT pWVT;
>   int iVal;
>
>   HB_TRACE( HB_TR_DEBUG, ( "hb_gt_wvt_Info(%p,%d,%p)", pGT, iType,  
> pInfo )
> );
>
>   if( pInfo->pGT && hb_itemType( pInfo->pGT ) & HB_IT_POINTER )
>   {
>      pGT = hb_gt_ItemBase( pInfo->pGT );
>      if( pGT )
>         hb_gt_BaseFree( pGT );
>      else
>         pGT = pGTx;
>   }
>   if( !pGT )
>   {
>      pGT = pGTx;
>   }
>
>   ....
>   ....
>
>
> Above changes does not disturb current GT implementation. I
> have tested extensively with both GTWVT and GTWVG. Instead
> it empowers me to manipulate GTs running in different threads
> from current thread. I have some interesting usage in place
> and hopefully by ths weekend I be able to upload partial but
> working xbase++ cmpatible class structure in GTWVG, pure console.
>
> If agreed let me know if I can commit above changes.
>
> Regards
> Pritpal Bedi
>
> -- 
> View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20455052.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Wed Nov 12 04:18:39 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 04:18:47 2008
Subject: [Harbour] Error compiling latest SVN
In-Reply-To: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
References: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
Message-ID: <993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>

Hi Toninho,

This seems like an older problem exploited
by enabling .dll building by default.

As for the proper solution, it's difficult
to tell it without having this compiler
freely available.

As a workaround try disabling .dlls using:
set HB_BUILD_DLL=no

[ I've just tested the default build using
BCC 5.8.2, and it finishes without error, just
as 5.5.1. ]

Brgds,
Viktor

On 2008.11.12., at 2:14, Toninho@fwi wrote:

> Hi friends,
>
> I have this error compiling harbour with latest SVN, BCC 6.10 and this
> flags:
>
> SET C_USR=-DHB_GUI -DHB_FM_STATISTICS_OFF -DHB_NO_PROFILER
> -DADS_LIB_VERSION=700 -DHB_HASH_MSG_ITEMS -DHB_FM_STD_ALLOC
> -DHB_NO_DEBUG
>
> source\vm\maindllh.c:
> 	ilink32.exe -Gn -C -aa -Tpd -Gi -Llib\b32  @MAKE0036.@@@
> Turbo Incremental Link 5.95 Copyright (c) 1997-2008 CodeGear
> Fatal: Unable to open file 'C0D32.OBJ'
>
> ** error 2 ** deleting bin\b32\harbour-11-b32.dll
>
>
> Best regards,
>
> Toninho.
>
> __________________________________________________
> Fa?a liga??es para outros computadores com o novo Yahoo! Messenger
> http://br.beta.messenger.yahoo.com/
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From toninhofwi at yahoo.com.br  Wed Nov 12 06:27:18 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Wed Nov 12 05:23:45 2008
Subject: [Harbour] Error compiling latest SVN
In-Reply-To: <993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>
References: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
	<993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>
Message-ID: <43flh4pbhh2dhhd6tjr5qofev3gkg6h6k9@4ax.com>

>As a workaround try disabling .dlls using:
>set HB_BUILD_DLL=no

Hi Viktor thanks. It works.

>[ I've just tested the default build using
>BCC 5.8.2, and it finishes without error, just
>as 5.5.1. ]
Maybe is related to my environment. I don?t have my bcc folders in
path. To compile Harbour, I copy bcc32.cfg to harbour folder and call
make_b32.bat

---bcc32.cfg---
-IE:\harbour\bcc55\include;E:\harbour\bcc55\include\dinkumware
-LE:\harbour\bcc55\lib
-O2
-d
-5
-6
-a8
-WC
-w-inl-
---bcc32.cfg---

I ways use a clean build.

Regards,

Toninho.



		
_______________________________________________________ 
Yahoo! Mail - Sempre a melhor op??o para voc?! 
Experimente j? e veja as novidades. 
http://br.yahoo.com/mailbeta/tudonovo/
 

From maurilio.longo at libero.it  Wed Nov 12 05:31:30 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Wed Nov 12 05:31:35 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20081112021719.GC21198@34-mo7-2.acn.waw.pl>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>	<49196BEE.6030306@mail.udg.mx>
	<4919B07A.1060106@libero.it>
	<20081112021719.GC21198@34-mo7-2.acn.waw.pl>
Message-ID: <491AB082.1060101@libero.it>

Przemyslaw, David,

I think the problem is not in the code but in the flags used to build harbour,
I've changed owatcom.cf this way

#CPPFLAGS = -j -w3 -d2 -5s -5r -fp5 -oxehtz -zq -zt0 -mf -bt=NT
#DAVID: CPPFLAGS = -w2 -d1 -zq -bt=OS2
CPPFLAGS = -w2 -d1 -zq -bt=OS2 -bm

#architecture flags
#CPPFLAGS += -5 -fp5

# optimization flags
# don't enable -ol optimization in OpenWatcom 1.1 - gives buggy code
#CPPFLAGS += -onaehtzr -oi+ -ei -zp8 -s -zt0

I've removed nearly all compilation flags, I don't know what they mean, but
anyway, I've always thought that if you need too many compiler flags to build,
something is wrong :)

And I've also changed ld flags this way:

LD = wlink
#DAVID: LDFLAGS = debug all OP osn=OS2 OP stack=65536 OP CASEEXACT
#LDFLAGS = debug all OP stack=65536 OP CASEEXACT
#LDFLAGS = debug all

I mean I've removed them all, BTW, having a stack of only 64K is a good way to
have troubles. I'm nearly sure GCC expands the stack on demand and starts with
 a 1Mb of stack space.

With these changes all mttest?? programs build and run but mttest10.prg which
I think tries to open more than one console, which I don't think is feasible
on OS/2.

speedtst runs with --thread=2 as well and here is its output.

Best regards.

Maurilio.



Przemyslaw Czerpak wrote:
> On Tue, 11 Nov 2008, Maurilio Longo wrote:
> 
> Hi Maurilio,
> 
>> what do you use to build harbour with watcom?
>> On my pc, simply trying to build a single .c file from the ide gives a trap
>> inside OS2KRNL, so I fear it is not SMP ready.
> 
> I do not know if the IDE is SMP ready but it's not a problem for
> us if rest is correct. Try to build Harbour using owatcom.cf which
> David sent you and make some tests using GTCGI.
> Probably all tests/mttest*.prg will work correctly.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: speedtst.log
Type: application/x-log
Size: 4259 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081112/e410e29e/speedtst.bin
From harbour.01 at syenar.hu  Wed Nov 12 06:34:55 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 06:34:59 2008
Subject: [Harbour] 2008-11-12 12:13 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c944ba$Blat.v2.6.2$af8dd5e6$16c857ba93f8@127.0.0.1>

2008-11-12 12:13 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
  * common.mak
  * utils/hbdoc/Makefile
  * utils/hbmake/Makefile
  * utils/hbtest/Makefile
  * utils/hbrun/Makefile
    % Setup to build shipped Harbour executables with -gc0.
    ; TODO: Please update make_gcc.mak.

  * ChangeLog
    + Marked one change as [TOMERGE 1.0]
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 12 06:44:39 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 06:44:47 2008
Subject: [Harbour] Error compiling latest SVN
In-Reply-To: <43flh4pbhh2dhhd6tjr5qofev3gkg6h6k9@4ax.com>
References: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
	<993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>
	<43flh4pbhh2dhhd6tjr5qofev3gkg6h6k9@4ax.com>
Message-ID: <4654D87F-95DF-4952-987C-AD749472C4A7@syenar.hu>

Hi Toninho,

>> [ I've just tested the default build using
>> BCC 5.8.2, and it finishes without error, just
>> as 5.5.1. ]
> Maybe is related to my environment. I don?t have my bcc folders in
> path. To compile Harbour, I copy bcc32.cfg to harbour folder and call
> make_b32.bat
>
> ---bcc32.cfg---
> -IE:\harbour\bcc55\include;E:\harbour\bcc55\include\dinkumware
> -LE:\harbour\bcc55\lib
> -O2
> -d
> -5
> -6
> -a8
> -WC
> -w-inl-
> ---bcc32.cfg---

This shouldn't make a difference, at least in 5.5, but I've
never tried that. I'd rather suggest to use C_USR to setup
special Harbour flags '-5 -6'. '-WC' '-w-inl-' are surely
unnecessary, and even '-a8' AFAIK. Then, the bcc32.cfg
stored in your Borland C bin dir would only need -I and
-L lines, and you could delete the local bcc32.cfg.

BTW, do you have a 'c0d32.obj' in your Borland lib dir?

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 12 06:50:34 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 06:50:44 2008
Subject: [Harbour] Wince and PellesC
In-Reply-To: <005f01c9449f$605100e0$20f302a0$@luis@iaicom.com>
References: <10C28C4554DFE54EB20321B9CB8931C2283104@servidor01.AGSoft.local>
	<3D2D0ADC-1F3F-4557-B887-3AED70C7B348@syenar.hu>
	<005f01c9449f$605100e0$20f302a0$@luis@iaicom.com>
Message-ID: <DA756AF2-089D-478C-ABBB-A2607D8D03D2@syenar.hu>

Hi Jose,

> Yesterday I updated trunk and could not see specific make for wince- 
> Pelles.
> Which one can I use?

HB_ARCHITECTURE=w32
HB_COMPILER=poccce

You'll need GNU make and to run make_gnu.bat.

Brgds,
Viktor

From dmacias at mail.udg.mx  Wed Nov 12 07:02:56 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Wed Nov 12 07:02:57 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491AC5F0.60408@mail.udg.mx>

 >I think the problem is not in the code but in the flags used to build
 >harbour, I've changed owatcom.cf this way

 >#CPPFLAGS = -j -w3 -d2 -5s -5r -fp5 -oxehtz -zq -zt0 -mf -bt=NT
 >#DAVID: CPPFLAGS = -w2 -d1 -zq -bt=OS2
 >CPPFLAGS = -w2 -d1 -zq -bt=OS2 -bm

 >#architecture flags
 >#CPPFLAGS += -5 -fp5

 ># optimization flags
 ># don't enable -ol optimization in OpenWatcom 1.1 - gives buggy code
 >#CPPFLAGS += -onaehtzr -oi+ -ei -zp8 -s -zt0

 >I've removed nearly all compilation flags, I don't know what they mean,
 >but anyway, I've always thought that if you need too many compiler flags
 > to build, mething is wrong :)

 >And I've also changed ld flags this way:

 >LD = wlink
 >#DAVID: LDFLAGS = debug all OP osn=OS2 OP stack=65536 OP CASEEXACT
 >#LDFLAGS = debug all OP stack=65536 OP CASEEXACT
 >#LDFLAGS = debug all

 >I mean I've removed them all, BTW, having a stack of only 64K is a 
good >way to have troubles. I'm nearly sure GCC expands the stack on 
demand >and starts with  a 1Mb of stack space.

 >With these changes all mttest?? programs build and run but 
mttest10.prg >which I think tries to open more than one console, which I 
don't think >is feasible on OS/2.

 >speedtst runs with --thread=2 as well and here is its output.

Maurilio:

I replicated your owatcom.cf and made a fresh build
As a note it delay 1/3 time of previous build with old owatcom.cf

But here problem remain
------------------
a) ST work fine
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_st.exe speedtst.prg

b) MT work fine
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe speedtst.prg

c) MT fail
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe 
speedtst.prg --scale


d) MT fail (perhaps your test)
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe 
speedtst.prg --thread=2

Your results:
---------
11/12/08 11:16:32 OS/2 4.50
Harbour 1.1.0dev (Rev. 9893) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.45
====================================================================
[ T001: x := L_C ]..............................................9.68
[...]
--------

and my results with hbrun_mt.exe:
--------
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe 
speedtst.prg --thread=2

11/12/08 05:42:53 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.29
====================================================================SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.
--------

and my results with compiled .prg:
--------
[E:\harbour811\harbour\tests]e:\harbour811\harbour\bin\pbaos2.cmd -mt 
speedtst
Open Watcom Linker Version 1.7
Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See http://www.openwatcom.org/ for details.
loading object files
searching libraries
creating an OS/2 32-bit executable
[E:\harbour811\harbour\tests]speedtst.exe --thread=2

11/12/08 05:51:15 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.32
====================================================================SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.
-------

What is code 0005 ?

------------------

As I see your Harbour rev is older, and empty loop overhead is greater

hbrun_st.exe was made with hbvm.lib (harbour\utils\hbrun\makefile)
hbrun_mt.exe was made with hbvmmt.lib (harbour\utils\hbrun\makefile)

and tests\mt\mttest*.prg fails as before
Example for mttest01.prg in ST and MT:
-----------------
[E:\harbour811\harbour\tests\mt]e:\harbour811\ow\bin\hbrun_st.exe 
mttest01.prg

Harbour 1.1.0dev (Rev. 9903)
Error BASE/3012  Argument error: HB_THREADJOIN
Called from HB_THREADJOIN(0)
Called from MAIN(25)
Called from HB_HRBRUN(0)
Called from _APPMAIN(0)
[E:\harbour811\harbour\tests\mt]e:\harbour811\ow\bin\hbrun_mt.exe 
mttest01.prg

Harbour 1.1.0dev (Rev. 9903)SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.
-----------------

Note: For these tests I am using hbrun_st.exe, hbrun_mt.exe and NOT 
compiled .prg files
- Using hbrun_mt.exe and compiled .prg gave same results in all previous 
tests
- owatcom.cf and bin\pbaos2.cmd for compiled .prg differ in big 
extension  in flags/switchs for OW. This is a pending subject to discuss


All this research about OW / MT raised since my message:

---------------------
Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):

[E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_mt.exe
speedtst.prg --scale

Using --scale cause this error:

--------------
11/06/08 05:08:24 OS/2 4.50
Harbour 1.1.0dev (Rev. 9846) (MT) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 1
N_LOOPS: 1000000
                                                          1 th.  1 th.
factor
============================================================================
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
--------------

Tracing it happen trying to execute
           hb_threadStart( "thTestScale", mtxJobs, mtxResults )
in section:
--------
     if lScale
        mtxJobs := hb_mutexCreate()
        mtxResults := hb_mutexCreate()
        nTimeTotST := nTimeTotMT := 0
        for i:=1 to nMT
           hb_threadStart( "thTestScale", mtxJobs, mtxResults )
        next
--------

but never enter to hb_threadStart( )
Perhaps error is for values in parameters ?

---------------------

and Przemek answer
---------------------
 > Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):
 > [E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_mt.exe
 > speedtst.prg --scale

Please try mttest*.prg 1st. It will be easier to locate basic problems.
---------------------

so I started mttest*.prg tests and further .c, .prg files

Rest is history   :-)


As I see, as at beginning of Harbour MT feature tests months ago, we get 
different result due OS/2 versions
- Your OS/2 SMP
- My eCS 1.2MR

We need a third player to decide  :-)



David Macias


From harbour.01 at syenar.hu  Wed Nov 12 07:58:12 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 07:58:14 2008
Subject: [Harbour] 2008-11-12 13:57 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c944c6$Blat.v2.6.2$51d49c12$3a0669cf800@127.0.0.1>

2008-11-12 13:57 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/common/hbverdsp.c
    ! Fixed displaying tracing status. (INFO and DEBUG level 
      counts as 'on'.)
--
Brgds,
Viktor

From dmacias at mail.udg.mx  Wed Nov 12 07:59:16 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Wed Nov 12 07:59:22 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491AD324.8000902@mail.udg.mx>

Checked with an older version OS/2 MCP (Media Convenience Pack) which 
have his own environment, so eCS paths, sets, files, libraries, dlls ... 
are excluded

Same failures as in eCS 1.2MR

Using hbrun_mt.exe from eCS in OS/2 MCP
--------------------
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe 
speedtst.prg --thread=2

11/12/08 06:14:11 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.29
====================================================================SYS1808:
El proceso se ha detenido.  El c?digo de diagn?stico de software (c?digo 
de excepci?n) es  0005.
--------------------

Using hbrun_mtmcp.exe from a ***clean Harbour build in OS/2 MCP***:
--------------------
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mtmcp.exe 
speedtst.prg --thread=2

11/12/08 06:38:07 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.29
====================================================================SYS1808:
El proceso se ha detenido.  El c?digo de diagn?stico de software (c?digo 
de excepci?n) es  0005.
-------------------

Maurilio, I sent to you owexefiles.exe with:
- hbrun_st.exe eCS
- hbrun_mt.exe eCS
- speedtst.exe eCS
- hbrun_stmcp.exe OS/2 MCP
- hbrun_mtmcp.exe OS/2 MCP

Test hbrun* speedtst.prg --thread=2

David Macias


>I think the problem is not in the code but in the flags used to build
>harbour, I've changed owatcom.cf this way

>#CPPFLAGS = -j -w3 -d2 -5s -5r -fp5 -oxehtz -zq -zt0 -mf -bt=NT
>#DAVID: CPPFLAGS = -w2 -d1 -zq -bt=OS2
>CPPFLAGS = -w2 -d1 -zq -bt=OS2 -bm

>#architecture flags
>#CPPFLAGS += -5 -fp5

># optimization flags
># don't enable -ol optimization in OpenWatcom 1.1 - gives buggy code
>#CPPFLAGS += -onaehtzr -oi+ -ei -zp8 -s -zt0

>I've removed nearly all compilation flags, I don't know what they mean,
>but anyway, I've always thought that if you need too many compiler flags
> to build, mething is wrong :)

>And I've also changed ld flags this way:

>LD = wlink
>#DAVID: LDFLAGS = debug all OP osn=OS2 OP stack=65536 OP CASEEXACT
>#LDFLAGS = debug all OP stack=65536 OP CASEEXACT
>#LDFLAGS = debug all

>I mean I've removed them all, BTW, having a stack of only 64K is a 
good >way to have troubles. I'm nearly sure GCC expands the stack on
demand >and starts with  a 1Mb of stack space.

>With these changes all mttest?? programs build and run but 
mttest10.prg >which I think tries to open more than one console, which I
don't think >is feasible on OS/2.

>speedtst runs with --thread=2 as well and here is its output.

Maurilio:

I replicated your owatcom.cf and made a fresh build
As a note it delay 1/3 time of previous build with old owatcom.cf

But here problem remain
------------------
a) ST work fine
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_st.exe speedtst.prg

b) MT work fine
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe speedtst.prg

c) MT fail
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe
speedtst.prg --scale


d) MT fail (perhaps your test)
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe
speedtst.prg --thread=2

Your results:
---------
11/12/08 11:16:32 OS/2 4.50
Harbour 1.1.0dev (Rev. 9893) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.45
====================================================================
[ T001: x := L_C ]..............................................9.68
[...]
--------

and my results with hbrun_mt.exe:
--------
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe
speedtst.prg --thread=2

11/12/08 05:42:53 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.29
====================================================================SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.
--------

and my results with compiled .prg:
--------
[E:\harbour811\harbour\tests]e:\harbour811\harbour\bin\pbaos2.cmd -mt
speedtst
Open Watcom Linker Version 1.7
Portions Copyright (c) 1985-2002 Sybase, Inc. All Rights Reserved.
Source code is available under the Sybase Open Watcom Public License.
See http://www.openwatcom.org/ for details.
loading object files
searching libraries
creating an OS/2 32-bit executable
[E:\harbour811\harbour\tests]speedtst.exe --thread=2

11/12/08 05:51:15 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.32
====================================================================SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.
-------

What is code 0005 ?

------------------

As I see your Harbour rev is older, and empty loop overhead is greater

hbrun_st.exe was made with hbvm.lib (harbour\utils\hbrun\makefile)
hbrun_mt.exe was made with hbvmmt.lib (harbour\utils\hbrun\makefile)

and tests\mt\mttest*.prg fails as before
Example for mttest01.prg in ST and MT:
-----------------
[E:\harbour811\harbour\tests\mt]e:\harbour811\ow\bin\hbrun_st.exe
mttest01.prg

Harbour 1.1.0dev (Rev. 9903)
Error BASE/3012  Argument error: HB_THREADJOIN
Called from HB_THREADJOIN(0)
Called from MAIN(25)
Called from HB_HRBRUN(0)
Called from _APPMAIN(0)
[E:\harbour811\harbour\tests\mt]e:\harbour811\ow\bin\hbrun_mt.exe
mttest01.prg

Harbour 1.1.0dev (Rev. 9903)SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0005.
-----------------

Note: For these tests I am using hbrun_st.exe, hbrun_mt.exe and NOT
compiled .prg files
- Using hbrun_mt.exe and compiled .prg gave same results in all previous
tests
- owatcom.cf and bin\pbaos2.cmd for compiled .prg differ in big
extension  in flags/switchs for OW. This is a pending subject to discuss


All this research about OW / MT raised since my message:

---------------------
Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):

[E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_mt.exe
speedtst.prg --scale

Using --scale cause this error:

--------------
11/06/08 05:08:24 OS/2 4.50
Harbour 1.1.0dev (Rev. 9846) (MT) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 1
N_LOOPS: 1000000
                                                          1 th.  1 th.
factor
============================================================================
SYS1808:
The process has stopped.  The software diagnostic
code (exception code) is  0001.
--------------

Tracing it happen trying to execute
           hb_threadStart( "thTestScale", mtxJobs, mtxResults )
in section:
--------
     if lScale
        mtxJobs := hb_mutexCreate()
        mtxResults := hb_mutexCreate()
        nTimeTotST := nTimeTotMT := 0
        for i:=1 to nMT
           hb_threadStart( "thTestScale", mtxJobs, mtxResults )
        next
--------

but never enter to hb_threadStart( )
Perhaps error is for values in parameters ?

---------------------

and Przemek answer
---------------------
> Tests with current Harbour - OS/2 - With OpenWatcom 1.7 (Rev. 9846):
> [E:\harbour810\harbour\tests]e:\harbour810\harbourow\bin\hbrun_mt.exe
> speedtst.prg --scale

Please try mttest*.prg 1st. It will be easier to locate basic problems.
---------------------

so I started mttest*.prg tests and further .c, .prg files

Rest is history   :-)


As I see, as at beginning of Harbour MT feature tests months ago, we get
different result due OS/2 versions
- Your OS/2 SMP
- My eCS 1.2MR

We need a third player to decide  :-)



David Macias



From druzus at acn.waw.pl  Wed Nov 12 08:03:44 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 08:02:44 2008
Subject: [Harbour] Clipper RL compilation problem
In-Reply-To: <200811112335.43586.philb@philb.us>
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>
	<ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
	<20081111100115.GA19736@34-mo7-2.acn.waw.pl>
	<200811112335.43586.philb@philb.us>
Message-ID: <20081112130344.GA6815@34-mo7-2.acn.waw.pl>

On Wed, 12 Nov 2008, Phil Barnett wrote:

Hi Phil,

> The difference is likely to be more pronounced when there are hundreds of 
> variables that are public, vs hundreds of locals scattered throughout the 
> software.

Neither in Clipper nor in [x]Harbour the speed of memvar variables
does not depend on number of allocated variables so it will not change
the result at all. Memvars variables in normal code are not accessed
by name. It's a mit which comes from Clipper days. Maybe some old Clipper
version make it. When .prg module is registered to each symbol item used
by memvar variable is assigned index to variable holder and then this
index is used in source code. It means that it does not make any symbol
table scans during evaluation and the speed is comparable to static and
local variables.

> Perhaps the test could be modified to show this problem of many publics.

As I said it will not change the results because memvars are not accessed
by name during PCODE evaluation. The only one place where they are accessed
by name is using memvars inside macro compiler during macrocompilation
phase, f.e.:
   x := &"{|| M->VAR }"  // here VAR is located by name in symbol table
                         // just like any other symbols, .f.e. function
                         // names.
   eval( x )             // no symbol scan during evaluation.

> Anyway that's how it was with Clipper. Not sure of Harbour.

I do not know Clipper internals by few years ago I made speed tests
and at list in CL5.2/CL5.3 there is no symbol table lookup. PCODE
evaluation is very fast comparable to static and locals and number
of memvar variables does not change the speed.
Maybe such situation happened with older Clipper versions.
The only one and very serious problem in Clipper is limited number
of memvars which can be used so programs which extensively used them
had very serious problems when reach this limit because many different
problems inside Clipper VM seems to be exploited in such case.

best regards,
Przemek
From druzus at acn.waw.pl  Wed Nov 12 08:34:35 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 08:33:36 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <20455052.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
	<1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
	<20452073.post@talk.nabble.com>
	<20081112024915.GB29888@34-mo7-2.acn.waw.pl>
	<20455052.post@talk.nabble.com>
Message-ID: <20081112133435.GB6815@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> May be I could not present my case properly.
> I understand your implementation of new GT and also 
> how it is behaving. My request is based on the new OBJECT 
> modal I am building on lines with Xbase++ where I needed 
> such functionality. 
> I only need GTINFO manipulation is such way nothing else.

If it resolves your problem locally then simply add such function
to your code.
IMHO it will not help and if you have such problem now then you will
have it with new code though maybe exploited in different place.

> static BOOL hb_gt_wvt_Info( PHB_GT pGTx, int iType, PHB_GT_INFO pInfo )  //
> initial change
> {
>    PHB_GT pGT = NULL;
>    PHB_GTWVT pWVT;
>    int iVal;
> 
>    HB_TRACE( HB_TR_DEBUG, ( "hb_gt_wvt_Info(%p,%d,%p)", pGT, iType, pInfo )
> );
> 
>    if( pInfo->pGT && hb_itemType( pInfo->pGT ) & HB_IT_POINTER )
>    {
>       pGT = hb_gt_ItemBase( pInfo->pGT );
>       if( pGT )
>          hb_gt_BaseFree( pGT );
>       else
>          pGT = pGTx;
>    }
>    if( !pGT )
>    {
>       pGT = pGTx;
>    }

When you are writing OOP code do ypu plan to pass SELF as 1-st parameter
and then you are making sth like:

   IF SELF == NIL
      SELF := QSelf()
   ENDIF

???

> Above changes does not disturb current GT implementation. I 

Don't you see that it breaks GT locking?
After:
    hb_gt_BaseFree( pGT );
pGT is not locked and other threads can make some operation on it
when you are still using it in you INFO() method?

> have tested extensively with both GTWVT and GTWVG. Instead 
> it empowers me to manipulate GTs running in different threads
> from current thread. I have some interesting usage in place 
> and hopefully by ths weekend I be able to upload partial but
> working xbase++ cmpatible class structure in GTWVG, pure console.
> If agreed let me know if I can commit above changes.

1-st it's wrong.
2-nd for me you more or less intentionally found a workaround
for some problem in your code which is probably resolved by
removing GT mutex protection. The problem will still exist in
your codeand the above will not help you if we fixed the code
to keep protection.
3-rd other people which will have to work on GT code will kill
us when they discover that pGT context can be replaced inside
executed method ;-)

Below is full hb_gtInfoeEx() implementation in C. It does not
switch GT context and it has working GT locking. Use it locally
in your code. Maybe it will help you to locate the problem which
is in your code. Probably deadlock. Or maybe it will work for
you as you want.

Best regards,
Przemek


HB_FUNC( HB_GTINFO )
{
   if( ISPOINTER( 1 ) && ISNUM( 2 ) )
   {
      PHB_GT pGT = hb_gt_ItemBase( hb_param( 1, HB_IT_ANY ) );

      if( pGT )
      {
         HB_GT_INFO gtInfo;
         gtInfo.pNewVal  = hb_param( 3, HB_IT_ANY );
         gtInfo.pNewVal2 = hb_param( 4, HB_IT_ANY );
         gtInfo.pResult  = NULL;

         HB_GTSELF_INFO( pGT, hb_parni( 2 ), &gtInfo );
         hb_gt_BaseFree( pGT );

         if( gtInfo.pResult )
            hb_itemReturnRelease( gtInfo.pResult );
      }
   }
   else
      hb_errRT_BASE_SubstR( EG_ARG, 3012, NULL, HB_ERR_FUNCNAME, HB_ERR_ARGS_BASEPARAMS );
}
From druzus at acn.waw.pl  Wed Nov 12 08:39:59 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 08:39:00 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491AB082.1060101@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49196BEE.6030306@mail.udg.mx> <4919B07A.1060106@libero.it>
	<20081112021719.GC21198@34-mo7-2.acn.waw.pl>
	<491AB082.1060101@libero.it>
Message-ID: <20081112133959.GC6815@34-mo7-2.acn.waw.pl>

On Wed, 12 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> I think the problem is not in the code but in the flags used to build harbour,
> I've changed owatcom.cf this way

It's highly possible.

> I've removed nearly all compilation flags, I don't know what they mean, but
> anyway, I've always thought that if you need too many compiler flags to build,
> something is wrong :)
> And I've also changed ld flags this way:
> LD = wlink
> #DAVID: LDFLAGS = debug all OP osn=OS2 OP stack=65536 OP CASEEXACT
> #LDFLAGS = debug all OP stack=65536 OP CASEEXACT
> #LDFLAGS = debug all

I think the problem can be caused by debug information.
It may also explain the problems with tracing David have.
If possible please try to locate which option caused the problem.
You can start with removing -d1 from WPP flags and debug all.

best rergards,
Przemek
From harbour.01 at syenar.hu  Wed Nov 12 08:45:32 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 08:45:34 2008
Subject: [Harbour] 2008-11-12 14:44 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c944cc$Blat.v2.6.2$eea15f20$137c3e2dc78c@127.0.0.1>

2008-11-12 14:44 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_vc.mak
    + TOFIX added for the case when HB_CC_NAME is overridden 
      by user and MT/DLL targets are being created.

  * common.mak
  * source/common/hbver.c
    % Minor opts.
--
Brgds,
Viktor

From labitas at gmail.com  Wed Nov 12 08:56:21 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Wed Nov 12 08:56:26 2008
Subject: [Harbour] DBFCDX-ORDCREATE: Clipper 5.3 vs Harbour
Message-ID: <2386af1b0811120556v6a8a1975rd394df01a546b379@mail.gmail.com>

Hello Przemek,

Sample below behaves different in Clipper and Harbour.

Clipper:

OrdKey: CODE
KEYSIZE:         20
         1 CODE: check over           ORDKEYVAL: check over
         2 CODE: check up             ORDKEYVAL: check up
         3 CODE: check out            ORDKEYVAL: check out

Harbour:

OrdKey: CODE
KEYSIZE:          4
         1 CODE: check over           ORDKEYVAL: chec
         2 CODE: check up             ORDKEYVAL: chec
         3 CODE: check out            ORDKEYVAL: chec
 */

#ifdef __HARBOUR__
  #include "dbinfo.ch"
  request HB_GT_STD_DEFAULT
#else
  #include "ord.ch"
#endif

request DBFCDX

#define TMP_DST "tst_dst"


Proc Main()
  Local nFor, cKey, aValues
  FIELD CODE

 aValues := { "check over", ;
              "check up", ;
              "check out" }

 RddSetDefault( 'DBFCDX' )

 dbcreate( TMP_DST, { {"CODE", "C", 20, 0} } )
 USE TMP_DST EXCLUSIVE

// INDEX ON CODE TAG T1

 cKey := "CODE"

 ordCreate(, "T1", cKey, {|| cKey} )

 SET INDEX TO (TMP_DST)

 ? "OrdKey:", OrdKey()
 ? "KEYSIZE:", dbOrderInfo( DBOI_KEYSIZE )

 For nFor := 1 to Len(aValues)
   dbAppend()
   CODE := aValues[ nFor ]
   dbSkip( 0 )
   ? nFor, "CODE:", CODE, "ORDKEYVAL:", OrdKeyVal()
 next
Return

Best regards,
Saulius
From mbelgrano at deltain.it  Wed Nov 12 09:22:13 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Nov 12 09:23:15 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue,
	xValue2 ) -Feature Request
In-Reply-To: <20455052.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com><20081111101606.GC19736@34-mo7-2.acn.waw.pl><20445886.post@talk.nabble.com><08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu><20449893.post@talk.nabble.com><1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu><20452073.post@talk.nabble.com><20081112024915.GB29888@34-mo7-2.acn.waw.pl>
	<20455052.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F184@SRV02.deltain.net>

I Highly appreciate the idea of partial but working xbase++ compatible
class structure in GTWVG
I can understand choice of rigidity for reliability 
Do you plan implement a complete version in few month?

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Wednesday, November 12, 2008 7:41 AM
To: harbour@harbour-project.org
Subject: Re: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 )
-Feature Request


Przemek

May be I could not present my case properly.

I understand your implementation of new GT and also 
how it is behaving. My request is based on the new OBJECT 
modal I am building on lines with Xbase++ where I needed 
such functionality. 

I only need GTINFO manipulation is such way nothing else.

Below is my proposed changes to bring this feature:

hbapigt.h [#146]
-------------

typedef struct
{
   PHB_ITEM pNewVal;
   PHB_ITEM pResult;
   PHB_ITEM pNewVal2;
   PHB_ITEM pGT;               // New Member
} HB_GT_INFO, * PHB_GT_INFO;



hbgtcore.c [#1614]
------------------

gtInfo.pNewVal = gtInfo.pNewVal2 = gtInfo.pResult = gtInfo.pGT = NULL;
//
new members




gtfunc.c [#116]
---------------

HB_FUNC( HB_GTINFOEX )         // New Function
{
   if( ISPOINTER( 1 ) && ISNUM( 2 ) )
   {
      HB_GT_INFO gtInfo;

      gtInfo.pGT      = hb_param( 1, HB_IT_ANY );
      gtInfo.pNewVal  = hb_param( 3, HB_IT_ANY );
      gtInfo.pNewVal2 = hb_param( 4, HB_IT_ANY );
      gtInfo.pResult  = NULL;

      hb_gtInfo( hb_parni( 2 ), &gtInfo );
      if( gtInfo.pResult )
         hb_itemReturnRelease( gtInfo.pResult );
   }
   else
      hb_errRT_BASE_SubstR( EG_ARG, 3012, NULL, HB_ERR_FUNCNAME,
HB_ERR_ARGS_BASEPARAMS );
}



gtwvg.c [#2397]
---------------

static BOOL hb_gt_wvt_Info( PHB_GT pGTx, int iType, PHB_GT_INFO pInfo )
//
initial change
{
   PHB_GT pGT = NULL;
   PHB_GTWVT pWVT;
   int iVal;

   HB_TRACE( HB_TR_DEBUG, ( "hb_gt_wvt_Info(%p,%d,%p)", pGT, iType,
pInfo )
);

   if( pInfo->pGT && hb_itemType( pInfo->pGT ) & HB_IT_POINTER )
   {
      pGT = hb_gt_ItemBase( pInfo->pGT );
      if( pGT )
         hb_gt_BaseFree( pGT );
      else
         pGT = pGTx;
   }
   if( !pGT )
   {
      pGT = pGTx;
   }

   ....
   ....


Above changes does not disturb current GT implementation. I 
have tested extensively with both GTWVT and GTWVG. Instead 
it empowers me to manipulate GTs running in different threads
from current thread. I have some interesting usage in place 
and hopefully by ths weekend I be able to upload partial but
working xbase++ cmpatible class structure in GTWVG, pure console.

If agreed let me know if I can commit above changes.

Regards
Pritpal Bedi

-- 
View this message in context:
http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2
-%29---Feature-Request-tp20414605p20455052.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From druzus at acn.waw.pl  Wed Nov 12 10:04:43 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 10:03:43 2008
Subject: [Harbour] new HB_ARCHITECTURE=wince ?
In-Reply-To: <42D7670C-26FE-447F-B86F-F9DE2BF84C12@syenar.hu>
References: <42D7670C-26FE-447F-B86F-F9DE2BF84C12@syenar.hu>
Message-ID: <20081112150443.GA1205@34-mo7-2.acn.waw.pl>

On Mon, 10 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> I'd like to ask opinions whether to introduce wince
> as a distinct architecture in the GNU-make system.
> This would replace current w32/mingwce, w32/msvcce,
> w32/poccce builds with wince/mingw, wince/msvc,
> wince/pocc.

Dont' you afraid that we will end with winvista, winxp,
win9x, win64 and other subdirectories?

> It would be useful because it would make it easier
> to enable/disable contribs for this platform.
> As of now, following contribs should have been
> disabled for WinCE builds: hbwhat, hbole, hbmysql,
> gtalleg, hbtpathy, hbfimage.

Most of them are libraries which needs 3-rd party libs.
If such libs will be in WinCE version then they should
work. hbole should be fixed.

> [ Some of these could probably be fixed to compile
> under WinCE, but some definitely not. ]

Which one?

> It would also allow to better sync non-GNU make
> with GNU make by changing HB_BUILD_WINCE=yes to
> HB_ARCHITECTURE=wince.

I do not think so. HB_BUILD_WINCE is used to mark that it's
a cross build not only to mark destination platform.
In GNU make HB_XBUILD is used for it. There are different
possible combination of cross building and of course also
native builds. So far we do not have native WINCE builds
but it may change in the future with increasing PocketPC
capabilities. It's technically possible even now with
MinGWCE but because I do not have such needs I haven't
added such possibilities so far.
Now HB_XBUILD is used in some *nixes to create Win32/64/CE
binaries and in Win32/64 to create WinCE binaries. I plan
to add OpenWatcom cross build support too. Adding separate
support for HB_ARCHITECTURE=wince does not inform that it's
a cross build so second variable is still necessary.

best regards,
Przemek
From druzus at acn.waw.pl  Wed Nov 12 10:23:33 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 10:22:33 2008
Subject: [Harbour] DBFCDX-ORDCREATE: Clipper 5.3 vs Harbour
In-Reply-To: <2386af1b0811120556v6a8a1975rd394df01a546b379@mail.gmail.com>
References: <2386af1b0811120556v6a8a1975rd394df01a546b379@mail.gmail.com>
Message-ID: <20081112152333.GB1205@34-mo7-2.acn.waw.pl>

On Wed, 12 Nov 2008, Saulius Zrelskis wrote:

Hi Saulius,

> Sample below behaves different in Clipper and Harbour.
> Clipper:
> OrdKey: CODE
> KEYSIZE:         20
>          1 CODE: check over           ORDKEYVAL: check over
>          2 CODE: check up             ORDKEYVAL: check up
>          3 CODE: check out            ORDKEYVAL: check out
> Harbour:
> OrdKey: CODE
> KEYSIZE:          4
>          1 CODE: check over           ORDKEYVAL: chec
>          2 CODE: check up             ORDKEYVAL: chec
>          3 CODE: check out            ORDKEYVAL: chec

It's expected. CL53 DBFCDX ignores codeblock passed to ordCreate()
and recompile string key value. AFAIR few year ago I replicated it
but people reported it as problem when they are using hacked custom
codeblock with local variables for some temporary custom indexes.

> #ifdef __HARBOUR__
>   #include "dbinfo.ch"
>   request HB_GT_STD_DEFAULT
> #else
>   #include "ord.ch"
> #endif
> request DBFCDX
> #define TMP_DST "tst_dst"
> Proc Main()
>   Local nFor, cKey, aValues
>   FIELD CODE
>  aValues := { "check over", ;
>               "check up", ;
>               "check out" }
>  RddSetDefault( 'DBFCDX' )
>  dbcreate( TMP_DST, { {"CODE", "C", 20, 0} } )
>  USE TMP_DST EXCLUSIVE
> // INDEX ON CODE TAG T1
>  cKey := "CODE"
>  ordCreate(, "T1", cKey, {|| cKey} )

Here is a bug in your code which creates the difference. It should be:
   ordCreate(, "T1", cKey, {|| &cKey} )
otherwise you create index where key value is fixed "CODE" string in
the given codeblock. CL53 DBFCDX/COMIX ignores codeblock but CL52 DBFCDX/
SIX3 and DBFNTX doesn't and the results are exactly the same as in Harbour.

>  SET INDEX TO (TMP_DST)

This closes current index and reopen it. Because in index file only string
representation of used expressions can be stored (codeblocks cannot) then
"CODE" expression is recompiled and now it's used instead of fixed string
"CODE". But index was created with key size 4 and this information is
stored in index file and is properly retrieve.

best regards,
Przemek
From bedipritpal at hotmail.com  Wed Nov 12 10:52:32 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov 12 10:52:35 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <20081112133435.GB6815@34-mo7-2.acn.waw.pl>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
	<1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
	<20452073.post@talk.nabble.com>
	<20081112024915.GB29888@34-mo7-2.acn.waw.pl>
	<20455052.post@talk.nabble.com>
	<20081112133435.GB6815@34-mo7-2.acn.waw.pl>
Message-ID: <20463092.post@talk.nabble.com>


Hello Przemek

I cannot think of myself so dumb :-((

I wonder why I took a long route whereas the shortest and
neatest was awailable.


Przemyslaw Czerpak-2 wrote:
> 
> HB_FUNC( HB_GTINFO )
> {
>    if( ISPOINTER( 1 ) && ISNUM( 2 ) )
>    {
>       PHB_GT pGT = hb_gt_ItemBase( hb_param( 1, HB_IT_ANY ) );
> 
>       if( pGT )
>       {
>          HB_GT_INFO gtInfo;
>          gtInfo.pNewVal  = hb_param( 3, HB_IT_ANY );
>          gtInfo.pNewVal2 = hb_param( 4, HB_IT_ANY );
>          gtInfo.pResult  = NULL;
> 
>          HB_GTSELF_INFO( pGT, hb_parni( 2 ), &gtInfo );
>          hb_gt_BaseFree( pGT );
> 
>          if( gtInfo.pResult )
>             hb_itemReturnRelease( gtInfo.pResult );
>       }
>    }
>    else
>       hb_errRT_BASE_SubstR( EG_ARG, 3012, NULL, HB_ERR_FUNCNAME,
> HB_ERR_ARGS_BASEPARAMS );
> }
> 

I changed the name to HB_GTINFOEX and kept this code in gtwvg.c.
It gets me what I require. To function it properly as per my needs,
I had to issue instead of 

         HB_GTSELF_INFO( pGT, hb_parni( 2 ), &gtInfo );
         hb_gt_BaseFree( pGT );


         hb_gt_BaseFree( pGT );
         HB_GTSELF_INFO( pGT, hb_parni( 2 ), &gtInfo );

I have to release the lock before I fetch the values otherwise 
current GT remains locked forever. In theory it should not happen but
happens. Possibly how I am trying to use it havethis side effect.

<<<
Don't you see that it breaks GT locking? 
After: 
    hb_gt_BaseFree( pGT ); 
pGT is not locked and other threads can make some operation on it 
when you are still using it in you INFO() method? 
>>>

I understand your viewpoint and investigating more.
Perhaps at the point I call this function I do not need it to be locked
because I am already on another GT which is in the diaplay process.

I will come to this topic later. For now my request is resolved.

Thanks
Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20463092.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Wed Nov 12 10:55:52 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov 12 10:55:55 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -Feature
	Request
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F184@SRV02.deltain.net>
References: <20414605.post@talk.nabble.com>
	<20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
	<1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
	<20452073.post@talk.nabble.com>
	<20081112024915.GB29888@34-mo7-2.acn.waw.pl>
	<20455052.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F184@SRV02.deltain.net>
Message-ID: <20463188.post@talk.nabble.com>


Massimo

>Do you plan implement a complete version in few month?

I will try as much I could. 

But for sure someone should join me in this effort.
First let me expose the basic class structure and some
functional dmo code.

Once this is in place, I think we can go miles ahead.

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2-%29---Feature-Request-tp20414605p20463188.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Wed Nov 12 11:31:49 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 11:32:04 2008
Subject: [Harbour] new HB_ARCHITECTURE=wince ?
In-Reply-To: <20081112150443.GA1205@34-mo7-2.acn.waw.pl>
References: <42D7670C-26FE-447F-B86F-F9DE2BF84C12@syenar.hu>
	<20081112150443.GA1205@34-mo7-2.acn.waw.pl>
Message-ID: <CB06EF99-9FEA-4AC8-8AD6-2F5E212C0098@syenar.hu>

Hi Przemek,

>> I'd like to ask opinions whether to introduce wince
>> as a distinct architecture in the GNU-make system.
>> This would replace current w32/mingwce, w32/msvcce,
>> w32/poccce builds with wince/mingw, wince/msvc,
>> wince/pocc.
>
> Dont' you afraid that we will end with winvista, winxp,
> win9x, win64 and other subdirectories?

No. WinCE is a different beast than the rest of
the flavors, as you must know the best. We also have
the special macro HB_WINCE internally for this reason.

I'd change w32 to simply win as a next step, and win
should cover all desktop flavors. Maybe we could
separate win32 and win64, but so far I cannot see
any strong reason to do it and it'd be better trying
to avoid this anyway in the future.

[ but we may also want to introduce a 3rd level of
builds: real architecture, like x86, x64, ia32, ia64,
this would make it easier to create such builds in
parallel. no very high priority. ]

>> It would be useful because it would make it easier
>> to enable/disable contribs for this platform.
>> As of now, following contribs should have been
>> disabled for WinCE builds: hbwhat, hbole, hbmysql,
>> gtalleg, hbtpathy, hbfimage.
>
> Most of them are libraries which needs 3-rd party libs.
> If such libs will be in WinCE version then they should
> work. hbole should be fixed.

Well, gtwvg, hbwhat, hbtpathy f.e. don't have 3rd party
dependencies, yet they cannot be compiled and there don't
seem to be anyone taking care of this, but we certainly
cannot be sure they'll be ever fixed, if a fix is possible
at all.

In any case it'd be good to have a facility to exclude
packages for WinCE, even if those are 3rd party dependent
ones IMO.

[ I'd prefer to delete hbwhat from the repository BTW,
but that's another matter, it's a permanent candidate
for all sorts of problems and without developers actively
fixing/testing it. I haven't seen any user of it either,
so it pretty much looks like an unnecessary clog in
Harbour. ]

>> [ Some of these could probably be fixed to compile
>> under WinCE, but some definitely not. ]
>
> Which one?

hbole, hbct, hbnf, hbsqlit3: yes
hbfbird, hbtpathy, hbodbc: maybe
gtwvg, hbwhat: I don't know.

>> It would also allow to better sync non-GNU make
>> with GNU make by changing HB_BUILD_WINCE=yes to
>> HB_ARCHITECTURE=wince.
>
> I do not think so. HB_BUILD_WINCE is used to mark that it's
> a cross build not only to mark destination platform.
> In GNU make HB_XBUILD is used for it. There are different
> possible combination of cross building and of course also
> native builds. So far we do not have native WINCE builds
> but it may change in the future with increasing PocketPC
> capabilities. It's technically possible even now with
> MinGWCE but because I do not have such needs I haven't
> added such possibilities so far.

HB_XBUILD is merely a signal that the current and
target platforms are different. Even Win64 build
creation on Win32 is a cross build. So for above purpose,
it's not suitable. HB_BUILD_WINCE I didn't know about
in GNU-make (and it seem to have a different meaning
in non-GNU make), but it doesn't seem like a std way
to control this problem to me.

> Now HB_XBUILD is used in some *nixes to create Win32/64/CE
> binaries and in Win32/64 to create WinCE binaries. I plan
> to add OpenWatcom cross build support too. Adding separate
> support for HB_ARCHITECTURE=wince does not inform that it's
> a cross build so second variable is still necessary.

Yes, but this is a different problem. We should
probably have two separate variables for current
and target platform.

Like:

HB_COMPILER=pocc
HB_ARCHITECTURE=wince
HB_ARCH_HOST=win32 [we may allow leaving this empty for non-cross  
builds]

HB_XBUILD => ( HB_ARCH_HOST != "" && HB_ARCH_HOST != HB_ARCHITECTURE )

Brgds,
Viktor

From toninhofwi at yahoo.com.br  Wed Nov 12 12:48:55 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Wed Nov 12 11:45:21 2008
Subject: [Harbour] Error compiling latest SVN
In-Reply-To: <4654D87F-95DF-4952-987C-AD749472C4A7@syenar.hu>
References: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
	<993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>
	<43flh4pbhh2dhhd6tjr5qofev3gkg6h6k9@4ax.com>
	<4654D87F-95DF-4952-987C-AD749472C4A7@syenar.hu>
Message-ID: <4s4mh4pr5vmnlq6o0g0c86ake3oj139qah@4ax.com>

>This shouldn't make a difference, at least in 5.5, but I've
>never tried that. I'd rather suggest to use C_USR to setup
>special Harbour flags '-5 -6'. '-WC' '-w-inl-' are surely
>unnecessary, and even '-a8' AFAIK. Then, the bcc32.cfg
>stored in your Borland C bin dir would only need -I and
>-L lines, and you could delete the local bcc32.cfg.

Hi Viktor,

I did above changes, but I still need use HB_BUILD_DLL=no.

>BTW, do you have a 'c0d32.obj' in your Borland lib dir?
Yes, I have.


Thanks and best regards,

Toninho.


	

	
		
_______________________________________________________ 
Yahoo! Mail - Sempre a melhor opo para voc! 
Experimente j e veja as novidades. 
http://br.yahoo.com/mailbeta/tudonovo/
From mbelgrano at deltain.it  Wed Nov 12 11:59:25 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Nov 12 12:00:23 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue,
	xValue2 ) -FeatureRequest
In-Reply-To: <20463188.post@talk.nabble.com>
References: <20414605.post@talk.nabble.com><20081111101606.GC19736@34-mo7-2.acn.waw.pl><20445886.post@talk.nabble.com><08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu><20449893.post@talk.nabble.com><1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu><20452073.post@talk.nabble.com><20081112024915.GB29888@34-mo7-2.acn.waw.pl><20455052.post@talk.nabble.com><AFB948164110ED43B5EB849E8DEEF03815F184@SRV02.deltain.net>
	<20463188.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F189@SRV02.deltain.net>

Imo you can update gtwvg (also with provisory name file) as you want,
also with not working code
After this I hope that somebody can help you more easy
Or I miss something?

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Wednesday, November 12, 2008 4:56 PM
To: harbour@harbour-project.org
Subject: RE: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 )
-FeatureRequest


Massimo

>Do you plan implement a complete version in few month?

I will try as much I could. 

But for sure someone should join me in this effort.
First let me expose the basic class structure and some
functional dmo code.

Once this is in place, I think we can go miles ahead.

Regards
Pritpal Bedi


-- 
View this message in context:
http://www.nabble.com/hb_gtInfoEx%28-pGT%2C-nGtInfo%2C-xValue%2C-xValue2
-%29---Feature-Request-tp20414605p20463188.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From harbour.01 at syenar.hu  Wed Nov 12 12:21:19 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 12:21:23 2008
Subject: [Harbour] 2008-11-12 18:20 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c944eb$Blat.v2.6.2$13a26846$1710b8e2b196@127.0.0.1>

2008-11-12 18:20 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/common/hbverdsp.c
    * Don't show '(C mode)', only C++.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov 12 12:53:53 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 12:52:53 2008
Subject: [Harbour] hb_gtInfoEx( pGT, nGtInfo, xValue, xValue2 ) -
	Feature Request
In-Reply-To: <20463092.post@talk.nabble.com>
References: <20081111101606.GC19736@34-mo7-2.acn.waw.pl>
	<20445886.post@talk.nabble.com>
	<08A81C3C-6F4B-48AB-B466-C71C069A5100@syenar.hu>
	<20449893.post@talk.nabble.com>
	<1D1DA54C-149C-483B-A597-119438C503D3@syenar.hu>
	<20452073.post@talk.nabble.com>
	<20081112024915.GB29888@34-mo7-2.acn.waw.pl>
	<20455052.post@talk.nabble.com>
	<20081112133435.GB6815@34-mo7-2.acn.waw.pl>
	<20463092.post@talk.nabble.com>
Message-ID: <20081112175353.GA7721@34-mo7-2.acn.waw.pl>

On Wed, 12 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> I wonder why I took a long route whereas the shortest and
> neatest was awailable.

Please try to read carefully the text below. If you will not
understand sth then please ask about it. I'll try to help but
I need that you will want to create really MT safe code not a
code which sometimes can work without a crash.

> I changed the name to HB_GTINFOEX and kept this code in gtwvg.c.
> It gets me what I require. To function it properly as per my needs,
> I had to issue instead of 
> 
>          HB_GTSELF_INFO( pGT, hb_parni( 2 ), &gtInfo );
>          hb_gt_BaseFree( pGT );
> 
> 
>          hb_gt_BaseFree( pGT );
>          HB_GTSELF_INFO( pGT, hb_parni( 2 ), &gtInfo );

The above modification confirms that the problem is in your code.

> I have to release the lock before I fetch the values otherwise 
> current GT remains locked forever. In theory it should not happen but
> happens. Possibly how I am trying to use it havethis side effect.

You should locate the exact reason or you may have unexpected
behaviour in final MT applications. GT uses recursive locks.
It means that one thread can lock GT many times and then should
unlock it the same number of times to make it available for
other threads. If in your code calling GTINFO with locked GT
is a problem then it means that you created deadlock because
some of your code depends on unlocked access to GT structure
and other threads also operate on this GT and probably try to
lock other GTs. You can remove all locks and maybe it will
work and only sometimes crashes when two threads will begin to
change the same data in the same code. It's even possible that
on single CPU machine the problem will not be exploited and
will crash only on real CPU machines. But it does not mean that
the code is correct. Probably the problem is caused by the fact
that in Windows some operations on window structure can be done
_ONLY_ by the thread which created the window and all other threads
which try to execute them are blocked until the thread which is
window owner will not execute them. 10 against 1 that you have
such situation inside INFO method and when it's executed with
locked GT driver it's stopped until window owner thread will
not make it. And it cannot make it because GT is locked. Such
deadlock existed in pure GTWVT when SendMessage() was used instead
of SendNotifyMessage(). SendMessage blocks thread which executed
this function untill thread which is window owner will not process
this message. When it's the same thread then it's not a problem.
When it's other thread then we have deadlock because it is not
able to enter GT structure and process messages because GT is
locked by thread which waits on SendMessage(). To resolve it
I changed all SendMessage() calls to SendNotifyMessage(). But
I do not check all other functions you are adding as INFO method
actions if they do not have the same problem, f.e. they can
internally call SendMessage(). I hope that anyone adding such
new function call to GTWVT will check in MSDN documentation if
such things can happen and if it's a problem then will use
alternative function or parameters to avoid blocking. When
it's impossible then he should unlock GT driver before calling
blocking function and then lock it again. F.e. if I want to
force that message send to window will be processed instead of
leaving it in a queue only then I can use SendMessage() instead
of SendNotifyMessage() in the following way:
   HB_GTSELF_UNLOCK( pGT );   // unlock GT driver for other threads
                              // and hWND owner which can be different
                              // thread then current one.
   SendMessage( hWND, .... );
   HB_GTSELF_LOCK( pGT );     // lock the GT to be sure that other
                              // threads does not manipulate on pGT
                              // structure.
and the problem of deadlock will be resolved. This is proper solution
and you are asking about removing GT locking inside new function
hb_gtInfoEX() because you created code which produce deadlock and
this is sufficient workaround for you without checking the reason
of problem or what wrong may happen when other thread is accessing
the GT structure you are using. And then we have reports like Viktor
that sth can crash after some mouse manipulation. It's possible but
because the problem is exploited by race condition due to missing
mutex protection then it's not be easy repeatable and the same code
can work fine executed 1000 times and will crash in 1001 test or
in 101 when real multi CPU machine is used.
If at beginning you will create a lot of such code then fixing it
later will be a nightmare. Probably it will be easier to rewrote
it from scratch what sometimes is even good idea because you should
know all final conditions and you can design it in better way :-)

> I understand your viewpoint and investigating more.
> Perhaps at the point I call this function I do not need it to be locked
> because I am already on another GT which is in the diaplay process.

If you read carefully above text then you will find that your thread
is blocked untill other thread which is window owner will lock GT
structure and process all pending messages unblocking your thread.
In MS-Window only thread which created window can process its messages
so two thread are entering the same GT structure in the same time without
any synchronization code.

BTW In GTWVG is a function:
   PHB_GTWVT hb_wvt_gtGetWVT( void );

which return pointer to PHB_GTWVT but the GT is unlocked. It means that
you need your own protection code for accessing this GT or better you
should change this function and remove hb_gt_BaseFree() adding corresponding
function:
   void hb_wvt_gtFreeWVT( PHB_GTWVT pWVT )
   {
      hb_gt_BaseFree( pWVT->pGT );
   }
which will be called when you finished all operations on pWVT.

best reagrds,
Przemek
From harbour.01 at syenar.hu  Wed Nov 12 12:56:24 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 12:56:32 2008
Subject: [Harbour] Error compiling latest SVN
In-Reply-To: <4s4mh4pr5vmnlq6o0g0c86ake3oj139qah@4ax.com>
References: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
	<993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>
	<43flh4pbhh2dhhd6tjr5qofev3gkg6h6k9@4ax.com>
	<4654D87F-95DF-4952-987C-AD749472C4A7@syenar.hu>
	<4s4mh4pr5vmnlq6o0g0c86ake3oj139qah@4ax.com>
Message-ID: <77B7F65E-ED92-4836-9DAC-E379D992F4E6@syenar.hu>

Hi Toninho,

> Hi Viktor,
>
> I did above changes, but I still need use HB_BUILD_DLL=no.
>> BTW, do you have a 'c0d32.obj' in your Borland lib dir?
> Yes, I have.

Very strange. No more ideas here. Anyone?

Brgds,
Viktor

From labitas at gmail.com  Wed Nov 12 13:07:15 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Wed Nov 12 13:07:19 2008
Subject: [Harbour] DBFCDX-ORDCREATE: Clipper 5.3 vs Harbour
In-Reply-To: <20081112152333.GB1205@34-mo7-2.acn.waw.pl>
References: <2386af1b0811120556v6a8a1975rd394df01a546b379@mail.gmail.com>
	<20081112152333.GB1205@34-mo7-2.acn.waw.pl>
Message-ID: <2386af1b0811121007u1b294a28h4e54d6450cd6f4e@mail.gmail.com>

Hi Przemek,

> Here is a bug in your code which creates the difference. It should be:
>   ordCreate(, "T1", cKey, {|| &cKey} )
> otherwise you create index where key value is fixed "CODE" string in
> the given codeblock. CL53 DBFCDX/COMIX ignores codeblock but CL52 DBFCDX/
> SIX3 and DBFNTX doesn't and the results are exactly the same as in Harbour.
>
>>  SET INDEX TO (TMP_DST)
>
> This closes current index and reopen it. Because in index file only string
> representation of used expressions can be stored (codeblocks cannot) then
> "CODE" expression is recompiled and now it's used instead of fixed string
> "CODE". But index was created with key size 4 and this information is
> stored in index file and is properly retrieve.

I just happen to have forgotten a little bit...
Live and learn, right.

Best regards,
Saulius
From harbour.01 at syenar.hu  Wed Nov 12 13:07:33 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 13:07:40 2008
Subject: [Harbour] hbfm.lib (and hbfmmt.lib) in non-GNU make
Message-ID: <74F0875B-59EB-4DA7-A142-8EFBCC1360B8@syenar.hu>

Hi folks,

I've been struggling with making non-GNU make
system to create hbfm.lib and hbfmmt.lib, just
like these exist in GNU make.

The idea is to build Harbour with mem stats off
by default and to create hbfm.lib and MT version
hbfmmt.lib as an alternative FM lib with mem
stats turned on.

This way there would be no need to deal with
changing the default for release/devel Harbour,
fm stat toggling would become a link time option,
GNU and non-GNU make would have one more less
difference, and hbmk.bat could be able to create
fm stat enabled executable using a simple command
line switch, just like with hbmk bash script.

I can't get it to work though.

Przemek, do you see any chance that you could
somehow convert this to a runtime option? no hurry,
it's enough if you say whether it's somewhere on
your table :)

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 12 13:13:05 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 13:13:07 2008
Subject: [Harbour] 2008-11-12 19:11 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c944f2$Blat.v2.6.2$4ef46546$1dc426971008@127.0.0.1>

2008-11-12 19:11 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.bat
  * make_b32.mak
  * make_vc.bat
  * make_vc.mak
  * make_gcc.mak
  * contrib/mtpl_b32.mak
  * contrib/mtpl_gcc.mak
  * contrib/mtpl_vc.mak
    + Added 'set HB_BUILD_OPTIM=no' option to disable 
      all C compiler optimization for all compilers in 
      non-GNU make system. This replaces old envvars 
      BCC_NOOPTIM and GCC_NOOPTIM and add MSVC support 
      for this option.

  * common.mak
    * Formatting.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov 12 13:41:51 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 13:40:52 2008
Subject: [Harbour] new HB_ARCHITECTURE=wince ?
In-Reply-To: <CB06EF99-9FEA-4AC8-8AD6-2F5E212C0098@syenar.hu>
References: <42D7670C-26FE-447F-B86F-F9DE2BF84C12@syenar.hu>
	<20081112150443.GA1205@34-mo7-2.acn.waw.pl>
	<CB06EF99-9FEA-4AC8-8AD6-2F5E212C0098@syenar.hu>
Message-ID: <20081112184151.GA21699@34-mo7-2.acn.waw.pl>

On Wed, 12 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>> Dont' you afraid that we will end with winvista, winxp,
>> win9x, win64 and other subdirectories?
> No. WinCE is a different beast than the rest of
> the flavors, as you must know the best. We also have
> the special macro HB_WINCE internally for this reason.

I do not agree. The differences between WinCE API and WinXP
are smaller then between Win9x and WinXP.
In our contrib code number of MS-Windows API functions which
does not exists in Win9x is systematically growing up and here
the problem is bigger the with WinCE and if we do not begin
to check it then we lost Win9x and NT4 compatibility in the
nearest future.

> I'd change w32 to simply win as a next step, and win
> should cover all desktop flavors. Maybe we could
> separate win32 and win64, but so far I cannot see
> any strong reason to do it and it'd be better trying
> to avoid this anyway in the future.

Now the biggest problem is only with Win9x for which we do
not even have build time setting to force Win9x compatibility.

> [ but we may also want to introduce a 3rd level of
> builds: real architecture, like x86, x64, ia32, ia64,
> this would make it easier to create such builds in
> parallel. no very high priority. ]

The achitucture problem is not real problem for us because
you need separated biunaries for each architecutre so you have
to rebuild harbour with different arch switches. The real problem
is in used MS-Windows API functions. To support new feature we
have to use new functions. But there is no easy way to now compile
Harbour code excluding all stuff which does not exists in Win9x.
In some cases where C compilers supports some dummy libraries
with dummy functions for Win9x then it we are trying to detect
use OS at runtime but such method does not work in all cases.

>> Most of them are libraries which needs 3-rd party libs.
>> If such libs will be in WinCE version then they should
>> work. hbole should be fixed.
> Well, gtwvg, hbwhat, hbtpathy f.e. don't have 3rd party
> dependencies, yet they cannot be compiled and there don't
> seem to be anyone taking care of this, but we certainly
> cannot be sure they'll be ever fixed, if a fix is possible
> at all.

Just like we cannot be sure that they will work with Win9x
in a year if we will keep current code updating and like you
do not know what will happen with incoming Win7. It's possible
that MS will force UNICODE builds for some new Windows version
just like it did for WinCE. As I can see then WinCE is quite
often updated and many of its modifications are later intorduced
to desktop windows so keeping the code ready for WinCE is very
good idea to make it ready for new desktop windows. Here I do
not see any problems with current build process and I like that
it forces some modifications.
As I said for me the real problem is in keeping support for older
Win32 versions which we probably lost if we do not make sth with it.

> In any case it'd be good to have a facility to exclude
> packages for WinCE, even if those are 3rd party dependent
> ones IMO.

But we do not need for this HB_ARCHOTC

> [ I'd prefer to delete hbwhat from the repository BTW,
> but that's another matter, it's a permanent candidate
> for all sorts of problems and without developers actively
> fixing/testing it. I haven't seen any user of it either,
> so it pretty much looks like an unnecessary clog in
> Harbour. ]

Maybe you should ask Andrzej about it? Maybe it can help.
AFAIK he was working extensively on this library in last
years but I do not know the current status of his code and
if he will want to public it.

>>> [ Some of these could probably be fixed to compile
>>> under WinCE, but some definitely not. ]
>> Which one?
> hbole, hbct, hbnf, hbsqlit3: yes
> hbfbird, hbtpathy, hbodbc: maybe
> gtwvg, hbwhat: I don't know.

hbole, hbct, hbnf, hbsqlit3, hbodbc, hbtpathy, hbwhat, gtwvg
are present in my MinGWCE builds. I do not have firebird installed
so I cannot check if it can be compiled and I do not know if WinCE
FB port exists. Even if not now then it can appear in the future.

> HB_XBUILD is merely a signal that the current and
> target platforms are different. Even Win64 build
> creation on Win32 is a cross build. So for above purpose,
> it's not suitable. HB_BUILD_WINCE I didn't know about
> in GNU-make (and it seem to have a different meaning
> in non-GNU make), but it doesn't seem like a std way
> to control this problem to me.

Exactly and this should be the rule of HB_BUILD_WINCE.
Isn't it?
It's the reason why we have separate envvar. Single
HB_ARCHITECTURE is not enough.

> Yes, but this is a different problem. We should
> probably have two separate variables for current
> and target platform.
> Like:
> HB_COMPILER=pocc
> HB_ARCHITECTURE=wince
> HB_ARCH_HOST=win32 [we may allow leaving this empty for non-cross builds]
> HB_XBUILD => ( HB_ARCH_HOST != "" && HB_ARCH_HOST != HB_ARCHITECTURE )

Why not. But it's naming convention which we can clean. But still
the real problem I can see is with used API. For WinCE builds we have
HB_WINCE macro and it resolves the problem partially (we do not have
support for WinCE version) but we have nothing to keep Win9x/NT4 working.
and this is a problem for me.
BTW seeing libraries you listed as problematic in your WinCE builds it
looks that you will need HB_ARCHITECTURE=wince to exclude them from
WinCE builds when they can be build for WinCE and at least some of them
like CT I intentionally updated to work with WinCE and even tested some
functionality. So the problem is strictly bound with CRTL for WinCE
supported by given compiler not with HB_ARCHITECTURE. So if you really
want then you should exclude them using HB_COMPILER variable not
HB_ARCHITECTURE.

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Nov 12 14:03:35 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 14:03:37 2008
Subject: [Harbour] 2008-11-12 20:03 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c944f9$Blat.v2.6.2$5cfe78fa$4b0b2c75e80@127.0.0.1>

2008-11-12 20:03 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * doc/linux1st.txt
    * Updated for Ubuntu 8.10.
--
Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov 12 14:19:17 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 14:18:17 2008
Subject: [Harbour] Error compiling latest SVN
In-Reply-To: <77B7F65E-ED92-4836-9DAC-E379D992F4E6@syenar.hu>
References: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
	<993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>
	<43flh4pbhh2dhhd6tjr5qofev3gkg6h6k9@4ax.com>
	<4654D87F-95DF-4952-987C-AD749472C4A7@syenar.hu>
	<4s4mh4pr5vmnlq6o0g0c86ake3oj139qah@4ax.com>
	<77B7F65E-ED92-4836-9DAC-E379D992F4E6@syenar.hu>
Message-ID: <20081112191917.GA12421@34-mo7-2.acn.waw.pl>

On Wed, 12 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor and Toninho

>>> BTW, do you have a 'c0d32.obj' in your Borland lib dir?
>> Yes, I have.
> Very strange. No more ideas here. Anyone?

Please check the location of c0d32.obj and if it's known for BCC
compiler so it can locate during linking. AFAIR ilink in BCC needs
valid paths set in ilink32.cfg. It was -L option or sth like that.
You can also use bcc32.exe as wrapper to ilink32.exe and if I'm
not wrong in such case link switches in bcc32.cfg are passed to
ilink32.exe.

best regards,
Przemek
From druzus at acn.waw.pl  Wed Nov 12 14:44:10 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 14:43:10 2008
Subject: [Harbour] hbfm.lib (and hbfmmt.lib) in non-GNU make
In-Reply-To: <74F0875B-59EB-4DA7-A142-8EFBCC1360B8@syenar.hu>
References: <74F0875B-59EB-4DA7-A142-8EFBCC1360B8@syenar.hu>
Message-ID: <20081112194410.GA17457@34-mo7-2.acn.waw.pl>

On Wed, 12 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> The idea is to build Harbour with mem stats off
> by default and to create hbfm.lib and MT version
> hbfmmt.lib as an alternative FM lib with mem
> stats turned on.
> I can't get it to work though.

If you try to enable memory statistic in shared
binaries using harbour.dll then it will not work
in such way. In MS-Windows DLL is not shared library
like in other systems but complete executable which
only public some entries. It means that any internal
bindings cannot be overloaded :-(
But it should work for static builds. Here the only one
problem is caused by the fact that it's library. In the
past original version was using fm.o (obj file) and
linking was much easier because it was enough to add it
to linked object list. It was converted to library and
now looks nicer but it creates additional problems.
You have to know dependencies used by your linker and
Harbour core code and insert FM lib after 1-st request
to some of FM module functions and before HVM lib.
It should be enough for Windows linkers. For GCC I had
to generate temporary .c file with request to HB_FM_STAT
which is compiled and linked with final binaries.
It's a classic example where sth looking nicer may create
more problems. Libraries are used by linkers in different
way then object files.

> Przemek, do you see any chance that you could
> somehow convert this to a runtime option? no hurry,
> it's enough if you say whether it's somewhere on
> your table :)

I looked at this modification and it's not hard to implement
if hb_getenv_buffer() will work inside start up code (I do
not know if all C compilers will support it) so memory statistic
can be enabled by environment variable. I do not see any protable
way to implement RT application switch for it. Maybe it can
be done for some chosen C compiler for which is known how to
extract parameters from their internal structures before
main()/WinMain() is executed.
The modification is rather simple but it will be necessary to
reorganize current code to keep support for compilation without
any FM statistic and FM statistic always enabled. Just simply
more #IFs with replicated code if we do not want to introduce
some dummy instructions.
I'll make it when I'll find some time for it.

best regards,
Przemek
From druzus at acn.waw.pl  Wed Nov 12 17:16:34 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 17:15:33 2008
Subject: [Harbour] 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>

2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/vm/fm.c
    + added support for enabling/disabling memory statistic when
      application starts. To enable memory statistic it's enough
      to set HB_FM_STAT environment variable to non empty value.
      To disable memory statistic it's enough to set HB_NO_FM_STAT
      envvar. The default setting may depend on build time option.
      Now is enabled when memory statistic is compiled when harbour
      is created. It may not work if C compiler does not allow to
      check environment variables from startup code. F.e. functions
      to access environment can be also part of dynamic library
      registered after harbour.dll or harbour core code startup
      functions.
      Viktor I would like to ask you only about one thing.
      Please do not remove current support for HB_FM_STATISTICS_OFF
      from GNU make builds so Harbour user can still create binaries
      without any memory statistic code using -[no]fmstat switch in
      hb* scripts. The above feature is only for users who need support
      for enabling/disabling memory statistic to test application
      if foreign environment, f.e. at client computers. Of course if
      it will work with given C compiler and/or type of application
      (linked dynamically or statically). Please check.

best regards
Przemek
From druzus at acn.waw.pl  Wed Nov 12 17:28:26 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 12 17:27:25 2008
Subject: [Harbour] 2008-11-12 23:28 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081112222826.GA7820@34-mo7-2.acn.waw.pl>

2008-11-12 23:28 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/rtl/hbgtcore.c
    ! removed code I committed by mistake.

best regards
Przemek
From harbour.01 at syenar.hu  Wed Nov 12 18:16:26 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 18:16:35 2008
Subject: [Harbour] hbfm.lib (and hbfmmt.lib) in non-GNU make
In-Reply-To: <20081112194410.GA17457@34-mo7-2.acn.waw.pl>
References: <74F0875B-59EB-4DA7-A142-8EFBCC1360B8@syenar.hu>
	<20081112194410.GA17457@34-mo7-2.acn.waw.pl>
Message-ID: <9BF2798B-1BDB-4A4F-9EC4-26BB27855C82@syenar.hu>

Hi Przemek,

> If you try to enable memory statistic in shared
> binaries using harbour.dll then it will not work
> in such way. In MS-Windows DLL is not shared library
> like in other systems but complete executable which
> only public some entries. It means that any internal
> bindings cannot be overloaded :-(
> But it should work for static builds. Here the only one
> problem is caused by the fact that it's library. In the
> past original version was using fm.o (obj file) and
> linking was much easier because it was enough to add it
> to linked object list. It was converted to library and
> now looks nicer but it creates additional problems.
> You have to know dependencies used by your linker and
> Harbour core code and insert FM lib after 1-st request
> to some of FM module functions and before HVM lib.
> It should be enough for Windows linkers. For GCC I had
> to generate temporary .c file with request to HB_FM_STAT
> which is compiled and linked with final binaries.
> It's a classic example where sth looking nicer may create
> more problems. Libraries are used by linkers in different
> way then object files.

My fears exactly (but worded much more precisely :)

>> Przemek, do you see any chance that you could
>> somehow convert this to a runtime option? no hurry,
>> it's enough if you say whether it's somewhere on
>> your table :)
>
> I looked at this modification and it's not hard to implement
> if hb_getenv_buffer() will work inside start up code (I do
> not know if all C compilers will support it) so memory statistic
> can be enabled by environment variable. I do not see any protable
> way to implement RT application switch for it. Maybe it can
> be done for some chosen C compiler for which is known how to
> extract parameters from their internal structures before
> main()/WinMain() is executed.

An envvar will suffice. FM STATS is a tracing tool
and normal app flow tracing (HB_TRACE) is already enabled
using envvars, so this is not without precedent in
Harbour, and someone wanting to use it would most
probably able to set it up (this means Harbour and
3rd party developers in the first place). F.e. developers
would simply have this envvar set on development
machines and naturally not set on end users', so the
app would just behave as expected in both environment,
without any need to rebuild or recompile. Seems very
natural to me.

> The modification is rather simple but it will be necessary to
> reorganize current code to keep support for compilation without
> any FM statistic and FM statistic always enabled. Just simply
> more #IFs with replicated code if we do not want to introduce
> some dummy instructions.

Well, IMO (and other opinions are of course welcome),
it should be enough to let this be controlled only
by the envvar. Part of the goal would be to avoid
as much of the current mess regarding this switch
in both make systems. If we could get rid of this,
it would make things a lot simpler and cleaner IMO.

[ It would even be a gain, as for most developers
building and maintaining two parallel Harbour
build (one with FM STAT and one without) is usually
not an option, so I either expect most ppl to
simply slip through possible memory corruption
problems, and another smaller part using an
unnecessarily slow app full time. Neither is very
ideal. ]

> I'll make it when I'll find some time for it.

Many thanks.

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 12 18:20:22 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 18:20:30 2008
Subject: [Harbour] Error compiling latest SVN
In-Reply-To: <20081112191917.GA12421@34-mo7-2.acn.waw.pl>
References: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
	<993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>
	<43flh4pbhh2dhhd6tjr5qofev3gkg6h6k9@4ax.com>
	<4654D87F-95DF-4952-987C-AD749472C4A7@syenar.hu>
	<4s4mh4pr5vmnlq6o0g0c86ake3oj139qah@4ax.com>
	<77B7F65E-ED92-4836-9DAC-E379D992F4E6@syenar.hu>
	<20081112191917.GA12421@34-mo7-2.acn.waw.pl>
Message-ID: <754DD43F-72C5-4F2C-A061-95844934DF30@syenar.hu>

Hi Przemek,

Very good point. It may explain Toninho's problem
well. Since he was not using the central config files
(which is BTW an install time requirement for all
Borland C compilers), and he was only copying in
bcc32.cfg, ilink32 was clueless about lib dirs.

Thanks a lot. This also means this is a local
env problem, not a Harbour one.

I'd recommend everyone to follow official steps
to setup C tools (for MSVC it's vsvars*.bat or
something alike). Maybe we should have a document
on this.

Brgds,
Viktor

On 2008.11.12., at 20:19, Przemyslaw Czerpak wrote:

> On Wed, 12 Nov 2008, Szak?ts Viktor wrote:
>
> Hi Viktor and Toninho
>
>>>> BTW, do you have a 'c0d32.obj' in your Borland lib dir?
>>> Yes, I have.
>> Very strange. No more ideas here. Anyone?
>
> Please check the location of c0d32.obj and if it's known for BCC
> compiler so it can locate during linking. AFAIR ilink in BCC needs
> valid paths set in ilink32.cfg. It was -L option or sth like that.
> You can also use bcc32.exe as wrapper to ilink32.exe and if I'm
> not wrong in such case link switches in bcc32.cfg are passed to
> ilink32.exe.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Wed Nov 12 18:35:12 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 12 18:35:28 2008
Subject: [Harbour] 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>
References: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>
Message-ID: <237A4092-9690-4614-A2AE-AAE5D6213604@syenar.hu>

Many thanks, I will test it in a sec.

What I'd like to do is disable FM STAT for all default builds.
So users would rather need HB_FM_STATISTICS, if they need
it permanently enabled for some (to me wierd looking) reason.

Do you see a problem with that?

Brgds,
Viktor

On 2008.11.12., at 23:16, Przemyslaw Czerpak wrote:

> 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>  * harbour/source/vm/fm.c
>    + added support for enabling/disabling memory statistic when
>      application starts. To enable memory statistic it's enough
>      to set HB_FM_STAT environment variable to non empty value.
>      To disable memory statistic it's enough to set HB_NO_FM_STAT
>      envvar. The default setting may depend on build time option.
>      Now is enabled when memory statistic is compiled when harbour
>      is created. It may not work if C compiler does not allow to
>      check environment variables from startup code. F.e. functions
>      to access environment can be also part of dynamic library
>      registered after harbour.dll or harbour core code startup
>      functions.
>      Viktor I would like to ask you only about one thing.
>      Please do not remove current support for HB_FM_STATISTICS_OFF
>      from GNU make builds so Harbour user can still create binaries
>      without any memory statistic code using -[no]fmstat switch in
>      hb* scripts. The above feature is only for users who need support
>      for enabling/disabling memory statistic to test application
>      if foreign environment, f.e. at client computers. Of course if
>      it will work with given C compiler and/or type of application
>      (linked dynamically or statically). Please check.
>
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From toninhofwi at yahoo.com.br  Wed Nov 12 20:08:49 2008
From: toninhofwi at yahoo.com.br (Toninho@fwi)
Date: Wed Nov 12 19:00:46 2008
Subject: [Harbour] Error compiling latest SVN
In-Reply-To: <20081112191917.GA12421@34-mo7-2.acn.waw.pl>
References: <tdbkh4t9jmvhhmm4kb894vhpuavq4gtafq@4ax.com>
	<993AB5E0-3505-43E9-8CC6-F213C9B60AFE@syenar.hu>
	<43flh4pbhh2dhhd6tjr5qofev3gkg6h6k9@4ax.com>
	<4654D87F-95DF-4952-987C-AD749472C4A7@syenar.hu>
	<4s4mh4pr5vmnlq6o0g0c86ake3oj139qah@4ax.com>
	<77B7F65E-ED92-4836-9DAC-E379D992F4E6@syenar.hu>
	<20081112191917.GA12421@34-mo7-2.acn.waw.pl>
Message-ID: <f7umh412hp5okast42ihs6afntf29kk92v@4ax.com>

>Hi Viktor and Toninho

>Please check the location of c0d32.obj and if it's known for BCC
>compiler so it can locate during linking. AFAIR ilink in BCC needs
>valid paths set in ilink32.cfg. It was -L option or sth like that.
>You can also use bcc32.exe as wrapper to ilink32.exe and if I'm
>not wrong in such case link switches in bcc32.cfg are passed to
>ilink32.exe.

Hi Przemek and Viktor,

I found the problem.

With latest changes in makefiles now we need:

---bcc32.cfg---
-IE:\harbour\bcc55\include;E:\harbour\bcc55\include\dinkumware
-LE:\harbour\bcc55\lib
---bcc32.cfg---

*** AND***

---ilink32.cfg---
-LE:\harbour\bcc55\lib"
---ilink32.cfg---


Now Harbour compiles fine.

Thanks and best regards,

Toninho.

__________________________________________________
Faa ligaes para outros computadores com o novo Yahoo! Messenger 
http://br.beta.messenger.yahoo.com/ 
From maurilio.longo at libero.it  Thu Nov 13 03:59:26 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Thu Nov 13 03:59:31 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20081112133959.GC6815@34-mo7-2.acn.waw.pl>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>	<49196BEE.6030306@mail.udg.mx>
	<4919B07A.1060106@libero.it>	<20081112021719.GC21198@34-mo7-2.acn.waw.pl>	<491AB082.1060101@libero.it>
	<20081112133959.GC6815@34-mo7-2.acn.waw.pl>
Message-ID: <491BEC6E.9030805@libero.it>

Przemyslaw,

I'think I've found something:

first of all, I started from config/win32/owatcom flags, then I had to remove
-bt=OS2 which is wrong, should be -bt=OS2V2 but this gives an undefined
function referenced error when building, so I removed every thing, then I
changed -5 to -5r because -5 is for 16bit code.

It still did non build though, so I started looking at optimization flags
where I found that -s disables stack overlow checking; and it was it!

So I changed it to -sg which means grow stack upon need, so now I have

CPPFLAGS = -w2 -zq

#architecture flags
CPPFLAGS += -6r -fp6

# optimization flags
# don't enable -ol optimization in OpenWatcom 1.1 - gives buggy code
CPPFLAGS += -onaehtzr -oi+ -ei -zp8 -sg -zt0

I've used -6r since, given we're building for a peculiar cpu, at least we use
a modern one as target and -sg as explained earlier.

For LDFLAGS I have this

LDFLAGS = OP stack=65536 OP CASEEXACT

given that now stack can be grown, it does not give problems.

All mttest?? do work (apart from nr. 10) and speedtst works as well.

Best regards.

Maurilio.


Przemyslaw Czerpak wrote:
> On Wed, 12 Nov 2008, Maurilio Longo wrote:
> 
> Hi Maurilio,
> 
>> I think the problem is not in the code but in the flags used to build harbour,
>> I've changed owatcom.cf this way
> 
> It's highly possible.
> 
>> I've removed nearly all compilation flags, I don't know what they mean, but
>> anyway, I've always thought that if you need too many compiler flags to build,
>> something is wrong :)
>> And I've also changed ld flags this way:
>> LD = wlink
>> #DAVID: LDFLAGS = debug all OP osn=OS2 OP stack=65536 OP CASEEXACT
>> #LDFLAGS = debug all OP stack=65536 OP CASEEXACT
>> #LDFLAGS = debug all
> 
> I think the problem can be caused by debug information.
> It may also explain the problems with tracing David have.
> If possible please try to locate which option caused the problem.
> You can start with removing -d1 from WPP flags and debug all.
> 
> best rergards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From labitas at gmail.com  Thu Nov 13 04:07:17 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Thu Nov 13 04:07:21 2008
Subject: [Harbour] DBFCDX-ORDCREATE: Clipper 5.3 vs Harbour
In-Reply-To: <2386af1b0811121007u1b294a28h4e54d6450cd6f4e@mail.gmail.com>
References: <2386af1b0811120556v6a8a1975rd394df01a546b379@mail.gmail.com>
	<20081112152333.GB1205@34-mo7-2.acn.waw.pl>
	<2386af1b0811121007u1b294a28h4e54d6450cd6f4e@mail.gmail.com>
Message-ID: <2386af1b0811130107i6d0d1ab1h3e3a853f17a5f253@mail.gmail.com>

Hi Przemek,

> It's expected. CL53 DBFCDX ignores codeblock passed to ordCreate()
> and recompile string key value. AFAIR few year ago I replicated it

To be precise CL53 DBFCDX/COMIX analyses ordCreate() parameter cExpKey.
If it is _simple_ field name and this field _type_ is CHARACTER, then
cdxOrderCreate() uses this field value directly without codeblock
compiling/execution (likely for speed purpose). In _all_ other cases
users bExpKey codeblock is used. I not find this logic very sexy, but
it is better to know one exception, when _my_ codeblock supplied is
ignored. Then I can instead of
 ordCreate(, 'T1', 'CODE', {|| STRTRAN(CODE,' ', '_')} )
do
 ordCreate(, 'T1', '', {|| STRTRAN(CODE,' ', '_')} )
or
 ordCreate(, 'T1', 'NOTFIELD', {|| STRTRAN(CODE,' ', '_')} )
and codeblock is executed.

Say, when
dbcreate( TMP_DST, { {"CODE", "N", 20, 0} } )
append: 1000, 2000, 3000
ordCreate(, "T1", "CODE", {|| Padl(CODE,20,'0')} )

Clipper:
OrdKey: CODE
KEYSIZE:         20
         1 CODE:                 1000 ORDKEYVAL: 00000000000000001000
         2 CODE:                 2000 ORDKEYVAL: 00000000000000002000
         3 CODE:                 3000 ORDKEYVAL: 00000000000000003000

Harbour:
OrdKey: CODE
KEYSIZE:         20
         1 CODE:                 1000 ORDKEYVAL: _?@.....
         2 CODE:                 2000 ORDKEYVAL: _?@.....
         3 CODE:                 3000 ORDKEYVAL: _?p.....

When
dbcreate( TMP_DST, { {"CODE", "D", 8, 0} } )
append: DATE(), DATE() +1, DATE() +2
ordCreate(, "T1", "CODE", {|| DTOS(CODE)} )

Clipper:
OrdKey: CODE
KEYSIZE:          8
         1 CODE: 11/13/08 ORDKEYVAL: 20081113
         2 CODE: 11/14/08 ORDKEYVAL: 20081114
         3 CODE: 11/15/08 ORDKEYVAL: 20081115

Harbour:
OrdKey: CODE
KEYSIZE:          8
         1 CODE: 11/13/08 ORDKEYVAL: _B_.?...
         2 CODE: 11/14/08 ORDKEYVAL: _B_?....
         3 CODE: 11/15/08 ORDKEYVAL: _B_??...

Of course this story about temporary indexes.

Best regards,
Saulius
From harbour.01 at syenar.hu  Thu Nov 13 06:13:54 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov 13 06:14:11 2008
Subject: [Harbour] 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>
References: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>
Message-ID: <35D6E776-25D6-4483-9243-88349B710D71@syenar.hu>

Hi Przemek,

I've just peeked into the implementation and did some tests.

New dynamic FM STAT when turned off is about 8% slower
than fully turned off FM STAT. Quite huge overhead :(
Looks like a few branches can make such big difference
(similar to HB_NO_DEBUG).

It means this isn't a costless feature, and thus cannot
replace our current solutions.

Do you see any chance to somehow lessen this overhead?
(maybe using indirect pointers instead of branching?)

Brgds,
Viktor

On 2008.11.12., at 23:16, Przemyslaw Czerpak wrote:

> 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>  * harbour/source/vm/fm.c
>    + added support for enabling/disabling memory statistic when
>      application starts. To enable memory statistic it's enough
>      to set HB_FM_STAT environment variable to non empty value.
>      To disable memory statistic it's enough to set HB_NO_FM_STAT
>      envvar. The default setting may depend on build time option.
>      Now is enabled when memory statistic is compiled when harbour
>      is created. It may not work if C compiler does not allow to
>      check environment variables from startup code. F.e. functions
>      to access environment can be also part of dynamic library
>      registered after harbour.dll or harbour core code startup
>      functions.
>      Viktor I would like to ask you only about one thing.
>      Please do not remove current support for HB_FM_STATISTICS_OFF
>      from GNU make builds so Harbour user can still create binaries
>      without any memory statistic code using -[no]fmstat switch in
>      hb* scripts. The above feature is only for users who need support
>      for enabling/disabling memory statistic to test application
>      if foreign environment, f.e. at client computers. Of course if
>      it will work with given C compiler and/or type of application
>      (linked dynamically or statically). Please check.
>
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From dmacias at mail.udg.mx  Thu Nov 13 09:13:40 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Thu Nov 13 09:13:41 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491C3614.9050702@mail.udg.mx>

Przemek, Maurilio:

I checked all compiler flags info and for us just -s is critical, rest
are mainly default values
Without -s MT run fine, including "speedtst.prg --scale" which based on 
my tests revealed problem with threads except 1
-s seem to be the end of a week plenty of tests  :-)

 >I'think I've found something:

 >first of all, I started from config/win32/owatcom flags, then I had to
 >remove -bt=OS2 which is wrong, should be -bt=OS2V2 but this gives an 
 >undefined function referenced error when building, so I removed every
 >thing, then I changed -5 to -5r because -5 is for 16bit code.

Maurilio, flags were based in win32 flags and just -bt was changed
-bt=OS2 is correct and we will use later for cross platform tests
OS2V2 is for linker SYSTEM directive
-5 in 32bit default to r if r or s are not specified

 >It still did non build though, so I started looking at optimization
 >flags where I found that -s disables stack overlow checking; and it 
was >it!

Yes, it is. An entire week in order to found it  :-)
And KbdCharIn(), Mou..() functions are not guilty

 >So I changed it to -sg which means grow stack upon need, so now I have

 >CPPFLAGS = -w2 -zq

 >#architecture flags
 >CPPFLAGS += -6r -fp6

 ># optimization flags
 ># don't enable -ol optimization in OpenWatcom 1.1 - gives buggy code
 >CPPFLAGS += -onaehtzr -oi+ -ei -zp8 -sg -zt0

 >I've used -6r since, given we're building for a peculiar cpu, at least
 >we use a modern one as target and -sg as explained earlier.

We can ignore -5[r], -fp5, -6[r], -fp6

You are missing -bm for MT

 >For LDFLAGS I have this

 >LDFLAGS = OP stack=65536 OP CASEEXACT

 >given that now stack can be grown, it does not give problems.

stack linker option is value for thread 1 and rest of threads are based 
in _beginthread() stack parameter

In source\vm\thread.c we have:
----------------------
#elif defined( HB_OS_WIN_32 )
    th_h = ( HANDLE ) _beginthreadex( NULL, 0, start_func, Cargo, 0, 
th_id );
    if( !th_h )
       *th_id = ( HB_THREAD_ID ) 0;
#elif defined( HB_OS_OS2 )
    *th_id = _beginthread( start_func, NULL, 128 * 1024, Cargo );
    th_h = *th_id;
----------------------

For OS/2 is 128*1024=131,072
I am not sure if using -sg it start with 4K and is growing but with 
stack  option limit, for threads except 1

Entire page info for -sg are below

Przemek: Why Win32 is using _beginthreadx() ?
_beginthread() can be used in Win32/OpenWatcom too
In OS/2 return thread ID but not in Win32

Entire page info for _beginthread() are below

 >All mttest?? do work (apart from nr. 10) and speedtst works as well.

I rebuilt Harbour with original win32 flags but changed:
-bt=OS2   Platform target
-bm       For MT
-s        Removed

Except -s remove, rest is equal to all my previous tests

Using hbrun_mt.exe runs
- mttest??.prg, except 9 and 10 due missing functions HB_DBDETACH (9), 
HB_GT_STD_DEFAULT (10)
-
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe 
speedtst.prg --exclude=mem --scale --thread=2

====>  Now run without GPF, BUT extremaly slow
Sometimes it seem freezed for very long time


As we can see:
- Remove -s fixed problem with threads except 1
- "-sg" flag for stack grow is unnecessary

I rebuilt Harbour clean with -sg added
Results are the same

[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mtsg.exe 
speedtst.prg --exclude=mem --scale --thread=2

run extremaly slow too


Congratulatios for both ( and me ), GPF is solved

Now we have to find why speedtst.prg is so slow, but seem due to 
compilers / linker flags too

Any hints ?

David Macias


-sg flag
========
This option is useful for 32-bit OS/2 and Win32 multi-threaded 
applications.  It requests the code generator to emit a run-time call at 
the start of any function that has more than 4K bytes of automatic 
variables (variables located on the stack).
Under 32-bit OS/2, the stack is grown automatically in 4K pages for any 
threads, other than the primary thread, using the stack "guard page" 
mechanism.  The stack consists of in-use committed pages topped off with 
a special guard page.  A memory reference into the 4K guard page causes 
the operating system to grow the stack by one 4K page and to add a new 
4K guard page.  This works fine when there is less than 4K of automatic 
variables in a function.  When there is more than 4K of automatic data, 
the stack must be grown in an orderly fashion, 4K bytes at a time, until 
the stack has grown sufficiently to accommodate all the automatic 
variable storage requirements.  Hence the requirement for a 
stack-growing run-time routine.  The stack-growing run-time routine is 
called __GRO.

The "stack=" linker option specifies how much stack is available and 
committed for the primary thread when an executable starts.  The stack 
size parameter to _beginthread() specifies how much stack is available 
for a child thread.  The child thread starts with just 4k of stack 
committed.  The stack will not grow to be bigger than the size specified 
by the stack size parameter.

Under 32-bit Windows (Win32), the stack is grown automatically in 4K 
pages for all threads using a similar stack "guard page" mechanism.  The 
stack consists of in-use committed pages topped off with a special guard 
page.  The techniques for growing the stack in an orderly fashion are 
the same as that described above for OS/2.

The "stack=" linker option specifies how much stack is available for the 
primary thread when an executable starts.  The "commit stack=" linker 
directive specifies how much of that stack is committed when the 
executable starts.  If no "commit stack=" directive is used, it defaults 
to the same value as the stack size.  The stack size parameter to 
_beginthread() specifies how much stack is committed for a child thread. 
  If the size is set to zero, the size of the primary thread stack is 
used for the child thread stack.  When the child thread executes, the 
stack space is not otherwise restricted.

The macro __SW_SG will be predefined if "sg" is selected.

---------------------------

_beginthread()
==============

Synopsis:

#include <process.h>
#if defined(__386__)
#   define FAR
#else
#   define FAR __far
#endif

#if defined(__NT__)
unsigned long _beginthread(
         void (*start_address)(void *),
         unsigned stack_size,
         void     *arglist);
unsigned long _beginthreadex(
         void *security,
         unsigned stack_size,
         unsigned (__stdcall *start_address)(void *),
         void *arglist,
         unsigned initflag,
         unsigned *thrdid );
#else
int FAR _beginthread(
         void (FAR *start_address)(void FAR *),
         void FAR *stack_bottom,
         unsigned stack_size,
         void FAR *arglist );
#endif

Description:
The _beginthread function is used to start a new thread of execution at 
the function identified by start_address with a single parameter 
identified by arglist.

For each operating environment under which _beginthread is supported, 
the _beginthread function uses the appropriate system call to begin a 
new thread of execution.

The new thread will use the memory identified by stack_bottom and 
stack_size for its stack.

Note for 16-bit applications:  If the stack is not in DGROUP (i.e., the 
stack pointer does not point to an area in DGROUP) then you must compile 
your application with the "zu" option.  For example, the pointer 
returned by  malloc in a large data model may not be in DGROUP.  The 
"zu" option relaxes the restriction that the SS register contains the 
base address of the default data segment, "DGROUP".  Normally, all data 
items are placed into the group DGROUP and the SS register contains the 
base address of this group.  In a thread, the SS register will likely 
not contain the base address of this group.  When the "zu" option is 
selected, the SS register is volatile (assumed to point to another 
segment) and any global data references require loading a segment 
register such as DS with the base address of DGROUP.

Note for OS/2 32-bit applications:  Memory for a stack need not be 
provided by the application.  The stack_bottom may be NULL in which case 
the run-time system will provide a stack.  You must specify a non-zero 
stack_size for this stack.

Note for Win32 applications:  Memory for a stack is provided by the 
run-time system.  The size of the stack is determined by stack_size and 
must not be zero.

The  _beginthreadex function can be used to create a new thread, in a 
running or suspended state specified by initflag, with security 
attributes specified by security.

The initial state of the new thread (running or suspended) is specified 
by the initflag argument.  If the  CREATE_SUSPENDED flag (WINBASE.H) is 
specified, the thread is created in a suspended state, and will not run 
until the Win32  ResumeThread function is called with the thread handle 
as an argument.  If this value is zero, the thread runs immediately 
after creation.

The security descriptor for the new thread is specified by the security 
argument.  This is a pointer to a Win32  SECURITY_ATTRIBUTES structure 
(see Microsoft's Win32 Programmer's Reference for more information). 
For default behaviour, the security structure pointer can be  NULL.

The thread identifier is returned in the location identified by the 
thrdid argument.

The thread ends when it exits from its main function or calls  exit, 
_exit,  _endthread or  _endthreadex.

The variable/function  _threadid which is defined in <stddef.h> may be 
used by the executing thread to obtain its thread ID.  In the 16-bit 
libraries,  __threadid is a far pointer to an int.  In the 32-bit 
libraries, it is a function that returns an int.

There is no limit to the number of threads an application can create 
under Win32 platforms.

There is a limit to the number of threads an application can create 
under 16-bit OS/2 and 32-bit NetWare.  The default limit is 32.  This 
limit can be adjusted by statically initializing the unsigned global 
variable __MaxThreads.

Under 32-bit OS/2, there is no limit to the number of threads an 
application can create.  However, due to the way in which multiple 
threads are supported in the Watcom libraries, there is a small 
performance penalty once the number of threads exceeds the default limit 
of 32 (this number includes the initial thread).  If you are creating 
more than 32 threads and wish to avoid this performance penalty, you can 
redefine the threshold value of 32.  You can statically initialize the 
global variable __MaxThreads.

By adding the following line to your multi-threaded application, the new 
threshold value will be set to 48.


      unsigned __MaxThreads = { 48 };

Returns:
Under Win32, the _beginthread function returns the thread handle for the 
new thread if successful; otherwise it returns -1 to indicate that the 
thread could not be started.

Under all other systems that support the _beginthread function (OS/2, 
Netware and QNX), it returns the thread ID for the new thread if 
successful; otherwise it returns -1 to indicate that the thread could 
not be started.

The  _beginthreadex function returns the thread handle for the new 
thread if successful; otherwise it returns 0 to indicate that the thread 
could not be started.

When the thread could not be started, the value of  errno could be set 
to  EAGAIN if there are too many threads, or to  EINVAL if the argument 
is invalid or the stack size is incorrect, or to  ENOMEM if there is not 
enough available memory.

See Also:
_endthread

Example:

#include <stdio.h>
#include <stdlib.h>
#include <stddef.h>
#include <malloc.h>
#include <process.h>
#include <dos.h>

#if defined(__386__)
   #define FAR
   #define STACK_SIZE    8192
#else
   #define FAR           __far
   #define STACK_SIZE    4096
#endif

static volatile int     WaitForThread;

void FAR child( void FAR *parm )
   {
     char * FAR *argv = (char * FAR *) parm;
     int  i;

     printf( "Child thread ID = %x\n", *_threadid );
     for( i = 0; argv[i]; i++ ) {
       printf( "argv[%d] = %s\n", i, argv[i] );
     }
     WaitForThread = 0;
     _endthread();
   }

void main()
   {
     char           *args[3];
#if defined(__NT__)
     unsigned long   tid;
#else
     char           *stack;
     int             tid;
#endif

     args[0] = "child";
     args[1] = "parm";
     args[2] = NULL;
     WaitForThread = 1;
#if defined(__NT__)
     tid = _beginthread( child, STACK_SIZE, args );
     printf( "Thread handle = %lx\n", tid );
#else
   #if defined(__386__)
     stack = (char *) malloc( STACK_SIZE );
   #else
     stack = (char *) _nmalloc( STACK_SIZE );
   #endif
     tid = _beginthread( child, stack, STACK_SIZE, args );
     printf( "Thread ID = %x\n", tid );
#endif
     while( WaitForThread ) {
         sleep( 0 );
     }
   }

Classification:
WATCOM

Systems:
  _beginthread - Win32, QNX/32, OS/2 1.x(MT), OS/2 1.x(DL), OS/2-32, 
Netware

_beginthreadex - Win32

From harbour.01 at syenar.hu  Thu Nov 13 09:30:16 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov 13 09:31:26 2008
Subject: [Harbour] new HB_ARCHITECTURE=wince ?
In-Reply-To: <20081112184151.GA21699@34-mo7-2.acn.waw.pl>
References: <42D7670C-26FE-447F-B86F-F9DE2BF84C12@syenar.hu>
	<20081112150443.GA1205@34-mo7-2.acn.waw.pl>
	<CB06EF99-9FEA-4AC8-8AD6-2F5E212C0098@syenar.hu>
	<20081112184151.GA21699@34-mo7-2.acn.waw.pl>
Message-ID: <ADB6325D-E56E-4116-821E-53DE88B6DA5C@syenar.hu>

Hi Przemek,

>>> Dont' you afraid that we will end with winvista, winxp,
>>> win9x, win64 and other subdirectories?
>> No. WinCE is a different beast than the rest of
>> the flavors, as you must know the best. We also have
>> the special macro HB_WINCE internally for this reason.
>
> I do not agree. The differences between WinCE API and WinXP
> are smaller then between Win9x and WinXP.
> In our contrib code number of MS-Windows API functions which
> does not exists in Win9x is systematically growing up and here
> the problem is bigger the with WinCE and if we do not begin
> to check it then we lost Win9x and NT4 compatibility in the
> nearest future.

I don't really understand this. There could be
whatever API difference between Win95 and WinXP,
but the subset Harbour actually uses from them
is perfectly compatible. (except Unicode, which
is off by default anyway). We have just a few
code parts dealing with stuff only present on one
OS (diskspace, OS version) AFAIK. Anyhow, one
Harbour build works perfectly on both OSes.
Same can hardly be said on WinCE, which needs
wholly different APIs sometimes, emulation of
non-existent APIs, no driver letter, no registry,
no MT, completely different issues and priorities.

As far as contribs are concerned I don't know,
it's difficult to tell in general, but so far
it doesn't seem to be a need in any contrib to
make a difference by Win9x support. Even it
would be, this few cases could be covered with
some internal version checking just like when
checking for libcurl or ADS version.

So, pls don't see this as the start of something
which goes into a chaos where all minor flavors
of Windows is becoming a different Harbour platform.

>> I'd change w32 to simply win as a next step, and win
>> should cover all desktop flavors. Maybe we could
>> separate win32 and win64, but so far I cannot see
>> any strong reason to do it and it'd be better trying
>> to avoid this anyway in the future.
>
> Now the biggest problem is only with Win9x for which we do
> not even have build time setting to force Win9x compatibility.

Please tell me more about where this is an
actual problem?

>> [ but we may also want to introduce a 3rd level of
>> builds: real architecture, like x86, x64, ia32, ia64,
>> this would make it easier to create such builds in
>> parallel. no very high priority. ]
>
> The achitucture problem is not real problem for us because
> you need separated biunaries for each architecutre so you have
> to rebuild harbour with different arch switches. The real problem
> is in used MS-Windows API functions. To support new feature we
> have to use new functions. But there is no easy way to now compile
> Harbour code excluding all stuff which does not exists in Win9x.
> In some cases where C compilers supports some dummy libraries
> with dummy functions for Win9x then it we are trying to detect
> use OS at runtime but such method does not work in all cases.

Yes, the only place where this could be important
is if we'd like to support multiple CPU builds in
parallel. Harbour went into great complications to
support different platform builds in parallel, but
this ends when it comes to CPU architecture. The
concepts, reasons and needs are exactly the same
for CPU targets. Right now I have to do a 'clean'
and a _full rebuild_ to switch between MSVC x64 and
MSVC x86 (unless I'm using some hacks) (same goes
for Win32 and WinCE), and this may not be a problem
for most ppl and/or yet, it makes parallel development
much more difficult and slow than it's necessary.

>>> Well, gtwvg, hbwhat, hbtpathy f.e. don't have 3rd party
>> dependencies, yet they cannot be compiled and there don't
>> seem to be anyone taking care of this, but we certainly
>> cannot be sure they'll be ever fixed, if a fix is possible
>> at all.
>
> Just like we cannot be sure that they will work with Win9x
> in a year if we will keep current code updating and like you
> do not know what will happen with incoming Win7. It's possible
> that MS will force UNICODE builds for some new Windows version
> just like it did for WinCE. As I can see then WinCE is quite
> often updated and many of its modifications are later intorduced
> to desktop windows so keeping the code ready for WinCE is very
> good idea to make it ready for new desktop windows. Here I do
> not see any problems with current build process and I like that
> it forces some modifications.
> As I said for me the real problem is in keeping support for older
> Win32 versions which we probably lost if we do not make sth with it.

Well, if we step back and take a look at the bigger
picture, Win95/98/ME are a thing of the past, enough
to take a look at the Windows version usage charts.

So, unless we want to invest a huge amount of energy
into maintaining compatibility with this very old,
and unstable and rarely used systems, I think we should
rather just look forward and maybe even consider
dropping support for those, but at least no be blocked
by stuff which may break compatibility.

MSVC 2008 doesn't support Win95/98/ME at all. And
support is not full anymore for MSVC 2005 either.

Personally I'd also like to switch to UNICODE, which
also doesn't work with Win9x, yet it's a very good
feature.

All in all I don' see Win9x important enough to
invest much energy in it, or to rearrange Harbour
just to make Win95 happier.

WinCE is the contrary, as there seem to be some
buzz around it, and it's rather growing. So WinCE
may merit some more attention.

WinCE and Win95 are simply not of the same weight
these days.

>> In any case it'd be good to have a facility to exclude
>> packages for WinCE, even if those are 3rd party dependent
>> ones IMO.
>
> But we do not need for this HB_ARCHOTC

?

>> [ I'd prefer to delete hbwhat from the repository BTW,
>> but that's another matter, it's a permanent candidate
>> for all sorts of problems and without developers actively
>> fixing/testing it. I haven't seen any user of it either,
>> so it pretty much looks like an unnecessary clog in
>> Harbour. ]
>
> Maybe you should ask Andrzej about it? Maybe it can help.
> AFAIK he was working extensively on this library in last
> years but I do not know the current status of his code and
> if he will want to public it.

Let's hope he shows up. It would be great to save
this lib. But f.e. last week I seem to have found
a very ugly bug, and no one bothered to even answer.

>>>> [ Some of these could probably be fixed to compile
>>>> under WinCE, but some definitely not. ]
>>> Which one?
>> hbole, hbct, hbnf, hbsqlit3: yes
>> hbfbird, hbtpathy, hbodbc: maybe
>> gtwvg, hbwhat: I don't know.
>
> hbole, hbct, hbnf, hbsqlit3, hbodbc, hbtpathy, hbwhat, gtwvg
> are present in my MinGWCE builds. I do not have firebird installed
> so I cannot check if it can be compiled and I do not know if WinCE
> FB port exists. Even if not now then it can appear in the future.

Okay, so these could be fixed, but who will do this?

If so, we may just exclude these by HB_COMPILER.

>> HB_XBUILD is merely a signal that the current and
>> target platforms are different. Even Win64 build
>> creation on Win32 is a cross build. So for above purpose,
>> it's not suitable. HB_BUILD_WINCE I didn't know about
>> in GNU-make (and it seem to have a different meaning
>> in non-GNU make), but it doesn't seem like a std way
>> to control this problem to me.
>
> Exactly and this should be the rule of HB_BUILD_WINCE.
> Isn't it?
> It's the reason why we have separate envvar. Single
> HB_ARCHITECTURE is not enough.

Overall, current solution looks clumsy and
limited to me.

>> Yes, but this is a different problem. We should
>> probably have two separate variables for current
>> and target platform.
>> Like:
>> HB_COMPILER=pocc
>> HB_ARCHITECTURE=wince
>> HB_ARCH_HOST=win32 [we may allow leaving this empty for non-cross  
>> builds]
>> HB_XBUILD => ( HB_ARCH_HOST != "" && HB_ARCH_HOST !=  
>> HB_ARCHITECTURE )
>
> Why not. But it's naming convention which we can clean. But still
> the real problem I can see is with used API. For WinCE builds we have
> HB_WINCE macro and it resolves the problem partially (we do not have
> support for WinCE version) but we have nothing to keep Win9x/NT4  
> working.
> and this is a problem for me.

I wanted to clean HB_WINCE to HB_OS_WIN_CE (and HB_OS_WIN_32 to
HB_OS_WIN), so in that picture HB_OS_WIN_95 and hb_OS_WIN_NT
could also fit.

But I'd be interested to see why do want to invest into
these directions.

> BTW seeing libraries you listed as problematic in your WinCE builds it
> looks that you will need HB_ARCHITECTURE=wince to exclude them from
> WinCE builds when they can be build for WinCE and at least some of  
> them
> like CT I intentionally updated to work with WinCE and even tested  
> some
> functionality. So the problem is strictly bound with CRTL for WinCE
> supported by given compiler not with HB_ARCHITECTURE. So if you really
> want then you should exclude them using HB_COMPILER variable not
> HB_ARCHITECTURE.

Yes, looks like it, see my above comment :)

Brgds,
Viktor

From druzus at acn.waw.pl  Thu Nov 13 11:09:42 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 13 11:08:41 2008
Subject: [Harbour] 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <35D6E776-25D6-4483-9243-88349B710D71@syenar.hu>
References: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>
	<35D6E776-25D6-4483-9243-88349B710D71@syenar.hu>
Message-ID: <20081113160942.GA16369@34-mo7-2.acn.waw.pl>

On Thu, 13 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> I've just peeked into the implementation and did some tests.
> New dynamic FM STAT when turned off is about 8% slower
> than fully turned off FM STAT. Quite huge overhead :(

Can you show me your tests? I cannot imagine such big overhead
in this case.
I also made some tests. Below I'm attaching two.
The test is done in pure C to maximize the difference.
Allocated block is immediately freed and it's size is very small
(4 bytes) to allocate the smallest chunk.
Such maximized overhead is 7.54% and it's not realistic test
but test where even single if is noticeable because program only
makes:
   while( --ulLoop )
      hb_xfree( hb_xgrab( 4 ) );
It means that in .prg code it has to be less then 1%.
In the second test I cannot notice any difference which
I can even measure. The difference is such small that
code linked with FM which is not activated sometimes is
faster then the code without FM stat.
If you have bigger difference then I suggest to seriously
check why. Some of your speed results you were sending in
the past are really strange. I would be very careful with
using MSVC for such calculation. Windows is also not good
OS for it because the same tests are hardly repeatable.

> Looks like a few branches can make such big difference
> (similar to HB_NO_DEBUG).

yes branches can make difference but not such huge as in your
test if it was .prg code. During PCODE evaluation we have many
conditional jumps and few new ones cannot make such big difference.

> It means this isn't a costless feature, and thus cannot
> replace our current solutions.

No it isn't. It will always cost but for code which makes also
other things then hb_xfree( hb_xgrab( 4 ) ) in a loop the difference
have to be smaller.

> Do you see any chance to somehow lessen this overhead?
> (maybe using indirect pointers instead of branching?)

Few conditional instruction can be eliminated by inlining some
macros but 1-st I would like to see your results from attached
tests and your test code so I can try it myself.
Here I my results:

tst01
=====
NOFMSTAT:
   Startup loop to increase CPU clock...
   testing...
   memory hb_xfree( hb_xgrab( ... ) ):          6.76 sec.

FMSTAT (NOT ACTIVE):
   Startup loop to increase CPU clock...
   testing...
   memory hb_xfree( hb_xgrab( ... ) ):          7.27 sec.

FMSTAT (ACTIVE):
   Startup loop to increase CPU clock...
   testing...
   memory hb_xfree( hb_xgrab( ... ) ):         22.26 sec.


tst01
=====
NOFMSTAT:
   Startup loop to increase CPU clock...
   empty loop overhead          0.83 sec.
   memory hb_xfree( hb_xgrab( ... ) ):          1.64 sec.

FMSTAT (NOT ACTIVE):
   Startup loop to increase CPU clock...
   empty loop overhead          0.82 sec.
   memory hb_xfree( hb_xgrab( ... ) ):          1.65 sec.

FMSTAT (ACTIVE):
   Startup loop to increase CPU clock...
   empty loop overhead          0.83 sec.
   memory hb_xfree( hb_xgrab( ... ) ):          3.34 sec.


best regards,
Przemek


/***** tst01.prg *****/
#define N_LOOP 100000000
proc main()
local t

? "Startup loop to increase CPU clock..."
t := seconds() + 5; while seconds() < t; enddo
? "testing..."
t := secondsCPU()
AllocTest( N_LOOP )
t := secondsCPU() - t
? "memory hb_xfree( hb_xgrab( ... ) ):", t, "sec."

return
request HB_GT_STD_DEFAULT
#pragma begindump
HB_FUNC( ALLOCTEST )
{
   ULONG ulLoop = hb_parnl( 1 ) + 1;

   while( --ulLoop )
      hb_xfree( hb_xgrab( 4 ) );
}
#pragma enddump


/***** tst02.prg *****/
#define N_LOOP 10000000
proc main()
local i, t, tn

? "Startup loop to increase CPU clock..."
t := seconds() + 5; while seconds() < t; enddo

tn := secondsCPU()
for i:=1 to N_LOOP
next
tn := secondsCPU() - tn
? "empty loop overhead", tn, "sec."

t := secondsCPU()
for i:=1 to N_LOOP
   AllocTest( 1 )
next
t := secondsCPU() - t
? "memory hb_xfree( hb_xgrab( ... ) ):", t - tn, "sec."

return
request HB_GT_STD_DEFAULT
#pragma begindump
HB_FUNC( ALLOCTEST )
{
   ULONG ulLoop = hb_parnl( 1 ) + 1;

   while( --ulLoop )
      hb_xfree( hb_xgrab( 4 ) );
}
#pragma enddump
From druzus at acn.waw.pl  Thu Nov 13 11:48:03 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 13 11:47:01 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491BEC6E.9030805@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<49196BEE.6030306@mail.udg.mx> <4919B07A.1060106@libero.it>
	<20081112021719.GC21198@34-mo7-2.acn.waw.pl>
	<491AB082.1060101@libero.it>
	<20081112133959.GC6815@34-mo7-2.acn.waw.pl>
	<491BEC6E.9030805@libero.it>
Message-ID: <20081113164803.GB16369@34-mo7-2.acn.waw.pl>

On Thu, 13 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> I'think I've found something:
> first of all, I started from config/win32/owatcom flags, then I had to remove
> -bt=OS2 which is wrong, should be -bt=OS2V2 but this gives an undefined
> function referenced error when building, so I removed every thing, then I

Just like David. He also removed -bt

> changed -5 to -5r because -5 is for 16bit code.

I think it does not cause any difference when wpp386 is used but of
course it's cleaner and we should update these switches.

> It still did non build though, so I started looking at optimization flags
> where I found that -s disables stack overlow checking; and it was it!
> So I changed it to -sg which means grow stack upon need, so now I have
> CPPFLAGS = -w2 -zq
> #architecture flags
> CPPFLAGS += -6r -fp6
> # optimization flags
> # don't enable -ol optimization in OpenWatcom 1.1 - gives buggy code
> CPPFLAGS += -onaehtzr -oi+ -ei -zp8 -sg -zt0

Thank you very much. It's possible that -sg helps indirectly because
it has to interact with the stack structure and generated code which
may also change the code generate to call KBD16CHARIN(). As we can see
in GCC code you sent it needs special calling convention.

> I've used -6r since, given we're building for a peculiar cpu, at least we use
> a modern one as target and -sg as explained earlier.

If possible I'd like to ask you and David to check if -sg is enough.
Both switches interacts with calling convention and function encapsulation
so it will be good to know which one helps to resolve the problem.

> For LDFLAGS I have this
> LDFLAGS = OP stack=65536 OP CASEEXACT
> given that now stack can be grown, it does not give problems.

The size of stack is less important in this tests though for such
small stack (<=64KB) it's possible that OW makes some internal
optimizations and they are source of the problem.
It will be good to check what will happen when bigger stack is allocated.

> All mttest?? do work (apart from nr. 10) and speedtst works as well.

Very nice. Thank you.
David if possible I would like to ask you to rebuild OW OS2 Harbour
with above switches to confirm that it also works in your environment.

best regards,
Przemek
From druzus at acn.waw.pl  Thu Nov 13 12:32:00 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 13 12:30:58 2008
Subject: [Harbour] SF bugtracker#1672301: Charset Mapping CP437 or
	CP850 (not documentated ?)
In-Reply-To: <54189D5F-ED14-45AD-BCF5-3A90F38F705F@syenar.hu>
References: <1A07FEDC778C3E4AA417F089511F859C03333A41CD@Mail-yoq.SYNEL-COMPANY.LTD>
	<54189D5F-ED14-45AD-BCF5-3A90F38F705F@syenar.hu>
Message-ID: <20081113173200.GA17290@34-mo7-2.acn.waw.pl>

On Tue, 11 Nov 2008, Szak?ts Viktor wrote:

Hi Chen and Viktor,

> I don't know the answer to this problem, but I've also
> found the codepage a problem in terminals (and also
> keyboard handling), so I use GTXWC and GTWVT, which are
> better at solving these.

Harbour in GTCRS and GTTRM supports very similar to FlagShip
configuration file for screen output translation. It should
be located in /etc/harbour/hb-charmap.def after installation.
in SVN it's in harbour/source/rtl/gtcrs/hb-charmap.def
Below is it's description from its header. FlagShip users
should find that it gives bigger possibilities.
Harbour should even accept and read native FlagShip charmap
files directly because they are subset of Harbour functionality.
Anyhow Harbour terminal GTs should work even without it.
It's enough to set valid terminal codepage.
      HB_SETTERMCP( <cTermCP> [,<cHostCP>] [,<lBoxChar>] )

<cTermCP> is encoding used externally by terminal
<cHostCP> is encoding used inside Harbour application - by default it's
          CP set by HB_SETCODEPAGE()
<lBoxChar> enables to control special Harbour feature.
           When characters are display using box/line drawing
           functions then terminal GTs shows them using CP437
           by default. It allows to use box characters even if
           national CP does not have them. If <lBoxChar> is TRUE
           in the above function then it forces using national
           CP for all letters defined in given <cHostCP> even if
           they are displayed by box drawing functions.

Here is the full ChangeLog entry from xHarbour where I added these
functionality 1-st time. Later I added it also to Harbour with
new GT model and GT drivers.

2003-06-19 10:40 UTC+0200 Przemyslaw Czerpak <druzus@polbox.com>
  * xharbour/include/hbapigt.h
  * xharbour/include/hbextern.ch
  * xharbour/source/rtl/gtcrs/gtcrs.c
  * xharbour/source/rtl/gtnul/gtext.c
  * xharbour/source/rtl/gtnul/gtnul.c
  * xharbour/tests/dspchr.prg
    + Two new functions HB_SETKEYCP( <cTermCP> [,<cHostCP>] ) and
      HB_SETTERMCP(<cTermCP> [,<cHostCP>] [,<lBoxChar>]) added.
      HB_SETKEYCP() if for input key translation, HB_SETTERMCP()
      sets both input (HB_SETKEYCP()) and output (HB_SETDISPCP())
      translation. Now anyone who wants to ports his console apps from
      Windows/DOS with its local code page to *nix with GTCRS and iso
      standards only have to add two functions at the beginning of the
      program: HB_SETCODEPAGE(<cWinCP>); HB_SETTERMCP(<cIsoCP>,.t.)
      All translation should be done automatically.
        eg. for Polish:
            HB_SETCODEPAGE("PLMAZ")
            HB_SETTERMCP("PLISO",.t.)
        sets translation between Polish Mazovia code page to ISO-8859-2.
      The programmer don't have to change anything more in his source
      code.

Additionally GTTRM fully supports utf8 console mode which is autodetected
and in such case it translates displayed characters to unicode using
<cHostCP> specified by HB_SETTERMCP().
Internal HVM national collation and alpha/upper/lower sets are specified
by HB_SETCODEPAGE( <cpID> ) or SET( _SET_CODEPAGE, <cpID> )

For example and to make some tests you can look at tests/gtchars.prg

best regards,
Przemek




#
# $Id: hb-charmap.def 8323 2008-03-12 16:44:16Z druzus $
#

#=============================================================================
# Copyright 2003 Przemyslaw Czerpak <druzus@polbox.com>,
# See doc/license.txt for licensing terms.
#=============================================================================
# Table Syntax:
# <:> terminal[|terminal|terminal...] <space> comment
#     <space> inchar <:>        <space> outchar <space> modus
#     <space> inchar-inchar <:> <space> outchar <space> modus
#     @include
# where:
#     inchar  = decim/hex/alpha equivalent for input  char
#     outchar = decim/hex/alpha equivalent for output char (* same as inchar)
#     modus   = 0 default is: 1 for ?/??/say output, 2 for box output
#               1: standard, 2: alternate, 3: protect, 4: alternate-protect,
#               5: acsc chars
#     include = name of terminal to include character translation
#
# outchar can conatin:
#     * = inchar
# and operators:
#     + = add, - = sub, | = or, & = and, ^ = xor
#
# values:
#     [0-9]+		= decim value
#     0x[0-9A-Fa-f]+	= hex value
#     '[.]+'		= alpha value
#
# example:
#	'A'-'Z':	*|0x20	1
#	makes all output chars lower
# 
# Harbour program is looking for this file in $HB_CHARMAP,
# $HB_ROOT/etc/harbour/hb-charmap.def, /etc/harbour/hb-charmap.def
# terminal name is taken from 'HB_TERM' or 'TERM' environment variable
# if terminal name contains '/' character then is divided to subsections
# by this char and then each of them is included f.e.:
#   export HB_TERM=linux/acsc/maz2iso
# means that sections :linux, :acsc, :maz2iso will be loaded
# remember that first subsection name (linux) will be used for terminfo
# initialization
#
# default:
#    0-127:	*	1
#  128-255:	*	0
#
#-----------------------------------------------------------------------------
From harbour.01 at syenar.hu  Thu Nov 13 16:26:37 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov 13 16:26:48 2008
Subject: [Harbour] 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081113160942.GA16369@34-mo7-2.acn.waw.pl>
References: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>
	<35D6E776-25D6-4483-9243-88349B710D71@syenar.hu>
	<20081113160942.GA16369@34-mo7-2.acn.waw.pl>
Message-ID: <7DF9904A-DC1B-4620-9F01-5F4407E8946F@syenar.hu>

Hi Przemek,

For previous tests MSVC 2005 was used, with a local
production built Harbour (r9921), using usual HB_NO_DEBUG
switch, nothing else. I've been using memtst (with WAITs
removed) and speedtst. The machine is idle while tests are
running, and there is no background process doing anything
significant.

Pls find results for tst01 and tst02, and also earlier
test repeated (with similar results).

BTW memtest doesn't show difference, just speedtst.

[ Also notice that speedtst gives me 8% slowdown if I
remove the HB_NO_DEBUG switch (see my other mail), it
looks too high to me considering that only a few if's
are the difference. ]

[ I'm not sure what you mean by "strange" results
coming from me, I can remember one test which I admittedly
did in a VM, and it was totally off, and there was one
other which seemed wrong, but in the rest of the cases
I'm getting consistent results even if I retry a day/week
later or so, so my system isn't very hectic, in fact
it's pretty clean from usual crapware. The hardware is
pretty old though. Consistency is usually goes across
compilers, too, meaning I was getting consistent results
(within 1-2 secs difference at max) for all compiler tests.
BTW, why MSVC is any worse for testing than the rest of
compilers? ]

Shall I repeat tests with GCC?

Brgds,
Viktor

-------------- next part --------------
A non-text attachment was scrubbed...
Name: results.zip
Type: application/zip
Size: 6593 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081113/0d9acb8f/results.zip
From druzus at acn.waw.pl  Thu Nov 13 18:54:29 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 13 18:53:26 2008
Subject: [Harbour] 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <7DF9904A-DC1B-4620-9F01-5F4407E8946F@syenar.hu>
References: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>
	<35D6E776-25D6-4483-9243-88349B710D71@syenar.hu>
	<20081113160942.GA16369@34-mo7-2.acn.waw.pl>
	<7DF9904A-DC1B-4620-9F01-5F4407E8946F@syenar.hu>
Message-ID: <20081113235429.GA5338@34-mo7-2.acn.waw.pl>

On Thu, 13 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> For previous tests MSVC 2005 was used, with a local
> production built Harbour (r9921), using usual HB_NO_DEBUG
> switch, nothing else. I've been using memtst (with WAITs
> removed) and speedtst. The machine is idle while tests are
> running, and there is no background process doing anything
> significant.
> Pls find results for tst01 and tst02, and also earlier
> test repeated (with similar results).

Thank you. Please look carefully on results.
Im tst01 which tries to show the highest possible difference
you have:
    5.36 NO FM STAT
    6.64 DISABLED DYN FM STAT
quite big but not amazing.

In tst02 which shows .prg overhead:
    2.28 NO FM STAT
    2.11 DISABLED DYN FM STAT
So faster (shorter) code gives worse results.
Still acceptable. The time was small and sth happen with
your OS during tests. Why it was added to process CPU time
it MS programmer secret - not my job ;-). With new CPUs
which can dynamically change clock frequency it's sometimes
hard to well scale some operations and calculate real CPU
time.
In memtst you do not have any difference in both mode.
I expected such results.
but in speedtst.prg in one test loop T029 you have:
    4.28 NO FM STAT
    7.20 DISABLED DYN FM STAT
which creates nearly the whole final difference. All other
tests gives in practice the same results. Somtimes 1-st binary
is faster and sometimes 2-nd one. The differences are on the
precision level and can be ignored.
Please also note that test t030 makes exactly the same operarions
plus additional eval() and the results are:
    7.27 NO FM STAT
    7.36 DISABLED DYN FM STAT
Nearly equal and much closer to 7.20 and the proportions are
expected. T030 should be a little bit slower then T029.
And here is the problem. What happen with T029 NO FM STAT
that it was suddenly executed such fast.
In practice all test you send so far had such "strange" results
somewhere. Especially when it was MSVC build.
I can understand that sth is suddenly executed slower due to some
unexpected asynchronous events. OS has to serve them switching
CPU context what reduce CPU cache efficiency so it also increase
CPU time calculated for process. But how it's possible that sth
begins to work such incredibly faster? It's 40% faster? If you
take it as a base then for some reasons in the second test you
have 70% speed overhead. It's not normal for me. It's interesting
if such results are repeatable when you run the test few times
again.
Windows is designed as interactive system and it automatically
balance priorities prefferering processes and threads which do
not make have calculations but often call some windows API
functions. Maybe it may cause such effect. Other processes may
not do anything significant, just simply call some yield()
function so they do not produce measurable overhead for
process manager. But it will be enough that they will be preferred
and will receive CPU quite often to strongly reduce the performance
of tested code. F.e. due to CPU cache resetting. It may explain
the speed differences which appears in your tests. It may be
also answer why you have such good results in some of your
MSVC test when 90% of tests gives comparable results to other
compilers but some of them are unexpectedly faster. Small
manipulation in process priority in CRTL will be enough.
But this is only speculation. Anyhow I suggest MS-Windows
users to make some experiments with process priority to check
how it change the result of ST speedtst. In good test environment
it should not make any difference because other jobs should
not need CPU.
If you are interested then just create simple .prg wrapper to
MS-Windows process priority function and used call it with
different priorities at the begining of speedtst.prg.
Or maybe you have other ides why such things
    4.28 NO FM STAT
    7.20 DISABLED DYN FM STAT
are possible in MSVC builds.

best regards,
Przemek
From dmacias at mail.udg.mx  Thu Nov 13 22:24:25 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Thu Nov 13 22:24:22 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491CEF69.9030801@mail.udg.mx>

Przemek:

 >Just like David. He also removed -bt

Not.
-bt should be present
Which I removed was osn, value used in message:
   "creating a (osn) executable"
by default is OS/2

 >> changed -5 to -5r because -5 is for 16bit code.

 >I think it does not cause any difference when wpp386 is used but of
 >course it's cleaner and we should update these switches.

In 32bt -5 default to -5r

 >Thank you very much. It's possible that -sg helps indirectly because
 >it has to interact with the stack structure and generated code which
 >may also change the code generate to call KBD16CHARIN(). As we can see
 >in GCC code you sent it needs special calling convention.

 >If possible I'd like to ask you and David to check if -sg is enough.
 >Both switches interacts with calling convention and function
 >encapsulation so it will be good to know which one helps to resolve 
the >problem.

Perhaps you skipped my previous message
"the problem" is resolved just removing "-s" flag

Using "-sg" can be used or not and does not interfere with "the problem"
But -sg cause an interesting behaviour trying to manage stack size, is 
OS dependant snd perhaps is unuseful because you are setting stack size 
for threads except 1 by mean of _beginthread()
I included -sg info, review it and perhaps you can clarify if we 
should/need to use or not

 >The size of stack is less important in this tests though for such
 >small stack (<=64KB) it's possible that OW makes some internal
 >optimizations and they are source of the problem.
 >It will be good to check what will happen when bigger stack is
 >allocated.

"The problem" has gone removing -s and nothing depend of stack size.
Previously I was making tests with thread-c/_beginthread() parameters 
values and that does not resolved GPFs

 >Very nice. Thank you.
 >David if possible I would like to ask you to rebuild OW OS2 Harbour
 >with above switches to confirm that it also works in your environment.

I made those tests and reported them in previous message

As additional info:
OS/2 is using _beginthread() and removing -s resolv GPFs with MT
Win32 is using _beginthreadx() and is using -s but does not GPF

I requested why Win32 is using _beginthreadx() in place of 
_beginthread() supported by OW

--------------------------
-s flag
=======
Stack overflow checking is omitted from the generated code.  By default, 
the compiler will emit code at the beginning of every function that 
checks for the "stack overflow" condition.  This option can be used to 
disable this feature.  The macro __SW_S will be predefined if "s" is 
selected.
--------------------------

David Macias


From harbour.01 at syenar.hu  Fri Nov 14 04:06:43 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov 14 04:06:54 2008
Subject: [Harbour] 2008-11-12 23:16 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081113235429.GA5338@34-mo7-2.acn.waw.pl>
References: <20081112221634.GA31062@34-mo7-2.acn.waw.pl>
	<35D6E776-25D6-4483-9243-88349B710D71@syenar.hu>
	<20081113160942.GA16369@34-mo7-2.acn.waw.pl>
	<7DF9904A-DC1B-4620-9F01-5F4407E8946F@syenar.hu>
	<20081113235429.GA5338@34-mo7-2.acn.waw.pl>
Message-ID: <D98470F4-4746-4394-8531-136D0DA8DD92@syenar.hu>

Hi Przemek,

>> Still acceptable. The time was small and sth happen with
> your OS during tests. Why it was added to process CPU time

Nothing happened with the OS, this effect was consistently
repeatable across multiple runs, and even visible with
speedtst, which was run two times.

> it MS programmer secret - not my job ;-). With new CPUs
> which can dynamically change clock frequency it's sometimes
> hard to well scale some operations and calculate real CPU
> time.

Yes.

> but in speedtst.prg in one test loop T029 you have:
>    4.28 NO FM STAT
>    7.20 DISABLED DYN FM STAT
> which creates nearly the whole final difference. All other
> tests gives in practice the same results. Somtimes 1-st binary
> is faster and sometimes 2-nd one. The differences are on the
> precision level and can be ignored.
> Please also note that test t030 makes exactly the same operarions
> plus additional eval() and the results are:
>    7.27 NO FM STAT
>    7.36 DISABLED DYN FM STAT

Yes, this effect is noticeable whenever I run the tests.
These per test differences however are balanced out for the
whole test, which are pretty consistent.

> Nearly equal and much closer to 7.20 and the proportions are
> expected. T030 should be a little bit slower then T029.
> And here is the problem. What happen with T029 NO FM STAT
> that it was suddenly executed such fast.
> In practice all test you send so far had such "strange" results
> somewhere. Especially when it was MSVC build.
...
> it should not make any difference because other jobs should
> not need CPU.

So basically what you say is my tests are wrong and there
is no slowdown? And is this also true for HB_NO_DEBUG?

> If you are interested then just create simple .prg wrapper to
> MS-Windows process priority function and used call it with
> different priorities at the begining of speedtst.prg.
> Or maybe you have other ides why such things
>    4.28 NO FM STAT
>    7.20 DISABLED DYN FM STAT
> are possible in MSVC builds.

I don't know. Pls see attached results rerun just
now, and it looks very similar, so it's not an
accidental effect caused by some other processes.

Also find results for BCC. There the results are
pretty much the same for NOFMSTAT and FMSTAT-DISABLED
(albeit much slower for all cases than MSVC),
but there are differences +/- for separate test cases.

Brgds,
Viktor

-------------- next part --------------
A non-text attachment was scrubbed...
Name: results_bcc551.zip
Type: application/zip
Size: 3178 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081114/f2ac8f18/results_bcc551-0001.zip
-------------- next part --------------
A non-text attachment was scrubbed...
Name: results2_msvc8.zip
Type: application/zip
Size: 3171 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081114/f2ac8f18/results2_msvc8-0001.zip
-------------- next part --------------


From bedipritpal at hotmail.com  Fri Nov 14 04:22:54 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Fri Nov 14 04:22:57 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20497191.post@talk.nabble.com>


2008-11-14 00:45 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    + New HB_GTI_ + HB_GTE_ messages.

  * harbour/contrib/gtwvg/wvgutils.c
    - Excluded WIN_*  Windows API functions.

  + harbour/contrib/gtwvg/wvgwin.c
    + Included WIN_* Windows API functions.

  + harbour/contrib/gtwvg/wvgsink.c
    ! ActiveX container functions contributed by Andy Wos, a big thanks to
him.

  + harbour/contrib/gtwvg/wvgphdlr.prg
  + harbour/contrib/gtwvg/wvgwnd.prg
  + harbour/contrib/gtwvg/wvgcrt.prg
  + harbour/contrib/gtwvg/wvgax.prg
    ! Xbase++ compatible class skeleton and implementation.
    ! Partially but sufficient functional WvgCrt() class.
 
  * harbour/contrib/gtwvg/gtwvg.h
  * harbour/contrib/gtwvg/hbgtwvg.ch
  * harbour/contrib/gtwvg/wvtwin.ch
    + Added few new members.

  * harbour/contrib/gtwvg/common.mak
  * harbour/contrib/gtwvg/makefile
    ! Updated to include added files.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! updated to include WvgCrt() class implementation.
    ! Updated to host ActiveX controls in WvtCrt() terminal.

  ; It is a humble effort to introduce a common and portable class framework
    to build futuristic CUI/GUI applications development and maintainability
    easier. I had been a fairly good user of Xbase++ in early years
    and was an admirer of their intuitive object modal especially
    uniform way of parameters passing almost for all their objects.
    So when Multi-threading and Multi-windows(GT) capability is introduced
    Przemek, I thought it is the right moment to start in this direction
too.

    The firts efforts are encouraging and I see a great hope in the future.
    But for sure I cannot accomplish this task at my own. Someone has to
join
    this effort. I know all have their own preferences but also realize that
    it can ease all of us in a big way. In the past many developers put
their
    hands on the GUI front but without a clear framework. I based this
effort
    on Xbase++ because it is the only compiler which offers such
functionality
    on console level if we do not talk about GUI. Also it has extensive
    documentation which is a force in itself.

    I ever wished if Przemek would been a Windows user too!

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-14-00%3A45-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20497191p20497191.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Fri Nov 14 06:28:59 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov 14 06:28:00 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491CEF69.9030801@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<491CEF69.9030801@mail.udg.mx>
Message-ID: <20081114112859.GA5277@34-mo7-2.acn.waw.pl>

On Thu, 13 Nov 2008, David Arturo Macias Corona wrote:

Hi David,

> Not.
> -bt should be present
> Which I removed was osn, value used in message:
>   "creating a (osn) executable"
> by default is OS/2

OK.

> >> changed -5 to -5r because -5 is for 16bit code.
> >I think it does not cause any difference when wpp386 is used but of
> >course it's cleaner and we should update these switches.
> In 32bt -5 default to -5r

Thanks for confirmation.

> >If possible I'd like to ask you and David to check if -sg is enough.
> >Both switches interacts with calling convention and function
> >encapsulation so it will be good to know which one helps to resolve the 
> >problem.
> Perhaps you skipped my previous message
> "the problem" is resolved just removing "-s" flag

Fine but can you check if it's enough?
It looks like OpwnWatcom bug and I would like to know the
exact conditions when it can be exploited.

> Using "-sg" can be used or not and does not interfere with "the problem"
> But -sg cause an interesting behaviour trying to manage stack size, is OS 
> dependant snd perhaps is unuseful because you are setting stack size for 
> threads except 1 by mean of _beginthread()
> I included -sg info, review it and perhaps you can clarify if we 
> should/need to use or not

If the cost of speed overhead is not big then it's very interesting
feature and should be enabled. But please check if it cause noticeable
speed difference in speedtst. You can use ST mode.

> >The size of stack is less important in this tests though for such
> >small stack (<=64KB) it's possible that OW makes some internal
> >optimizations and they are source of the problem.
> >It will be good to check what will happen when bigger stack is
> >allocated.
> "The problem" has gone removing -s and nothing depend of stack size.
> Previously I was making tests with thread-c/_beginthread() parameters 
> values and that does not resolved GPFs

Fine but changing begin thread parameters does not eliminate link
time optimizations which can be done when stack size is smaller then
64KB. In short words it does not fix possibly wrong binaries so I asked
about it.

> As additional info:
> OS/2 is using _beginthread() and removing -s resolv GPFs with MT
> Win32 is using _beginthreadx() and is using -s but does not GPF

To clarify. These are not OS2 or Win32 functions but C RTL ones.
What they really do depends on CRTL code which is part of C compiler.
For sure the call low level OS API functions to create threads and
set some internal parameters necessary for given CRTL to work in
MT safe mode and support some MT functions.
In OW OS2 builds _beginthreadex() does not exists. There is only
_beginthread() which has different parameters then _beginthread()
and _beginthreadex() in Win32 so this functions are not comparable
between OS-es. Interesting is 2-nd parameter void *__stack_bottom
in OS2 _beginthread() function. It can be related to our problem.
What OS2 OpenWatcom documentation says about it.

> I requested why Win32 is using _beginthreadx() in place of _beginthread() 
> supported by OW

These are different incomparable functions with different parameters.
Only the name and main goal are the same. In Win32 builds _beginthreadex()
is used to pass some additional thread attributed and to immediately
extract thread ID. But parameters and their meaning are different then
in OS2 so you cannot compare them.

> --------------------------
> -s flag
> =======
> Stack overflow checking is omitted from the generated code.  By default, 
> the compiler will emit code at the beginning of every function that checks 
> for the "stack overflow" condition.  This option can be used to disable 
> this feature.  The macro __SW_S will be predefined if "s" is selected.
> --------------------------

Please not that -s only disable some additional protection code.
It resolves our problem but indirectly. It's possible that we can
find some other methods which will give the same effect. Of course
if it's worth to look for them.
Please check the cost of -s in ST speedtst.prg and if it's not big
then we can document in owatcom.cf of OS2 that -s should not be enabled
and forget about the problem.

BTW many thanks for all your work for OpenWatcom OS2 port and
congratulations for final results.

best regards,
Przemek
From mbelgrano at deltain.it  Fri Nov 14 06:34:01 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Fri Nov 14 06:35:07 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800 Pritpal
	Bedi(pritpal@vouchcac.com)
In-Reply-To: <20497191.post@talk.nabble.com>
References: <20497191.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F19C@SRV02.deltain.net>

I totally agree with idea of common and portable class framework, to
build futuristic CUI/GUI applications development and maintainability
easier

My Compliment to Pritpal Bedi (GT GURU) for give us in windows platform
so powerful tools like gtevg 
My Compliment also to Andy Wos have made the greatest hide for harbour
that is xmate
I hope that Przemek and other guru will give a strong effort to GTWVG
idea

sone little question for Pritpal: 
Now gtwvg inerith from gtwvt?.
Have you same sample for better understanding?
Do you plane make documentation?

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Friay, November 14, 2008 10:23 AM
To: harbour@harbour-project.org
Subject: [Harbour] 2008-11-14 00:45 UTC-0800 Pritpal
Bedi(pritpal@vouchcac.com)


2008-11-14 00:45 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    + New HB_GTI_ + HB_GTE_ messages.

  * harbour/contrib/gtwvg/wvgutils.c
    - Excluded WIN_*  Windows API functions.

  + harbour/contrib/gtwvg/wvgwin.c
    + Included WIN_* Windows API functions.

  + harbour/contrib/gtwvg/wvgsink.c
    ! ActiveX container functions contributed by Andy Wos, a big thanks
to
him.

  + harbour/contrib/gtwvg/wvgphdlr.prg
  + harbour/contrib/gtwvg/wvgwnd.prg
  + harbour/contrib/gtwvg/wvgcrt.prg
  + harbour/contrib/gtwvg/wvgax.prg
    ! Xbase++ compatible class skeleton and implementation.
    ! Partially but sufficient functional WvgCrt() class.
 
  * harbour/contrib/gtwvg/gtwvg.h
  * harbour/contrib/gtwvg/hbgtwvg.ch
  * harbour/contrib/gtwvg/wvtwin.ch
    + Added few new members.

  * harbour/contrib/gtwvg/common.mak
  * harbour/contrib/gtwvg/makefile
    ! Updated to include added files.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! updated to include WvgCrt() class implementation.
    ! Updated to host ActiveX controls in WvtCrt() terminal.

  ; It is a humble effort to introduce a common and portable class
framework
    to build futuristic CUI/GUI applications development and
maintainability
    easier. I had been a fairly good user of Xbase++ in early years
    and was an admirer of their intuitive object modal especially
    uniform way of parameters passing almost for all their objects.
    So when Multi-threading and Multi-windows(GT) capability is
introduced
    Przemek, I thought it is the right moment to start in this direction
too.

    The firts efforts are encouraging and I see a great hope in the
future.
    But for sure I cannot accomplish this task at my own. Someone has to
join
    this effort. I know all have their own preferences but also realize
that
    it can ease all of us in a big way. In the past many developers put
their
    hands on the GUI front but without a clear framework. I based this
effort
    on Xbase++ because it is the only compiler which offers such
functionality
    on console level if we do not talk about GUI. Also it has extensive
    documentation which is a force in itself.

    I ever wished if Przemek would been a Windows user too!

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/2008-11-14-00%3A45-UTC-0800-Pritpal-Bedi-%28pritpa
l%40vouchcac.com%29-tp20497191p20497191.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From mbelgrano at deltain.it  Fri Nov 14 06:58:54 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Fri Nov 14 06:59:56 2008
Subject: [Harbour] Compatible 2008 server 64 bit and 32 bit harbour BCC
	program
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F19E@SRV02.deltain.net>

Windows 2008 server 64 bit  will run on console a Harbour program
compiled in 32 bit with BCC?
Wich is the suggested c compiler for harbour om this os?
will it run old 32-bit programs. After Installing the 64-bit version of
Windows Vist? .
I invite Anybody to share exprerience about Windows server 64 bit

Massimo Belgrano

From maurilio.longo at libero.it  Fri Nov 14 07:51:48 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Fri Nov 14 07:51:53 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491C3614.9050702@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<491C3614.9050702@mail.udg.mx>
Message-ID: <491D7464.7060604@libero.it>

Przemyslaw, David,

David Arturo Macias Corona wrote:
> 
> We can ignore -5[r], -fp5, -6[r], -fp6
> 
I did some tests this morning, passing from no options to -6r -6fp changes
speedtst ST time from 16.8 to 16.6 seconds, so they're worth nothing.

> You are missing -bm for MT
> 
I've not used it and everything works ok, so maybe it is not needed.

> For OS/2 is 128*1024=131,072
> I am not sure if using -sg it start with 4K and is growing but with
> stack  option limit, for threads except 1
> 
> Entire page info for -sg are below
Yes, it is in the doc you sent :)

Stack starts at 4Kb and tops at 128Kb growing in 4Kb chunks (the same is true
for OS/2 and win32).

Thread 1 stack size is fixed on OS/2 and grows on Win32.

> ====>  Now run without GPF, BUT extremaly slow
> Sometimes it seem freezed for very long time
> 

Maybe because it uses more than 32 threads? See your docs:

> There is no limit to the number of threads an application can create
> under Win32 platforms.
>
> There is a limit to the number of threads an application can create
> under 16-bit OS/2 and 32-bit NetWare.  The default limit is 32.  This
> limit can be adjusted by statically initializing the unsigned global
> variable __MaxThreads.
>
> Under 32-bit OS/2, there is no limit to the number of threads an
> application can create.  However, due to the way in which multiple
> threads are supported in the Watcom libraries, there is a small
> performance penalty once the number of threads exceeds the default limit
> of 32 (this number includes the initial thread).  If you are creating
> more than 32 threads and wish to avoid this performance penalty, you can
> redefine the threshold value of 32.  You can statically initialize the
> global variable __MaxThreads.

Anyway, the good thing is that openwatcom has a full blown debugger and it
works ok :)

Best regards.

Maurilio.

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From guy.roussin at teledetection.fr  Fri Nov 14 07:52:15 2008
From: guy.roussin at teledetection.fr (Guy Roussin)
Date: Fri Nov 14 07:52:20 2008
Subject: [Harbour] Little bug with first line options ...
Message-ID: <491D747F.1050700@teledetection.fr>

Hi,

I add this line on top of my PRG :
#/usr/bin/hbrun //gtcgi

I notice that the option //gtcgi is not activated
if the prg file is a DOS file (CRLF) but works
fine if the file is saved as a UNIX file ...

Thank you,

Guy

From maurilio.longo at libero.it  Fri Nov 14 08:40:22 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Fri Nov 14 08:40:27 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491C3614.9050702@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<491C3614.9050702@mail.udg.mx>
Message-ID: <491D7FC6.9000006@libero.it>

Przemyslaw, David,

BTW, from watcom docs I read:

The "bm" option must be specified since we are creating a multi-threaded
application. If your multi-threaded application contains more than one module,
each module must be compiled using the "bm" switch.

So, it is not enough to buil hbvmmt with bm but all libs, but, doing so, what
happens when I create an ST harbour program? That I'm, actually, always
building MT executable?

Best regards.

Maurilio.



-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From info at fsgiudice.com  Fri Nov 14 09:31:09 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Fri Nov 14 09:31:15 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800 Pritpal
	Bedi	(pritpal@vouchcac.com)
In-Reply-To: <20497191.post@talk.nabble.com>
References: <20497191.post@talk.nabble.com>
Message-ID: <491D8BAD.4080704@fsgiudice.com>

Hi Pritpal,

I have some problems with new demo demowvg.prg

Which flags I have to use to compile it ?
I have tried also with hbmk_b32.bat -mt -gui demowvg (missing xhb.lib 
from HB_USER_LIBS) but result is that demo runs but no ActiveX samples 
works. (in MT mode I see only a windows frame appear and disappear 
immediately)

Then another problem (Viktor ?) with last SVN make_b32.bat in main 
folder won't work using install parameter after build. (I had to 
manually copy libs from lib\b32 to lib. I'm doing other tests.

Best Regards

Francesco


Il 14/11/2008 10.22, Pritpal Bedi ha scritto:
> 2008-11-14 00:45 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>   * harbour/contrib/gtwvg/gtwvg.c
....
From maurilio.longo at libero.it  Fri Nov 14 09:40:59 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Fri Nov 14 09:41:05 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491D7FC6.9000006@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>	<491C3614.9050702@mail.udg.mx>
	<491D7FC6.9000006@libero.it>
Message-ID: <491D8DFB.90302@libero.it>

I did one more test and I've found that -bm has a great impact, on memory
mostly, speedtst ST:

T029 with -bm 22 sec.
T030 with -bm 25 sec.

T029 w/o -bm 1.6 sec.
T030 w/o -bm 2.0 sec.

Best regards.

Maurilio.


PS. speedtst MT takes nearly twice.

Maurilio Longo wrote:
> Przemyslaw, David,
> 
> BTW, from watcom docs I read:
> 
> The "bm" option must be specified since we are creating a multi-threaded
> application. If your multi-threaded application contains more than one module,
> each module must be compiled using the "bm" switch.
> 
> So, it is not enough to buil hbvmmt with bm but all libs, but, doing so, what
> happens when I create an ST harbour program? That I'm, actually, always
> building MT executable?
> 
> Best regards.
> 
> Maurilio.
> 
> 
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From harbour.01 at syenar.hu  Fri Nov 14 10:11:58 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov 14 10:12:05 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800 Pritpal
	Bedi	(pritpal@vouchcac.com)
In-Reply-To: <491D8BAD.4080704@fsgiudice.com>
References: <20497191.post@talk.nabble.com> <491D8BAD.4080704@fsgiudice.com>
Message-ID: <E0361877-8C19-4C26-8614-A023AC051EB5@syenar.hu>

Hi Francesco,

> I have tried also with hbmk_b32.bat -mt -gui demowvg (missing  
> xhb.lib from HB_USER_LIBS) but result is that demo runs but no  
> ActiveX samples works. (in MT mode I see only a windows frame appear  
> and disappear immediately)
>
> Then another problem (Viktor ?) with last SVN make_b32.bat in main  
> folder won't work using install parameter after build. (I had to  
> manually copy libs from lib\b32 to lib. I'm doing other tests.

It's not a recent change, this is how it's expected to work since long.

hbmk*.bat are supporting non-GNU builds too, and in non-GNU builds
the location of these binaries (including harbour.exe) is different
without 'install'.

So, you must either always 'install', or override default binary
locations using HB_*_INSTALL envvars to your liking.

Brgds,
Viktor

From bedipritpal at hotmail.com  Fri Nov 14 10:33:40 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Fri Nov 14 10:33:43 2008
Subject: [Harbour] 2008-11-14 07:26 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20502668.post@talk.nabble.com>


2008-11-14 07:26 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/wvgax.prg
  * harbour/contrib/gtwvg/wvgphdlr.prg
    ! Hash() => hb_hash()

  * harbour/contrib/gtwvg/tests/demowvg.prg
    - #ifdef HB_ACTIVEX

    Sorry I left few defines untouched.
       hbmk_b32 -mt -gui demowvg -d__MW__   

    But it needs hbwin.lib and you have to include it in link script.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-14-07%3A26-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20502668p20502668.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dmacias at mail.udg.mx  Fri Nov 14 10:37:48 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Fri Nov 14 10:37:46 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <491D9B4C.7030504@mail.udg.mx>

Maurilio:

 >The "bm" option must be specified since we are creating a multi-threaded
 >application. If your multi-threaded application contains more than one
 >module, each module must be compiled using the "bm" switch.

 >So, it is not enough to buil hbvmmt with bm but all libs, but, doing 
so, >what happens when I create an ST harbour program? That I'm, 
actually, >always building MT executable?

 >I did one more test and I've found that -bm has a great impact, on 
 >memory mostly, speedtst ST:

 >T029 with -bm 22 sec.
 >T030 with -bm 25 sec.

 >T029 w/o -bm 1.6 sec.
 >T030 w/o -bm 2.0 sec.

This is a known fact
My firsts builds were without -bm and they raise a warning in make_ow.log
Przemek indicate to include -bm
In that time results were, for ST:
- around 57 secs, without -bm
- around 104 secs, with -bm
so impact is very high

We leave -bm for now because we are testing threads problems

By now things are more complicated
As a brief summary, all for ST:
- around 57 secs, without -bm
- around 104 secs, with -bm
- around 107 secs, with -bm, without -s, with -sg
- around 149 secs, with -bm, without -s, without -sg

I suggest to you to read all messages since begin of OS/2-OW tests
There are a lot of info and so you will not get confused with known facts

When we isolated problem to kbdCharIn(), Mou...() functions execution, I 
planned to research to areas:

a) KbdCharIn(), Mou...() area
   Unless an oscure participation of KBD16CHARIN, I restisted to 
consider these functions as problem

b) Harbour thread implementation-behaviour
   I read some docs of OW and review code in thread.c, so I saw it uses 
_beginthread() and I was "playing" with parameters values without 
problem resolv

You were introduced to tests with a) area, but indirectly you show that 
problem is related to b) area removing -s flag

My tests show that now does not GPF without -s flag, but run extremaly 
low or even "freeze" using threads, but no without threads
And is not related to OS/2 32 threads limit which can be expanded with 
performace decrease.
We are using speedtst.prg ... --thread=2

So problem are oriented to threads/stack management under Harbour and 
are raised by differences in gcc335 / OW management

We should introduce differenciation for OS/2-OW in Harbour thread code ?
First we must see where there are differences
Now we know there are differences in _beginthread() - _beginthreadx() 
(just Win32) and _beginthread() - _beginthread() in Win32-OS/2

We are not understanding OW behaviour/features which rely in platform
So I was adding doc pages to help to clarify
OS/2-OW is a different beast  :-)

In my messages I requested to review/understand OW sample with threads 
in hope to get "some light" how thread must be managed

Was my intention but not requested, to make other type of tests:
     "separate Harbour - C"
- Build a C-only code test using OW / threads based in OS/2-OW 
rules/features/flags/doc/...
- Run same C.only code test using gcc335 / threads and compare results 
between gcc335 - OW
- Replicate same test with Harbour threads implementation and compare 
results with two C-only tests

It can show:
- Need or not to introduce different code for gcc/OW in Harbour
- Need or not to introduce changes in Harbour threads/stack/memory 
management

I still does not understand why we should test with speedtst/ST mode if 
we are looking for stack use, which are only relevant for threads except 
1 in OS/2, but not in Win32, due to _beginthread() use

_beginthread( , stack, ) is used for thread 1 / no threads ?

I understand that -sg is adding 4k pieces to stack, but what happen when 
we have fixed code in thread.c/_beginthread() for stack parameter ? It 
is ignored ?

For me 128 * 1024 is a large quatity, double of fixed stack=65536 used 
for thread 1 in OS/2-OW, but not Win32-OW

-s flag stated: "Stack overflow checking is omitted from the generated 
code", but we have "stack overflow" condition with used values ?
65536 for thread 1 and 128 * 1024 for rest of threads, in OS/2

-s info does not say what does if "Stack overflow checking" is enabled. 
It increase value ?, generate runtime error, ... ?

Many of these concepts/handling are out of my knowledge

David Macias


From bedipritpal at hotmail.com  Fri Nov 14 10:38:16 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Fri Nov 14 10:38:20 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <491D8BAD.4080704@fsgiudice.com>
References: <20497191.post@talk.nabble.com> <491D8BAD.4080704@fsgiudice.com>
Message-ID: <20502775.post@talk.nabble.com>


Hello Francesco

<<<
Which flags I have to use to compile it ?
I have tried also with hbmk_b32.bat -mt -gui demowvg (missing xhb.lib 
from HB_USER_LIBS) but result is that demo runs but no ActiveX samples 
works. (in MT mode I see only a windows frame appear and disappear 
immediately)
>>>

Can you please try now. But how to link hbwin.lib with this build is unknown
to me.

<<<
Then another problem (Viktor ?) with last SVN make_b32.bat in main 
folder won't work using install parameter after build. (I had to 
manually copy libs from lib\b32 to lib. I'm doing other tests.
>>>

I confirm your point.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/2008-11-14-00%3A45-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20497191p20502775.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From mbelgrano at deltain.it  Fri Nov 14 11:23:03 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Fri Nov 14 11:24:03 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800
	PritpalBedi	(pritpal@vouchcac.com)
In-Reply-To: <E0361877-8C19-4C26-8614-A023AC051EB5@syenar.hu>
References: <20497191.post@talk.nabble.com> <491D8BAD.4080704@fsgiudice.com>
	<E0361877-8C19-4C26-8614-A023AC051EB5@syenar.hu>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F19F@SRV02.deltain.net>

This is correct FLOW

CD \HARBOUR
CALL MAKE_B32 CLEAN
CALL MAKE_B32
CD \HARBOUR\CONTRIB
CALL MAKE_B32_ALL CLEAN
CALL MAKE_B32_ALL
CD \HARBOUR
CALL MAKE_B32 INSTALL

-----Original Message-----
From: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] On Behalf Of Szak?ts Viktor
Sent: Friday, November 14, 2008 4:12 PM
To: Harbour Project Main Developer List.
Subject: Re: [Harbour] 2008-11-14 00:45 UTC-0800 PritpalBedi (pritpal@vouchcac.com)

Hi Francesco,

> I have tried also with hbmk_b32.bat -mt -gui demowvg (missing  
> xhb.lib from HB_USER_LIBS) but result is that demo runs but no  
> ActiveX samples works. (in MT mode I see only a windows frame appear  
> and disappear immediately)
>
> Then another problem (Viktor ?) with last SVN make_b32.bat in main  
> folder won't work using install parameter after build. (I had to  
> manually copy libs from lib\b32 to lib. I'm doing other tests.

It's not a recent change, this is how it's expected to work since long.

hbmk*.bat are supporting non-GNU builds too, and in non-GNU builds
the location of these binaries (including harbour.exe) is different
without 'install'.

So, you must either always 'install', or override default binary
locations using HB_*_INSTALL envvars to your liking.

Brgds,
Viktor

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From druzus at acn.waw.pl  Fri Nov 14 11:36:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov 14 11:35:43 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <491D8DFB.90302@libero.it>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<491C3614.9050702@mail.udg.mx> <491D7FC6.9000006@libero.it>
	<491D8DFB.90302@libero.it>
Message-ID: <20081114163647.GA19977@34-mo7-2.acn.waw.pl>

On Fri, 14 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> I did one more test and I've found that -bm has a great impact, on memory
> mostly, speedtst ST:
> T029 with -bm 22 sec.
> T030 with -bm 25 sec.
> T029 w/o -bm 1.6 sec.
> T030 w/o -bm 2.0 sec.

Exactly. It has horrible performance impact when thread safe
memory manager is used. It will be really nice if we can port
DL malloc to OS2 and use it instead.

> > BTW, from watcom docs I read:
> > The "bm" option must be specified since we are creating a multi-threaded
> > application. If your multi-threaded application contains more than one module,
> > each module must be compiled using the "bm" switch.
> > So, it is not enough to buil hbvmmt with bm but all libs, but, doing so, what
> > happens when I create an ST harbour program? That I'm, actually, always
> > building MT executable?

The same is true for most of other C compilers which have special switches
for MT model, f.e. BCC. Such options usually effects some CRTL functions
and when this option is set MT safe versions of functions are used instead
of faster but non MT safe ones. Sometime it's a macro not compiler switch.
F.e. in older Linux systems you should recompile whole Harbour code with
_THREAD_SAFE macro (C_USR=-D_THREAD_SAFE).
Please remember that sometimes it's hard to exploit the potential problem
cause by non MT safe functions. It's necessary to execute them
simultaneously by different threads and they have to change some critical
data/resources. Simply test that everything is OK is not enough to say
that the final binaries are really MT safe.
Harbour uses only small number of CRTL functions so it may not be easy
to exploit the problem. Some functions like str*(), mem*(), etc. are MT
safe so it's not a problem. But some others like *printf()/*scanf() are
quite often written in two versions (MT and ST) to maximize the performance
for ST mode. If you do not inform compiler that you need MT safe version
then it will use ST one. In Harbour functions which we should look for are:
*printf()/*scanf(), stdio FILE functions, memory manager functions,
inet and/or file functions if they are not directly redirected to OS.
It will be good to add to OS2 Harbour port support for native OS file
operations (HB_OS2_IO) just like we have it in Win32 (HB_WIN32_IO) to
eliminate potential problem. stdio FILE functions are usually used in
context which should not cause troubles. Usually allocating/freeing
and other internal operations on FILE structures are MT safe if only
one thread access given FILE structure and MT safe version introduce
only internal protection for accessing FILE structure by more then
one thread. The *printf()/*scanf() functions family may be such problem.
Anyhow MT safe version here should not cause important for us speed
overhead.
The only one real problem is memory manager which have to be MT safe
and which may cause huge speed overhead for final Harbour applications.
We have such situation in OpenWatcom. MM causes the whole speed overhead
you can see when -bm option is used. Here DL malloc though not perfect
for MT programs due to pure scalability can be sufficient solution.
But it will have to be ported to OS2.

best regards,
Przemek
From druzus at acn.waw.pl  Fri Nov 14 11:42:50 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov 14 11:41:45 2008
Subject: [Harbour] Little bug with first line options ...
In-Reply-To: <491D747F.1050700@teledetection.fr>
References: <491D747F.1050700@teledetection.fr>
Message-ID: <20081114164250.GB19977@34-mo7-2.acn.waw.pl>

On Fri, 14 Nov 2008, Guy Roussin wrote:

Hi Guy,

> I add this line on top of my PRG :
> #/usr/bin/hbrun //gtcgi
> I notice that the option //gtcgi is not activated
> if the prg file is a DOS file (CRLF) but works
> fine if the file is saved as a UNIX file ...

So the behavior is correct. For linux kernel the 1-st line
ends at LF character and CR becomes last character of //gtcgi
argument so it pass to hbrun "//gtcgi\r"

Do you want to add to Harbour code which will strip \r from
passed arguments? I do not find it as good idea because it
wile reduce the functionality. F.e.:
   ./myapp "`cat dostext.txt`"
will lost CR characters when received as parameter in myapp.

best regards,
Przemek
From mbelgrano at deltain.it  Fri Nov 14 11:52:27 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Fri Nov 14 11:53:27 2008
Subject: [Harbour] 2008-11-14 07:26 UTC-0800 Pritpal
	Bedi(pritpal@vouchcac.com)
In-Reply-To: <20502668.post@talk.nabble.com>
References: <20502668.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1A0@SRV02.deltain.net>

I have a little idea for made easy compile harbour sample
Is Possible having instead
Hbmk -mt -gui -d__MW__ demowvg.prg

In demowvg.prg a row like
*hbmk_default=-mt -gui -d__MW__
And Compile simply with 
Hbmk demowvg

Particularly if hbmk.prg was done as I hope please examine my idea


-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Friday, November 14, 2008 4:34 PM
To: harbour@harbour-project.org
Subject: [Harbour] 2008-11-14 07:26 UTC-0800 Pritpal
Bedi(pritpal@vouchcac.com)


2008-11-14 07:26 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/wvgax.prg
  * harbour/contrib/gtwvg/wvgphdlr.prg
    ! Hash() => hb_hash()

  * harbour/contrib/gtwvg/tests/demowvg.prg
    - #ifdef HB_ACTIVEX

    Sorry I left few defines untouched.
       hbmk_b32 -mt -gui demowvg -d__MW__   

    But it needs hbwin.lib and you have to include it in link script.

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/2008-11-14-07%3A26-UTC-0800-Pritpal-Bedi-%28pritpa
l%40vouchcac.com%29-tp20502668p20502668.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From info at fsgiudice.com  Fri Nov 14 12:02:13 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Fri Nov 14 12:02:18 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800
	Pritpal	Bedi	(pritpal@vouchcac.com)
In-Reply-To: <E0361877-8C19-4C26-8614-A023AC051EB5@syenar.hu>
References: <20497191.post@talk.nabble.com> <491D8BAD.4080704@fsgiudice.com>
	<E0361877-8C19-4C26-8614-A023AC051EB5@syenar.hu>
Message-ID: <491DAF15.4010609@fsgiudice.com>

Hi Viktor,

I'm not explained correctly.
I do everytime:

set_vars.bat (where I have my env vars defined)
hbmake_b32.bat clean
hbmake_b32.bat
hbmake_b32.bat install

with last SVN last command doesn't work.

Best Regards

Francesco

Il 14/11/2008 16.11, Szak?ts Viktor ha scritto:
> Hi Francesco,
> 
>> I have tried also with hbmk_b32.bat -mt -gui demowvg (missing xhb.lib 
>> from HB_USER_LIBS) but result is that demo runs but no ActiveX samples 
>> works. (in MT mode I see only a windows frame appear and disappear 
>> immediately)
>>
>> Then another problem (Viktor ?) with last SVN make_b32.bat in main 
>> folder won't work using install parameter after build. (I had to 
>> manually copy libs from lib\b32 to lib. I'm doing other tests.
> 
> It's not a recent change, this is how it's expected to work since long.
> 
> hbmk*.bat are supporting non-GNU builds too, and in non-GNU builds
> the location of these binaries (including harbour.exe) is different
> without 'install'.
> 
> So, you must either always 'install', or override default binary
> locations using HB_*_INSTALL envvars to your liking.
> 
> Brgds,
> Viktor
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
From harbour.01 at syenar.hu  Fri Nov 14 12:22:30 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov 14 12:22:37 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20502775.post@talk.nabble.com>
References: <20497191.post@talk.nabble.com> <491D8BAD.4080704@fsgiudice.com>
	<20502775.post@talk.nabble.com>
Message-ID: <B3BC82A7-71AE-4A89-B9F6-BD52E31381BF@syenar.hu>

> Can you please try now. But how to link hbwin.lib with this build is  
> unknown
> to me.
>
> <<<
> Then another problem (Viktor ?) with last SVN make_b32.bat in main
> folder won't work using install parameter after build. (I had to
> manually copy libs from lib\b32 to lib. I'm doing other tests.
>>>>
>
> I confirm your point.

See my answer to Francesco, nothing has changed here.

Besides, I'd suggest to add hbwin.lib to HB_USER_LIBS
in tests\*.bat, so that these work out of the box.

Brgds,
Viktor

From m.lacecilia at gmail.com  Fri Nov 14 13:08:20 2008
From: m.lacecilia at gmail.com (Maurizio la Cecilia)
Date: Fri Nov 14 13:08:27 2008
Subject: [Harbour] Make_b32 install?
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAEPH+zHhktcRvfQAgK18GwzCgAAAEAAAAKePNSmaEuVGj62wJ/leFsMBAAAAAA==@gmail.com>

I no longer obtain the command "make_b32 install" to work.
Any hint?
TIA
 
Maurizio la Cecilia               

From harbour.01 at syenar.hu  Fri Nov 14 13:16:05 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov 14 13:16:11 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800
	Pritpal	Bedi	(pritpal@vouchcac.com)
In-Reply-To: <491DAF15.4010609@fsgiudice.com>
References: <20497191.post@talk.nabble.com> <491D8BAD.4080704@fsgiudice.com>
	<E0361877-8C19-4C26-8614-A023AC051EB5@syenar.hu>
	<491DAF15.4010609@fsgiudice.com>
Message-ID: <7C6A55C4-8F88-4A3D-91DB-536BE4C59878@syenar.hu>

Hi Francesco,

> Hi Viktor,
>
> I'm not explained correctly.
> I do everytime:
>
> set_vars.bat (where I have my env vars defined)
> hbmake_b32.bat clean
> hbmake_b32.bat
> hbmake_b32.bat install

Do you mean /make_b32.bat here?

> with last SVN last command doesn't work.

What does it mean exactly "doesn't work"?
What is in the logs?

Brgds,
Viktor

From harbour.01 at syenar.hu  Fri Nov 14 14:55:30 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov 14 14:55:38 2008
Subject: [Harbour] 2008-11-14 20:49 UTC+0100 Viktor Szakats
Message-ID: <5123F4F5-16C4-44A4-AFDD-875B7B83807F@syenar.hu>

2008-11-14 20:49 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
   * make_b32.mak
   * make_vc.mak
     * Possible fix to install problem. I can't test at the moment.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Fri Nov 14 19:54:33 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov 14 19:54:36 2008
Subject: [Harbour] 2008-11-15 01:43 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c946bc$Blat.v2.6.2$b948d988$113832e9120@127.0.0.1>

2008-11-15 01:43 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_b32.mak
  * make_vc.mak
  * contrib/mtpl_b32.mak
  * contrib/mtpl_vc.mak
    * Minor fix.

  * contrib/hbcurl/make_b32.bat
  * contrib/hbcurl/make_vc.bat
  * contrib/hbcurl/Makefile
    - Removed recently added HB_HBCURL_USR_C.

  * contrib/gtwvg/tests/demowvg.prg
    * Replaced '#if __MW__' with 'IF hb_vmmt()'.
      (not tested)

  * contrib/gtwvg/tests/hbmk_b32.bat
  * contrib/gtwvg/tests/hbmk_vc.bat
    ! Added hbwin.lib to HB_USER_LIBS list.

  * contrib/gtwvg/gtwvg.c
  * contrib/gtwvg/wvgclass.prg
  * contrib/gtwvg/wvgax.prg
  * contrib/gtwvg/wvgphdlr.prg
  * contrib/gtwvg/wvgpaint.prg
  * contrib/gtwvg/wvgcore.c
  * contrib/gtwvg/wvgwin.c
  * contrib/gtwvg/wvgwnd.prg
  * contrib/gtwvg/wvgcrt.prg
  * contrib/gtwvg/wvgutils.c
  * contrib/gtwvg/wvgsink.c
    ! SVN IDs missing, mistyped. SVN tags now reset.
    ; TOFIX: GTWVG is now broken with MSVC 8 and/or C++ and/or 64-bit modes, 
             also unsafe string function is used:
             - strcat() should be hb_strncat().
             - Usual but wrong HRESULT to ULONG conversions break in 64-bit.
             - Some newest Windows features should be probably guarded.
      .\gtwvg.c(1913) : warning C4013: 'TrackMouseEvent' undefined; assuming extern returning int
      .\gtwvg.c(3205) : error C2065: 'WS_EX_LAYERED' : undeclared identifier
      .\wvgsink.c(128) : warning C4244: 'return' : conversion from 'HB_THREAD_NO' to 'int', possible loss of data
      .\wvgsink.c(339) : warning C4245: 'return' : conversion from 'HRESULT' to 'ULONG', signed/unsigned mismatch
      .\wvgsink.c(352) : warning C4245: 'return' : conversion from 'HRESULT' to 'ULONG', signed/unsigned mismatch
      .\wvgsink.c(368) : warning C4245: 'return' : conversion from 'HRESULT' to 'ULONG', signed/unsigned mismatch
      .\wvgsink.c(392) : warning C4245: 'return' : conversion from 'HRESULT' to 'ULONG', signed/unsigned mismatch
      .\wvgsink.c(455) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(457) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(460) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(463) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(466) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(469) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(472) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(475) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(633) : warning C4305: 'type cast' : truncation from 'HB_LONG' to 'device_interface *'
      .\wvgsink.c(652) : warning C4996: 'strcat': This function or variable may be unsafe. Consider using strcat_s instead. To disable deprecation, use _CRT_SECURE_NO_WARNINGS. See online help for details.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Fri Nov 14 19:55:05 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov 14 19:55:13 2008
Subject: [Harbour] 2008-11-14 07:26 UTC-0800 Pritpal
	Bedi(pritpal@vouchcac.com)
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F1A0@SRV02.deltain.net>
References: <20502668.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1A0@SRV02.deltain.net>
Message-ID: <251EA883-4DEF-4DFD-A838-1631176F2AF7@syenar.hu>

> I have a little idea for made easy compile harbour sample
> Is Possible having instead
> Hbmk -mt -gui -d__MW__ demowvg.prg

If you use hbmk_*.bat found in the directory of demowvg.prg,
'-gui' isn't needed since very long.

'-D__MW__' can be autodetected at runtime.
'set HB_USER_LIBS=hbwin.lib ...' line can be added to local .bat files.

and there is no need to tweak anything from the command line....

> In demowvg.prg a row like
> *hbmk_default=-mt -gui -d__MW__
> And Compile simply with
> Hbmk demowvg

I'm not sure about your point, but it would
IMO be enough to use our current facilities
to make this totally easy.

> Particularly if hbmk.prg was done as I hope please examine my idea

Pls read recent news regarding hbmk.bat.

Brgds,
Viktor

From harbour.01 at syenar.hu  Fri Nov 14 19:56:14 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Fri Nov 14 19:56:20 2008
Subject: [Harbour] 2008-11-14 00:45 UTC-0800
	PritpalBedi	(pritpal@vouchcac.com)
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F19F@SRV02.deltain.net>
References: <20497191.post@talk.nabble.com> <491D8BAD.4080704@fsgiudice.com>
	<E0361877-8C19-4C26-8614-A023AC051EB5@syenar.hu>
	<AFB948164110ED43B5EB849E8DEEF03815F19F@SRV02.deltain.net>
Message-ID: <52C9AA8B-7D47-43E7-B9A0-F2F088E8D71F@syenar.hu>

I use this sequence:

> CD \HARBOUR
> CALL MAKE_B32 CLEAN
> CALL MAKE_B32
> CALL MAKE_B32 INSTALL
> CD \HARBOUR\CONTRIB
> CALL MAKE_B32_ALL CLEAN
> CALL MAKE_B32_ALL
> CALL MAKE_B32_ALL INSTALL <--- this is also needed !!!
> CD \HARBOUR

BTW, in an attempt to further sync GNU and non-GNU make
(and make building even more straighforward and one less
thing to take care of), I'm planning to modify /make_*.bat|sh
files to automatically call contrib/make_*.bat|sh files
and build contribs too.

The desired list of contribs to be built can already be
controlled by HB_CONTRIBLIBS, HB_CONTRIB_ADDONS, exactly
like for GNU-make.

Brgds,
Viktor

From bedipritpal at hotmail.com  Sat Nov 15 00:00:48 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov 15 00:00:54 2008
Subject: [Harbour] 2008-11-14 20:57 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20512451.post@talk.nabble.com>


2008-11-14 20:57 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/gtwvg/wvgsink.c
    ! Pacified some warnings.
    ! Formatting per Harbour standards.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-14-20%3A57-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20512451p20512451.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sat Nov 15 00:49:46 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov 15 00:49:49 2008
Subject: [Harbour] 2008-11-15 01:43 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c946bc$Blat.v2.6.2$b948d988$113832e9120@127.0.0.1>
References: <01c946bc$Blat.v2.6.2$b948d988$113832e9120@127.0.0.1>
Message-ID: <20512750.post@talk.nabble.com>


Hi Viktor

<<<
  * contrib/gtwvg/tests/demowvg.prg
    * Replaced '#if __MW__' with 'IF hb_vmmt()'.
      (not tested)
>>>

Thanks. It works.

<<<
  * contrib/gtwvg/gtwvg.c
  * contrib/gtwvg/wvgclass.prg
  * contrib/gtwvg/wvgax.prg
  * contrib/gtwvg/wvgphdlr.prg
  * contrib/gtwvg/wvgpaint.prg
  * contrib/gtwvg/wvgcore.c
  * contrib/gtwvg/wvgwin.c
  * contrib/gtwvg/wvgwnd.prg
  * contrib/gtwvg/wvgcrt.prg
  * contrib/gtwvg/wvgutils.c
  * contrib/gtwvg/wvgsink.c
    ! SVN IDs missing, mistyped. SVN tags now reset.
>>> 

I had set the flags but I missed something for sure.


<<<
             - Usual but wrong HRESULT to ULONG conversions break in 64-bit.
>>>

May be it is ok now.


<<<
             - Some newest Windows features should be probably guarded.
      .\gtwvg.c(1913) : warning C4013: 'TrackMouseEvent' undefined; assuming
extern returning int
>>>

'TrackMouseEvent' is included in <windows.h>. SO do not know why it remains
undefined.

<<<
      .\gtwvg.c(3205) : error C2065: 'WS_EX_LAYERED' : undeclared identifier
      .\wvgsink.c(128) : warning C4244: 'return' : conversion from
'HB_THREAD_NO' to 'int', possible loss of data
      .\wvgsink.c(339) : warning C4245: 'return' : conversion from 'HRESULT'
to 'ULONG', signed/unsigned mismatch
      .\wvgsink.c(352) : warning C4245: 'return' : conversion from 'HRESULT'
to 'ULONG', signed/unsigned mismatch
      .\wvgsink.c(368) : warning C4245: 'return' : conversion from 'HRESULT'
to 'ULONG', signed/unsigned mismatch
      .\wvgsink.c(392) : warning C4245: 'return' : conversion from 'HRESULT'
to 'ULONG', signed/unsigned mismatch
>>>

Set right.

<<<
      .\wvgsink.c(455) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(457) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(460) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(463) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(466) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(469) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(472) : error C2039: 'n1' : is not a member of 'tagVARIANT'
      .\wvgsink.c(475) : error C2039: 'n1' : is not a member of 'tagVARIANT'
>>>

Not aware why it is so. BCC5.8 does not produce any error.



<<<
      .\wvgsink.c(633) : warning C4305: 'type cast' : truncation from
'HB_LONG' to 'device_interface *'
>>>

Known issue but I am unable to resolve it.


<<<
      .\wvgsink.c(652) : warning C4996: 'strcat': This function or variable
may be unsafe. Consider using strcat_s instead. To disable deprecation, use
_CRT_SECURE_NO_WARNINGS. See online help for details.
>>>

Please do it as I am not familiar with the function usge.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-15-01%3A43-UTC%2B0100-Viktor-Szakats-%28harbour.01-syenar-hu%29-tp20511728p20512750.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From m.lacecilia at gmail.com  Sat Nov 15 02:43:46 2008
From: m.lacecilia at gmail.com (Maurizio la Cecilia)
Date: Sat Nov 15 02:43:53 2008
Subject: R: [Harbour] 2008-11-14 20:49 UTC+0100 Viktor Szakats
In-Reply-To: <5123F4F5-16C4-44A4-AFDD-875B7B83807F@syenar.hu>
References: <5123F4F5-16C4-44A4-AFDD-875B7B83807F@syenar.hu>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAEPH+zHhktcRvfQAgK18GwzCgAAAEAAAAFwGhGnZEFtEmQBvFDh2pBkBAAAAAA==@gmail.com>

Hi Viktor.
Thx.
Fixed for me.
Best regards.

Maurizio la Cecilia               

From info at fsgiudice.com  Sat Nov 15 04:18:27 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Sat Nov 15 04:18:34 2008
Subject: [Harbour] 2008-11-14 20:49 UTC+0100 Viktor Szakats
In-Reply-To: <5123F4F5-16C4-44A4-AFDD-875B7B83807F@syenar.hu>
References: <5123F4F5-16C4-44A4-AFDD-875B7B83807F@syenar.hu>
Message-ID: <491E93E3.4010501@fsgiudice.com>

Hi Viktor,

Il 14/11/2008 20.55, Szak?ts Viktor ha scritto:
> 2008-11-14 20:49 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
>   * make_b32.mak
>   * make_vc.mak
>     * Possible fix to install problem. I can't test at the moment.
> -- 

Thank you, now it works as usual.

Best regards

Francesco
From harbour.01 at syenar.hu  Sat Nov 15 04:42:09 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov 15 04:42:18 2008
Subject: [Harbour] 2008-11-15 01:43 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <20512750.post@talk.nabble.com>
References: <01c946bc$Blat.v2.6.2$b948d988$113832e9120@127.0.0.1>
	<20512750.post@talk.nabble.com>
Message-ID: <05E9144A-F9A0-412F-805D-F45FF9B4B9BE@syenar.hu>

Hi Pritpal,

> 'TrackMouseEvent' is included in <windows.h>. SO do not know why it  
> remains
> undefined.

Maybe a missing header, or maybe version differences
in platform SDK?

> <<<
>      .\wvgsink.c(455) : error C2039: 'n1' : is not a member of  
> 'tagVARIANT'
>      .\wvgsink.c(457) : error C2039: 'n1' : is not a member of  
> 'tagVARIANT'
>      .\wvgsink.c(460) : error C2039: 'n1' : is not a member of  
> 'tagVARIANT'
>      .\wvgsink.c(463) : error C2039: 'n1' : is not a member of  
> 'tagVARIANT'
>      .\wvgsink.c(466) : error C2039: 'n1' : is not a member of  
> 'tagVARIANT'
>      .\wvgsink.c(469) : error C2039: 'n1' : is not a member of  
> 'tagVARIANT'
>      .\wvgsink.c(472) : error C2039: 'n1' : is not a member of  
> 'tagVARIANT'
>      .\wvgsink.c(475) : error C2039: 'n1' : is not a member of  
> 'tagVARIANT'
>>>>
>
> Not aware why it is so. BCC5.8 does not produce any error.

Try using this custom switch with BCC, so that
you can get more warnings/errors through
development:
'set C_USR=-DUNICODE -P' (this turns on UNICODE and C++ mode)

BTW, this or very similar problem has been corrected
in hbole and hbwin in the past, so the answer is
in one of the diffs for these files, or maybe it's just
enough for you to peek into the code.

>      .\wvgsink.c(652) : warning C4996: 'strcat': This function or  
> variable
> may be unsafe. Consider using strcat_s instead. To disable  
> deprecation, use
> _CRT_SECURE_NO_WARNINGS. See online help for details.
>>>>
>
> Please do it as I am not familiar with the function usge.

Just replaces strcat() with hb_strncat() and pass the
total size of the buffer minus one, as an additional
parameter. Pls see one of similar changes done in
the repository, or it's also enough to look at one
such hb_strncat() call in existing code.

I recommend to try compiling your code with MSVC 2005
or 2008 (both free), if possible. Using 'set C_USR=-DUNICODE -TP',
so you'll be informed about all these in the first
place.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sat Nov 15 05:41:19 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov 15 05:41:26 2008
Subject: [Harbour] nmake optimization for .prg
In-Reply-To: <20081008014154.GA18392@34-mo7-2.acn.waw.pl>
References: <6547DD43-38A4-43BB-8C9E-C1FA2B2EACA6@syenar.hu>
	<48EB70E4.1040300@mweb.co.za>
	<A6066744-FB04-47FD-8941-B38F112D2E1E@syenar.hu>
	<20081008014154.GA18392@34-mo7-2.acn.waw.pl>
Message-ID: <DB283C3C-A7C8-4F2D-AB24-A74169E6BF86@syenar.hu>

Finally, by creating a small external tool to convert
the list of .prg files to .c files in the object directory,
it's now possible to use the batch rules with MSVC.

It speeded up build creation quite noticeably, and
made the output much cleaner (one harbour, one C
compiler, one linker and one resource linker call, that's
4 calls altogether).

Build speed is about 10%-40% quicker depending on
circumstances like -gc0 vs. -gc3 and other factors.
Typically for -gc0, it's 20%-40% here.

Brgds,
Viktor

On 2008.10.08., at 3:41, Przemyslaw Czerpak wrote:

> On Tue, 07 Oct 2008, Szak?ts Viktor wrote:
>
> Hi Viktor,
>
>> I'd imaging two ways to achieve that:
>> 1) To have a batch rule with two steps.
>>   .prg -> .obj rules, with two command,
>>   Harbour getting all .prg as input, creating .c files, then
>>   cl.exe getting all .c files as input.
>>   This seems impossible as nmake doesn't allow to
>>   manipulate the dependency list in any ways, which
>>   would be needed to pass a .c file list to cl.exe.
>
> Have you tried sth like:
>
>   set HB_CFG_FILE=hb_bld.cfg
>   echo CC=$(CC) > %HB_CFG_FILE%
>   echo CFLAGS=$(CLIBFLAGS) -Fo$(OBJ_DIR)\ >> %HB_CFG_FILE%
>   echo VERBOSE=YES >> %HB_CFG_FILE%
>   echo DELTMP=YES >> %HB_CFG_FILE%
>
> and then:
>
>   {$(RTL_DIR)}.prg{$(OBJ_DIR)}$(OBJEXT)::
>      $(HB) $(HARBOURFLAGS) -go0 -o$(OBJ_DIR)\ $<
>
> Though it will also call MSVC many times.
>
> BTW what happens with this:
>
>   {$(RTL_DIR)}.prg{$(OBJ_DIR)}$(OBJEXT)::
>       $(HB) $(HARBOURFLAGS) -o$(OBJ_DIR)\ $<
>       $(CC) $(CLIBFLAGS) -Fo$(OBJ_DIR)\ $(*B:$(OBJEXT)=.c)
>
> $(*B:$(OBJEXT)=.c) will probably give wrong path so please try to
> substitute also path.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Sat Nov 15 07:08:34 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sat Nov 15 07:08:42 2008
Subject: [Harbour] nmake optimization for .prg
In-Reply-To: <DB283C3C-A7C8-4F2D-AB24-A74169E6BF86@syenar.hu>
References: <6547DD43-38A4-43BB-8C9E-C1FA2B2EACA6@syenar.hu>
	<48EB70E4.1040300@mweb.co.za>
	<A6066744-FB04-47FD-8941-B38F112D2E1E@syenar.hu>
	<20081008014154.GA18392@34-mo7-2.acn.waw.pl>
	<DB283C3C-A7C8-4F2D-AB24-A74169E6BF86@syenar.hu>
Message-ID: <EA581F9E-10F8-408F-92B9-A0DA3441347E@syenar.hu>

Here is the logic converted to plain batch solution
(needs Windows NT or upper), if anyone is interested:

#*******************************************************
# General *.prg --> *.obj COMPILE rules for STATIC Libraries
#*******************************************************
!if "$(HB_BATCH_PRG)" == "yes"
{$(RTL_DIR)}.prg{$(OBJ_DIR)}$(OBJEXT)::
     $(HB) $(HARBOURFLAGS) -o$(OBJ_DIR)\ $<
     @$(ECHO) @set OUT=                             >  _hbprg2c.bat
     @$(ECHO) :LOOP                                 >> _hbprg2c.bat
     @$(ECHO) @if not %%1x == x (                   >> _hbprg2c.bat
     @$(ECHO) @set OUT=%OUT% $(OBJ_DIR)\%%~n1.c     >> _hbprg2c.bat
     @$(ECHO) @shift                                >> _hbprg2c.bat
     @$(ECHO) @goto LOOP                            >> _hbprg2c.bat
     @$(ECHO) )                                     >> _hbprg2c.bat
     @$(ECHO) @$(ECHO) %OUT% ^> _make_vc.tmp        >> _hbprg2c.bat
     @$(ECHO) @$(ECHO) @$(DEL) %OUT% ^> _hbdelc.bat >> _hbprg2c.bat
     @_hbprg2c.bat $<
     $(CC) $(CLIBFLAGS) -Fo$(OBJ_DIR)\ @_make_vc.tmp
     @_hbdelc.bat
     @if exist _hbprg2c.bat $(DEL) _hbprg2c.bat
     @if exist _hbdelc.bat  $(DEL) _hbdelc.bat
     @if exist _make_vc.tmp $(DEL) _make_vc.tmp
!else
{$(RTL_DIR)}.prg{$(OBJ_DIR)}$(OBJEXT):
     $(HB) $(HARBOURFLAGS) -o$(OBJ_DIR)\ $<
     $(CC) $(CLIBFLAGS) -Fo$(OBJ_DIR)\ $(OBJ_DIR)\$(*B).c
     @if exist $(OBJ_DIR)\$(*B).c $(DEL) $(OBJ_DIR)\$(*B).c > nul
!endif
#*******************************************************

Brgds,
Viktor

On 2008.11.15., at 11:41, Szak?ts Viktor wrote:

> Finally, by creating a small external tool to convert
> the list of .prg files to .c files in the object directory,
> it's now possible to use the batch rules with MSVC.
>
> It speeded up build creation quite noticeably, and
> made the output much cleaner (one harbour, one C
> compiler, one linker and one resource linker call, that's
> 4 calls altogether).
>
> Build speed is about 10%-40% quicker depending on
> circumstances like -gc0 vs. -gc3 and other factors.
> Typically for -gc0, it's 20%-40% here.
>
> Brgds,
> Viktor
>
> On 2008.10.08., at 3:41, Przemyslaw Czerpak wrote:
>
>> On Tue, 07 Oct 2008, Szak?ts Viktor wrote:
>>
>> Hi Viktor,
>>
>>> I'd imaging two ways to achieve that:
>>> 1) To have a batch rule with two steps.
>>>  .prg -> .obj rules, with two command,
>>>  Harbour getting all .prg as input, creating .c files, then
>>>  cl.exe getting all .c files as input.
>>>  This seems impossible as nmake doesn't allow to
>>>  manipulate the dependency list in any ways, which
>>>  would be needed to pass a .c file list to cl.exe.
>>
>> Have you tried sth like:
>>
>>  set HB_CFG_FILE=hb_bld.cfg
>>  echo CC=$(CC) > %HB_CFG_FILE%
>>  echo CFLAGS=$(CLIBFLAGS) -Fo$(OBJ_DIR)\ >> %HB_CFG_FILE%
>>  echo VERBOSE=YES >> %HB_CFG_FILE%
>>  echo DELTMP=YES >> %HB_CFG_FILE%
>>
>> and then:
>>
>>  {$(RTL_DIR)}.prg{$(OBJ_DIR)}$(OBJEXT)::
>>     $(HB) $(HARBOURFLAGS) -go0 -o$(OBJ_DIR)\ $<
>>
>> Though it will also call MSVC many times.
>>
>> BTW what happens with this:
>>
>>  {$(RTL_DIR)}.prg{$(OBJ_DIR)}$(OBJEXT)::
>>      $(HB) $(HARBOURFLAGS) -o$(OBJ_DIR)\ $<
>>      $(CC) $(CLIBFLAGS) -Fo$(OBJ_DIR)\ $(*B:$(OBJEXT)=.c)
>>
>> $(*B:$(OBJEXT)=.c) will probably give wrong path so please try to
>> substitute also path.
>>
>> best regards,
>> Przemek
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>

From bedipritpal at hotmail.com  Sat Nov 15 11:31:16 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov 15 11:31:19 2008
Subject: [Harbour] 2008-11-15 08:17 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20517106.post@talk.nabble.com>


2008-11-15 08:17 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/gtwvg/gtwvg.h
    + BOOL bDeferPaint; member.
  * harbour/contrib/gtwvg/hbgtwvg.ch
    + #define HB_GTI_DEFERPAINT
      Implemented hb_gtInfo( HB_GTI_DEFERPAINT, FALSE | TRUE )
      For consoles hosting ActiveX controls need not be painted text buffer.
      :TOFIX To extend this protocol for resizing buffer too
   
  * harbour/contrib/gtwvg/wvgsink.c
    ! More unicode compliant.
    ! Fixed some errors in -DUNICODE builds, not all.
    ! strcat() => hb_strncat() : Viktor please check.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    + Added more Active-X controls.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-15-08%3A17-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20517106p20517106.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sat Nov 15 16:20:36 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov 15 16:20:39 2008
Subject: [Harbour] 2008-11-15 13:12 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20519577.post@talk.nabble.com>


2008-11-15 13:12 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/gtwvg/gtwvg.h
    - pWVT->bResizing
    - pWVT->bAlreadySizing
    ; Optimized resizing behavior. Now Window must not flicker until 
      resizing is finished. Please test. If this effects the desired
      behavior, let me port it to GTWVT also.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! Adjusted few parameters. Just play with <Traditional><Browser><F3,
F4>.
    ; TOFIX: INKEY() vs FireEvent() - Not sure what it behave like.  

  * harbour/contrib/gtwvg/wvgcrt.prg
    ! Fixes to some events behaviors. Copy and Paste syndrome :-(

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-15-13%3A12-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20519577p20519577.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sat Nov 15 17:38:11 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov 15 17:38:14 2008
Subject: [Harbour] big window in gtwvg
In-Reply-To: <4919E29E.2040400@oohg.org>
References: <4919E29E.2040400@oohg.org>
Message-ID: <20520210.post@talk.nabble.com>


Hi

>how can I resize my gtwvg window to the max size by CODE (program), not by 
>resize with mouse.

Implemented.

hb_gtInfo( HB_GTI_SPEC, HB_GTS_WNDSTATE, HB_GTS_WS_MAXIMIZE )

Please refer to hbgtinfo.ch for more window states.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/big-window-in-gtwvg-tp20448159p20520210.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From cvc at oohg.org  Sat Nov 15 18:39:16 2008
From: cvc at oohg.org (Ciro Vargas Clemow)
Date: Sat Nov 15 18:39:26 2008
Subject: [Harbour] big window in gtwvg
In-Reply-To: <20520210.post@talk.nabble.com>
References: <4919E29E.2040400@oohg.org> <20520210.post@talk.nabble.com>
Message-ID: <491F5DA4.7090109@oohg.org>

Pritpal Bedi escribi?:
> Hi
> 
>> how can I resize my gtwvg window to the max size by CODE (program), not by 
>> resize with mouse.
> 
> Implemented.
> 
> hb_gtInfo( HB_GTI_SPEC, HB_GTS_WNDSTATE, HB_GTS_WS_MAXIMIZE )
> 
> Please refer to hbgtinfo.ch for more window states.
> 
> Regards
> Pritpal Bedi
> 

thanks Pritpal

Best regards
Ciro

-- 
http://sistemascvc.tripod.com  (la casa del clip2win y nodosimp / the no2imp and 
clip2win home )

http://www.oohg.org ( Object Oriented Harbour GUI, more simple, more powerfull )


From bedipritpal at hotmail.com  Sat Nov 15 19:14:14 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov 15 19:14:20 2008
Subject: [Harbour] big window in gtwvg
In-Reply-To: <4919E29E.2040400@oohg.org>
References: <4919E29E.2040400@oohg.org>
Message-ID: <20520965.post@talk.nabble.com>


Ciro

Was it your question?

that at some point window gets black...

I have fixed this bug. Please report your findings here.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/big-window-in-gtwvg-tp20448159p20520965.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From cvc at oohg.org  Sat Nov 15 20:20:05 2008
From: cvc at oohg.org (Ciro Vargas Clemow)
Date: Sat Nov 15 20:20:14 2008
Subject: [Harbour] big window in gtwvg
In-Reply-To: <20520965.post@talk.nabble.com>
References: <4919E29E.2040400@oohg.org> <20520965.post@talk.nabble.com>
Message-ID: <491F7545.4080108@oohg.org>

Pritpal Bedi escribi?:
> Ciro
> 
> Was it your question?
> 
> that at some point window gets black...

No Pritpal , I no have questions, all it is ok.

Best regards
Ciro




-- 
http://sistemascvc.tripod.com  (la casa del clip2win y nodosimp / the no2imp and 
clip2win home )

http://www.oohg.org ( Object Oriented Harbour GUI, more simple, more powerfull )


From abe.buch at att.net  Sun Nov 16 01:45:36 2008
From: abe.buch at att.net (Abeb)
Date: Sun Nov 16 01:45:40 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20081109201947.GA24098@34-mo7-2.acn.waw.pl>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
Message-ID: <20522880.post@talk.nabble.com>


is WinCe fix already?

does anybody sucsessfuly run WinCe programs? 

Thanks for any help.



Przemyslaw Czerpak-2 wrote:
> 
> On Sun, 09 Nov 2008, Pritpal Bedi wrote:
> 
> Hi Pritpal,
> 
>> Show up your link script. 
>> I suspect you are are linking gtnul instead of gtwin.
> 
> Current GTWVT does not work in WinCE. I checked it.
> It's probably caused by the code which force font resizing on startup.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20522880.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 16 02:04:54 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 02:04:57 2008
Subject: [Harbour] 2008-11-15 23:01 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20522969.post@talk.nabble.com>


2008-11-15 23:01 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    ! Further tuned up the resizing behavior.

    ! Fixed a nasty bug present since begining. The bug was causing 
      window to loose gui contents and even text buffer in certain
      circumstances. Now you can be assured that all GTs open 
      with/without gui contents will never be out of synchronization.
      Play with contrib/gtwvg/tests/demowvg.prg, open many browsers,
      Active-X controls, get windows and so on, every window will 
      behave as a gentleman.

  * harbour/contrib/gtwvg/wvgcrt.prg
    ! Fixed ::resize method.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! Fine tuned to respect above fixes.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-15-23%3A01-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20522969p20522969.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 16 02:07:58 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 02:08:00 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20522880.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20522880.post@talk.nabble.com>
Message-ID: <20522982.post@talk.nabble.com>


Abeb

>is WinCe fix already?

Hopefully it will work shortly. 
I am awaiting Viktor's tests with GTWVG and if all goes
ok relevant fixes will be ported to GTWVT.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20522982.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 16 03:05:41 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 03:05:44 2008
Subject: [Harbour] 2008-11-15 23:59 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20523230.post@talk.nabble.com>


2008-11-15 23:59 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/gtwvg/wvgcrt.prg
    ! Further tuned up the resizing behavior. Silly typos.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-15-23%3A59-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20523230p20523230.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From mbelgrano at deltain.it  Sun Nov 16 05:38:12 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Sun Nov 16 05:39:18 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20522982.post@talk.nabble.com>
References: <20236568.post@talk.nabble.com><20081029221836.GA20510@34-mo7-2.acn.waw.pl><20251189.post@talk.nabble.com><20081031014729.GB24870@34-mo7-2.acn.waw.pl><20259457.post@talk.nabble.com><20081031110930.GB22253@34-mo7-2.acn.waw.pl><20408175.post@talk.nabble.com><20081109164721.GA2969@34-mo7-2.acn.waw.pl><20409140.post@talk.nabble.com>
	<20409230.post@talk.nabble.com><20409269.post@talk.nabble.com><20081109201947.GA24098@34-mo7-2.acn.waw.pl><20522880.post@talk.nabble.com>
	<20522982.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1A2@SRV02.deltain.net>

Hi Pritpal
In prev post Przemyslaw have suggested you inherit gtwvg instead copy
part of it
> It's also possible to create new next level GT drivers which will 
>inherits  from any existing ones just like in RDD.
> In contrib/libct/ctwin.c you will find CTW GT which implements full 
>CT3  Window system for Harbour inheriting from any existing GT driver.
> Personally I suggest you and Antonio and other GUI library authors to

>create sth like GUI GT driver for GUI programs. It will extend your GUI

>libraries functionality by because not only command which you redirect

>using preprocessor will work with GUI object but you will be able to  
>redirect also all functions like maxrow(), maxcol(), setpos() 
>dispout(),  qout(), etc. can be oriented to currently active Window and

>supported  by your libraries.
Do you think that inherit will be  possible also for gtwvg?
Are you blocked by same unknown information?


-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Sunday, November 16, 2008 8:08 AM
To: harbour@harbour-project.org
Subject: Re: [Harbour] wince (wcecon not ruuning on PocketPc)


Abeb

>is WinCe fix already?

Hopefully it will work shortly. 
I am awaiting Viktor's tests with GTWVG and if all goes
ok relevant fixes will be ported to GTWVT.

Regards
Pritpal Bedi

-- 
View this message in context:
http://www.nabble.com/wince-tp20236568p20522982.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From ng at areainformatica.com  Sun Nov 16 06:24:37 2008
From: ng at areainformatica.com (Giangi)
Date: Sun Nov 16 06:30:08 2008
Subject: [Harbour] GPF in hbmysql
Message-ID: <loom.20081116T112352-130@post.gmane.org>

I've a GPF launching hbmysql\tests\test.prg

This is the log file:

Application Internal Error - C:\harbour\contrib\hbmysql\tests\test.exe
Terminated at: 2008.10.12 17:09:27
Unrecoverable error 6005: Exception error:

    Exception Code:C0000005
    Exception Address:100292FB
    EAX:00353ED8  EBX:00353ED8  ECX:00000000  EDX:00000000
    ESI:00477402  EDI:0047740E  EBP:00477415
    CS:EIP:001B:100292FB  SS:ESP:0023:0012FC84
    DS:0023  ES:0023  FS:003B  GS:0000
    Flags:00010206
    CS:EIP: FF 11 83 C4 04 C2 04 00 CC CC CC CC CC CC CC CC
    SS:ESP: 00353ED8 00401227 00353ED8 00477402 0047740E 00477415 00000000
00000CEA 00000000 00000000 00000CEA 00000000 0012FCE4 00000041 00000000
0047820C

    C stack:
    EIP:     EBP:       Frame: OldEBP, RetAddr, Params...


Called from SQLCONNECT(0)
Called from TMYSQLSERVER:NEW(1373)
Called from MAIN(62) in test.prg

TIA
Gianluca
-- 





From harbour.01 at syenar.hu  Sun Nov 16 06:40:29 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov 16 06:40:40 2008
Subject: [Harbour] 2008-11-15 23:59 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20523230.post@talk.nabble.com>
References: <20523230.post@talk.nabble.com>
Message-ID: <6B506162-1FCA-44B3-9051-F4EBFC1DAABA@syenar.hu>

Hi Pritpal,

After just a quick test (BCC -mt mode), I'm getting a "truncated"
window when choosing "dialog one". Now background updates seem
to be better, but there is a great amount of redraw flicker
on some of the control (the icons at the bottom) on the background
window, while moving another window in front of it, and there are
visible some white spots (rects) not refreshed [Update: I couldn't
repeat this for a second time, because I forgot how I got there].
One of the dialog windows (open new dialog, resize, press ESC),
was scaled like a bitmap. BTW, the bottom icons are flickering just
by moving across the GET controls with a TAB.

It's generally very confusing to know where an ESC should be
used to navigate, or rather the mouse, and it's still very
difficult to know if a menu will open a new windows, or just
modify the current one. All these break the usuall GUI paradigm
which I'd expect from such app. F.e. you can only move out
from the One/Two/Three.. box with ESC, not with mouse or TAB.
There are other windows however, when ESC doesn't work and
you have to click OK. The icons at the bottom also either
work or not, I couldn't find the logic, or any hint based on
their color (green = inactive?).

This overall causes there I'm never sure "where am I" in the
menu, how to get there, how did I get there, and how to exit
from there. This explains why it's so difficult to report a
problem in a repeatable way. I've also accidentally closed
the app like 5 times.

Resize looks quite strange to me now, and AFAIR we've been
there once already. Now while resizing, the borders with
various size are remaining visible while you move your mouse
(while the window content is flickering due to refresh, but
it doesn't change the size, just the position below the menu,
if there is a menu), which first of all give a non-interactive
feel to it (like with "visible while resize/move" Windows
setting turned off), plus looks quite unfinished. [ So I'd
opt to stay with current resize behavior for GTWVT. ]

Most ActiveX windows don't work here, and it's not possible
to close those. (IE and DHTML works, the rest don't, I don't
have Excel, so that one is alright, albeit this should IMO
be handled more gracefully.)

Overall the refresh looks now indeed better, with some price
paid by extra flickering.

Brgds,
Viktor

On 2008.11.16., at 9:05, Pritpal Bedi wrote:

>
> 2008-11-15 23:59 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>  * harbour/contrib/gtwvg/gtwvg.c
>  * harbour/contrib/gtwvg/wvgcrt.prg
>    ! Further tuned up the resizing behavior. Silly typos.
>
> Regards
> Pritpal Bedi
> -- 
> View this message in context: http://www.nabble.com/2008-11-15-23%3A59-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20523230p20523230.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at acn.waw.pl  Sun Nov 16 09:32:53 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov 16 09:31:43 2008
Subject: [Harbour] 2008-11-16 15:32 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081116143253.GA25585@34-mo7-2.acn.waw.pl>

2008-11-16 15:32 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hbatomic.h
    + added support for built in GCC atomic functions: __sync_*()
      They are present in GCC >= 4.1 if given CPU supports them. For
      x86 CPU family the ones we use need at least i486 CPU. Please make
      tests with other CPUs like PPC. If given platform/CPU does not support
      them then GCC generate call to function __sync_*_<N>() where <N>
      is size of given type used in atomic operation instead of storing
      inlined assembler code.

best regards
Przemek
From bedipritpal at hotmail.com  Sun Nov 16 10:32:08 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 10:32:11 2008
Subject: [Harbour] 2008-11-16 07:29 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20526381.post@talk.nabble.com>


2008-11-16 07:29 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/gtwvg/gtwvg.h
    ! Further tuned up the resizing behavior. Viktor please check.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-16-07%3A29-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20526381p20526381.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 16 10:38:25 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 10:38:30 2008
Subject: [Harbour] 2008-11-16 07:29 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20526381.post@talk.nabble.com>
References: <20526381.post@talk.nabble.com>
Message-ID: <20526428.post@talk.nabble.com>


Viktor


Pritpal Bedi wrote:
> 
> 2008-11-16 07:29 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>   * harbour/contrib/gtwvg/gtwvg.c
>   * harbour/contrib/gtwvg/gtwvg.h
>     ! Further tuned up the resizing behavior. Viktor please check.
> 

NOTE: Borders will be visible when resizing as is as it cannot be controlled 
programatically unless the solution I had offered very begining ( by
changing 
windows visual effects progrmatically ). 

Once the user releases the mouse button the window is refreshed. It is 
exactly like if drag effects are turned off except for that it displays the 
border.

But certainly continuous repainting is reduced to a single call.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/2008-11-16-07%3A29-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20526381p20526428.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 16 10:49:57 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 10:50:00 2008
Subject: [Harbour] GT without Text Bufer : Feature Request
Message-ID: <20526548.post@talk.nabble.com>


Hello Przemek

Can we have a feature in current GT modal where
no text buffer is implemented, I mean a pure windows
window but through the GT.

I am trying to achieve it by other means but 
seems if this feature is present in current GT modal
it will make my life easier.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/GT-without-Text-Bufer-%3A-Feature-Request-tp20526548p20526548.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dmacias at mail.udg.mx  Sun Nov 16 11:32:22 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Sun Nov 16 11:32:16 2008
Subject: [Harbour] Re: Harbour under OS/2 - OpenWatcom
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <49204B16.70506@mail.udg.mx>

Definitely speedtst.prg hangs somewhere

I checked OW linker doc,
If not STACK option is used, as OW doc say:
-------------------
"default stack size varies for both 16-bit and protected-mode 32-bit 
applications depending on the executable format ..."
-------------------

Entire page for STACK OPTION is below

Removing OP stack=65536 and Using OPTION MAP "default stack size" can be 
checked
For hbrun_mt.exe hbrun.map show:
-----------------------------
                         +-----------------------+
                         |   Linker Statistics   |
                         +-----------------------+

Stack size:  00012000 (73728.)
Memory size:  001db03d (1945661.)
Entry point address: 0002:000bb30e
-----------------------------

So default stack size is greater than previous used ( 73728 > 65536 ) 
and should be enough
This stack value is used in thread 1, and as limit in thread except 1 if 
"-sg" flag is used
As I am not using "-sg" flag, then thread except 1 use fixed value 
stated in code using _beginthread()

Testing:
tests\mt\mttest*.prg
********************
   Everyone run except 09, 10 due to known missings

speedtst.prg
************
Just MT
Depend of parameters
As exposed before, run extremaly slow and sometimes remain freezed

Entire results are below

hbrun_mt.exe speedtst.prg
=========================
[ total application time: ]...................................258.61
[ total real time: ]..........................................263.15

hbrun_mt.exe speedtst.prg --exclude=mem
=========================
[ total application time: ]...................................103.55
[ total real time: ]..........................................107.36

hbrun_mt.exe speedtst.prg --exclude=mem --scale
=========================
26.3 minutos
[ total application time: ]...................................251.74
[ total real time: ].........................................1578.49

hbrun_mt.exe speedtst.prg --exclude=mem --scale --thread=2
=========================
Remain doing something elsewhere
After 1 hour 40 minutes, I cancelled it
------------------------
[E:\harbour811\harbour\tests]e:\harbour811\ow\bin\hbrun_mt.exe 
speedtst.prg --exclude=mem --scale --thread=2

11/16/08 10:18:29 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT)+ Open Watcom C++ 12.70.8 (32-bit)
THREADS: 2
N_LOOPS: 1000000
excluded tests: 029 030 023 025 027 040 041 043 052 053 019 022 031 032 054
                                                         1 th.  2 th. 
factor
============================================================================
The external process was cancelled by a Ctrl+Break or another process.
^C
------------------------

I used these linker flags:

LDFLAGS = debug all OP MAP OP CASEEXACT

Obviously some flags for compiler / linker are missing
I checked all "linker directives and options" of OW doc, but many of 
them I don not understand
Some one like this can be related
...............................
Formats:  OS/2

The "INTERNALRELOCS" option is used with LX format executables under 
32-bit OS/2.  By default, OS/2 executables do not contain internal 
relocation information and OS/2 Dynamic Link Libraries do contain 
internal relocation information.  This option causes the Open Watcom 
Linker to include internal relocation information in OS/2 LX format 
executables.

The format of the "INTERNALRELOCS" option (short form "INT") is as follows.

          OPTION INTERNALRELOCS
...............................

Przemek, Maurilio:
Review "linker directives and options" of OW doc, perhaps you can find 
something related

Przemek: do you have any idea why with "--thread=2" never end ?

Any other suggestions ?

David Macias



STACK option
============

Formats:  All

The "STACK" option can be used to increase the size of the stack.  The 
format of the "STACK" option (short form "ST") is as follows.


          OPTION STACK=n

where
description

n
represents a value.  The complete form of n is the following.


      [0x]d{d}[k|m]

d represents a decimal digit.  If 0x is specified, the string of digits 
represents a hexadecimal number.  If k is specified, the value is 
multiplied by 1024.  If m is specified, the value is multiplied by 
1024*1024.

The default stack size varies for both 16-bit and protected-mode 32-bit 
applications depending on the executable format.  You can determine the 
default stack size by looking at the map file that can be generated when 
an application is linked ("OPTION MAP").  During execution of your 
program, you may get an error message indicating your stack has 
overflowed.  If you encounter such an error, you must link your 
application again, this time specifying a larger stack size using the 
"STACK" option.

Example:

      option stack=8192



hbrun_mt.exe speedtst.prg
=========================

11/16/08 07:14:30 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 0
N_LOOPS: 1000000
[ T000: empty loop overhead ]...................................0.23
====================================================================
[ T001: x := L_C ]..............................................1.52
[ T002: x := L_N ]..............................................0.26
[ T003: x := L_D ]..............................................0.23
[ T004: x := S_C ]..............................................1.52
[ T005: x := S_N ]..............................................0.26
[ T006: x := S_D ]..............................................0.19
[ T007: x := M_C ]..............................................1.61
[ T008: x := M_N ]..............................................0.29
[ T009: x := M_D ]..............................................0.32
[ T010: x := P_C ]..............................................1.58
[ T011: x := P_N ]..............................................0.29
[ T012: x := P_D ]..............................................0.32
[ T013: x := F_C ]..............................................2.45
[ T014: x := F_N ]..............................................0.71
[ T015: x := F_D ]..............................................0.55
[ T016: x := o:GenCode ]........................................2.26
[ T017: x := o[8] ].............................................1.87
[ T018: round( i / 1000, 2 ) ]..................................1.06
[ T019: str( i / 1000 ) ].......................................3.29
[ T020: val( s ) ]..............................................2.26
[ T021: val( a [ i % 16 + 1 ] ) ]...............................4.35
[ T022: dtos( d - i % 10000 ) ].................................3.39
[ T023: eval( { || i % 16 } ) ].................................8.61
[ T024: eval( bc := { || i % 16 } ) ]...........................2.39
[ T025: eval( { |x| x % 16 }, i ) ].............................5.42
[ T026: eval( bc := { |x| x % 16 }, i ) ].......................2.29
[ T027: eval( { |x| f1( x ) }, i ) ]............................5.97
[ T028: eval( bc := { |x| f1( x ) }, i ) ]......................2.81
[ T029: x := &( "f1(" + str(i) + ")" ) ].......................22.87
[ T030: bc := &( "{|x|f1(x)}" ); eval( bc, i ) ]...............29.19
[ T031: x := valtype( x ) +  valtype( i ) ].....................4.74
[ T032: x := strzero( i % 100, 2 ) $ a[ i % 16 + 1 ] ]..........6.97
[ T033: x := a[ i % 16 + 1 ] == s ].............................5.03
[ T034: x := a[ i % 16 + 1 ] = s ]..............................5.19
[ T035: x := a[ i % 16 + 1 ] >= s ].............................5.23
[ T036: x := a[ i % 16 + 1 ] <= s ].............................5.13
[ T037: x := a[ i % 16 + 1 ] < s ]..............................5.19
[ T038: x := a[ i % 16 + 1 ] > s ]..............................5.13
[ T039: ascan( a, i % 16 ) ]....................................2.81
[ T040: ascan( a, { |x| x == i % 16 } ) ]......................33.35
[ T041: if i%1000==0;a:={};end; aadd(a,{i,1,.T.,s,s2,a2,bc ]...18.35
[ T042: x := a ]................................................1.61
[ T043: x := {} ]...............................................3.52
[ T044: f0() ]..................................................0.45
[ T045: f1( i ) ]...............................................0.71
[ T046: f2( c[1...8] ) ]........................................1.90
[ T047: f2( c[1...40000] ) ]....................................1.87
[ T048: f2( @c[1...40000] ) ]...................................1.90
[ T049: f2( @c[1...40000] ), c2 := c ]..........................2.10
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]....................8.03
[ T051: f2( a ) ]...............................................1.97
[ T052: x := f4() ].............................................4.52
[ T053: x := f5() ].............................................2.97
[ T054: f_prv( c ) ]............................................7.52
====================================================================
[ total application time: ]...................................258.61
[ total real time: ]..........................................263.15


hbrun_mt.exe speedtst.prg --exclude=mem
=========================

11/16/08 07:21:55 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 0
N_LOOPS: 1000000
excluded tests: 029 030 023 025 027 040 041 043 052 053 019 022 031 032 054
[ T000: empty loop overhead ]...................................0.32
====================================================================
[ T001: x := L_C ]..............................................1.58
[ T002: x := L_N ]..............................................0.29
[ T003: x := L_D ]..............................................0.26
[ T004: x := S_C ]..............................................1.55
[ T005: x := S_N ]..............................................0.23
[ T006: x := S_D ]..............................................0.19
[ T007: x := M_C ]..............................................1.65
[ T008: x := M_N ]..............................................0.35
[ T009: x := M_D ]..............................................0.35
[ T010: x := P_C ]..............................................1.55
[ T011: x := P_N ]..............................................0.32
[ T012: x := P_D ]..............................................0.35
[ T013: x := F_C ]..............................................2.39
[ T014: x := F_N ]..............................................0.74
[ T015: x := F_D ]..............................................0.55
[ T016: x := o:GenCode ]........................................2.35
[ T017: x := o[8] ].............................................1.94
[ T018: round( i / 1000, 2 ) ]..................................1.16
[ T020: val( s ) ]..............................................2.35
[ T021: val( a [ i % 16 + 1 ] ) ]...............................4.65
[ T024: eval( bc := { || i % 16 } ) ]...........................2.55
[ T026: eval( bc := { |x| x % 16 }, i ) ].......................2.55
[ T028: eval( bc := { |x| f1( x ) }, i ) ]......................3.45
[ T033: x := a[ i % 16 + 1 ] == s ].............................5.42
[ T034: x := a[ i % 16 + 1 ] = s ]..............................5.61
[ T035: x := a[ i % 16 + 1 ] >= s ].............................5.42
[ T036: x := a[ i % 16 + 1 ] <= s ].............................5.39
[ T037: x := a[ i % 16 + 1 ] < s ]..............................5.39
[ T038: x := a[ i % 16 + 1 ] > s ]..............................5.39
[ T039: ascan( a, i % 16 ) ]....................................3.00
[ T042: x := a ]................................................1.61
[ T044: f0() ]..................................................0.55
[ T045: f1( i ) ]...............................................0.84
[ T046: f2( c[1...8] ) ]........................................2.00
[ T047: f2( c[1...40000] ) ]....................................2.06
[ T048: f2( @c[1...40000] ) ]...................................2.03
[ T049: f2( @c[1...40000] ), c2 := c ]..........................2.35
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]....................8.45
[ T051: f2( a ) ]...............................................2.06
====================================================================
[ total application time: ]...................................103.55
[ total real time: ]..........................................107.36


hbrun_mt.exe speedtst.prg --exclude=mem --scale
=========================

11/16/08 07:25:10 OS/2 4.50
Harbour 1.1.0dev (Rev. 9903) (MT) Open Watcom C++ 12.70.8 (32-bit)
THREADS: 1
N_LOOPS: 1000000
excluded tests: 029 030 023 025 027 040 041 043 052 053 019 022 031 032 054
                                                         1 th.  1 th. 
factor
============================================================================
[ T001: x := L_C ]____________________________________  1.72   4.87 ->  0.35
[ T002: x := L_N ]____________________________________  2.07   3.05 ->  0.68
[ T003: x := L_D ]____________________________________  2.03   4.14 ->  0.49
[ T004: x := S_C ]____________________________________  4.28   4.15 ->  1.03
[ T005: x := S_N ]____________________________________  3.28   1.07 ->  3.07
[ T006: x := S_D ]____________________________________  8.36   1.12 ->  7.46
[ T007: x := M_C ]____________________________________  5.39   5.44 ->  0.99
[ T008: x := M_N ]____________________________________  4.21   0.98 ->  4.30
[ T009: x := M_D ]____________________________________  6.40   1.10 ->  5.82
[ T010: x := P_C ]____________________________________  4.56   4.90 ->  0.93
[ T011: x := P_N ]____________________________________  4.87   1.05 ->  4.64
[ T012: x := P_D ]____________________________________  3.03   2.11 ->  1.44
[ T013: x := F_C ]____________________________________  6.55   7.75 ->  0.85
[ T014: x := F_N ]____________________________________  2.03   3.10 ->  0.65
[ T015: x := F_D ]____________________________________  1.88   1.13 ->  1.66
[ T016: x := o:GenCode ]______________________________ 11.35   3.40 ->  3.34
[ T017: x := o[8] ]___________________________________  6.24   6.49 ->  0.96
[ T018: round( i / 1000, 2 ) ]________________________  3.89   1.61 ->  2.42
[ T020: val( s ) ]____________________________________  9.22   8.29 ->  1.11
[ T021: val( a [ i % 16 + 1 ] ) ]_____________________ 10.17  15.02 ->  0.68
[ T024: eval( bc := { || i % 16 } ) ]_________________  9.82  11.10 ->  0.88
[ T026: eval( bc := { |x| x % 16 }, i ) ]_____________  7.93   6.35 ->  1.25
[ T028: eval( bc := { |x| f1( x ) }, i ) ]____________  5.97   6.14 ->  0.97
[ T033: x := a[ i % 16 + 1 ] == s ]___________________ 10.30  10.37 ->  0.99
[ T034: x := a[ i % 16 + 1 ] = s ]____________________ 15.15  13.74 ->  1.10
[ T035: x := a[ i % 16 + 1 ] >= s ]___________________ 10.81  11.08 ->  0.98
[ T036: x := a[ i % 16 + 1 ] <= s ]___________________ 10.52  10.24 ->  1.03
[ T037: x := a[ i % 16 + 1 ] < s ]____________________ 10.88  10.51 ->  1.04
[ T038: x := a[ i % 16 + 1 ] > s ]____________________ 10.77  10.81 ->  1.00
[ T039: ascan( a, i % 16 ) ]__________________________  6.01   6.16 ->  0.98
[ T042: x := a ]______________________________________  3.98   3.48 ->  1.14
[ T044: f0() ]________________________________________  1.57   1.66 ->  0.95
[ T045: f1( i ) ]_____________________________________  2.10   1.75 ->  1.20
[ T046: f2( c[1...8] ) ]______________________________  4.49   4.26 ->  1.05
[ T047: f2( c[1...40000] ) ]__________________________  4.38   4.22 ->  1.04
[ T048: f2( @c[1...40000] ) ]_________________________  4.33   4.51 ->  0.96
[ T049: f2( @c[1...40000] ), c2 := c ]________________  5.25   4.65 ->  1.13
[ T050: f3( a, a2, s, i, s2, bc, i, n, x ) ]__________ 16.44  16.45 ->  1.00
[ T051: f2( a ) ]_____________________________________  4.54   4.07 ->  1.12
============================================================================
[   TOTAL   ]_________________________________________246.77 222.32 ->  1.11
============================================================================
[ total application time: ]...................................251.74
[ total real time: ].........................................1578.49

From lorenzo.fiorini at gmail.com  Sun Nov 16 12:10:12 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sun Nov 16 12:10:16 2008
Subject: [Harbour] Warnings with Ubuntu's gcc 4.3.2
Message-ID: <9257026e0811160910v3c6524eet8c1b6ab25c0f9ea0@mail.gmail.com>

Just to report that ./make_gnu.sh 2>err.log Harbour 1.0.1 on Ubuntu 8.10 I get:

In file included from ../../hbpp.c:55:
../../ppcore.c: In function 'hb_pp_dumpEnd':
../../ppcore.c:842: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_pragmaNew':
../../ppcore.c:2521: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_tokenGet':
../../ppcore.c:5083: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_tokenToString':
../../ppcore.c:5833: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_dumpEnd':
../../ppcore.c:842: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_pragmaNew':
../../ppcore.c:2521: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_tokenGet':
../../ppcore.c:5083: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_tokenToString':
../../ppcore.c:5833: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../genc.c: In function 'hb_compGenCFunc':
../../genc.c:414: warning: ignoring return value of 'fwrite', declared
with attribute warn_unused_result
../../genc.c:421: warning: ignoring return value of 'fwrite', declared
with attribute warn_unused_result
../../genhrb.c: In function 'hb_compGenPortObj':
../../genhrb.c:170: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../errorint.c: In function 'hb_errInternal':
../../errorint.c:106: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../errorint.c:129: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../run.c: In function 'HB_FUN___RUN':
../../run.c:64: warning: ignoring return value of 'system', declared
with attribute warn_unused_result
../../estack.c: In function 'hb_stackDispLocal':
../../estack.c:518: warning: format not a string literal and no format arguments
../../estack.c:522: warning: format not a string literal and no format arguments
../../estack.c:527: warning: format not a string literal and no format arguments
../../hboutdbg.c: In function 'HB_FUN_HB_OUTDEBUG':
../../hboutdbg.c:207: warning: ignoring return value of 'write',
declared with attribute warn_unused_result
../../hboutdbg.c:208: warning: ignoring return value of 'write',
declared with attribute warn_unused_result

gcc -v says:

Using built-in specs.
Target: i486-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Ubuntu
4.3.2-1ubuntu11'
--with-bugurl=file:///usr/share/doc/gcc-4.3/README.Bugs
--enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr
--enable-shared --with-system-zlib --libexecdir=/usr/lib
--without-included-gettext --enable-threads=posix --enable-nls
--with-gxx-include-dir=/usr/include/c++/4.3 --program-suffix=-4.3
--enable-clocale=gnu --enable-libstdcxx-debug --enable-objc-gc
--enable-mpfr --enable-targets=all --enable-checking=release
--build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
Thread model: posix
gcc version 4.3.2 (Ubuntu 4.3.2-1ubuntu11)

best regards,
Lorenzo
From mbelgrano at deltain.it  Sun Nov 16 13:11:28 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Sun Nov 16 13:12:34 2008
Subject: [Harbour] 2008-11-15 23:01 UTC-0800 Pritpal
	Bedi(pritpal@vouchcac.com)
In-Reply-To: <20522969.post@talk.nabble.com>
References: <20522969.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1A3@SRV02.deltain.net>

Receive error compiling demo (bcc)
C:\harbour\contrib\gtwvg\tests>HBMK_B32 -mt -gui demowvg -d__MW__
demowvg.prg(32) Error F0029  Can't open #include file 'hbgtwvg.ch'
1 error
No code generated
Error E2194: Could not find file 'demowvg.c'


-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Sunday, November 16, 2008 8:05 AM
To: harbour@harbour-project.org
Subject: [Harbour] 2008-11-15 23:01 UTC-0800 Pritpal
Bedi(pritpal@vouchcac.com)


2008-11-15 23:01 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    ! Further tuned up the resizing behavior.

    ! Fixed a nasty bug present since begining. The bug was causing 
      window to loose gui contents and even text buffer in certain
      circumstances. Now you can be assured that all GTs open 
      with/without gui contents will never be out of synchronization.
      Play with contrib/gtwvg/tests/demowvg.prg, open many browsers,
      Active-X controls, get windows and so on, every window will 
      behave as a gentleman.

  * harbour/contrib/gtwvg/wvgcrt.prg
    ! Fixed ::resize method.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! Fine tuned to respect above fixes.

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/2008-11-15-23%3A01-UTC-0800-Pritpal-Bedi-%28pritpa
l%40vouchcac.com%29-tp20522969p20522969.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From druzus at acn.waw.pl  Sun Nov 16 13:19:16 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov 16 13:18:06 2008
Subject: [Harbour] GT without Text Bufer : Feature Request
In-Reply-To: <20526548.post@talk.nabble.com>
References: <20526548.post@talk.nabble.com>
Message-ID: <20081116181916.GA29734@34-mo7-2.acn.waw.pl>

On Sun, 16 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal.

> Can we have a feature in current GT modal where
> no text buffer is implemented, I mean a pure windows
> window but through the GT.

I do not understand.
If you want to ignore text buffer then simply do not update data
screen using its data.

> I am trying to achieve it by other means but 
> seems if this feature is present in current GT modal
> it will make my life easier.

I have not idea what you are trying to do and what you need.
If you want to replace default text buffer with your own f.e.
screen image then simply overload GT drawing method.
F.e. in GTCGI only console output is accepted and is directly
redirected to stdout and any other output which change screen
buffer is ignored. See HB_GT_CGI_RAWOUTPUT macro in GTCGI.
By default it's enabled.
In GTCTW all updates are redirected to private screen buffers
bound with each window. Because all screen buffer access/assign
operations are done using PUTCHAR/GETCHAR/GETSCRCHAR then it's
enough to overload only this three methods. You can also overload
PUTSCRCHAR if you plan to use it.
You can create your own version of this function and write to
your own screen buffer, f.e. to your image. If you want then
you can also call their super methods. In such case you can
benfit from automatic marking regions which should be updated.
Otherwise you will have to make it yourself.
Later you can add other extensions. F.e. You can overload
BOX* messages and draw boxing in your screen image directly
instead of using character glyphs.
You can also overload RECTSIZE(), SAVE() and REST() method and
operate on you screen image buffer (bitmap) instead of characters.
You can also make any other things with current GT model because
now each element can be overloaded. I hope it will be kept in the
future and number of extensions like pNotifierBlock which causes
that directly upper level GT code directly operate on core GT members
so it cannot be overloaded will not growing up. Not it's the only
one such element. Rest you can overload in any way you want.

best regards,
Przemek
From harbour.01 at syenar.hu  Sun Nov 16 14:24:22 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov 16 14:24:29 2008
Subject: [Harbour] 2008-11-16 07:29 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20526428.post@talk.nabble.com>
References: <20526381.post@talk.nabble.com> <20526428.post@talk.nabble.com>
Message-ID: <4DDEDC38-F95E-4F44-9A78-2B5A7AA061CA@syenar.hu>

Hi Pritpal,

> NOTE: Borders will be visible when resizing as is as it cannot be  
> controlled
> programatically unless the solution I had offered very begining ( by
> changing
> windows visual effects progrmatically ).
>
> Once the user releases the mouse button the window is refreshed. It is
> exactly like if drag effects are turned off except for that it  
> displays the
> border.
>
> But certainly continuous repainting is reduced to a single call.

After you change it got a little bit better, but now
I'm getting black stripes on a grey background, and the
screen content gets cleared when mousing over it. Again
I think it's wrong in two ways, a) from a UI usability POV,
as the user have to do trial and error to get the desired size.
(press mouse button -> start moving it around -> release
button -> see the result (which is not the exact rectangle
set by him for 99% of cases) -> start over), b) the artifacts,
which ruins the "quality feel".

So, problem is that this effectively removed interactivity
feel, and the user will have no idea how the resized
window will look like. If we cannot do anything smooth
looking I think the current GTWVT solution is - if not
perfect, but - fine.

Much more important would be to remove unnecessary _internal_
resize, font size, etc API calls made by GTWV*, when there
is no _actual user interaction_, like startup, or simple
resize initiated by app code maybe. I guess this is what
Przemek was also pointing at. The other, even more important
problem is WinCE incompatibility.

[ Many Win API calls while resizing is not a big problem,
because it doesn't make it particularly slow, it's
a relatively rare event anyway and always initiated by the
user, while he's not doing anything else naturally, and it
works perfectly fine through a remote terminal connection
already. ]

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov 16 14:29:37 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov 16 14:29:45 2008
Subject: [Harbour] 2008-11-16 07:29 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20526428.post@talk.nabble.com>
References: <20526381.post@talk.nabble.com> <20526428.post@talk.nabble.com>
Message-ID: <99CC5483-3F51-478D-A4D3-D674AD233B79@syenar.hu>

Hi Pritpal,

BTW, in my previous demowvg test today, I've just noticed that
an hb_out.log got generated, maybe you're interested, see it
attached.

Brgds,
Viktor

-------------- next part --------------
A non-text attachment was scrubbed...
Name: hb_out.log
Type: application/octet-stream
Size: 11682 bytes
Desc: not available
Url : http://lists.harbour-project.org/pipermail/harbour/attachments/20081116/95a705b3/hb_out-0001.obj
-------------- next part --------------


On 2008.11.16., at 16:38, Pritpal Bedi wrote:

>
> Viktor
>
>
> Pritpal Bedi wrote:
>>
>> 2008-11-16 07:29 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>>  * harbour/contrib/gtwvg/gtwvg.c
>>  * harbour/contrib/gtwvg/gtwvg.h
>>    ! Further tuned up the resizing behavior. Viktor please check.
>>
>
> NOTE: Borders will be visible when resizing as is as it cannot be  
> controlled
> programatically unless the solution I had offered very begining ( by
> changing
> windows visual effects progrmatically ).
>
> Once the user releases the mouse button the window is refreshed. It is
> exactly like if drag effects are turned off except for that it  
> displays the
> border.
>
> But certainly continuous repainting is reduced to a single call.
>
> Regards
> Pritpal Bedi
>
> -- 
> View this message in context: http://www.nabble.com/2008-11-16-07%3A29-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20526381p20526428.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From mbelgrano at deltain.it  Sun Nov 16 14:58:02 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Sun Nov 16 14:59:07 2008
Subject: [Harbour] gtwvg and way for create dialog box 
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1A4@SRV02.deltain.net>

Now gtwvg have two way for create dialog box : WvgCrt AND
Wvt_MakeDlgTemplate
Is possible integrate in one class?
Will Be available a method like Ocrt:AddDlgItem()?
Wich Wvt_* function be painted and updated only setting a refresh array
for getlist (WvtSetBlocks)
Wich are immediately  visible  like real compoment?

This sample of different way for create a dialog BOX
   oCrt := WvgCrt():New( , , { 4,8 }, { 12,49 }, , .T. )
   oCrt:title := 'Information!'
   oCom := WvgActiveXControl():New( oCrt, , { 0,0 }, { 200,200 }, , .t.
)
   oCrt:create()
   oCrt:show()
   oCrt:Destroy()

   aDlg := Wvt_MakeDlgTemplate( 1, 2, 15, 40, {0,0,0,0},  ;
                     ltrim( str( nInfo,10,0 ) ) + " - Modeless Dialog",
nStyle )
   Wvt_AddDlgItem(..)
   Wvt_CreateDialog(..)


Massimo Belgrano

From mbelgrano at deltain.it  Sun Nov 16 15:19:31 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Sun Nov 16 15:20:32 2008
Subject: [Harbour] 2008-11-16 07:29 UTC-0800 Pritpal
	Bedi(pritpal@vouchcac.com)
In-Reply-To: <20526381.post@talk.nabble.com>
References: <20526381.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1A5@SRV02.deltain.net>

Little problem of demowvg 
In DemoWvg 
resize fist screen ("Harbour simulated gui")  to be more big (height and
width)
launch from menu "vwt*classes dialog one" 
form is show incomplete 
I have Tested with bcc
Imo when logical windows is more small that phisicall require a better
management (vertical & orizontal scroll bar)

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Sunday, November 16, 2008 4:32 PM
To: harbour@harbour-project.org
Subject: [Harbour] 2008-11-16 07:29 UTC-0800 Pritpal
Bedi(pritpal@vouchcac.com)


2008-11-16 07:29 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
  * harbour/contrib/gtwvg/gtwvg.h
    ! Further tuned up the resizing behavior. Viktor please check.

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/2008-11-16-07%3A29-UTC-0800-Pritpal-Bedi-%28pritpa
l%40vouchcac.com%29-tp20526381p20526381.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From bedipritpal at hotmail.com  Sun Nov 16 16:07:03 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 16:07:07 2008
Subject: [Harbour] 2008-11-16 13:00 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20530038.post@talk.nabble.com>


2008-11-16 13:00 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    ! Slight fix in WM_PAINT message.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    + Added menu option to open a GET session in GTWVT console.
      ; I was studying to call multiple GTs ( GTWVG and GTWVT ) same time.
        It can be and it also opens up a lot more possibilities.
    
      ; Thanks Przemek for superb basic engine.

    + Added RMChart Active-X manipulation. It is free OCX and 
      can be downloaded from http://www.rmchart.com/
      ; Select from the <Active-X Controls> option.
        Press F11 repeatedly to see 6 different charts.
        Press F12 to change some attributes.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-16-13%3A00-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20530038p20530038.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 16 16:58:02 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 16:58:05 2008
Subject: [Harbour] gtwvg and way for create dialog box
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F1A4@SRV02.deltain.net>
References: <AFB948164110ED43B5EB849E8DEEF03815F1A4@SRV02.deltain.net>
Message-ID: <20530602.post@talk.nabble.com>


Hi


Massimo Belgrano-3 wrote:
> 
> Now gtwvg have two way for create dialog box : WvgCrt AND
> Wvt_MakeDlgTemplate
> Is possible integrate in one class?
> Will Be available a method like Ocrt:AddDlgItem()?
> Wich Wvt_* function be painted and updated only setting a refresh array
> for getlist (WvtSetBlocks)
> Wich are immediately  visible  like real compoment?
> 

Wvt_DialogBox() is a separate tool and is very useful as such.
I am trying to achieve the same functionality in WvgDialog(), 
Xbase++ compatible class. All efforts will be routed to this 
class framework instead of touching the existing components.

Getlist and SetBlocks() needs to reside in GT itself, I agree, but so 
far I am not been able to get a clue how I can do so. May be in future, 
who knows.

Regards
Pritpal Bedi



-- 
View this message in context: http://www.nabble.com/gtwvg-and-way-for-create-dialog-box-tp20529933p20530602.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sun Nov 16 17:08:43 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov 16 17:08:40 2008
Subject: [Harbour] 2008-11-16 23:05 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94837$Blat.v2.6.2$e3a02336$12d820483b3e@127.0.0.1>

2008-11-16 23:05 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * contrib/gtwvg/wvgsink.c
    * Minor cleanup to hb_strncat() (it's best to use 
      'sizeof( target ) - 1' for size, if target is a char 
      array. The buffer was off by one on the good direction.)

  * ChangeLog
    ! ChangeLog was again saved as Unicode. Please guys TURN 
      THIS OFF for good.
--
Brgds,
Viktor

From bedipritpal at hotmail.com  Sun Nov 16 17:19:05 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 17:19:09 2008
Subject: [Harbour] 2008-11-15 23:59 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <6B506162-1FCA-44B3-9051-F4EBFC1DAABA@syenar.hu>
References: <20523230.post@talk.nabble.com>
	<6B506162-1FCA-44B3-9051-F4EBFC1DAABA@syenar.hu>
Message-ID: <20530798.post@talk.nabble.com>


Hi Viktor

>After just a quick test (BCC -mt mode), I'm getting a "truncated"
>window when choosing "dialog one". 

Yes, and I am looking into what went wrong.

<<<
Now background updates seem
to be better, but there is a great amount of redraw flicker
on some of the control (the icons at the bottom) on the background
window, while moving another window in front of it, and there are
visible some white spots (rects) not refreshed [Update: I couldn't
repeat this for a second time, because I forgot how I got there].
One of the dialog windows (open new dialog, resize, press ESC),
was scaled like a bitmap. BTW, the bottom icons are flickering just
by moving across the GET controls with a TAB.
>>> 

It appears WvtButton() class in WvgClass.prg has gone weired.
I will be onto that soon.

<<<
It's generally very confusing to know where an ESC should be
used to navigate, or rather the mouse, and it's still very
difficult to know if a menu will open a new windows, or just
modify the current one. 
>>>

So far I never concentrated on navigational details.
Hopefully within this week. demowvg.prg should be a modal
for anybody who is looking for documentation.

<<<
All these break the usuall GUI paradigm
which I'd expect from such app. F.e. you can only move out
from the One/Two/Three.. box with ESC, not with mouse or TAB.
>>>

One/Two... box is simply achoice() and a modal loop, may be
we need more message manipulation for it.

<<<
There are other windows however, when ESC doesn't work and
you have to click OK. The icons at the bottom also either
work or not, I couldn't find the logic, or any hint based on
their color (green = inactive?).
>>>

Active-X windows do not work with ESC except only those
which pass key events back to the parent window procedure.
You need to click on task-bar and then press ESC.

WvtButton() class has been screwed up, I do not remember
when did I changed fataly. It was working initially.

<<<
This overall causes there I'm never sure "where am I" in the
menu, how to get there, how did I get there, and how to exit
from there. This explains why it's so difficult to report a
problem in a repeatable way. I've also accidentally closed
the app like 5 times.
>>>

This is always a problem with windows protocol. You only know
it where you have focus. It is a general behavior.

When main appln window is in focus and you press <ESC> appln quits.

<<<
Resize looks quite strange to me now, and AFAIR we've been
there once already. Now while resizing, the borders with
various size are remaining visible while you move your mouse
(while the window content is flickering due to refresh, but
it doesn't change the size, just the position below the menu,
if there is a menu), which first of all give a non-interactive
feel to it (like with "visible while resize/move" Windows
setting turned off), plus looks quite unfinished. [ So I'd
opt to stay with current resize behavior for GTWVT. ]
>>>

I was bargaining a trade off in between previou vs current behavior.
Both have flaws. The best solution is to change the visual properties 
in Windows which I have documented for my applns. You are correct
in your assertion. BTW this can be controlled with a switch in pWVT,
what do you think?

<<<
Most ActiveX windows don't work here, and it's not possible
to close those. (IE and DHTML works, the rest don't, I don't
have Excel, so that one is alright, albeit this should IMO
be handled more gracefully.)
>>>

Yes, naturally. We cannot provide OCXs so it will remain an issue.
I will look into how it can be handled properly. I will request Andy
to provide more info on the subject.

<<<
Overall the refresh looks now indeed better, with some price
paid by extra flickering.
>>>

"extra flickering" ? In refresh context what do you mean by it?

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/2008-11-15-23%3A59-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20523230p20530798.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 16 17:36:09 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 16 17:36:12 2008
Subject: [Harbour] GT without Text Bufer : Feature Request
In-Reply-To: <20081116181916.GA29734@34-mo7-2.acn.waw.pl>
References: <20526548.post@talk.nabble.com>
	<20081116181916.GA29734@34-mo7-2.acn.waw.pl>
Message-ID: <20530997.post@talk.nabble.com>


Hi Przemek

<<<
I do not understand.
If you want to ignore text buffer then simply do not update data
screen using its data.
>>>

I am controlling it as you say by pWVT->bDeferPaint member. But I 
was looking beyond. See below.

<<<
I have not idea what you are trying to do and what you need.
If you want to replace default text buffer with your own f.e.
screen image then simply overload GT drawing method.
F.e. in GTCGI only console output is accepted and is directly
redirected to stdout and any other output which change screen
buffer is ignored. See HB_GT_CGI_RAWOUTPUT macro in GTCGI.
By default it's enabled.
>>>

Now I get an idea how to achieve it. I may need more help, though...

<<<
In GTCTW all updates are redirected to private screen buffers
bound with each window. Because all screen buffer access/assign
operations are done using PUTCHAR/GETCHAR/GETSCRCHAR then it's
enough to overload only this three methods. You can also overload
PUTSCRCHAR if you plan to use it.
>>>

Exactly this is what I want.
Can you show few lines of code how I can inherit from GTWVG
with only one method overloaded in new GT ( say 'WGU' )?
It will solve all my issues. I need just the begining.

<<<
You can create your own version of this function and write to
your own screen buffer, f.e. to your image. If you want then
you can also call their super methods. In such case you can
benfit from automatic marking regions which should be updated.
Otherwise you will have to make it yourself.
Later you can add other extensions. F.e. You can overload
BOX* messages and draw boxing in your screen image directly
instead of using character glyphs.
You can also overload RECTSIZE(), SAVE() and REST() method and
operate on you screen image buffer (bitmap) instead of characters.
You can also make any other things with current GT model because
now each element can be overloaded. 
>>>

Exactly, please put me on the runway.

<<<
I hope it will be kept in the
future and number of extensions like pNotifierBlock which causes
that directly upper level GT code directly operate on core GT members
so it cannot be overloaded will not growing up. Not it's the only
one such element. Rest you can overload in any way you want.
>>>

If possible, notifier block can be passed to propritory GTs with 
one more member in pWVT, if it hasto be done, let us do it right now.
I wish code GT layer independant of these dependancies.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/GT-without-Text-Bufer-%3A-Feature-Request-tp20526548p20530997.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Sun Nov 16 18:45:03 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov 16 18:45:11 2008
Subject: [Harbour] 2008-11-15 23:59 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20530798.post@talk.nabble.com>
References: <20523230.post@talk.nabble.com>
	<6B506162-1FCA-44B3-9051-F4EBFC1DAABA@syenar.hu>
	<20530798.post@talk.nabble.com>
Message-ID: <A39E90F3-7EEE-4E36-AC88-89C3CEA04F8A@syenar.hu>

Hi Pritpal,

> Active-X windows do not work with ESC except only those
> which pass key events back to the parent window procedure.
> You need to click on task-bar and then press ESC.

Weird. Anyhow I've found out since, that Alt+F4 works
on those stuck windows. But it's yet another combination
which is a bit confusing, I think a user initiated GUI window
should always be closable by close button and Alt+F4, optionally
some custom keys (ESC) or custom buttons (preferably Close/Cancel/OK).
But that's a bit off topic and probably I'm confused by the
mixed GUI/CUI concept.

> This is always a problem with windows protocol. You only know
> it where you have focus. It is a general behavior.
>
> When main appln window is in focus and you press <ESC> appln quits.

Question is how to recognize the main window :)

> I was bargaining a trade off in between previou vs current behavior.
> Both have flaws. The best solution is to change the visual properties
> in Windows which I have documented for my applns. You are correct
> in your assertion. BTW this can be controlled with a switch in pWVT,
> what do you think?

No, I think we should have one way done right, instead of two
not really right. This one (for WVT) should be the current
one IMO, because it's superior in multiple ways. So far I cannot
see why the new method is any better, it's just replaced
some tolerable flickering with other artifacts and less
usability. I imagine the fully proper solution would be
something like those snapping move/resize borders of toolbars
in Visual Studio IDE for example. Dunno how they did it.

> Overall the refresh looks now indeed better, with some price
> paid by extra flickering.
>>>>
>
> "extra flickering" ? In refresh context what do you mean by it?

Some controls (notably the toolbar icons - like shrink/expand)
maybe some others, when doing certain window movements above it.
Can't give you specific keys to reproduce, cause they were visible
after randomly clicking all over the demo. Maybe some screen
elements are redrawn in a fashion that the whole control area
is cleared then image/text redrawn, but I'm not really into Windows
programming, so maybe it's something else.

Brgds,
Viktor

From harbour.01 at syenar.hu  Sun Nov 16 18:53:35 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Sun Nov 16 18:53:42 2008
Subject: [Harbour] 2008-11-16 15:32 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081116143253.GA25585@34-mo7-2.acn.waw.pl>
References: <20081116143253.GA25585@34-mo7-2.acn.waw.pl>
Message-ID: <F7727909-FD3E-4834-B49B-650351A9D4F2@syenar.hu>

Hi Przemek and all,

I haven't yet found out how to switch between
different GCC versions in OS X + XCode 3.
XCode 3 is shipped with GCC 4.0.1 and 4.2.1,
but only the former (the default) was usable
so far.

[ Maybe "switching" isn't possible, but one needs
to use difference 'gcc' executable name... ? ]

Anyone with better success?

Brgds,
Viktor

On 2008.11.16., at 15:32, Przemyslaw Czerpak wrote:

> 2008-11-16 15:32 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>  * harbour/include/hbatomic.h
>    + added support for built in GCC atomic functions: __sync_*()
>      They are present in GCC >= 4.1 if given CPU supports them. For
>      x86 CPU family the ones we use need at least i486 CPU. Please  
> make
>      tests with other CPUs like PPC. If given platform/CPU does not  
> support
>      them then GCC generate call to function __sync_*_<N>() where <N>
>      is size of given type used in atomic operation instead of storing
>      inlined assembler code.
>
> best regards
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From bedipritpal at hotmail.com  Mon Nov 17 02:19:24 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Mon Nov 17 02:19:27 2008
Subject: [Harbour] GT without Text Bufer : Feature Request
In-Reply-To: <20530997.post@talk.nabble.com>
References: <20526548.post@talk.nabble.com>
	<20081116181916.GA29734@34-mo7-2.acn.waw.pl>
	<20530997.post@talk.nabble.com>
Message-ID: <20534771.post@talk.nabble.com>


Hi Przemek

Please ignore this request. I have discovered how to.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/GT-without-Text-Bufer-%3A-Feature-Request-tp20526548p20534771.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Mon Nov 17 03:14:21 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Mon Nov 17 03:14:24 2008
Subject: [Harbour] 2008-11-16 23:22 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20535315.post@talk.nabble.com>


2008-11-16 23:22 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    ! Resizing: some recent changes reverted back.
    ; TODO: reversal in GTWVT also. It breaks some pre-initialization
issues.

  * harbour/contrib/gtwvg/wvgax.prg
    ! Better detection if COM object fails to be created.

  + harbour/contrib/gtwvg/wvggui.c
  + harbour/contrib/gtwvg/wvggui.h
    + Initial commit of pure GUI GT based on GTWVG named WGU.
      ; Subject to heavy changes onwards.
        WGU will become the basis of WvgDialog() plus inherited 
        sub-classes.

  * harbour/contrib/gtwvg/makefile
  * harbour/contrib/gtwvg/common.mak
    + Added new files.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    + Now <Dialog One> is working properly. 
      It now opens in new thread if it is odd and as usual if even.
    + <Modeless Dialogs><Experiment #1>
      ! Just to have experiments on WGU GT.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-16-23%3A22-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20535315p20535315.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From mbelgrano at deltain.it  Mon Nov 17 05:03:31 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 17 05:04:32 2008
Subject: [Harbour] GT without Text Bufer : Feature Request
In-Reply-To: <20534771.post@talk.nabble.com>
References: <20526548.post@talk.nabble.com><20081116181916.GA29734@34-mo7-2.acn.waw.pl><20530997.post@talk.nabble.com>
	<20534771.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1A7@SRV02.deltain.net>

Hi Pritpal 

Can you show few lines of code how I can inherit from GTWVG with only
one method overloaded in new GT ( say 'WGU' )?
Will be usefull for other people that search reply to same question

Regards
Belgrano Massimo

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Monday, November 17, 2008 8:19 AM
To: harbour@harbour-project.org
Subject: Re: [Harbour] GT without Text Bufer : Feature Request


Hi Przemek

Please ignore this request. I have discovered how to.

Regards
Pritpal Bedi

-- 
View this message in context:
http://www.nabble.com/GT-without-Text-Bufer-%3A-Feature-Request-tp205265
48p20534771.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From mbelgrano at deltain.it  Mon Nov 17 06:09:24 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 17 06:10:32 2008
Subject: [Harbour] 2008-11-16 23:22 UTC-0800 Pritpal
	Bedi(pritpal@vouchcac.com)
In-Reply-To: <20535315.post@talk.nabble.com>
References: <20535315.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>

A little suggestion for harbour/contrib/gtwvg/tests/demowvg.prg
<Dialog One> 
Have problem after resize more big mail screen (why resize main screen
conditions child screen)
In Two browsing you can use mouse wheel to scroll record  and not click
for select record as usual in gui

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/2008-11-16-23%3A22-UTC-0800-Pritpal-Bedi-%28pritpa
l%40vouchcac.com%29-tp20535315p20535315.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From mbelgrano at deltain.it  Mon Nov 17 09:20:34 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 17 09:21:39 2008
Subject: [Harbour] FW: [Harbour-users] Mac OS 10.5.5 "dyld: Library not
	loaded:libharbour.1.dylib"
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1AB@SRV02.deltain.net>

Will one of mac OS user give a reply on user list?

-----Original Message-----
From: harbour-users-bounces@harbour-project.org
[mailto:harbour-users-bounces@harbour-project.org] On Behalf Of
harbour-users@harbour-project.org
Sent: Friday, November 14, 2008 2:08 PM
To: harbour-users@harbour-project.org
Subject: [Harbour-users] Mac OS 10.5.5 "dyld: Library not
loaded:libharbour.1.dylib"

Hello,

I have just downloaded the Mac OS binary 1.0.1.

After I copied the files to /usr/ and /private, I tried running a  
sample program:

jan$ hbrun helloworld.prg

and got the following error:
dyld: Library not loaded: libharbour.1.dylib
   Referenced from: /usr/local/bin/hbrun
   Reason: image not found
Trace/BPT trap

Is there anything else I have to do to load the library?

Thanks a lot for your help

Jan
_______________________________________________
Harbour-users mailing list
Harbour-users@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour-users
From mbelgrano at deltain.it  Mon Nov 17 09:37:59 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 17 09:39:17 2008
Subject: [Harbour] news regarding letodb
In-Reply-To: <1435518144.20080326194608@belacy.belgorod.su>
References: <1435518144.20080326194608@belacy.belgorod.su>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1AC@SRV02.deltain.net>

Have somebody updated news regarding letodb?
Kresin who is founders for letodb and hwgui seem in last period a little
inactive on his project

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Alexander
S.Kresin
Sent: Wednesday, March 26, 2008 5:46 PM
To: Harbour Project Main Developer List.
Subject: [Harbour] Leto DB build 5 has been released

All basic RDD functionality has been implemented. Relations,
orderListAdd, orderListClear has been added.

The server works im multithread mode now. First thread listen sockets,
accept connections and answers to commands, which doesn't demand
database access and Harbour's VM/stack functions.
The second answers to all other commands.

DBFNTX support has been added. The driver, which will be used to open a
table ( DBFCDX or DBFNTX ) is determined
 at server side from the letodb.ini - see readme.txt for details.


Regards,
 Alexander
http://kresin.belgorod.su

From mbelgrano at deltain.it  Mon Nov 17 11:09:26 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 17 11:10:31 2008
Subject: [Harbour] 2008-11-16 23:22 UTC-0800
	PritpalBedi(pritpal@vouchcac.com)
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>

Another suggestion
Att to demowvg http:address where download component active x

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Massimo
Belgrano
Sent: Monday, November 17, 2008 12:09 PM
To: Harbour Project Main Developer List.
Subject: RE: [Harbour] 2008-11-16 23:22 UTC-0800
PritpalBedi(pritpal@vouchcac.com)

A little suggestion for harbour/contrib/gtwvg/tests/demowvg.prg
<Dialog One> 
Have problem after resize more big mail screen (why resize main screen
conditions child screen)
In Two browsing you can use mouse wheel to scroll record  and not click
for select record as usual in gui


From mbelgrano at deltain.it  Mon Nov 17 13:38:05 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 17 13:39:12 2008
Subject: [Harbour] FW: [Harbour-users] Filestats of xHarbour
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1B3@SRV02.deltain.net>

Harbour have not ported filestat function ?

-----Original Message-----
From: harbour-users-bounces@harbour-project.org
[mailto:harbour-users-bounces@harbour-project.org] On Behalf Of
harbour-users@harbour-project.org
Sent: Monday, November 17, 2008 6:18 PM
To: harbour-users@harbour-project.org
Subject: [Harbour-users] Filestats of xHarbour

Hi!
What is equivalent function ?

As subject.

TIA,
Itamar M. Lins Jr.

xHarbour Language Reference Guide (Version 1.1) - FileStats()FileStats()

Retrieves file information for a single file.
Syntax

FileStats( <cFileName>    , ;
          [@<cFileAttr>]  , ;
          [@<nFileSize>]  , ;
          [@<dCreateDate>], ;
          [@<nCreateTime>], ;
          [@<dChangeDate>], ;
          [@<nChangeTime>]  ) --> lSuccess

Arguments *<cFileName>* This is a character string holding the name of
the
file to query. It must include path and file extension. If the path is
omitted from *<cFileName>*, the file is searched in the current
directory. @
*<cFileAttr>* If specified, *<cFileAttr>* must be passed by reference.
It
receives the file attributes of the file as a character string. @*
<nFileSize>* If specified, *<cFileSize>* must be passed by reference. It
receives the file size of the file as a numeric value. @*<dCreateDate>*
If
specified, *<dCreateDate>* must be passed by reference. It receives the
creation date of the file as a date value. @*<nCreateTime>* If
specified, *
<nCreateTime>* must be passed by reference. It receives the creation
time of
the file as a numeric value. The unit is "seconds elapsed since
midnight".
Use function TString() <Tstring_f.en.html> to convert this value to a
"hh:mm:ss" formatted time string. @*<dChangeDate>* If specified, *
<dChangeDate>* must be passed by reference. It receives the last change
date
of the file as a date value. @*<nChangeTime>* If specified,
*<nChangeTime>*must be passed by reference. It receives the creation
time of the file as a
numeric value. The unit is "seconds elapsed since midnight". Return

The return value is .T. (true) when the information on the file
*<cFileName>
* could be retrieved, otherwise .F. (false) is returned.
Description

Function FileStats() retrieves statistical information about a single
file.
It is more efficient than the Directory() <Directory_f.en.html> function
which retrieves the same information for a group of files and stores
them in
an array. FileStats(), in contrast, allows for "picking" desired
information
about a single file by passing the according parameters by reference to
the
function.
Info

  See also: Directory() <Directory_f.en.html>, FCreate()
<Fcreate_f.en.html>,
HB_FSize() <Hb_fsize_f.en.html> Category: File
functions<../../Grp_file_functions.en.html>, Low
level file functions <../../Grp_low_level_file_functions.en.html> ,
xHarbour
extensions <../../Grp_xharbour_extensions.en.html> Source:
rtl\filestat.c
LIB: xhb.lib DLL: xhbdll.dll
Example

// The example shows how to retrieve statistical information about
// a single file, and how to convert the time values from Seconds
// to a hh:mm:ss time formatted string.

   PROCEDURE Main
      LOCAL cFileName := "FILESTATS.PRG"
      LOCAL cFileAttr  , nFileSize
      LOCAL dCreateDate, nCreateTime
      LOCAL dChangeDate, nChangeTime

      ? FileStats( cFileName, @cFileAttr  , @nFileSize  , ;
                              @dCreateDate, @nCreateTime, ;
                              @dChangeDate, @nChangeTime  )

      ? "File statistiscs"
      ? "File Name :", cFileName
      ? "Attributes:", cFileAttr
      ? "File Size :", nFileSize
      ? "Created   :", dCreateDate, TString( nCreateTime )
      ? "Changed   :", dChangeDate, TSTring( nChangeTime )
   RETURN
_______________________________________________
Harbour-users mailing list
Harbour-users@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour-users
From massimo.belgrano at gmail.com  Mon Nov 17 13:59:23 2008
From: massimo.belgrano at gmail.com (Massimo Belgrano)
Date: Mon Nov 17 13:59:45 2008
Subject: [Harbour] Are this information applicable also to harbour?
Message-ID: <loom.20081117T185543-850@post.gmane.org>

Are this information applicable also to harbour?
ftp://ftp.alaska-software.com/documents/oop-6-rules.pdf

?Class? is an abstract term. The Xbase++ runtime knows class object and instance
objects. Class objects are created at the first time the class
function is executed, subsequent class function execution returns the same class
object.
To ?free? a class object the function ClassDestroy() can be used. The Xbase++
runtime has a process-global hashtable used to associate class objects with
class names.
ClassDestroy() simply removes the name<->class object
association. However the class object is not freed until the last
instance object of this class is destroyed.
:New() is the default constructor to create instance objects. Instance objects
are always created by class objects.
Therefore class objects are sometimes called ?Object
Factories?. You can have an unlimited amount instance objects
of the same class. In the following the term object is used to
describe instance objects.

Note: Class objects which reference code or data of a DLL lead to sideeffects
such as that the DLL is not unloadable until all objects of the class are
destroyed and the class object itself has been destroyed. Until this
precondition is met the DLL can not be unloaded.

All class are dynamyc
There is no difference between a class object created from a class function A()
generated by the
compiler and a class object created with
CreateClass() by a Function A().
Runtime-classes can replace compile-time classes
and vice versa. Any class can be replaced by
another class with the same name. That?s why
classes are dynamic.
The FREEZE attribute at CLASS declaration
prohibits the implicit replacement of this class.
FREEZE can be used to protect class
implementations from being replaced implicitly.
The FINAL attribute prohibits subclassing of this
class. The behaviour of FINAL classes can therefore be no longer changed -It is
FINAL

Consider the code on the right side:
Executing the method :Bark() on
objects of Class A executes method
:Print() at Class A. Executing the
method :Bark() on objects of Class B
executes the method :Print()
implemented at Class B.
This behaviour is called virtual override
because each method implementation
in a subclass does override a possible
implementation of its superclasses
- Overriding of METHOD is always a replacement
method replacement totally overwrites the
method of its base classes during execution. That is the code in the base class
is never executed when instances of subclasses are manipulated. The
Class B and the method :Print() is an example of
method replacement.
Refinement can be achieved as outlined in Class C. To do that, we must be able
to execute the
superclass implementation. The SUPER statement
is used to refer to the direct superclass
implementation. The SUPER statement executes the superclass implementation of
the current
method and passes all parameters passed to this
method. SUPER:Print() can be used as an
alternative to control method name and
parameters passed.
Note: You can write SELF:A:

Consider the code on the right side:
Executing the method :PrintA() on
objects of Class B prints ?Value from A?,
while executing the method :PrintB()
shows ?Value from B?.
This behaviour is called hiding in OO
terms. It simple means that redefining
a variable in a subclass hides the
variable of its superclass. It therefore
introduces the variable.

CLASS A
EXPORTED:
VAR Lastname
INLINE METHOD Init()
::LastName:= ?ValuefromA?
RETURN
INLINE METHOD PrintA()
? ::LastName
RETURN
ENDCLASS
CLASS B FROM A
EXPORTED:
VAR Lastname
INLINE METHOD Init()
::A:Init()
::LastName:= ?ValuefromB?
RETURN
INLINE METHOD PrintB()
? ::LastName
RETURN
ENDCLASS


From harbour.01 at syenar.hu  Mon Nov 17 14:29:37 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 17 14:29:46 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
Message-ID: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>

To the OSX problem (which doesn't appeared on my mailbox,
only the web archive):

just copy the missing file from /lib to next to the executable,
and always use -static when using hbmk script.

BTW, I think we should rename the dynamic builds of our
supplied binaries to hbrun-dyn and hbtest-dyn, similarly
to Windows, and leave hbrun and hbtest to run standalone.
I mean this for both Linux and OS X, as the benefits of
these being built with dynamic libs is rather small, but
it can be a major PITA when someone is trying to run them
without installing Harbour (say they want to play with it
only, and/or they have multiple versions installed). For
OS X I'd also change the hbmk default to '-static'.

Anyone is welcome with more opinions on above.

Brgds,
Viktor

On 2008.11.17., at 17:09, Massimo Belgrano wrote:

> Another suggestion
> Att to demowvg http:address where download component active x
>
> -----Original Message-----
> From: harbour-bounces@harbour-project.org
> [mailto:harbour-bounces@harbour-project.org] On Behalf Of Massimo
> Belgrano
> Sent: Monday, November 17, 2008 12:09 PM
> To: Harbour Project Main Developer List.
> Subject: RE: [Harbour] 2008-11-16 23:22 UTC-0800
> PritpalBedi(pritpal@vouchcac.com)
>
> A little suggestion for harbour/contrib/gtwvg/tests/demowvg.prg
> <Dialog One>
> Have problem after resize more big mail screen (why resize main screen
> conditions child screen)
> In Two browsing you can use mouse wheel to scroll record  and not  
> click
> for select record as usual in gui
>
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at acn.waw.pl  Mon Nov 17 16:54:08 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 17 16:52:57 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
Message-ID: <20081117215408.GA2782@34-mo7-2.acn.waw.pl>

On Mon, 17 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> just copy the missing file from /lib to next to the executable,
> and always use -static when using hbmk script.

Why??? In all *nixes dynamic linking is a base and static
is sth seldom used for some specific reasons.

If there is sth wrong with default harbour shared library name
or location in harbour-*.tar.gz then of course it should be fixed.

> BTW, I think we should rename the dynamic builds of our
> supplied binaries to hbrun-dyn and hbtest-dyn, similarly
> to Windows, and leave hbrun and hbtest to run standalone.

Please do not make anything like that. If you want to unify
the names then I suggest to remove static binaries from Windows
builds or call them as *-static.exe.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Nov 17 18:45:33 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 17 18:45:46 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081117215408.GA2782@34-mo7-2.acn.waw.pl>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
Message-ID: <ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>

Hi Przemek,

>> just copy the missing file from /lib to next to the executable,
>> and always use -static when using hbmk script.
>
> Why??? In all *nixes dynamic linking is a base and static
> is sth seldom used for some specific reasons.

Because in OS X such experience is simply unprecedented
in the user world, and because it gives _no_ advantage
_at all_ on this platform, which is 99.99% aimed for desktop
users. At the same time it makes the binaries simply unusable,
and broken out of the box. So, I'm not exactly sure this is what
users expect on this platform, at least I haven't heard of
any such Mac users in the last 5 years. In fact 99% of them
doesn't want to or have to know that there is such thing
as a .dylib, and I'm pretty sure they won't want to learn just
to run a Harbour based app.

And I believe it's completely wrong to require installation,
sudo/admin rights and all that crap to just make it possible
to _try Harbour_, or run a simple "hello world", or god
forbid have 2 versions installed in parallel (which is not
something exceptional for a developer). Let alone work with
a _portable_ environment. No, we rather save 1.5MB on disk
(or we target server-side users? hard to tell.).

Pls tell some advantages this gives, so far you seemed
to have just ignored any points raised in this regard. It'd
be really nice to know the reasons why you insist on this
shared/dynamic/dll thing on all platforms.

Also, what if I'd like to just copy my Harbour devl env to
an USB drive and move it around to another machine? This isn't
possible with Linux either, thanks to the shared feature, and
install-time hard wired lib path tricks.

> If there is sth wrong with default harbour shared library name
> or location in harbour-*.tar.gz then of course it should be fixed.

There is something definitely wrong, since it doesn't work,
and it never did.

>> BTW, I think we should rename the dynamic builds of our
>> supplied binaries to hbrun-dyn and hbtest-dyn, similarly
>> to Windows, and leave hbrun and hbtest to run standalone.
>
> Please do not make anything like that. If you want to unify
> the names then I suggest to remove static binaries from Windows
> builds or call them as *-static.exe.

Have you ever seen such thing on Windows? BTW, I haven't
seen too many programs on Windows in the form of *-dll.exe
either. On Windows - nowadays maybe except the Cygwin world
of horror -, apps are expected to just run with as few .dll
dependencies as possible. All of those are just a way to
make programs get screwed on some environments.

All in all OS X and Windows is not Linux, and there is no
point in forcing Linux standards onto them IMO.

Brgds,
Viktor

[ BTW and slightly off, both Linux and Windows could take long
lessons from OS X when it comes to _desktop software_ installation,
those other two simply cannot get it right. I had to fall back
and recommend XP over Linux on Asus EEE PC, because custom software
installation (= Google Earth and say a bittorrent client) is just
way too difficult - if possible - for an average user on Linux.
No wonder it still couldn't catch up. ]

From druzus at acn.waw.pl  Mon Nov 17 19:37:10 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 17 19:35:56 2008
Subject: [Harbour] 2008-11-18 01:36 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081118003710.GA10328@34-mo7-2.acn.waw.pl>

2008-11-18 01:36 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/make_gcc.sh
  * harbour/make_gcc.mak
    ! fixed GCC builds broken by modifications in common.mak

best regards
Przemek
From druzus at acn.waw.pl  Mon Nov 17 20:53:55 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 17 20:52:41 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
Message-ID: <20081118015355.GA20607@34-mo7-2.acn.waw.pl>

On Tue, 18 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Because in OS X such experience is simply unprecedented
> in the user world, and because it gives _no_ advantage
> _at all_ on this platform, which is 99.99% aimed for desktop
> users. At the same time it makes the binaries simply unusable,
> and broken out of the box. So, I'm not exactly sure this is what
> users expect on this platform, at least I haven't heard of
> any such Mac users in the last 5 years. In fact 99% of them
> doesn't want to or have to know that there is such thing
> as a .dylib, and I'm pretty sure they won't want to learn just
> to run a Harbour based app.

I see only one problem. So far no one invest time to create
native MacOSX packages which will put Harbour binaries and
libraries in the OS friendly directories using OS packaging
system.
All of the above what you said is only results of such missing
functionality which you mixed with your personal preferences
from DOS/Windows.

> And I believe it's completely wrong to require installation,
> sudo/admin rights and all that crap to just make it possible
> to _try Harbour_, or run a simple "hello world", or god
> forbid have 2 versions installed in parallel (which is not
> something exceptional for a developer). Let alone work with
> a _portable_ environment. No, we rather save 1.5MB on disk
> (or we target server-side users? hard to tell.).

I believe that any manual installation which does not use
OS support is wrong and farther workarounds only makes it
worse.

> Pls tell some advantages this gives, so far you seemed
> to have just ignored any points raised in this regard. It'd
> be really nice to know the reasons why you insist on this
> shared/dynamic/dll thing on all platforms.

Because shared linking it's a basic requirement in most of
open source OS distributions and without it Harbour will never
be accepted as default package in them. I do not want to create
Harbour binaries to the end of my days and I hope to see in the
future Harbour part of all most popular OS *nixes distribution.
In current days real static linking stop to be possible in
many systems and number of static libraries is systematically
reduced. I do not like it sometimes because still there are
situations when full static binaries are usable but I understand
the reasons. When bug is found in some library then it's enough
to upgrade this library instead of all binaries which may use
this static library.
Shared libraries for Harbour programmers may give yet another feature
when it's not possible to create fully static binaries for some
libraries, f.e. try to create sth like that for xWindow. When final
user application compiled by Harbour is linked with Harbour shared
library then it should be possible to install it with any
other libraries located with system if only Harbour is recompiled
for this OS. I plan to extend it because static linking begins
to be real show stopper in software distribution.
Without it I will have to recompile my applications for user
host. I do not like such improvement ;-)

> Also, what if I'd like to just copy my Harbour devl env to
> an USB drive and move it around to another machine? This isn't
> possible with Linux either, thanks to the shared feature, and
> install-time hard wired lib path tricks.

It's possible. It's enough to read one man page and resolve it
in few possible ways depending on your personal preferences.
And if we drop the ideas with making everything static it will
be much easier because Harbour may become part of default OS
distributions.
Now it's not a problem for users who used to install OS friendly
packages with Harbour binaries like RPM or DEB.

>> If there is sth wrong with default harbour shared library name
>> or location in harbour-*.tar.gz then of course it should be fixed.
> There is something definitely wrong, since it doesn't work,
> and it never did.

???
Viktor if you do not understand sth then its not a reason to
remove it from Harbour.

Lorenzo can you explain how you are able to use shared libraries
in MacOSX.
You and Viktor are using MacOSX. Can you try to create native MacOSX
Harbour packages which will put all libraries in all expected
places?

>> Please do not make anything like that. If you want to unify
>> the names then I suggest to remove static binaries from Windows
>> builds or call them as *-static.exe.
> Have you ever seen such thing on Windows? BTW, I haven't
> seen too many programs on Windows in the form of *-dll.exe
> either. On Windows - nowadays maybe except the Cygwin world
> of horror -, apps are expected to just run with as few .dll
> dependencies as possible. All of those are just a way to
> make programs get screwed on some environments.

I hoped that you will find it as heretic idea for windows world.
I'm finding your ideas in such way.
BTW AFAIR with MSVC is not possible to create static binaries
and they always depend on MSVC CRTL DLLs which has to be install
in compatible version in Windows or you should distribute them
with your programs. Though it's probably problem only for older
Windows which does not have other software linked with this
library installed. And to clarify. In MS-Windows full static
binaries does not exists because MS-Windows API depends on DLLs.

> All in all OS X and Windows is not Linux, and there is no
> point in forcing Linux standards onto them IMO.

It's not a linux standard. I do not know MacOSX desktop and
I used this system only remotely but it's BSD based and everything
what I said above about dependencies and shared libraries is also
true for BSD, OpenSolaris and most of other system which uses
OpenSource code. And of course for big machines with closed source
*nixes but here usually base recompilation on final machine is a
must so it's yet another problem which I will try to resolve extending
HRB format.

> [ BTW and slightly off, both Linux and Windows could take long
> lessons from OS X when it comes to _desktop software_ installation,
> those other two simply cannot get it right. I had to fall back
> and recommend XP over Linux on Asus EEE PC, because custom software
> installation (= Google Earth and say a bittorrent client) is just
> way too difficult - if possible - for an average user on Linux.
> No wonder it still couldn't catch up. ]

Maybe you should look for distribution when such things can be done
in few mouse/keyboard clicks. The problem begins when "average user
on Linux" tries to build and install sth yourself ignoring ready
to use binaries in distribution repositories.
BTW I really think that MacOSX users should create native packages.
It will be really productive and valuable contribution.

best regards,
Przemek
From harbour.01 at syenar.hu  Mon Nov 17 20:59:54 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 17 20:59:59 2008
Subject: [Harbour] 2008-11-18 02:53 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94921$Blat.v2.6.2$5a07a56e$e5ceee996c4@127.0.0.1>

2008-11-18 02:53 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/rtl/gtwvt/gtwvt.c
    ! Fix to previous fix to maximize the window when the initial 
      size would be too big to fit on screen (stupid omission).
      Now the previously cited sizing problem is alright.

  * source/vm/fm.c
    + Replaced HB_NO_FM_STAT and HB_FM_STAT envvars 
      with HB_FM_STAT=yes|no (maybe 0|1 or on|off woud be 
      better or could be accepted as alternatives or 
      replacement). This is to avoid ambiguity when both 
      envvars were set or the app default is not known.
    + Added HB_FM_STATISTICS_DYN_OFF to turn off mem tracking 
      by default when stat module is linked in.

  * source/common/hbverdsp.c
    * Minor cosmetic.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Mon Nov 17 21:05:43 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Mon Nov 17 21:05:48 2008
Subject: [Harbour] 2008-11-18 03:04 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94922$Blat.v2.6.2$29e90ea8$113485beb7b6@127.0.0.1>

2008-11-18 03:04 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * ChangeLog
    * Two recent TODOs in entries marked as [DONE] by this change:
      2008-11-18 01:36 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
      (It was "broken" due to enhancements, see the TODOs. Thanks anyway.)
--
Brgds,
Viktor

From bedipritpal at hotmail.com  Tue Nov 18 03:17:30 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 18 03:17:34 2008
Subject: [Harbour] 2008-11-17 23:59 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20555170.post@talk.nabble.com>


2008-11-17 23:59 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/Makefile
  * harbour/contrib/gtwvg/common.mak
    + wvgdlg.prg 
      
  * harbour/contrib/gtwvg/gtwvg.c
    ! Fixed one more issue with screen repaint behavior when
      window was changing size due to font settings.

  * harbour/contrib/gtwvg/wvgcore.c
  * harbour/contrib/gtwvg/wvggui.c
  * harbour/contrib/gtwvg/wvgwin.c
  * harbour/contrib/gtwvg/hbgtwvg.ch
  * harbour/contrib/gtwvg/wvggui.h
  * harbour/contrib/gtwvg/wvgax.prg
  * harbour/contrib/gtwvg/wvgcrt.prg
  * harbour/contrib/gtwvg/wvgphdlr.prg
  * harbour/contrib/gtwvg/wvgwnd.prg
    ! A reshuffling exercise, Wvt*Classes inching towards
      Xbase++ compatibility, more synchronizations.
      
  + harbour/contrib/gtwvg/wvgdlg.prg
    + Added WvgDialog() class on lines with XbpDialog().

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! Active-X controls hosted with WvgDialog(), pure Windows GT. 
      Previously these were being hosted in WvtCrt() console.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-17-23%3A59-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20555170p20555170.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Tue Nov 18 03:37:07 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 03:37:15 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081118015355.GA20607@34-mo7-2.acn.waw.pl>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
Message-ID: <28615ABE-944A-4896-A0EF-82AC4F9730DC@syenar.hu>

Hi Przemek,

>> I see only one problem. So far no one invest time to create
> native MacOSX packages which will put Harbour binaries and
> libraries in the OS friendly directories using OS packaging
> system.
> All of the above what you said is only results of such missing
> functionality which you mixed with your personal preferences
> from DOS/Windows.

Hm? In OSX the preferred distribution is .dmg for desktop
apps and there is really no standard for command line ones.
Any solution with an installer would just ruin the experience
and limit usage, so please don't try to make it any worse
by pushing such a solution.

Harbour on OS X is broken because you seem to have a personal
preference to force dynamic libs.

>> And I believe it's completely wrong to require installation,
>> sudo/admin rights and all that crap to just make it possible
>> to _try Harbour_, or run a simple "hello world", or god
>> forbid have 2 versions installed in parallel (which is not
>> something exceptional for a developer). Let alone work with
>> a _portable_ environment. No, we rather save 1.5MB on disk
>> (or we target server-side users? hard to tell.).
>
> I believe that any manual installation which does not use
> OS support is wrong and farther workarounds only makes it
> worse.

I believe that any "installation" procedure is fundamentally
wrong and highly limits usage. See my concerns, which you've
just ignored.

>> many systems and number of static libraries is systematically
> reduced. I do not like it sometimes because still there are
> situations when full static binaries are usable but I understand
> the reasons. When bug is found in some library then it's enough
> to upgrade this library instead of all binaries which may use
> this static library.

Now the situation you say is very very remote for a default
hbrun/hbtest installation. It's also very very remote for
those small apps one would create using hbmk script.

I've nowhere said Harbour shouldn't support dynamic linking
per se (in fact I've spent quite some time making them build
in Windows, even if I don't use them), all I'm saying is this
shouldn't be the default for hbrun/hbtest (on OS X), and
for hbmk (on OS X).

For larger projects everyone is free to decide to use a
dynamic lib or static, or to package final executable in an
.app (with or without dynamic libs), ship it using whatever
method. Harbour should ship the .dylibs, but it shouldn't
be needed to run supplied executables, simple because it's
broken, limits usage and completely unnecessary.

> Shared libraries for Harbour programmers may give yet another feature
> when it's not possible to create fully static binaries for some
> libraries, f.e. try to create sth like that for xWindow. When final
> user application compiled by Harbour is linked with Harbour shared
> library then it should be possible to install it with any
> other libraries located with system if only Harbour is recompiled
> for this OS. I plan to extend it because static linking begins
> to be real show stopper in software distribution.
> Without it I will have to recompile my applications for user
> host. I do not like such improvement ;-)

You're talking about something different. See above.

Supplying dynamic version of hbrun doesn't really have
anything to do with the above.

BTW, in OSX there is _no_ desktop app (except some ill-
behaving ones), which would need a classic installer, and
which would require to copy some libs to system dirs or
whatnot. These apps may use dynamic linking inside, but
from a users POV it's one entity and all what you say
above is moot, because there's hardly any situation where
you'd just replace the ".exe" while leaving a 3rd party
".dll" around. Any programs requiring an installer on
OSX are largely considered as more dangerous and
ill-behaving. Only those apps use it which need to
install .kext files or some other frameworks (for no
good reason usually), some do it to copy the .app "file"
on behalf of the user (quite useless) and these app
are rare. Microsoft is one such vendor in the OS X scene.
[They probably also badly miss a registry in OS X.]

About static/dynamic you didn't convince me at all.
All I see is that you seem to prefer it and everything
else is just ignored.

>> Also, what if I'd like to just copy my Harbour devl env to
>> an USB drive and move it around to another machine? This isn't
>> possible with Linux either, thanks to the shared feature, and
>> install-time hard wired lib path tricks.
>
> It's possible. It's enough to read one man page and resolve it
> in few possible ways depending on your personal preferences.
> And if we drop the ideas with making everything static it will
> be much easier because Harbour may become part of default OS
> distributions.
> Now it's not a problem for users who used to install OS friendly
> packages with Harbour binaries like RPM or DEB.

There is no such thing in OSX.

.rpm and .deb will makes it impossible to have two versions
of the same package in parallel. This pretty much makes them
useless for some, so please don't try to force it, especially
for other OS X.

So, how do you address that? How to move around a Harbour
in non-standard places? How to place it on a USB stick? (on
Linux, OS X you name it)

>>> If there is sth wrong with default harbour shared library name
>>> or location in harbour-*.tar.gz then of course it should be fixed.
>> There is something definitely wrong, since it doesn't work,
>> and it never did.
>
> ???
> Viktor if you do not understand sth then its not a reason to
> remove it from Harbour.

Did I miss a proper reason for them?

> Lorenzo can you explain how you are able to use shared libraries
> in MacOSX.
> You and Viktor are using MacOSX. Can you try to create native MacOSX
> Harbour packages which will put all libraries in all expected
> places?

There is _no_ installer in OSX! No one would put anything
to specific places. I expect to unzip it and use it, period.

I know how to make .dylib work for default Harbour, you have
to copy it to bin dir and use -static. Beautiful solution.

And now you propose to make it even uglier with an installer.

>>> Please do not make anything like that. If you want to unify
>>> the names then I suggest to remove static binaries from Windows
>>> builds or call them as *-static.exe.
>> Have you ever seen such thing on Windows? BTW, I haven't
>> seen too many programs on Windows in the form of *-dll.exe
>> either. On Windows - nowadays maybe except the Cygwin world
>> of horror -, apps are expected to just run with as few .dll
>> dependencies as possible. All of those are just a way to
>> make programs get screwed on some environments.
>
> I hoped that you will find it as heretic idea for windows world.
> I'm finding your ideas in such way.
> BTW AFAIR with MSVC is not possible to create static binaries
> and they always depend on MSVC CRTL DLLs which has to be install
> in compatible version in Windows or you should distribute them
> with your programs. Though it's probably problem only for older
> Windows which does not have other software linked with this
> library installed. And to clarify. In MS-Windows full static
> binaries does not exists because MS-Windows API depends on DLLs.

Please let's not move this talk to some academic level
plus some nonsense (of course the OS is separate!). The
point is around "harbour.dll" not system .dlls.

You're also wrong, because with MSVC you can create .exes
which don't need CTRL .dlls, so what you say can be
avoided (which I _had_ to do to make my app run on any Windowses).
MinGW is the one which is unable to create self-contained
(disclaimer: except the OS itself naturally) executables.
And this is perceived as a limitation. Not to mention
Cygwin, with its cygwin1.dll (and others). This is the reason
I avoid them like fire, maybe I'm not the only one. It
really starts to get funny when you have multiple incompatible
versions of cygwin1.dll. Some installers event went as far
as to try to detect it and make attempts to "correct" it.
It's a bad joke.

>> All in all OS X and Windows is not Linux, and there is no
>> point in forcing Linux standards onto them IMO.
>
> It's not a linux standard. I do not know MacOSX desktop and
> I used this system only remotely but it's BSD based and everything
> what I said above about dependencies and shared libraries is also
> true for BSD, OpenSolaris and most of other system which uses
> OpenSource code. And of course for big machines with closed source
> *nixes but here usually base recompilation on final machine is a
> must so it's yet another problem which I will try to resolve extending
> HRB format.

It's not Linux standard, it's something fundamentally wrong
from an end user perspective. All the systems above won't be
used by "normal" ppl, OS X is the only one which is. Probably
that's the reason, not that wanted to speculate on that.

I believe in clear separation of components, the OS, the apps
from the OS, the apps from themselves.

If your aim is to make Harbour as part of open source OSes
it's fine, but chances are low you'll make it part of OS X.
Of course we should allow it, but for god's sake lets not
optimize for such a remote possibility by default.

>> [ BTW and slightly off, both Linux and Windows could take long
>> lessons from OS X when it comes to _desktop software_ installation,
>> those other two simply cannot get it right. I had to fall back
>> and recommend XP over Linux on Asus EEE PC, because custom software
>> installation (= Google Earth and say a bittorrent client) is just
>> way too difficult - if possible - for an average user on Linux.
>> No wonder it still couldn't catch up. ]
>
> Maybe you should look for distribution when such things can be done
> in few mouse/keyboard clicks. The problem begins when "average user
> on Linux" tries to build and install sth yourself ignoring ready
> to use binaries in distribution repositories.
> BTW I really think that MacOSX users should create native packages.
> It will be really productive and valuable contribution.

<OFF>

It's a Debian based distribution, but anyhow please don't advise
to start with reinstalling the OS, because this would also
ruin the experience plus I'd expect it to not work anyway.
Which normal computer user has or wants a Linux expert around
the whole time, and has free time to tweak their new gadget for
days before they can start using it?? And you know what, I don't
want my mom or any users for that matter to know about what
a _distribution actually is_. Users expect to google for some
tools, go to a site, download a program ("xy for Linux") and use
it with the less hassle and impact on a system. It's amazing how
the Linux community didn't address this so far, and the only
place to get apps from is some central repository specific to
distros (and no, normal users don't want to add some cryptic
lines to the list of repositories). Part of this is caused by
the "dll hell" on Linux and lack of standard interfaces and
a self-contained "app" package. The benefits of the current
systems are clear, but this is wholly favoring server and/or
expert users working on specific distros. Anyhow I'm not
really into discussing this, but for sure Linux just lost one
user over XP because of the above attitude. Unfortunately OS X
was not an option due to price in this specific case.

</OFF>

Brgds,
Viktor

From bedipritpal at hotmail.com  Tue Nov 18 03:45:23 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 18 03:45:28 2008
Subject: [Harbour] 2008-11-18 00:43 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20555513.post@talk.nabble.com>


2008-11-18 00:43 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/wvggui.c
  * harbour/contrib/gtwvg/common.mak
  * harbour/contrib/gtwvg/wvgdlg.prg
  * harbour/contrib/gtwvg/wvgwnd.prg
    ! Minor typos - strict Harbour code quality warnings.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-18-00%3A43-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20555513p20555513.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From soporte at dsgsoftware.com  Tue Nov 18 03:59:37 2008
From: soporte at dsgsoftware.com (=?iso-8859-1?Q?Juan_G=E1lvez?=)
Date: Tue Nov 18 04:00:15 2008
Subject: [Harbour] About HB_TokenGet() function
Message-ID: <000701c9495c$106ce280$6c01a8c0@PcJuanxp>

Hi all,

Is there some technical reason so that the behavior of HB_TokenGet() is 
different when the delimitador is the space character ?

If yes ... Could it be changed to be an optional behavior ?

? HB_TokenGet( ";2;3;4", 1, ";" )    // It shows ""
? HB_TokenGet( ";2;3;4", 2, ";" )    // It shows "2"

? HB_TokenGet( " 2 3 4", 1, " " )    // It shows "2"
? HB_TokenGet( " 2 3 4", 1, " " )    // It shows "3"

Best regards
Juan 

From lorenzo.fiorini at gmail.com  Tue Nov 18 04:36:52 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Nov 18 04:36:56 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081118015355.GA20607@34-mo7-2.acn.waw.pl>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
Message-ID: <9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>

On Tue, Nov 18, 2008 at 2:53 AM, Przemyslaw Czerpak <druzus@acn.waw.pl> wrote:

> I see only one problem. So far no one invest time to create
> native MacOSX packages which will put Harbour binaries and
> libraries in the OS friendly directories using OS packaging
> system.

The problem is that in Mac OSX there are more arch combinations than
developers :)

For example yesterday I wanted to test the new gtk beta and I followed
the 1,2,3 steps suggested at http://www.gtk-osx.org, It installed like
a charm in perfect OSX style but they simply forgot to mention that it
was only for i386 arch.

Even worse Xcode builds it without any error but the executable simply
did nothing.
Only when I run it from the terminal I see the message "... wrong platform".

Then I read that "The recommended way to build GTK+ is to use jhbuild"
and I found that it simply download sources from svn and build them.
After a while I got a working gtk env.
Also macports the "standard" way to get 3rd party software simply
downloads and builds from source and install everything in
/opt/local/...

I know we don't agree here but I still think that creating binary
distributions of a multi platform, multi architecture open source
compiler are a waste of time.
I understand that an OpenOffice user don't want to know how to build
it but the knowledge required to build Harbour is the same necessary
to use it.

> Because shared linking it's a basic requirement in most of
> open source OS distributions and without it Harbour will never
> be accepted as default package in them.
> ..
> Without it I will have to recompile my applications for user
> host. I do not like such improvement ;-)

Shared library are simply a MUST. I moved Mac OSX status to "fully
supported development platform" in my company only last week after I
got them working.

The days of native executables are ended many years ago: both Java and
.Net use intermediate code.

The next most important feature for me are the HRLs the "hrb
libraries" and a way to package several hrbs and hrls into a zip and
execute it directly from hbrun.

> Lorenzo can you explain how you are able to use shared libraries
> in MacOSX.

I simply use hb-mkslib and set DYLD_LIBRARY_PATH envvars to the dylibs path.

There is only one small fix in hb-mkslib to do. Here is a snap of the message:

------------------------------
On Mon, Nov 10, 2008 at 2:38 PM, Przemyslaw Czerpak <druzus@acn.waw.pl> wrote:

> change -install_name parameter to:
>    ${CCPREFIX}libtool -dynamic -install_name "${BASE}${SLIB_EXT}" \
>
> Check if everything works correctly. If yes then please commit it.

Thanks it was it :)

Since today Mac OS X is a first class citizen in our company.
-------------------------------

After that hbmk -n -shared hello.prg works without any problem.

best regards,
Lorenzo
From soporte at dsgsoftware.com  Tue Nov 18 05:07:24 2008
From: soporte at dsgsoftware.com (=?iso-8859-1?Q?Juan_G=E1lvez?=)
Date: Tue Nov 18 05:07:32 2008
Subject: [Harbour] About HB_TokenGet() function
References: <000701c9495c$106ce280$6c01a8c0@PcJuanxp>
Message-ID: <000c01c94965$7681c370$6c01a8c0@PcJuanxp>

> ? HB_TokenGet( " 2 3 4", 1, " " )    // It shows "3"

I'm sorry, in the above line I want to say :

? HB_TokenGet( " 2 3 4", 2, " " )    // It shows "3"

Best regards
Juan
From harbour.01 at syenar.hu  Tue Nov 18 05:30:11 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 05:30:19 2008
Subject: [Harbour] FW: [Harbour-users] Filestats of xHarbour
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F1B3@SRV02.deltain.net>
References: <AFB948164110ED43B5EB849E8DEEF03815F1B3@SRV02.deltain.net>
Message-ID: <AF2BE2CF-C6AF-41EE-8807-218A10C8A4D5@syenar.hu>

> Harbour have not ported filestat function ?

No, but this function could be added to xhb.lib as is.

As a replacement, we have Directory() and hb_FSize().
Probably separate hb_FAttrSet()/hb_FAttrGet() would be nice to have.

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 18 06:03:48 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 06:03:55 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
Message-ID: <1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>

Hi Lorenzo,

> The problem is that in Mac OSX there are more arch combinations than
> developers :)
>
> For example yesterday I wanted to test the new gtk beta and I followed
> the 1,2,3 steps suggested at http://www.gtk-osx.org, It installed like
> a charm in perfect OSX style but they simply forgot to mention that it
> was only for i386 arch.
>
> Even worse Xcode builds it without any error but the executable simply
> did nothing.
> Only when I run it from the terminal I see the message "... wrong  
> platform".
>
> Then I read that "The recommended way to build GTK+ is to use jhbuild"
> and I found that it simply download sources from svn and build them.
> After a while I got a working gtk env.
> Also macports the "standard" way to get 3rd party software simply
> downloads and builds from source and install everything in
> /opt/local/...

Macports is one (Linux-like) 3rd party solution. [ I try to
not use it, as it adds up a difficult to replicate component
to an otherwise clean system. You need to do sudo/admin, which
I also try to avoid. ]

Also, I have an OSX port of my apps running/building fine
without any need to install stuff in /opt /usr or any other
such non-user locations, or setup envvar or do any global
configuration whatsoever. So the issue is really only hbrun,
hbtest and hbmk behavior. [ None of these is needed for my
project. ]

> I know we don't agree here but I still think that creating binary
> distributions of a multi platform, multi architecture open source
> compiler are a waste of time.
> I understand that an OpenOffice user don't want to know how to build
> it but the knowledge required to build Harbour is the same necessary
> to use it.

That's true, but if we provide binaries, I'm not sure there
is a point to limit its usage by using it as a showcase or
to target some other academic goals, or try to replicate
customs from other systems.

>> Because shared linking it's a basic requirement in most of
>> open source OS distributions and without it Harbour will never
>> be accepted as default package in them.
>> ..
>> Without it I will have to recompile my applications for user
>> host. I do not like such improvement ;-)
>
> Shared library are simply a MUST. I moved Mac OSX status to "fully
> supported development platform" in my company only last week after I
> got them working.

No one said otherwise. The question is: why we want to push
this for hbrun, hbtest and hbmk default.

So far none could say a single argument why -shared
is useful for the above three. (in OS X)

> The days of native executables are ended many years ago: both Java and
> .Net use intermediate code.

This really doesn't have to do too much with making an
executable standalone or not. There exist standalone
executables for both .NET and Java. Since Harbour has much
less bloat, standalone is pretty much a no brainer here.

> The next most important feature for me are the HRLs the "hrb
> libraries" and a way to package several hrbs and hrls into a zip and
> execute it directly from hbrun.

And an hbrun which can actually run without needing
an install by an admin or other hassles.

>> Lorenzo can you explain how you are able to use shared libraries
>> in MacOSX.
>
> I simply use hb-mkslib and set DYLD_LIBRARY_PATH envvars to the  
> dylibs path.
>
> There is only one small fix in hb-mkslib to do. Here is a snap of  
> the message:

I don't want to store any temporary paths in
an envvar, nor to modify my environment just to
run a simple hbrun/hbtest.

>> change -install_name parameter to:
>>   ${CCPREFIX}libtool -dynamic -install_name "${BASE}${SLIB_EXT}" \
>>
>> Check if everything works correctly. If yes then please commit it.
>
> Thanks it was it :)
>
> Since today Mac OS X is a first class citizen in our company.
> -------------------------------
>
> After that hbmk -n -shared hello.prg works without any problem.

Fine, but since -shared is the default now, even those
users have to fiddle with this, who wouldn't want.

-shared should be an (non-default) option in OS X.

Brgds,
Viktor

From lorenzo.fiorini at gmail.com  Tue Nov 18 07:25:47 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Nov 18 07:25:50 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
Message-ID: <9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>

On Tue, Nov 18, 2008 at 12:03 PM, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> Macports is one (Linux-like) 3rd party solution. [ I try to
> not use it, as it adds up a difficult to replicate component
> to an otherwise clean system. You need to do sudo/admin, which
> I also try to avoid. ]

Do you know nay other way to have gd, openssl and other developers libs?

> No one said otherwise. The question is: why we want to push
> this for hbrun, hbtest and hbmk default.

This comes from
https://fedoraproject.org/wiki/Packaging/Guidelines#Exclusion_of_Static_Libraries
>
Packages including libraries should exclude static libs as far as
possible (eg by configuring with --disable-static). Static libraries
should only be included in exceptional circumstances. Applications
linking against libraries should as far as possible link against
shared libraries not static versions.
<

True static almost doesn't exist in Linux anymore.
Try to run ldd <executable> and you'll see how many dependences it has
so for me having shared as default is normal.
To avoid it use -static.

best regards,
Lorenzo
From druzus at acn.waw.pl  Tue Nov 18 07:29:28 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 18 07:28:14 2008
Subject: [Harbour] 2008-11-18 03:04 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c94922$Blat.v2.6.2$29e90ea8$113485beb7b6@127.0.0.1>
References: <01c94922$Blat.v2.6.2$29e90ea8$113485beb7b6@127.0.0.1>
Message-ID: <20081118122928.GA27225@34-mo7-2.acn.waw.pl>

On Tue, 18 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> 2008-11-18 03:04 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
>   * ChangeLog
>     * Two recent TODOs in entries marked as [DONE] by this change:
>       2008-11-18 01:36 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
>       (It was "broken" due to enhancements, see the TODOs. Thanks anyway.)

No. It was broken due to such rules:
   HBFLAGSCMN     = $(HBFLAGSCMN) -gc3
added to common.mak which break all make system which supports late
macro evaluation. Please do not use them if it's not strictly necessary
for some reasons.
I forgot to add to ChangeLog that I also added support for harbourmt
shared library.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Nov 18 08:04:37 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 08:04:44 2008
Subject: [Harbour] 2008-11-18 00:43 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20555513.post@talk.nabble.com>
References: <20555513.post@talk.nabble.com>
Message-ID: <B4056840-112B-4FEC-89E2-A5A257781DB5@syenar.hu>

Hi Pritpal,

Would you please turn off Unicode in your editor?

Brgds,
Viktor

On 2008.11.18., at 9:45, Pritpal Bedi wrote:

>
> 2008-11-18 00:43 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>  * harbour/contrib/gtwvg/wvggui.c
>  * harbour/contrib/gtwvg/common.mak
>  * harbour/contrib/gtwvg/wvgdlg.prg
>  * harbour/contrib/gtwvg/wvgwnd.prg
>    ! Minor typos - strict Harbour code quality warnings.
>
> Regards
> Pritpal Bedi
> -- 
> View this message in context: http://www.nabble.com/2008-11-18-00%3A43-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20555513p20555513.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Tue Nov 18 08:05:25 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 08:05:31 2008
Subject: [Harbour] 2008-11-18 13:55 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c9497e$Blat.v2.6.2$52a15402$e0469336da4@127.0.0.1>

2008-11-18 13:55 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * make_gcc.sh
  * common.mak
    ! Fixed previous and even older workaround for cyclic 
      reference in common.mak when used with GNU-make.
    ; Please review/test.
--
Brgds,
Viktor

From niki at synel.co.il  Tue Nov 18 08:53:16 2008
From: niki at synel.co.il (Chen Kedem)
Date: Tue Nov 18 08:54:58 2008
Subject: [Harbour] SF bugtracker#2308998: hbmysql use byte size instead of
 char lenght (PATCH)
Message-ID: <1A07FEDC778C3E4AA417F089511F859C03333A41EF@Mail-yoq.SYNEL-COMPANY.LTD>

The following patch was submitted on the SF bugtracker:
http://sourceforge.net/tracker/index.php?func=detail&aid=2308998&group_id=681&atid=100681

--------------------------------------------
[PATCH] hbmysql use byte size instead of char lenght

every multibyte charachter is stored in 3 byte by MySQL, for it's operation
harbour should use the char lenght instead.
diff -Naur harbour/contrib/hbmysql.orig/tmysql.prg
harbour/contrib/hbmysql/tmysql.prg
--- harbour/contrib/hbmysql.orig/tmysql.prg 2008-11-06
15:21:07.000000000 +0100
+++ harbour/contrib/hbmysql/tmysql.prg 2008-11-13 19:46:37.000000000
+0100
@@ -122,7 +122,7 @@
// Char fields are padded with spaces since a real .dbf field would be
if ::FieldType(nNum) == "C"
- return PadR(::aRow[nNum], ::aFieldStruct[nNum][MYSQL_FS_LENGTH])
+ return PadR(::aRow[nNum], ::aFieldStruct[nNum][MYSQL_FS_MAXLEN])
else
return ::aRow[nNum]
endif
@@ -176,7 +176,7 @@
METHOD FieldLen(nNum) CLASS TMySQLRow
-return iif( nNum >=1 .AND. nNum <= Len(::aFieldStruct),
::aFieldStruct[nNum][MYSQL_FS_LENGTH], 0 )
+return iif( nNum >=1 .AND. nNum <= Len(::aFieldStruct),
::aFieldStruct[nNum][MYSQL_FS_MAXLEN], 0 )
METHOD FieldDec(nNum) CLASS TMySQLRow
@@ -674,7 +674,7 @@
// Char fields are padded with spaces since a real .dbf field would be
if ::FieldType(nNum) == "C"
- return PadR(Value,::aFieldStruct[nNum][MYSQL_FS_LENGTH])
+ return PadR(Value,::aFieldStruct[nNum][MYSQL_FS_MAXLEN])
else
return Value
endif
@@ -687,7 +687,7 @@
METHOD FieldLen(nNum) CLASS TMySQLQuery
if nNum >=1 .AND. nNum <= Len(::aFieldStruct)
- return ::aFieldStruct[nNum][MYSQL_FS_LENGTH]
+ return ::aFieldStruct[nNum][MYSQL_FS_MAXLEN]
endif
return 0
--------------------------------------------

Have no idea if this patch is correct or not.

  Chen.
From harbour.01 at syenar.hu  Tue Nov 18 09:01:32 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 09:01:40 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
Message-ID: <581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>

>> Macports is one (Linux-like) 3rd party solution. [ I try to
>> not use it, as it adds up a difficult to replicate component
>> to an otherwise clean system. You need to do sudo/admin, which
>> I also try to avoid. ]
>
> Do you know nay other way to have gd, openssl and other developers  
> libs?

I haven't experimented with them on OSX yet,
so I cannot tell anything first hand.

>> No one said otherwise. The question is: why we want to push
>> this for hbrun, hbtest and hbmk default.
>
> This comes from
> https://fedoraproject.org/wiki/Packaging/ 
> Guidelines#Exclusion_of_Static_Libraries
>>
> Packages including libraries should exclude static libs as far as
> possible (eg by configuring with --disable-static). Static libraries
> should only be included in exceptional circumstances. Applications
> linking against libraries should as far as possible link against
> shared libraries not static versions.
> <
>
> True static almost doesn't exist in Linux anymore.
> Try to run ldd <executable> and you'll see how many dependences it has
> so for me having shared as default is normal.
> To avoid it use -static.

I'm talking about OS X.

It's Linux's (or this specific distro's) problem how they
make their life more complicated, or more generically speaking
how they try to solve their specific problems for their specific
needs the best way.

And so far still no one could answer regarding any concerns
raised. (like installing a simple std app downloaded from the
net, moving around programs on a USB stick, or installing
something without impacting the base OS, needing admin/sudo
rights.). Maybe Linux/Fedora just simply ignores these, maybe
there is a solution I don't know, or maybe these issues are
irrelevant for some reasons I miss. Please enlighten me.

Linux is different probably because the line between
OS and "extensions" is very blurred, and this is probably so
because the OS is free and fully OSS and not controlled centrally.

OS X isn't Linux though, here, the lines between OS and non-OS
are perfectly clear.

Finally: someone please tell, what do I supply to the Linux
users when I'd like to ship a commercial application in the form
of a download package? Is there a standard format which would work
across all distros for let's say all kernels above 2.x.y? Naturally,
compiling from source isn't an option, or should I ship
obfuscated source code and let the end user the compiling?
Isn't that insane for non-technical users? How to do test & support
zillions of different possible environments, external lib versions
and combinations? Suppose Harbour 1.0 is shipped with all Linux
distros, should I then program my apps to not use anything above
that Harbour version? Or should I try to use > 1.0 features
using conditional compiling? If so, should also ship my .prg
sources in obfuscated form then? How?

Just to give a quick idea of the problem and one solution,
I've just downloaded Google Earth for Linux, and after I've
found out that the file GoogleEarthLinux.bin is a really a
script which needs to be started from terminal (guess
whether your mom / dad / gf / wife / sister could find this
out). Anyhow, it turns out - miracle - that there is about
50MB worth of _static libs inside_, plus the executable.

Is Google wrong?

Brgds,
Viktor

From druzus at acn.waw.pl  Tue Nov 18 09:18:39 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 18 09:17:24 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
Message-ID: <20081118141839.GA11032@34-mo7-2.acn.waw.pl>

On Tue, 18 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Macports is one (Linux-like) 3rd party solution. [ I try to
> not use it, as it adds up a difficult to replicate component
> to an otherwise clean system. You need to do sudo/admin, which
> I also try to avoid. ]

Before you will change sth with deafult directory location I think
that you should think about incoming user questions. Probably it
will be good to start sth like MacOSX-FAQ. I've got the 1-st question:
   1. Why I cannot execute this simple scrpit in MacOSX port:

         #!/usr/bin/hbrun
         proc main()
            alert( "Hello World!!!" )
         return

      I have big internet shop application which with hundreds
      CGI harbour scripts and it does not work with MacOSX.

> Also, I have an OSX port of my apps running/building fine
> without any need to install stuff in /opt /usr or any other
> such non-user locations, or setup envvar or do any global
> configuration whatsoever. So the issue is really only hbrun,
> hbtest and hbmk behavior. [ None of these is needed for my
> project. ]

The fact that you are using Harbour in very limited way like
in Windows it does not mean that you have rights to force
such usage also for other users.

>> I know we don't agree here but I still think that creating binary
>> distributions of a multi platform, multi architecture open source
>> compiler are a waste of time.
>> I understand that an OpenOffice user don't want to know how to build
>> it but the knowledge required to build Harbour is the same necessary
>> to use it.
> That's true, but if we provide binaries, I'm not sure there
> is a point to limit its usage by using it as a showcase or
> to target some other academic goals, or try to replicate
> customs from other systems.

I do not agree. You both are thinking only about your current needs.
I want to be able to write Harbour applications as scripts or
binaries and distribute them in system friendly packages like
RPM or DEB. It means that I need Harbour installed in known
for OS and package manager way so dependencies will be check
automatically and if necessary user can download also Harbour
shared libraries or whole compiler and install them in his
system. F.e. I can write new bittorent client as Harbour
application. We do not have to build binaries but we have to
create system where such binaries are easy to create.

If you think that whole Harbour future should be reduced to
port your own Clipper applications to different OS-es then we
do not need it at all. Most of core developers have sufficient
knowledge to make their own customized Harbour builds and adopt
his source to them. If you want to see somewhere Harbour as
popular language used to write different type of applications
then we _MUST_ create support for OS friendly installation
which will keep some basic rules between platforms or we
will have serious problems with portability.

MacOSX native installer is IMHO a must. Just like we should have
BSD ports. There is a big place for Harbour users to help us in
making Harbour more popular so it will be added to official distributions.

And here I really want to ask all Harbour MacOSX users to participate
in this job to create it. Sorry but here I cannot help. I do not even
know what MacOSX uses as package manager, what is the official location
policy, how it supports dependencies, etc.

>> Shared library are simply a MUST. I moved Mac OSX status to "fully
>> supported development platform" in my company only last week after I
>> got them working.
> No one said otherwise. The question is: why we want to push
> this for hbrun, hbtest and hbmk default.

hbtest is not final user application and it's not necessary to
distribute it. hbrun is final user application and it has to be
synced with harbour shared library installed in given OS.
The easiest way is linking it with this library.
It also needs strict location so it cannot be moved to any other
place in official releases just like Harbour shared library so
I do not see what you want to win by forcing static linking.
You will only create bigger binaries.

> So far none could say a single argument why -shared
> is useful for the above three. (in OS X)

Just like you are presenting only your limited by Windows point
of view without any other argument then I want to make it in
such way because I like it, I used to do it in Windows and
it's enough for me personally.

Viktor, do it what you only want with MacOSX builds.
I wish you great success.
I do not use MacOSX so it's not a problem for me. When I will
have to use it then for my own personal use I'll create custom
Harbour builds compatible with other environments quite fast.
The only one problem I can see is that I will have to distribute
alternative harbour shared library and hbrun for MacOSX what
can be problem for final users but for sure I'll start with
creating native packages for Harbour installation to reduce it.

best regards,
Przemek
From info at fsgiudice.com  Tue Nov 18 10:31:15 2008
From: info at fsgiudice.com (Francesco Saverio Giudice)
Date: Tue Nov 18 10:31:36 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081118141839.GA11032@34-mo7-2.acn.waw.pl>
References: <20535315.post@talk.nabble.com>	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
Message-ID: <4922DFC3.1020205@fsgiudice.com>

Hi Przemek,

Il 18/11/2008 15.18, Przemyslaw Czerpak ha scritto:
> On Tue, 18 Nov 2008, Szak?ts Viktor wrote:
> 
> 
>       I have big internet shop application which with hundreds
>       CGI harbour scripts and it does not work with MacOSX.
> 

For curiosity I would like to see a your "real life" job in action. 
Could you kindly write here the address of that internet shop and what 
part of the site works using harbour ?

TIA

Best Regards

Francesco
From bedipritpal at hotmail.com  Tue Nov 18 10:37:05 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 18 10:37:09 2008
Subject: [Harbour] 2008-11-18 00:43 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <B4056840-112B-4FEC-89E2-A5A257781DB5@syenar.hu>
References: <20555513.post@talk.nabble.com>
	<B4056840-112B-4FEC-89E2-A5A257781DB5@syenar.hu>
Message-ID: <20561943.post@talk.nabble.com>


Hi Viktor

>Would you please turn off Unicode in your editor?

For cgangelog, I always use notepad.exe since very begining.
Where do I change its attributes. Exactly what is happening, can you point
out?

Regards
Pritpal Bedi



-- 
View this message in context: http://www.nabble.com/2008-11-18-00%3A43-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20555513p20561943.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From abe.buch at att.net  Tue Nov 18 11:37:56 2008
From: abe.buch at att.net (Abeb)
Date: Tue Nov 18 11:38:00 2008
Subject: [Harbour] HB_EXT_INKEY or KEYREAD()
Message-ID: <20563249.post@talk.nabble.com>



Problem:  differentiate between Ctrl_R and Page-up keys pressed, (inkey()
will return  18 same as Page-Up)

In Dos I used CT  KEYREAD() function to get the lastkey pressed.  (I don't
see it ported.)


In xharbour they have HB_EXT_INKEY if defined lastkey() will return some
other value than page-up)

What is there available in Harbour?

Thanks,
Abe

-- 
View this message in context: http://www.nabble.com/HB_EXT_INKEY-or-KEYREAD%28%29-tp20563249p20563249.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From abe.buch at att.net  Tue Nov 18 11:42:58 2008
From: abe.buch at att.net (Abeb)
Date: Tue Nov 18 11:43:01 2008
Subject: [Harbour] HB_EXT_INKEY or KEYREAD()
Message-ID: <20563360.post@talk.nabble.com>


Problem:  differentiate between Ctrl_R and Page-up keys pressed, (inkey()
will return  18 same as Page-Up)

In Dos I used CT  KEYREAD() function to get the lastkey pressed.  (I don't
see it ported.)


In xharbour they have HB_EXT_INKEY if defined lastkey() will return some
other value than page-up)

What is there available in Harbour?

Thanks,
Abe

-- 
View this message in context: http://www.nabble.com/HB_EXT_INKEY-or-KEYREAD%28%29-tp20563360p20563360.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From lorenzo.fiorini at gmail.com  Tue Nov 18 12:24:28 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Tue Nov 18 12:32:07 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081118141839.GA11032@34-mo7-2.acn.waw.pl>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
Message-ID: <9257026e0811180924y7cd65820re61839f81dc235f@mail.gmail.com>

On Tue, Nov 18, 2008 at 3:18 PM, Przemyslaw Czerpak <druzus@acn.waw.pl> wrote:

> I do not agree. You both are thinking only about your current needs.
> I want to be able to write Harbour applications as scripts or
> binaries and distribute them in system friendly packages like
> RPM or DEB. It means that I need Harbour installed in known
> ...
> which will keep some basic rules between platforms or we
> will have serious problems with portability.

I think we have 3 different situations:

1 - Linux
well known and accepted standards like RPM and DEB and most of the
dependences are available within the "official" repository ( f.e. zip,
openssl, gd, postgresql, mysqll and so on )

2 - Win
here we have a standard way of install ( setup.exe ) but things get
complicated since we support many different C compilers and there is
no a simple way to get dependences

3 - OSX
the tool that create packages comes with the OS but it's not easy to
get dependences and there very few ( 2 ) users, also there are 2 arch
ppc and Intel

Now Linux situation is in the best shape since RPM and DEBs are supported
( but we also have the cross-platform options Linux-W32 Linux-WinCE )

Win it's completely different if a developer want to use msys/mingw (
like me ) or other "native" compilers like MSVC xyx, BCC xyz, ....
It's different where to get dependences and how to build programs (
hb* scripts vs batch files )

In OSX is even more complicated by the fact that we've only 2
developers and at least for me with a very basic knowledge of the dev
tools.

Now it seems we're missing the main point:
Why should a non-Clipper developer choose Harbour instead of PHP,
Python, Java, .Net or whatever else? and how can Harbour attract other
Linux, OSX, Win developers?

Can we imagine an OSX developer that choose Harbour without a GUI?
Can we imagine a web developer that choose Harbour without an Apache module?
Can we imagine an SQL developer that choose Harbour without an Oracle module?

I think we ( mostly you ) should define the goals and check where to
find the resources to achieve them. If we're a small group of old
Clipper developers that need to maintain its legacy apps than the goal
was achieved with 1.0 if not it's time to make choices.

However I'll start to look at the OSX packager and I'll report

best regards,
Lorenzo
From harbour.01 at syenar.hu  Tue Nov 18 12:46:08 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 12:46:24 2008
Subject: [Harbour] 2008-11-18 00:43 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20561943.post@talk.nabble.com>
References: <20555513.post@talk.nabble.com>
	<B4056840-112B-4FEC-89E2-A5A257781DB5@syenar.hu>
	<20561943.post@talk.nabble.com>
Message-ID: <D7701137-5319-4E85-8DA8-79567438B9BE@syenar.hu>

Hi Pritpal,

I've looked into ChangeLog and there was an
entry not long ago which contained some copy pasted
error log parts as is, with UTF8 chars and tabs
with it and Notepad probably thought this is
an Unicode file because of it, and started to
append an UTF-8 BOM the beginning of it.

I'll remove those high chars from ChangeLog, so
such thing won't happen again with Notepad, but
I suggest using an alternative like np2 or
something similar. Besides their other pluses,
they won't add anything like that to a file
without users' knowledge.

Brgds,
Viktor

On 2008.11.18., at 16:37, Pritpal Bedi wrote:

>
> Hi Viktor
>
>> Would you please turn off Unicode in your editor?
>
> For cgangelog, I always use notepad.exe since very begining.
> Where do I change its attributes. Exactly what is happening, can you  
> point
> out?
>
> Regards
> Pritpal Bedi
>
>
>
> -- 
> View this message in context: http://www.nabble.com/2008-11-18-00%3A43-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20555513p20561943.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From harbour.01 at syenar.hu  Tue Nov 18 13:38:52 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 13:39:00 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081118141839.GA11032@34-mo7-2.acn.waw.pl>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
Message-ID: <CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>

Hi Przemek,

>   1. Why I cannot execute this simple scrpit in MacOSX port:
>
>         #!/usr/bin/hbrun
>         proc main()
>            alert( "Hello World!!!" )
>         return
>
>      I have big internet shop application which with hundreds
>      CGI harbour scripts and it does not work with MacOSX.

This should work regardless of our static vs. dynlib issue.
So it's off topic.

I'm getting (with a private built hbrun which works):
---
Error BASE/9995  Corruption detected: HB_HRBRUN
Called from HB_HRBRUN(0)
Called from _APPMAIN(0)
---

Maybe something obvious from my side, this is the first
time I tried hbrun this way on any platform.

>> Also, I have an OSX port of my apps running/building fine
>> without any need to install stuff in /opt /usr or any other
>> such non-user locations, or setup envvar or do any global
>> configuration whatsoever. So the issue is really only hbrun,
>> hbtest and hbmk behavior. [ None of these is needed for my
>> project. ]
>
> The fact that you are using Harbour in very limited way like
> in Windows it does not mean that you have rights to force
> such usage also for other users.

Some facts please. Denying me isn't one.

>>> That's true, but if we provide binaries, I'm not sure there
>> is a point to limit its usage by using it as a showcase or
>> to target some other academic goals, or try to replicate
>> customs from other systems.
>
> I do not agree. You both are thinking only about your current needs.
> I want to be able to write Harbour applications as scripts or
> binaries and distribute them in system friendly packages like
> RPM or DEB. It means that I need Harbour installed in known
> for OS and package manager way so dependencies will be check
> automatically and if necessary user can download also Harbour
> shared libraries or whole compiler and install them in his
> system. F.e. I can write new bittorent client as Harbour
> application. We do not have to build binaries but we have to
> create system where such binaries are easy to create.

Future needs aside, it's not working now.

I couldn't care less if there was however Harbour
packages distributed for OS X, but _they should work
out of the box_. A simple .zip file distribution should
also work out of the box, and if you want to create
such complicated dependency check or installer, or
MacPorts packages so be it, but the default install
(the only one we currently seem to have), should also
work out of the box, without additional trickery, sudo,
envvars, copying, you name it, and current package is
essentially a .zip file.

> If you think that whole Harbour future should be reduced to
> port your own Clipper applications to different OS-es then we
> do not need it at all. Most of core developers have sufficient
> knowledge to make their own customized Harbour builds and adopt
> his source to them. If you want to see somewhere Harbour as
> popular language used to write different type of applications
> then we _MUST_ create support for OS friendly installation
> which will keep some basic rules between platforms or we
> will have serious problems with portability.

First of all it's not about me, but as I estimate
most users downloading our sf.net OSX package. Please
don't try to make it personal and "dumb it down" to
my presumed (by you) ignorance and/or strict personal needs.

I'm talking about './hbmk hello.prg' not working,
'./hbrun' not working and './hbtest' not working.

[ my app doesn't use either hbmk, hbrun or hbtest,
nor .dylibs for that matter, so it's not about my app.
Sad to see however how all Linux users seem to deny
the fact that 3rd party apps may exist, and installation
of these should be possible for normal human beings.
BTW my app seems to be a perfectly usual fat client
application, it seems such apps are common on Linux
and OS X systems too. If this is "personal" or unusual
for Harbour to support, maybe I should really look
elsewhere for the proper tool, maybe you're right. ]

> MacOSX native installer is IMHO a must. Just like we should have
> BSD ports. There is a big place for Harbour users to help us in
> making Harbour more popular so it will be added to official  
> distributions.
> And here I really want to ask all Harbour MacOSX users to participate
> in this job to create it. Sorry but here I cannot help. I do not even
> know what MacOSX uses as package manager, what is the official  
> location
> policy, how it supports dependencies, etc.

I see you don't believe me, or you didn't read my
prev messages, so I'll stop adding more to the above.
Just read my previous mails. [ -> there is no native
"package manager". ]

You seem to insist on something you don't know much about.

[ I'm talking about OSX. For BSD I have no idea, but
at first it seems like an OS with a wholly different
target audience and a lot different concept on the
UI/usability level. Agreed it would be nice to see
native Harbour package for it. ]

>>> Shared library are simply a MUST. I moved Mac OSX status to "fully
>>> supported development platform" in my company only last week after I
>>> got them working.
>> No one said otherwise. The question is: why we want to push
>> this for hbrun, hbtest and hbmk default.
>
> hbtest is not final user application and it's not necessary to
> distribute it. hbrun is final user application and it has to be
> synced with harbour shared library installed in given OS.
> The easiest way is linking it with this library.
> It also needs strict location so it cannot be moved to any other
> place in official releases just like Harbour shared library so
> I do not see what you want to win by forcing static linking.
> You will only create bigger binaries.

Given OS? Harbour isn't part of OSX, and I assume it won't
be for some time.

I want to win that when if anyone goes to /bin dir and types
'./hbrun' it actually works, instead of complaining about
missing lib and crashing. The other thing I want is that if
someone goes to /bin dir and types './hbmk hello.prg'
the resulting hello binary would actually work, instead
of crashing, and some would have to find that he needs
-static to make it work.

So far it seems, the fix doesn't create any harm besides
raising disk space requirement by about 2MB.

>> So far none could say a single argument why -shared
>> is useful for the above three. (in OS X)
>
> Just like you are presenting only your limited by Windows point
> of view without any other argument then I want to make it in
> such way because I like it, I used to do it in Windows and
> it's enough for me personally.

Try OS X once, I'm not talking about Windows.

Anyhow since you didn't really added anything to my
concerns, just belittling my abilities / standpoint and
painting it as "Windows" and personal, I must assume the
silence means some or all concerns are valid, platform
aside.

> Viktor, do it what you only want with MacOSX builds.
> I wish you great success.
> I do not use MacOSX so it's not a problem for me. When I will
> have to use it then for my own personal use I'll create custom
> Harbour builds compatible with other environments quite fast.
> The only one problem I can see is that I will have to distribute
> alternative harbour shared library and hbrun for MacOSX what
> can be problem for final users but for sure I'll start with
> creating native packages for Harbour installation to reduce it.

Shared library is untouched, so I'm not sure why you
need to build your own. Maybe you'll want to distribute
alternative hbrun binary, which will use some preinstalled
harbour.dylibs on your target systems.

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 18 14:00:43 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 14:00:49 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <9257026e0811180924y7cd65820re61839f81dc235f@mail.gmail.com>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
	<9257026e0811180924y7cd65820re61839f81dc235f@mail.gmail.com>
Message-ID: <A7C1E4DE-6A8D-4766-ABC4-CA09CEC840BA@syenar.hu>

>> I do not agree. You both are thinking only about your current needs.
>> I want to be able to write Harbour applications as scripts or
>> binaries and distribute them in system friendly packages like
>> RPM or DEB. It means that I need Harbour installed in known
>> ...
>> which will keep some basic rules between platforms or we
>> will have serious problems with portability.
>
> I think we have 3 different situations:
>
> 1 - Linux
> well known and accepted standards like RPM and DEB and most of the
> dependences are available within the "official" repository ( f.e. zip,
> openssl, gd, postgresql, mysqll and so on )

Fine and really smooth.

But: What about (desktop) apps / components not included in
any official repository? (Google Earth, VBOX VM Additions,
certain drivers)

> 2 - Win
> here we have a standard way of install ( setup.exe ) but things get
> complicated since we support many different C compilers and there is
> no a simple way to get dependences

Most current packages takes the route to package everything
they need to a dir and ship that dir via std setup or simple
.zip file. Starts to become pretty clean for those apps
that provide a .zip too. Also see the "portable app" movement.

> 3 - OSX
> the tool that create packages comes with the OS but it's not easy to
> get dependences and there very few ( 2 ) users, also there are 2 arch
> ppc and Intel

Latter is no problem at all with Universal Binaries. It simply
means a longer build process on your side and a bigger disk
footprint on the user side.

Which is the tool you're referring to?

> Win it's completely different if a developer want to use msys/mingw (
> like me ) or other "native" compilers like MSVC xyx, BCC xyz, ....
> It's different where to get dependences and how to build programs (
> hb* scripts vs batch files )

I think we should separate the issues of building an
app and installing an app. Anyhow the build tools indeed
influence the final dependencies. For my case (if anyone
is interested) MinGW built stuff needs an extra MSVCRT.DLL,
while MSVC needs nothing. The app is dependent on openssl,
libssh, libcurl, libharu, libpng. All linked as static
libs to lessen any client-side problems.

Borland C is really problematic and it's not so much
supported for all above packages. So it's usually more
pain to build them, or to find anything prebuilt.

Building above stuff is even an exercise for MSVC and
MinGW. In contrary to Harbour f.e., shipped make files
needs to be manually tweaked for most packages.

> In OSX is even more complicated by the fact that we've only 2
> developers and at least for me with a very basic knowledge of the dev
> tools.
>
> Now it seems we're missing the main point:
> Why should a non-Clipper developer choose Harbour instead of PHP,
> Python, Java, .Net or whatever else? and how can Harbour attract other
> Linux, OSX, Win developers?
>
> Can we imagine an OSX developer that choose Harbour without a GUI?
> Can we imagine a web developer that choose Harbour without an Apache  
> module?
> Can we imagine an SQL developer that choose Harbour without an  
> Oracle module?
>
> I think we ( mostly you ) should define the goals and check where to
> find the resources to achieve them. If we're a small group of old
> Clipper developers that need to maintain its legacy apps than the goal
> was achieved with 1.0 if not it's time to make choices.

Questions are good. Personally I need Harbour to use my
existing code base and to avoid a painful rewrite (which
is pretty moot having been spent more time on Harbour
than a rewrite would have taken probably ;) It's not just
about time.

For new development... dunno how Harbour could make an
impact. It's good, but we cannot count on legacy
developers, plus, quite some parts are missing which are
already there in PHP. Yet the future seems web and server
side.

I hope someone will tell something more positive.

> However I'll start to look at the OSX packager and I'll report

Thanks.

Brgds,
Viktor

From druzus at acn.waw.pl  Tue Nov 18 15:27:44 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 18 15:26:29 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
References: <AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
	<CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
Message-ID: <20081118202744.GA17706@34-mo7-2.acn.waw.pl>

On Tue, 18 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>>         #!/usr/bin/hbrun
>>         proc main()
>>            alert( "Hello World!!!" )
>>         return
>>      I have big internet shop application which with hundreds
>>      CGI harbour scripts and it does not work with MacOSX.
> This should work regardless of our static vs. dynlib issue.
> So it's off topic.

No. It's pefectly related to your arguments.
Such scirpts needs strict hbrun localization.
The same is with shared library.
All your problems with shared library is the fact that you do
not put it in default OS directory.
So please explain me how you plan to make harbour binaries for MacOSX
which will put hbrun in /usr/bin and I'll kindly ask to make the same
with harbour*.dyn
Everything will work out of the box.
If there is sth else wrong with share libraries support in MacOSX
then it should be fixed. 99% of job is already done so I hope MacOSX
user can tune the rest. I'm sorry but I cannot make everything myself.
If it will be necessary then you can make system wide and user wide
installation. I hope that MacOSX has such functionality and it's not
necessary to install everything in each user account.
If you do not have working complex solution then please do not change
current behavior for your personal preferences because it highly possible
that such modificaiton will have to be reverted after user will have
adopted their code for it.
The only one think I want to ask you is to stop adding workarounds
but invest time in creating some final and working solution.

> I'm getting (with a private built hbrun which works):
> ---
> Error BASE/9995  Corruption detected: HB_HRBRUN
> Called from HB_HRBRUN(0)
> Called from _APPMAIN(0)
> ---
> Maybe something obvious from my side, this is the first
> time I tried hbrun this way on any platform.

It's standard RT error message when you try to execute sth what is not
valid .hrb file, f.e:
   hrbrun /bin/bash

by default any files which have different then .prg extension are executed
by hbrun directly as .hrb files.
In some *nixes it's possible to execute .hrb files directly as any other
binaries. It's enough to register their body prefix with exact hbrun
localization and set executable attribute for them.
If harbour will have support for extended .hrb (.hrl,.hre) formats
then I can create some scripts which enable such functionality in Linux.

best regards,
Przemek
From elart at elart.it  Tue Nov 18 15:48:14 2008
From: elart at elart.it (elart)
Date: Tue Nov 18 15:48:25 2008
Subject: [Harbour] I'm looking for some development gui,
	lib or tools for Linux...
Message-ID: <49232A0E.2080303@elart.it>

I'm using Ubuntu with Gnome and Harbour is working fine, thank you

I'm looking for some gui lib (gtk or qt ) for Harbour on Linux...

I want ask you about the HMG_Linux 
http://harbourminigui.googlepages.com/linux lib

i played with it http://www.hmgforum.com/viewtopic.php?f=8&t=156
removed all warning messages of the /hmg/samples/test demo app and it 
works...

It seems in at very early stage but i think may be very useful when it 
is mature.

Is there any tools to develop Harbour app using Glade...? i mean 
something like this:
http://robrohan.com/2007/05/21/linux-gui-programming-with-ruby/
http://xrob.wordpress.com/2007/04/20/creating-a-gui-application-using-glade-and-ruby/


I'm thinking of something like this:
- Glade as window designer ( it make as final result a .xml file )
- an Harbour prg compiled app to generate code from the Glade xml  ( 
something like the ruby-glade-create-template )
- the generate code must be simple so i'm searching for an high level 
gtk like HMG_Linux

Do you have some suggestions...?

Thank you

From druzus at acn.waw.pl  Tue Nov 18 16:03:50 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 18 16:02:34 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
References: <AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
Message-ID: <20081118210350.GB17706@34-mo7-2.acn.waw.pl>

On Tue, 18 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> Just to give a quick idea of the problem and one solution,
> I've just downloaded Google Earth for Linux, and after I've
> found out that the file GoogleEarthLinux.bin is a really a
> script which needs to be started from terminal (guess
> whether your mom / dad / gf / wife / sister could find this
> out).

It's not necessary to start it in terminal. It's enough to set
executable attribute for GoogleEarthLinux.bin (right mouse click,
preferences, mark executable box, then left mouse click will execute
the file).
By default all files downloaded by browser does not have such attribute
for rather clear security reasons.

> Anyhow, it turns out - miracle - that there is about
> 50MB worth of _static libs inside_, plus the executable.

There is no even single static library or binary in GoogleEarthLinux.bin.
All libraries and executable files are linked dynamically.
So it's rather bad example ;-)

> Is Google wrong?

Wrong with what?
They created package which can be installed by any user in his
home directory and have a copy of all system shared libraries
used by this application directly or indirectly by libraries
compiled with some extended support. They did not even rebuilt
used libraries without support for unnecessary stuff.
Just simply they put together everything what ldd shows as dependencies
and is not part of linux kernel in some directory then packed it using
tar/bzip2 and encapsulated in shell scripts (in similar way as it was
done by mpkg_tgz.sh before we disabled it due to problem with sed used
as extractor) using dedicated tool for packing and encapsulation
called Makeself.
Is it good? The question is for whom. Personally I do no like that
I will have copy of 40MB shared libraries in each user directory
and I'd prefer more system friendly installation which will use my
original libraries. The above looks for me like low cost fast solution.

best regards,
Przemek
From harbour.01 at syenar.hu  Tue Nov 18 16:36:52 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 16:37:00 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081118202744.GA17706@34-mo7-2.acn.waw.pl>
References: <AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
	<CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
	<20081118202744.GA17706@34-mo7-2.acn.waw.pl>
Message-ID: <D052692E-31CA-44CE-A442-A9B66CEE589A@syenar.hu>

>> This should work regardless of our static vs. dynlib issue.
>> So it's off topic.
>
> No. It's pefectly related to your arguments.
> Such scirpts needs strict hbrun localization.

Then, everyone who needs this functionality should
install Harbour. That's it.

> The same is with shared library.

Fine, but unrelated. Please don't force it to me if
I don't need it. So called "installation" is an alien
thing in OS X, whether you believe it or not. Harbour
is nothing more special than any user programs around
OS X, so it shouldn't behave differently, unless
someone wants to make it extremely complicated. Like you,
who admittedly don't deal with OS X at all.

> All your problems with shared library is the fact that you do
> not put it in default OS directory.

Yes, and this exactly how I intend to use it.

Please tell me (3rd time) how would I install Harbour 1.0.1
and Harbour 1.1.0dev at the same time then?

> So please explain me how you plan to make harbour binaries for MacOSX
> which will put hbrun in /usr/bin and I'll kindly ask to make the same
> with harbour*.dyn

I don't need these things. I want to build Harbour programs
and occasionally use hbrun, hbmk without tampering in any
OS dirs.

> Everything will work out of the box.

_I don't want to do sudo/install or any such tricks_.

I simply want to build/download and use it. I don't want
hbrun in scripts, nor .dylib access.

> If there is sth else wrong with share libraries support in MacOSX
> then it should be fixed. 99% of job is already done so I hope MacOSX
> user can tune the rest. I'm sorry but I cannot make everything myself.

The only thing wrong is that hbrun is dependent on it.

> If it will be necessary then you can make system wide and user wide
> installation. I hope that MacOSX has such functionality and it's not
> necessary to install everything in each user account.

I don't want installation. The solution is called static linking,
nothing else is needed, I have it working right here with a private
build. Only hbmk -static requirement is there as a remaining PITA.

> If you do not have working complex solution then please do not change
> current behavior for your personal preferences because it highly  
> possible
> that such modificaiton will have to be reverted after user will have
> adopted their code for it.

Sorry, I don't understand this sentence.

> The only one think I want to ask you is to stop adding workarounds
> but invest time in creating some final and working solution.

"stop adding workaround" means what? When did I start it?

I'd suggest you to deal with Linux, and I'll do my best
to make current Harbour work on OS X.

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 18 17:38:05 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 17:38:15 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081118210350.GB17706@34-mo7-2.acn.waw.pl>
References: <AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
	<20081118210350.GB17706@34-mo7-2.acn.waw.pl>
Message-ID: <A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>

>> Just to give a quick idea of the problem and one solution,
>> I've just downloaded Google Earth for Linux, and after I've
>> found out that the file GoogleEarthLinux.bin is a really a
>> script which needs to be started from terminal (guess
>> whether your mom / dad / gf / wife / sister could find this
>> out).
>
> It's not necessary to start it in terminal. It's enough to set
> executable attribute for GoogleEarthLinux.bin (right mouse click,
> preferences, mark executable box, then left mouse click will execute
> the file).
> By default all files downloaded by browser does not have such  
> attribute
> for rather clear security reasons.

Try to explain this for a novice user.

BTW, I'm still getting: 'Could no display "/home/...."'

I've finally started it from Terminal, so much about user
experience. (Ubuntu 8.10 BTW)

>> Anyhow, it turns out - miracle - that there is about
>> 50MB worth of _static libs inside_, plus the executable.
>
> There is no even single static library or binary in  
> GoogleEarthLinux.bin.
> All libraries and executable files are linked dynamically.
> So it's rather bad example ;-)

Okay, let's pick nits and let's try to avoid my point.
So sorry for saying the wrong word. They are _privately stored
dynamic libs_. Conceptually it's the exact same as if they were
linked right inside - staticly - to the executable. In any case
they are shipping the dynamic libs along with the executable and
storing them in the exact same directory. It's the same as if
hbrun would get shipped a harbour.dylib along with it in the same
dir, and if my app would ship with a local libssh2.so, instead
of using the OS one.

So physically they are separate but logically they belong together,
they are installed in one dir, and there is no additional/external
OS dependency.

>> Is Google wrong?
>
> Wrong with what?
> They created package which can be installed by any user in his
> home directory and have a copy of all system shared libraries
> used by this application directly or indirectly by libraries
> compiled with some extended support. They did not even rebuilt
> used libraries without support for unnecessary stuff.
> Just simply they put together everything what ldd shows as  
> dependencies
> and is not part of linux kernel in some directory then packed it using
> tar/bzip2 and encapsulated in shell scripts (in similar way as it was
> done by mpkg_tgz.sh before we disabled it due to problem with sed used
> as extractor) using dedicated tool for packing and encapsulation
> called Makeself.

It's just _almost_ similar to mpkg_tgz.sh, as Google Earth
will ask you wether to install in local dir (and where) or
to install in global dir requiring sudo rights.

This is BTW an almost perfect solution (apart from unstartable
download icon and the small hassle with 'install' phase) for
a desktop app, and I'd (as a simple user) expect most programs
work this way. [ Too bad this doesn't seem very typical to
Linux, I hope someone can prove me wrong though. ]

So Google did it right. If you look at OSX though, waste
majority of programs will not even require you to "install",
and "installation" is merely done by drag and dropping the app
icon from the downloaded disk image (.dmg) to your preferred
folder. A simple copy, that's it. Sometimes it's just a .tgz
automatically uncompressed and voila your app is right there,
you can move anywhere you want. "uninstall" is just moving your
app icon to the trash can.

> Is it good? The question is for whom. Personally I do no like that
> I will have copy of 40MB shared libraries in each user directory
> and I'd prefer more system friendly installation which will use my
> original libraries. The above looks for me like low cost fast  
> solution.

Przemek, sorry to inform you but you don't represent
the majority of human population when it comes to computing
skills, so while I understand you concern about disk space,
most ppl will just be willing to spend $60 on a 500GB HDD and
forget about the space issue. Probably I don't represent
an average user either, but I simply love the fact in OS X
that you can just "install"/"uninstall" like described above,
and besides being extremely straightforward it also doesn't
allow for any crap to just pile up under the hood, like
most ppl got used to it on Windows. Users can also have
several different versions of the same program installed
at the same time (like the next beta, previous working
version etc), all they need to do is rename one of the icons
to something different. "Switching" between these multiple
versions is also a no brainer. For app developers it gives
a much cleaner environment, with known and tested component
versions and so on.

That's what I'd like to have with Harbour too (on OSX).
I'd prefer this for Linux too, but there unfortunately,
and in contrary to OSX, the 'when in Rome' rule seems
pretty much against it, so I'll live with that.

[ I know Harbour is a compiler not a desktop app for end
users, but I see no reason to give up good OS X practices
and introduce unnecessary and obligatory complexities
just because. Most ppl, even developers have better things
to do than wrestling with tools. ]

Brgds,
Viktor

From harbour.01 at syenar.hu  Tue Nov 18 17:42:44 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Tue Nov 18 17:42:54 2008
Subject: [Harbour] FW: [Harbour-users] Mac OS 10.5.5 "dyld: Library not
	loaded:libharbour.1.dylib"
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F1AB@SRV02.deltain.net>
References: <AFB948164110ED43B5EB849E8DEEF03815F1AB@SRV02.deltain.net>
Message-ID: <A47C6725-C698-4698-A3D8-C673683C3321@syenar.hu>

I've answered to this list yesterday evening.

Please read it, and if you can, answer on the user list.

Brgds,
Viktor

On 2008.11.17., at 15:20, Massimo Belgrano wrote:

> Will one of mac OS user give a reply on user list?
>
> -----Original Message-----
> From: harbour-users-bounces@harbour-project.org
> [mailto:harbour-users-bounces@harbour-project.org] On Behalf Of
> harbour-users@harbour-project.org
> Sent: Friday, November 14, 2008 2:08 PM
> To: harbour-users@harbour-project.org
> Subject: [Harbour-users] Mac OS 10.5.5 "dyld: Library not
> loaded:libharbour.1.dylib"
>
> Hello,
>
> I have just downloaded the Mac OS binary 1.0.1.
>
> After I copied the files to /usr/ and /private, I tried running a
> sample program:
>
> jan$ hbrun helloworld.prg
>
> and got the following error:
> dyld: Library not loaded: libharbour.1.dylib
>   Referenced from: /usr/local/bin/hbrun
>   Reason: image not found
> Trace/BPT trap
>
> Is there anything else I have to do to load the library?
>
> Thanks a lot for your help
>
> Jan
> _______________________________________________
> Harbour-users mailing list
> Harbour-users@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour-users
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From druzus at acn.waw.pl  Tue Nov 18 18:56:34 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 18 18:55:19 2008
Subject: [Harbour] I'm looking for some development gui, lib or tools
	for Linux...
In-Reply-To: <49232A0E.2080303@elart.it>
References: <49232A0E.2080303@elart.it>
Message-ID: <20081118235634.GA17181@34-mo7-2.acn.waw.pl>

On Tue, 18 Nov 2008, elart wrote:

Hi,

> I'm using Ubuntu with Gnome and Harbour is working fine, thank you
> I'm looking for some gui lib (gtk or qt ) for Harbour on Linux...
> I want ask you about the HMG_Linux 
> http://harbourminigui.googlepages.com/linux lib
> i played with it http://www.hmgforum.com/viewtopic.php?f=8&t=156
> removed all warning messages of the /hmg/samples/test demo app and it 
> works...
> It seems in at very early stage but i think may be very useful when it is 
> mature.

I cannot say anything about HMG - I do not know it.
>
> Is there any tools to develop Harbour app using Glade...? i mean something 
> like this:
> http://robrohan.com/2007/05/21/linux-gui-programming-with-ruby/
> http://xrob.wordpress.com/2007/04/20/creating-a-gui-application-using-glade-and-ruby/
> I'm thinking of something like this:
> - Glade as window designer ( it make as final result a .xml file )
> - an Harbour prg compiled app to generate code from the Glade xml  ( 
> something like the ruby-glade-create-template )
> - the generate code must be simple so i'm searching for an high level gtk 
> like HMG_Linux
> Do you have some suggestions...?

Look at xhgtk project.
You can also look at xbgtk which is rather automatized [x]harbour
library generator for GTK API.

best regards,
Przemek
From druzus at acn.waw.pl  Tue Nov 18 23:47:34 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 18 23:46:17 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>
References: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
	<20081118210350.GB17706@34-mo7-2.acn.waw.pl>
	<A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>
Message-ID: <20081119044734.GA31336@34-mo7-2.acn.waw.pl>

On Tue, 18 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

>>> Anyhow, it turns out - miracle - that there is about
>>> 50MB worth of _static libs inside_, plus the executable.
>> There is no even single static library or binary in GoogleEarthLinux.bin.
>> All libraries and executable files are linked dynamically.
>> So it's rather bad example ;-)
> Okay, let's pick nits and let's try to avoid my point.
> So sorry for saying the wrong word. They are _privately stored
> dynamic libs_. Conceptually it's the exact same as if they were
> linked right inside - staticly - to the executable. In any case
> they are shipping the dynamic libs along with the executable and
> storing them in the exact same directory. It's the same as if
> hbrun would get shipped a harbour.dylib along with it in the same
> dir, and if my app would ship with a local libssh2.so, instead
> of using the OS one.
> So physically they are separate but logically they belong together,
> they are installed in one dir, and there is no additional/external
> OS dependency.

I do not see any way that you may change you preferences.
Inside the start script of this applications you have all
settings necessary in any *nix like system to create custom
shared library set you were asking in the past. You do not
see it but you are finding it as confirmation for keeping
static builds. As Marek said few times in the past we can
talk but you will make what you want.
Please do it. I believe you will create perfect installation
packages for MacOSX, created by f.e. mpkg_macosx.sh.
You will check how and where perl, python, gcc and other
languages are installed in MacOSX, if necessary you will
consult the localization and installation form with some
MacOSX gurus and the result will make all MacOSX users
happy. Please only be so kind and do not change existing
functionality as long as this alternative version will
not be ready.
I'll commit small modification for hb-func.sh so you will
be able to easy control default -static/-shared switch state
in final hb* scripts. And I'll reactivate the envelope code
use in mpkg_tgz.sh using some other textutil/fileutil commands
which should work with most of POSIX systems. I hope they will
work also for MaxOSX so it should help you if you will need
some simple installer. This is all what I can do. Other work
on MaxOSX installer will have to be done by real MacOSX users
in new MaxOSX build script. For me this closes the subject.

best regards,
Przemek
From druzus at acn.waw.pl  Wed Nov 19 00:27:31 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 19 00:26:15 2008
Subject: [Harbour] 2008-11-19 06:27 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081119052731.GA650@34-mo7-2.acn.waw.pl>

2008-11-19 06:27 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/bin/hb-func.sh
    * updated OS release version checking for new OpenSuse distros
    * removed r from uname parameters used in get_hbplatform() function
    + added support for HB_MK_STATIC=yes|no envvar which allows to control
      default -static/-shared hbmk switch. It should be set before hb*
      scripts are created

  * harbour/harbour.spec
    * updated OS release version checking for new OpenSuse distros

  * harbour/mpkg_tgz.sh
    * changed installer envelope code to not use 'sed' and reenabled it
      in default builds. Now it should work with different *nixes.
      Please test.

best regards
Przemek
From lorenzo.fiorini at gmail.com  Wed Nov 19 01:09:33 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Nov 19 01:09:37 2008
Subject: [Harbour] HB_EXT_INKEY or KEYREAD()
In-Reply-To: <20563360.post@talk.nabble.com>
References: <20563360.post@talk.nabble.com>
Message-ID: <9257026e0811182209n600070d1qf179cd4b9765eeec@mail.gmail.com>

On Tue, Nov 18, 2008 at 5:42 PM, Abeb <abe.buch@att.net> wrote:

> In xharbour they have HB_EXT_INKEY if defined lastkey() will return some
> other value than page-up)
>
> What is there available in Harbour?

The same, HB_EXT_INKEY

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Wed Nov 19 01:39:00 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Nov 19 01:39:03 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
	<CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
Message-ID: <9257026e0811182239v26d06e8apb66c2b3426456a0d@mail.gmail.com>

On Tue, Nov 18, 2008 at 7:38 PM, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
> Hi Przemek,
>
>>  1. Why I cannot execute this simple scrpit in MacOSX port:
>>
>>        #!/usr/bin/hbrun
>>        proc main()
>>           alert( "Hello World!!!" )
>>        return
>>
>>     I have big internet shop application which with hundreds
>>     CGI harbour scripts and it does not work with MacOSX.
>
> This should work regardless of our static vs. dynlib issue.
> So it's off topic.
>
> I'm getting (with a private built hbrun which works):
> ---
> Error BASE/9995  Corruption detected: HB_HRBRUN
> Called from HB_HRBRUN(0)
> Called from _APPMAIN(0)
> ---
>
> Maybe something obvious from my side, this is the first
> time I tried hbrun this way on any platform.
>
>>> Also, I have an OSX port of my apps running/building fine
>>> without any need to install stuff in /opt /usr or any other
>>> such non-user locations, or setup envvar or do any global
>>> configuration whatsoever. So the issue is really only hbrun,
>>> hbtest and hbmk behavior. [ None of these is needed for my
>>> project. ]
>>
>> The fact that you are using Harbour in very limited way like
>> in Windows it does not mean that you have rights to force
>> such usage also for other users.
>
> Some facts please. Denying me isn't one.
>
>>>> That's true, but if we provide binaries, I'm not sure there
>>>
>>> is a point to limit its usage by using it as a showcase or
>>> to target some other academic goals, or try to replicate
>>> customs from other systems.
>>
>> I do not agree. You both are thinking only about your current needs.
>> I want to be able to write Harbour applications as scripts or
>> binaries and distribute them in system friendly packages like
>> RPM or DEB. It means that I need Harbour installed in known
>> for OS and package manager way so dependencies will be check
>> automatically and if necessary user can download also Harbour
>> shared libraries or whole compiler and install them in his
>> system. F.e. I can write new bittorent client as Harbour
>> application. We do not have to build binaries but we have to
>> create system where such binaries are easy to create.
>
> Future needs aside, it's not working now.
>
> I couldn't care less if there was however Harbour
> packages distributed for OS X, but _they should work
> out of the box_. A simple .zip file distribution should
> also work out of the box, and if you want to create
> such complicated dependency check or installer, or
> MacPorts packages so be it, but the default install
> (the only one we currently seem to have), should also
> work out of the box, without additional trickery, sudo,
> envvars, copying, you name it, and current package is
> essentially a .zip file.

Here are the installetion steps for Oracle Client in OSX taken from
http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/intel_macsoft.html:

....

1. See the installation guide for all system requirements.

2. Download the appropriate Instant Client packages for your platform.
All installations REQUIRE the Basic package.

3. Unzip the packages into a single directory such as "instantclient".

4. Set the library loading path in your environment to the directory
in Step 2 ("instantclient"). On the Macintosh OSX platform,
DYLD_LIBRARY_PATH is the appropriate environment variable.

5. Start your application and enjoy.

.....

Is Oracle wrong? :)

However here is a good place to start:
http://developer.apple.com/documentation/DeveloperTools/Conceptual/SoftwareDistribution/SoftwareDeliveryGuide.pdf

best regards,
Lorenzo
From harbour.01 at syenar.hu  Wed Nov 19 03:05:24 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 03:05:31 2008
Subject: [Harbour] 2008-11-19 09:04 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94a1d$Blat.v2.6.2$93a5feea$b884eadf282@127.0.0.1>

2008-11-19 09:04 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * bin/hb-func.sh
  * mpkg_tgz.sh
    ! Fixed OSX/Darwin builds:
      - to not require harbour.dylib for binary tools supplied 
        in .tgz package. This way, hbrun/hbmake/hbdoc/hbtest 
        will work out of the box without the need for any 
        special installation or extra manual procedure, or 
        any change whatsoever in the user/system environment. 
        The change also doesn't prevent user installing Harbour 
        to system dirs and/or to utilize harbour.dylib in every way.
      - so that hbmk script creates '-static' executables by default.
        This will make all programs created by hbmk to work out of the 
        box without any special trick described above, or explicit 
        need to use '-static' switch.
        You can override this with '-shared' switch.
      ; [ The price to pay is slightly larger binary package 
          and executable sizes. ]

  * make_gnu.sh
    * Minor sync in help text with recent change.

  * common.mak
    ! Old typo.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 19 03:36:49 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 03:36:57 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <20081119044734.GA31336@34-mo7-2.acn.waw.pl>
References: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
	<20081118210350.GB17706@34-mo7-2.acn.waw.pl>
	<A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>
	<20081119044734.GA31336@34-mo7-2.acn.waw.pl>
Message-ID: <DCECE651-F492-4991-B389-4BB701070A38@syenar.hu>

Hi Przemek,

> I do not see any way that you may change you preferences.

Yes, and you seemingly cannot accept that these
preferences can have valid grounds or they they
may even exist, at the same time you simply ignore
them without adding arguments.

Questions/facts you've ignored:
- How to install two Harbour versions in parallel with installation  
technique?
- How to use Harbour without admin/sudo rights with installation  
technique?
   (suppose I'm on someone else's PC, or I'd like to ship a software
   which includes Harbour, but I wouldn't like to ask for an admin pw
   on installation)
- How to move around a Harbour devl environment with installation  
technique?
   (say, onto an external disk or USB drive, or to a backup disk)
- There is no native package manager in OSX.

[ First three applies to Linux and probably other Unixes too BTW. ]

> Inside the start script of this applications you have all
> settings necessary in any *nix like system to create custom
> shared library set you were asking in the past. You do not
> see it but you are finding it as confirmation for keeping
> static builds. As Marek said few times in the past we can
> talk but you will make what you want.

I'm talking, and you don't seem to read. You pick some
personal parts, react to it by trying to question my
competency, and ignore the points. Maybe my English is bad,
maybe my points are stupid to such extent in your mind,
maybe something else, hard to tell.

> Please do it. I believe you will create perfect installation
> packages for MacOSX, created by f.e. mpkg_macosx.sh.

As I've said I'm not interested in "installation".

> You will check how and where perl, python, gcc and other
> languages are installed in MacOSX, if necessary you will

These are native packages (part of the OS), so there
is no need to install them. If you need another version
of them, you have to choose a 3rd party package manager
and install them to different (than OS) locations, or
probably you can try to build them yourself.

> consult the localization and installation form with some
> MacOSX gurus and the result will make all MacOSX users
> happy. Please only be so kind and do not change existing
> functionality as long as this alternative version will
> not be ready.
> I'll commit small modification for hb-func.sh so you will
> be able to easy control default -static/-shared switch state
> in final hb* scripts. And I'll reactivate the envelope code
> use in mpkg_tgz.sh using some other textutil/fileutil commands
> which should work with most of POSIX systems. I hope they will
> work also for MaxOSX so it should help you if you will need
> some simple installer. This is all what I can do. Other work
> on MaxOSX installer will have to be done by real MacOSX users
> in new MaxOSX build script. For me this closes the subject.

Nice and thanks, but this didn't solve the problem of those
who wish to install to different than OS location, or not
to wish to install at all.

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 19 03:47:04 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 03:47:12 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <9257026e0811182239v26d06e8apb66c2b3426456a0d@mail.gmail.com>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
	<CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
	<9257026e0811182239v26d06e8apb66c2b3426456a0d@mail.gmail.com>
Message-ID: <C9244199-119D-4FD5-9880-24D38C6AA184@syenar.hu>

> Here are the installetion steps for Oracle Client in OSX taken from
> http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/intel_macsoft.html 
> :
>
> ....
>
> 1. See the installation guide for all system requirements.
>
> 2. Download the appropriate Instant Client packages for your platform.
> All installations REQUIRE the Basic package.
>
> 3. Unzip the packages into a single directory such as "instantclient".
>
> 4. Set the library loading path in your environment to the directory
> in Step 2 ("instantclient"). On the Macintosh OSX platform,
> DYLD_LIBRARY_PATH is the appropriate environment variable.
>
> 5. Start your application and enjoy.
>
> .....
>
> Is Oracle wrong? :)

They could have done much worse. Maybe above could have
been improved either, but it's difficult to tell their
priorities from here, they must have their own reasons.
If they must use .dylibs or their users must use them,
or the majority of their users needs them, that's probably
the least impact solution which can solve the problem.

IOW I've never said this is not a solution per se, just as
I've never said .dylibs are something evil. Simply, some
users may no want to put with it, so if possible without
major drawbacks, it's a plus to avoid it and let it
"just work".

Above is still a working and viable possibility for any
Harbour apps built to use harbour.dylib. Nobody loses
anything.

Brgds,
Viktor

From maurilio.longo at libero.it  Wed Nov 19 05:11:42 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Wed Nov 19 05:11:48 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <9257026e0811182239v26d06e8apb66c2b3426456a0d@mail.gmail.com>
References: <20535315.post@talk.nabble.com>	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>	<CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
	<9257026e0811182239v26d06e8apb66c2b3426456a0d@mail.gmail.com>
Message-ID: <4923E65E.1070804@libero.it>

I think in this discussion you are mixing an end-user app, like google-earth,
and a compiler, like harbour.

I think that compilers come with package installer (instead of being a
packaged app, like, for example, a browser) and the installer puts libraries
where they have to go, see for example neooffice which has such an 'extended'
installer.

So, harbour needs this 'extended' installer to put libraries in the correct
folder and different versions will have libraries with different version
extensions, like in linux.

Regards.

Maurilio.

Lorenzo Fiorini wrote:
> On Tue, Nov 18, 2008 at 7:38 PM, Szak?ts Viktor <harbour.01@syenar.hu> wrote:
>> Hi Przemek,
>>
>>>  1. Why I cannot execute this simple scrpit in MacOSX port:
>>>
>>>        #!/usr/bin/hbrun
>>>        proc main()
>>>           alert( "Hello World!!!" )
>>>        return
>>>
>>>     I have big internet shop application which with hundreds
>>>     CGI harbour scripts and it does not work with MacOSX.
>> This should work regardless of our static vs. dynlib issue.
>> So it's off topic.
>>
>> I'm getting (with a private built hbrun which works):
>> ---
>> Error BASE/9995  Corruption detected: HB_HRBRUN
>> Called from HB_HRBRUN(0)
>> Called from _APPMAIN(0)
>> ---
>>
>> Maybe something obvious from my side, this is the first
>> time I tried hbrun this way on any platform.
>>
>>>> Also, I have an OSX port of my apps running/building fine
>>>> without any need to install stuff in /opt /usr or any other
>>>> such non-user locations, or setup envvar or do any global
>>>> configuration whatsoever. So the issue is really only hbrun,
>>>> hbtest and hbmk behavior. [ None of these is needed for my
>>>> project. ]
>>> The fact that you are using Harbour in very limited way like
>>> in Windows it does not mean that you have rights to force
>>> such usage also for other users.
>> Some facts please. Denying me isn't one.
>>
>>>>> That's true, but if we provide binaries, I'm not sure there
>>>> is a point to limit its usage by using it as a showcase or
>>>> to target some other academic goals, or try to replicate
>>>> customs from other systems.
>>> I do not agree. You both are thinking only about your current needs.
>>> I want to be able to write Harbour applications as scripts or
>>> binaries and distribute them in system friendly packages like
>>> RPM or DEB. It means that I need Harbour installed in known
>>> for OS and package manager way so dependencies will be check
>>> automatically and if necessary user can download also Harbour
>>> shared libraries or whole compiler and install them in his
>>> system. F.e. I can write new bittorent client as Harbour
>>> application. We do not have to build binaries but we have to
>>> create system where such binaries are easy to create.
>> Future needs aside, it's not working now.
>>
>> I couldn't care less if there was however Harbour
>> packages distributed for OS X, but _they should work
>> out of the box_. A simple .zip file distribution should
>> also work out of the box, and if you want to create
>> such complicated dependency check or installer, or
>> MacPorts packages so be it, but the default install
>> (the only one we currently seem to have), should also
>> work out of the box, without additional trickery, sudo,
>> envvars, copying, you name it, and current package is
>> essentially a .zip file.
> 
> Here are the installetion steps for Oracle Client in OSX taken from
> http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/intel_macsoft.html:
> 
> ....
> 
> 1. See the installation guide for all system requirements.
> 
> 2. Download the appropriate Instant Client packages for your platform.
> All installations REQUIRE the Basic package.
> 
> 3. Unzip the packages into a single directory such as "instantclient".
> 
> 4. Set the library loading path in your environment to the directory
> in Step 2 ("instantclient"). On the Macintosh OSX platform,
> DYLD_LIBRARY_PATH is the appropriate environment variable.
> 
> 5. Start your application and enjoy.
> 
> .....
> 
> Is Oracle wrong? :)
> 
> However here is a good place to start:
> http://developer.apple.com/documentation/DeveloperTools/Conceptual/SoftwareDistribution/SoftwareDeliveryGuide.pdf
> 
> best regards,
> Lorenzo
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From harbour.01 at syenar.hu  Wed Nov 19 05:39:23 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 05:39:35 2008
Subject: [Harbour] OS X installer
In-Reply-To: <9257026e0811180924y7cd65820re61839f81dc235f@mail.gmail.com>
References: <20535315.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1AA@SRV02.deltain.net>
	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>
	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>
	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
	<9257026e0811180924y7cd65820re61839f81dc235f@mail.gmail.com>
Message-ID: <3E840369-4D0C-4ED9-9709-D8E204995861@syenar.hu>

> However I'll start to look at the OSX packager and I'll report

It's .pkg. This is a format with similar capabilities to .tgz,
but it pops an install UI when clicked on the desktop. It's the
file format used by OS X native installer app (like .msi on Windows).
A .pkg is sometimes packaged in a .dmg for distribution.
There exists also a console command to launch it. It supports
launching pre/post scripts, too.

This is not a "package manager" though, as it won't automatically
do any such things as checking dependencies, counting references
or use external repositories. It seems to support some sort of
central database, but when I use 'pkgutil --packages' it will
only list Apple ones (while I have some 3rd party ones for sure).
There is no native UI or shell cmd to _uninstall_ installed packages
either.

Theoretically it supports installation to any dirs, not just the
root, but I haven't seen such option in practice yet. It's most of
the times used when vendor wants to install .kext, Frameworks or
some other stuff in root / system dirs, or multiple dirs, besides
the usual .app and other components otherwise easily installable
by users themselves (f.e. .prefpanes). Overall in OSX .pkg is
rarely used for desktop apps, and for these it's considered bad
practice. To help removal of such packages, and to verify what
they actually do, it's always possible to get a list of to be
installed files.

The command to create a .pkg is 'packagemaker'.

This is the closest thing you can get on native OS X.

[ Probably Harbour should support it over current .sh/.tgz
solution. Personally I'm not interested though. ]

Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov 19 07:54:18 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 19 07:53:02 2008
Subject: [Harbour] 2008-11-19 09:04 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
In-Reply-To: <01c94a1d$Blat.v2.6.2$93a5feea$b884eadf282@127.0.0.1>
References: <01c94a1d$Blat.v2.6.2$93a5feea$b884eadf282@127.0.0.1>
Message-ID: <20081119125418.GA23061@34-mo7-2.acn.waw.pl>

On Wed, 19 Nov 2008, Szak?ts Viktor wrote:

Hi Viktor,

> 2008-11-19 09:04 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
>   * bin/hb-func.sh
>   * mpkg_tgz.sh
>     ! Fixed OSX/Darwin builds:
>       - to not require harbour.dylib for binary tools supplied 
>         in .tgz package. This way, hbrun/hbmake/hbdoc/hbtest 
>         will work out of the box without the need for any 
>         special installation or extra manual procedure, or 
>         any change whatsoever in the user/system environment. 
>         The change also doesn't prevent user installing Harbour 
>         to system dirs and/or to utilize harbour.dylib in every way.
>       - so that hbmk script creates '-static' executables by default.
>         This will make all programs created by hbmk to work out of the 
>         box without any special trick described above, or explicit 
>         need to use '-static' switch.
>         You can override this with '-shared' switch.
>       ; [ The price to pay is slightly larger binary package 
>           and executable sizes. ]

Please remove it and create separate file for MacOSX builds.
I can accept that you have different personal preferences
but I cannot agree that you are forcing them for all other
Harbour users and you do not give any chance to work and
tests default shared builds. This is unacceptable and free
project. I aksed you few time to not change.
The above does not fix anything. It only change the behavior
to sth what you prefer. So please create seprate file for it.
In the last commit I even gave you any easy way to control
the default behavior so you can easy make it.

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Nov 19 08:10:21 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 08:10:43 2008
Subject: [Harbour] 2008-11-19 13:51 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94a48$Blat.v2.6.2$2d1e7ea6$e74ca8f1ea8@127.0.0.1>

2008-11-19 13:51 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * common.mak
  * make_b32.mak
  * make_gcc.mak
  * make_vc.mak
    * Smoothened the difference between HARBOURFLAGS and 
      HARBOURFLAGSDLL under the name HARBOURFLAGSLIB.
      Now all core .prg modules will be compiled with -n1 
      Harbour switch. This also means double compilation 
      of .prg modules for static/dynamic libs could be 
      optimized out as the object files are the same in 
      both modes.
      TODO: Make -n1 switch unnecessary.

  * contrib/mtpl_gcc.mak
    + Added -n1 to HARBOURFLAGS. This way Harbour functions 
      in libs will never be considered as entry points in 
      executables or when any such module is built as dynamic 
      lib in the future.

  * contrib/make_gcc_all.sh
    * Minor formatting.
--
Brgds,
Viktor

From lostmyhearttoher at gmail.com  Wed Nov 19 09:09:19 2008
From: lostmyhearttoher at gmail.com (Lost Heartless)
Date: Wed Nov 19 09:09:24 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <DCECE651-F492-4991-B389-4BB701070A38@syenar.hu>
References: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
	<20081118210350.GB17706@34-mo7-2.acn.waw.pl>
	<A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>
	<20081119044734.GA31336@34-mo7-2.acn.waw.pl>
	<DCECE651-F492-4991-B389-4BB701070A38@syenar.hu>
Message-ID: <9dfb0af50811190609s3317d4b0g879171dc347b150@mail.gmail.com>

Hi, guys.

On 2008/11/19 Szak?ts Viktor <harbour.01@syenar.hu> wrote

> - How to install two Harbour versions in parallel with installation technique?

You can use HB_INSTALL_PREFIX to specify a local path.

>
> - How to use Harbour without admin/sudo rights with installation technique?
>  (suppose I'm on someone else's PC, or I'd like to ship a software
>  which includes Harbour, but I wouldn't like to ask for an admin pw
>  on installation)

Please assume you installed to $HOME/hbdevel, and that you are currently
in the root Harbour directory (where make_gnu.sh is)

(all of the following is a single line)

HB_INSTALL_PREFIX="$HOME/hbdevel" ./make_gnu.sh install

Then, to use the hb* tools, you can for example:

cd tests
LD_RUN_PATH="$HOME/hbdevel/lib" $HOME/hbdevel/bin/hbmk adirtest && ./adirtest

No need for admin rights. I hope the idea is clear...

> - How to move around a Harbour devl environment with installation technique?
>  (say, onto an external disk or USB drive, or to a backup disk)

Adjust LD_RUN_PATH accordingly.

HTH.
Best regards.

Lost
From mbelgrano at deltain.it  Wed Nov 19 10:43:18 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Wed Nov 19 10:44:23 2008
Subject: [Harbour] FW: [Harbour-users] Filestats of xHarbour
In-Reply-To: <AF2BE2CF-C6AF-41EE-8807-218A10C8A4D5@syenar.hu>
References: <AFB948164110ED43B5EB849E8DEEF03815F1B3@SRV02.deltain.net>
	<AF2BE2CF-C6AF-41EE-8807-218A10C8A4D5@syenar.hu>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1CF@SRV02.deltain.net>

I vote for adding to xhb.lib
IMO is Better having a xhb.lib more compatible with xharbour program

-----Original Message-----
From: harbour-bounces@harbour-project.org [mailto:harbour-bounces@harbour-project.org] On Behalf Of Szak?ts Viktor
Sent: Tuesday, November 18, 2008 11:30 AM
To: Harbour Project Main Developer List.
Subject: Re: [Harbour] FW: [Harbour-users] Filestats of xHarbour

> Harbour have not ported filestat function ?

No, but this function could be added to xhb.lib as is.

As a replacement, we have Directory() and hb_FSize().
Probably separate hb_FAttrSet()/hb_FAttrGet() would be nice to have.

Brgds,
Viktor

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From bedipritpal at hotmail.com  Wed Nov 19 11:42:18 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov 19 11:42:23 2008
Subject: [Harbour] MinGW Build Process - Few Clarifications
Message-ID: <20583844.post@talk.nabble.com>


Hello All

I am playing with MinGW with MSYS.

Everything is fine except few points below which 
I suspect more belongs to my poor general-knowledge
and IQ.

1) ./make_gnu.sh install creates hbmk.sh in bin folder, <hbwin> is not 
    included in the default library list.  I tried to locate where I have to 
   update this information but am at a loss. It is important for demowvg.prg
   to convert to executable. What I do that I change the lib list in hbmk.sh 
   manually after each build.

2) What is the rule/procedure to build only a single contrib library?
   Now I have to issue from the /c/harbour ./make_gnu.sh install everytime 
   I make a change to the source. Then I change hbmk.sh in bin folder. Then
I 
   compile demowvg.prg. A long edit/compile/link/execute cycle.

I am sure I am not doing somethings right.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/MinGW-Build-Process---Few-Clarifications-tp20583844p20583844.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From harbour.01 at syenar.hu  Wed Nov 19 12:16:16 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 12:16:19 2008
Subject: [Harbour] 2008-11-19 18:14 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94a6a$Blat.v2.6.2$882f5744$b5063f37f1c@127.0.0.1>

2008-11-19 18:14 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * source/codepage/cpuakoi.c
    ! Fixed CP reference to point to KOI8-U instead of KOI8.
      Reasons: 1) KOI8-U was used in the _comment_.
               2) Ukrainian quasi standard is KOI8-U instead of KOI8.
                  http://aspell.net/charsets/cyrillic.html
               3) CP KOI8-U wasn't used previously anywhere, yet 
                  was added by same author.
      I hope the author (Pavel Tsarenko) will be able to verify 
      this change.
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 19 13:35:56 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 13:35:59 2008
Subject: [Harbour] 2008-11-19 19:30 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94a75$Blat.v2.6.2$a9424e36$17748eee1248@127.0.0.1>

2008-11-19 19:30 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * include/hbapi.h
  * source/vm/extend.c
    + Added hb_stordl() which is similar to hb_stords() but 
      accepts a Julian date in long numeric format similarly 
      to hb_retdl().

  * contrib/xhb/Makefile
  * contrib/xhb/common.mak
  + contrib/xhb/filestat.c
    + Added FILESTATS() function.
      Work of Giancarlo Niccolai / xhb.
      Minor cleanups made.
    ; Please test. (Only Win32/BCC platform was tested.)
--
Brgds,
Viktor

From druzus at acn.waw.pl  Wed Nov 19 14:26:16 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 19 14:24:58 2008
Subject: [Harbour] MinGW Build Process - Few Clarifications
In-Reply-To: <20583844.post@talk.nabble.com>
References: <20583844.post@talk.nabble.com>
Message-ID: <20081119192616.GA23930@34-mo7-2.acn.waw.pl>

On Wed, 19 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> I am playing with MinGW with MSYS.
> Everything is fine except few points below which 
> I suspect more belongs to my poor general-knowledge
> and IQ.
> 1) ./make_gnu.sh install creates hbmk.sh in bin folder, <hbwin> is not 
>     included in the default library list.  I tried to locate where I have to 
>    update this information but am at a loss. It is important for demowvg.prg
>    to convert to executable. What I do that I change the lib list in hbmk.sh 
>    manually after each build.

Looks that not all Harbour parts were updated for modifications
in environment variables and library names.
Look at function mk_hbgetlibsctb() in bin/hb-func.sh
It has list of contrib libraries. hbw32 should be changed to hbwin.

> 2) What is the rule/procedure to build only a single contrib library?
>    Now I have to issue from the /c/harbour ./make_gnu.sh install everytime 
>    I make a change to the source. Then I change hbmk.sh in bin folder. Then
> I  compile demowvg.prg. A long edit/compile/link/execute cycle.

It's very easy. In GNU make you can work with single library only.
It's one of the most important functionality for me which does not
exists in other make files. Just simply set two environment variables:
   export HB_ARCHITECTURE=w32
   export HB_COMPILER=mingw

When they are set you can execute in each directory make command
and modified files will be recompiled and new libraries will be
created in harbour/lib/$HB_ARCHITECTURE/$HB_COMPILER without
touching any other things. If you want to rebuild whole library
then you can simply execute:
   make clean
it will erase (clean) on files related to library in the directory
you are working on without touch other code.
If you want to also install new library in given place then you should
set additional environment variable HB_LIB_INSTALL. If this variable
has some header files then you should also set HB_INC_INSTALL and if
some executable are also created and you want to install them then
HB_BIN_INSTALL is necessary. Yo can simply set all 3 variables, f.e.:
   export HB_BIN_INSTALL="/c/harbour/mingw/bin"
   export HB_INC_INSTALL="/c/harbour/mingw/include"
   export HB_LIB_INSTALL="/c/harbour/mingw/lib"

and then
   make install
will work for any type of Harbour code.
When you executed make command then it works for given directory and all
subdirectoried. So when you execute it in harbour/source/rtl then he will
operate on rtl library and all GTs libraries which are in
harbour/source/rtl/gt* directoris, f.e.:
   make clean
will clean rtl and all core GTs. make clean does not remove files
from final destination directories pointed by HB_*_INSTALL envvars
but only from Harbour source tree.
You can put all these environment variables in single script which
you may use to set you environment, f.e. in myhbsets.sh
   #!/bin/sh
   export HB_ARCHITECTURE=w32
   export HB_COMPILER=mingw
   export HB_BIN_INSTALL="/c/harbour/mingw/bin"
   export HB_INC_INSTALL="/c/harbour/mingw/include"
   export HB_LIB_INSTALL="/c/harbour/mingw/lib"

but please remember about one thing. In *nix like shells each
script operates on its own environment inherited from parent
process. It means that executing such scripts directly:
   ./myhbsets.sh
will not change your environment variables. You have to "include"
it to current shell. It can be done by adding dot (.) and space
before script name, f.e.:
   . ./myhbsets.sh

In such form the variables will be set in current shell instance.
You can check it using simple 'set' command without parameters.
People who used to work with DOS/Windows very often forget about
the fact that *nix shells looks for programs to execute _ONLY_ in
directories which are in PATH envvar. It's the reason why simply
   my_prog
does not work when my_prog is located in current directory. If you
do not like it then you can add current directory '.' to PATH envvar.
It's not set by default for important security reasons so it's not
good practice. For sure it should never be done in production environment
on machine with multiuser access. If you want to make it for you own
use then please add '.' at the end of path so programs in local directory
will not have higher priority then system ones. You can make it by:
   export PATH="$PATH:."
In *nixes path delimiter is ":" not ";" like in DOS/Windows.

I hope that above information will help you to start working
with *nix like shells and Harbour. There are also many other
possibilities but too much information at once can cause that
it may look more complicated then it really is.

best regards,
Przemek
From harbour.01 at syenar.hu  Wed Nov 19 15:27:38 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 15:27:49 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <9dfb0af50811190609s3317d4b0g879171dc347b150@mail.gmail.com>
References: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
	<20081118210350.GB17706@34-mo7-2.acn.waw.pl>
	<A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>
	<20081119044734.GA31336@34-mo7-2.acn.waw.pl>
	<DCECE651-F492-4991-B389-4BB701070A38@syenar.hu>
	<9dfb0af50811190609s3317d4b0g879171dc347b150@mail.gmail.com>
Message-ID: <2731E7E1-7866-47AF-9A3F-4F5D0ECB1936@syenar.hu>

Hi Lost,

>> - How to install two Harbour versions in parallel with installation  
>> technique?
>
> You can use HB_INSTALL_PREFIX to specify a local path.

All my questions were aimed towards a binary distribution.
F.e. our current 1.0.1 for OSX package on sf.net download
page.

[ I know these can be controlled when building from source
and running 'make install', this is exactly how it's working
here locally on OS X, Linux and Windows. ]

>> - How to use Harbour without admin/sudo rights with installation  
>> technique?
>> (suppose I'm on someone else's PC, or I'd like to ship a software
>> which includes Harbour, but I wouldn't like to ask for an admin pw
>> on installation)
>
> Please assume you installed to $HOME/hbdevel, and that you are  
> currently
> in the root Harbour directory (where make_gnu.sh is)
>
> (all of the following is a single line)
>
> HB_INSTALL_PREFIX="$HOME/hbdevel" ./make_gnu.sh install
>
> Then, to use the hb* tools, you can for example:
>
> cd tests
> LD_RUN_PATH="$HOME/hbdevel/lib" $HOME/hbdevel/bin/hbmk adirtest && ./ 
> adirtest
>
> No need for admin rights. I hope the idea is clear...

See above (it's about moving binary builds).

For the rest: why would I have to modify an environment
to run a simple executable?

It's very easy to avoid and very unnatural, so why
make it so complicated and not work "out of the box"?

>> - How to move around a Harbour devl environment with installation  
>> technique?
>> (say, onto an external disk or USB drive, or to a backup disk)
>
> Adjust LD_RUN_PATH accordingly.

Pls see above. hbmk has some location information hard-wired
at 'make install' time, and moving around the installation will
break these settings (if there was an 'install time' at all).
So it would only work if hbmk (in -shared mode) would be modified
and/or additional envvars being set (quasi "reinstalled").

Common sense tells that if there are any absolute paths hard-wired
in an installation (either at 'make install' time, or binary
installation time, if there is one), that installation will
have problems when moved away from it's original location.

Maybe this is unorthodox on Linux, but on other systems,
such free moving around is accepted and in fact may cause
very nice flexibility in many areas. See "PortableFirefox"
on Windows, or a lot of standalone tools (procexp), or many
other projects (Clipper, eclipse, mingw, git, gs, inkscape,
nvu, mercurial, svn), or most OSX apps for that matter.
Or Harbour on Windows. So, IMO it's many times a plus if
a package doesn't rely on specific locations in order to be
usable. On OSX and Windows it's very easy to recognize
such packages because they don't have an installer, you
can unzip/copy them wherever you want and they'll just work.

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 19 15:36:19 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 15:36:27 2008
Subject: [Harbour] MinGW Build Process - Few Clarifications
In-Reply-To: <20583844.post@talk.nabble.com>
References: <20583844.post@talk.nabble.com>
Message-ID: <0AC9973A-D2FE-4903-89E4-3AA79D5CFE7F@syenar.hu>

Hi Pritpal,

> 1) ./make_gnu.sh install creates hbmk.sh in bin folder, <hbwin> is not
>    included in the default library list.  I tried to locate where I  
> have to
>   update this information but am at a loss. It is important for  
> demowvg.prg
>   to convert to executable. What I do that I change the lib list in  
> hbmk.sh
>   manually after each build.

You can use hbmk.bat with HB_COMPILER=mingw and usual parameters (like  
HB_USER_LIBS=hbwin).
If this doesn't work, pls shout.

> 2) What is the rule/procedure to build only a single contrib library?
>   Now I have to issue from the /c/harbour ./make_gnu.sh install  
> everytime
>   I make a change to the source. Then I change hbmk.sh in bin  
> folder. Then

In the given contrib dir:
---
[setup msys + mingw as usual]
set HB_BIN|LIB|INC_INSTALL=...
set HB_ARCHITECTURE=w32
set HB_COMPILER=mingw
sh -c "make install"
---

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 19 15:41:05 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 15:41:14 2008
Subject: [Harbour] MinGW Build Process - Few Clarifications
In-Reply-To: <20081119192616.GA23930@34-mo7-2.acn.waw.pl>
References: <20583844.post@talk.nabble.com>
	<20081119192616.GA23930@34-mo7-2.acn.waw.pl>
Message-ID: <18892E57-BFBA-4E41-AD8F-FB7EB422F172@syenar.hu>

> Looks that not all Harbour parts were updated for modifications
> in environment variables and library names.
> Look at function mk_hbgetlibsctb() in bin/hb-func.sh
> It has list of contrib libraries. hbw32 should be changed to hbwin.

I'll do this ASAP.

>> 2) What is the rule/procedure to build only a single contrib library?
>>   Now I have to issue from the /c/harbour ./make_gnu.sh install  
>> everytime
>>   I make a change to the source. Then I change hbmk.sh in bin  
>> folder. Then
>> I  compile demowvg.prg. A long edit/compile/link/execute cycle.
>
> It's very easy. In GNU make you can work with single library only.
> It's one of the most important functionality for me which does not
> exists in other make files. Just simply set two environment variables:

For non-GNU make it's also enough to run in given contrib:
'make_b32.bat [clean | install]' or
'make_vc.bat [clean | install]' or
'sh make_gcc.sh [clean | install]'

So it's now possible.

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 19 15:50:00 2008
From: harbour.01 at syenar.hu (=?iso-8859-2?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 15:50:01 2008
Subject: [Harbour] 2008-11-19 21:49 UTC+0100 Viktor Szakats (harbour.01
	syenar hu)
Message-ID: <01c94a88$Blat.v2.6.2$6361b448$12b01dcf47f2@127.0.0.1>

2008-11-19 21:49 UTC+0100 Viktor Szakats (harbour.01 syenar hu)
  * bin/hb-func.sh
    ! hbw32 -> hbwin
--
Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 19 15:54:10 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 15:54:17 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <4923E65E.1070804@libero.it>
References: <20535315.post@talk.nabble.com>	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>	<CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
	<9257026e0811182239v26d06e8apb66c2b3426456a0d@mail.gmail.com>
	<4923E65E.1070804@libero.it>
Message-ID: <2B41321A-0151-4736-8D08-F4095C3649B7@syenar.hu>

Hi Maurilio,

> I think that compilers come with package installer (instead of being a
> packaged app, like, for example, a browser) and the installer puts  
> libraries
> where they have to go, see for example neooffice which has such an  
> 'extended'
> installer.

For me both are just applications. IMO for any applications
it cannot hurt if they can be placed anywhere you want,
anytime you want. It actually gives much flexibility in
usage and administration. I benefit from this every day
with many apps, both locally and at small to large clients.

> So, harbour needs this 'extended' installer to put libraries in the  
> correct
> folder and different versions will have libraries with different  
> version
> extensions, like in linux.

Windows, OS/2 and DOS doesn't need an (extended) installer,
and this makes them very flexible to use. IMO, if there is
any chance to replicate that (and I believe there is),
we shouldn't cut the way to allow this on as much platforms
as possible. In OS X, installation is rather the exception
than the rule, which is just one more reason to allow support
for it (especially if it doesn't hurt anyone).

Brgds,
Viktor

From harbour.01 at syenar.hu  Wed Nov 19 16:18:28 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Wed Nov 19 16:18:37 2008
Subject: [Harbour] Clipper RL compilation problem
In-Reply-To: <20081112020607.GA21198@34-mo7-2.acn.waw.pl>
References: <69F2FF1E-2109-430E-8F7E-3D63561F34C7@syenar.hu>
	<2632CA93BDBD4352965490C9F327835D@emag>
	<ABAFA458-6D8C-4CA5-8FED-08F1D74E4132@syenar.hu>
	<20081111100115.GA19736@34-mo7-2.acn.waw.pl>
	<2BA4D0D3-C721-4816-BFA5-53DA259CC19B@syenar.hu>
	<20081112020607.GA21198@34-mo7-2.acn.waw.pl>
Message-ID: <DDD8254D-AC8D-4755-B0C6-40B2132258AF@syenar.hu>

Hi Przemek,

>>> I do not know the RL tool and it's internal format used
>>> in .frm but for .mem files we can introduce new format
>>> which will allow to store memvars with unlimited variable
>>> name size.
>> Of course, but how would you solve two way compatibility
>> for these .mem files?
>
> I do not plan to implement it. Few years ago I looked at this
> problem and it should be possible to create format which will
> be accepted by Clipper but it will skip Harbour extensions.
> But to be sure I will have to make some tests with Clipper.
> Clipper .mem format does not support also other things which
> exists in Harbour, f.e. strings longer then 64KB so variable
> name length it's not the only one problem.

We could instead have our own Harbour specific replacement
for .mem files (called .hbm f.e.), with a new set of
functions and while leaving existing .mem commands/functions
and file format intact for compatibility.

[ maybe it'd be enough to add a layer above serialization
functions to go through a list of var names and serialize
them. ]

I agree this is not the path to fix RL anyway.

>> [ IMO still some cmdline/pragma PRIVATE/PUBLIC var length
>> limit seems the most reasonable. ]
>
> It has to be runtime switch. Compiler switch is not enough.
> Why don't you want to make the same for other symbols?
> The most often reported problem by Clipper programmers
> porting their code to [x]Harbour is more then 10 significant
> characters in function names. It's exactly the same problem.

I know, what I didn't know that it's such frequent.

It'd be nice to address it, but the price seems to high
to pay, it's most of the time just some mistyped
function names after the 10th char. At least in my
experience.

Also, while the MEMVAR problem will most of the time
give an RTE, the long function name problem will
usually result in link time error, which makes it
much easier to catch it. (of course functions names
compiled in macros could still be a problem)

> We had Harbour compile time support for 10 character symbols
> which you removed. The reason was using in core code functions
> which needs more then 10 significant characters. The same
> problem will happen if someone will want to link code which
> uses such memvar variables with a code which needs longer
> variables. I can understand that we may want reactivate support
> for 10 character symbols updating core code if necessary because
> it's a real problem for some Clipper users but introducing such
> hack only for one type of symbols is a not good idea for me.

And that is exactly the problem. I'm not very positive
that we can clean Harbour to use only 10 chars symbols.
It's a pretty heavy restriction and it was violated
all over Harbour. It's also almost impossible to enforce it.
Such limitation could also contradict with other Clipper
dialects, f.e. xhb and Xbase++. So there were quite some
strong reasons to remove it.

There are quite many symbols which would need to be renamed
to make Harbour compile in 10 chars mode (HB_CODEPAGE_*,
HB_INET*, HB_LANG_*, HB_THREAD_*, HB_Z*, THREAD*, method
names, __DBG*). Many contribs: hbfimage, hbole, hbwin,
rddads, xhb, hbwhat, hbhpdf, hbcurl, gtwvg.

So the list is pretty long.

Considering all these, maybe it would be a somewhat good
compromise to just cut the memvar names (plus maybe
something else, like symbols in macros?), but not the
function names. If such distinction can be made in the HVM.

Brgds,
Viktor

From ssbbstw at pchome.com.tw  Wed Nov 19 20:53:45 2008
From: ssbbstw at pchome.com.tw (WenSheng)
Date: Wed Nov 19 20:53:53 2008
Subject: [Harbour] about function AT()
Message-ID: <20081120095148.35E4.84A669A0@mail.zzz.com.tw>


Hi~ all

	I'm try use AT() function like:
AT( cChar, cString, nStart, nEnd )
but occur error when compiler my AP,

Please, How to build harbour or my AP? What switch is need ?
From lorenzo.fiorini at gmail.com  Thu Nov 20 01:18:24 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Nov 20 01:18:27 2008
Subject: [Harbour] about function AT()
In-Reply-To: <20081120095148.35E4.84A669A0@mail.zzz.com.tw>
References: <20081120095148.35E4.84A669A0@mail.zzz.com.tw>
Message-ID: <9257026e0811192218o2ff7df55y14d96c6a93f4e8fa@mail.gmail.com>

On Thu, Nov 20, 2008 at 2:53 AM, WenSheng <ssbbstw@pchome.com.tw> wrote:

>        I'm try use AT() function like:
> AT( cChar, cString, nStart, nEnd )
> but occur error when compiler my AP,

AT()
 Return the position of a substring within a character string
------------------------------------------------------------------------------
 Syntax

     AT(<cSearch>, <cTarget>) --> nPosition

 Arguments

     <cSearch> is the character substring to be searched for.

     <cTarget> is the character string to be searched.

Look for HB_ATX

best regards,
Lorenzo
From niki at synel.co.il  Thu Nov 20 01:21:57 2008
From: niki at synel.co.il (Chen Kedem)
Date: Thu Nov 20 01:23:43 2008
Subject: [Harbour] Re: about function AT()
Message-ID: <1A07FEDC778C3E4AA417F089511F859C03333A41FE@Mail-yoq.SYNEL-COMPANY.LTD>

WenSheng ssbbstw at pchome.com.tw wrote:
> I'm try use AT() function like:
> AT( cChar, cString, nStart, nEnd )
> but occur error when compiler my AP

To be compatible with Clipper the function is defined as:
AT( cChar, cString ) --> nPos

You should use HB_AT which defined as:
HB_AT( cChar, cString, [nStart], [nEnd] ) --> nPos


there is an option to compile Harbour with -DHB_EXTENSION which internally call HB_AT()
whenever you call AT() but as you see it might not be compatible with other xbase dialect.

  Chen.
From ssbbstw at pchome.com.tw  Thu Nov 20 01:49:47 2008
From: ssbbstw at pchome.com.tw (WenSheng)
Date: Thu Nov 20 01:49:53 2008
Subject: [Harbour] Re: about function AT()
In-Reply-To: <1A07FEDC778C3E4AA417F089511F859C03333A41FE@Mail-yoq.SYNEL-COMPANY.LTD>
References: <1A07FEDC778C3E4AA417F089511F859C03333A41FE@Mail-yoq.SYNEL-COMPANY.LTD>
Message-ID: <20081120144805.0C25.84A669A0@mail.zzz.com.tw>


> > I'm try use AT() function like:
> > AT( cChar, cString, nStart, nEnd )
> > but occur error when compiler my AP
> 
> To be compatible with Clipper the function is defined as:
> AT( cChar, cString ) --> nPos
> 
> You should use HB_AT which defined as:
> HB_AT( cChar, cString, [nStart], [nEnd] ) --> nPos
> 
> 
> there is an option to compile Harbour with -DHB_EXTENSION which internally call HB_AT()
> whenever you call AT() but as you see it might not be compatible with other xbase dialect.
> 
>   Chen.

Thank you!
If I change AT() to HB_AT() is ok,
But, I add switch -DHB_EXTENSION to compile my AP,
still occur error message.

From niki at synel.co.il  Thu Nov 20 01:58:12 2008
From: niki at synel.co.il (Chen Kedem)
Date: Thu Nov 20 02:02:26 2008
Subject: [Harbour] RE: about function AT()
In-Reply-To: <1A07FEDC778C3E4AA417F089511F859C03333A41FE@Mail-yoq.SYNEL-COMPANY.LTD>
References: <1A07FEDC778C3E4AA417F089511F859C03333A41FE@Mail-yoq.SYNEL-COMPANY.LTD>
Message-ID: <1A07FEDC778C3E4AA417F089511F859C03333A4200@Mail-yoq.SYNEL-COMPANY.LTD>

WenSheng,

> I add switch -DHB_EXTENSION to compile my AP, still occur error message

You need to re-compile *Harbour* itself with that switch, not your application.

  Chen.
From harbour.01 at syenar.hu  Thu Nov 20 03:21:25 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov 20 03:21:32 2008
Subject: [Harbour] Re: about function AT()
In-Reply-To: <20081120144805.0C25.84A669A0@mail.zzz.com.tw>
References: <1A07FEDC778C3E4AA417F089511F859C03333A41FE@Mail-yoq.SYNEL-COMPANY.LTD>
	<20081120144805.0C25.84A669A0@mail.zzz.com.tw>
Message-ID: <0C6893F0-E923-408F-97B1-C8F8136706C7@syenar.hu>

Hi WenSheng,

hb_At() is the preferred and recommended method, so you are okay.

Brgds,
Viktor

On 2008.11.20., at 7:49, WenSheng wrote:

>
>>> I'm try use AT() function like:
>>> AT( cChar, cString, nStart, nEnd )
>>> but occur error when compiler my AP
>>
>> To be compatible with Clipper the function is defined as:
>> AT( cChar, cString ) --> nPos
>>
>> You should use HB_AT which defined as:
>> HB_AT( cChar, cString, [nStart], [nEnd] ) --> nPos
>>
>>
>> there is an option to compile Harbour with -DHB_EXTENSION which  
>> internally call HB_AT()
>> whenever you call AT() but as you see it might not be compatible  
>> with other xbase dialect.
>>
>>  Chen.
>
> Thank you!
> If I change AT() to HB_AT() is ok,
> But, I add switch -DHB_EXTENSION to compile my AP,
> still occur error message.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From mbelgrano at deltain.it  Thu Nov 20 05:13:43 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Thu Nov 20 05:14:49 2008
Subject: [Harbour] news regarding letodb
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F1AC@SRV02.deltain.net>
References: <1435518144.20080326194608@belacy.belgorod.su>
	<AFB948164110ED43B5EB849E8DEEF03815F1AC@SRV02.deltain.net>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1D6@SRV02.deltain.net>

Thanks for clarification
Do you think that letodb can be used for easy port a harbour application
to client server (like ads) ?
Wich are future implementation?

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Massimo
Belgrano
Sent: Monday, November 17, 2008 3:38 PM
To: Alexander S.Kresin; Harbour Project Main Developer List.
Subject: [Harbour] news regarding letodb

Have somebody updated news regarding letodb?
Kresin who is founders for letodb and hwgui seem in last period a little
inactive on his project

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Alexander
S.Kresin
Sent: Wednesday, March 26, 2008 5:46 PM
To: Harbour Project Main Developer List.
Subject: [Harbour] Leto DB build 5 has been released

All basic RDD functionality has been implemented. Relations,
orderListAdd, orderListClear has been added.

The server works im multithread mode now. First thread listen sockets,
accept connections and answers to commands, which doesn't demand
database access and Harbour's VM/stack functions.
The second answers to all other commands.

DBFNTX support has been added. The driver, which will be used to open a
table ( DBFCDX or DBFNTX ) is determined
 at server side from the letodb.ini - see readme.txt for details.


Regards,
 Alexander
http://kresin.belgorod.su

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From harbour.01 at syenar.hu  Thu Nov 20 05:40:40 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov 20 05:40:49 2008
Subject: [Harbour] 2008-11-18 00:43 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <20555513.post@talk.nabble.com>
References: <20555513.post@talk.nabble.com>
Message-ID: <0CA9AF44-B5AC-4E87-9577-4CB5FE6949AD@syenar.hu>

Hi Pritpal,

After recent changes, new BCC warnings appeared,
and it's not anymore possible to build demowvg
in ST mode, due to unresolved external 'hb_vmThreadState'.

MSVC C++ build of GTWVG still cannot compile due
to errors.

Brgds,
Viktor

On 2008.11.18., at 9:45, Pritpal Bedi wrote:

>
> 2008-11-18 00:43 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
>  * harbour/contrib/gtwvg/wvggui.c
>  * harbour/contrib/gtwvg/common.mak
>  * harbour/contrib/gtwvg/wvgdlg.prg
>  * harbour/contrib/gtwvg/wvgwnd.prg
>    ! Minor typos - strict Harbour code quality warnings.
>
> Regards
> Pritpal Bedi
> -- 
> View this message in context: http://www.nabble.com/2008-11-18-00%3A43-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20555513p20555513.html
> Sent from the Harbour - Dev mailing list archive at Nabble.com.
>
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From ssbbstw at pchome.com.tw  Thu Nov 20 08:32:11 2008
From: ssbbstw at pchome.com.tw (WenSheng)
Date: Thu Nov 20 08:32:18 2008
Subject: [Harbour] RE: about function AT()
In-Reply-To: <1A07FEDC778C3E4AA417F089511F859C03333A4200@Mail-yoq.SYNEL-COMPANY.LTD>
References: <1A07FEDC778C3E4AA417F089511F859C03333A41FE@Mail-yoq.SYNEL-COMPANY.LTD>
	<1A07FEDC778C3E4AA417F089511F859C03333A4200@Mail-yoq.SYNEL-COMPANY.LTD>
Message-ID: <20081120213136.E7E3.84A669A0@mail.zzz.com.tw>

> 
> > I add switch -DHB_EXTENSION to compile my AP, still occur error message
> 
> You need to re-compile *Harbour* itself with that switch, not your application.
> 

I had reCompiler Harbour and still can't compiler my AP.
From lostmyhearttoher at gmail.com  Thu Nov 20 11:57:10 2008
From: lostmyhearttoher at gmail.com (Lost)
Date: Thu Nov 20 11:57:13 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <2731E7E1-7866-47AF-9A3F-4F5D0ECB1936@syenar.hu>
References: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
	<20081118210350.GB17706@34-mo7-2.acn.waw.pl>
	<A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>
	<20081119044734.GA31336@34-mo7-2.acn.waw.pl>
	<DCECE651-F492-4991-B389-4BB701070A38@syenar.hu>
	<9dfb0af50811190609s3317d4b0g879171dc347b150@mail.gmail.com>
	<2731E7E1-7866-47AF-9A3F-4F5D0ECB1936@syenar.hu>
Message-ID: <402ac8b70811200857m4a3adc05x5f1dc4df733e2197@mail.gmail.com>

Hi Viktor,

On 2008/11/19 Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> All my questions were aimed towards a binary distribution.
> F.e. our current 1.0.1 for OSX package on sf.net download
> page.
>
> [ I know these can be controlled when building from source
> and running 'make install', this is exactly how it's working
> here locally on OS X, Linux and Windows. ]
>
> For the rest: why would I have to modify an environment
> to run a simple executable?
>
> It's very easy to avoid and very unnatural, so why
> make it so complicated and not work "out of the box"?
>

Well, then I'd guess that the rpath should be embedded into the
harbour executable and the executables generated by it. Adding
"--rpath=<your desired path>" (or maybe "-Wl,rpath,<your desired
path>", not tested) to the gcc command line should do the trick and
save you of having to specify LD_RUN_PATH each time.
This is an obscure (for me, at least) feature of gcc, and I could very
well be wrong, and I shiver at the idea of adding the current
directory to the run path. But if this is in the line of what you
want, it could be worth to investigate.
If this is not in the line of what you want, I'm afraid I completely
missed your point :-)

And one final caveat: this works in linux (and in Solaris, AFAIR)
I don't have a clue whether it will work at all in OSX.

HTH.
Best regards,

-- 
Lost
From druzus at acn.waw.pl  Thu Nov 20 13:30:37 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 20 13:29:17 2008
Subject: [Harbour] Default support for shared library in MacOSX build
Message-ID: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>

Hi All,

I would like to hear group decision about default support for
shard libraries in binaries created for MacOSX.
I want to keep it enabled by default like in all other *nixes
so standard build scripts will create compatible binaries in
all *nix like systems.
These is related to two things:
hb* scripts will create shared binaries unless user will not
use -static or -fullstatic parameter just like in all other *nixes.
standard tools in binaries created by mpkg_tgz.sh will be linked with
shared harbour library so we will have very easy validation that final
installation is correct, there is no typos in library name or version/
subversion number (BTW this has to be still fixed in MacOSX builds),
destination path are in correct system directories, hb* scripts will
create working shared binaries and any other Harbour shared binaries
will also work. It's also very important confirmation for me that when
user reports problem with his own Harbour shared binaries I'm sure
that the problem is not on the harbour side directly and I do not have
to start build conditions what sometimes is hard when I do not have
regular access to given OS. Sometimes even such access does not help
because the differences can be related to customized installation.
It was a standard in all *nix like installations.
Recently MacOSX builds has been changed and it's an exception to other
*nix builds.
I want to keep the old behavior compatible between *nixes without such
exceptions. Those of you who used to work with different *nixes knows
well how irritating are "small" differences between them and how problems
they can create.
Viktor prefers static builds. OK it's not a problem for me.
I added options to hb* scripts generator so they can be easy created
in such default mode by setting one environment variable before building
Harbour. It's enough to set HB_MK_STATIC=yes before building Harbour
to create customized hb* scripts. I can also add such option to mpkg_tgz.sh
so it will link harbour tools with static libraries HB_TOOLS_STATIC=yes.
I do not feel "MacOSX spirit". For me it's yet another *nix like
environment and I do not see any reason to make any exception for this
OS for users who will only create applications for it often without
seeing computer and using only remote console connections.
Anyhow if other MacOSX users will prefer static builds I do not want to
forbid them such possibilities. To avoid settings above envvars we can
add simply scpript mpkg_macosx.sh which maybe in the future will be changed
to real MacOSX installer by MacOSX users. now it will simply look like:
   #!/bin/sh
   export HB_MK_STATIC=yes
   export HB_TOOLS_STATIC=yes
   ./mpkg_tgz.sh

Anyone who will want to use will be free to use it. Just like anyone
who prefers compatible behavior with other *nixes can use the same
scripts as for other *nixes. It's a free project and I do not see
any reason to forbid such possibilities.
I asked Viktor about it few times without success in last days.
So now I want to aks all of you to vote.
1. We should keep compatible between *nixes behavior for binaries create
   by standard build scripts giving MacOSX users alternative build script
   ./mpkg_macosx.sh which will created static binaries
2. We should disable default support for shared binaries in MacOSX builds
   created by standard build scripts (current behavior after recent
   Viktor's modification)

I'm voting for 1.

best regards,
Przemek
From lostmyhearttoher at gmail.com  Thu Nov 20 13:59:58 2008
From: lostmyhearttoher at gmail.com (Lost)
Date: Thu Nov 20 14:05:57 2008
Subject: [Harbour] Default support for shared library in MacOSX build
In-Reply-To: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
References: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
Message-ID: <402ac8b70811201059q6b40398t34241ced9fde93ea@mail.gmail.com>

Hi, people

On 2008/11/20 Przemyslaw Czerpak <druzus@acn.waw.pl> wrote:

> Hi All,
>
> I would like to hear group decision about default support for
> shard libraries in binaries created for MacOSX.
> I want to keep it enabled by default like in all other *nixes
> so standard build scripts will create compatible binaries in
> all *nix like systems.
> These is related to two things:
> hb* scripts will create shared binaries unless user will not
> use -static or -fullstatic parameter just like in all other *nixes.
> standard tools in binaries created by mpkg_tgz.sh will be linked with
> shared harbour library so we will have very easy validation that final
> installation is correct, there is no typos in library name or version/
> subversion number (BTW this has to be still fixed in MacOSX builds),
> destination path are in correct system directories, hb* scripts will
> create working shared binaries and any other Harbour shared binaries
> will also work. It's also very important confirmation for me that when
> user reports problem with his own Harbour shared binaries I'm sure
> that the problem is not on the harbour side directly and I do not have
> to start build conditions what sometimes is hard when I do not have
> regular access to given OS. Sometimes even such access does not help
> because the differences can be related to customized installation.
> It was a standard in all *nix like installations.
> Recently MacOSX builds has been changed and it's an exception to other
> *nix builds.
> I want to keep the old behavior compatible between *nixes without such
> exceptions. Those of you who used to work with different *nixes knows
> well how irritating are "small" differences between them and how problems
> they can create.
> Viktor prefers static builds. OK it's not a problem for me.
> I added options to hb* scripts generator so they can be easy created
> in such default mode by setting one environment variable before building
> Harbour. It's enough to set HB_MK_STATIC=yes before building Harbour
> to create customized hb* scripts. I can also add such option to mpkg_tgz.sh
> so it will link harbour tools with static libraries HB_TOOLS_STATIC=yes.
> I do not feel "MacOSX spirit". For me it's yet another *nix like
> environment and I do not see any reason to make any exception for this
> OS for users who will only create applications for it often without
> seeing computer and using only remote console connections.
> Anyhow if other MacOSX users will prefer static builds I do not want to
> forbid them such possibilities. To avoid settings above envvars we can
> add simply scpript mpkg_macosx.sh which maybe in the future will be changed
> to real MacOSX installer by MacOSX users. now it will simply look like:
>   #!/bin/sh
>   export HB_MK_STATIC=yes
>   export HB_TOOLS_STATIC=yes
>   ./mpkg_tgz.sh
>
> Anyone who will want to use will be free to use it. Just like anyone
> who prefers compatible behavior with other *nixes can use the same
> scripts as for other *nixes. It's a free project and I do not see
> any reason to forbid such possibilities.
> I asked Viktor about it few times without success in last days.
> So now I want to aks all of you to vote.
> 1. We should keep compatible between *nixes behavior for binaries create
>   by standard build scripts giving MacOSX users alternative build script
>   ./mpkg_macosx.sh which will created static binaries
> 2. We should disable default support for shared binaries in MacOSX builds
>   created by standard build scripts (current behavior after recent
>   Viktor's modification)

I'm also voting for 1. Dynamic linking is the default in all the OSes
I use. It's the expected behaviour for me.

BTW, an alternative to creating static executables (without the need
to recompile, and achieving no-install-required capability and even
inter-machines distribution) might be using the ELF statifier
<http://statifier.sourceforge.net/>

Slightly off-topic: has the use of autotools been considered? (it's a
simple question out of curiosity, no pushing from my side)

Best regards,

-- 
Lost
From harbour.01 at syenar.hu  Thu Nov 20 14:34:15 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov 20 14:34:25 2008
Subject: [Harbour] Default support for shared library in MacOSX build
In-Reply-To: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
References: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
Message-ID: <B3095314-2F29-46F7-A441-89CAA7C4175A@syenar.hu>

I vote to use current settings (static hbrun and -static
default for hbmk) when mpkg_tgz.sh is used. And shared
setting for both when mpkg_osx.sh (to be done). Also,
I vote to remove the self-extracting logic from mpkg_tgz.sh
for OSX, as this is a solution unknown on the OSX scene,
and makes it unnecessarily difficult to unpack it anywhere.

Above ensures that everyone who wishes to use an install
free Harbour on OSX, will have working package, and
everyone else who wishes to install it to standard
location, will get the slightly smaller and also working
shared solution.

OSX is not Linux or SunOS or HPUX (in fact it became
officially Unix just a few years ago). OSX is mainly
a desktop OS, this is the reason why actual bigger
crowd of human beings are using it, and I see no reason
to make it behave like export-systems and server orientated
Unix dialects should be copied, thus making life more
difficult for its users.

Anyway, with above solution, everyone can get what he
wants, and it's easy to decide by selecting the proper
binary package.

IOW, if someone wants to have a Unix-like experience,
please add an mpkg_osx.sh which creates an OSX .pkg
with proper installer.

> hb* scripts will create shared binaries unless user will not
> use -static or -fullstatic parameter just like in all other *nixes.
> standard tools in binaries created by mpkg_tgz.sh will be linked with
> shared harbour library so we will have very easy validation that final
> installation is correct, there is no typos in library name or version/
> subversion number (BTW this has to be still fixed in MacOSX builds),
> destination path are in correct system directories, hb* scripts will
> create working shared binaries and any other Harbour shared binaries
> will also work. It's also very important confirmation for me that when
> user reports problem with his own Harbour shared binaries I'm sure
> that the problem is not on the harbour side directly and I do not have
> to start build conditions what sometimes is hard when I do not have
> regular access to given OS. Sometimes even such access does not help
> because the differences can be related to customized installation.
> It was a standard in all *nix like installations.

It's much simpler if user just have to unzip something,
so all the above complication is just skipped with no
possibility for error. Or, use the familiar .pkg format. If
we support a platform we should support it natively, I mean,
making our support job easier by forcing common rules for
all platforms isn't the way to go IMO. We should make users
happy, not ourselves.

> I want to keep the old behavior compatible between *nixes without such
> exceptions. Those of you who used to work with different *nixes knows
> well how irritating are "small" differences between them and how  
> problems
> they can create.

Reasons please. For an OSX user it's just as well irritating
to have something to be "installed" in an obligatory fashion.
I'm telling this as a Mac user since 2004.

> I do not feel "MacOSX spirit". For me it's yet another *nix like

If you've never used it, why don't you want to listen to ppl
who have? OSX users have most probably chosen their platform for
a reason. These are different worlds.

>   #!/bin/sh
>   export HB_MK_STATIC=yes
>   export HB_TOOLS_STATIC=yes
>   ./mpkg_tgz.sh

The default will be broken then, just like it is for 1.0.1.

> Anyone who will want to use will be free to use it. Just like anyone
> who prefers compatible behavior with other *nixes can use the same
> scripts as for other *nixes. It's a free project and I do not see
> any reason to forbid such possibilities.
> I asked Viktor about it few times without success in last days.

I've probably missed these... what was the question?

> So now I want to aks all of you to vote.
> 1. We should keep compatible between *nixes behavior for binaries  
> create
>   by standard build scripts giving MacOSX users alternative build  
> script
>   ./mpkg_macosx.sh which will created static binaries
>
> 2. We should disable default support for shared binaries in MacOSX  
> builds
>   created by standard build scripts (current behavior after recent
>   Viktor's modification)

Shared lib _is still supported_, it's just not the default
when someone uses hbmk, and hbrun isn't dependent on it,
which means it works as a _standalone_ executable.

> I'm voting for 1.

I propose almost the same with different names.

.tgz packages as .sh type of installation is nonexistent in
the OSX world. It should be .tgz, plus there should be a .pkg.
This is how it works on this platform, it's enough to just
look around. Harbour should follow OSX practices, instead
of trying to force other concepts.

"When in Rome", as Dave Pearson had told me around year 2000
on this very mailing list, when I was proposing common binary
naming rules for all platforms. Dave was very right then.
Names are also much better to follow the customs of the given
platforms, as this is what platform users expect.

.tgz on OSX is something you can just unpack an use, .pkg
is something you can install and use.

So my vote to no 3.

Brgds,
Viktor

From teo at windtelsoft.com  Thu Nov 20 14:08:04 2008
From: teo at windtelsoft.com (Teo Fonrouge)
Date: Thu Nov 20 14:37:10 2008
Subject: [Harbour] Default support for shared library in MacOSX build
In-Reply-To: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
References: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
Message-ID: <200811201308.04946.teo@windtelsoft.com>

On Thursday 20 November 2008 12:30:37 pm Przemyslaw Czerpak wrote:
> Hi All,
>
> I would like to hear group decision about default support for
> shard libraries in binaries created for MacOSX.
> I want to keep it enabled by default like in all other *nixes
> so standard build scripts will create compatible binaries in
> all *nix like systems.
> These is related to two things:
> hb* scripts will create shared binaries unless user will not
> use -static or -fullstatic parameter just like in all other *nixes.
> standard tools in binaries created by mpkg_tgz.sh will be linked with
> shared harbour library so we will have very easy validation that final
> installation is correct, there is no typos in library name or version/
> subversion number (BTW this has to be still fixed in MacOSX builds),
> destination path are in correct system directories, hb* scripts will
> create working shared binaries and any other Harbour shared binaries
> will also work. It's also very important confirmation for me that when
> user reports problem with his own Harbour shared binaries I'm sure
> that the problem is not on the harbour side directly and I do not have
> to start build conditions what sometimes is hard when I do not have
> regular access to given OS. Sometimes even such access does not help
> because the differences can be related to customized installation.
> It was a standard in all *nix like installations.
> Recently MacOSX builds has been changed and it's an exception to other
> *nix builds.
> I want to keep the old behavior compatible between *nixes without such
> exceptions. Those of you who used to work with different *nixes knows
> well how irritating are "small" differences between them and how problems
> they can create.
> Viktor prefers static builds. OK it's not a problem for me.

In *nix world shared builds are the prefered choice against static builds. 
There are too many reasons for it, and we need to keep it this way too in 
Harbour.

If MacOSX SO designers decided to use mainly static builds, then Harbour needs 
to have independent build scripts specifically to acomplish this.

> I added options to hb* scripts generator so they can be easy created
> in such default mode by setting one environment variable before building
> Harbour. It's enough to set HB_MK_STATIC=yes before building Harbour
> to create customized hb* scripts. I can also add such option to mpkg_tgz.sh
> so it will link harbour tools with static libraries HB_TOOLS_STATIC=yes.

This sounds reasonable and enough.

> I do not feel "MacOSX spirit". For me it's yet another *nix like
> environment and I do not see any reason to make any exception for this
> OS for users who will only create applications for it often without
> seeing computer and using only remote console connections.
> Anyhow if other MacOSX users will prefer static builds I do not want to
> forbid them such possibilities. To avoid settings above envvars we can
> add simply scpript mpkg_macosx.sh which maybe in the future will be changed
> to real MacOSX installer by MacOSX users. now it will simply look like:
>    #!/bin/sh
>    export HB_MK_STATIC=yes
>    export HB_TOOLS_STATIC=yes
>    ./mpkg_tgz.sh
>
> Anyone who will want to use will be free to use it. Just like anyone
> who prefers compatible behavior with other *nixes can use the same
> scripts as for other *nixes. It's a free project and I do not see
> any reason to forbid such possibilities.
> I asked Viktor about it few times without success in last days.
> So now I want to aks all of you to vote.
> 1. We should keep compatible between *nixes behavior for binaries create
>    by standard build scripts giving MacOSX users alternative build script
>    ./mpkg_macosx.sh which will created static binaries
> 2. We should disable default support for shared binaries in MacOSX builds
>    created by standard build scripts (current behavior after recent
>    Viktor's modification)
>
> I'm voting for 1.

I'm too for 1. 

Plus, MacOSX users need to create their own separated build scripts.


best regards,

Teo
From harbour.01 at syenar.hu  Thu Nov 20 14:39:22 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov 20 14:39:28 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <402ac8b70811200857m4a3adc05x5f1dc4df733e2197@mail.gmail.com>
References: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<9257026e0811180425pdf45356j972ab29563cb262a@mail.gmail.com>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
	<20081118210350.GB17706@34-mo7-2.acn.waw.pl>
	<A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>
	<20081119044734.GA31336@34-mo7-2.acn.waw.pl>
	<DCECE651-F492-4991-B389-4BB701070A38@syenar.hu>
	<9dfb0af50811190609s3317d4b0g879171dc347b150@mail.gmail.com>
	<2731E7E1-7866-47AF-9A3F-4F5D0ECB1936@syenar.hu>
	<402ac8b70811200857m4a3adc05x5f1dc4df733e2197@mail.gmail.com>
Message-ID: <BA3C8EF5-F9C0-47E1-9269-07114EE939A9@syenar.hu>

>> All my questions were aimed towards a binary distribution.
>> F.e. our current 1.0.1 for OSX package on sf.net download
>> page.
>>
>> [ I know these can be controlled when building from source
>> and running 'make install', this is exactly how it's working
>> here locally on OS X, Linux and Windows. ]
>>
>> For the rest: why would I have to modify an environment
>> to run a simple executable?
>>
>> It's very easy to avoid and very unnatural, so why
>> make it so complicated and not work "out of the box"?
>>
>
> Well, then I'd guess that the rpath should be embedded into the
> harbour executable and the executables generated by it. Adding
> "--rpath=<your desired path>" (or maybe "-Wl,rpath,<your desired
> path>", not tested) to the gcc command line should do the trick and
> save you of having to specify LD_RUN_PATH each time.
> This is an obscure (for me, at least) feature of gcc, and I could very
> well be wrong, and I shiver at the idea of adding the current
> directory to the run path. But if this is in the line of what you
> want, it could be worth to investigate.
> If this is not in the line of what you want, I'm afraid I completely
> missed your point :-)

Above is an even worse nightmare :) I'd prefer to not
embed _any_ absolute locations (or any local environment
specific setting whatsoever) anywhere in a program.
An executable always knows the directory it resides in,
and this should be enough for it to find everything needed.

This is also a main rule for all desktop apps in OSX.

Brgds,
Viktor

From lostmyhearttoher at gmail.com  Thu Nov 20 14:56:44 2008
From: lostmyhearttoher at gmail.com (Lost)
Date: Thu Nov 20 14:56:49 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <BA3C8EF5-F9C0-47E1-9269-07114EE939A9@syenar.hu>
References: <F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>
	<581E53E6-67C5-4CFE-BF07-FF8AA037368C@syenar.hu>
	<20081118210350.GB17706@34-mo7-2.acn.waw.pl>
	<A691E5D4-8417-4619-B275-77BBE7D2E17D@syenar.hu>
	<20081119044734.GA31336@34-mo7-2.acn.waw.pl>
	<DCECE651-F492-4991-B389-4BB701070A38@syenar.hu>
	<9dfb0af50811190609s3317d4b0g879171dc347b150@mail.gmail.com>
	<2731E7E1-7866-47AF-9A3F-4F5D0ECB1936@syenar.hu>
	<402ac8b70811200857m4a3adc05x5f1dc4df733e2197@mail.gmail.com>
	<BA3C8EF5-F9C0-47E1-9269-07114EE939A9@syenar.hu>
Message-ID: <402ac8b70811201156n46f6263cha95544aa994e055e@mail.gmail.com>

Hello Viktor,

On 2008/11/20 Szak?ts Viktor <harbour.01@syenar.hu> wrote:

>>
>> Well, then I'd guess that the rpath should be embedded into the
>> harbour executable and the executables generated by it. Adding
>> "--rpath=<your desired path>" (or maybe "-Wl,rpath,<your desired
>> path>", not tested) to the gcc command line should do the trick and
>> save you of having to specify LD_RUN_PATH each time.
>> This is an obscure (for me, at least) feature of gcc, and I could very
>> well be wrong, and I shiver at the idea of adding the current
>> directory to the run path. But if this is in the line of what you
>> want, it could be worth to investigate.
>> If this is not in the line of what you want, I'm afraid I completely
>> missed your point :-)
>
> Above is an even worse nightmare :) I'd prefer to not
> embed _any_ absolute locations (or any local environment
> specific setting whatsoever) anywhere in a program.
> An executable always knows the directory it resides in,
> and this should be enough for it to find everything needed.
>
> This is also a main rule for all desktop apps in OSX.

I was not thinking of absolute locations when I wrote that. Of course,
I share your view about embedding absolute paths. But, AFAIK, changing
the paths is precisely what is done when creating OSX apps (by using
install_name_tool, I think I remember)

I mentioned in another post the ELF statifier
<http://statifier.sourceforge.net/>. This creates in linuxes a
(pseudo-)static binary, ? la OSX. Is perhaps something like this what
you have in mind?

Best regards,
-- 
Lost
From harbour.01 at syenar.hu  Thu Nov 20 15:01:07 2008
From: harbour.01 at syenar.hu (=?ISO-8859-1?Q?Szak=E1ts_Viktor?=)
Date: Thu Nov 20 15:01:15 2008
Subject: [Harbour] Default support for shared library in MacOSX build
In-Reply-To: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
References: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
Message-ID: <4C41C479-BC4C-4139-9F85-44D7FB313B5E@syenar.hu>

Folks,

Consider other options too, these two are not the only
possible options, but the whole mail is written to make
it look like there are no other options and option 2
is the only one. See f.e. no 3.

It's rather funny how non OSX users want to decide
something for an OS they don't know, and they don't use.
There are two active OSX users (4 if we count Antonio and
David, too) on this list and I'm not sure voting has much
meaning with such a huge crowd.

I vote to give _options_. And I vote to offer working
environments, and to respect the target OS's users and
customs.

This may be my last mail on this list for some time now,
as this starts to be more than I'd like to cope with.

Brgds,
Viktor

On 2008.11.20., at 19:30, Przemyslaw Czerpak wrote:

> Hi All,
>
> I would like to hear group decision about default support for
> shard libraries in binaries created for MacOSX.
> I want to keep it enabled by default like in all other *nixes
> so standard build scripts will create compatible binaries in
> all *nix like systems.
> These is related to two things:
> hb* scripts will create shared binaries unless user will not
> use -static or -fullstatic parameter just like in all other *nixes.
> standard tools in binaries created by mpkg_tgz.sh will be linked with
> shared harbour library so we will have very easy validation that final
> installation is correct, there is no typos in library name or version/
> subversion number (BTW this has to be still fixed in MacOSX builds),
> destination path are in correct system directories, hb* scripts will
> create working shared binaries and any other Harbour shared binaries
> will also work. It's also very important confirmation for me that when
> user reports problem with his own Harbour shared binaries I'm sure
> that the problem is not on the harbour side directly and I do not have
> to start build conditions what sometimes is hard when I do not have
> regular access to given OS. Sometimes even such access does not help
> because the differences can be related to customized installation.
> It was a standard in all *nix like installations.
> Recently MacOSX builds has been changed and it's an exception to other
> *nix builds.
> I want to keep the old behavior compatible between *nixes without such
> exceptions. Those of you who used to work with different *nixes knows
> well how irritating are "small" differences between them and how  
> problems
> they can create.
> Viktor prefers static builds. OK it's not a problem for me.
> I added options to hb* scripts generator so they can be easy created
> in such default mode by setting one environment variable before  
> building
> Harbour. It's enough to set HB_MK_STATIC=yes before building Harbour
> to create customized hb* scripts. I can also add such option to  
> mpkg_tgz.sh
> so it will link harbour tools with static libraries  
> HB_TOOLS_STATIC=yes.
> I do not feel "MacOSX spirit". For me it's yet another *nix like
> environment and I do not see any reason to make any exception for this
> OS for users who will only create applications for it often without
> seeing computer and using only remote console connections.
> Anyhow if other MacOSX users will prefer static builds I do not want  
> to
> forbid them such possibilities. To avoid settings above envvars we can
> add simply scpript mpkg_macosx.sh which maybe in the future will be  
> changed
> to real MacOSX installer by MacOSX users. now it will simply look  
> like:
>   #!/bin/sh
>   export HB_MK_STATIC=yes
>   export HB_TOOLS_STATIC=yes
>   ./mpkg_tgz.sh
>
> Anyone who will want to use will be free to use it. Just like anyone
> who prefers compatible behavior with other *nixes can use the same
> scripts as for other *nixes. It's a free project and I do not see
> any reason to forbid such possibilities.
> I asked Viktor about it few times without success in last days.
> So now I want to aks all of you to vote.
> 1. We should keep compatible between *nixes behavior for binaries  
> create
>   by standard build scripts giving MacOSX users alternative build  
> script
>   ./mpkg_macosx.sh which will created static binaries
> 2. We should disable default support for shared binaries in MacOSX  
> builds
>   created by standard build scripts (current behavior after recent
>   Viktor's modification)
>
> I'm voting for 1.
>
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour

From lorenzo.fiorini at gmail.com  Thu Nov 20 15:32:12 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Nov 20 15:32:19 2008
Subject: [Harbour] Default support for shared library in MacOSX build
In-Reply-To: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
References: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
Message-ID: <9257026e0811201232u51716d7uada7568cc9df77c3@mail.gmail.com>

On Thu, Nov 20, 2008 at 7:30 PM, Przemyslaw Czerpak <druzus@acn.waw.pl> wrote:

> I would like to hear group decision about default support for
> shard libraries in binaries created for MacOSX.
> ...
> I'm voting for 1.

+1

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Thu Nov 20 16:52:01 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Thu Nov 20 16:52:05 2008
Subject: [Harbour] Default support for shared library in MacOSX build
In-Reply-To: <4C41C479-BC4C-4139-9F85-44D7FB313B5E@syenar.hu>
References: <20081120183037.GA24749@34-mo7-2.acn.waw.pl>
	<4C41C479-BC4C-4139-9F85-44D7FB313B5E@syenar.hu>
Message-ID: <9257026e0811201352g69e5d216sfad04da2ec453695@mail.gmail.com>

On Thu, Nov 20, 2008 at 9:01 PM, Szak?ts Viktor <harbour.01@syenar.hu> wrote:

> I vote to give _options_. And I vote to offer working
> environments, and to respect the target OS's users and
> customs.

Viktor, I voted that way because for me Harbour should hide the
differences between the 3 platform we support Lin, Win, OSX. For me
the same makefiles and the same hb* scripts should create the same
result.

In the "native game" we have lost: C#+.NET will always be more native
under Win and ObjectiveC+Cocoa will  always be more native under OSX.

IMHO the only possible future for Harbour is like a multi platform
language "on top" of gnu gcc toolchain that can run the same code on
different OSes.

best regards,
Lorenzo
From bedipritpal at hotmail.com  Thu Nov 20 17:10:35 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 20 17:10:39 2008
Subject: [Harbour] 2008-11-18 00:43 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
In-Reply-To: <0CA9AF44-B5AC-4E87-9577-4CB5FE6949AD@syenar.hu>
References: <20555513.post@talk.nabble.com>
	<0CA9AF44-B5AC-4E87-9577-4CB5FE6949AD@syenar.hu>
Message-ID: <20611074.post@talk.nabble.com>


Viktor


Szak?ts Viktor wrote:
> 
> After recent changes, new BCC warnings appeared,
> and it's not anymore possible to build demowvg
> in ST mode, due to unresolved external 'hb_vmThreadState'.
> 
> MSVC C++ build of GTWVG still cannot compile due
> to errors.
> 

Can you show me the logs?

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/2008-11-18-00%3A43-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20555513p20611074.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Thu Nov 20 20:46:25 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 20 20:46:31 2008
Subject: [Harbour] GT - Parent | Child Relation
Message-ID: <20613798.post@talk.nabble.com>


Hello Przemek

I am wondering if there is a way to typecast <pGT> 
according to its origin.

To clarify my point:

static HWND hb_gt_wvt_CreateWindow( PHB_GTWVT pWVT )
{
   ...
   ...

   hWndParent = NULL;
   if( pWVT->pPP->bConfigured )
   {
      PHB_GT pGTp = hb_gt_ItemBase( pWVT->pPP->pParentGT );
      if( pGTp )
      {
         PHB_GTWVT pWVTp = HB_GTWVT_GET( pGTp );
         hWndParent = pWVTp->hWnd;
         hb_gt_BaseFree( pGTp );

         if( hWndParent )
           ...
      }
   }
}

PHB_GTWVT pWVTp = HB_GTWVT_GET( pGTp );
is refering to local declaration at the top of the .c whereas
pGTp comes from the other GT, may be GTWVG or GTWGU and hence
returns NULL. Is there any mechanism that I can detect the correct
GT context here?

If the GT is the same then no problems, I have experimented and is 
working in demowvg.prg. After introducing GTWGU I loose <pGTp> context 
if it belongs to another GT.

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/GT---Parent-%7C-Child-Relation-tp20613798p20613798.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Thu Nov 20 20:54:14 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 20 20:54:17 2008
Subject: [Harbour] MT and hb_gtInfo() - Appln Locks
Message-ID: <20613862.post@talk.nabble.com>


Hello Przemek

Function Main()

   hb_threadStart( {|| First() } )
   hb_threadStart( {|| Second() } )

   do while .t.
       nKey := inkey( 0.2 )
       if nKey == 27
         exit
       endif
   enddo

   Return nil

Function First()
   hb_gtInfo( HB_GTI_WINTITLE, 'My First Function' )  // Appln Hangs
   Return nil

Function Second()
   @ 10,20 SAY 'My Second Function' COLOR 'W+/R'    // This works ok
   Return nil

hb_gtInfo() may be looking GT in another context.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/MT-and-hb_gtInfo%28%29---Appln-Locks-tp20613862p20613862.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dbtopas at dbtopas.lt  Fri Nov 21 06:06:56 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Fri Nov 21 06:07:21 2008
Subject: [Harbour] Closing relation
Message-ID: <49269650.9080503@dbtopas.lt>

Hi,


is there any way in Harbour/Clipper to close a single relation of workarea?


Best regards,
Mindaugas
From maurilio.longo at libero.it  Fri Nov 21 07:29:51 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Fri Nov 21 07:29:56 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <2B41321A-0151-4736-8D08-F4095C3649B7@syenar.hu>
References: <20535315.post@talk.nabble.com>	<AFB948164110ED43B5EB849E8DEEF03815F1AE@SRV02.deltain.net>	<F076ADA1-FAD5-44D8-BAAF-8CA9B606FD53@syenar.hu>	<20081117215408.GA2782@34-mo7-2.acn.waw.pl>	<ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>	<CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>	<9257026e0811182239v26d06e8apb66c2b3426456a0d@mail.gmail.com>	<4923E65E.1070804@libero.it>
	<2B41321A-0151-4736-8D08-F4095C3649B7@syenar.hu>
Message-ID: <4926A9BF.4010709@libero.it>

Szak?ts Viktor wrote:
> 
> Windows, OS/2 and DOS doesn't need an (extended) installer,
> and this makes them very flexible to use. IMO, if there is
> any chance to replicate that (and I believe there is),
> we shouldn't cut the way to allow this on as much platforms

Viktor,

in OS/2 there is an envvar, LIBPATH=, which always contains '.' and is used by
OS/2 to find needed DLLs; so every program looks at the dirctory it was
started from when looking for .DLLs.

I don't think this is available on MacOSX.

> as possible. In OS X, installation is rather the exception
> than the rule, which is just one more reason to allow support
> for it (especially if it doesn't hurt anyone).
> 

I agree with you here, and with something you wrote later, MacOSX is not
linux, so it is wrong to see it just like a unix dialect with some fancy
window manager.

That said, what about having MacOSX specific commands instead of changing the
ones that work on most the other *nixes?

Maurilio.

> Brgds,
> Viktor
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From druzus at acn.waw.pl  Fri Nov 21 08:01:42 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov 21 08:00:24 2008
Subject: [Harbour] MT and hb_gtInfo() - Appln Locks
In-Reply-To: <20613862.post@talk.nabble.com>
References: <20613862.post@talk.nabble.com>
Message-ID: <20081121130142.GA23582@34-mo7-2.acn.waw.pl>

On Thu, 20 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> Function Main()
>    hb_threadStart( {|| First() } )
>    hb_threadStart( {|| Second() } )
>    do while .t.
>        nKey := inkey( 0.2 )
>        if nKey == 27
>          exit
>        endif
>    enddo
>    Return nil
> Function First()
>    hb_gtInfo( HB_GTI_WINTITLE, 'My First Function' )  // Appln Hangs
>    Return nil
> Function Second()
>    @ 10,20 SAY 'My Second Function' COLOR 'W+/R'    // This works ok
>    Return nil
> hb_gtInfo() may be looking GT in another context.

It has nothing to GT context which works perfectly (as far as I know).
Few days ago I sent to this list message which explains why such effects
can apear. Please read it again. Now short reduction.
Do you remembert the problem with locking GT you had?
You were arbitrary unlocking it and I tried to tell you
that the problem is not directly related to GT locking
but it's result of Windows API behavior and GT locking
only exploits it. In Windows _ONLY_ thread which created
windows can process windows messages. It means that if
other thread send blocking message then it will be locked
until the thread which created the window will not process
it. I suggested you to locate all such functions and use
their alternative version which will not lock GT or if such
alternative version does not exist to unlock GT before
calling blocking function or you will have deadlock.
Arbitrary unlocking GT inside hb_gtInfoEx() you made and
accessing GT structure with any protection is not a solution
because it may cause that two threads will operate on the
same structure without any protection what may cause its
corruption and the deadlock problem still exists and will
be exploited when user code will begin to use locks.
Code above is example of such deadlock situation.
Two function: GetWindowText() and SetWindowText() are
blocking functions. If you want to allow setting window
title from other threads then the one which created
the window (just like in you example) then you should
change GTWV[TG] code. If you want to only resolve problem
with deadlock which can appear on internal MS-windows mutext
used to protect window and pGT mutex used to protect our
pGT structure then it's enough to unlock pGT before calling
SetWindowText()/GetWindowText() and then resotre the locks.
F.e. this modification resolves the problem in above exmpale:

static void hb_gt_wvt_SetWindowTitle( PHB_GT pGT, HWND hWnd, const char * title )
{
   LPTSTR text = HB_TCHAR_CONVTO( title );

   /* SetWindowText() will block this thread until the thread which
    * created window will not process window messages. To allow processing
    * window message for thread which is window owner we have to unlock
    * the GT so it can access it. Otherwise we will have deadlock.
    */
   HB_GTSELF_UNLOCK( pGT );
   SetWindowText( hWnd, text );
   HB_GTSELF_LOCK( pGT );
   HB_TCHAR_FREE( text );
}

static BOOL hb_gt_wvt_GetWindowTitle( PHB_GT pGT, HWND hWnd, char ** title )
{
   TCHAR buffer[ WVT_MAX_TITLE_SIZE ];
   int iResult;

   HB_GTSELF_UNLOCK( pGT );
   /* GetWindowText() will block this thread until the thread which
    * created window will not process window messages.
    */
   iResult = GetWindowText( hWnd, buffer, WVT_MAX_TITLE_SIZE );
   HB_GTSELF_LOCK( pGT );
   if( iResult > 0 )
   {
      *title = ( char * ) hb_xgrab( iResult + 1 );
      HB_TCHAR_GETFROM( *title, buffer, iResult );
      ( *title )[ iResult ] = '\0';
      return TRUE;
   }

   *title = NULL;
   return FALSE;
}

Add it to GTWVT and update hb_gt_wvt_SetWindowTitle() and
hb_gt_wvt_GetWindowTitle() calls to add pGT as 1-st parameter.
Anyhow it's not very good solution because the problem can return
when user code will use some locks. F.e. thread can lock some user
mutex which will stop the thread which created the window. When
this thread calls SetWindowText() or GetWindowText() then we
have exactly the same deadlock.
So you should create alternate solution which will not lock the
thread or you can keep above modification but you have to document
that HB_GTI_WINTITLE is locking action in GTWV[TG] and user should
resolve the potential deadlock problem in his code himself. F.e.
he should unlock your own mutexes before calling it and then lock
them again.
I do not like it so I prefer unlocking solution but the second
one is also acceptable. It's only important to well document
such actions so user will know about it.
In this case (setting window title) you can resolve the problem
quite easy. It's enough to keep window tile in pWVT variable
(it will eliminate GetWindowText() calls) and call SetWindowText()
only by thread which created the window. You can store thread ID
(HB_THREAD_SELF()) for thread which create window inside pWVT
structure so you can check it.
There is also yet another solution. You can create non HVM thread
which will be used to create all windows and process their message
queues. It will not make any other jobs so it will be always available
and other threads which may call locking windows API function will
not have to worry about deadlock because all locks used by window
owner thread will be known. This also resolve the problem of
automatic window refreshing.

HTH and now you understand what is the problem and why unlocking
GT inside hb_gtInfoeEx() before calling GT method(s) is a hack
which may hide the problem in one particular case but it's not a
real solution. You have to design your code keeping in mind that
in MS-Windows only thread which created window can process window
messages and other threads will be blocked calling functions which
needs as result message processing.

best regards,
Przemek
From bedipritpal at hotmail.com  Fri Nov 21 09:46:51 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Fri Nov 21 09:46:54 2008
Subject: [Harbour] MT and hb_gtInfo() - Appln Locks
In-Reply-To: <20081121130142.GA23582@34-mo7-2.acn.waw.pl>
References: <20613862.post@talk.nabble.com>
	<20081121130142.GA23582@34-mo7-2.acn.waw.pl>
Message-ID: <20622543.post@talk.nabble.com>


Przemek


Przemyslaw Czerpak-2 wrote:
> 
> There is also yet another solution. You can create non HVM thread
> which will be used to create all windows and process their message
> queues. It will not make any other jobs so it will be always available
> and other threads which may call locking windows API function will
> not have to worry about deadlock because all locks used by window
> owner thread will be known. This also resolve the problem of
> automatic window refreshing.
> 

All other solutions are too much and all GTs must have to be modified
to respect it. Non HVM thread creating windows and managing its message
loop appears to be the right solution. It will also open some interesting
possibilities. Can you guide me how this can be done? I will do all efforts
to materialize it.

I do not use hb_gtInfoEx() as it also has sweare implications. About to be
removed from the sources. You are right that this hack is dangerous.

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/MT-and-hb_gtInfo%28%29---Appln-Locks-tp20613862p20622543.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From rportnoff at spendmap.com  Fri Nov 21 12:32:25 2008
From: rportnoff at spendmap.com (Randy Portnoff)
Date: Fri Nov 21 12:32:35 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <20613862.post@talk.nabble.com>
References: <20613862.post@talk.nabble.com>
Message-ID: <B0085114372@ms1.3peaks.com>

Hi all,

Is there a way to return a DWORD value using HBAPI.H or does this 
conversion (ie. from LONG to DWORD) need to be done at the PRG level?

Regards,
Randy.


From dbtopas at dbtopas.lt  Fri Nov 21 17:15:49 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Fri Nov 21 17:17:54 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <B0085114372@ms1.3peaks.com>
References: <20613862.post@talk.nabble.com> <B0085114372@ms1.3peaks.com>
Message-ID: <49273315.6030600@dbtopas.lt>

Hi,


> Is there a way to return a DWORD value using HBAPI.H or does this 
> conversion (ie. from LONG to DWORD) need to be done at the PRG level?

Try
    hb_retnint( (HB_LONG) dword );


Regards,
Mindaugas
From druzus at acn.waw.pl  Fri Nov 21 19:31:46 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov 21 19:30:23 2008
Subject: [Harbour] Closing relation
In-Reply-To: <49269650.9080503@dbtopas.lt>
References: <49269650.9080503@dbtopas.lt>
Message-ID: <20081122003146.GA1075@34-mo7-2.acn.waw.pl>

On Fri, 21 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> is there any way in Harbour/Clipper to close a single relation of workarea?

No. There are no RDD methods which allows to implement it.
You can hardcode it without RDD API but it's rather bad idea.
You can also collect information about active relations, clear
all and then restore them except the one you want to remove but
it will work only if all relation expressions can be recompiled
using their string expressions.

best regards,
Przemek
From bruno.luciani at gmail.com  Sat Nov 22 06:37:06 2008
From: bruno.luciani at gmail.com (Bruno Luciani)
Date: Sat Nov 22 06:37:10 2008
Subject: [Harbour] harbour error compiling xhgtk sample
Message-ID: <133778360811220337q4de392b0r7714c9356f08d996@mail.gmail.com>

I am posting in the developer' s list because  i don' t get any answer in
users list

I am using harbour , last version in Ubuntu 8.10

I get this error trying to compile a Xhgtk Sample   ( library was compiled
with the same harbour version without problems )

thanks for any help

Bruno

///////////////// error code
////////////////////////////////////////////////////////////

bruno@notebook:~/xhgtk/samples/classes/browse$ sh build.sh browse
Harbour 1.0.1 Intl. (Rev. 9429)
Copyright (c) 1999-2008, http://www.harbour-project.org/
Compiling 'browse.prg'...
Lines 5786, Functions/Procedures
Generating C source output to 'browse.c'... Done.
/usr/lib/harbour/libhbrtl.a(gtsys.o): In function
`hb_gt_ForceLink_HB_GT_TRM':
(.text+0x7): undefined reference to `HB_FUN_HB_GT_TRM'
collect2: ld devolvi? el estado de salida 1
build.sh: 51: ./browse: not found

////////////////////////////////////////////////////////////////////////////////////////////////////////////
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081122/ec5d09ee/attachment.html
From bruno.luciani at gmail.com  Sat Nov 22 06:47:58 2008
From: bruno.luciani at gmail.com (Bruno Luciani)
Date: Sat Nov 22 06:48:02 2008
Subject: [Harbour] contribs
Message-ID: <133778360811220347l13ec9219vcbe66c2f1480ebd6@mail.gmail.com>

Where I can found contribs compiled for UBUNTU or at least
the source of contribs ?

Thanks

Bruno
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081122/382348b5/attachment.html
From lorenzo.fiorini at gmail.com  Sat Nov 22 07:49:43 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sat Nov 22 07:49:47 2008
Subject: [Harbour] harbour error compiling xhgtk sample
In-Reply-To: <133778360811220337q4de392b0r7714c9356f08d996@mail.gmail.com>
References: <133778360811220337q4de392b0r7714c9356f08d996@mail.gmail.com>
Message-ID: <9257026e0811220449o1832ecbfg5c9f047c95302967@mail.gmail.com>

On Sat, Nov 22, 2008 at 12:37 PM, Bruno Luciani <bruno.luciani@gmail.com> wrote:

> I get this error trying to compile a Xhgtk Sample   ( library was compiled
> with the same harbour version without problems )

add gttrm to the lib list or use hb* scripts and define the gt you
want using -gt <xyz>.

best regards,
Lorenzo
From lorenzo.fiorini at gmail.com  Sat Nov 22 07:54:30 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sat Nov 22 07:54:35 2008
Subject: [Harbour] contribs
In-Reply-To: <133778360811220347l13ec9219vcbe66c2f1480ebd6@mail.gmail.com>
References: <133778360811220347l13ec9219vcbe66c2f1480ebd6@mail.gmail.com>
Message-ID: <9257026e0811220454o79ef19dfq2fdc6bc1a466c56b@mail.gmail.com>

On Sat, Nov 22, 2008 at 12:47 PM, Bruno Luciani <bruno.luciani@gmail.com> wrote:

> Where I can found contribs compiled for UBUNTU or at least
> the source of contribs ?

Go to http://sourceforge.net/projects/harbour-project, click on the
big green Download link and get the package "source".

best regards,
Lorenzo
From druzus at acn.waw.pl  Sat Nov 22 09:59:49 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sat Nov 22 09:58:25 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
In-Reply-To: <4926A9BF.4010709@libero.it>
References: <ACB539B7-43FA-4D3E-AE96-DA5601FAD583@syenar.hu>
	<20081118015355.GA20607@34-mo7-2.acn.waw.pl>
	<9257026e0811180136pcaf446p2d269b8a1154d373@mail.gmail.com>
	<1BD044B1-17D8-4523-A7E0-8B9A08019C25@syenar.hu>
	<20081118141839.GA11032@34-mo7-2.acn.waw.pl>
	<CCA65F73-B38F-454D-AAE1-5EB18C238428@syenar.hu>
	<9257026e0811182239v26d06e8apb66c2b3426456a0d@mail.gmail.com>
	<4923E65E.1070804@libero.it>
	<2B41321A-0151-4736-8D08-F4095C3649B7@syenar.hu>
	<4926A9BF.4010709@libero.it>
Message-ID: <20081122145949.GA22508@34-mo7-2.acn.waw.pl>

On Fri, 21 Nov 2008, Maurilio Longo wrote:

Hi Maurilio,

> in OS/2 there is an envvar, LIBPATH=, which always contains '.' and is used by
> OS/2 to find needed DLLs; so every program looks at the dirctory it was
> started from when looking for .DLLs.
> I don't think this is available on MacOSX.

It is just like in other *nixes. The envvar name is of course different:

 DYLD_LIBRARY_PATH
        This  is  a  colon  separated  list  of directories that contain libraries. The dynamic linker
        searches these directories before it searches the default locations for libraries.  It  allows
        you to test new versions of existing libraries.

        For  each  library  that  a program uses, the dynamic linker looks for it in each directory in
        DYLD_LIBRARY_PATH in turn. If it still can't find the library,  it  then  searches  DYLD_FALL-BACK_FRAMEWORK_PATH DYLD_FALLBACK_FRAMEWORK_PATH
        BACK_FRAMEWORK_PATH and DYLD_FALLBACK_LIBRARY_PATH in turn.

        Use  the -L option to otool(1).  to discover the frameworks and shared libraries that the exe-cutable executable
        cutable is linked against.

 DYLD_FALLBACK_LIBRARY_PATH
        This is a colon separated list of directories that contain  libraries.   It  is  used  as  the
        default  location  for  libraries  not  found in their install path.  By default, it is set to
        $(HOME)/lib:/usr/local/lib:/lib:/usr/lib.

Please also look at defaults which shows how to create non system wide
user customized installation and where should be put shared libraries
to not force any environment variable settings.
Whole necessary information is easy accessible in MacOSX. It's enough to
read few man pages like man ld, man dlld, man dlopen, ...
It's said that I have to find such information in the internet without
MacOSX and real MacOSX user cannot so resolves the problem by disabling
shared linking in default builds. It causes that I stop to trust in any
other opinions about this system because it may be only result of
insufficient knowledge about MacOSX.

> > as possible. In OS X, installation is rather the exception
> > than the rule, which is just one more reason to allow support
> > for it (especially if it doesn't hurt anyone).
> I agree with you here, and with something you wrote later, MacOSX is not
> linux, so it is wrong to see it just like a unix dialect with some fancy
> window manager.

Yes, it's not Linux. It's modified BSD.
,--------------------------------------------------------------------------
| Berkeley Software Distribution (BSD)
| Part of the history of Mac OS X goes back to Berkeley Software
| Distributions (BSD) UNIX of the early seventies. Specifically,
| Mac OS X is based in part on BSD 4.4 Lite. On a system level, many
| of the design decisions are made to align with BSD-style UNIX systems.
| Most libraries and utilities are from FreeBSD, but some are derived
| from NetBSD. For future development, Mac OS X has adopted FreeBSD as
| a reference code base for BSD technology. Work is ongoing to synchronize
| all BSD tools and libraries more closely with the FreeBSD-stable branch.
`--------------------------------------------------------------------------

> That said, what about having MacOSX specific commands instead of changing the
> ones that work on most the other *nixes?

I have nothing against adding any extensions to MacOSX builds.
This is what I'm asking for. Add any new extensions to customized
MacOSX builds but please do not reduce existing functionality and
do not forbid users to create binaries compatible with other *nixes.

best regards,
Przemek
From bruno.luciani at gmail.com  Sat Nov 22 10:45:15 2008
From: bruno.luciani at gmail.com (Bruno Luciani)
Date: Sat Nov 22 10:45:19 2008
Subject: [Harbour] harbour error compiling xhgtk sample
Message-ID: <133778360811220745y67c24c7bve674590550ce1cf3@mail.gmail.com>

Lorenzo

I just try , adding -lgttrm to the compiling scritp and now the error has
changed



//////////////////////////////////////////////////////////////////////////////////////////////
bruno@notebook:~/xhgtk/samples/classes/browse$ sh build.sh browse
Harbour 1.0.1 Intl. (Rev. 9429)
Copyright (c) 1999-2008, http://www.harbour-project.org/
Compiling 'browse.prg'...
Lines 5786, Functions/Procedures 3
Generating C source output to 'browse.c'... Done.
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `set_gpmevt':
(.text+0x1229): undefined reference to `Gpm_GetEvent'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `flush_gpmevt':
(.text+0x13bb): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `flush_gpmevt':
(.text+0x13ff): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `flush_gpmevt':
(.text+0x1410): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `flush_gpmevt':
(.text+0x142d): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `flush_gpmevt':
(.text+0x1449): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x14b6): undefined reference to `gpm_visiblepointer'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x14c4): undefined reference to `_gpm_buf'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x14cb): undefined reference to `_gpm_arg'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x14d0): undefined reference to `_gpm_arg'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x14e3): undefined reference to `gpm_zerobased'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x14f4): undefined reference to `_gpm_arg'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x14fc): undefined reference to `_gpm_arg'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x150f): undefined reference to `gpm_zerobased'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x1520): undefined reference to `_gpm_arg'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x152d): undefined reference to `_gpm_buf'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `disp_mousecursor':
(.text+0x1533): undefined reference to `gpm_consolefd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_init':
(.text+0x1635): undefined reference to `gpm_zerobased'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_init':
(.text+0x163f): undefined reference to `gpm_visiblepointer'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_init':
(.text+0x165b): undefined reference to `Gpm_Open'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_init':
(.text+0x1668): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_init':
(.text+0x1675): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_init':
(.text+0x16a2): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_init':
(.text+0x16e7): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_exit':
(.text+0x1790): undefined reference to `gpm_fd'
/usr/lib/harbour/libgttrm.a(gttrm.o):(.text+0x1799): more undefined
references to `gpm_fd' follow
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `mouse_exit':
(.text+0x17ad): undefined reference to `Gpm_Close'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `hb_gt_trm_mouse_Show':
(.text+0x4bb8): undefined reference to `gpm_visiblepointer'
/usr/lib/harbour/libgttrm.a(gttrm.o): In function `hb_gt_trm_mouse_Hide':
(.text+0x4bef): undefined reference to `gpm_visiblepointer'
collect2: ld devolvi? el estado de salida 1
build.sh: 51: ./browse: not found
bruno@notebook:~/xhgtk/samples/classes/browse$
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081122/9ee4f38c/attachment-0001.html
From lorenzo.fiorini at gmail.com  Sat Nov 22 11:38:55 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sat Nov 22 11:38:59 2008
Subject: [Harbour] harbour error compiling xhgtk sample
In-Reply-To: <133778360811220745y67c24c7bve674590550ce1cf3@mail.gmail.com>
References: <133778360811220745y67c24c7bve674590550ce1cf3@mail.gmail.com>
Message-ID: <9257026e0811220838p31fd0591yd386c57f9a60449f@mail.gmail.com>

On Sat, Nov 22, 2008 at 4:45 PM, Bruno Luciani <bruno.luciani@gmail.com> wrote:

> I just try , adding -lgttrm to the compiling scritp and now the error has
> changed

You miss the gpm lib. Try to add -lgpm.

There is much simpler way to build xhgtk samples:
hbmk <example> -xhgtk -I<path to include> -L<path to libxhgtk.a>

best regards,
Lorenzo
From bruno.luciani at gmail.com  Sat Nov 22 14:57:59 2008
From: bruno.luciani at gmail.com (Bruno Luciani)
Date: Sat Nov 22 14:58:02 2008
Subject: [Harbour] Compiling xhgtk sample
Message-ID: <133778360811221157j10a08823sf12485b3a70d656a@mail.gmail.com>

Thanks Lorenzo , now it works ok

Best Regards

Bruno Luciani


////////////////////////////////////////////////

*Lorezo Fiorino wrote:*

You miss the gpm lib. Try to add -lgpm.

There is much simpler way to build xhgtk samples:
hbmk <example> -xhgtk -I<path to include> -L<path to libxhgtk.a>

best regards,
Lorenzo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081122/25258239/attachment.html
From bedipritpal at hotmail.com  Sat Nov 22 18:55:46 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov 22 18:55:50 2008
Subject: [Harbour] 2008-11-22 15:39 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20641867.post@talk.nabble.com>


2008-11-22 15:39 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    ! Fixed to honor parent GT if that is alien.

  * harbour/contrib/gtwvg/wvggui.c
    ! Thorough synchronized hb_gtInfo() slots.
      Every info gives results as expected, the only 
      poiint to remeber is that those values are based on :fontHeight/Width
      set by the user at startup, though the font is never created.
      So MaxCol() will return the ( Windows client area size / fontWidth ).
      At any given moment this value is measured from actual size of the
      window. Though this information is irrelevant in this context
      but still it works.

  * harbour/contrib/gtwvg/wvgsink.c
    ! Fixed few left-over unreleased memory blocks.
      More synchronized code.

    ; TOFIX: With some active-x's, for example, Shell.Explorer.2, 
      object never unreference itself to 0 and hence GlobalAlloc()ated
      memory never gets released. Though I made extensive debugging 
      but do not know where I should look into this matter.     

  * harbour/contrib/gtwvg/wvgwin.c
    + Added few more Win_* functions.

  * harbour/contrib/gtwvg/wvgax.prg
  * harbour/contrib/gtwvg/wvgcrt.prg
  * harbour/contrib/gtwvg/wvgdlg.prg
    ! More synchronizations, method implementations, etc.
      Still a work in progress.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! Changed menu prompts to depict correct usage.
    + Added more prompts and deleted unwanted ones.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-22-15%3A39-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20641867p20641867.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sat Nov 22 18:59:54 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sat Nov 22 18:59:57 2008
Subject: [Harbour] 2008-11-22 15:57 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20641895.post@talk.nabble.com>


2008-11-22 15:57 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  + harbour/contrib/gtwvg/tests/myharu.pdf

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-22-15%3A57-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20641895p20641895.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From lorenzo.fiorini at gmail.com  Sun Nov 23 01:57:31 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sun Nov 23 01:57:35 2008
Subject: [Harbour] Contribs and dependences management
Message-ID: <9257026e0811222257q3c2c106dj2c6252d34d74a5c9@mail.gmail.com>

Using gnu make system and hb* scripts, I can easily build the contribs
simply adding them to HB_CONTRIBLIBS but when I need to build
executable all the dependences have to be added to the hbmk command
line.

In Linux this is not a big problem usually means simply a -l<devlib>
but under Win and OSX is not so easy.

Today to achieve this I've modified my local hb-func.sh and
hb-mkslib.sh to include all the contribs into harbour's shared lib
adding  HB_CONTRIBLIBS to mk_hbgetlibs() and to include f.e.
PostgreSQL I've added to hb-func.sh:
...
if [ "\${HB_PGSQL}" = "yes" ]; then
    if [ "\${HB_ARCHITECTURE}" = "w32" ]; then
       SYSTEM_LIBS="\${SYSTEM_LIBS} -L/opt/pgsql/lib"
    fi
    if [ "\${HB_ARCHITECTURE}" = "darwin" ]; then
        SYSTEM_LIBS="\${SYSTEM_LIBS} -L/opt/local/lib -lssl -lldap
-lcrypto -lkrb5"
    fi
    SYSTEM_LIBS="\${SYSTEM_LIBS} -lpq"
fi
...

and to hb-mkslib.sh:
...
if [ "${SLIB_EXT}" = ".dylib" ]; then
...
	-L/opt/local/lib -lpq -lssl -lldap -lcrypto -lkrb5 -lgd \
...
elif [ "${SLIB_EXT}" = ".dll" ]; then
...
        SYSLIBS="${SYSLIBS} -L/opt/local/lib -lgd -L/opt/pgsql/lib -lpq"
...
    fi



this allows me to get small cgi executables using hbmk <myprg> -gd
-pgsql or easily add pgsql to gtk apps using
hbmk <myprg> -xhgtk -pgsql but I think we need to find a more
"universal way" to manage contribs.

Just to start the discussion:

how:
- add a switch for every contrib like the actual -xbgtk -xhgtk -hwgui

for the contrib that DON'T need external deps ( hbvpdf, hbct ):
- include into Harbour's shared lib
- create a single "hbext" shared lib
- create one shared lib for every contrib

for the contrib that need external deps:
- if we define that every dependence is in form: /<depdir>/[bin,include,lib]
    then HB_INC_xyz should point to <depdir> and we should use
<depdir>/include in makefiles and <depdir>/lib at link time
- we need a way to define the list of dep libs ( -L/opt/local/lib -lpq
-lssl -lldap -lcrypto -lkrb5 )

an example to follow could be PHP's extensions: one shared lib for
every contrib.

Comments?

best regards,
Lorenzo
From maurilio.longo at libero.it  Sun Nov 23 06:52:15 2008
From: maurilio.longo at libero.it (maurilio longo)
Date: Sun Nov 23 06:52:19 2008
Subject: [Harbour] OSX (and Linux) and dyn libs
Message-ID: <KASBN3$0B9ABC398C98B40010166BEF31A131FA@libero.it>

Przemyslaw,

I was answering to Viktor since he named OS/2 and asking him why he did change linux (or more in general unix compitible) scripts instead of creating new ones for macosx.

I was not saying you're against adding new command for macosx or anything like that.

This just for clarification.

Best regards.

Maurilio.

PS. If I'm not wrong, usually on *nixes, the envars which deal with paths don't have '.' in them as a security measure, so that you're sure you're using the correct executable and/or library; this could mean that to be able to start something from a usb key (like Viktor would like to be able to do) requires a little script which adds '.' to the needed paths.



> On Fri, 21 Nov 2008, Maurilio Longo wrote:
> 
> Hi Maurilio,
> 
> > in OS/2 there is an envvar, LIBPATH=, which always contains '.' and is used by
> > OS/2 to find needed DLLs; so every program looks at the dirctory it was
> > started from when looking for .DLLs.
> > I don't think this is available on MacOSX.
> 
> It is just like in other *nixes. The envvar name is of course different:
> 
>  DYLD_LIBRARY_PATH
>         This  is  a  colon  separated  list  of directories that contain libraries. The dynamic linker
>         searches these directories before it searches the default locations for libraries.  It  allows
>         you to test new versions of existing libraries.
> 
>         For  each  library  that  a program uses, the dynamic linker looks for it in each directory in
>         DYLD_LIBRARY_PATH in turn. If it still can't find the library,  it  then  searches  DYLD_FALL-BACK_FRAMEWORK_PATH DYLD_FALLBACK_FRAMEWORK_PATH
>         BACK_FRAMEWORK_PATH and DYLD_FALLBACK_LIBRARY_PATH in turn.
> 
>         Use  the -L option to otool(1).  to discover the frameworks and shared libraries that the exe-cutable executable
>         cutable is linked against.
> 
>  DYLD_FALLBACK_LIBRARY_PATH
>         This is a colon separated list of directories that contain  libraries.   It  is  used  as  the
>         default  location  for  libraries  not  found in their install path.  By default, it is set to
>         $(HOME)/lib:/usr/local/lib:/lib:/usr/lib.
> 
> Please also look at defaults which shows how to create non system wide
> user customized installation and where should be put shared libraries
> to not force any environment variable settings.
> Whole necessary information is easy accessible in MacOSX. It's enough to
> read few man pages like man ld, man dlld, man dlopen, ...
> It's said that I have to find such information in the internet without
> MacOSX and real MacOSX user cannot so resolves the problem by disabling
> shared linking in default builds. It causes that I stop to trust in any
> other opinions about this system because it may be only result of
> insufficient knowledge about MacOSX.
> 
> > > as possible. In OS X, installation is rather the exception
> > > than the rule, which is just one more reason to allow support
> > > for it (especially if it doesn't hurt anyone).
> > I agree with you here, and with something you wrote later, MacOSX is not
> > linux, so it is wrong to see it just like a unix dialect with some fancy
> > window manager.
> 
> Yes, it's not Linux. It's modified BSD.
> ,--------------------------------------------------------------------------
> | Berkeley Software Distribution (BSD)
> | Part of the history of Mac OS X goes back to Berkeley Software
> | Distributions (BSD) UNIX of the early seventies. Specifically,
> | Mac OS X is based in part on BSD 4.4 Lite. On a system level, many
> | of the design decisions are made to align with BSD-style UNIX systems.
> | Most libraries and utilities are from FreeBSD, but some are derived
> | from NetBSD. For future development, Mac OS X has adopted FreeBSD as
> | a reference code base for BSD technology. Work is ongoing to synchronize
> | all BSD tools and libraries more closely with the FreeBSD-stable branch.
> `--------------------------------------------------------------------------
> 
> > That said, what about having MacOSX specific commands instead of changing the
> > ones that work on most the other *nixes?
> 
> I have nothing against adding any extensions to MacOSX builds.
> This is what I'm asking for. Add any new extensions to customized
> MacOSX builds but please do not reduce existing functionality and
> do not forbid users to create binaries compatible with other *nixes.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

From bedipritpal at hotmail.com  Sun Nov 23 17:23:41 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 23 17:23:44 2008
Subject: [Harbour] 2008-11-23 13:27 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20651756.post@talk.nabble.com>


2008-11-23 13:27 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    + static void hb_gt_wvt_FireMenuEvent( PHB_GTWVT pWVT, int iMode, int
menuIndex )
    + WM_ENTERMENULOOP
    + WM_EXITMENULOOP
    ! WM_COMMAND - Enhanced

  * harbour/contrib/gtwvg/wvggui.c
    + Same as with gtwvg.c

  * harbour/contrib/gtwvg/wvgsink.c
    + Experimental TypeLib info extraction function. Disabled for now.

  * harbour/contrib/gtwvg/wvgwin.c
    + Many new Win_* winapi functions.

  * harbour/contrib/gtwvg/hbgtwvg.ch
    + HB_GTI_MENU

  * harbour/contrib/gtwvg/wvgax.prg
  * harbour/contrib/gtwvg/wvgcrt.prg
  * harbour/contrib/gtwvg/wvgdlg.prg
  + harbour/contrib/gtwvg/wvgmenub.prg
  * harbour/contrib/gtwvg/wvgphdlr.prg
    + Implemented ( partially but functional ) Xbase++ compatible
      WvgMenuBar() and WvgMenu() classes.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    + Demonstrated WvgMenuBar() and WvgMenu() implementation
      by picking up the real-time Xbase++ code.

  ; NEXT: WvtToolBar() class per XbpToolBar().  

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-23-13%3A27-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20651756p20651756.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From e.m.giordano at emagsoftware.it  Sun Nov 23 17:46:44 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Sun Nov 23 17:46:48 2008
Subject: [Harbour] Error in latest SVN?
Message-ID: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>

\wvgphdlr.prg(379) Warning W0003  Variable 'XRESULT' declared but not used 
in function 'WVGPARTHANDLER_NOTIFIER(236)'

\wvgphdlr.prg(379) Warning W0003  Variable 'N' declared but not used in 
function 'WVGPARTHANDLER_NOTIFIER(236)'

\wvgphdlr.prg(379) Warning W0003  Variable 'BBLOCK' declared but not used 
in function 'WVGPARTHANDLER_NOTIFIER(238)'

\wvgphdlr.prg(379) Warning W0003  Variable 'NPOS' declared but not used in 
function 'WVGPARTHANDLER_NOTIFIER(238)'

** error 1 ** deleting obj\b32\wvgphdlr.obj

I don't understand where is the error...

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From bedipritpal at hotmail.com  Sun Nov 23 18:01:59 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 23 18:02:02 2008
Subject: [Harbour] 2008-11-23 15:00 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20652175.post@talk.nabble.com>


2008-11-23 15:00 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/Makefile
  * harbour/contrib/gtwvg/common.mak
    + wvgmenub.prg 

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-23-15%3A00-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20652175p20652175.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From mbelgrano at deltain.it  Sun Nov 23 19:00:54 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Sun Nov 23 19:02:03 2008
Subject: [Harbour] 2008-11-23 13:27 UTC-0800 Pritpal
	Bedi(pritpal@vouchcac.com)
In-Reply-To: <20651756.post@talk.nabble.com>
References: <20651756.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1F6@SRV02.deltain.net>

Hi all 
With hbp a component technology is born in harbour
Can I invite other Harbour GURU & GUI explain how think of HBP/GTWVG?
I want invite Other people cooperate on gtwvf/hbp

This question are for the author Pritpal
I am interested to better understand your section of gtwvg that is
compatible with xbasepart class hbp
Have you more sample?
Is hbp multi platform?
Do you think to implement all xbasepart like XbpGET()?
Will this hbp syntax be used for having a pluggable gui (switch at
runtime or linktime)?
Why not made hbp (Harbour part) as stand alone library?
Will this component library and GUI controls implemented in harbour
using native API access ?

Best regard

-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Sunday, November 23, 2008 11:24 PM
To: harbour@harbour-project.org
Subject: [Harbour] 2008-11-23 13:27 UTC-0800 Pritpal
Bedi(pritpal@vouchcac.com)


2008-11-23 13:27 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/gtwvg.c
    + static void hb_gt_wvt_FireMenuEvent( PHB_GTWVT pWVT, int iMode,
int
menuIndex )
    + WM_ENTERMENULOOP
    + WM_EXITMENULOOP
    ! WM_COMMAND - Enhanced

  * harbour/contrib/gtwvg/wvggui.c
    + Same as with gtwvg.c

  * harbour/contrib/gtwvg/wvgsink.c
    + Experimental TypeLib info extraction function. Disabled for now.

  * harbour/contrib/gtwvg/wvgwin.c
    + Many new Win_* winapi functions.

  * harbour/contrib/gtwvg/hbgtwvg.ch
    + HB_GTI_MENU

  * harbour/contrib/gtwvg/wvgax.prg
  * harbour/contrib/gtwvg/wvgcrt.prg
  * harbour/contrib/gtwvg/wvgdlg.prg
  + harbour/contrib/gtwvg/wvgmenub.prg
  * harbour/contrib/gtwvg/wvgphdlr.prg
    + Implemented ( partially but functional ) Xbase++ compatible
      WvgMenuBar() and WvgMenu() classes.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    + Demonstrated WvgMenuBar() and WvgMenu() implementation
      by picking up the real-time Xbase++ code.

  ; NEXT: WvtToolBar() class per XbpToolBar().  

Regards
Pritpal Bedi
-- 
View this message in context:
http://www.nabble.com/2008-11-23-13%3A27-UTC-0800-Pritpal-Bedi-%28pritpa
l%40vouchcac.com%29-tp20651756p20651756.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From bedipritpal at hotmail.com  Sun Nov 23 20:28:26 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 23 20:28:31 2008
Subject: [Harbour] 2008-11-23 17:28 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20653435.post@talk.nabble.com>


2008-11-23 17:28 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/Makefile
  * harbour/contrib/gtwvg/common.mak
    + wvgtoolb.prg 

  * harbour/contrib/gtwvg/hbgtwvg.ch
  * harbour/contrib/gtwvg/wvgdlg.prg
  * harbour/contrib/gtwvg/wvgmenub.prg
  * harbour/contrib/gtwvg/wvgphdlr.prg
  + harbour/contrib/gtwvg/wvgtoolb.prg
    ! Initial commit.
  * harbour/contrib/gtwvg/wvgwnd.prg
    
    ! Usual cleanup plus new functions/members etc.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-23-17%3A28-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20653435p20653435.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 23 20:43:06 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 23 20:43:09 2008
Subject: [Harbour] 2008-11-23 13:27 UTC-0800 Pritpal
	Bedi(pritpal@vouchcac.com)
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F1F6@SRV02.deltain.net>
References: <20651756.post@talk.nabble.com>
	<AFB948164110ED43B5EB849E8DEEF03815F1F6@SRV02.deltain.net>
Message-ID: <20653568.post@talk.nabble.com>


Massimo

>With hbp a component technology is born in harbour

This is not component technology. It is simple GUI technology 
which Harbour lacks, at least in the core compiler.

>Have you more sample?

What more samples? Whatever I develop I put in demowvg.prg.
You can examine it whenever I declare a new part functional.
More you can stucy Xbase++ examples. But be aware that 
stucy only those parts which are covered in GTWVG.

>Is hbp multi platform?

If someone takes pain it can be. I have kept PRG layer separate from
API layer. One has to write the wrappers for API layer only. Class framework
will remain the same and docuented.

>Do you think to implement all xbasepart like XbpGET()?

Sure. But remember I have a very limited knowledge of WinApi.

>Will this hbp syntax be used for having a pluggable gui (switch at
runtime or linktime)?

Yes. If you link your application with GTWVG then you can access 
all its power alongwith your CUI applications. But you need
to design your applications accordingly.

>Why not made hbp (Harbour part) as stand alone library?

I am not sure what you mean. It is aleady standalone and is in contribs.

>Will this component library and GUI controls implemented in harbour
using native API access ?

Again I could not understand your point. Right now it is for Windows only.
Future I cannot foresee.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/2008-11-23-13%3A27-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20651756p20653568.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Sun Nov 23 20:46:20 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 23 20:46:22 2008
Subject: [Harbour] Error in latest SVN?
In-Reply-To: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
Message-ID: <20653599.post@talk.nabble.com>


Enrico

Download latest SVN. It is fixed.
Only left-over variables issue. I will change my 
compiler settings more strict.

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/Error-in-latest-SVN--tp20652629p20653599.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From lorenzo.fiorini at gmail.com  Mon Nov 24 02:05:55 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Nov 24 02:06:01 2008
Subject: [Harbour] OT: with VirtualBox 2.0.6 Harbour Win apps can access
	shared folders files in Linux hosts
Message-ID: <9257026e0811232305i1032b44fre368c5090dc99599@mail.gmail.com>

Since I've mentioned about this problem few weeks ago I'd like to
report that now with 2.0.6 it has been fixed.

Many thanks Sun.

best regards,
Lorenzo
From e.m.giordano at emagsoftware.it  Mon Nov 24 03:04:47 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Nov 24 03:04:53 2008
Subject: [Harbour] Error in latest SVN?
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
	<20653599.post@talk.nabble.com>
Message-ID: <4D4BD976CF5C480F9A17DE0D3BA2970E@emag>


-----Messaggio Originale----- 
Da: "Pritpal Bedi" <bedipritpal@hotmail.com>
A: <harbour@harbour-project.org>
Data invio: luned? 24 novembre 2008 2.46
Oggetto: Re: [Harbour] Error in latest SVN?


>
> Enrico
>
> Download latest SVN. It is fixed.
> Only left-over variables issue. I will change my
> compiler settings more strict.

Thank you. There are some more warnings:

Warning W8060 .\wvgsink.c 516: Possibly incorrect assignment in function 
SetupConnectionPoint
Warning W8084 .\wvgsink.c 704: Suggest parentheses to clarify precedence in 
function HB_FUN_HB_AX_ATLAXCREATECONTROL
Warning W8084 .\wvgsink.c 769: Suggest parentheses to clarify precedence in 
function HB_FUN_HB_AX_ATLAXGETCONTROL

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From e.m.giordano at emagsoftware.it  Mon Nov 24 03:15:34 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Mon Nov 24 03:15:38 2008
Subject: [Harbour] Warnings in hbwhat contrib
Message-ID: <CABC523544324340A08D47383F05CCDA@emag>

Warning W8084 .\whtcomm.c 189: Suggest parentheses to clarify precedence in 
function HB_FUN_VWN_CREATEPROGRESSBAR
Warning W8084 .\whtcomm.c 381: Suggest parentheses to clarify precedence in 
function HB_FUN_VWN_LISTVIEW_GETFIRSTITEM

Warning W8084 .\whthead.c 351: Suggest parentheses to clarify precedence in 
function HB_FUN_VWN_HEADER_EDITFILTER

Warning W8084 .\whtlv.c 33: Suggest parentheses to clarify precedence in 
function HB_FUN_VWN_LISTVIEW_ENSUREVISIBLE
Warning W8084 .\whtlv.c 49: Suggest parentheses to clarify precedence in 
function HB_FUN_VWN_LISTVIEW_GETNEXTITEM

Warning W8080 .\whtmmcap.c 862: 'dwICValue' is declared but never used

Warning W8084 .\whttab.c 231: Suggest parentheses to clarify precedence in 
function HB_FUN_VWN_TABCTRL_SETITEMSIZE
Warning W8084 .\whttab.c 249: Suggest parentheses to clarify precedence in 
function HB_FUN_VWN_TABCTRL_SETPADDING
Warning W8084 .\whttab.c 313: Suggest parentheses to clarify precedence in 
function HB_FUN_VWN_TABCTRL_HIGHLIGHTITEM

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From mbelgrano at deltain.it  Mon Nov 24 05:36:02 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 24 05:37:09 2008
Subject: [Harbour] 2008-11-23 13:27 UTC-0800
	PritpalBedi(pritpal@vouchcac.com)
In-Reply-To: <20653568.post@talk.nabble.com>
References: <20651756.post@talk.nabble.com><AFB948164110ED43B5EB849E8DEEF03815F1F6@SRV02.deltain.net>
	<20653568.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F1FD@SRV02.deltain.net>

Pritpal
>>Have you more sample?

>What more samples? Whatever I develop I put in demowvg.prg.
>You can examine it whenever I declare a new part functional.
>More you can stucy Xbase++ examples. But be aware that 
>stucy only those parts which are covered in GTWVG.

>>Is hbp multi platform?
>If someone takes pain it can be. I have kept PRG layer separate from
>API layer. One has to write the wrappers for API layer only. Class
framework
>will remain the same and docuented.
Intresting xbp is port to os2 and go to win so can be portable
where is documented class frameword?
Other are interested to convert?
Imo Budyanto will give a good way to gtwvg grow
Imo you you share most documentation possible most harbour user will
help you

>>Will this hbp syntax be used for having a pluggable gui (switch at
>runtime or linktime)?
>Yes. If you link your application with GTWVG then you can access 
>all its power alongwith your CUI applications. But you need
>to design your applications accordingly.
Good a demo (northwind like) of converted application for better
understand

>Why not made hbp (Harbour part) as stand alone library?
>I am not sure what you mean. It is aleady standalone and is in
contribs.
Is used in conjunction with different GUI technologies
(wvtclass,modeless dialog,)
I think if is possible an extension for each Hybrid GUI


From mbelgrano at deltain.it  Mon Nov 24 05:52:29 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 24 05:53:36 2008
Subject: [Harbour] Error in latest SVN?
In-Reply-To: <20653599.post@talk.nabble.com>
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
	<20653599.post@talk.nabble.com>
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F201@SRV02.deltain.net>

A litttle suggestion 
One batch for compile demo in all platform (aivable)
-------------------Hbmkwvg.bat---------------------
@echo off
rem
rem $Id: hbmk_b32.bat 9926 2008-11-15 00:54:22Z vszakats $
rem

if "%HB_BIN_INSTALL%" == "" set HB_BIN_INSTALL=..\..\..\bin
if "%HB_LIB_INSTALL%" == "" set HB_LIB_INSTALL=..\..\..\lib
if "%HB_INC_INSTALL%" == "" set HB_INC_INSTALL=..\..\..\include

set HB_USER_LIBS=gtwvg.lib hbwin.lib
set HB_GUI=yes

call %HB_BIN_INSTALL%\hbmk.bat %1 %2 %3 %4 %5 %6 %7 %8 %9


you can compile with 
hbmkwvg -mt demowvg
I suggest also add in header of demowvg.prg

/*
 * $Id: demowvg.prg 9952 2008-11-23 22:22:39Z vouchcac $
 */
//-------------------------------------------------------------------//
//-------------------------------------------------------------------//
// compile this sample with
// hbmkwvg -mt demowvg for multi thread mode
// hbmkwvg  demowvg   for single thread mode
//-------------------------------------------------------------------//
//-------------------------------------------------------------------//
//                   GTWVT Console GUI Interface
//
//               Pritpal Bedi <pritpal@vouchcac.com>
//
//       I have tried to simulate the gui controls through GDI
//        functions and found a way to refresh those controls
//          through WM_PAINT message issued to the Window.
//                               and
//             I feel that IF this functionality is built
//                 into the GT itself, what a wonder!


-----Original Message-----
From: harbour-bounces@harbour-project.org
[mailto:harbour-bounces@harbour-project.org] On Behalf Of Pritpal Bedi
Sent: Monday, November 24, 2008 2:46 AM
To: harbour@harbour-project.org
Subject: Re: [Harbour] Error in latest SVN?


Enrico

Download latest SVN. It is fixed.
Only left-over variables issue. I will change my 
compiler settings more strict.

Regards
Pritpal Bedi


-- 
View this message in context:
http://www.nabble.com/Error-in-latest-SVN--tp20652629p20653599.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

_______________________________________________
Harbour mailing list
Harbour@harbour-project.org
http://lists.harbour-project.org/mailman/listinfo/harbour
From druzus at acn.waw.pl  Mon Nov 24 06:34:48 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 24 06:33:18 2008
Subject: [Harbour] 2008-11-24 12:34 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081124113448.GA30764@34-mo7-2.acn.waw.pl>

2008-11-24 12:34 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/include/hberrors.h
  * harbour/source/compiler/hbgenerr.c
    + added new compile time error (file write error)

  * harbour/source/pp/ppcore.c
  * harbour/source/rtl/errorint.c
  * harbour/source/compiler/genhrb.c
  * harbour/source/compiler/genc.c
  * harbour/source/rtl/run.c
  * harbour/source/vm/estack.c
    * pacified warnings - Lorenzo please verify it compiling with C header
      files from Ubuntu.

  * harbour/contrib/xhb/filestat.c
    ! fixed UNICODE compilation

  * harbour/contrib/gtwvg/wvgsink.c
    ! added #define NONAMELESSUNION to fix MinGW compilation

best regards
Przemek
From lorenzo.fiorini at gmail.com  Mon Nov 24 08:58:48 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Nov 24 08:58:52 2008
Subject: [Harbour] 2008-11-24 12:34 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081124113448.GA30764@34-mo7-2.acn.waw.pl>
References: <20081124113448.GA30764@34-mo7-2.acn.waw.pl>
Message-ID: <9257026e0811240558g6e04d4f0n563a91a04971dda0@mail.gmail.com>

On Mon, Nov 24, 2008 at 12:34 PM, Przemyslaw Czerpak <druzus@acn.waw.pl> wrote:

>    * pacified warnings - Lorenzo please verify it compiling with C header
>      files from Ubuntu.

Here is the result:

In file included from ../../hbpp.c:75:
../../ppcore.c: In function 'hb_pp_dumpEnd':
../../ppcore.c:840: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_pragmaNew':
../../ppcore.c:2519: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_tokenGet':
../../ppcore.c:5127: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_tokenToString':
../../ppcore.c:5876: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_dumpEnd':
../../ppcore.c:840: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_pragmaNew':
../../ppcore.c:2519: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_tokenGet':
../../ppcore.c:5127: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../ppcore.c: In function 'hb_pp_tokenToString':
../../ppcore.c:5876: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../errorint.c: In function 'hb_errInternalRaw':
../../errorint.c:110: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../errorint.c:133: warning: ignoring return value of 'fwrite',
declared with attribute warn_unused_result
../../run.c: In function 'HB_FUN___RUN':
../../run.c:64: warning: ignoring return value of 'system', declared
with attribute warn_unused_result
../../trace.c: In function 'HB_FUN_HB_TRACESTRING':
../../trace.c:71: warning: format not a string literal and no format arguments
../../hboutdbg.c: In function 'HB_FUN_HB_OUTDEBUG':
../../hboutdbg.c:207: warning: ignoring return value of 'write',
declared with attribute warn_unused_result
../../hboutdbg.c:208: warning: ignoring return value of 'write',
declared with attribute warn_unused_result

best regards,
Lorenzo
From massimo.belgrano at gmail.com  Mon Nov 24 09:12:28 2008
From: massimo.belgrano at gmail.com (Massimo Belgrano)
Date: Mon Nov 24 09:12:42 2008
Subject: [Harbour] documentation regarding gtwvw for gtwvg
Message-ID: <loom.20081124T141031-443@post.gmane.org>

This documentation regarding gtwvw will be a good base for gtwvg

http://br.geocities.com/angeiras/SourceCode.html

noboody is interested to a conversion?


From mbelgrano at deltain.it  Mon Nov 24 09:48:29 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Mon Nov 24 09:49:36 2008
Subject: [Harbour] Wich library i have missed?
Message-ID: <AFB948164110ED43B5EB849E8DEEF03815F205@SRV02.deltain.net>

wich library i have missed?
Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland
Error: Unresolved external '_hb_xvmLocalSetStr' referenced from G:\CLIP52\LAVORI
\MASSIMO\ARCA\OBJHH\ARCA.OBJ
Error: Unresolved external '_hb_xvmRight' referenced from G:\CLIP52\LAVORI\MASSI
MO\ARCA\OBJHH\ARCA.OBJ
Error: Unresolved external '_hb_xvmMacroPushArg' referenced from G:\CLIP52\LAVOR
I\MASSIMO\ARCA\OBJHH\ARCA.OBJ
Error: Unresolved external '_hb_xvmBaseLine' referenced from G:\CLIP52\LAVORI\MA
SSIMO\ARCA\OBJHH\ARCA.OBJ
Error: Unresolved external '_hb_itemPushStaticString' referenced from G:\CLIP52\
LAVORI\MASSIMO\ARCA\OBJHH\ARCA.OBJ
Error: Unresolved external '_hb_xvmLineOffset' referenced from G:\CLIP52\LAVORI\
MASSIMO\ARCA\OBJHH\ARCALOG.OBJ
Error: Unresolved external '_HB_FUN_GETMSSGLINE' referenced from G:\CLIP52\LAVOR
I\MASSIMO\ARCA\OBJHH\GETSYS_D.OBJ
Error: Unresolved external '_HB_FUN_HBCONSOLELOCK' referenced from G:\CLIP52\LAV
ORI\MASSIMO\ARCA\OBJHH\GETSYS_D.OBJ
Error: Unresolved external '_HB_FUN_HBCONSOLEUNLOCK' referenced from G:\CLIP52\L
AVORI\MASSIMO\ARCA\OBJHH\GETSYS_D.OBJ
Error: Unresolved external '_hb_xvmMacroList' referenced from G:\CLIP52\LAVORI\M
ASSIMO\ARCA\OBJHH\ARCAPREV.OBJ
Error: Unresolved external '_hb_xvmMacroListEnd' referenced from G:\CLIP52\LAVOR
I\MASSIMO\ARCA\OBJHH\ARCAPREV.OBJ
Error: Unresolved external '_hb_xvmArrayPopPlus' referenced from G:\CLIP52\LAVOR
I\MASSIMO\ARCA\OBJHH\ARCAPDF.OBJ
Error: Unresolved external '_HB_FUN_ISDIRECTORY' referenced from G:\CLIP52\LAVOR
I\MASSIMO\ARCA\OBJHH\ARCALOG.OBJ

Massimo Belgrano
?

From rportnoff at spendmap.com  Mon Nov 24 10:10:32 2008
From: rportnoff at spendmap.com (Randy Portnoff)
Date: Mon Nov 24 10:10:42 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <49273315.6030600@dbtopas.lt>
References: <20613862.post@talk.nabble.com> <B0085114372@ms1.3peaks.com>
	<49273315.6030600@dbtopas.lt>
Message-ID: <B0085149365@ms1.3peaks.com>

Hi Mindaugas,

Thanks, but it still returns a LONG.

Regards,
Randy.


At 05:15 PM 11/21/2008, you wrote:
>Hi,
>
>
>>Is there a way to return a DWORD value using HBAPI.H or does this 
>>conversion (ie. from LONG to DWORD) need to be done at the PRG level?
>
>Try
>    hb_retnint( (HB_LONG) dword );
>
>
>Regards,
>Mindaugas
>_______________________________________________
>Harbour mailing list
>Harbour@harbour-project.org
>http://lists.harbour-project.org/mailman/listinfo/harbour


From druzus at acn.waw.pl  Mon Nov 24 10:42:00 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 24 10:40:29 2008
Subject: [Harbour] 2008-11-24 16:41 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081124154200.GA10493@34-mo7-2.acn.waw.pl>

2008-11-24 16:41 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/pp/ppcore.c
  * harbour/source/rtl/run.c
  * harbour/source/rtl/errorint.c
  * harbour/source/rtl/trace.c
  * harbour/contrib/xhb/hboutdbg.c
    * pacified warnings and updated some possibly danger constructions

  * harbour/source/vm/memvars.c
    % improved the performance of __MVRESTORE()
    ; TOFIX: this code has Clipper incompatible extension which may cause
      that incorrect values will be restored - numeric double values with
      0 as default number of decimal places for str() formatting are
      wrongly converted to integers loosing fractional part of number.

best regards
Przemek
From druzus at acn.waw.pl  Mon Nov 24 11:02:09 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Mon Nov 24 11:00:39 2008
Subject: [Harbour] Wich library i have missed?
In-Reply-To: <AFB948164110ED43B5EB849E8DEEF03815F205@SRV02.deltain.net>
References: <AFB948164110ED43B5EB849E8DEEF03815F205@SRV02.deltain.net>
Message-ID: <20081124160209.GA24821@34-mo7-2.acn.waw.pl>

On Mon, 24 Nov 2008, Massimo Belgrano wrote:
> wich library i have missed?

You mixed xHarbour code with Harbour one.

> Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland
> Error: Unresolved external '_hb_xvmLocalSetStr' referenced from G:\CLIP52\LAVORI
> \MASSIMO\ARCA\OBJHH\ARCA.OBJ
> Error: Unresolved external '_hb_xvmRight' referenced from G:\CLIP52\LAVORI\MASSI
> MO\ARCA\OBJHH\ARCA.OBJ
> Error: Unresolved external '_hb_xvmMacroPushArg' referenced from G:\CLIP52\LAVOR
> I\MASSIMO\ARCA\OBJHH\ARCA.OBJ
[...]
These .OBJ files are .prg files compiled by xHarbour.

best regards,
Przemek
From lorenzo.fiorini at gmail.com  Mon Nov 24 15:01:42 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Nov 24 15:01:46 2008
Subject: [Harbour] 2008-11-24 16:41 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <20081124154200.GA10493@34-mo7-2.acn.waw.pl>
References: <20081124154200.GA10493@34-mo7-2.acn.waw.pl>
Message-ID: <9257026e0811241201vf148752k1db49ae6a361a8ee@mail.gmail.com>

On Mon, Nov 24, 2008 at 4:42 PM, Przemyslaw Czerpak <druzus@acn.waw.pl> wrote:

>  * harbour/source/pp/ppcore.c
>  * harbour/source/rtl/run.c
>  * harbour/source/rtl/errorint.c
>  * harbour/source/rtl/trace.c
>  * harbour/contrib/xhb/hboutdbg.c
>    * pacified warnings and updated some possibly danger constructions

Result:

../../hboutdbg.c: In function 'HB_FUN_HB_OUTDEBUG':
../../hboutdbg.c:207: warning: ignoring return value of 'write',
declared with attribute warn_unused_result
../../hboutdbg.c:208: warning: ignoring return value of 'write',
declared with attribute warn_unused_result

best regards,
Lorenzo
From dbtopas at dbtopas.lt  Mon Nov 24 15:00:15 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Nov 24 15:02:16 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <B0085149365@ms1.3peaks.com>
References: <20613862.post@talk.nabble.com>
	<B0085114372@ms1.3peaks.com>	<49273315.6030600@dbtopas.lt>
	<B0085149365@ms1.3peaks.com>
Message-ID: <492B07CF.2060904@dbtopas.lt>

Hi,


then I should ask you, how do you know on prg level, if it is LONG or not?


Regards,
Mindaugas


Randy Portnoff wrote:
> Hi Mindaugas,
> 
> Thanks, but it still returns a LONG.
> 
> Regards,
> Randy.
> 
> 
> At 05:15 PM 11/21/2008, you wrote:
>> Hi,
>>
>>
>>> Is there a way to return a DWORD value using HBAPI.H or does this 
>>> conversion (ie. from LONG to DWORD) need to be done at the PRG level?
>>
>> Try
>>    hb_retnint( (HB_LONG) dword );
>>
>>
>> Regards,
>> Mindaugas
From lorenzo.fiorini at gmail.com  Mon Nov 24 15:08:38 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Mon Nov 24 15:08:42 2008
Subject: [Harbour] 2008-11-24 16:41 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <9257026e0811241201vf148752k1db49ae6a361a8ee@mail.gmail.com>
References: <20081124154200.GA10493@34-mo7-2.acn.waw.pl>
	<9257026e0811241201vf148752k1db49ae6a361a8ee@mail.gmail.com>
Message-ID: <9257026e0811241208y669f039by3c49490b88688468@mail.gmail.com>

On Mon, Nov 24, 2008 at 9:01 PM, Lorenzo Fiorini
<lorenzo.fiorini@gmail.com> wrote:

> Result:
>
> ../../hboutdbg.c: In function 'HB_FUN_HB_OUTDEBUG':
> ../../hboutdbg.c:207: warning: ignoring return value of 'write',
> declared with attribute warn_unused_result
> ../../hboutdbg.c:208: warning: ignoring return value of 'write',
> declared with attribute warn_unused_result

Sorry, I forgot to update my contrib/hblog code ( log functions
extracted from xhb ).

No more warnings now.

best regards,
Lorenzo
From rportnoff at spendmap.com  Mon Nov 24 16:09:53 2008
From: rportnoff at spendmap.com (Randy Portnoff)
Date: Mon Nov 24 16:10:02 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <492B07CF.2060904@dbtopas.lt>
References: <20613862.post@talk.nabble.com> <B0085114372@ms1.3peaks.com>
	<49273315.6030600@dbtopas.lt> <B0085149365@ms1.3peaks.com>
	<492B07CF.2060904@dbtopas.lt>
Message-ID: <B0085158617@ms1.3peaks.com>

This becomes an issue when I am calling DLL functions using 
GetProcAddress/CallDLL - Sometimes, a DLL has a DWORD return value. 
However, since Harbour does not seem to support this, a LONG is 
returned which sometimes can be negative (which is not valid for a 
DWORD). So, I then have to add 2^32 to that value to convert it to a 
DWORD. I thought it would be nice to get this hack out of the PRG 
code by properly supporting DWORD in the HBAPI.


At 03:00 PM 11/24/2008, you wrote:
>Hi,
>
>
>then I should ask you, how do you know on prg level, if it is LONG or not?
>
>
>Regards,
>Mindaugas
>
>
>Randy Portnoff wrote:
>>Hi Mindaugas,
>>Thanks, but it still returns a LONG.
>>Regards,
>>Randy.
>>
>>At 05:15 PM 11/21/2008, you wrote:
>>>Hi,
>>>
>>>
>>>>Is there a way to return a DWORD value using HBAPI.H or does this 
>>>>conversion (ie. from LONG to DWORD) need to be done at the PRG level?
>>>
>>>Try
>>>    hb_retnint( (HB_LONG) dword );
>>>
>>>
>>>Regards,
>>>Mindaugas
>_______________________________________________
>Harbour mailing list
>Harbour@harbour-project.org
>http://lists.harbour-project.org/mailman/listinfo/harbour


From dbtopas at dbtopas.lt  Mon Nov 24 17:21:21 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Mon Nov 24 17:23:22 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <B0085158617@ms1.3peaks.com>
References: <20613862.post@talk.nabble.com>
	<B0085114372@ms1.3peaks.com>	<49273315.6030600@dbtopas.lt>
	<B0085149365@ms1.3peaks.com>	<492B07CF.2060904@dbtopas.lt>
	<B0085158617@ms1.3peaks.com>
Message-ID: <492B28E1.7040401@dbtopas.lt>

Hi,

so, my previous suggestion should work:
---------------------------------
PROC main()
   ? AAA() // prints 4000000000 instead of -294967296
RETURN

#pragma begindump
#include "hbapi.h"
#include "windows.h"  /* define DWORD */

HB_FUNC( AAA )
{
    DWORD    dword = 4000000000; /* more than maximum LONG value */

    hb_retnint( (HB_LONG) dword );
}
#pragma enddump
---------------------------------

Best reagards,
Mindaugas


Randy Portnoff wrote:
> This becomes an issue when I am calling DLL functions using 
> GetProcAddress/CallDLL - Sometimes, a DLL has a DWORD return value. 
> However, since Harbour does not seem to support this, a LONG is returned 
> which sometimes can be negative (which is not valid for a DWORD). So, I 
> then have to add 2^32 to that value to convert it to a DWORD. I thought 
> it would be nice to get this hack out of the PRG code by properly 
> supporting DWORD in the HBAPI.
> 
> 
> At 03:00 PM 11/24/2008, you wrote:
>> Hi,
>>
>>
>> then I should ask you, how do you know on prg level, if it is LONG or 
>> not?
>>
>>
>> Regards,
>> Mindaugas
>>
>>
>> Randy Portnoff wrote:
>>> Hi Mindaugas,
>>> Thanks, but it still returns a LONG.
>>> Regards,
>>> Randy.
>>>
>>> At 05:15 PM 11/21/2008, you wrote:
>>>> Hi,
>>>>
>>>>
>>>>> Is there a way to return a DWORD value using HBAPI.H or does this 
>>>>> conversion (ie. from LONG to DWORD) need to be done at the PRG level?
>>>>
>>>> Try
>>>>    hb_retnint( (HB_LONG) dword );
>>>>
>>>>
>>>> Regards,
>>>> Mindaugas
From bedipritpal at hotmail.com  Tue Nov 25 05:39:18 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Tue Nov 25 05:39:21 2008
Subject: [Harbour] 2008-11-25 02:14 UTC-0800 Pritpal Bedi
	(pritpal@vouchcac.com)
Message-ID: <20678718.post@talk.nabble.com>


2008-11-25 02:14 UTC-0800 Pritpal Bedi (pritpal@vouchcac.com)
  * harbour/contrib/gtwvg/hbgtwvg.ch
  * harbour/contrib/gtwvg/wvtwin.ch
  * harbour/contrib/gtwvg/wvggui.c
  * harbour/contrib/gtwvg/wvgwin.c
  * harbour/contrib/gtwvg/wvgax.prg
  * harbour/contrib/gtwvg/wvgphdlr.prg
  * harbour/contrib/gtwvg/wvgtoolb.prg
  * harbour/contrib/gtwvg/wvgwnd.prg
    + Added WvgToolBar() class demonstrating limited features.

  * harbour/contrib/gtwvg/tests/demowvg.prg
    ! Added WvgToolBar() functionality. Click on ActiveX dialogs and
      see the difference between two two types of buttons. It is just
      limited featured toolbar. Extended version will follow. 

    ;THANKS - Bitmap management code is lifted from GTWVW. 
              Thanks Budyanto for this well written code.
              I examined many implementations but found this piece
              of code satisfying.
                Just tweaked to make UNICODE compliant.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/2008-11-25-02%3A14-UTC-0800-Pritpal-Bedi-%28pritpal%40vouchcac.com%29-tp20678718p20678718.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Tue Nov 25 06:43:55 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Tue Nov 25 06:42:23 2008
Subject: [Harbour] MT and hb_gtInfo() - Appln Locks
In-Reply-To: <20622543.post@talk.nabble.com>
References: <20613862.post@talk.nabble.com>
	<20081121130142.GA23582@34-mo7-2.acn.waw.pl>
	<20622543.post@talk.nabble.com>
Message-ID: <20081125114355.GA12765@34-mo7-2.acn.waw.pl>

On Fri, 21 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> > There is also yet another solution. You can create non HVM thread
> > which will be used to create all windows and process their message
> > queues. It will not make any other jobs so it will be always available
> > and other threads which may call locking windows API function will
> > not have to worry about deadlock because all locks used by window
> > owner thread will be known. This also resolve the problem of
> > automatic window refreshing.
> All other solutions are too much and all GTs must have to be modified
> to respect it.

Any final version will force code which have to be ready for MT mode
so it will have to be written in a little bit different way then for
ST. And I do not talk about Harbour API which may try to make more
friendly (though current code seems to be quite easy to use) but
Windows API which we cannot change and we have to accept suggested MS
solutions. Windows programmer have to carefully read MS documentation
and avoid any constructions which can create dead locks or race conditions.

> Non HVM thread creating windows and managing its message
> loop appears to be the right solution. It will also open some interesting
> possibilities. Can you guide me how this can be done? I will do all efforts
> to materialize it.

To clarify: it does not resolve everything. Just simply code has to be
written in different way. The main problem is accessing GT structures
from window message procedure. It has to be eliminated (for us it means
that we have to forbid resizing internal buffer in current form) or we
still will have to use GT locking and in such case updating existing
code which calls blocking functions to release and then restore GT lock
is a must so it will be good practice to locate all such places and
encapsulate them in UNLOCK/LOCK calls.
Otherwise we have to separate all variables used by GT thread and .prg
thread. It means that we will need our own screen buffer and it will not
be possible to call setmode() method from window procedure. So we will
have to forbid resizing (changing number of rows and calls) by user using
mouse or we will have to introduce some protocol which will allow resizing
when .prg thread will lock the GT to make some operations. In such case
GT window thread will only resize its internal buffer and set information
that GT buffer should be resizsed and it will be done when .prg thread
will access GT locking it. The REFRESH()/REDRAW() methods will copy data
from GT buffer to internal window buffer. This can be safely synchronized
by mutex because it's guarantied that non other locking functions will
be executed what may cause deadlock.
As you can see it's not such trivial operation though also not very
complicated. Please note that the separation and exchanging information
can be more restrictive. So far I said that we may need some protocol
to inform .prg thread about screen resizing. In fact we can exchange
all information using our own protocol and force full separation so
.prg thread will not call even single MS API function. Much more work
but as result we will have structures which can be served also by other
process or even on other computer. So it will be base for remote GT.
How to create it with minimal number of modifications:
1. just before creating first window we should create thread which will
   create it and then will process messages. We can even create an invisible
   window as message queue used to exchange data between .prg thread and the
   window thread but I do not think it will be necessary.
2. we should eliminate all calls to HB_GTSELF*()/HB_GTSUPER*() methods
   from window procedure and functions which are executed by window
   procedure. The same is for all other HVM functions like hb_item*()
   or hb_vm*().
   Later we can add some controlled support but now resizing GT buffer
   will be forbidden.
3. we should add internal buffer for window data used by window thread.
   This buffer will be updated from REFRESH()/REDRAW() methods and after
   updating InvalidateRect() will be executed to force redrawing by window
   thread. In GTWVG this buffer can be screen image. In GTWVT simple
   text buffer will be enough though we can also use screen image.
   If it will be necessary then this buffer can be protected by some
   local mutex. It will be safe if all operation executed when lock is
   set don't not need any other locks. In such case deadlock is impossible.
4. we will have to intorduce our own messages to force some actions executed
   by window thread. At least we will need:
      - create new window
      - close window
      - resize window
      - change font
   They should be blocking and return results like new window handler
   more or less directly (f.e. by setting some GT members).
   We can also add some other messages f.e. for palette modification.
   If possible other messages should be non blocking so we can benefit
   from parallel execution.

   Messages are automatically serialized by Windows so we will not need
   additional synchronization mechanism but we can also introduce it
   if it will help in some operations, f.e. see point 3.
5. we will need variables for cursor shape and position which will be
   updated in REFRESH() method and later used by window thread to
   control caret.
6. Keyboard input buffer is written in a way which allows to use it
   without any locks. There is race condition which can appear when
   buffer is full but it's not more danger then current behavior when
   new keys overwrite the last one what is Clipper compatible so
   READKEY() method can use it as is. We can only eliminate message
   processing which will not be necessary and what will increase the
   performance. Mouse methods we can leave as is.

This seems to be enough though probably some small problems will appear
during implementation but they should be easy to resolve. Eliminating
screen buffer from window procedure resizing greatly simplify the code.

> I do not use hb_gtInfoEx() as it also has sweare implications. About to be
> removed from the sources. You are right that this hack is dangerous.

hb_gtInfoEx() is not danger. The danger is the fact that this function
in current SVN is modified to call GTINFO() method without any GT clocks
so other threads can also access GT in the some time what can cause
internal data corruption.

best regards,
Przemek
From rportnoff at spendmap.com  Tue Nov 25 09:21:56 2008
From: rportnoff at spendmap.com (Randy Portnoff)
Date: Tue Nov 25 09:22:04 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <492B28E1.7040401@dbtopas.lt>
References: <20613862.post@talk.nabble.com> <B0085114372@ms1.3peaks.com>
	<49273315.6030600@dbtopas.lt> <B0085149365@ms1.3peaks.com>
	<492B07CF.2060904@dbtopas.lt> <B0085158617@ms1.3peaks.com>
	<492B28E1.7040401@dbtopas.lt>
Message-ID: <B0085169514@ms1.3peaks.com>

Hi Mindaugas,

Yes, that works - I was casting incorrectly at the C level. However, 
I have to cast as DWORD (not LONG) to get it to work. Here is what I am doing:

LONG lEAX = 0;
...
_asm{mov lEAX, eax}
...
hb_retnint( (DWORD) lEAX );

As you can see, lEAX is set from the call stack via an _asm call - 
When I call hb_retnint(), I have to cast lEAX as a DWORD for it to 
work properly (LONG does not work).

Does this seem correct to you?

TIA.

Regards,
Randy.


At 05:21 PM 11/24/2008, you wrote:
>Hi,
>
>so, my previous suggestion should work:
>---------------------------------
>PROC main()
>   ? AAA() // prints 4000000000 instead of -294967296
>RETURN
>
>#pragma begindump
>#include "hbapi.h"
>#include "windows.h"  /* define DWORD */
>
>HB_FUNC( AAA )
>{
>    DWORD    dword = 4000000000; /* more than maximum LONG value */
>
>    hb_retnint( (HB_LONG) dword );
>}
>#pragma enddump
>---------------------------------
>
>Best reagards,
>Mindaugas
>
>
>Randy Portnoff wrote:
>>This becomes an issue when I am calling DLL functions using 
>>GetProcAddress/CallDLL - Sometimes, a DLL has a DWORD return value. 
>>However, since Harbour does not seem to support this, a LONG is 
>>returned which sometimes can be negative (which is not valid for a 
>>DWORD). So, I then have to add 2^32 to that value to convert it to 
>>a DWORD. I thought it would be nice to get this hack out of the PRG 
>>code by properly supporting DWORD in the HBAPI.
>>
>>At 03:00 PM 11/24/2008, you wrote:
>>>Hi,
>>>
>>>
>>>then I should ask you, how do you know on prg level, if it is LONG or not?
>>>
>>>
>>>Regards,
>>>Mindaugas
>>>
>>>
>>>Randy Portnoff wrote:
>>>>Hi Mindaugas,
>>>>Thanks, but it still returns a LONG.
>>>>Regards,
>>>>Randy.
>>>>
>>>>At 05:15 PM 11/21/2008, you wrote:
>>>>>Hi,
>>>>>
>>>>>
>>>>>>Is there a way to return a DWORD value using HBAPI.H or does 
>>>>>>this conversion (ie. from LONG to DWORD) need to be done at the PRG level?
>>>>>
>>>>>Try
>>>>>    hb_retnint( (HB_LONG) dword );
>>>>>
>>>>>
>>>>>Regards,
>>>>>Mindaugas
>_______________________________________________
>Harbour mailing list
>Harbour@harbour-project.org
>http://lists.harbour-project.org/mailman/listinfo/harbour


From dbtopas at dbtopas.lt  Tue Nov 25 11:00:25 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Tue Nov 25 11:03:06 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <B0085169514@ms1.3peaks.com>
References: <20613862.post@talk.nabble.com>
	<B0085114372@ms1.3peaks.com>	<49273315.6030600@dbtopas.lt>
	<B0085149365@ms1.3peaks.com>	<492B07CF.2060904@dbtopas.lt>
	<B0085158617@ms1.3peaks.com>	<492B28E1.7040401@dbtopas.lt>
	<B0085169514@ms1.3peaks.com>
Message-ID: <492C2119.801@dbtopas.lt>

Hi,


yes, of cause, you should have a DWORD variable
   DWORD lEAX = 0;
   hb_retnint( lEAX );
or cast it to DWORD,
   LONG lEAX = 0;
   hb_retnint( (DWORD) lEAX );
if you want to return DWORD value.

Missing casting
   LONG lEAX = 0;
   hb_retnint( lEAX );
or casting it to LONG
   LONG lEAX = 0;
   hb_retnint( (LONG) lEAX );
will not work.


 > Yes, that works - I was casting incorrectly at the C level. However, I
 > have to cast as DWORD (not LONG) to get it to work.

I've never suggested to cast as LONG. I also guess you do not see 
difference between LONG and HB_LONG. HB_LONG is 64bit signed integer 
(that's why it can store 32bit unsigned number), but LONG is 32bit.

I've used casting as HB_LONG
    hb_retnint( (HB_LONG) dword );
to avoid possible compiler warning for unsigned->signed conversion, but 
it should not be changed to LONG in this case.


Best regards,
Mindaugas


Randy Portnoff wrote:
> Hi Mindaugas,
> 
> Yes, that works - I was casting incorrectly at the C level. However, I 
> have to cast as DWORD (not LONG) to get it to work. Here is what I am 
> doing:
> 
> LONG lEAX = 0;
> ...
> _asm{mov lEAX, eax}
> ...
> hb_retnint( (DWORD) lEAX );
> 
> As you can see, lEAX is set from the call stack via an _asm call - When 
> I call hb_retnint(), I have to cast lEAX as a DWORD for it to work 
> properly (LONG does not work).
> 
> Does this seem correct to you?
> 
> TIA.
> 
> Regards,
> Randy.
From rportnoff at spendmap.com  Tue Nov 25 12:56:08 2008
From: rportnoff at spendmap.com (Randy Portnoff)
Date: Tue Nov 25 12:56:18 2008
Subject: [Harbour] hbapi.h and DWORD values
In-Reply-To: <492C2119.801@dbtopas.lt>
References: <20613862.post@talk.nabble.com> <B0085114372@ms1.3peaks.com>
	<49273315.6030600@dbtopas.lt> <B0085149365@ms1.3peaks.com>
	<492B07CF.2060904@dbtopas.lt> <B0085158617@ms1.3peaks.com>
	<492B28E1.7040401@dbtopas.lt> <B0085169514@ms1.3peaks.com>
	<492C2119.801@dbtopas.lt>
Message-ID: <B0085174525@ms1.3peaks.com>

It's working now with the DWORD cast - Thanks!

At 11:00 AM 11/25/2008, you wrote:
>Hi,
>
>
>yes, of cause, you should have a DWORD variable
>   DWORD lEAX = 0;
>   hb_retnint( lEAX );
>or cast it to DWORD,
>   LONG lEAX = 0;
>   hb_retnint( (DWORD) lEAX );
>if you want to return DWORD value.
>
>Missing casting
>   LONG lEAX = 0;
>   hb_retnint( lEAX );
>or casting it to LONG
>   LONG lEAX = 0;
>   hb_retnint( (LONG) lEAX );
>will not work.
>
>
> > Yes, that works - I was casting incorrectly at the C level. However, I
> > have to cast as DWORD (not LONG) to get it to work.
>
>I've never suggested to cast as LONG. I also guess you do not see 
>difference between LONG and HB_LONG. HB_LONG is 64bit signed integer 
>(that's why it can store 32bit unsigned number), but LONG is 32bit.
>
>I've used casting as HB_LONG
>    hb_retnint( (HB_LONG) dword );
>to avoid possible compiler warning for unsigned->signed conversion, 
>but it should not be changed to LONG in this case.
>
>
>Best regards,
>Mindaugas
>
>
>Randy Portnoff wrote:
>>Hi Mindaugas,
>>Yes, that works - I was casting incorrectly at the C level. 
>>However, I have to cast as DWORD (not LONG) to get it to work. Here 
>>is what I am doing:
>>LONG lEAX = 0;
>>...
>>_asm{mov lEAX, eax}
>>...
>>hb_retnint( (DWORD) lEAX );
>>As you can see, lEAX is set from the call stack via an _asm call - 
>>When I call hb_retnint(), I have to cast lEAX as a DWORD for it to 
>>work properly (LONG does not work).
>>Does this seem correct to you?
>>TIA.
>>Regards,
>>Randy.
>_______________________________________________
>Harbour mailing list
>Harbour@harbour-project.org
>http://lists.harbour-project.org/mailman/listinfo/harbour


From dmacias at mail.udg.mx  Tue Nov 25 23:27:03 2008
From: dmacias at mail.udg.mx (David Arturo Macias Corona)
Date: Tue Nov 25 23:26:47 2008
Subject: [Harbour] Re: OT: with VirtualBox 2.0.6 Harbour Win apps can access
 shared folders files in Linux hosts
In-Reply-To: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
Message-ID: <492CD017.6080704@mail.udg.mx>

 >Since I've mentioned about this problem few weeks ago I'd like to
 >report that now with 2.0.6 it has been fixed.

 >Many thanks Sun.

Lorenzo:

In changelog of VBox 2.0.6 I do not see any change/fix related to the 
problem with shared folders

In the case reported by me some weeks ago (included below), now with 
2.0.6 there are not change, error happen as before

David Macias


I have about six months using Mandriva 2008.1 - VirtualBox - WinXPPSP2,
started with VBox 1.5.6 and now is 2.0.4

All this time I used Samba/shares to access NTFS/FAT32 partitions with
WinXPPSP2 VM and everything work fine with Harbour and disk access

Now I replaced Samba/shares with "Shared Folders" and running same
programs WinXPPSP2 reboot with screen "to protect itself" ( a text
screen with a lot of info about drivers failures, ... and reboot to
protect )

This failure happen using:
   nHandler := FOPEN( cDestino, FO_READWRITE+FO_SHARED )
and NOT using DBF/CDX files

Other program work fine using DBF/CDX files, not tested writing on file

As I can see there are a problem with Shared Folders / Harbour disk access

David Macias


From lorenzo.fiorini at gmail.com  Wed Nov 26 01:40:09 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Nov 26 01:40:16 2008
Subject: [Harbour] Re: OT: with VirtualBox 2.0.6 Harbour Win apps can
	access shared folders files in Linux hosts
In-Reply-To: <492CD017.6080704@mail.udg.mx>
References: <20070330102120.D46851E3795@antivirus2.noc.udg.mx>
	<492CD017.6080704@mail.udg.mx>
Message-ID: <9257026e0811252240r339f44e0rbf4da151291dec2e@mail.gmail.com>

On Wed, Nov 26, 2008 at 5:27 AM, David Arturo Macias Corona
<dmacias@mail.udg.mx> wrote:

> In changelog of VBox 2.0.6 I do not see any change/fix related to the
> problem with shared folders

I couldn't find exactly where the problem was but I'm sure that only
replacing 2.0.4 with 2.0.6 has fixed it.

#include "fileio.ch"

procedure main

   local nHandler := FOPEN( "s:\tmp\salchk.log", FO_READWRITE+FO_SHARED )

   ? nHandler

return

The test above built with Harbour 1.0.1 Intl. (Rev. 9429) created
using msys/mingw 3.4.5 inside a WinXPPro SP3 fully updated where s: is
a shared folders pointing to hosts's /media/sda5 ( Ubuntu 8.10 ) works
as expected.

best regards,
Lorenzo
From david at gesintur.com  Wed Nov 26 06:18:02 2008
From: david at gesintur.com (David MS)
Date: Wed Nov 26 06:18:09 2008
Subject: [Harbour] Sorting Issue
Message-ID: <32B9CDB2C018489DA9F907FC1A4BC34A@INFOR04>

Hi, when I try to do:

? "arbol">"arco"
.F.
? "?rbol">"arco"
.T. <-- I think this is wrong.
At least, if I sort this words in any Spreadsheet the result is:
1.arbol
2.?rbol
3.arco

This happened in ansi, oem or UTF-8 chars

I've Harbour 1.0.0 Intl. (Rev. 9091) in the main function I'm using:
REQUEST dbfcdx,dbffpt
REQUEST HB_Lang_ES
REQUEST HB_CODEPAGE_ESWIN
RddSetDefault("DBFCDX")
HB_LANGSELECT('ES')
HB_SETCODEPAGE("ESWIN")


How could  I solve it?

Best Regards,
David Monta?o. 

From dbtopas at dbtopas.lt  Wed Nov 26 07:20:35 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov 26 07:22:33 2008
Subject: [Harbour] Closing relation
In-Reply-To: <20081122003146.GA1075@34-mo7-2.acn.waw.pl>
References: <49269650.9080503@dbtopas.lt>
	<20081122003146.GA1075@34-mo7-2.acn.waw.pl>
Message-ID: <492D3F13.7060709@dbtopas.lt>

>> is there any way in Harbour/Clipper to close a single relation of workarea?
> 
> No. There are no RDD methods which allows to implement it.
> You can hardcode it without RDD API but it's rather bad idea.
> You can also collect information about active relations, clear
> all and then restore them except the one you want to remove but
> it will work only if all relation expressions can be recompiled
> using their string expressions.


Hi,


thanks. I've solved my problem another way, I just do not open that 
relation. But I was a little surprised that there is no way to close a 
single relation in Clipper.

Perhaps, the only possible way to implement it (without backward 
incompatible RDD extension) is via DBINFO().


Regards,
Mindaugas

From dbtopas at dbtopas.lt  Wed Nov 26 07:54:18 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov 26 07:56:16 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <20081106172214.GA9967@34-mo7-2.acn.waw.pl>
References: <0FA87E30-AE9F-4B43-90F7-995D5E12A30B@syenar.hu>	<20081105155725.GA26428@34-mo7-2.acn.waw.pl>	<3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>	<4912E7C2.6010801@dbtopas.lt>	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>	<491315D1.7030303@dbtopas.lt>	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
	<20081106172214.GA9967@34-mo7-2.acn.waw.pl>
Message-ID: <492D46FA.9010808@dbtopas.lt>

Przemyslaw Czerpak wrote:
>> I think that's not the question, but rather if we want to
>> keep the RTE in hb_HGet() at all.
> 
> Exactly.
> 
>> xhb compatibility is not a concern BTW, because it uses
>> different function names anyway.
> 
> Because you asked to translate most of them. At the beginning
> this implementation was using xHarbour compatible API. Anyhow
> I do not think we have to be strictly compatible with RTE in
> such functions.


Hi,


if you feel that some hash's properties or internals are heritage of 
xHarbour, and it would be better to implement it another way, please do 
it. I'm always for better implementation even with a little cost of 
backward compatibility.
I've changed HB_HGet() to aHash[...] in my code, and have nothing 
against changes related RTE behavior of this function.


One more remainder about i18n. We had a large discussion about i18n 
internals, but that about it's public API? We have __*() functions:
__I18N_SAVE()
__I18N_LOADFROMMEMORY()
__I18N_LOAD()
__I18N_GETTEXT()

xHarbour has:
HB_I18NLOADTABLE()
HB_I18NSORTTABLE()
HB_I18NSAVETABLE()
I18N()
HB_I18NSETPATH()
HB_I18NGETPATH()
HB_I18NSETLANGUAGE()
HB_I18NGETLANGUAGE()
HB_I18NGETLANGUAGENAME()
HB_I18NGETBASELANGUAGE()
HB_I18NGETBASELANGUAGENAME()
HB_I18NSETBASELANGUAGE()
HB_I18NINITIALIZED()

Current __*() prefix makes me understand, it is not the final version. I 
would like to have final implementation of it. What should be the final 
public API for i18n?



Best regards,
Mindaugas

From bruno.luciani at gmail.com  Wed Nov 26 10:50:02 2008
From: bruno.luciani at gmail.com (Bruno Luciani)
Date: Wed Nov 26 10:50:08 2008
Subject: [Harbour] RDDSQL
Message-ID: <133778360811260750l723193dre517357c9a61e9a1@mail.gmail.com>

Victor , wich is the final idea in RDDSQL

only mysql  ?

Thanks

Bruno
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081126/5452badc/attachment.html
From druzus at acn.waw.pl  Wed Nov 26 11:46:51 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 26 11:45:16 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20522880.post@talk.nabble.com>
References: <20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20522880.post@talk.nabble.com>
Message-ID: <20081126164651.GA23840@34-mo7-2.acn.waw.pl>

On Sat, 15 Nov 2008, Abeb wrote:

Hi,

> is WinCe fix already?
> does anybody sucsessfuly run WinCe programs? 

I've just tested current code with PocketPC emulator and
tests/wcecon.prg works.
We should probably thanks to Pritpal for his modifications.

best regards,
Przemek
From druzus at acn.waw.pl  Wed Nov 26 12:22:51 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Wed Nov 26 12:21:16 2008
Subject: [Harbour] 2008-11-26 18:22 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
Message-ID: <20081126172251.GA29143@34-mo7-2.acn.waw.pl>

2008-11-26 18:22 UTC+0100 Przemyslaw Czerpak (druzus/at/priv.onet.pl)
  * harbour/source/vm/itemapi.c
    * changed hb_itemPutNLen() function to create integer item only
      when conversion to HB_LONG does not change value of passed double
      argument. It fixes some problems like restoring non integer double
      values with 0 decimal places by __MVRESTORE()

  * harbour/source/rtl/val.c
    % minor optimization

best regards
Przemek
From lorenzo.fiorini at gmail.com  Wed Nov 26 13:19:46 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Wed Nov 26 13:19:49 2008
Subject: [Harbour] 1.1 status?
Message-ID: <9257026e0811261019m3ad13f0q1259b985d2818da0@mail.gmail.com>

What are the plans for 1.1?

best regards,
Lorenzo
From zen25000 at zen.co.uk  Wed Nov 26 14:01:51 2008
From: zen25000 at zen.co.uk (Barry Jackson)
Date: Wed Nov 26 14:01:54 2008
Subject: [Harbour] Problem building telepathy test program
Message-ID: <20707046.post@talk.nabble.com>


What am I doing wrong? I am trying to build the telepathy test program.
I am using Mandriva Linux 2009.0 and built harbour using
mpkg_rpm_from_svn.sh script.
The make_gcc.sh ran OK in the hbtpathy dir. and
/usr/lib/harbour/libhbtpathy.a exists.
Regular "Hello World" programs compile OK and run without problem.

[baz@jackodesktop hbr]$ hbmk @testtp.txt
Harbour 1.1.0dev (Rev. 9842)
Copyright (c) 1999-2008, http://www.harbour-project.org/
Reading 'testtp.txt'...
Compiling module 'testtp.prg'...
Compiling module 'telepath.prg'...
Lines 1273, Functions/Procedures 34
Generating C source output to 'testtp.c'... Done.
[baz@jackodesktop hbr]$ hbcc testtp.c tplinux.c tpcommon.c
/home/baz/tmp/ccueA9Uh.o:(.data+0x138): undefined reference to
`HB_FUN_THREADSLEEP'
collect2: ld returned 1 exit status

-- 
View this message in context: http://www.nabble.com/Problem-building-telepathy-test-program-tp20707046p20707046.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Wed Nov 26 16:02:16 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov 26 16:02:20 2008
Subject: [Harbour] MT and hb_gtInfo() - Appln Locks
In-Reply-To: <20081125114355.GA12765@34-mo7-2.acn.waw.pl>
References: <20613862.post@talk.nabble.com>
	<20081121130142.GA23582@34-mo7-2.acn.waw.pl>
	<20622543.post@talk.nabble.com>
	<20081125114355.GA12765@34-mo7-2.acn.waw.pl>
Message-ID: <20708951.post@talk.nabble.com>


Przemek


>Windows programmer have to carefully read MS documentation
>and avoid any constructions which can create dead locks or race conditions.

You are right on this issue. Now I understand your whole view point.

What I could conclude from you analysis is that we need to devise some 
mechanism to post an event for relevant GT with some data ( as per the
nature of event ) 
which is taken care by the window procedure itself. I think this will solve
the whole issue.
>From PRG code I should be able to post a simple message as 

hb_gtInfoEx( pGT, HB_GTI_QUOUE, xSomeData ) 

and hb_gtInfoEx() unlocks and locks GT as you described. 
Window procedure retrieves it first-cum-first-server basis and executes 
the command. Thread issueing this command is only responsible
for placing it in the quoue of pGT structure, or even better local GT
structure.
If this scenario is appropriate, then next question is, when will the Window
procedure 
looks into this quoue, to me it could be WM_IDLE.

But above off course is useful where no information is requested, only 
action is defined to be executed.

For any information request we can use hb_mutexSubscribe()/Notify() 
mechanism. But again it will be an issue at what point of thread execution 
mutex request is detected and served back. In fact for both opearions,
1) execution an action 2) request of info can be carried in above fashion.

Recently I read an article on inter-thread communication but have lost track 
where it is. For sure inter-thread communication is better over mutex
approach.
But how it can be achieved, I do not know.

Regards
Pritpal Bedi


-- 
View this message in context: http://www.nabble.com/MT-and-hb_gtInfo%28%29---Appln-Locks-tp20613862p20708951.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Wed Nov 26 17:32:48 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Wed Nov 26 17:32:51 2008
Subject: [Harbour] Error in latest SVN?
In-Reply-To: <4D4BD976CF5C480F9A17DE0D3BA2970E@emag>
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
	<20653599.post@talk.nabble.com>
	<4D4BD976CF5C480F9A17DE0D3BA2970E@emag>
Message-ID: <20710321.post@talk.nabble.com>


Enrico

<<<
Warning W8060 .\wvgsink.c 516: Possibly incorrect assignment in function 
SetupConnectionPoint
Warning W8084 .\wvgsink.c 704: Suggest parentheses to clarify precedence in 
function HB_FUN_HB_AX_ATLAXCREATECONTROL
Warning W8084 .\wvgsink.c 769: Suggest parentheses to clarify precedence in 
function HB_FUN_HB_AX_ATLAXGETCONTROL
>>>

I know about these warnings.

Fist warning I do not how to handle.
Next two warnings : I tried all combinations to parenthise indivisual 
parameters but nothing helped. Synatctically code is correct.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/Error-in-latest-SVN--tp20652629p20710321.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From dbtopas at dbtopas.lt  Wed Nov 26 19:19:40 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Wed Nov 26 19:21:37 2008
Subject: [Harbour] RDDSQL
In-Reply-To: <133778360811260750l723193dre517357c9a61e9a1@mail.gmail.com>
References: <133778360811260750l723193dre517357c9a61e9a1@mail.gmail.com>
Message-ID: <492DE79C.4000707@dbtopas.lt>

Bruno Luciani wrote:
> Victor , wich is the final idea in RDDSQL
> 
> only mysql  ?
> 
> Thanks
> 
> Bruno

Hi,

I hope I can give an answer. The final idea is include more sql DBMS and
include more features (not DMBS specific) in sqlbase/sqlmix, like
iteration of changed records, etc. Currently only MySQL DBMS is
implemented. I have FireBird and PostgreSQL drivers implemented, but I
need to find a little time to change coding style, etc., before upload
to SVN. If you are going to implement some more drivers, I see ODBC
driver the most useful. It will give access to a numerous DBMS.


Best regards,
Mindaugas

From labitas at gmail.com  Thu Nov 27 01:55:16 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Thu Nov 27 01:55:22 2008
Subject: [Harbour] Error in latest SVN?
In-Reply-To: <20710321.post@talk.nabble.com>
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
	<20653599.post@talk.nabble.com>
	<4D4BD976CF5C480F9A17DE0D3BA2970E@emag>
	<20710321.post@talk.nabble.com>
Message-ID: <2386af1b0811262255m6ac12f8cm83d6fa8c528a5abd@mail.gmail.com>

Pritpal,

> <<<
> Warning W8060 .\wvgsink.c 516: Possibly incorrect assignment in function
> SetupConnectionPoint
>>>>

After replacing
   if( !( thisobj = ( IEventHandler * ) GlobalAlloc( GMEM_FIXED,
sizeof( MyRealIEventHandler ) ) ) )
with
   if( ( thisobj = ( IEventHandler * ) GlobalAlloc( GMEM_FIXED,
sizeof( MyRealIEventHandler ) ) ) != NULL )
warning must hide.

Best regards,
Saulius
From labitas at gmail.com  Thu Nov 27 01:58:30 2008
From: labitas at gmail.com (Saulius Zrelskis)
Date: Thu Nov 27 01:58:34 2008
Subject: [Harbour] Error in latest SVN?
In-Reply-To: <2386af1b0811262255m6ac12f8cm83d6fa8c528a5abd@mail.gmail.com>
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
	<20653599.post@talk.nabble.com>
	<4D4BD976CF5C480F9A17DE0D3BA2970E@emag>
	<20710321.post@talk.nabble.com>
	<2386af1b0811262255m6ac12f8cm83d6fa8c528a5abd@mail.gmail.com>
Message-ID: <2386af1b0811262258g5478e0e3k695532daf4d6d7f5@mail.gmail.com>

sorry, with
   if( ( thisobj = ( IEventHandler * ) GlobalAlloc( GMEM_FIXED,
sizeof( MyRealIEventHandler ) ) ) == NULL )

Best regards,
Saulius
From bedipritpal at hotmail.com  Thu Nov 27 03:06:03 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 27 03:06:06 2008
Subject: [Harbour] Error in latest SVN?
In-Reply-To: <2386af1b0811262258g5478e0e3k695532daf4d6d7f5@mail.gmail.com>
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
	<20653599.post@talk.nabble.com>
	<4D4BD976CF5C480F9A17DE0D3BA2970E@emag>
	<20710321.post@talk.nabble.com>
	<2386af1b0811262255m6ac12f8cm83d6fa8c528a5abd@mail.gmail.com>
	<2386af1b0811262258g5478e0e3k695532daf4d6d7f5@mail.gmail.com>
Message-ID: <20714918.post@talk.nabble.com>


Hi


Saulius Zrelskis wrote:
> 
> sorry, with
>    if( ( thisobj = ( IEventHandler * ) GlobalAlloc( GMEM_FIXED,
> sizeof( MyRealIEventHandler ) ) ) == NULL )
> 

thisobj = ( IEventHandler * ) GlobalAlloc( GMEM_FIXED, sizeof(
MyRealIEventHandler ) )
if( thisobj )
{
}

also covers it. Thanks for the solution.

Now the warning with MAKELPARAM() where parenthis are suggested remains.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/Error-in-latest-SVN--tp20652629p20714918.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From e.m.giordano at emagsoftware.it  Thu Nov 27 03:23:08 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Thu Nov 27 03:23:12 2008
Subject: [Harbour] Error in latest SVN?
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag><20653599.post@talk.nabble.com><4D4BD976CF5C480F9A17DE0D3BA2970E@emag>
	<20710321.post@talk.nabble.com>
Message-ID: <5EEE28B979804E66A20943A28DAD8960@emag>


-----Messaggio Originale----- 
Da: "Pritpal Bedi" <bedipritpal@hotmail.com>
A: <harbour@harbour-project.org>
Data invio: mercoled? 26 novembre 2008 23.32
Oggetto: Re: [Harbour] Error in latest SVN?


> I know about these warnings.
>
> Fist warning I do not how to handle.
> Next two warnings : I tried all combinations to parenthise indivisual
> parameters but nothing helped. Synatctically code is correct.

Ok, no problem. Thank you to have looked at them.

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From maurilio.longo at libero.it  Thu Nov 27 05:47:51 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Thu Nov 27 05:47:56 2008
Subject: [Harbour] Problem building telepathy test program
In-Reply-To: <20707046.post@talk.nabble.com>
References: <20707046.post@talk.nabble.com>
Message-ID: <492E7AD7.5050602@libero.it>

Barry,

this is a problem inside hbtpathy which comes from xharbour and uses a
function (threadsleep) not available in harbour.

So this has to be fixed in hbtpathy.

BTW, I wrote it, and it is more of a proof of concept than a finished library
that can be used on production systems.

Best regards.

Maurilio.



Barry Jackson wrote:
> What am I doing wrong? I am trying to build the telepathy test program.
> I am using Mandriva Linux 2009.0 and built harbour using
> mpkg_rpm_from_svn.sh script.
> The make_gcc.sh ran OK in the hbtpathy dir. and
> /usr/lib/harbour/libhbtpathy.a exists.
> Regular "Hello World" programs compile OK and run without problem.
> 
> [baz@jackodesktop hbr]$ hbmk @testtp.txt
> Harbour 1.1.0dev (Rev. 9842)
> Copyright (c) 1999-2008, http://www.harbour-project.org/
> Reading 'testtp.txt'...
> Compiling module 'testtp.prg'...
> Compiling module 'telepath.prg'...
> Lines 1273, Functions/Procedures 34
> Generating C source output to 'testtp.c'... Done.
> [baz@jackodesktop hbr]$ hbcc testtp.c tplinux.c tpcommon.c
> /home/baz/tmp/ccueA9Uh.o:(.data+0x138): undefined reference to
> `HB_FUN_THREADSLEEP'
> collect2: ld returned 1 exit status
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From zen25000 at zen.co.uk  Thu Nov 27 06:27:32 2008
From: zen25000 at zen.co.uk (Barry Jackson)
Date: Thu Nov 27 06:27:35 2008
Subject: [Harbour] Problem building telepathy test program
In-Reply-To: <492E7AD7.5050602@libero.it>
References: <20707046.post@talk.nabble.com> <492E7AD7.5050602@libero.it>
Message-ID: <20717629.post@talk.nabble.com>


Maurilio,
Many thanks for your reply.
OK that's fine- I will work around that function if I need to. The
application I want to write will only be required to open a port and send
character strings - there is no handshake so it should not be a problem.
I just wanted to be sure that I was not the cause of the failure of the test
build! I am new to Linux, but have been playing with Clipper since summer
'87.
Cheers,
Barry

Maurilio Longo wrote:
> 
> Barry,
> 
> this is a problem inside hbtpathy which comes from xharbour and uses a
> function (threadsleep) not available in harbour.
> 
> So this has to be fixed in hbtpathy.
> 
> BTW, I wrote it, and it is more of a proof of concept than a finished
> library
> that can be used on production systems.
> 
> Best regards.
> 
> Maurilio.
> 
> 
> 
> Barry Jackson wrote:
>> What am I doing wrong? I am trying to build the telepathy test program.
>> I am using Mandriva Linux 2009.0 and built harbour using
>> mpkg_rpm_from_svn.sh script.
>> The make_gcc.sh ran OK in the hbtpathy dir. and
>> /usr/lib/harbour/libhbtpathy.a exists.
>> Regular "Hello World" programs compile OK and run without problem.
>> 
>> [baz@jackodesktop hbr]$ hbmk @testtp.txt
>> Harbour 1.1.0dev (Rev. 9842)
>> Copyright (c) 1999-2008, http://www.harbour-project.org/
>> Reading 'testtp.txt'...
>> Compiling module 'testtp.prg'...
>> Compiling module 'telepath.prg'...
>> Lines 1273, Functions/Procedures 34
>> Generating C source output to 'testtp.c'... Done.
>> [baz@jackodesktop hbr]$ hbcc testtp.c tplinux.c tpcommon.c
>> /home/baz/tmp/ccueA9Uh.o:(.data+0x138): undefined reference to
>> `HB_FUN_THREADSLEEP'
>> collect2: ld returned 1 exit status
>> 
> 
> -- 
>  __________
> |  |  | |__| Maurilio Longo
> |_|_|_|____| farmaconsult s.r.l.
> 
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> 

-- 
View this message in context: http://www.nabble.com/Problem-building-telepathy-test-program-tp20707046p20717629.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From maurilio.longo at libero.it  Thu Nov 27 06:30:08 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Thu Nov 27 06:30:14 2008
Subject: [Harbour] Problem building telepathy test program
In-Reply-To: <20717629.post@talk.nabble.com>
References: <20707046.post@talk.nabble.com> <492E7AD7.5050602@libero.it>
	<20717629.post@talk.nabble.com>
Message-ID: <492E84C0.7020806@libero.it>

Barry,

it should be enough for such an use, I was able to talk to a fiscal printer
sending and receiving packets.

I think it's enough to remove that function or, better, use the correct one
for harbour.

Best regards.

Maurilio.

Barry Jackson wrote:
> Maurilio,
> Many thanks for your reply.
> OK that's fine- I will work around that function if I need to. The
> application I want to write will only be required to open a port and send
> character strings - there is no handshake so it should not be a problem.
> I just wanted to be sure that I was not the cause of the failure of the test
> build! I am new to Linux, but have been playing with Clipper since summer
> '87.
> Cheers,
> Barry
> 
> Maurilio Longo wrote:
>> Barry,
>>
>> this is a problem inside hbtpathy which comes from xharbour and uses a
>> function (threadsleep) not available in harbour.
>>
>> So this has to be fixed in hbtpathy.
>>
>> BTW, I wrote it, and it is more of a proof of concept than a finished
>> library
>> that can be used on production systems.
>>
>> Best regards.
>>
>> Maurilio.
>>
>>
>>
>> Barry Jackson wrote:
>>> What am I doing wrong? I am trying to build the telepathy test program.
>>> I am using Mandriva Linux 2009.0 and built harbour using
>>> mpkg_rpm_from_svn.sh script.
>>> The make_gcc.sh ran OK in the hbtpathy dir. and
>>> /usr/lib/harbour/libhbtpathy.a exists.
>>> Regular "Hello World" programs compile OK and run without problem.
>>>
>>> [baz@jackodesktop hbr]$ hbmk @testtp.txt
>>> Harbour 1.1.0dev (Rev. 9842)
>>> Copyright (c) 1999-2008, http://www.harbour-project.org/
>>> Reading 'testtp.txt'...
>>> Compiling module 'testtp.prg'...
>>> Compiling module 'telepath.prg'...
>>> Lines 1273, Functions/Procedures 34
>>> Generating C source output to 'testtp.c'... Done.
>>> [baz@jackodesktop hbr]$ hbcc testtp.c tplinux.c tpcommon.c
>>> /home/baz/tmp/ccueA9Uh.o:(.data+0x138): undefined reference to
>>> `HB_FUN_THREADSLEEP'
>>> collect2: ld returned 1 exit status
>>>
>> -- 
>>  __________
>> |  |  | |__| Maurilio Longo
>> |_|_|_|____| farmaconsult s.r.l.
>>
>> 
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>
>>
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From zen25000 at zen.co.uk  Thu Nov 27 06:46:31 2008
From: zen25000 at zen.co.uk (Barry Jackson)
Date: Thu Nov 27 06:46:34 2008
Subject: [Harbour] Problem building telepathy test program
In-Reply-To: <492E84C0.7020806@libero.it>
References: <20707046.post@talk.nabble.com> <492E7AD7.5050602@libero.it>
	<20717629.post@talk.nabble.com> <492E84C0.7020806@libero.it>
Message-ID: <20717905.post@talk.nabble.com>


That's encouraging - my current version of the program that I want to write
has been in use for years, but I wrote it using Xbase++ and it runs under
Win98. It controls a Digital Video Recorder which is hidden and
inaccessible.
I am trying to change everything to Linux - hence this exercise. 
Cheers,
Barry


Maurilio Longo wrote:
> 
> Barry,
> 
> it should be enough for such an use, I was able to talk to a fiscal
> printer
> sending and receiving packets.
> 
> I think it's enough to remove that function or, better, use the correct
> one
> for harbour.
> 
> Best regards.
> 
> Maurilio.
> 
> Barry Jackson wrote:
>> Maurilio,
>> Many thanks for your reply.
>> OK that's fine- I will work around that function if I need to. The
>> application I want to write will only be required to open a port and send
>> character strings - there is no handshake so it should not be a problem.
>> I just wanted to be sure that I was not the cause of the failure of the
>> test
>> build! I am new to Linux, but have been playing with Clipper since summer
>> '87.
>> Cheers,
>> Barry
>> 
>> Maurilio Longo wrote:
>>> Barry,
>>>
>>> this is a problem inside hbtpathy which comes from xharbour and uses a
>>> function (threadsleep) not available in harbour.
>>>
>>> So this has to be fixed in hbtpathy.
>>>
>>> BTW, I wrote it, and it is more of a proof of concept than a finished
>>> library
>>> that can be used on production systems.
>>>
>>> Best regards.
>>>
>>> Maurilio.
>>>
>>>
>>>
>>> Barry Jackson wrote:
>>>> What am I doing wrong? I am trying to build the telepathy test program.
>>>> I am using Mandriva Linux 2009.0 and built harbour using
>>>> mpkg_rpm_from_svn.sh script.
>>>> The make_gcc.sh ran OK in the hbtpathy dir. and
>>>> /usr/lib/harbour/libhbtpathy.a exists.
>>>> Regular "Hello World" programs compile OK and run without problem.
>>>>
>>>> [baz@jackodesktop hbr]$ hbmk @testtp.txt
>>>> Harbour 1.1.0dev (Rev. 9842)
>>>> Copyright (c) 1999-2008, http://www.harbour-project.org/
>>>> Reading 'testtp.txt'...
>>>> Compiling module 'testtp.prg'...
>>>> Compiling module 'telepath.prg'...
>>>> Lines 1273, Functions/Procedures 34
>>>> Generating C source output to 'testtp.c'... Done.
>>>> [baz@jackodesktop hbr]$ hbcc testtp.c tplinux.c tpcommon.c
>>>> /home/baz/tmp/ccueA9Uh.o:(.data+0x138): undefined reference to
>>>> `HB_FUN_THREADSLEEP'
>>>> collect2: ld returned 1 exit status
>>>>
>>> -- 
>>>  __________
>>> |  |  | |__| Maurilio Longo
>>> |_|_|_|____| farmaconsult s.r.l.
>>>
>>> 
>>> _______________________________________________
>>> Harbour mailing list
>>> Harbour@harbour-project.org
>>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>>
>>>
>> 
> 
> -- 
>  __________
> |  |  | |__| Maurilio Longo
> |_|_|_|____| farmaconsult s.r.l.
> 
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> 

-- 
View this message in context: http://www.nabble.com/Problem-building-telepathy-test-program-tp20707046p20717905.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Thu Nov 27 07:02:48 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 07:01:10 2008
Subject: [Harbour] Error in latest SVN?
In-Reply-To: <20714918.post@talk.nabble.com>
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
	<20653599.post@talk.nabble.com>
	<4D4BD976CF5C480F9A17DE0D3BA2970E@emag>
	<20710321.post@talk.nabble.com>
	<2386af1b0811262255m6ac12f8cm83d6fa8c528a5abd@mail.gmail.com>
	<2386af1b0811262258g5478e0e3k695532daf4d6d7f5@mail.gmail.com>
	<20714918.post@talk.nabble.com>
Message-ID: <20081127120248.GA29535@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> Now the warning with MAKELPARAM() where parenthis are suggested remains.

It's a problem inside BCC header files.
They are full of code which exploits BCC warnings.
In newer BCC the situation is even worse :-(. Old problems
still exists and new one appeared.
To fix it you will have to redefine MAKELONG() macro and add missing
parenthesis compiler asking for:

   #if defined(__BORLANDC__) && !defined(HB_ARCH_64BIT)
      #undef MAKELONG
      #define MAKELONG ((LONG)(((WORD)((DWORD_PTR)(a) & 0xffff)) | \
                        (((DWORD)((WORD)((DWORD_PTR)(b) & 0xffff))) << 16)))
   #endif

best regards,
Przemek
From rodrmigu at gmail.com  Thu Nov 27 08:52:09 2008
From: rodrmigu at gmail.com (Rodrigo Miguel)
Date: Thu Nov 27 08:52:12 2008
Subject: [Harbour] Some ideas about Gtk Call Backs and xhgtk
Message-ID: <80b05d460811270552w30583562n7182cf83a2c76b73@mail.gmail.com>

Hello All,

I'm facing in some rare cases the "Warning, memory allocated but not
released: 1124 bytes (16 block(s))" due to the unfreed allocate HB
ITEM. For some unknown reason, when gtk is terminated abnormally, it
doesn't call the gc closure notify. Here are some examples that I'm
using for:


void xhgtk_signal_destroy(gpointer data)
{
  hb_itemRelease( (PHB_ITEM) data );
}

void Callback( GtkWidget *widget, gpointer data )
{
    PHB_ITEM pWidget;

    pWidget = hb_itemPutPtr( NULL, (GtkWidget *) widget );
    hb_vmEvalBlockV( (PHB_ITEM) data, 1, pWidget );

    hb_itemRelease( pWidget );
}


gulong xhgtk_signal_connect( GConnectFlags connect_flags )
{
    PHB_ITEM pBlock = hb_itemNew(hb_param( 3, HB_IT_BLOCK | HB_IT_BYREF ));
    gulong result = 0L;

        result = g_signal_connect_data
        (
            G_OBJECT( (GtkWidget *)  hb_parptr(1)),
            hb_parcx(2),
            G_CALLBACK(Callback_KeyPressEvent),
            pBlock,
            (GClosureNotify) xhgtk_signal_destroy,
            connect_flags
        );

    return result;
}



So the one million question is. Is there any way on Callback()
function to use the Harbour GC to free up the allocated when it's
completed, then I would not need rely on GTK Closure notify? Any
suggestions?

Thanks in advance
Rodrigo
From bedipritpal at hotmail.com  Thu Nov 27 10:27:28 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 27 10:27:31 2008
Subject: [Harbour] Error in latest SVN?
In-Reply-To: <20081127120248.GA29535@34-mo7-2.acn.waw.pl>
References: <01DF346170ED42BA98E3BEFA7EB5A53F@emag>
	<20653599.post@talk.nabble.com>
	<4D4BD976CF5C480F9A17DE0D3BA2970E@emag>
	<20710321.post@talk.nabble.com>
	<2386af1b0811262255m6ac12f8cm83d6fa8c528a5abd@mail.gmail.com>
	<2386af1b0811262258g5478e0e3k695532daf4d6d7f5@mail.gmail.com>
	<20714918.post@talk.nabble.com>
	<20081127120248.GA29535@34-mo7-2.acn.waw.pl>
Message-ID: <20721015.post@talk.nabble.com>


Przemek


Przemyslaw Czerpak-2 wrote:
> 
>    #if defined(__BORLANDC__) && !defined(HB_ARCH_64BIT)
>       #undef MAKELONG
>       #define MAKELONG ((LONG)(((WORD)((DWORD_PTR)(a) & 0xffff)) | \
>                         (((DWORD)((WORD)((DWORD_PTR)(b) & 0xffff))) <<
> 16)))
>    #endif
> 

It works. Thanks.
Now GTWVG has no warnings and is fully UNICODE compliant.
Viktor, can you check now? I will commit today.

I am wondering if this is placed somewhere in Harbour headers.

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/Error-in-latest-SVN--tp20652629p20721015.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Thu Nov 27 10:53:23 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 10:51:44 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <492D46FA.9010808@dbtopas.lt>
References: <3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>
	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>
	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
	<491315D1.7030303@dbtopas.lt>
	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
	<20081106172214.GA9967@34-mo7-2.acn.waw.pl>
	<492D46FA.9010808@dbtopas.lt>
Message-ID: <20081127155323.GA25089@34-mo7-2.acn.waw.pl>

On Wed, 26 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> One more remainder about i18n. We had a large discussion about i18n 
> internals, but that about it's public API? We have __*() functions:
> __I18N_SAVE()
> __I18N_LOADFROMMEMORY()
> __I18N_LOAD()
> __I18N_GETTEXT()
> xHarbour has:
> HB_I18NLOADTABLE()
> HB_I18NSORTTABLE()
> HB_I18NSAVETABLE()
> I18N()
> HB_I18NSETPATH()
> HB_I18NGETPATH()
> HB_I18NSETLANGUAGE()
> HB_I18NGETLANGUAGE()
> HB_I18NGETLANGUAGENAME()
> HB_I18NGETBASELANGUAGE()
> HB_I18NGETBASELANGUAGENAME()
> HB_I18NSETBASELANGUAGE()
> HB_I18NINITIALIZED()
> Current __*() prefix makes me understand, it is not the final version. I 
> would like to have final implementation of it. What should be the final 
> public API for i18n?

First we should agree final version and resolve some problems.
1. how to keep translation in memory.
   IMHO it should be single serialized item and hash item is very good
   choice because it can be also easy extended to keep additional
   attributes. All translation strings will be indexed by string items
   and all other attributes like information about CP encoding, language
   name will be indexes by numbers. F.e.:
      #define HB_I18N_CPID    1
      #define HB_I18N_DOMAIN  2
      [...]
      hTrans[ HB_I18N_CPID ] := "PLISO"
2. how to keep translation in final binary files.
   hb_itemSerialize() seems to be natural form
3. we should add API to easy create/update trnalsation tables.
   It does not have to be optimized for speed and can be written
   as .prg code so programmers can easy create usr interface for
   translations in their programs. We can also create such program
   as new hbtools, f.e. hbi18n so it can be used externally to
   application.
   To not hardcode internal representation in such programs we will
   need functions to initialize new translation set, add new translation
   item and extract final set as item or string.
4. We should add support for loading directly .pot files and create
   translation table from them.
5. For easy use it's necessary to have in core code function which will
   work like printf(). Otherwise it will be hard to create strings for
   translations which are not context dependent.
   Such function should be in base escape characters like %s or %d
   compatible with C so we can use dedicated tools to operate on .pot
   files. Anyhow for better flexibility we should add support for stringify
   and format any item size. F.e. %s should also work for numeric, date and
   logical items. In general it should be possible to create formatting
   similar to the one given by transform and picture clasue. 
   We can add support for passing picture clase directly in formatted
   string or as parameter. We can also add some additional extensions.
   The function name is less important. We can call it hb_strFormat().
   It's time to implement it.
6. We should decide if we want to add support for plural form translations.
   Now it's not supported by us. In many cases we can live without it but
   sometimes it's useful. It will be important for final translation
   representation though seems that if we will use hashes then it can be
   added later. We can simply add translation for plural forms as additional
   hash item attributes.
7. We should give more precise meaning for domain names in our implementation.
   I think that using it as language ID is quite good idea.
8. The C interface should allow to use different low level implementation
   so if someone will want to use real gettext API then it can register
   his own wrappers.
9. We should add support for automatic CP translations in output strings.
   Otherwise we will end with many different lang modules for different
   encoding like in msg*.c files. There is a question if we also want to
   add translation for input strings but I do not think it's very important.
   We can leave it open for future decissions.
10. We should decide about global settings which will control the translation
    module:
      - default domain/language
      - default path with translation file
    If we want to make them thread local then they should be controlled by
    _SET_* structure. In such case they will be inherited by child threads.

I can implement the base C code when I'll hear your opinion about above
points.
It will be good if you or someone else can work on hb_strFormat() and
hbi18n tool for creating translation.

best regards,
Przemek
From druzus at acn.waw.pl  Thu Nov 27 11:02:24 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 11:00:49 2008
Subject: [Harbour] Closing relation
In-Reply-To: <492D3F13.7060709@dbtopas.lt>
References: <49269650.9080503@dbtopas.lt>
	<20081122003146.GA1075@34-mo7-2.acn.waw.pl>
	<492D3F13.7060709@dbtopas.lt>
Message-ID: <20081127160224.GB25089@34-mo7-2.acn.waw.pl>

On Wed, 26 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> thanks. I've solved my problem another way, I just do not open that 
> relation. But I was a little surprised that there is no way to close a 
> single relation in Clipper.
> Perhaps, the only possible way to implement it (without backward 
> incompatible RDD extension) is via DBINFO().

We can add new method anyhow it will break binary compatibility.
In such case new DBI_* action seems to be the easiest way though
I do not know if it will be portable. F.e. Is it possible to close
single relations in ADS? If not then instead of DBI_* action for
clearing single relation we should add DBI_* action which will return
codeblock associated to given relation so later it will be possible
to write function which will safe and restore all relations. We already
have DBI_SCOPEDRELATION which returns logical value indicating scoped
relations.

best regards,
Przemek
From bedipritpal at hotmail.com  Thu Nov 27 11:24:37 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 27 11:24:41 2008
Subject: [Harbour] C and Unicode compliant string conversions
Message-ID: <20721945.post@talk.nabble.com>


Hello Przemek and all,

Note: I am not from C background so...

The next day I was struggling with this code:

   char szLibName[ MAX_PATH + 1 ] = { 0 };

   GetSystemDirectory( szLibName, MAX_PATH );
   hb_strncat( szLibName, "\\atl.dll", sizeof( szLibName ) - 1 );
   hLib = LoadLibrary( ( LPCSTR ) szLibName );

it works flawless without UNICODE. 

Then for UNICODE I tried various ways to get it working but failed, 
always errors or suspicious pointers warnings appeared.

Then I settled with this code:

      LPTSTR cDll = HB_TCHAR_CONVTO( "atl.dll" );
      hLib = LoadLibrary( cDll );
      HB_TCHAR_FREE( cDll );

It loads the library but I am afraid under circumstances where 'system32' is 
not defined under 'PATH' envvar, it is bound to fail.

My request is some functions where I send two strings, one TCHAR another 
just a text as:

   TCHAR szLibName[ MAX_PATH + 1 ];
   GetSystemDirectory( szLibName, MAX_PATH );
   hb_strncat_ex( szLibName, "\\atl.dll", sizeof( szLibName ) - 1 );  //
imaginary 

I mean a few C level functions which make the string conversion tasks
easier, 
at least for poor C programmers like me.

I can expect those are already there is Harbour...

Regards
Pritpal Bedi



-- 
View this message in context: http://www.nabble.com/C-and-Unicode-compliant-string-conversions-tp20721945p20721945.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Thu Nov 27 11:36:50 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 11:35:11 2008
Subject: [Harbour] Some ideas about Gtk Call Backs and xhgtk
In-Reply-To: <80b05d460811270552w30583562n7182cf83a2c76b73@mail.gmail.com>
References: <80b05d460811270552w30583562n7182cf83a2c76b73@mail.gmail.com>
Message-ID: <20081127163649.GA18786@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Rodrigo Miguel wrote:

Hi Rodrigo,

> I'm facing in some rare cases the "Warning, memory allocated but not
> released: 1124 bytes (16 block(s))" due to the unfreed allocate HB
> ITEM. For some unknown reason, when gtk is terminated abnormally, it
> doesn't call the gc closure notify. Here are some examples that I'm
> using for:
[...]

What does it mean terminated abnormally?
When application crashes? If you have FM log message then it's not
whole application crash or Harbour internal error. I guess it's
RT error. Am I right? Or maybe you are talking about sth different.

> So the one million question is. Is there any way on Callback()
> function to use the Harbour GC to free up the allocated when it's
> completed, then I would not need rely on GTK Closure notify? Any
> suggestions?

The answer is simple. It cannot. It simply does not know anything
about GTK internal structures and how to look for references to
harbour memory blocks in them so it cannot decide if GTK keeps some
pointer to our memory blocks or not.
To make such things it's necessary to use garbage collectors which
are not oriented for some given data types but scan whole application
memory and C call stack (or stacks in MT programs) and check all
references in whole allocated memory. For such collectors it's necessary
to keep strict memory alignment in whole application and all libraries
used by this application. It's forbidden to use any #pragma pack commands
in all source code used to compiled the application or store pointers
in memory which is not well aligned or keep only modified pointers without
direct referencing. It's also necessary to set NULL for all freed memory
pointers which are not longer used and can be accessed be references from
static variables.
Such collectors exists for some platforms but as you can see they can be
used only in very limited situations when whole code also system and 3-rd
party libraries is designed to safely work with them. It means that they
cannot be used by us. They are usually not as good as people think in real
multiprocess environment and applications which use them consumes much more
memory often activating swap when you run more then one such application
simultaneously killing overall performance. And the worst thing is that
it's not possible to detect any memory leaks caused by pointers which are
not NULLed when they are not longer necessary. Just simply people are happy
that memory leaks are not reported.

Returning to your problem with GTK. When exactly the problem appears?
After RT error? Is it GTK bug or it's necessary to close Harbour
application without closing GTK. If you say sth more maybe I can help.

best regards,
Przemek
From rodrmigu at gmail.com  Thu Nov 27 12:23:52 2008
From: rodrmigu at gmail.com (Rodrigo Miguel)
Date: Thu Nov 27 12:23:56 2008
Subject: [Harbour] Some ideas about Gtk Call Backs and xhgtk
Message-ID: <80b05d460811270923u3925d91dn40d2cf3d39806a37@mail.gmail.com>

Hi Przemek,

> Returning to your problem with GTK. When exactly the problem appears?
> After RT error? Is it GTK bug or it's necessary to close Harbour
> application without closing GTK. If you say sth more maybe I can help.

I think that's not related to harbour, because harbour close the
application gracefully. The issue happens with Gtk itself, when some
invalid pointer is handled or some unknown condition, I couldn't
identify that condition, it just abort the gtk app, so it means that
it exits the gtk main loop, without call the previous GCNotifyClosure
ones.

One case that I've here is related to the gtk_operation_new(). It's
for all signed callbacks to call the function on
g_signal_connect_data(), but specific to this function. I don't know
why, but I'm working with some gtk people to see if is some sort of
gtk bug or not.

Thanks anyway, I'm just wondering some way to use a better approach
regarding the gtk callbacks and harbour, instead of rely on
GCNotifyClosure do free up the items allocated by hb_itemNew(). Maybe
create a stack list and then clean up those that weren't freed
properly, etc...

Thanks
Rodrigo
From druzus at acn.waw.pl  Thu Nov 27 12:27:47 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 12:26:12 2008
Subject: [Harbour] C and Unicode compliant string conversions
In-Reply-To: <20721945.post@talk.nabble.com>
References: <20721945.post@talk.nabble.com>
Message-ID: <20081127172747.GA12009@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> The next day I was struggling with this code:
>    char szLibName[ MAX_PATH + 1 ] = { 0 };
>    GetSystemDirectory( szLibName, MAX_PATH );
>    hb_strncat( szLibName, "\\atl.dll", sizeof( szLibName ) - 1 );
>    hLib = LoadLibrary( ( LPCSTR ) szLibName );
> it works flawless without UNICODE. 

Yes because it operates on char types. If you want to write the above
code which will work with and without UNICODE macro then you should
change it to use TCHAR.
TCHAR is single bute char when UNICODE macro is not set and two bytes
(USHORT) when it's set. Pointer to TCHAR (TCHAR*) is defined as LPTSTR.
LPCTSTR is pointer to const TCHAR array.
The following code may look like:

   TCHAR szLibName[ MAX_PATH + 1 ] = { 0 };

   /* please always check if given function need size in TCHARs or bytes
    * in MS documentation.
    */
   GetSystemDirectory( szLibName, MAX_PATH );

   /* TEXT() macro can be used for literal (and only for literal) string
    * values. It creates array of TCHAR items with given text. It cannot
    * be used to ecapsulate non literal values. In different [x]Harbour
    * source code you may find things like TEXT( hb_parc( 1 ) ) - it's
    * a technical nonsense written by someone who has no idea what this
    * macro does.
    * Use new string functions (StringCchCat() in this case) which always
    * set trailing 0 in the given buffer just like hb_strn*() functions.
    * [l]str[n]cat() is absolute and should not be used by new code. It does
    * not guarantee buffer overflow protection and/or setting trailing 0.
    * StringCch*() functions operate on TCHAR types.
    */
    StringCchCat( szLibName, TEXT( "\\atl.dll" ), MAX_PATH + 1 );

    /* Please note that I intentionally removed any casting when szLibName
     * is passed to WinAPI functions. Such casting can pacify warnings so
     * program will be compiled but code will be still wrong so it does not
     * fix anything and only makes much harder later fixing when someone
     * will look for wrong code which is not UNICODE ready. The wrong casting
     * related to different character representations used only to pacify
     * warnings is the biggest problem in MS-Win 3-rd party code written
     * for [x]Harbour because it only hides bugs and then people have to
     * look for the code line by line to fix it. I dedicated above note to
     * developers of few well known MS-Win GUI projects for [x]Harbour.
     * Please remember about it.
     */
    hLib = LoadLibrary( szLibName );

> Then for UNICODE I tried various ways to get it working but failed, 
> always errors or suspicious pointers warnings appeared.

Yes, Just simply it was not code which can be compiled with UNICDE macro.

> Then I settled with this code:
>       LPTSTR cDll = HB_TCHAR_CONVTO( "atl.dll" );
>       hLib = LoadLibrary( cDll );
>       HB_TCHAR_FREE( cDll );
> It loads the library but I am afraid under circumstances where 'system32' is 
> not defined under 'PATH' envvar, it is bound to fail.

The simpler varsion of the above is:
   hLib = LoadLibrary( TEXT( "atl.dll" ) );

I also think that you should read MSDN documentation for LoadLibrary()
and SetDLLDirectory(). GetSystemDirectory() is one of default search PATH
with higher priority then PATH.

> My request is some functions where I send two strings, one TCHAR another 
> just a text as:
>    TCHAR szLibName[ MAX_PATH + 1 ];
>    GetSystemDirectory( szLibName, MAX_PATH );
>    hb_strncat_ex( szLibName, "\\atl.dll", sizeof( szLibName ) - 1 );  //
> imaginary 
> I mean a few C level functions which make the string conversion tasks
> easier, at least for poor C programmers like me.
> I can expect those are already there is Harbour...

See above in the 1-st example. You have everything in Windows API.
Harbour only helps in basic conversion between Harbour and parameters
and MS-Windows ones.

best regards,
Przemek
From druzus at acn.waw.pl  Thu Nov 27 13:03:33 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 13:01:54 2008
Subject: [Harbour] Some ideas about Gtk Call Backs and xhgtk
In-Reply-To: <80b05d460811270923u3925d91dn40d2cf3d39806a37@mail.gmail.com>
References: <80b05d460811270923u3925d91dn40d2cf3d39806a37@mail.gmail.com>
Message-ID: <20081127180333.GA12286@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Rodrigo Miguel wrote:

Hi Rodrigo,

> I think that's not related to harbour, because harbour close the
> application gracefully. The issue happens with Gtk itself, when some
> invalid pointer is handled or some unknown condition, I couldn't
> identify that condition, it just abort the gtk app, so it means that
> it exits the gtk main loop, without call the previous GCNotifyClosure
> ones.

This can be caused by some wrongly passed parameters from Harbour/xhgtk
library.
I do not know GTK internals well enough to help here but I can give
you some advice.
1-st I suggest to clean xhgtk code to eliminate all GTK_ASSERT()
warninf messages. In SUSE Linux GTK is compiled with them so they
can be easy seen on stderr when you run some application from console
window. F.e. gdouble vales seems to not be initialized. In x86 machines
it's usually ignored but with some other CPUs and maybe with the newer
x86 based one it will not be ignored (validating floating point number
costs so it's often removed from CPU/FPU logic) and you will have SIGFPE.
The xhgtk was written where there was no support for GC collectible
pointer items. Now they exists so it will be good to use them to verify
if given item passed from .prg code it's exactly the one which is expected
and generate RT error if not. Otherwise user mistake in .prg code can cause
that wrong pointer will be passed to internall GTK structures what finally
can cause global memory corruption and GTK or HVM crash. In such case it's
very hard to locate the real reason because problem can be exploited in
different place then was created. To locate it it's necessary to validate
whole application code. For me it's enough reason to use GC pointer items
always when possible and strict pointer value is necessary.
Otherwise most of user will be only able to say that sth crashes.

> One case that I've here is related to the gtk_operation_new(). It's
> for all signed callbacks to call the function on
> g_signal_connect_data(), but specific to this function. I don't know
> why, but I'm working with some gtk people to see if is some sort of
> gtk bug or not.

For sure they know much much better GTK internals and can help much
more here.

> Thanks anyway, I'm just wondering some way to use a better approach
> regarding the gtk callbacks and harbour, instead of rely on
> GCNotifyClosure do free up the items allocated by hb_itemNew(). Maybe
> create a stack list and then clean up those that weren't freed
> properly, etc...

It's not a solution but rather workaround to hide the problem.
Additionally as long as you will not know what is wrong then
with such tricks you can make situation even worse. F.e. it's
possible that GTK does not execute destructor because some objects
are still accessible. You will not know when you can safely free
the object. If you will force it then you can discover some other
unpredictable results when sth will activate your callback passing
the pointer to memory you freed and it will corrupt sth different.
In such case is better to lost some memory then cause unpredictable
application crash.
Personally I'm finding the GTK API which allows to attach any user
pointers and define destructors as very well done and easy to use.
The only one problem I see is missing build-in MT protection so it's
necessary to serialize GTK calls bu user.
The question is why it does not work as expected in your case and what
is the real source of problem. Without locating it you will never be
sure what is wrong and when it can be exploited again in the future.

best regards,
Przemek
From bedipritpal at hotmail.com  Thu Nov 27 13:18:22 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 27 13:18:33 2008
Subject: [Harbour] C and Unicode compliant string conversions
In-Reply-To: <20081127172747.GA12009@34-mo7-2.acn.waw.pl>
References: <20721945.post@talk.nabble.com>
	<20081127172747.GA12009@34-mo7-2.acn.waw.pl>
Message-ID: <20723649.post@talk.nabble.com>


Hello Przemek


Przemyslaw Czerpak-2 wrote:
> 
> Yes because it operates on char types. If you want to write the above
> code which will work with and without UNICODE macro then you should
> change it to use TCHAR.
> TCHAR is single bute char when UNICODE macro is not set and two bytes
> (USHORT) when it's set. Pointer to TCHAR (TCHAR*) is defined as LPTSTR.
> LPCTSTR is pointer to const TCHAR array.
> The following code may look like:
> 

Thanks for the detailed analysis and solution.

Now the showstopper: MSDN defines header and lib for the fiunction
StringCchCat()

strsafe.h  and strsafe.lib

which is not available with BCC5.8.

What should I do?

Regards
Pritpal Bedi



-- 
View this message in context: http://www.nabble.com/C-and-Unicode-compliant-string-conversions-tp20721945p20723649.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From rodrmigu at gmail.com  Thu Nov 27 13:41:14 2008
From: rodrmigu at gmail.com (Rodrigo Miguel)
Date: Thu Nov 27 13:41:17 2008
Subject: [Harbour] Some ideas about Gtk Call Backs and xhgtk
In-Reply-To: <20081127180333.GA12286@34-mo7-2.acn.waw.pl>
References: <80b05d460811270923u3925d91dn40d2cf3d39806a37@mail.gmail.com>
	<20081127180333.GA12286@34-mo7-2.acn.waw.pl>
Message-ID: <80b05d460811271041y5931a000ob3649541f014ee15@mail.gmail.com>

Hi Przemek,

Sure, I'll talk with other xhgtk developers and do a task force to
validate all parameters being passed and return the appropriate RT
Error.

By the way, I found the issue with g_signal_connect_data &
gtk_opertaion... I need do a g_object_unref once I get done the
printing.

Thanks
Rodrigo,
From druzus at acn.waw.pl  Thu Nov 27 13:51:44 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 13:50:06 2008
Subject: [Harbour] C and Unicode compliant string conversions
In-Reply-To: <20723649.post@talk.nabble.com>
References: <20721945.post@talk.nabble.com>
	<20081127172747.GA12009@34-mo7-2.acn.waw.pl>
	<20723649.post@talk.nabble.com>
Message-ID: <20081127185144.GA22760@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> Now the showstopper: MSDN defines header and lib for the fiunction
> StringCchCat()
> strsafe.h  and strsafe.lib
> which is not available with BCC5.8.
> What should I do?

Create it yourself or define your own function or macro with such
functionality. F.e.:


   #if !defined( StringCchCat )
      #ifdef UNICODE
         #define StringCchCat(d,n,s)   hb_wcnCpy( (d), (s), (n) - 1 )
      #else
         #define StringCchCat(d,n,s)   hb_strnCpy( (d), (s), (n) - 1 )
      #endif
   #endif


   wchar_t *hb_wcnCpy( wchar_t dstW, const wchar_t *srcW, unsigned long ulLen )
   {
      ULONG ulDst, ulSrc;

      dstW[ ulLen ] = 0;
      ulDst = lstrlenW( dstW );
      if( ulDst < ulLen )
      {
         ulSrc = lstrlenW( srcW );
         if( ulDst + ulSrc > ulLen )
            ulSrc = ulDst - ulDst;
         memcpy( &dstW[ ulDst ], srcW, ulSrc * sizeof( wchar_t ) );
         dstW[ ulDst + ulSrc ] = 0;
      }
      return dstW;
   }

Fix my possible typos (just written by finger, not tested at all)
add above macro definitions to include/hbwince.h with extern declaration for
hb_wcnCpy() function and then add hb_wcnCpy() body to source/common/hbwince.c

best regards,
Przemek
From druzus at acn.waw.pl  Thu Nov 27 13:58:53 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 13:57:15 2008
Subject: [Harbour] C and Unicode compliant string conversions
In-Reply-To: <20081127185144.GA22760@34-mo7-2.acn.waw.pl>
References: <20721945.post@talk.nabble.com>
	<20081127172747.GA12009@34-mo7-2.acn.waw.pl>
	<20723649.post@talk.nabble.com>
	<20081127185144.GA22760@34-mo7-2.acn.waw.pl>
Message-ID: <20081127185853.GA12171@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Przemyslaw Czerpak wrote:
>       {
>          ulSrc = lstrlenW( srcW );
>          if( ulDst + ulSrc > ulLen )
>             ulSrc = ulDst - ulDst;

Ups. It should be:
              ulSrc = ulLen - ulDst;

best regards,
Przemek
From druzus at acn.waw.pl  Thu Nov 27 14:13:13 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 14:11:35 2008
Subject: [Harbour] Some ideas about Gtk Call Backs and xhgtk
In-Reply-To: <80b05d460811271041y5931a000ob3649541f014ee15@mail.gmail.com>
References: <80b05d460811270923u3925d91dn40d2cf3d39806a37@mail.gmail.com>
	<20081127180333.GA12286@34-mo7-2.acn.waw.pl>
	<80b05d460811271041y5931a000ob3649541f014ee15@mail.gmail.com>
Message-ID: <20081127191313.GA17989@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Rodrigo Miguel wrote:

Hi Rodrigo,

> Sure, I'll talk with other xhgtk developers and do a task force to
> validate all parameters being passed and return the appropriate RT
> Error.

If you will have any questions about Harbour internals then I'll try
to help. I do not think I have enough knowledge about GTK to help, for
sure you know about it much more.
GC collectible pointer items have yet another feature.
You can associate destructor with them. So when variable
which holds it will be out of scope or cleared then GTK resources
will be automatically freed. Please also consider that it may force
using g_object_*ref() to play fairly with GTK internals. Where is
should be used and how it's a decision for someone who well knows
GTK and xhgtk.

> By the way, I found the issue with g_signal_connect_data &
> gtk_opertaion... I need do a g_object_unref once I get done the
> printing.

Good news. I do not know the details but it's possible that with
automatic destructors it will not be necessary. It depends on context.
If it's possible it's good to hide such functions from .prg interface:
one possible resource leak less.

best regards,
Przemek
From abe.buch at att.net  Thu Nov 27 14:34:51 2008
From: abe.buch at att.net (Abeb)
Date: Thu Nov 27 14:34:55 2008
Subject: [Harbour] Problem building telepathy test program
In-Reply-To: <20707046.post@talk.nabble.com>
References: <20707046.post@talk.nabble.com>
Message-ID: <20724587.post@talk.nabble.com>


I did some modifications & bug fixes to this lib. mainly it checks if there
is data in the buffer with the empty() function, which will return true even
the is white space data in the buffer.

i wish i can upload back my modifications.



Barry Jackson wrote:
> 
> What am I doing wrong? I am trying to build the telepathy test program.
> I am using Mandriva Linux 2009.0 and built harbour using
> mpkg_rpm_from_svn.sh script.
> The make_gcc.sh ran OK in the hbtpathy dir. and
> /usr/lib/harbour/libhbtpathy.a exists.
> Regular "Hello World" programs compile OK and run without problem.
> 
> [baz@jackodesktop hbr]$ hbmk @testtp.txt
> Harbour 1.1.0dev (Rev. 9842)
> Copyright (c) 1999-2008, http://www.harbour-project.org/
> Reading 'testtp.txt'...
> Compiling module 'testtp.prg'...
> Compiling module 'telepath.prg'...
> Lines 1273, Functions/Procedures 34
> Generating C source output to 'testtp.c'... Done.
> [baz@jackodesktop hbr]$ hbcc testtp.c tplinux.c tpcommon.c
> /home/baz/tmp/ccueA9Uh.o:(.data+0x138): undefined reference to
> `HB_FUN_THREADSLEEP'
> collect2: ld returned 1 exit status
> 
> 

-- 
View this message in context: http://www.nabble.com/Problem-building-telepathy-test-program-tp20707046p20724587.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From abe.buch at att.net  Thu Nov 27 14:36:42 2008
From: abe.buch at att.net (Abeb)
Date: Thu Nov 27 14:36:46 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20081126164651.GA23840@34-mo7-2.acn.waw.pl>
References: <20236568.post@talk.nabble.com>
	<20081029221836.GA20510@34-mo7-2.acn.waw.pl>
	<20251189.post@talk.nabble.com>
	<20081031014729.GB24870@34-mo7-2.acn.waw.pl>
	<20259457.post@talk.nabble.com>
	<20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20522880.post@talk.nabble.com>
	<20081126164651.GA23840@34-mo7-2.acn.waw.pl>
Message-ID: <20724616.post@talk.nabble.com>


Yep it works now.

>We should probably thanks to Pritpal for his modifications. 
not probably, but for sure, and the same goes to you,Przemyslaw.
Thanks



Przemyslaw Czerpak-2 wrote:
> 
> On Sat, 15 Nov 2008, Abeb wrote:
> 
> Hi,
> 
>> is WinCe fix already?
>> does anybody sucsessfuly run WinCe programs? 
> 
> I've just tested current code with PocketPC emulator and
> tests/wcecon.prg works.
> We should probably thanks to Pritpal for his modifications.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> 

-- 
View this message in context: http://www.nabble.com/wince-tp20236568p20724616.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Thu Nov 27 15:21:39 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 27 15:21:43 2008
Subject: [Harbour] C and Unicode compliant string conversions
In-Reply-To: <20081127185144.GA22760@34-mo7-2.acn.waw.pl>
References: <20721945.post@talk.nabble.com>
	<20081127172747.GA12009@34-mo7-2.acn.waw.pl>
	<20723649.post@talk.nabble.com>
	<20081127185144.GA22760@34-mo7-2.acn.waw.pl>
Message-ID: <20724830.post@talk.nabble.com>


Hi Przemek



Przemyslaw Czerpak-2 wrote:
> 
>    #if !defined( StringCchCat )
>       #ifdef UNICODE
>          #define StringCchCat(d,n,s)   hb_wcnCpy( (d), (s), (n) - 1 )
>       #else
>          #define StringCchCat(d,n,s)   hb_strnCpy( (d), (s), (n) - 1 )
>       #endif
>    #endif
> 

To test everything I did as:

#if !defined( StringCchCat )
   #ifdef UNICODE
      #define StringCchCat(d,n,s)   hb_wcncpy( (d), (s), (n) - 1 )
   #else
      #define StringCchCat(d,n,s)   hb_xstrncpy( (d), (s), (n) - 1 )
   #endif
#endif

//  Copied from harbour/source/rtl/hbstr.c and renamed.

/*
 * This function copies szText to destination buffer.
 * NOTE: Unlike the documentation for strncpy, this routine will always
append
 *       a null
 */
char * hb_xstrncpy( char * pDest, const char * pSource, ULONG ulLen )
{
   char *pBuf = pDest;

   pDest[ ulLen ] ='\0';

   while( ulLen && ( *pDest++ = *pSource++ ) != '\0' )
      ulLen--;

   while( ulLen-- )
      *pDest++ = '\0';

   return pBuf;
}


wchar_t *hb_wcncpy( wchar_t *dstW, const wchar_t *srcW, unsigned long ulLen
)
{
   ULONG ulDst, ulSrc;

   dstW[ ulLen ] = 0;
   ulDst = lstrlenW( dstW );
   if( ulDst < ulLen )
   {
      ulSrc = lstrlenW( srcW );
      if( ulDst + ulSrc > ulLen )
         ulSrc = ulLen - ulDst;
      memcpy( &dstW[ ulDst ], srcW, ulSrc * sizeof( wchar_t ) );
      dstW[ ulDst + ulSrc ] = 0;
   }
   return dstW;
}


Then test performed on :

      TCHAR szLibName[ MAX_PATH + 1 ] = { 0 };

      GetSystemDirectory( szLibName, MAX_PATH );

      StringCchCat( szLibName, MAX_PATH + 1, TEXT( "\\atl.dll" ) );

      hLib = LoadLibrary( szLibName );

UNICODE compile is perfect. No errors.

Normal compile GPF's. How do I detect what is wrong? 

Regards

-- 
View this message in context: http://www.nabble.com/C-and-Unicode-compliant-string-conversions-tp20721945p20724830.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bedipritpal at hotmail.com  Thu Nov 27 16:53:45 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 27 16:53:48 2008
Subject: [Harbour] C and Unicode compliant string conversions
In-Reply-To: <20724830.post@talk.nabble.com>
References: <20721945.post@talk.nabble.com>
	<20081127172747.GA12009@34-mo7-2.acn.waw.pl>
	<20723649.post@talk.nabble.com>
	<20081127185144.GA22760@34-mo7-2.acn.waw.pl>
	<20724830.post@talk.nabble.com>
Message-ID: <20726059.post@talk.nabble.com>


Hello


Pritpal Bedi wrote:
> 
> char * hb_xstrncpy( char * pDest, const char * pSource, ULONG ulLen )
> {
>    char *pBuf = pDest;
> 
>    pDest[ ulLen ] ='\0';
> 
>    while( ulLen && ( *pDest++ = *pSource++ ) != '\0' )
>       ulLen--;
> 
>    while( ulLen-- )
>       *pDest++ = '\0';
> 
>    return pBuf;
> }
> 

And this works:

char * hb_xstrncpy( char * pDest, const char * pSource, ULONG ulLen )
{
   char *pBuf = pDest;
   ULONG ulDst, ulSrc;

   pBuf[ ulLen ] ='\0';

   ulDst = strlen( pDest );

   if( ulDst < ulLen )
   {
      ulSrc = strlen( pSource );
      if( ulDst + ulSrc > ulLen )
         ulSrc = ulLen - ulDst;

      memcpy( &pDest[ ulDst ], pSource, ulSrc );
      pDest[ ulDst + ulSrc ] = 0;
   }
   return pDest;
}


I am wondering nobody used hb_strncpy() as before.

Should I commit ?

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/C-and-Unicode-compliant-string-conversions-tp20721945p20726059.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Thu Nov 27 16:57:20 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 16:55:42 2008
Subject: [Harbour] C and Unicode compliant string conversions
In-Reply-To: <20724830.post@talk.nabble.com>
References: <20721945.post@talk.nabble.com>
	<20081127172747.GA12009@34-mo7-2.acn.waw.pl>
	<20723649.post@talk.nabble.com>
	<20081127185144.GA22760@34-mo7-2.acn.waw.pl>
	<20724830.post@talk.nabble.com>
Message-ID: <20081127215720.GA21947@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Pritpal Bedi wrote:

Hi Pritpal,

> >    #if !defined( StringCchCat )
> >       #ifdef UNICODE
> >          #define StringCchCat(d,n,s)   hb_wcnCpy( (d), (s), (n) - 1 )
> >       #else
> >          #define StringCchCat(d,n,s)   hb_strnCpy( (d), (s), (n) - 1 )
                                           ^^^^^^^^^^
> >       #endif
> >    #endif
> > 
> #if !defined( StringCchCat )
>    #ifdef UNICODE
>       #define StringCchCat(d,n,s)   hb_wcncpy( (d), (s), (n) - 1 )
>    #else
>       #define StringCchCat(d,n,s)   hb_xstrncpy( (d), (s), (n) - 1 )
                                      ^^^^^^^^^^^
>    #endif
> #endif

It should be hb_strncat().
Please also change new function name hb_wcnCpy() to hb_wcnCat()
Sorry for confustion - my typo.

> //  Copied from harbour/source/rtl/hbstr.c and renamed.
> char * hb_xstrncpy( char * pDest, const char * pSource, ULONG ulLen )

It's not necessary. hb_strncat() exists in Harbour.

best regards,
Przemek
From bedipritpal at hotmail.com  Thu Nov 27 16:57:26 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Thu Nov 27 16:57:29 2008
Subject: [Harbour] C and Unicode compliant string conversions
In-Reply-To: <20726059.post@talk.nabble.com>
References: <20721945.post@talk.nabble.com>
	<20081127172747.GA12009@34-mo7-2.acn.waw.pl>
	<20723649.post@talk.nabble.com>
	<20081127185144.GA22760@34-mo7-2.acn.waw.pl>
	<20724830.post@talk.nabble.com> <20726059.post@talk.nabble.com>
Message-ID: <20726099.post@talk.nabble.com>


Still better

char * hb_xstrncpy( char * pDest, const char * pSource, ULONG ulLen )
{
   ULONG ulDst, ulSrc;

   pDest[ ulLen ] = 0;
   ulDst = strlen( pDest );
   if( ulDst < ulLen )
   {
      ulSrc = strlen( pSource );
      if( ulDst + ulSrc > ulLen )
         ulSrc = ulLen - ulDst;

      memcpy( &pDest[ ulDst ], pSource, ulSrc );
      pDest[ ulDst + ulSrc ] = 0;
   }
   return pDest;
}

Regards
Pritpal Bedi

-- 
View this message in context: http://www.nabble.com/C-and-Unicode-compliant-string-conversions-tp20721945p20726099.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From bruno.luciani at gmail.com  Thu Nov 27 18:55:40 2008
From: bruno.luciani at gmail.com (Bruno Luciani)
Date: Thu Nov 27 18:55:43 2008
Subject: [Harbour] re:SQLRDD
Message-ID: <133778360811271555u526b887dp7b3ac7a7857e4bb7@mail.gmail.com>

Hi Mindaugas , I realy looking for 2 things
in the first place an rdd for postgres may be interesting

But I am looking too for a class that simplifies and unify
the use of sql databases.

Like Python DB-API, I don 't know if anything like this exist in harbour

I think Xharbour have a comercial version or I am wrong ?

Regards

Bruno Luciani Garkauskas ( is the last name of my mother )




____________________________________________
Mindaugas wrote
Hi,

I hope I can give an answer. The final idea is include more sql DBMS and
include more features (not DMBS specific) in sqlbase/sqlmix, like
iteration of changed records, etc. Currently only MySQL DBMS is
implemented. I have FireBird and PostgreSQL drivers implemented, but I
need to find a little time to change coding style, etc., before upload
to SVN. If you are going to implement some more drivers, I see ODBC
driver the most useful. It will give access to a numerous DBMS.


Best regards,
Mindaugas
From druzus at acn.waw.pl  Thu Nov 27 19:29:24 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Thu Nov 27 19:27:44 2008
Subject: [Harbour] wince (wcecon not ruuning on PocketPc)
In-Reply-To: <20724616.post@talk.nabble.com>
References: <20081031110930.GB22253@34-mo7-2.acn.waw.pl>
	<20408175.post@talk.nabble.com>
	<20081109164721.GA2969@34-mo7-2.acn.waw.pl>
	<20409140.post@talk.nabble.com> <20409230.post@talk.nabble.com>
	<20409269.post@talk.nabble.com>
	<20081109201947.GA24098@34-mo7-2.acn.waw.pl>
	<20522880.post@talk.nabble.com>
	<20081126164651.GA23840@34-mo7-2.acn.waw.pl>
	<20724616.post@talk.nabble.com>
Message-ID: <20081128002924.GA7494@34-mo7-2.acn.waw.pl>

On Thu, 27 Nov 2008, Abeb wrote:

Hi,

> Yep it works now.
> >We should probably thanks to Pritpal for his modifications. 
> not probably, but for sure, and the same goes to you,Przemyslaw.

This probably was because I didn't check what was changed and by
whom using SVN diff. I haven't made any modifications related to
this problem in GTWVT recently. So all congratulations should be
addressed to Pritpal also from me.

best regards,
Przemek
From mhsabado at gmail.com  Thu Nov 27 20:17:50 2008
From: mhsabado at gmail.com (Mario H. Sabado)
Date: Thu Nov 27 20:18:11 2008
Subject: [Harbour] RDDSQL
In-Reply-To: <492e81bd.0a0bca0a.5794.27bfSMTPIN_ADDED@mx.google.com>
References: <492e81bd.0a0bca0a.5794.27bfSMTPIN_ADDED@mx.google.com>
Message-ID: <492F46BE.8020509@gmail.com>

> ------------------------------ Message: 6 Date: Thu, 27 Nov 2008 
> 02:19:40 +0200 From: Mindaugas Kavaliauskas <dbtopas@dbtopas.lt> 
> Subject: Re: [Harbour] RDDSQL To: "Harbour Project Main Developer 
> List." <harbour@harbour-project.org> Message-ID: 
> <492DE79C.4000707@dbtopas.lt> Content-Type: text/plain; 
> charset=ISO-8859-1; format=flowed Bruno Luciani wrote:
>> > Victor , wich is the final idea in RDDSQL
>> > 
>> > only mysql  ?
>> > 
>> > Thanks
>> > 
>> > Bruno
>
> Hi,
>
> I hope I can give an answer. The final idea is include more sql DBMS and
> include more features (not DMBS specific) in sqlbase/sqlmix, like
> iteration of changed records, etc. Currently only MySQL DBMS is
> implemented. I have FireBird and PostgreSQL drivers implemented, but I
> need to find a little time to change coding style, etc., before upload
> to SVN. If you are going to implement some more drivers, I see ODBC
> driver the most useful. It will give access to a numerous DBMS.
>
>
> Best regards,
> Mindaugas
>
> ------------------------------
Hi Mindaugas,


Have you looked at IBPP Firebird Client Interface for Firebird at http://www.ibpp.org/ ?

The FlameRobin Firebird DBMS Utility (http://www.flamerobin.org/) was based on this.

Considering FireBird's single file and very small footprint DB compared to its "giant" counterparts (MySql, PostGreSQL, MS-SQL, Oracle, etc.), would it be a viable alternate to DBF for users who wish to implement a "light" and full-featured SQL DBMS under (x)Harbour/Clipper?

This is just my thought as (x)Harbour application developer since I'm not a C/C++ programmer so for sure it's only the gurus (of course we know who you are...) could recommend.  


Thanks and best regards,

Mario




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081128/1a5663c9/attachment.html
From e.m.giordano at emagsoftware.it  Fri Nov 28 05:16:41 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Fri Nov 28 05:16:45 2008
Subject: [Harbour] Can't allocate 2 GB
Message-ID: <A0BBB9BB48AB452CA97CDB19BFB61880@emag>

Why?

function Main()

   local cText := Space( 1024 * 1024 * 1024 )

   ? "1 giga"

   cText += cText

   ? "2 gigas"

return nil

Application Internal Error - E:\HARBOUR\TEST.EXE
Terminated at: 2008.11.28 11:13:31
Unrecoverable error 6005: Exception error:

    Exception Code:C0000005
    Exception Address:00432C06
    EAX:008D452C  EBX:008D1BAC  ECX:008D452C  EDX:00000001
    ESI:80000000  EDI:00000001  EBP:0012FED8
    CS:EIP:001B:00432C06  SS:ESP:0023:0012FECC
    DS:0023  ES:0023  FS:003B  GS:0000
    Flags:00010206
    CS:EIP: C6 04 31 00 81 23 FF FF FB FF 8B C3 5F 5E 5B 5D
    SS:ESP: 008D1BAC 008D1BEC 008D1BAC 0012FF2C 004276E0 008D1BAC 80000000 
00000000 00477108 00480E74 40000000 40000000 0012FF18 0043249D 0012FF18 
004324CB

    C stack:
    EIP:     EBP:       Frame: OldEBP, RetAddr, Params...
    00432C06 0012FED8   0012FF2C 004276E0 008D1BAC 80000000 00000000 
00477108 00480E74 40000000 40000000 0012FF18
    004276E0 0012FF2C   0012FF64 0042FB5D 008D1BAC 008D1BAC 008D1BEC 
00477178 004011EE 0042B411 00000001 00000000
    0042FB5D 0012FF64   0012FF80 00424962 00000000 00000000 00477108 
7FFD5000 00000000
    00424962 0012FF80   0012FF8C 0043B35A 00000001
    0043B35A 0012FF8C   0012FFB8 00474212 00000001 008D0128 008D05B8 
00000010 00000000 7FFD5000 7FFD5000 0012FFE0
    00474212 0012FFB8   0012FFF0 00000000 00477108 7C817067 00000010 
00000000 7FFD5000 8054B6ED 0012FFC8 89B6C210


Called from MAIN(0) in TEST.prg
------------------------------------------------------------------------

From maurilio.longo at libero.it  Fri Nov 28 05:27:49 2008
From: maurilio.longo at libero.it (Maurilio Longo)
Date: Fri Nov 28 05:27:54 2008
Subject: [Harbour] Can't allocate 2 GB
In-Reply-To: <A0BBB9BB48AB452CA97CDB19BFB61880@emag>
References: <A0BBB9BB48AB452CA97CDB19BFB61880@emag>
Message-ID: <492FC7A5.5010803@libero.it>

Because, as you might know, "640 KB should be enough for anybody" :D

Maurilio.


Enrico Maria Giordano wrote:
> Why?
> 
> function Main()
> 
>   local cText := Space( 1024 * 1024 * 1024 )
> 
>   ? "1 giga"
> 
>   cText += cText
> 
>   ? "2 gigas"
> 
> return nil
> 
> Application Internal Error - E:\HARBOUR\TEST.EXE
> Terminated at: 2008.11.28 11:13:31
> Unrecoverable error 6005: Exception error:
>  
>    Exception Code:C0000005
>    Exception Address:00432C06
>    EAX:008D452C  EBX:008D1BAC  ECX:008D452C  EDX:00000001
>    ESI:80000000  EDI:00000001  EBP:0012FED8
>    CS:EIP:001B:00432C06  SS:ESP:0023:0012FECC
>    DS:0023  ES:0023  FS:003B  GS:0000
>    Flags:00010206
>    CS:EIP: C6 04 31 00 81 23 FF FF FB FF 8B C3 5F 5E 5B 5D
>    SS:ESP: 008D1BAC 008D1BEC 008D1BAC 0012FF2C 004276E0 008D1BAC
> 80000000 00000000 00477108 00480E74 40000000 40000000 0012FF18 0043249D
> 0012FF18 004324CB
> 
>    C stack:
>    EIP:     EBP:       Frame: OldEBP, RetAddr, Params...
>    00432C06 0012FED8   0012FF2C 004276E0 008D1BAC 80000000 00000000
> 00477108 00480E74 40000000 40000000 0012FF18
>    004276E0 0012FF2C   0012FF64 0042FB5D 008D1BAC 008D1BAC 008D1BEC
> 00477178 004011EE 0042B411 00000001 00000000
>    0042FB5D 0012FF64   0012FF80 00424962 00000000 00000000 00477108
> 7FFD5000 00000000
>    00424962 0012FF80   0012FF8C 0043B35A 00000001
>    0043B35A 0012FF8C   0012FFB8 00474212 00000001 008D0128 008D05B8
> 00000010 00000000 7FFD5000 7FFD5000 0012FFE0
>    00474212 0012FFB8   0012FFF0 00000000 00477108 7C817067 00000010
> 00000000 7FFD5000 8054B6ED 0012FFC8 89B6C210
> 
> 
> Called from MAIN(0) in TEST.prg
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 

-- 
 __________
|  |  | |__| Maurilio Longo
|_|_|_|____| farmaconsult s.r.l.


From e.m.giordano at emagsoftware.it  Fri Nov 28 05:40:24 2008
From: e.m.giordano at emagsoftware.it (Enrico Maria Giordano)
Date: Fri Nov 28 05:40:32 2008
Subject: [Harbour] Can't allocate 2 GB
References: <A0BBB9BB48AB452CA97CDB19BFB61880@emag>
	<492FC7A5.5010803@libero.it>
Message-ID: <E871B06A20FB4BA9B77407AF2405CD04@emag>


-----Messaggio Originale----- 
Da: "Maurilio Longo" <maurilio.longo@libero.it>
A: "Harbour Project Main Developer List." <harbour@harbour-project.org>
Data invio: venerd? 28 novembre 2008 11.27
Oggetto: Re: [Harbour] Can't allocate 2 GB


> Because, as you might know, "640 KB should be enough for anybody" :D

:-)

Joking aparts, this works:

FUNCTION MAIN()

    LOCAL cStr := SPACE( 1024 * 1024 * 1635 )

    ? LEN( cStr )

    INKEY( 0 )

    RETURN NIL

EMG

--
EMAG Software Homepage:     http://www.emagsoftware.it
The EMG's ZX-Spectrum Page: http://www.emagsoftware.it/spectrum
The Best of Spectrum Games: http://www.emagsoftware.it/tbosg
The EMG Music page:         http://www.emagsoftware.it/emgmusic 

From dbtopas at dbtopas.lt  Fri Nov 28 08:01:08 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Fri Nov 28 08:00:45 2008
Subject: [Harbour] re:SQLRDD
In-Reply-To: <133778360811271555u526b887dp7b3ac7a7857e4bb7@mail.gmail.com>
References: <133778360811271555u526b887dp7b3ac7a7857e4bb7@mail.gmail.com>
Message-ID: <492FEB94.2090802@dbtopas.lt>

Hi,


> Hi Mindaugas , I realy looking for 2 things
> in the first place an rdd for postgres may be interesting

I'll try to commit Postgre in a spear time.


> But I am looking too for a class that simplifies and unify
> the use of sql databases.
> 
> Like Python DB-API, I don 't know if anything like this exist in harbour

contrib/rddsql is a litle different, because it implements RDD, but not 
a class. But it is very easy to do class implementation after RDD is 
implemented.
I do not know how much RDD usage and Clipper experience you have, but I 
RDD interface to database is more attractive to me, because 
Clipper/Harbour syntax supports it. I.e., I can write:
   nID := ID
instead of:
   nID := oDataSet:FieldGet("ID")


> I think Xharbour have a comercial version or I am wrong ?

I guess they have RDD solution, not class interface. But as I said 
before it is easy to write class to interface RDD.


Best regards,
Mindaugas
From dbtopas at dbtopas.lt  Fri Nov 28 08:32:08 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Fri Nov 28 08:31:41 2008
Subject: [Harbour] RDDSQL
In-Reply-To: <492F46BE.8020509@gmail.com>
References: <492e81bd.0a0bca0a.5794.27bfSMTPIN_ADDED@mx.google.com>
	<492F46BE.8020509@gmail.com>
Message-ID: <492FF2D8.2020405@dbtopas.lt>

Hi,


no, I've never used Firebird in real app, I only created a sample of sql 
driver for Harbour. It is based on native Firebird C API 
(http://www.ibphoenix.com/downloads/60ApiGuide.zip), but not on IBPP. I 
guess IBPP is also based on Firebird API.

Every DBMS has its + and -. Someone needs Oracle, someone is satisfied 
with SQLite. We just need a man using some SQL DBMS with Harbour and C 
knowledge, to have a good implementation in Harbour.


Best regards,
Mindaugas


> Hi Mindaugas,
> 
> 
> Have you looked at IBPP Firebird Client Interface for Firebird at http://www.ibpp.org/ ?
> 
> The FlameRobin Firebird DBMS Utility (http://www.flamerobin.org/) was based on this.
> 
> Considering FireBird's single file and very small footprint DB compared to its "giant" counterparts (MySql, PostGreSQL, MS-SQL, Oracle, etc.), would it be a viable alternate to DBF for users who wish to implement a "light" and full-featured SQL DBMS under (x)Harbour/Clipper?
> 
> This is just my thought as (x)Harbour application developer since I'm not a C/C++ programmer so for sure it's only the gurus (of course we know who you are...) could recommend.  
> 
> 
> Thanks and best regards,
> 
> Mario

From mbelgrano at deltain.it  Fri Nov 28 09:19:38 2008
From: mbelgrano at deltain.it (Massimo Belgrano)
Date: Fri Nov 28 09:19:42 2008
Subject: [Harbour] BCC 6.10 is out
Message-ID: <609353e70811280619h9f77c69m4a55f5bfc8e04aa9@mail.gmail.com>

Is aivable a new commercial version of Borland C++
C++ Builder 2009 include CodeGear C++ Compiler 6.10 (bcc32)
http://www.codegear.com/products/cppbuilder/feature-matrix/
Have somebody tried with harbour?

wich test is better for determine speed of c compiler wich harbour?
Good see is somebody have made comparision for windows platform  of
Microsoft vs Borland vs mingw

Best Regard
Massimo Belgrano
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.harbour-project.org/pipermail/harbour/attachments/20081128/67e817e5/attachment.html
From dbtopas at dbtopas.lt  Fri Nov 28 10:06:08 2008
From: dbtopas at dbtopas.lt (Mindaugas Kavaliauskas)
Date: Fri Nov 28 10:05:33 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw
	Czerpak	(druzus/at/priv.onet.pl)
In-Reply-To: <20081127155323.GA25089@34-mo7-2.acn.waw.pl>
References: <3F205B04-187A-4D02-8B47-EC45929AB74E@syenar.hu>	<20081105180123.GA16461@34-mo7-2.acn.waw.pl>	<E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>	<4912E7C2.6010801@dbtopas.lt>	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>	<491315D1.7030303@dbtopas.lt>	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>	<20081106172214.GA9967@34-mo7-2.acn.waw.pl>	<492D46FA.9010808@dbtopas.lt>
	<20081127155323.GA25089@34-mo7-2.acn.waw.pl>
Message-ID: <493008E0.9020503@dbtopas.lt>

Hi,


> First we should agree final version and resolve some problems.
> 1. how to keep translation in memory.
>    IMHO it should be single serialized item and hash item is very good
>    choice because it can be also easy extended to keep additional
>    attributes. All translation strings will be indexed by string items
>    and all other attributes like information about CP encoding, language
>    name will be indexes by numbers. F.e.:
>       #define HB_I18N_CPID    1
>       #define HB_I18N_DOMAIN  2
>       [...]
>       hTrans[ HB_I18N_CPID ] := "PLISO"

I was thinking about:
    {"LANGUAGE"=>"PL_PL", "CPID"=>"PLISO", "TABLE"=>{...}}
but using numeric keys are also possible.


> 2. how to keep translation in final binary files.
>    hb_itemSerialize() seems to be natural form

I think hb_itemSerialize() is good for the table storage, but language, 
cpid could be stored in header. Header containing at least signature and 
file version would be a good idea. It can help identify file for various 
tools without decoding serialized data, ex., /etc/magic


> 3. we should add API to easy create/update trnalsation tables.
>    It does not have to be optimized for speed and can be written
>    as .prg code so programmers can easy create usr interface for
>    translations in their programs. We can also create such program
>    as new hbtools, f.e. hbi18n so it can be used externally to
>    application.
>    To not hardcode internal representation in such programs we will
>    need functions to initialize new translation set, add new translation
>    item and extract final set as item or string.

OK. I think API for create/update translation is the easiest part.

> 4. We should add support for loading directly .pot files and create
>    translation table from them.

Sure.

> 5. For easy use it's necessary to have in core code function which will
>    work like printf(). Otherwise it will be hard to create strings for
>    translations which are not context dependent.
>    Such function should be in base escape characters like %s or %d
>    compatible with C so we can use dedicated tools to operate on .pot
>    files. Anyhow for better flexibility we should add support for stringify
>    and format any item size. F.e. %s should also work for numeric, date and
>    logical items. In general it should be possible to create formatting
>    similar to the one given by transform and picture clasue. 
>    We can add support for passing picture clase directly in formatted
>    string or as parameter. We can also add some additional extensions.
>    The function name is less important. We can call it hb_strFormat().
>    It's time to implement it.

Yes. We need it. The problem is, if we had to be C compatible, or we 
need to to implement our own Harbour specific type specifiers.
A simple implementation could be:
   %d = LTRIM(STR(nValue)) or LTRIM(STR(ROUND(nValue, 0))) ???
   %s = cValue or TRIM(cValue) ???
but we will always want some new extensions. I still can not make 
agreement with myself what specifiers should be. Do you have some ideas 
about it?

 From i18n point of view a very important thing is %1$d extension. It is 
not related to speficier type problem, so I we need to implement it for 
sure.


> 6. We should decide if we want to add support for plural form translations.
>    Now it's not supported by us. In many cases we can live without it but
>    sometimes it's useful. It will be important for final translation
>    representation though seems that if we will use hashes then it can be
>    added later. We can simply add translation for plural forms as additional
>    hash item attributes.

In Lithuanian language plural forms does not always solves the problem, 
because we need more that 2 word ending. AFAIK, the same problem is for 
Polish translations. I guess we can live without plurals.


> 8. The C interface should allow to use different low level implementation
>    so if someone will want to use real gettext API then it can register
>    his own wrappers.

Do you mean just an overloading of i18n C function by other module, or 
some more complex possibility to have alternative gettext?

> 9. We should add support for automatic CP translations in output strings.
>    Otherwise we will end with many different lang modules for different
>    encoding like in msg*.c files. There is a question if we also want to
>    add translation for input strings but I do not think it's very important.
>    We can leave it open for future decissions.

According to http://www.gnu.org/software/gettext/manual/gettext.html 
11.2.4: Note that the msgid argument to gettext is not subject to 
character set conversion. Also, when gettext does not find a translation 
for msgid, it returns msgid unchanged ? independently of the current 
output character set. It is therefore recommended that all msgids be 
US-ASCII strings.
So, I think we do not need to convert input strings.


> 7. We should give more precise meaning for domain names in our implementation.
>    I think that using it as language ID is quite good idea.

> 10. We should decide about global settings which will control the translation
>     module:
>       - default domain/language
>       - default path with translation file
>     If we want to make them thread local then they should be controlled by
>     _SET_* structure. In such case they will be inherited by child threads.

According to this document domains are used to as a synonym for package 
or library. The default domain is "messages". My knowledge about 
original gettext and is only theoretical. All I know is 
http://www.gnu.org/software/gettext/manual/gettext.html, but I've never 
used it real life. So, it is hard for me to say, if we can mix domain 
and language. It is different things in getttext.

BTW, in my application I had more need for context than domain. Because 
sometimes the same word needs to have different translations, ex., 
"Exit" has a different translation depending on meaning, if it is "An 
exit" or "To exit".
I'm currently using my hackish context implementation, but it would be 
nice that Harbours i18n would support contexts.


> I can implement the base C code when I'll hear your opinion about above
> points.
> It will be good if you or someone else can work on hb_strFormat() and
> hbi18n tool for creating translation.

I'll try to do as much as possible. Implementation of API to create/edit 
translation table is not a problem. I only doubt my possibility to 
implement the final tool, because I was always using my own GUI library, 
and I've never tried to do browse() or @ 1, 1, SAY "Hello".


Best regards,
Mindaugas
From druzus at acn.waw.pl  Fri Nov 28 16:32:58 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov 28 16:31:22 2008
Subject: [Harbour] 2008-11-01 21:13 UTC+0100 Przemyslaw Czerpak
	(druzus/at/priv.onet.pl)
In-Reply-To: <493008E0.9020503@dbtopas.lt>
References: <E026792F-67F0-415C-BB19-95277B4CFA92@syenar.hu>
	<20081105201105.GA26241@34-mo7-2.acn.waw.pl>
	<4912E7C2.6010801@dbtopas.lt>
	<10B32C8C-926E-455F-BD36-0F8236EBCBDA@syenar.hu>
	<491315D1.7030303@dbtopas.lt>
	<6B0D3378-AB28-4273-B24E-CD3D321FDD30@syenar.hu>
	<20081106172214.GA9967@34-mo7-2.acn.waw.pl>
	<492D46FA.9010808@dbtopas.lt>
	<20081127155323.GA25089@34-mo7-2.acn.waw.pl>
	<493008E0.9020503@dbtopas.lt>
Message-ID: <20081128213258.GA20608@34-mo7-2.acn.waw.pl>

On Fri, 28 Nov 2008, Mindaugas Kavaliauskas wrote:

Hi Mindaugas,

> I was thinking about:
>    {"LANGUAGE"=>"PL_PL", "CPID"=>"PLISO", "TABLE"=>{...}}
> but using numeric keys are also possible.

In such case we will have translations in separate table
encapsulated in other table. If we accept it then it may
be cleaner and easier to manage so it's OK for me.

>> 2. how to keep translation in final binary files.
>>    hb_itemSerialize() seems to be natural form
> I think hb_itemSerialize() is good for the table storage, but language, 
> cpid could be stored in header. Header containing at least signature and 
> file version would be a good idea. It can help identify file for various 
> tools without decoding serialized data, ex., /etc/magic

OK.

>> 5. For easy use it's necessary to have in core code function which will
>>    work like printf(). Otherwise it will be hard to create strings for
>>    translations which are not context dependent.
>>    Such function should be in base escape characters like %s or %d
>>    compatible with C so we can use dedicated tools to operate on .pot
>>    files. Anyhow for better flexibility we should add support for stringify
>>    and format any item size. F.e. %s should also work for numeric, date and
>>    logical items. In general it should be possible to create formatting
>>    similar to the one given by transform and picture clasue.    We can add 
>> support for passing picture clase directly in formatted
>>    string or as parameter. We can also add some additional extensions.
>>    The function name is less important. We can call it hb_strFormat().
>>    It's time to implement it.
> Yes. We need it. The problem is, if we had to be C compatible, or we need 
> to to implement our own Harbour specific type specifiers.
> A simple implementation could be:
>   %d = LTRIM(STR(nValue)) or LTRIM(STR(ROUND(nValue, 0))) ???
>   %s = cValue or TRIM(cValue) ???
> but we will always want some new extensions. I still can not make agreement 
> with myself what specifiers should be. Do you have some ideas about it?
> From i18n point of view a very important thing is %1$d extension. It is not 
> related to speficier type problem, so I we need to implement it for sure.

Just like you I still cannot take final decision.
For use parameter indexing is a must.

>> 6. We should decide if we want to add support for plural form translations.
>>    Now it's not supported by us. In many cases we can live without it but
>>    sometimes it's useful. It will be important for final translation
>>    representation though seems that if we will use hashes then it can be
>>    added later. We can simply add translation for plural forms as additional
>>    hash item attributes.
> In Lithuanian language plural forms does not always solves the problem, 
> because we need more that 2 word ending. AFAIK, the same problem is for 
> Polish translations. I guess we can live without plurals.

This is resolved in gettext. At least for European languages.
Usually it's possible to define some limited number of basic
rules which depends on given number. F.e. in Polish there are
3 forms: for 1, for numbers ending with 2,3,4 except 11,12,...,19
and for rest.
   1 dom
   2 domy, 3 domy, 4 domy, 22 domy, 34 domy
   5 dom?w, 6 dom?w, 11 dom?w, 13 dom?w, 31 dom?w, 45 dom?w

In Lithuanian you have also 3 forms:
   1. for numbers ending with 10, 11, 12, 13, ..., 19
   2. for numbers ending with 1
   3. for rest

When number for rules is finite and it's possible to create
math function which translate any number to rule number then
this rule number can be used to index alternative translations.
gettext allows to intorduce such rule in translation definition
as C expression with with one variable 'n' which points to number
passed as additional gettext parameter. We can use clipper syntax
to define such expression.
F.e. for Polish I can define rule indexing plural forms as:
   iif( n == 1, 1, iif( n % 10 >= 2 .and. n % 10 <= 4 .and. ;
                        ( n % 100 < 10 .or. n%100 >= 20 ), 2, 3 ) )
and for Lithuanian:
   iif( n % 100 >= 10 .and. n % 100 < 20, 1, iif( n % 10 == 1, 2, 3 ) )

Then we only have to introduce support for defining and storing
alternative translations which will be chosen by index created
from one of translation function parameter. We can define that
when 1-st parameter of hb_i18n_gettext() is numeric value then
it's extended form which allows index translation. Index is
created from the 1-st parameter using plural index expression
like above defined in translation rule.

I can try to implement it but just like you I also can live without it
though sometimes it reduce the translation quality. just simply I would
like to know if someone will really use it.

>> 8. The C interface should allow to use different low level implementation
>>    so if someone will want to use real gettext API then it can register
>>    his own wrappers.
> Do you mean just an overloading of i18n C function by other module, or some 
> more complex possibility to have alternative gettext?

I'm thinking about simple table with function address which can be
overloaded using some public function so it will be possible to
replace our default functions by user ones.

>> 9. We should add support for automatic CP translations in output strings.
>>    Otherwise we will end with many different lang modules for different
>>    encoding like in msg*.c files. There is a question if we also want to
>>    add translation for input strings but I do not think it's very important.
>>    We can leave it open for future decissions.
> According to http://www.gnu.org/software/gettext/manual/gettext.html 
> 11.2.4: Note that the msgid argument to gettext is not subject to character 
> set conversion. Also, when gettext does not find a translation for msgid, 
> it returns msgid unchanged ? independently of the current output 
> character set. It is therefore recommended that all msgids be US-ASCII 
> strings.
> So, I think we do not need to convert input strings.

I know about it and I agree that it's not strictly necessary but
I do not know if people who do not use latin base languages will
share this opinion.

>> 7. We should give more precise meaning for domain names in our implementation.
>>    I think that using it as language ID is quite good idea.
>> 10. We should decide about global settings which will control the translation
>>     module:
>>       - default domain/language
>>       - default path with translation file
>>     If we want to make them thread local then they should be controlled by
>>     _SET_* structure. In such case they will be inherited by child threads.
> According to this document domains are used to as a synonym for package or 
> library. The default domain is "messages". My knowledge about original 
> gettext and is only theoretical. All I know is 
> http://www.gnu.org/software/gettext/manual/gettext.html, but I've never 
> used it real life. So, it is hard for me to say, if we can mix domain and 
> language. It is different things in getttext.

Yes. But original gettext uses locale setting to determinate language
and output CP. domain is necessary because translations are stored
in common system directory which can be shared between different
computers and even OS-es. If you have set of similar tools then
they can share translation tables because many of strings will be
the same. You can also create program which will use messages existing
in some domains so instead of creating your own translations you can
simply use them and only add few unique to you program messages if
necessary. In such case you can benefit from other people translations.
It's a nice feature when you are creating programs which should be
well integrated with system. It's the reason why I want to keep easy
way to replace our own i18n module by alternative one like wrapper to
real gettext. Probably I'll create such wrapper. Anyhow it will not be
good solution for people wanting to distribute their programs as self
contain packages which will use the same translation tables in different
OS-es. gettext dependencies will not be well seen in MS-Windows world ;-)
People should have an option. F.e. when I want to create some system
tools using Harbour which will have to be integrated with other tools
like WWW server or RDBMS then I chose original gettext. Otherwise I'd
prefer our own integrated solution because I can easy use the same
translation files in other supported by Harbour platforms. I can also
introduce some extensions like automatic translation updating from
my host so new translations will be available for users automatically.

In our own implementation we can define different meaning for domain
then the one which exists in gettext where inside each domain you
have translations for different languages. When someone decide to
use our own i18n implementation then usually need it only for his own
application and does not need domains defined like for gettext.
We can also use domains for context translations.
It's our choice.

> BTW, in my application I had more need for context than domain. Because 
> sometimes the same word needs to have different translations, ex., "Exit" 
> has a different translation depending on meaning, if it is "An exit" or "To 
> exit".
> I'm currently using my hackish context implementation, but it would be nice 
> that Harbours i18n would support contexts.

And we can use domain as context signature for alternative translations.
In such case when domain is given we will look for translation in given
domain and if it's not found then in main domain.
To resolve context problem we can also define some dummy pattern which
will be eliminated by our own hb_strFormat() function and use it to create
unique strings, f.e.:
   "%1@Exit"
   "%2@Exit"

%<n>@ will be replaced by empty string.

>> I can implement the base C code when I'll hear your opinion about above
>> points.
>> It will be good if you or someone else can work on hb_strFormat() and
>> hbi18n tool for creating translation.
> I'll try to do as much as possible. Implementation of API to create/edit 
> translation table is not a problem. I only doubt my possibility to 
> implement the final tool, because I was always using my own GUI library, 
> and I've never tried to do browse() or @ 1, 1, SAY "Hello".

Thank you very much.
In this weekend or at the beginning of next one I'll try to create some
basic core version.

best regards,
Przemek
From zen25000 at zen.co.uk  Fri Nov 28 16:51:14 2008
From: zen25000 at zen.co.uk (Barry Jackson)
Date: Fri Nov 28 16:51:17 2008
Subject: [Harbour] Problem building telepathy test program
In-Reply-To: <20717905.post@talk.nabble.com>
References: <20707046.post@talk.nabble.com> <492E7AD7.5050602@libero.it>
	<20717629.post@talk.nabble.com> <492E84C0.7020806@libero.it>
	<20717905.post@talk.nabble.com>
Message-ID: <20740959.post@talk.nabble.com>


More problems.
There is a "THREAD STATIC s_aPorts"  declaration before the main procedure
in telepathy.prg and no matter how I build this it always crashes with: 
Error BASE/1003 Variable does not exist: S_APORTS. Even if I put altd()
before any other functions in main() it crashes first.
I have tried changing it to a PUBLIC inside main(). I have tried it without
the 'THREAD', I have compiled it with -mt but all produce the same result. I
cannot find any documentation on Harbour variable declarations and scoping
anywhere. Even a small test program with a STATIC declared before the main()
procedure cannot see the static variable within the program. As I understand
it a STATIC declared outside the main procedure should have application wide
scope - is this correct?


Barry Jackson wrote:
> 
> That's encouraging - my current version of the program that I want to
> write has been in use for years, but I wrote it using Xbase++ and it runs
> under Win98. It controls a Digital Video Recorder which is hidden and
> inaccessible.
> I am trying to change everything to Linux - hence this exercise. 
> Cheers,
> Barry
> 
> 
> Maurilio Longo wrote:
>> 
>> Barry,
>> 
>> it should be enough for such an use, I was able to talk to a fiscal
>> printer
>> sending and receiving packets.
>> 
>> I think it's enough to remove that function or, better, use the correct
>> one
>> for harbour.
>> 
>> Best regards.
>> 
>> Maurilio.
>> 
>> Barry Jackson wrote:
>>> Maurilio,
>>> Many thanks for your reply.
>>> OK that's fine- I will work around that function if I need to. The
>>> application I want to write will only be required to open a port and
>>> send
>>> character strings - there is no handshake so it should not be a problem.
>>> I just wanted to be sure that I was not the cause of the failure of the
>>> test
>>> build! I am new to Linux, but have been playing with Clipper since
>>> summer
>>> '87.
>>> Cheers,
>>> Barry
>>> 
>>> Maurilio Longo wrote:
>>>> Barry,
>>>>
>>>> this is a problem inside hbtpathy which comes from xharbour and uses a
>>>> function (threadsleep) not available in harbour.
>>>>
>>>> So this has to be fixed in hbtpathy.
>>>>
>>>> BTW, I wrote it, and it is more of a proof of concept than a finished
>>>> library
>>>> that can be used on production systems.
>>>>
>>>> Best regards.
>>>>
>>>> Maurilio.
>>>>
>>>>
>>>>
>>>> Barry Jackson wrote:
>>>>> What am I doing wrong? I am trying to build the telepathy test
>>>>> program.
>>>>> I am using Mandriva Linux 2009.0 and built harbour using
>>>>> mpkg_rpm_from_svn.sh script.
>>>>> The make_gcc.sh ran OK in the hbtpathy dir. and
>>>>> /usr/lib/harbour/libhbtpathy.a exists.
>>>>> Regular "Hello World" programs compile OK and run without problem.
>>>>>
>>>>> [baz@jackodesktop hbr]$ hbmk @testtp.txt
>>>>> Harbour 1.1.0dev (Rev. 9842)
>>>>> Copyright (c) 1999-2008, http://www.harbour-project.org/
>>>>> Reading 'testtp.txt'...
>>>>> Compiling module 'testtp.prg'...
>>>>> Compiling module 'telepath.prg'...
>>>>> Lines 1273, Functions/Procedures 34
>>>>> Generating C source output to 'testtp.c'... Done.
>>>>> [baz@jackodesktop hbr]$ hbcc testtp.c tplinux.c tpcommon.c
>>>>> /home/baz/tmp/ccueA9Uh.o:(.data+0x138): undefined reference to
>>>>> `HB_FUN_THREADSLEEP'
>>>>> collect2: ld returned 1 exit status
>>>>>
>>>> -- 
>>>>  __________
>>>> |  |  | |__| Maurilio Longo
>>>> |_|_|_|____| farmaconsult s.r.l.
>>>>
>>>> 
>>>> _______________________________________________
>>>> Harbour mailing list
>>>> Harbour@harbour-project.org
>>>> http://lists.harbour-project.org/mailman/listinfo/harbour
>>>>
>>>>
>>> 
>> 
>> -- 
>>  __________
>> |  |  | |__| Maurilio Longo
>> |_|_|_|____| farmaconsult s.r.l.
>> 
>> 
>> _______________________________________________
>> Harbour mailing list
>> Harbour@harbour-project.org
>> http://lists.harbour-project.org/mailman/listinfo/harbour
>> 
>> 
> 
> 

-- 
View this message in context: http://www.nabble.com/Problem-building-telepathy-test-program-tp20707046p20740959.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From druzus at acn.waw.pl  Fri Nov 28 18:50:37 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Fri Nov 28 18:48:55 2008
Subject: [Harbour] Problem building telepathy test program
In-Reply-To: <20740959.post@talk.nabble.com>
References: <20707046.post@talk.nabble.com> <492E7AD7.5050602@libero.it>
	<20717629.post@talk.nabble.com> <492E84C0.7020806@libero.it>
	<20717905.post@talk.nabble.com> <20740959.post@talk.nabble.com>
Message-ID: <20081128235037.GA26783@34-mo7-2.acn.waw.pl>

On Fri, 28 Nov 2008, Barry Jackson wrote:

Hi Barry,

> More problems.
> There is a "THREAD STATIC s_aPorts"  declaration before the main procedure
> in telepathy.prg and no matter how I build this it always crashes with: 
> Error BASE/1003 Variable does not exist: S_APORTS. Even if I put altd()
> before any other functions in main() it crashes first.
> I have tried changing it to a PUBLIC inside main(). I have tried it without
> the 'THREAD', I have compiled it with -mt but all produce the same result. I
> cannot find any documentation on Harbour variable declarations and scoping
> anywhere. Even a small test program with a STATIC declared before the main()
> procedure cannot see the static variable within the program. As I understand
> it a STATIC declared outside the main procedure should have application wide
> scope - is this correct?

The variable scope is exactly the same as in Clipper and I think also
in xbase++ if it's Clipper compatible. See what -n harbour and Clipper
compiler switch does in Clipper documentation and use it to compiler
your code. All Clipper switches are supported. -n means that compiler
will not generate automatically procedure with the same name as compiled
file which will contain code between start of file and first explicitly
defined user function/procedure.
When it's used then before 1-st function/procedure you can only use
declarations like MEMVAR, FIELD, [THREAD] STATIC and they have file
wide scope.

best regards,
Przemek
From bruno.luciani at gmail.com  Fri Nov 28 18:52:30 2008
From: bruno.luciani at gmail.com (Bruno Luciani)
Date: Fri Nov 28 18:52:34 2008
Subject: [Harbour] rddsql
Message-ID: <133778360811281552j4c994929l1a0b4e74e24a05f1@mail.gmail.com>

Yes mindaugas I understand what do you say , I use DBF and RDDCDX
but I like in future try other databases .

In your experiencies how is the perfomance of rddsql and mysql or postgres
when you load a database , in a browse ? respect DBF ?

I hear that may be is not good in larger database, which is your experience ?


thanks for your answers

Bruno



///////////////////////////////////////////
Hi,


> Hi Mindaugas , I realy looking for 2 things
> in the first place an rdd for postgres may be interesting

I'll try to commit Postgre in a spear time.


> But I am looking too for a class that simplifies and unify
> the use of sql databases.
>
> Like Python DB-API, I don 't know if anything like this exist in harbour

contrib/rddsql is a litle different, because it implements RDD, but not
a class. But it is very easy to do class implementation after RDD is
implemented.
I do not know how much RDD usage and Clipper experience you have, but I
RDD interface to database is more attractive to me, because
Clipper/Harbour syntax supports it. I.e., I can write:
   nID := ID
instead of:
   nID := oDataSet:FieldGet("ID")


> I think Xharbour have a comercial version or I am wrong ?

I guess they have RDD solution, not class interface. But as I said
before it is easy to write class to interface RDD.


Best regards,
Mindaugas
From zen25000 at zen.co.uk  Sat Nov 29 06:01:04 2008
From: zen25000 at zen.co.uk (Barry Jackson)
Date: Sat Nov 29 06:01:09 2008
Subject: [Harbour] Problem building telepathy test program
In-Reply-To: <20081128235037.GA26783@34-mo7-2.acn.waw.pl>
References: <20707046.post@talk.nabble.com> <492E7AD7.5050602@libero.it>
	<20717629.post@talk.nabble.com> <492E84C0.7020806@libero.it>
	<20717905.post@talk.nabble.com> <20740959.post@talk.nabble.com>
	<20081128235037.GA26783@34-mo7-2.acn.waw.pl>
Message-ID: <20745967.post@talk.nabble.com>


Hi Przemek,

Many thanks - that fixed it, I am getting somewhere now! I have used -n in
the past but never realized the effect on code outside the first function. I
have never used STATICS myself - I always used PUBLICS and straight
structured functional coding! That, I can understand.
I do have the original Nantucket Clipper 5.00 Manual, so I will keep
reading.
Thanks again,
Cheers,
Barry


Przemyslaw Czerpak-2 wrote:
> 
> On Fri, 28 Nov 2008, Barry Jackson wrote:
> 
> Hi Barry,
> 
>> More problems.
>> There is a "THREAD STATIC s_aPorts"  declaration before the main
>> procedure
>> in telepathy.prg and no matter how I build this it always crashes with: 
>> Error BASE/1003 Variable does not exist: S_APORTS. Even if I put altd()
>> before any other functions in main() it crashes first.
>> I have tried changing it to a PUBLIC inside main(). I have tried it
>> without
>> the 'THREAD', I have compiled it with -mt but all produce the same
>> result. I
>> cannot find any documentation on Harbour variable declarations and
>> scoping
>> anywhere. Even a small test program with a STATIC declared before the
>> main()
>> procedure cannot see the static variable within the program. As I
>> understand
>> it a STATIC declared outside the main procedure should have application
>> wide
>> scope - is this correct?
> 
> The variable scope is exactly the same as in Clipper and I think also
> in xbase++ if it's Clipper compatible. See what -n harbour and Clipper
> compiler switch does in Clipper documentation and use it to compiler
> your code. All Clipper switches are supported. -n means that compiler
> will not generate automatically procedure with the same name as compiled
> file which will contain code between start of file and first explicitly
> defined user function/procedure.
> When it's used then before 1-st function/procedure you can only use
> declarations like MEMVAR, FIELD, [THREAD] STATIC and they have file
> wide scope.
> 
> best regards,
> Przemek
> _______________________________________________
> Harbour mailing list
> Harbour@harbour-project.org
> http://lists.harbour-project.org/mailman/listinfo/harbour
> 
> 

-- 
View this message in context: http://www.nabble.com/Problem-building-telepathy-test-program-tp20707046p20745967.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From niki at synel.co.il  Sun Nov 30 02:41:24 2008
From: niki at synel.co.il (Chen Kedem)
Date: Sun Nov 30 02:43:19 2008
Subject: [Harbour] SF bugtracker#2359753: "" + 0
Message-ID: <1A07FEDC778C3E4AA417F089511F859C03333A421E@Mail-yoq.SYNEL-COMPANY.LTD>

http://sourceforge.net/tracker/index.php?func=detail&aid=2359753&group_id=681&atid=100681

---tt48.prg---
func test()
? "" + 0
return NIL
--------------

Clipper 5.2e gives Error BASE/1081  Argument error: +
Harbour gives not error [ valtype("" + 0) == "C" ].

BCC32 and ChangeLog 2008-11-26 18:22 UTC+0100 Przemyslaw Czerpak

(maybe such a case should be added to HBTest as I don't see such test there).


  Chen.
From ng at areainformatica.com  Sun Nov 30 06:52:10 2008
From: ng at areainformatica.com (Giangi)
Date: Sun Nov 30 06:52:32 2008
Subject: [Harbour] Re: re:SQLRDD
References: <133778360811271555u526b887dp7b3ac7a7857e4bb7@mail.gmail.com>
Message-ID: <ggtupf$bq0$2@ger.gmane.org>

I've a GPF launching hbmysql\tests\test.prg

This is the log file:

Application Internal Error - C:\harbour\contrib\hbmysql\tests\test.exe
Terminated at: 2008.10.12 17:09:27
Unrecoverable error 6005: Exception error:

    Exception Code:C0000005
    Exception Address:100292FB
    EAX:00353ED8  EBX:00353ED8  ECX:00000000  EDX:00000000
    ESI:00477402  EDI:0047740E  EBP:00477415
    CS:EIP:001B:100292FB  SS:ESP:0023:0012FC84
    DS:0023  ES:0023  FS:003B  GS:0000
    Flags:00010206
    CS:EIP: FF 11 83 C4 04 C2 04 00 CC CC CC CC CC CC CC CC
    SS:ESP: 00353ED8 00401227 00353ED8 00477402 0047740E 00477415 00000000
00000CEA 00000000 00000000 00000CEA 00000000 0012FCE4 00000041 00000000
0047820C

    C stack:
    EIP:     EBP:       Frame: OldEBP, RetAddr, Params...


Called from SQLCONNECT(0)
Called from TMYSQLSERVER:NEW(1373)
Called from MAIN(62) in test.prg

TIA
Gianluca


-- 

"Bruno Luciani" <bruno.luciani@gmail.com> ha 
scritto nel messaggio 
news:133778360811271555u526b887dp7b3ac7a7857e4bb7@mail.gmail.com...
> Hi Mindaugas , I realy looking for 2 things
> in the first place an rdd for postgres may be interesting
>
> But I am looking too for a class that simplifies and unify
> the use of sql databases.
>
> Like Python DB-API, I don 't know if anything like this exist in harbour
>
> I think Xharbour have a comercial version or I am wrong ?
>
> Regards
>
> Bruno Luciani Garkauskas ( is the last name of my mother )
>
>
>
>
> ____________________________________________
> Mindaugas wrote
> Hi,
>
> I hope I can give an answer. The final idea is include more sql DBMS and
> include more features (not DMBS specific) in sqlbase/sqlmix, like
> iteration of changed records, etc. Currently only MySQL DBMS is
> implemented. I have FireBird and PostgreSQL drivers implemented, but I
> need to find a little time to change coding style, etc., before upload
> to SVN. If you are going to implement some more drivers, I see ODBC
> driver the most useful. It will give access to a numerous DBMS.
>
>
> Best regards,
> Mindaugas 



From druzus at acn.waw.pl  Sun Nov 30 09:06:54 2008
From: druzus at acn.waw.pl (Przemyslaw Czerpak)
Date: Sun Nov 30 09:05:09 2008
Subject: [Harbour] SF bugtracker#2359753: "" + 0
In-Reply-To: <1A07FEDC778C3E4AA417F089511F859C03333A421E@Mail-yoq.SYNEL-COMPANY.LTD>
References: <1A07FEDC778C3E4AA417F089511F859C03333A421E@Mail-yoq.SYNEL-COMPANY.LTD>
Message-ID: <20081130140653.GA21357@34-mo7-2.acn.waw.pl>

On Sun, 30 Nov 2008, Chen Kedem wrote:
> ---tt48.prg---
> func test()
> ? "" + 0
> return NIL
> --------------
> Clipper 5.2e gives Error BASE/1081  Argument error: +
> Harbour gives not error [ valtype("" + 0) == "C" ].

It's intentional. Harbour fully optimize expresions like
<exp> + 0 to <exp>, f.e.:
   l1 + 0 => l1
If you do not like it then use -kc compiler switch which will
disable it and result will be the same as in Clipper.

best regards,
Przemek
From bedipritpal at hotmail.com  Sun Nov 30 10:49:53 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 30 10:49:56 2008
Subject: [Harbour] PRG Function as a Window's Callback Procedure
Message-ID: <20758851.post@talk.nabble.com>


Hello

I am looking for a way ( I am sure it exists ) to do something 
like this:

HB_FUNC( WIN_SETWNDPROC )
{
   HWND hWnd = ( HWND ) ( HB_PTRDIFF ) hb_parnint( 1 );
   WNDPROC wndProc = ( WNDPROC ) ( HB_PTRDIFF ) hb_parnint( 2 );
   WNDPROC oldProc;

   oldProc = ( WNDPROC ) SetWindowLong( hWnd, GWL_WNDPROC,( long ) wndProc )
;

   hb_retnint( ( HB_PTRDIFF ) oldProc );
}

and fron prg code :

METHOD MyMethod()
   Win_SetWndProc( ::hWnd, @WndProc() )   // or LIKE
   //   
   Return Self

Function/Method WndProc( hWnd, nMessage, nwParam, nlParam )
   // take action
   Return 0


How I can achieve it. Via C code I can achieve it but that is not elegant 
solution and also I cannot call methods.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/PRG-Function-as-a-Window%27s-Callback-Procedure-tp20758851p20758851.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

From adam_l at poczta.onet.pl  Sun Nov 30 12:14:34 2008
From: adam_l at poczta.onet.pl (adam_l@poczta.onet.pl)
Date: Sun Nov 30 12:14:38 2008
Subject: [Harbour] Error message show bad line number
Message-ID: <Q178046729-612c93e32843d27bcb0617fc0571627f@pmq1.test.onet.pl>

Hi!

Try sample program:
*****************
PROCEDURE main
LOCAL i
LOCAL xxx   //my bad, not set value
LOCAL aa:="A"
IF aa=="A"
  FOR i:=1 TO 2
     ? "OK A"
     IF aa=="A"
        ? "OK AA"  // In my big program message show this line as error
     ELSE
         ? "BAD AA"
     ENDIF
  NEXT   //Error message show this line as error "BASE/1066 Conditional"
ELSEIF "B"=="B"
  ? "OK B"
  IF "BB"=="BB"
     ? "OK BB"
  ELSE
     ? "BAD BB"
  ENDIF
ELSE
  ? "FALE 1"
  IF "CC"=="CC"
     ? "OK CC"
  ELSE
     ? "BAD AA"
  ENDIF
ENDIF
IF !xxx    //<-- IN THIS LINE IS ERROR
  ? "OK xxx"
ELSE
  ? "FALES xxx"
ENDIF
RETURN
**********************
In my big program I find realy line number with error,
when I compile with -gc2 option and read pcode in *.c file.


Harbour 1.1.0dev (Rev. 9921)
Copyright (c) 1999-2008, http://www.harbour-project.org/
Harbour MiniGUI Extended Distribution

Harbour Build Info
---------------------------
Version: Harbour 1.1.0dev (Rev. 9921)
Compiler: Borland C++ 5.5.1 (32-bit)
Platform: Windows 98 4.10.2222 A
PCode version: 0.2
ChangeLog last entry: 2008-11-12 23:28 UTC+0100 Przemyslaw Czerpak (druzus/at/pr
iv.onet.pl)
ChangeLog ID: ChangeLog 9921 2008-11-12 22:27:19Z druzus

Built on: Nov 13 2008 12:42:39
Extra C compiler options: -DHB_FM_STATISTICS_OFF -DHB_GUI -DHB_FM_STD_ALLOC
Build options:
Language options: (C5.3) (C5.x undoc) (Xbase++) (Flagship) (dirty extensions)


Adam Lubszczyk

From lorenzo.fiorini at gmail.com  Sun Nov 30 13:54:39 2008
From: lorenzo.fiorini at gmail.com (Lorenzo Fiorini)
Date: Sun Nov 30 13:54:42 2008
Subject: [Harbour] gtwvt problem
Message-ID: <9257026e0811301054ycc12604u81791f7e4c136e9b@mail.gmail.com>

The code below works in 1.0.1 and in gtxwc in the sense that I get the
requested font size, rows and cols.
With trunk and gtwvt it resets to the default 20,24,79.
I'm using msys/mingw current under WinXP SP3.

Note that without the  ? HB_GTVERSION() gtxwc works but gtwvt doesn't
show the window ( but it's in the task bar ).

Any suggestion?

best regards,
Lorenzo

#include "hbgtinfo.ch"

procedure main()

   local nRows, nCols

   if !( HB_GTVERSION() $ "STD_TRM" )
      ? HB_GTVERSION()
      HB_GTInfo(HB_GTI_FONTSIZE, 15)
      if !setmode( 48, 140 )
         setmode( 255, 255 )
      endif
      clear screen
   endif

   nRows := maxrow()
   nCols := maxcol()

   alert( "maxrow()="+alltrim(str(nRows))+;
          ";maxcol()="+alltrim(str(maxcol(nCols)))+;
          ";font size="+alltrim(str(HB_GTInfo(HB_GTI_FONTSIZE)))+;
          ";Am I in center?" )

return
From bedipritpal at hotmail.com  Sun Nov 30 15:31:56 2008
From: bedipritpal at hotmail.com (Pritpal Bedi)
Date: Sun Nov 30 15:31:58 2008
Subject: [Harbour] gtwvt problem
In-Reply-To: <9257026e0811301054ycc12604u81791f7e4c136e9b@mail.gmail.com>
References: <9257026e0811301054ycc12604u81791f7e4c136e9b@mail.gmail.com>
Message-ID: <20761895.post@talk.nabble.com>


Hi Lorenzo


Lorenzo Fiorini-2 wrote:
> 
> The code below works in 1.0.1 and in gtxwc in the sense that I get the
> requested font size, rows and cols.
> With trunk and gtwvt it resets to the default 20,24,79.
> I'm using msys/mingw current under WinXP SP3.
> 
> Note that without the  ? HB_GTVERSION() gtxwc works but gtwvt doesn't
> show the window ( but it's in the task bar ).
> 
> #include "hbgtinfo.ch"
> 
> procedure main()
> 
>    local nRows, nCols
> 
>    if !( HB_GTVERSION() $ "STD_TRM" )
>       ? HB_GTVERSION()
>       HB_GTInfo(HB_GTI_FONTSIZE, 15)
>       if !setmode( 48, 140 )
>          setmode( 255, 255 )
>       endif
>       clear screen
>    endif
> 
>    nRows := maxrow()
>    nCols := maxcol()
> 
>    alert( "maxrow()="+alltrim(str(nRows))+;
>           ";maxcol()="+alltrim(str(maxcol(nCols)))+;
>           ";font size="+alltrim(str(HB_GTInfo(HB_GTI_FONTSIZE)))+;
>           ";Am I in center?" )
> 
> return
> 

This is all due to the changes affecting the time and way 
window is created physically. In v1.0 it was right at when 
GT was being initialized. Later it was shifted to when GT gets
refresh message. 

When ? HB_GTVERSION() is issued, this is the time when window
is physically created. If window is not created and you issue any of the
other methods, those may/may not take effect at the time of executing them 
or later when window gets created. 

HB_GTInfo(HB_GTI_FONTSIZE, 15) command was not taking effect 
without ? '.' because window was not physically present.
 
Examine gtwvt.c :

      case HB_GTI_FONTSIZE:
         pInfo->pResult = hb_itemPutNI( pInfo->pResult, pWVT->PTEXTSIZE.y );
         iVal = hb_itemGetNI( pInfo->pNewVal );
         if( iVal > 0 )
         {
            HFONT hFont = hb_gt_wvt_GetFont( pWVT->fontFace, iVal,
pWVT->fontWidth, pWVT->fontWeight, pWVT->fontQuality, pWVT->CodePage );
            if( hFont )
            {
               pWVT->fontHeight = iVal;

               // Add this line
               pWVT->hFont = hFont;

////////// ...........................  Note this line
--------------------///////////
               if( pWVT->hWnd )
               {
                  hb_gt_wvt_ResetWindowSize( pWVT );
                  HB_GTSELF_REFRESH( pGT );
               }


               // comment out this one
               //DeleteObject( hFont );
            }
         }
         break;

Now it does not set to right rows/cols is a mystery still which I am
been unable to resolve.

Please try above changes and report here the results.

Regards
Pritpal Bedi
-- 
View this message in context: http://www.nabble.com/gtwvt-problem-tp20760926p20761895.html
Sent from the Harbour - Dev mailing list archive at Nabble.com.

